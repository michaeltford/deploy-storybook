import{j as i}from"./index-BiBgeh3u.js";import{r as o}from"./iframe-mGP4b_Fh.js";import{O as ee,k as u,w as b}from"./index-CmvF348R.js";import{k as $,K as pe,c as x,Q as C}from"./index-CvKDCtrJ.js";import{V as ue,g as fe,D as de,S as m,I as xe,b as te,d as me,M as ge}from"./BgsyX5QL9OLy0DN3-CLQ3UbdE.js";import{B as h,T as ne,b as v,g as F,F as he,a as Oe,S as ye}from"./index-CdE0ylvR.js";import"./index-DTwpo8e8.js";import"./preload-helper-PPVm8Dsz.js";import"./index-CXJVXQGg.js";import"./client-BMu68Vok.js";import"./Tooltip-CXxmTuYg.js";/**
 * @license @sheetxl/studio-mui - Studio - Spreadsheet UI built with SheetXL SDK using React & MUI. - v0.7.26
 *
 * (C) 2025-present SheetXL Inc. & Michael T. Ford
 * License: The license can be found at https://www.sheetxl.com/license.
 */const L={width:"1.5rem",height:"1.5rem"},V=o.memo(S=>{const{label:c,value:g,options:l,onSelect:O,tabIndex:K=0,...P}=S,[I,y]=o.useState(()=>se(g,l));o.useEffect(()=>{y(se(g,l))},[g,l]);const j=$(p=>{y(p.target.value),O?.(l[p.target.value])},[O,l]),R=o.useMemo(()=>Object.keys(l).map(p=>i.jsx(ge,{value:p,children:p},p)),[l]);return i.jsxs(he,{sx:{minWidth:135},size:"small",children:[i.jsx(Oe,{children:c}),i.jsx(ye,{inputProps:{tabIndex:K},value:I,label:c,onChange:j,sx:{backgroundImage:`linear-gradient(${v("#fff",F(5))}, ${v("#fff",F(5))})`},...P,children:R})]})}),ie={enter:140,exit:140},oe={Formulas:u.Content.Formulas,Values:u.Content.Values,Notes:u.Content.Notes,Comments:u.Content.Comments},le={...oe};delete le.Values;const Ce={"By Rows":!0,"By Columns":!1},se=(S,c)=>{const g=Object.keys(c);for(let l=0;l<g.length;l++){const O=g[l];if(c[O]===S)return O}},Ie=o.memo(S=>{const{initialValue:c,context:g,onInput:l,title:O,onHide:K,autoFocus:P,...I}=S,y=c?.replace??!1,j=c?.findOptions,R=j.text??null,p=c?.replaceOptions,E=c?.replaceText??null,D=g?.(),r=o.useRef(null),W=o.useRef(null),z=o.useRef(null),N=o.useRef(null),H=o.useRef(null),U=o.useRef(null),G=(e,t)=>{t&&(t.start(e,{center:!1}),setTimeout(()=>t.stop(e),180))},[Q,T]=o.useState(!1),[A,re]=o.useState(!1),[f,B]=o.useState(y),[q,M]=o.useState(!1),[J,X]=o.useState(!1),[s,a]=o.useState({replaceText:null,replace:y,replaceOptions:null,findOptions:{text:null,matchCase:!1,matchEntireCell:!1,useRegex:!1,orientation:b.Orientation.Row,fields:[u.Content.Formulas]},scope:ee.FindScopeOptions.Sheet}),k=$(async(e,t,n,w)=>{if(!D)return;const d={...s};d.replaceOptions={...d.replaceOptions},d.findOptions={...d.findOptions},d.replaceOptions.maxCount=n?void 0:1,d.replace=t,t&&s.findOptions.fields?.[0]===u.Content.Values&&(d.findOptions.fields=[u.Content.Formulas]),d.findOptions.reverse=!e;const ce=await D({autoFocus:w,...d});M(ce===0)},[s,D]);o.useEffect(()=>{M(!1)},[s,A,f]);const Y=$((e,t)=>{if(e.keyCode===pe.Enter){if(!s.findOptions.text)return;let n=!0,w=!1;e.shiftKey&&(n=!1),t?(e.ctrlKey&&e.altKey&&(w=!0),G(e,w?U.current:H.current)):G(e,n?N.current:z.current),k(n,t,w,!1)}},[s]),Z=o.useRef(null);o.useLayoutEffect(()=>{a(e=>{const t={...e};t.findOptions.text=R&&R.length>0?R:e.findOptions.text??"",T(!0),E!==null&&(t.replaceText=E??""),j&&(t.findOptions={...t.findOptions,...j}),t.replaceText||(t.replaceText=""),t.replaceOptions&&(t.replaceOptions={...t.replaceOptions}),p&&(t.replaceOptions={...t.replaceOptions,...p}),s.findOptions.fields?.[0]||(s.findOptions.fields=[u.Content.Formulas]);const n=!(!y&&!p&&E===null);return n&&B(n),t}),J||Z.current?.focus()},[c,y,R,E,j,p]),o.useEffect(()=>{f?(s.findOptions.fields[0],u.Content.Values):T(!0)},[f]),o.useEffect(()=>{if(Q&&r.current&&s.findOptions.text===r.current.value)return r.current===document.activeElement||r.current.contains(document.activeElement)?(r.current?.select(),void T(!1)):void r.current.addEventListener("focus",()=>{r.current?.select(),T(!1)},{once:!0})},[Q,s]);const[ae,{width:_}]=ue();return i.jsx(fe,{ref:Z,title:O??(f?"Find & Replace":"Find"),initialPosition:{y:"35"},autoFocusSel:".input",onHide:K,onFocus:()=>X(!0),onBlur:()=>{X(!1),M(!1)},slotProps:{paper:{elevation:J?3:1}},...I,children:i.jsxs(de,{dividers:!0,ref:ae,sx:{display:"flex",flexDirection:"column",paddingLeft:e=>e.spacing(1.5),paddingRight:e=>e.spacing(1.5)},onKeyDown:e=>{if(e.key==="h"&&e.ctrlKey)B(!0),r.current?.contains(document.activeElement)&&W.current?.focus();else if(e.key==="f"&&e.ctrlKey)r.current?.focus();else if(e.key==="c"&&e.altKey)a(t=>{const n={...t};return n.findOptions.matchCase=!t.findOptions.matchCase,n});else if(e.key==="e"&&e.altKey)a(t=>{const n={...t};return n.findOptions.matchEntireCell=!t.findOptions.matchEntireCell,n});else{if(e.key!=="r"||!e.altKey)return;a(t=>{const n={...t};return n.findOptions.useRegex=!t.findOptions.useRegex,n})}e.preventDefault()},children:[i.jsxs(h,{sx:{display:"flex",flexDirection:"row",gap:e=>e.spacing(1)},children:[i.jsxs(h,{sx:{display:"flex",flexDirection:"row",alignItems:"start",gap:e=>e.spacing(.25),paddingTop:"3px"},children:[i.jsx(m,{selected:A,onSelectToggle:e=>{re(e)},preventFocus:!0,label:"Toggle Additional Options",icon:i.jsx(x,{iconKey:"FindOptions"})}),i.jsx(m,{selected:f,onSelectToggle:e=>{B(e)},preventFocus:!0,label:"Toggle Replace",icon:i.jsx(x,{iconKey:"FindReplaceToggle"}),shortcut:{key:f?"F":"H",modifiers:[C.Ctrl]}})]}),i.jsxs(h,{sx:{display:"flex",flexDirection:"column",maxWidth:"100%",boxSizing:"border-box"},children:[i.jsxs(h,{sx:{display:"flex",flexDirection:"row",alignItems:"center"},children:[i.jsx(ne,{label:"Find",slotProps:{input:{sx:{paddingRight:e=>e.spacing(1),minWidth:_>460?"20em":void 0,backgroundImage:`linear-gradient(${v("#fff",F(5))}, ${v("#fff",F(5))})`},endAdornment:i.jsx(xe,{position:"end",children:i.jsxs(h,{sx:{display:"flex",alignItems:"center",flexDirection:"row",gap:"2px"},children:[i.jsx(m,{style:L,selected:s.findOptions.matchCase,onBlur:()=>{},onSelectToggle:e=>{a(t=>{const n={...t};return n.findOptions.matchCase=e,n})},label:"Match Case",shortcut:{key:"C",modifiers:[C.Alt]},icon:i.jsx(x,{iconKey:"FindCaseSensitive",size:"1rem"})}),i.jsx(m,{style:L,selected:s.findOptions.matchEntireCell,onSelectToggle:e=>{a(t=>{const n={...t};return n.findOptions.matchEntireCell=e,n})},label:"Match Entire Cell",shortcut:{key:"E",modifiers:[C.Alt]},icon:i.jsx(x,{iconKey:"FindWholeWord",size:"1rem"})}),i.jsx(m,{style:L,selected:s.findOptions.useRegex,onSelectToggle:e=>{a(t=>{const n={...t};return n.findOptions.useRegex=e,n})},label:"Use Regular Expression",shortcut:{key:"R",modifiers:[C.Alt]},icon:i.jsx(x,{iconKey:"FindRegEx",size:"1rem"})})]})})},inputLabel:{shrink:!0},htmlInput:{draggable:!1,ref:r,className:"input",autoFocus:!0,spellCheck:!1,autoComplete:"off",sx:{paddingTop:e=>e.spacing(1.25),paddingBottom:e=>e.spacing(.75)}}},sx:{flex:"1 1 100%",marginRight:e=>e.spacing(1),"& .MuiOutlinedInput-notchedOutline":{borderColor:e=>q?`${e.palette.error.main} !important`:void 0},"& .MuiInputLabel-outlined":{color:e=>q?`${e.palette.error.main} !important`:void 0}},value:s.findOptions.text??"",onChange:e=>{a(t=>{const n={...t};return n.findOptions.text=e.target.value,n})},onKeyDown:e=>Y(e,!1),onContextMenu:e=>{e.stopPropagation()}}),i.jsx(m,{selected:s.findOptions.reverse,onSelectToggle:e=>{k(!1,!1)},touchRippleRef:z,label:"",shortcut:{key:"Enter",modifiers:[C.Shift]},icon:i.jsx(x,{iconKey:s.findOptions.orientation!==b.Orientation.Column?"ArrowBack":"ArrowUpward"}),disabled:!s.findOptions.text}),i.jsx(m,{selected:!s.findOptions.reverse,onSelectToggle:e=>{k(!0,!1)},touchRippleRef:N,label:"Next Match",shortcut:{key:"Enter"},icon:i.jsx(x,{iconKey:s.findOptions.orientation!==b.Orientation.Column?"ArrowForward":"ArrowDownward"}),disabled:!s.findOptions.text})]}),i.jsx(te,{in:f,timeout:ie,onExit:()=>{r.current?.focus()},children:i.jsxs(h,{sx:{display:"flex",flexDirection:"row",alignItems:"center",marginTop:e=>e.spacing(2)},children:[i.jsx(ne,{label:"Replace",slotProps:{input:{sx:{paddingRight:e=>e.spacing(1),backgroundImage:`linear-gradient(${v("#fff",F(5))}, ${v("#fff",F(5))})`}},inputLabel:{shrink:!0},htmlInput:{ref:W,className:"input",spellCheck:!1,autoComplete:"off",sx:{paddingTop:e=>e.spacing(1.25),paddingBottom:e=>e.spacing(.75)}}},sx:{flex:"1 1 100%",marginRight:e=>e.spacing(1)},value:s.replaceText??"",onChange:e=>{a(t=>{const n={...t};return n.replaceText=e.target.value,n})},onKeyDown:e=>Y(e,!0),onContextMenu:e=>{e.stopPropagation()}}),i.jsx(m,{onSelectToggle:e=>{k(!0,!0)},touchRippleRef:H,label:"Replace",shortcut:{key:"Enter"},icon:i.jsx(x,{iconKey:"FindReplace"}),disabled:!s.findOptions.text}),i.jsx(m,{onSelectToggle:e=>{k(!0,!0,!0)},touchRippleRef:U,label:"Replace All",shortcut:{key:"Enter",modifiers:[C.Ctrl,C.Alt]},icon:i.jsx(x,{iconKey:"FindReplaceAll"}),disabled:!s.findOptions.text})]})})]})]}),i.jsx(te,{in:A,timeout:ie,onExit:()=>{r.current?.focus()},children:i.jsxs(h,{sx:{minHeight:"10px",flex:"1 1 100%",display:"flex",flexDirection:"column",gap:e=>e.spacing(1.5),marginTop:e=>e.spacing(1)},children:[i.jsx(me,{orientation:"horizontal",sx:{marginBottom:e=>e.spacing(1.5)}}),i.jsxs(h,{sx:{display:"flex",flexDirection:_>=383?"row":"column",justifyContent:"space-evenly",alignItems:"center",gap:e=>e.spacing(1),rowGap:e=>e.spacing(2)},tabIndex:-1,children:[i.jsx(V,{label:"Within",value:s.scope,options:ee.FindScopeOptions,onSelect:e=>{a(t=>{const n={...t};return n.scope=e,n})}}),i.jsx(V,{label:"Search",value:s.findOptions.orientation!==b.Orientation.Column,options:Ce,onSelect:e=>{a(t=>{const n={...t};return n.findOptions.orientation=e?b.Orientation.Row:b.Orientation.Column,n})}}),i.jsx(V,{label:"Look in",value:f&&s.findOptions.fields?.[0]===u.Content.Values?u.Content.Formulas:s.findOptions.fields?.[0],options:f?le:oe,onSelect:e=>{a(t=>{const n={...t};return n.findOptions.fields=[e],n})}})]})]})})]})})});export{Ie as FindReplaceWindow,Ie as default};
