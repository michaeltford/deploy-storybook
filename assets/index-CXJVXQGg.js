import{j as ne,r as oo}from"./index-BiBgeh3u.js";import{H as j,k as P,t as Bt,X as Qe,T as ro,L as bo,a as _,N as Hn,l as nn,Z as w,m as ae,Q as de,K as Mt,$ as dn,y as jt,F as lo,b as Co,V as yo}from"./index-CvKDCtrJ.js";import{r as o}from"./iframe-mGP4b_Fh.js";(function(){try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode("._sheetxl-grid_h9wwa_7{position:relative;box-sizing:border-box;user-select:none}._sheetxl-grid_h9wwa_7 *{box-sizing:border-box!important}._sheetxl-grid_h9wwa_7 *:focus{outline:none}._sheetxl-grid_h9wwa_7 .cell-container{position:absolute;overflow:visible;white-space:pre}._sheetxl-grid_h9wwa_7 .cell-container>*{inset:0;position:absolute}._sheetxl-grid_h9wwa_7 .sheetxl-stage{contain:strict}._sheetxl-grid_h9wwa_7 .sheetxl-stage>*{contain:strict}")),document.head.appendChild(t)}}catch(n){console.error("vite-plugin-css-injected-by-js",n)}})();/**
 * @license @sheetxl/grid-react - Grid React - Advanced grid component for React - v0.7.26
 *
 * (C) 2025-present SheetXL Inc. & Michael T. Ford
 * License: The license can be found at https://www.sheetxl.com/license.
 */const tn=({itemType:t,index:n,itemSize:r,instanceProps:l,scale:d=1})=>{let u,s,i;t==="column"?(u=l.columnMetadataMap,s=l.lastMeasuredColumnIndex,i=l.recalcColumnIndices):(u=l.rowMetadataMap,s=l.lastMeasuredRowIndex,i=l.recalcRowIndices);const x=i.length>0;if(n>s){let $=0;if(s>=0){const z=u[s];$=z.offset+z.size}for(let z=s+1;z<=n;z++){let k=x?i.includes(z)?r(z)*d:u[z]?.size||r(z)*d:r(z)*d;u[z]={offset:$,size:k},$+=k}t==="column"?l.lastMeasuredColumnIndex=n:l.lastMeasuredRowIndex=n}return u[n],u[n]},Nn=({itemType:t,itemSize:n,itemCount:r,instanceProps:l,offset:d,scale:u})=>{let s,i;t==="column"?(s=l.columnMetadataMap,i=l.lastMeasuredColumnIndex):(s=l.rowMetadataMap,i=l.lastMeasuredRowIndex);let x=0;return x=(i>0?s[i].offset:0)>=d?io({itemType:t,itemSize:n,instanceProps:l,high:i,low:0,offset:d,scale:u}):Eo({itemType:t,itemSize:n,itemCount:r,instanceProps:l,index:Math.max(0,i),offset:d,scale:u}),x=Math.min(x,r),x},io=({itemType:t,itemSize:n,instanceProps:r,high:l,low:d,offset:u,scale:s})=>{for(;d<=l;){const i=d+Math.floor((l-d)/2),x=tn({itemType:t,itemSize:n,index:i,instanceProps:r,scale:s}).offset;if(x===u)return i;x<u?d=i+1:x>u&&(l=i-1)}return d>0?d-1:0},Eo=({itemType:t,itemSize:n,itemCount:r,instanceProps:l,index:d,offset:u,scale:s})=>{let i=1;for(;d<r&&tn({itemType:t,itemSize:n,index:d,instanceProps:l,scale:s}).offset<u;)d+=i,i*=2;return io({itemType:t,itemSize:n,instanceProps:l,high:Math.min(d,r-1),low:Math.floor(d/2),offset:u,scale:s})},Io=t=>{const{rowCount:n,columnCount:r,defaultRowHeight:l,getRowHeight:d,defaultColumnWidth:u,getColumnWidth:s}=t||{},i=o.useRef({columnMetadataMap:{},rowMetadataMap:{},lastMeasuredColumnIndex:-1,lastMeasuredRowIndex:-1,recalcColumnIndices:[],recalcRowIndices:[]}),x=P(R=>Nn({itemType:"row",itemCount:n,itemSize:d??(()=>l??20),instanceProps:i.current,offset:R}),[n,d,l]),$=P(R=>R===-1?0:tn({itemType:"row",index:R,itemSize:d??(()=>l??20),instanceProps:i.current}).offset,[d,l]),z=P(R=>tn({itemType:"row",index:R,itemSize:d??(()=>l??20),instanceProps:i.current}).size,[d,l]),k=P(R=>Nn({itemType:"column",itemCount:r,itemSize:s??(()=>u??75),instanceProps:i.current,offset:R}),[r,s,u]),T=P(R=>R===-1?0:tn({itemType:"column",index:R,itemSize:s??(()=>u??75),instanceProps:i.current}).offset,[s,u]),F=P(R=>tn({itemType:"column",index:R,itemSize:s??(()=>u??75),instanceProps:i.current}).size,[s,u]),[oe,ee]=o.useReducer(R=>R+1,0),Z=()=>({getRowOffset:$,getColOffset:T,getRowIndex:x,getColIndex:k}),[Oe,ie]=o.useState(()=>t?Z():null);return o.useEffect(()=>{ie(t?Z():null)},[oe,n,r,u,l,z,F]),Oe},so="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ~`!@#$%^&*()-_=+[{]};:'\",<.>/?|\\",qn=t=>{if(!t)return null;if(t.eventType==="start")return{type:t.eventType};if(t.eventType==="submit")return{type:t.eventType};if(t.eventType==="cancel")return{type:t.eventType};if(t.eventType==="keyboard")return{type:t.eventType,key:t.event.key};if(t.eventType==="pointer")return{type:t.eventType};if(t.eventType==="coordsChange"){const n={type:t.eventType};return t.activeCoords&&(n.activeCoords=t.activeCoords),n}return{type:t.eventType??"unknown"}},Ro=t=>!0,ko=t=>!!t&&!(t.ctrlKey||t.metaKey||t.altKey||t.isComposing)&&(!(t.shiftKey||t.key!=="F2"&&t.key!==" "&&t.key!=="Backspace")||(!t.shiftKey||t.key!==" ")&&so.indexOf(t.key)!==-1),Mo=t=>!!t&&t.type==="dblclick"&&{editMode:!0},Po=t=>{const{session:n,refLatestCoords:r,handleSubmitEdit:l,handleCancelEdit:d,cellBounds:u,isInBounds:s,getCellEditor:i,propsEditor:x,borderStrokeFill:$="rgb(33, 115, 70)",borderStrokeWidth:z=2,alignment:k=dn.Left,style:T,...F}=t,oe=o.useRef(null),ee=o.useRef(null),[Z,Oe]=o.useState(!1),ie=n.coords,R=o.useCallback(async fe=>{if(oe.current?.getBoundingClientRect()){if(fe.eventType==="keyboard"){const Y=fe.event,q=new KeyboardEvent(Y.type,{bubbles:!0,cancelable:!0,view:window,key:Y.key,code:Y.code,location:Y.location,repeat:Y.repeat,isComposing:Y.isComposing,charCode:Y.charCode,keyCode:Y.keyCode,which:Y.which,ctrlKey:Y.ctrlKey,shiftKey:Y.shiftKey,altKey:Y.altKey,metaKey:Y.metaKey});q.isSynthetic=!0,q.key,ee.current?.dispatchEvent(q)}else fe.eventType==="pointer"||console.warn("unsupported event type",fe);await new Promise(Y=>requestAnimationFrame(Y))}},[]);o.useEffect(()=>{const fe=ee.current;return Oe(!0),ee.current.startEdit?.(n.startEvent),(async()=>{n.editorRefs.push(fe),n.editorRefsDispatchEditorEvent.push(R);const Y=[...n.events];for(let q=0;q<Y.length;q++)await R(Y[q]);n.onMount(fe)})(),()=>{const Y=n.editorRefs.indexOf(fe);Y!==-1&&n.editorRefs.splice(Y,1),n.onUnmount(fe)}},[]);const G=o.useCallback(()=>l(n),[]),me=o.useCallback(()=>{d(n)},[]),W=r.current&&j.isEqualCells(r.current,ie),xe=s&&W&&Z,Ae=i({autoFocus:!!n.startEvent?.autoFocus,...x,onSubmitEdit:G,onCancelEdit:me,ref:ee},ie),Ie=u.x+_.boundPixel(-z/2),je=_.boundPixel(u.width+z/2,!0);return ne.jsx("div",{tabIndex:0,ref:oe,style:{background:void 0,...T,opacity:xe?T?.opacity??1:0,pointerEvents:"auto",position:"absolute",boxSizing:"border-box",top:`${u.y+_.boundPixel(-z/2)}px`,height:_.boundPixel(u.height+z/2,!0),left:`${Ie}px`,width:je},...F,children:ne.jsx("div",{className:"editor-container",style:{position:"absolute",boxSizing:"border-box",left:`${_.boundPixel(1)}px`,top:`${_.boundPixel(1)}px`,width:_.boundPixel(u.width-2,!0),height:_.boundPixel(u.height-2,!0),outline:`${z}px ${$} solid`,boxShadow:"rgba(60,64,67,.35) 2px 2px 6px 3px",maxHeight:"100%",overflow:"hidden",display:"flex"},children:Ae})})},nr=t=>{const{view:n,canEdit:r=Ro,getCellEditor:l,onBeforeStartEdit:d,onStartEdit:u,onSubmitEdit:s,onCancelEdit:i,onDoneEdit:x,isEditorStartKeyEvent:$=ko,isEditorStartPointerEvent:z=Mo,propsContainer:k,borderStrokeFill:T,borderStrokeWidth:F=2,getRangeCoords:oe=null,activeCoords:ee,alignment:Z=dn.Left}=t,[Oe,ie]=o.useState(!1),[R,G]=o.useState(void 0),me=P((M,y,ye,re,ve,We)=>{if(!y)return null;const lt=ve?.(y,M),yt=M.getRangeCoordsBounds(lt),it=M.toClipBounds(yt),Wt=yt,ht=M.getZoom();if(!it)return null;ye&&(ye*=ht),re&&(re*=ht);let S=Wt,le=!1;if(ye!==void 0){let Je={...lt},Jt=0;for(;!le&&S.width<=ye&&Jt<20;){Jt++,Jt>19&&console.warn("max width reached");const qt=M.getTotalRangeCoords(),Rt=M.getLayout();We===dn.Left?Je.colEnd+1<qt.colEnd?Je.colEnd=Rt.getColIndex(S.x+ye):le=!0:We===dn.Right?Je.colStart-1>=0?Je.colStart=Rt.getColIndex(S.x-(ye-S.width)):le=!0:We===dn.Center&&Je.colEnd+1<qt.colEnd&&Je.colStart-1>=0?(Je.colStart=Rt.getColIndex(S.x-(ye-S.width)/2),Je.colEnd=Rt.getColIndex(S.x+S.width+(ye-S.width)/2)):le=!0,le||(S=M.getRangeCoordsBounds(Je))}}S.height=Wt.height,re!==void 0&&(S.height=Math.max(re+1,Wt.height));const{width:Le,height:dt}=M.getViewportSize();return{x:S.x??0,y:S.y??0,height:Math.min(dt-S.y,S.height)+1,width:Math.min(Le-S.x,S.width)+1}},[Z]),W=P(r,[r]),xe=o.useCallback(()=>{n?.getStage()?.focus()},[n]),Ae=o.useRef(null),Ie=P(M=>{d?.(M),D(),ie(!0),Ae.current=null},[d]),je=P(M=>{u?.(M.coords)},[u]),fe=P(M=>{M.isSubmitted||M.isCancelled||(m.current.isEditorClosed=!0,xe(),M.isCancelled=!0,i?.(M.coords),D())},[i]),Y=P(M=>{if(M.isSubmitted||M.isCancelled)return!1;try{return Ae.current=M.coords,M.isEditorClosing=!0,M.isSubmitted=!0,M.isEditorSubmitted||(M.isEditorSubmitted=!0,M.editorRefs[0]?.submitEdit?.()),M.coords,s?.(M.coords),M.isEditorClosed=!0,xe(),D(),!0}catch(y){throw M.isEditorClosing=!1,M.isSubmitted=!1,y}},[s]),q=P(M=>{ie(!1),x?.(M.coords),D()},[x]),m=o.useRef(null),Ue=o.useRef(null),Ke=o.useRef(null),J=o.useRef([]),[Se,K]=o.useReducer(M=>M+1,0),D=o.useCallback(M=>{M&&J.current.push(M),K()},[]),N=P(M=>{if(M.defaultPrevented||M.isSynthetic||!n)return;const y=n?.getCellCoordsFromClient(M.clientX,M.clientY);y&&D({eventType:"pointer",event:M,coords:y})},[n]),It=P(M=>{const y=M.nativeEvent;N(y)},[n]),bt=P(M=>{if(M.defaultPrevented||M.isSynthetic||!n?.getStage())return;const y=Ue.current;$(M,y)&&(M.stopPropagation(),M.preventDefault()),M.key,D({eventType:"keyboard",event:M,coords:y})},[n]);o.useLayoutEffect(()=>{const M=(re,ve)=>{const We=ve?.cell??re;if(!We)return null;const lt=We;if(!W(We))return null;Ie?.(We);const yt=Bt.uuidV4();ve=Object.freeze({autoFocus:!0,...ve}),Ke.current=We;const it={coords:lt,startEvent:ve,uuid:yt,isMounted:!1,isStarted:!1,isSubmitted:!1,isEditorSubmitted:!1,isEditorClosing:!1,isEditorClosed:!1,isCancelled:!1,events:[],editorRefsDispatchEditorEvent:[],editorRefs:[],onMount:Wt=>{it.isMounted||(it.isMounted=!0,D())},onUnmount:Wt=>{if(it.editorRefs.length===0){const ht=()=>{it.isMounted=!1,D()};if(document.activeElement!==document.body)ht();else{const S=le=>{le.defaultPrevented||le.target!==document.body||bt(le)};window.addEventListener("keydown",S,!0),n.getStage()?.addEventListener("focusin",()=>{window.removeEventListener("keydown",S),ht()},To),xe()}}}};return it};if(J.current.length<=0&&!m.current)return;const y=J.current[0];qn(y),(re=>{const ve=[],We=re?.length??0;for(let lt=0;lt<We;lt++){const yt=re[lt];ve.push(qn(yt))}})(J.current),m.current,m.current;let ye=m.current;if(m.current){if(m.current.isDone)m.current=null;else if(m.current.isSubmitted||m.current.isCancelled){if(m.current.isMounted)return;m.current.isDone||(q(m.current),m.current.isDone=!0)}}if(y){if(y.eventType==="start"){const re=y,ve=re.startEvent?.cell??Ue.current;m.current&&j.isEqualCells(m.current.coords,ve)||(m.current=M(ve,re.startEvent))}else if(y.eventType==="keyboard"){const re=y.event;if(m.current){let ve=!1;switch(re.which){case Mt.Left:case Mt.Right:case Mt.Up:case Mt.Down:case Mt.Enter:case Mt.Tab:ve=!0}if(!ve){m.current.events.push(y);for(let We=0;We<m.current.editorRefsDispatchEditorEvent.length;We++)m.current.editorRefsDispatchEditorEvent[We](y)}}else if($(re,y.coords)){const We=M(Ue.current,void 0);We&&We.events.push(y),m.current=We}}else if(y.eventType==="pointer"){const re=y.event;if(m.current){m.current.events.push(y);for(let ve=0;ve<m.current.editorRefsDispatchEditorEvent.length;ve++)m.current.editorRefsDispatchEditorEvent[ve](y)}else{const ve=y?.coords??Ue.current,We=z(re,ve);if(We){let lt;typeof lt!="boolean"&&(lt=We);const yt=M(ve,lt);yt&&yt.events.push(y),m.current=yt}}}else if(y.eventType==="submit"){if(m.current&&!m.current.isSubmitted&&!m.current.isCancelled){if(!m.current.isMounted)return;Y(m.current)}}else if(y.eventType==="cancel"){if(m.current&&!m.current.isSubmitted&&!m.current.isCancelled){if(!m.current.isMounted)return;fe(m.current)}}else if(y.eventType==="coordsChange"){const re=y;if(Ue.current=re.activeCoords,m.current,m.current&&!m.current.isSubmitted&&!m.current.isCancelled){if(!m.current.isMounted)return;try{Y(m.current)}catch{}}}}J.current.length>0&&(J.current.shift(),D()),J.current.length===0&&(!m.current||m.current.isEditorClosing||m.current.isEditorClosed?!m.current&&ye&&xe():m.current.isMounted&&!m.current.isStarted&&(m.current.isStarted=!0,m.current.startEvent.autoFocus&&(typeof m.current.startEvent.autoFocus=="string"?m.current.editorRefs[0]?.autoFocus(m.current.startEvent.autoFocus):m.current.editorRefs[0]?.autoFocus()),je?.(m.current),requestAnimationFrame(()=>{n&&m.current?.coords&&n.scrollCellCoordsIntoView(m.current.coords)})))},[Se]),o.useEffect(()=>{Ke.current=ee;const M=m.current?.coords;j.isEqualCells(M,ee)||(m.current&&(m.current.isEditorClosing=!0),D({eventType:"coordsChange",activeCoords:ee}))},[ee]);const ft=o.useCallback(M=>{bt(M.nativeEvent)},[]),{width:at=0,height:he=0}=R??{width:0,height:0},Ft=P(l,[l]);return{renderOverlay:P(M=>{if(!m.current||m.current.isEditorClosed)return m.current,null;m.current.coords;let y=me(M,m.current.coords,at,he,oe,Z),ye=!0;y&&y.width!==0&&y.height!==0||(y={x:0,y:0,width:at,height:at},ye=!1);const re=M.getZoom(),ve={containerBounds:{x:0,y:0,width:y.width/re,height:y.height/re},setNaturalSize:G,zoom:re};return ne.jsx(Po,{session:m.current,refLatestCoords:Ke,handleSubmitEdit:Y,handleCancelEdit:fe,cellBounds:y,borderStrokeWidth:F,borderStrokeFill:T,isInBounds:ye,getCellEditor:Ft,propsEditor:ve,alignment:Z,...k},"editor:"+m.current.uuid)},[l,oe,Se,at,he,Z,F,T]),startEdit:o.useCallback(M=>{D({eventType:"start",startEvent:M})},[]),submitEdit:o.useCallback(()=>{D({eventType:"submit"})},[]),cancelEdit:o.useCallback(()=>{D({eventType:"cancel"})},[]),onKeyboardEvent:ft,onPointerEvent:It,onKeyboardEventNative:bt,onPointerEventNative:N,isEditing:Oe}},To=Object.freeze({once:!0}),or=({gridRef:t,gridMainRef:n,orientation:r=jt.Row,headerCount:l,selectionPolicy:d="multiple",newSelectionMode:u="clear",alwaysScrollToActiveCoords:s=!0,onDragStart:i,onDragEnd:x,pointerDownInterceptor:$,pointerMoveInterceptor:z,onPointerUp:k,newSelection:T,modifySelection:F,appendSelection:oe,clearSelections:ee})=>{const Z=l??((r===jt.Row?t.current?.rowCount:t.current?.columnCount)||0),Oe=o.useRef(null),ie=o.useRef(null),R=o.useRef(!1),G=o.useRef(null),me=o.useCallback(q=>r===jt.Column?{rowIndex:0,colIndex:q.colIndex}:{rowIndex:q.rowIndex,colIndex:0},[r]),W=o.useCallback(q=>r===jt.Column?{rowIndex:n.current?n.current.rowCount-1:0,colIndex:q.colIndex}:{rowIndex:q.rowIndex,colIndex:n.current?n.current.columnCount-1:0},[r]),xe=q=>{ie.current=W(q),F(ie.current,Oe.current)},Ae=o.useCallback((q,m)=>{if(!t.current)return;const Ue=t.current.getViewFromClient(q,m)?.getCellCoordsFromClient(q,m);return Ue?(r===jt.Column?Ue.rowIndex=n.current.getViewport().rowStart:Ue.colIndex=n.current.getViewport().colStart,Ue):void 0},[]),Ie=o.useCallback((q,m=!1)=>{let Ue=q;return m||(Ue={...q},r===jt.Row?delete Ue.colIndex:delete Ue.rowIndex),n.current?.scrollCellCoordsIntoView(Ue)},[r]),je=P(x,[x]),fe=P(i,[i]),Y=o.useMemo(()=>({onPointerDown:q=>{if(!t||!t.current||q.nativeEvent.defaultPrevented)return;const m=Ae(q.nativeEvent.clientX,q.nativeEvent.clientY);if(!m)return;q.nativeEvent.which;const Ue=q.nativeEvent.shiftKey,Ke=q.nativeEvent.ctrlKey||q.nativeEvent.metaKey;if($?.(q,m)===!1)return;fe?.(),R.current=!0;const J=n.current?.getViewFromClient(q.nativeEvent.clientX,q.nativeEvent.clientY),Se=((K,D)=>r===jt.Column?{...K,rowIndex:D.rowStart}:{...K,colIndex:D.colStart})(m,J.getVisibleRangeCoords());if(Ue)xe(m);else{if(Ke)return((K,D=K,N)=>{Oe.current=me(K),ie.current=W(D),oe(Oe.current,ie.current,N)})(m,m,Se),void(s&&Ie(Se,!0));((K,D=K,N)=>{Oe.current=me(K),ie.current=W(D),T(Oe.current,ie.current,N)})(m,m,Se),xe(m),s&&Ie(Se,!0)}},onPointerMoveOrWait:Bt.throttle(q=>{if(!R.current||!t?.current)return;const m=Ae(q.clientX,q.clientY);if(m&&z?.(q,m)!==!1){if(j.isEqualCells(G.current,m))return ee();xe(m),Ie(m)}},60),onPointerUp:q=>{R.current=!1,je?.(),k?.(q)},processTouch:!0,consumeTouch:!0}),[d,s,Z,u,ee,$,k]);return{onPointerDown:P(nn(Y),[]),getCellCoordsFromClient:Ae}},Fe=(t,n,r)=>{if(!t)return n;let l=n;const d=r===w.Right||r===w.Down;for(;;){const u=t(l,!d);if(u===0)return l;d?l+=u:l-=u}},bn=(t,n,r)=>{const l=[];let d=n;for(;d<=r;){const u=Math.max(0,t(d));u===0?(l.push(d),d++):d+=u}return l},Do=(t,n,r,l,d,u)=>{if(!n)return u;let{rowIndex:s,colIndex:i}=t;switch(l){case w.Down:{s=Fe(r,Math.min(s+1,u),l);let x=n({rowIndex:s,colIndex:i});for(;!x&&s<u;)s=Fe(r,Math.min(++s,u),l),x=n({rowIndex:s,colIndex:i});return s}case w.Up:{s=Fe(r,Math.max(s-1,u),l);let x=n({rowIndex:s,colIndex:i});for(;!x&&s>u;)s=Fe(r,Math.max(--s,u),l),x=n({rowIndex:s,colIndex:i});return s}case w.Right:{i=Fe(r,Math.min(i+1,u),l);let x=n({rowIndex:s,colIndex:i});for(;!x&&i<u;)i=Fe(r,Math.min(++i,u),l),x=n({rowIndex:s,colIndex:i});return i}case w.Left:{i=Fe(r,Math.max(i-1,u),l);let x=n({rowIndex:s,colIndex:i});for(;!x&&i>u;)i=Fe(r,Math.max(--i,u),l),x=n({rowIndex:s,colIndex:i});return i}default:return u}},Oo=(t,n=()=>!0,r,l,d,u)=>{let{rowIndex:s,colIndex:i}=t;switch(l){case w.Down:{s=Fe(r,Math.min(s+1,u),l);let x=n?.({rowIndex:s,colIndex:i});for(;x&&s<u;)s=Fe(r,Math.min(++s,u),l),x=n?.({rowIndex:s,colIndex:i});return n?.({rowIndex:s,colIndex:i})?s:s-1}case w.Up:{s=Fe(r,Math.max(s-1,u),l);let x=n?.({rowIndex:s,colIndex:i});for(;x&&s>u;)s=Fe(r,Math.max(--s,u),l),x=n?.({rowIndex:s,colIndex:i});return n?.({rowIndex:s,colIndex:i})?s:s+1}case w.Right:{i=Fe(r,Math.min(i+1,u),l);let x=n?.({rowIndex:s,colIndex:i});for(;x&&i<u;)i=Fe(r,Math.min(++i,u),l),x=n?.({rowIndex:s,colIndex:i});return n?.({rowIndex:s,colIndex:i})?i:i-1}case w.Left:{i=Fe(r,Math.max(i-1,u),l);let x=n?.({rowIndex:s,colIndex:i});for(;x&&i>u;)i=Fe(r,Math.max(--i,u),l),x=n?.({rowIndex:s,colIndex:i});return n?.({rowIndex:s,colIndex:i})?i:i+1}default:return null}},zo=(t,n,r,l,d,u)=>{if(!n)return u;let s,{rowIndex:i,colIndex:x}=t;l===w.Down?s={rowIndex:i+1,colIndex:x}:l===w.Up?s={rowIndex:i-1,colIndex:x}:l===w.Right?s={rowIndex:i,colIndex:x+1}:l===w.Left&&(s={rowIndex:i,colIndex:x-1});const $=n(t),z=n(s);var k,T;return(T=z,!(k=$)&&!T||!k&&T||k&&!T?Do:Oo)(t,n,r,l,!1,u)??u},Kn=(t,n)=>`${t}:${n}`,_n=(t,n,r,l,d,u)=>{if(r-n>=d-l)return l;let s=l;return t==="nearest"&&(l-n>0?t="start":r-d>0&&(t="end")),t==="start"?s=n:t==="end"?s=r-(d-l):t==="center"&&(s=n+(r-n)/2-(d-l)/2),s<l?Math.max(0,s):s>l?Math.min(s,u-(d-l)):void 0},Yn=(t,n,r,l)=>(console.log("todo: implement convertToVisibleRanges"),t),An=(t,n=w.Right,r,l,d,u=null)=>{if(u&&j.isEqualSelectionCoords(u,t))return t;const s=t.ranges[t.rangeIndex];if(!j.isRangesIntersect({rowStart:t.cell.rowIndex,colStart:t.cell.colIndex,rowEnd:t.cell.rowIndex,colEnd:t.cell.colIndex},s))return t;let i={...t.cell},x=t.rangeIndex;switch(n){case w.Right:i.colIndex=Fe(d,i.colIndex+1,n);break;case w.Left:i.colIndex=Fe(d,i.colIndex-1,n);break;case w.Down:i.rowIndex=Fe(l,i.rowIndex+1,n);break;case w.Up:i.rowIndex=Fe(l,i.rowIndex-1,n)}const $=T=>{if(T){x=t.rangeIndex>=t.ranges.length-1?0:t.rangeIndex+1;const F=t.ranges[x];i={colIndex:F.colStart,rowIndex:F.rowStart}}else{x=t.rangeIndex<=0?t.ranges.length-1:t.rangeIndex-1;const F=t.ranges[x];i={colIndex:F.colEnd,rowIndex:F.rowEnd}}};if(n===w.Right&&i.colIndex>s.colEnd&&i.rowIndex===s.rowEnd)$(!0);else if(n===w.Left&&i.colIndex<s.colStart&&i.rowIndex===s.rowStart)$(!1);else if(n===w.Down&&i.colIndex===s.colEnd&&i.rowIndex>s.rowEnd)$(!0);else if(n===w.Up&&i.colIndex===s.colStart&&i.rowIndex<s.rowStart)$(!1);else{let T=i.rowIndex,F=i.colIndex;switch(n){case w.Right:F>s.colEnd&&(T=Fe(l,T+1,n),F=s.colStart,T>s.rowEnd&&(T=s.rowStart));break;case w.Left:F<s.colStart&&(T=Fe(l,T-1,n),F=s.colEnd,T<s.rowStart&&(T=s.rowEnd));break;case w.Down:T>s.rowEnd&&(F=Fe(d,F+1,n),T=s.rowStart,F>s.colEnd&&(F=s.colStart));break;case w.Up:T<s.rowStart&&(F=Fe(d,F-1,n),T=s.rowEnd,F<s.colStart&&(F=s.colEnd))}i={rowIndex:T,colIndex:F}}let z=r(i);if(!j.isRangeWithinRange(z,s)){const T=j.intersectRanges(z,s);T&&(z=T)}let k={rowStart:Fe(l,z.rowStart,w.Down),colStart:Fe(d,z.colStart,w.Right),rowEnd:Fe(l,z.rowEnd,w.Up),colEnd:Fe(d,z.colEnd,w.Left)};if(k.rowStart!==i.rowIndex||k.colStart!==i.colIndex){switch(n){case w.Right:t.ranges[x].colStart===k.colStart&&t.ranges[x].colEnd===k.colEnd&&(i.rowIndex=k.rowEnd),i.colIndex=k.colEnd;break;case w.Left:t.ranges[x].colStart===k.colStart&&t.ranges[x].colEnd===k.colEnd&&(i.rowIndex=k.rowStart),i.rowIndex===k.rowStart?i.colIndex=k.colStart+1:i.colIndex=k.colStart;break;case w.Down:t.ranges[x].rowStart===k.rowStart&&t.ranges[x].rowEnd===k.rowEnd&&(i.colIndex=k.colEnd),i.rowIndex=k.rowEnd;break;case w.Up:t.ranges[x].rowStart===k.rowStart&&t.ranges[x].rowEnd===k.rowEnd&&(i.colIndex=k.colStart),i.colIndex===k.colStart?i.rowIndex=k.rowStart+1:i.rowIndex=k.rowStart}return An({cell:i,ranges:t.ranges,rangeIndex:x},n,r,l,d,u??t)}return{ranges:t.ranges,cell:i,rangeIndex:x}},Xn=(t,n)=>{let r,l=0,d=0;return n.colStart<t.colStart?(r=w.Left,l=t.colStart-n.colStart,d=n.colStart):n.colEnd>t.colEnd?(r=w.Right,l=n.colEnd-t.colEnd,d=n.colEnd):n.rowStart<t.rowStart?(r=w.Up,l=t.rowStart-n.rowStart,d=n.rowStart):n.rowEnd>t.rowEnd&&(r=w.Down,l=n.rowEnd-t.rowEnd,d=n.rowEnd),{direction:r,amount:l,index:d}},En=(t,n=!1,r,l)=>{if(!r)return 0;const d=!n,u=d?1:-1;let s=r(d?t:t+1),i=r(d?t+1:t),x=t+(d?2:-1),$=0;for(;(i-s)*u<=0;){if(d&&x-1>l+1||!d&&x+1<l)return $;s=i,i=r(x),x+=u,$++}return $},Gn=(t,n,r,l,d)=>{const u={};let s=null,i=null;const x=r.length;for(let $=0;$<x&&r[$]<=d;$++){const z=r[$];if(z<l)continue;const k=s===z?i:n?t.getColOffset(z):t.getRowOffset(z),T=n?t.getColOffset(z+1):t.getRowOffset(z+1);s=z+1,i=T,u[z]=Object.freeze({offset:k,size:T-k,spanIndex:$})}return Object.freeze(u)},Jn=(t,n,r)=>{const l=t.getColOffset(n.colStart)+(r?.left??0),d=t.getRowOffset(n.rowStart)+(r?.top??0);return{x:l,y:d,width:t.getColOffset(n.colEnd+1)+(r?.right??0)-(r?.left??0)-l,height:t.getRowOffset(n.rowEnd+1)+(r?.bottom??0)-(r?.top??0)-d}},Lo=(t,n,r)=>{if(!r)return!1;const l=r.x;if(t<l||t>l+r.width)return!1;const d=r.y;return!(n<d||n>d+r.height)},$n=(t,n=!0)=>`M ${_.boundPixel(t.left)} ${_.boundPixel(t.top)} L ${_.boundPixel(t.right,!0)} ${_.boundPixel(t.top)} L ${_.boundPixel(t.right,!0)} ${_.boundPixel(t.bottom,!0)} L ${_.boundPixel(t.left)} ${_.boundPixel(t.bottom,!0)} L ${_.boundPixel(t.left)} ${_.boundPixel(t.top)} ${n?"Z":""}`,Qn=t=>{const{linePoints:n,bounds:r,propsPath:l,style:d,...u}=t;return ne.jsx("svg",{width:`${_.boundPixel(r.width,!0)}`,height:`${_.boundPixel(r.height,!0)}`,viewBox:`0 0 ${_.boundPixel(r.width,!0)} ${_.boundPixel(r.height,!0)}`,style:{position:"absolute",left:`${_.boundPixel(r.x)}px`,top:`${_.boundPixel(r.y)}px`,width:`${_.boundPixel(r.width,!0)}px`,height:`${_.boundPixel(r.height,!0)}px`,pointerEvents:"none",transitionTimingFunction:"linear",transitionDelay:"0",transitionProperty:"left, top, width, height",willChange:"left, top, width, height, stroke-dashoffset",...d},...u,children:ne.jsx("path",{d:`M ${_.boundPixel(n[0])} ${_.boundPixel(n[1])} L ${_.boundPixel(n[2])} ${_.boundPixel(n[3])}`,fill:"none",vectorEffect:"non-scaling-stroke",stroke:"black",...l})})},$o=t=>{const{x:n=0,y:r=0,width:l=0,height:d=0,fill:u,stroke:s,strokeWidth:i=0,strokeDasharray:x,strokeDashoffset:$,clipPath:z,boundsPath:k,propsPath:T,style:F,...oe}=t,ee=r,Z=n,Oe=l,ie=d;let R=null;if(u){let G=$n({top:0,left:0,bottom:ie,right:Oe});k&&(G=G+" "+$n({top:k.y-ee,left:k.x-Z,bottom:k.height+k.y-ee,right:k.width+k.x-Z})),R=[ne.jsx("path",{d:G,fill:u,stroke:"none",fillRule:"evenodd"},"fill")]}return ne.jsxs("svg",{width:`${_.boundPixel(l,!0)}`,height:`${_.boundPixel(d,!0)}`,viewBox:`0 0 ${_.boundPixel(l,!0)} ${_.boundPixel(d,!0)}`,preserveAspectRatio:"none",style:{position:"absolute",left:`${_.boundPixel(n)}px`,top:`${_.boundPixel(r)}px`,pointerEvents:"none",transitionDuration:"0ms",transitionTimingFunction:"linear",transitionDelay:"0",transitionProperty:"left, top, width, height",willChange:"left, top, width, height, stroke-dashoffset",boxShadow:"rgb(60 64 67 / 5%) 0px 1px 4px 2px, rgb(255 255 255 / 15%) 0px 0px 2px 1px",overflow:"visible",...F},...oe,children:[R,ne.jsx("path",{d:$n({top:0,left:0,right:Oe,bottom:ie}),fill:"none",strokeDasharray:x,strokeDashoffset:$,stroke:s,vectorEffect:"non-scaling-stroke",strokeWidth:i,...T})]})},Bo=t=>{const{key:n,...r}=t;return ne.jsx(co,{...r},n)},co=o.memo(t=>{const{stroke:n,fill:r,x:l=0,y:d=0,width:u=0,height:s=0,style:i,isAnimatedStroke:x,propsAnimatedStroke:$,range:z,cell:k,...T}=t,F=x||!!$,oe={name:"walking-offset",dashGap:2,speed:50,dashLength:8,...$};let ee=oe.dashGap+oe.dashLength;const Z=oe.speed*ee,Oe=Co().replaceAll(":",""),ie=`${oe.name}-${Oe}`;let R;return o.useEffect(()=>{if(!F)return;const G=`@keyframes ${ie} {
      to {
        stroke-dashoffset: 0px;
      }
    }`,me=document.createElement("style");return me.appendChild(document.createTextNode(G)),document.head.appendChild(me),me.sheet.insertRule(G,0),()=>{document.head.removeChild(me)}},[F]),F&&(R={strokeDasharray:`${oe.dashLength}px ${oe.dashGap}px`,strokeDashoffset:`${ee}px`,animation:`${ie} ${Z}ms linear infinite`,willChange:"stroke-dashoffset"}),ne.jsx($o,{x:l,y:d,width:u,height:s,stroke:n,fill:r,shapeRendering:"crispEdges",style:{...R,...i},...T})});function ao(t){var n,r,l="";if(typeof t=="string"||typeof t=="number")l+=t;else if(typeof t=="object")if(Array.isArray(t)){var d=t.length;for(n=0;n<d;n++)t[n]&&(r=ao(t[n]))&&(l&&(l+=" "),l+=r)}else for(r in t)t[r]&&(l&&(l+=" "),l+=r);return l}function Gt(){for(var t,n,r=0,l="",d=arguments.length;r<d;r++)(t=arguments[r])&&(n=ao(t))&&(l&&(l+=" "),l+=n);return l}co.displayName="Selection";const uo=o.memo(o.forwardRef((t,n)=>{const{x:r=0,y:l=0,borderWidth:d=1,size:u=6,borderStroke:s,corner:i,style:x,className:$,background:z,ref:k,...T}=t;if(r===0||l===0)return null;let F=!0,oe=!0,ee=!0,Z=!0;switch(i){case"tl":F=!1,oe=!1;break;case"bl":F=!1,Z=!1;break;case"br":ee=!1,Z=!1;break;case"tr":oe=!1,ee=!1}return ne.jsx("div",{className:Gt("fill-handle",$),style:{position:"absolute",left:r-(u+(F?d:0))/2,top:l-(u+(oe?d:0))/2,width:u,height:u,borderLeft:F?`${d}px ${s}`:void 0,borderTop:oe?`${d}px ${s}`:void 0,borderRight:ee?`${d}px ${s}`:void 0,borderBottom:Z?`${d}px ${s}`:void 0,background:z,cursor:"crosshair",pointerEvents:"all",transitionDuration:"0ms",transitionTimingFunction:"linear",transitionDelay:"0",transitionProperty:"left, top",willChange:"left, top",...x},tabIndex:-1,...T})}));function Bn(t,n){if(typeof t=="function")return t(n);t&&(t.current=n)}uo.displayName="FillHandle";var fo=parseInt(o.version.split(".")[0],10)>=19?function(t){return n=>{const r=[];for(const l of t){const d=Bn(l,n),u=typeof d=="function";r.push(u?d:()=>Bn(l,null))}return()=>{for(const l of r)l()}}}:function(t){return n=>{for(const r of t)Bn(r,n)}};const Fo=_.detectIt().supportsTouchEvents,jn=o.memo(o.forwardRef((t,n)=>{const{range:r,view:l,anchor:d,borderStroke:u="var(--sxl-app-color-primary, rgb(33, 115, 70))",background:s="var(--sxl-app-color-background, white)",borderWidth:i=3,size:x=22,style:$,className:z,selectionTouchPointerHandler:k,onTouchSelectStart:T,onTouchSelectEnd:F,currentTouchAnchor:oe,scrollableElement:ee,scrollableRoot:Z,...Oe}=t;if(!Fo)return null;const ie=P(T,[T]),R=P(F,[F]),{bounds:G,coordsPivot:me,key:W}=o.useMemo(()=>{if(!r||!l)return null;let Se=null,K=null;switch(d){case"tl":Se={colIndex:r.colEnd,rowIndex:r.rowEnd},K={colIndex:r.colStart,rowIndex:r.rowStart};break;case"br":Se={colIndex:r.colStart,rowIndex:r.rowStart},K={colIndex:r.colEnd,rowIndex:r.rowEnd};break;case"t":case"l":Se={colIndex:r.colEnd,rowIndex:r.rowEnd};break;case"b":Se={colIndex:r.colStart,rowIndex:r.rowStart};break;case"r":Se={colIndex:r.colStart,rowIndex:r.rowEnd}}let D=l.getRangeCoordsBounds(K?{rowStart:K.rowIndex,colStart:K.colIndex,rowEnd:K.rowIndex,colEnd:K.colIndex}:r);const N=l.getBounds(),It=l.getViewportSize(),bt=N.x,ft=N.y,at=It.width,he=It.height;switch(d){case"tl":break;case"br":D.x=D.x+D.width,D.y=D.y+D.height;break;case"t":D.x=at/2-bt;break;case"b":D.x=at/2-bt,D.y=D.y+D.height;break;case"l":D.y=he/2-ft;break;case"r":D.x=D.x+D.width,D.y=he/2-ft}const Ft=l.toClipBounds(D,0);return!Ft||Ft.width<=0||Ft.height<=0||D.x<0||D.y<0||D.x>at||D.y>he?{bounds:null,coordsAnchor:null,coordsPivot:null,key:null}:{bounds:D,coordsAnchor:null,coordsPivot:Se,key:"touchSelect-"+l.getAnchor()+"-"+d}},[r,l,d]),xe=o.useRef(null),Ae=o.useMemo(()=>{const Se=K=>d==="t"||d==="b"?{...K,colIndex:void 0}:d==="l"||d==="r"?{...K,rowIndex:void 0}:K;return{processTouch:!0,consumeTouch:!0,onPointerDown:(K,D)=>{const N=Se(l.getCellCoordsFromClient(K.clientX,K.clientY));return xe.current={coordsPivot:me},ie?.(d),k.onSelectionPointerDown(K,D,l,N,me,!1,!0)},onPointerMoveOrWait:(K,D,N)=>{const It=Se(l.getCellCoordsFromClient(K.clientX,K.clientY));return k.onSelectionPointerMoveOrWait(K,D,N,l,It,xe.current?.coordsPivot,!0,!0)},onPointerUp:(K,D,N)=>(xe.current=null,R?.(d),k.onPointerUp(K,D,N))}},[k,r,l,d]),Ie=nn(Ae),[je,{y:fe,x:Y}]=yo(),q=o.useRef(null),{getPortalContainer:m,isFullscreen:Ue}=lo(),[Ke,J]=o.useState(null);return o.useEffect(()=>{const Se=q.current?.getBoundingClientRect();if(!Se||!G)return void J(null);let K=0,D=0,N=ee;for(;N;)K+=N.scrollLeft,D+=N.scrollTop,N=Z&&N===Z.parentElement?null:N.parentElement;J(oo.createPortal(ne.jsx("div",{className:Gt("touch-select-handle",z),ref:n,style:{position:"absolute",left:K+(Se?.x??0)-(x+i)/2,top:D+(Se?.y??0)-(x+i)/2,width:x,height:x,borderWidth:`${i}px`,border:u,borderRadius:"50%",background:s,boxShadow:`0 0 0 1.5px ${s}`,cursor:"grab",pointerEvents:"all",opacity:oe?0:1,transitionDuration:"160ms",transitionProperty:"opacity",...$},tabIndex:-1,onPointerDown:Ie,...Oe}),Z??m(),W))},[fe,Y,G?.x,G?.y,G?.width,G?.height,z,oe,s,x,i,u,ee,Ue]),G?ne.jsxs(ne.Fragment,{children:[ne.jsx("div",{ref:fo([je,q]),style:{position:"absolute",left:G.x,top:G.y,opacity:0}}),Ke]}):null}));jn.displayName="TouchSelectHandle";const $t=-10,Ao=Object.freeze({rowStart:0,colStart:0,rowEnd:0,colEnd:0}),ho=Object.freeze({colIndex:0,rowIndex:0}),Wn=Object.freeze([]),Dt=t=>{if(t&&t.cell&&t.ranges&&t.rangeIndex>-1&&t.rangeIndex<=t.ranges.length)return t;const n={cell:null,ranges:t?.ranges??Wn};return n.rangeIndex=t?.rangeIndex??n.ranges.length-1,n.cell=t?.cell,!n.cell&&n.ranges.length>0&&(n.cell={rowIndex:n.ranges[n.rangeIndex].rowStart,colIndex:n.ranges[n.rangeIndex].colStart}),n.cell||(n.cell=ho),j.isEqualSelectionCoords(n,t)?t:n},Cn=(t,n,r)=>{const l=t.getVisibleRangeCoords(),d=t.getScrollOrientation();!d.horizontal&&(n.colIndex>l.colEnd||n.colIndex<l.colStart)&&(n={...n,colIndex:n.colIndex>l.colEnd?l.colEnd+1:l.colEnd-1},t=r.current.getViewFromLocation(Qe.Center)),!d.vertical&&(n.rowIndex>l.rowEnd||n.rowIndex<l.rowStart)&&(n={...n,rowIndex:n.rowIndex>l.rowEnd?l.rowEnd+1:l.rowEnd-1},t=r.current.getViewFromLocation(Qe.Center)),t.scrollCellCoordsIntoView(n)},jo=()=>!1,rr=({gridRef:t,commands:n,layout:r,selection:l,onSelectionChange:d,onSelectionDragStart:u,onSelectionDragEnd:s,selectionPolicy:i="multiple",newSelectionMode:x="clear",allowDeselectSelection:$=!0,onFillPreview:z,onFillCancel:k,onFillDone:T,onFill:F,disableFillDrag:oe=!F,fillHandleBorderColor:ee="white",hiddenRowsAt:Z,hiddenColumnsAt:Oe,isContentfulCell:ie,contentfulCellFinder:R=zo,getDataCoords:G,alwaysScrollToActiveCoords:me=!1,selectionBounds:W,pointerDownInterceptor:xe,pointerMoveInterceptor:Ae,mergedRanges:Ie,canSelectionSpanMergedCells:je=jo,onMoveDragStart:fe,onMoveDragUpdate:Y,onMoveDragEnd:q,onMoveDragDone:m,renderSelection:Ue=Bo,disableMoveDrag:Ke=!q,getCellCoordsAsRangeCoords:J=j.cellToRange,moveDragHitSize:Se=6,moveDragOutlineSize:K=4,selectionBackgroundColor:D="rgba(16, 124, 65, 0.1)",selectionBorderColor:N="rgb(33, 115, 70)",selectionRemoveBorderColor:It="rgb(255, 0, 0)",selectionRemoveBackgroundColor:bt="rgba(250, 10, 10, 0.1)",disableTouchSelection:ft=!1,propsTouchSelectHandle:at})=>{const he=o.useCallback(()=>({top:W?.top??0,left:W?.left??0,bottom:t.current?.rowCount-1||0,right:t.current?.columnCount-1||0}),[]),Ft=P(F,[F]),M=P(z,[z]),y=P(k,[k]),ye=P(T,[T]),re=P(ie,[ie]),ve=P(Ue,[Ue]),We=P((e,a=!1)=>En(e,a,r.getRowOffset,a?he().bottom:he().top),[r?.getRowOffset]),lt=P(Z??We,[Z]),yt=P((e,a=!1)=>En(e,a,r.getColOffset,a?he().right:he().left),[r?.getColOffset]),it=P(Oe??yt,[Oe]),[Wt,ht]=o.useState(()=>Dt(l)),S=o.useMemo(()=>Dt(Wt),[Wt]),le=o.useRef(S),Le=o.useRef(null);o.useMemo(()=>{Le.current=l},[l]),o.useLayoutEffect(Bt.throttle(()=>{ht(e=>{const a=Dt(l);return Le.current=a,j.isEqualSelectionCoords(a,e)?e:a})},0),[l]),o.useLayoutEffect(()=>{le.current=S},[S]),o.useEffect(()=>{Le.current||!d||j.isEqualSelectionCoords(l,S)||d(S)},[S]);const dt=o.useCallback(e=>{ht(a=>{Le.current=null,a=Dt(a);let f=typeof e=="function"?e(a.ranges):e??Wn;if(j.isEqualRangesArrays(f,a.ranges))return a;let c=Math.max(f.length?0:-1,Math.min(a.rangeIndex,f.length-1)),g=a.cell;c===-1||j.isCellWithinRange(g,f[c])||(g={rowIndex:f[c].rowStart,colIndex:f[c].colStart}),f.length===1&&j.isSingleCell(f[0])&&j.isCellWithinRange(g,f[0])&&(f=[],c=-1);const I={cell:g,ranges:f,rangeIndex:c};return j.isEqualSelectionCoords(I,a)?a:I})},[]),Je=P(e=>{ht(a=>{Le.current=null,a=Dt(a);const f=e??ho,c=J(f);if(!j.isSingleCell(c)&&a.ranges.length===0)return{ranges:[c],rangeIndex:0,cell:f};if(j.isEqualCells(f,a.cell))return a;let g=a.ranges,I=a.rangeIndex;a.ranges.length===1&&(j.isSingleCell(a.ranges[0])&&j.isCellWithinRange(f,a.ranges[0])||!j.isCellWithinRange(f,a.ranges[0]))&&(g=[],I=-1);const p={ranges:g,rangeIndex:I,cell:f};return j.isEqualSelectionCoords(p,a)?a:p})},[J]),[Jt,qt]=o.useState(null),[Rt,on]=o.useState(null),Nt=o.useRef(null),[Re,At]=o.useState(null),pt=o.useRef(null),Ot=o.useRef(null),[un,Qt]=o.useState(null),_e=o.useRef(null),Ve=o.useRef(null),Yt=o.useRef(Ie);o.useEffect(()=>{Yt.current=Ie},[Ie]);const mt=P((e,a={inline:"nearest",block:"nearest"})=>{let{rowIndex:f,colIndex:c}=e;f===void 0&&S?.cell&&(f=S.cell.rowIndex),c===void 0&&S?.cell&&(c=S.cell.colIndex),f!==void 0&&c!==void 0&&t.current?.scrollCellCoordsIntoView({rowIndex:f,colIndex:c},a)},[S]),Ut=o.useCallback(e=>{const a=he();return e.rowIndex<a.top||e.colIndex<a.left||e.colIndex>a.right||e.rowIndex>a.bottom},[]),Ee=P((e,a)=>{if(!t?.current)return null;const f={rowStart:Math.min(e.rowIndex,a.rowIndex),colStart:Math.min(e.colIndex,a.colIndex),rowEnd:Math.max(e.rowIndex,a.rowIndex),colEnd:Math.max(e.colIndex,a.colIndex)};if(je?.(f))return f;const c=J(e),g=J(a),I={rowStart:Math.min(c.rowStart,g.rowStart),colStart:Math.min(c.colStart,g.colStart),rowEnd:Math.max(c.rowEnd,g.rowEnd),colEnd:Math.max(c.colEnd,g.colEnd)};let p;return typeof Yt.current=="function"?p=Yt.current(I):Ie&&(p=Ie),p?j.extendRangeToUnionRanges(I,p):I},[je,J]),Ye=P((e,a,f)=>{const c=e.ranges.length>0?e.ranges[e.rangeIndex]:{rowStart:e.cell.rowIndex,colStart:e.cell.colIndex,rowEnd:e.cell.rowIndex,colEnd:e.cell.colIndex},g={rowStart:Math.min(a.rowIndex??c.rowStart,f.rowIndex??c.rowStart),colStart:Math.min(a.colIndex??c.colStart,f.colIndex??c.colStart),rowEnd:Math.max(a.rowIndex??c.rowEnd,f.rowIndex??c.rowEnd),colEnd:Math.max(a.colIndex??c.colEnd,f.colIndex??c.colEnd)},I={rowIndex:g.rowStart,colIndex:g.colStart},p={rowIndex:g.rowEnd,colIndex:g.colEnd};if(!(Ut(I)||Ut(p)))return Ee(I,p)},[Ee]),ut=P((e,a,f)=>{if(i==="single"||!le.current)return;const c=Ye(le.current,e,a??le.current.cell);if(!c)return;const g=le.current.rangeIndex;dt(I=>I.length?I.map((p,Q)=>g===Q?c:p):[c]),f&&c&&Je({colIndex:c.colStart,rowIndex:c.rowStart})},[]),Ct=o.useCallback((e,a,f)=>{if(!le.current)return;e={...le.current?.cell,...e},a=a??e;const c=Ye(le.current,e,a);if(!c)return;const g={rowIndex:c.rowStart,colIndex:c.colStart},I={...g,...f};x==="clear"?(_e.current=I,Kt()):x==="modify"?ut(g):be(g),Je(I)},[]),be=o.useCallback((e,a=e,f)=>{i!=="multiple"||!e||Ut(e)||Ut(a)||ht(c=>{Le.current=null,c=Dt(c);const g=Ee(e,a);if(!g)return c;let I=c.ranges.length>0?[...c.ranges]:[Ee(c.cell,c.cell)];I.push(g);const p={ranges:I,cell:{rowIndex:g.rowStart,colIndex:g.colStart,...f},rangeIndex:I.length-1};return j.isEqualSelectionCoords(p,c)?c:p})},[]),Kt=()=>{dt(Wn)},Pt=_.detectIt().primaryInput==="touch",ot=o.useRef(null),Et=o.useRef(null),kt=o.useRef(null),Zt=o.useMemo(()=>({onPointerDown:e=>{if(!t||!t.current)return!1;const a=e.nativeEvent,f=t.current.getViewFromClient(a.clientX,a.clientY);if(a.pointerType==="touch"||a.type==="touchstart")return Et.current={topLeft:f.getScrollTopLeft(),point:{x:a.clientX,y:a.clientY}},!0;const c=f.getCellCoordsFromClient(e.nativeEvent.clientX,e.nativeEvent.clientY);if(!c)return!1;ot.current={anchor:f.getAnchor(),coords:c},Ve.current=null;const g=e.nativeEvent.which===Hn.Right;if(g&&j.indexOfCoords(c,S.ranges)!==-1)return!1;const I=e.nativeEvent.shiftKey,p=e.nativeEvent.ctrlKey||e.nativeEvent.metaKey,Q=p,A=$,V=S.ranges.length>0,X=p&&A;if(xe?.(e,c,S)===!1)return!1;u?.(le.current,e);const Te=!g&&i!=="single";if(I)return ut(c),Te;const nt=j.isEqualCells(c,S.cell);if(Q){if(nt&&(!X||!V))return Te;if(p&&j.indexOfCoords(c,S.ranges)!==-1&&A){pt.current=c;const B=Ee(c,c);return Ot.current=B,At(B),Te}return be(c),Te}me&&mt(c),nt&&S.ranges.length===0||Ct(c)},onPointerMoveOrWait:Bt.throttle((e,a)=>{if(!t?.current||e.pointerType==="touch"||e.type==="touchmove"||!ot.current)return;const f=ot.current.anchor;let c=t.current.getViewFromLocation(f),g=c.getCellCoordsFromClient(e.clientX,e.clientY);if(!j.isEqualCells(g,ot.current?.coords)&&(ot.current={anchor:f,coords:g},g&&Ae?.(e,g,le.current)!==!1)){if(pt.current){const I={rowStart:Math.min(g.rowIndex,pt.current.rowIndex),colStart:Math.min(g.colIndex,pt.current.colIndex),rowEnd:Math.max(g.rowIndex,pt.current.rowIndex),colEnd:Math.max(g.colIndex,pt.current.colIndex)},p={rowIndex:I.rowStart,colIndex:I.colStart},Q={rowIndex:I.rowEnd,colIndex:I.colEnd};if(Ut(p)||Ut(Q))return;const A=Ee(p,Q);Ot.current=A,At(A)}else ut(g);kt.current=a,Cn(c,g,t)}},60),onPointerUp:e=>{if(ot.current=null,e.pointerType==="touch"||e.type==="touchend"){if(Et.current){const f=t.current.getViewFromClient(Et.current.point.x,Et.current.point.y),c=f.getScrollTopLeft();if(c.left===Et.current.topLeft.left&&c.top===Et.current.topLeft.top){const g=f.getCellCoordsFromClient(Et.current.point.x,Et.current.point.y);Ct(g)}}return Et.current=null,void(ot.current=null)}try{s?.(le.current,e)}catch(f){console.warn(f)}if(!pt.current)return;const a=Ot.current;pt.current=null,Ot.current=null,At(null),ht(f=>{if(Le.current=null,(f=Dt(f)).ranges.length===0)return f;let c=[],g=-1,I=f.cell;for(let Q=0;Q<f.ranges.length;Q++){const A=f.ranges[Q];if(j.isRangesIntersect(A,a)){const V=Bt.subtractRect({top:A.rowStart,left:A.colStart,bottom:A.rowEnd+1,right:A.colEnd+1},{top:a.rowStart,left:a.colStart,bottom:a.rowEnd+1,right:a.colEnd+1});for(let X=0;X<V.length;X++){const Te={rowStart:V[X].top,colStart:V[X].left,rowEnd:V[X].bottom-1,colEnd:V[X].right-1};c.push(Te),j.isCellWithinRange(f.cell,Te)&&(g=c.length-1)}}else c.push(A);c.length>0&&g===-1&&j.isCellWithinRange(f.cell,A)&&(g=c.length-1,I={rowIndex:c[c.length-1].rowStart,colIndex:c[c.length-1].colStart})}const p={cell:I,rangeIndex:g,ranges:c};return j.isEqualSelectionCoords(p,f)?f:p})},processTouch:!0,consumeTouch:!1}),[S,i,$,me,x]),In=P(nn(Zt),[]),Rn=o.useMemo(()=>({onSelectionPointerDown:(e,a,f,c,g=S.cell,I=me,p=e.nativeEvent.shiftKey,Q=!1)=>{if(!t||!t.current)return!1;e.stopPropagation(),e.preventDefault(),e.nativeEvent.stopImmediatePropagation();const A=f??t.current.getViewFromClient(e.nativeEvent.clientX,e.nativeEvent.clientY),V=c??A.getCellCoordsFromClient(e.nativeEvent.clientX,e.nativeEvent.clientY);if(!V)return!1;ot.current={anchor:A.getAnchor(),coords:V},Ve.current=null;const X=e.nativeEvent.which===Hn.Right;if(X&&j.indexOfCoords(V,S.ranges)!==-1)return!1;const Te=e.nativeEvent.ctrlKey||e.nativeEvent.metaKey,nt=Te,B=$,we=S.ranges.length>0,L=Te&&B;if(xe?.(e,V,S)===!1)return!1;u?.(le.current,e);const ce=!X&&i!=="single";if(p)return ut(V,g,Q),ce;const Ge=j.isEqualCells(V,g);if(nt){if(Ge&&(!L||!we))return ce;if(L&&j.indexOfCoords(V,S.ranges)!==-1&&B){pt.current=V;const xt=Ee(V,V);return Ot.current=xt,At(xt),ce}return be(V),ce}I&&mt(V),Ge&&S.ranges.length===0||Ct(V)},onSelectionPointerMoveOrWait:(e,a,f,c,g,I=S.cell,p=!0,Q=!1)=>{if(!t?.current||(e.stopPropagation(),e.preventDefault(),e.nativeEvent.stopImmediatePropagation(),!ot.current))return;const A=ot.current.anchor;let V=c??t.current.getViewFromLocation(A),X=g??V.getCellCoordsFromClient(e.clientX,e.clientY);if(!j.isEqualCells(X,ot.current?.coords)&&(ot.current={anchor:A,coords:X},X&&Ae?.(e,X,le.current)!==!1)){if(pt.current){const Te={rowStart:Math.min(X.rowIndex,pt.current.rowIndex),colStart:Math.min(X.colIndex,pt.current.colIndex),rowEnd:Math.max(X.rowIndex,pt.current.rowIndex),colEnd:Math.max(X.colIndex,pt.current.colIndex)},nt={rowIndex:Te.rowStart,colIndex:Te.colStart},B={rowIndex:Te.rowEnd,colIndex:Te.colEnd};if(Ut(nt)||Ut(B))return;const we=Ee(nt,B);Ot.current=we,At(we)}else ut(X,I,Q);p&&Cn(V,X,t)}},onPointerUp:e=>{ot.current=null,e.stopPropagation(),e.preventDefault(),e.nativeEvent.stopImmediatePropagation();try{s?.(le.current,e)}catch(f){console.warn(f)}if(!pt.current)return;const a=Ot.current;pt.current=null,Ot.current=null,At(null),ht(f=>{if(Le.current=null,(f=Dt(f)).ranges.length===0)return f;let c=[],g=-1,I=f.cell;for(let Q=0;Q<f.ranges.length;Q++){const A=f.ranges[Q];if(j.isRangesIntersect(A,a)){const V=Bt.subtractRect({top:A.rowStart,left:A.colStart,bottom:A.rowEnd+1,right:A.colEnd+1},{top:a.rowStart,left:a.colStart,bottom:a.rowEnd+1,right:a.colEnd+1});for(let X=0;X<V.length;X++){const Te={rowStart:V[X].top,colStart:V[X].left,rowEnd:V[X].bottom-1,colEnd:V[X].right-1};c.push(Te),j.isCellWithinRange(f.cell,Te)&&(g=c.length-1)}}else c.push(A);c.length>0&&g===-1&&j.isCellWithinRange(f.cell,A)&&(g=c.length-1,I={rowIndex:c[c.length-1].rowStart,colIndex:c[c.length-1].colStart})}const p={cell:I,rangeIndex:g,ranges:c};return j.isEqualSelectionCoords(p,f)?f:p})}}),[S,i,$,me,x]),rt=P((e,a=!1,f=!1,c=0)=>{if(!t.current||!S.cell)return;let g=S.cell,I=S.cell;if(a&&S.ranges.length>0){const L=S.ranges[S.rangeIndex],ce=S.cell;switch(e){case w.Up:I={rowIndex:ce.rowIndex===L.rowStart?L.rowEnd:L.rowStart,colIndex:L.colEnd},g={rowIndex:ce.rowIndex===L.rowStart?L.rowStart:L.rowEnd,colIndex:L.colStart};break;case w.Down:I={rowIndex:ce.rowIndex===L.rowEnd?L.rowStart:L.rowEnd,colIndex:L.colEnd},g={rowIndex:ce.rowIndex===L.rowEnd?L.rowEnd:L.rowStart,colIndex:L.colStart};break;case w.Left:I={rowIndex:L.rowEnd,colIndex:ce.colIndex===L.colStart?L.colEnd:L.colStart},g={rowIndex:L.rowStart,colIndex:ce.colIndex===L.colStart?L.colStart:L.colEnd};break;case w.Right:I={rowIndex:L.rowEnd,colIndex:ce.colIndex===L.colEnd?L.colStart:L.colEnd},g={rowIndex:L.rowStart,colIndex:ce.colIndex===L.colEnd?L.colEnd:L.colStart}}}const p=J(I);let{rowStart:Q,colStart:A}=p;const V=he();if(Ve.current)switch(e){case w.Up:case w.Down:Ve.current.colIndex>=p.colStart&&Ve.current.colIndex<=p.colEnd&&(A=Ve.current.colIndex);break;case w.Left:case w.Right:Ve.current.rowIndex>=p.rowStart&&Ve.current.rowIndex<=p.rowEnd&&(Q=Ve.current.rowIndex)}if(!c){switch(e){case w.Up:Q=Fe(lt,Math.max(p.rowStart-1,V.top),e);break;case w.Down:Q=Fe(lt,Math.min(p.rowEnd+1,V.bottom),e);break;case w.Left:A=Fe(it,Math.max(p.colStart-1,V.left),e);break;case w.Right:A=Fe(it,Math.min(p.colEnd+1,V.right),e)}if(f)switch(e){case w.Up:Q=R({...I,colIndex:S.cell.colIndex},re,lt,e,!1,Math.max(V.top,lt(V.top,!1)));break;case w.Down:Q=R({...I,colIndex:S.cell.colIndex},re,lt,e,!1,Math.min(V.bottom,V.bottom-lt(V.bottom,!0)));break;case w.Left:A=R({...I,rowIndex:S.cell.rowIndex},re,it,e,!1,Math.max(V.left,it(V.left,!1)));break;case w.Right:A=R({...I,rowIndex:S.cell.rowIndex},re,it,e,!1,Math.min(V.right,V.right-it(V.right,!0)))}}let X=null;if(c){let L=0;switch(e){case w.Up:L=r.getRowOffset(Q+1),Q=Math.max(V.top,r.getRowIndex(L-c)),X={top:r.getRowOffset(Q+1)-(L-t.current.getScrollPosition().top)};break;case w.Down:L=r.getRowOffset(Q),Q=Math.min(V.bottom,r.getRowIndex(L+c)),X={top:r.getRowOffset(Q)-(L-t.current.getScrollPosition().top)};break;case w.Left:L=r.getColOffset(A+1),A=Math.max(V.left,r.getColIndex(L-c)),X={left:r.getColOffset(A+1)-(L-t.current.getScrollPosition().left)};break;case w.Right:L=r.getColOffset(A),A=Math.min(V.right,r.getColIndex(L+c)),X={left:r.getColOffset(A)-(L-t.current.getScrollPosition().left)}}}const Te={rowIndex:Q,colIndex:A},nt=J(Te),B={rowIndex:nt.rowStart,colIndex:nt.colStart};a||(Ve.current=Te);const we=j.isEqualCells(_e.current,B)&&j.isEqualCells(_e.current,g);if(a&&!we?ut(B,g):Ct(B),X)t.current.scrollTo(X);else{if(a&&_e.current){const L=he();if(e===w.Right&&_e.current.colIndex===L.left||e===w.Left&&_e.current.colIndex===L.right||e===w.Up&&_e.current.rowIndex===L.bottom||e===w.Down&&_e.current.rowIndex===L.top)return}e===w.Left||e===w.Right?mt({colIndex:Te.colIndex}):e!==w.Up&&e!==w.Down||mt({rowIndex:Te.rowIndex})}},[S,J]),Vt=P(e=>{if(!t.current)return;if(S.ranges.length===0)return void rt(e);const a=J(S.cell);if(j.isEqualRangesArrays([a],S.ranges))return void rt(e);const f=An(S,e,J,lt,it);ht(c=>{Le.current=null,c=Dt(c);const g={...c,cell:f.cell,rangeIndex:f.rangeIndex};return j.isEqualSelectionCoords(g,c)?c:g}),f.cell&&mt(f.cell)},[S,J]),kn=o.useCallback(()=>{const e=he();ut({rowIndex:e.top},{rowIndex:e.bottom})},[]),Mn=o.useCallback(()=>{const e=he();ut({colIndex:e.left},{colIndex:e.right})},[]),_t=P(()=>{S.cell&&t?.current&&mt(S.cell)},[S.cell]),fn=o.useCallback((e=!1)=>{const a={rowIndex:he().top};e?ut(a):Ct(a),mt(a)},[]),hn=o.useCallback((e=!1)=>{const a={rowIndex:he().bottom};e?ut(a):Ct(a),mt(a)},[]),rn=o.useCallback((e=!1)=>{const a={colIndex:he().left};e?ut(a):Ct(a),mt(a)},[]),en=o.useCallback((e=!1)=>{const a=he(),f={rowIndex:a.top,colIndex:a.left};e?ut(f):Ct(f),mt(f)},[]),ln=o.useCallback((e=!1)=>{const a=he(),f={colIndex:G?.()?.colEnd??a.right};e?ut(f):Ct(f),mt(f)},[G]),Xt=o.useCallback((e=!1)=>{const a=he(),f={rowIndex:G?.()?.rowEnd??a.bottom,colIndex:G?.()?.colEnd??a.right};e?ut(f):Ct(f),mt(f)},[G]),sn=P(e=>{if(!t.current||S.ranges.length<=1)return;const a=e===w.Left||e===w.Up;let f=S.rangeIndex+(a?-1:1);f<0?f=S.ranges.length-1:f>S.ranges.length-1&&(f=0);const c=S.ranges[f],g=An({cell:{rowIndex:c.rowEnd,colIndex:c.colEnd},rangeIndex:0,ranges:[c]},w.Right,J,lt,it);ht(I=>{Le.current=null,I=Dt(I);const p={...I,cell:g.cell,rangeIndex:f};return j.isEqualSelectionCoords(p,I)?I:p}),g.cell&&mt(g.cell)},[S,J]),Pn=P(()=>{const e=Yn(S);ht(a=>{Le.current=null,a=Dt(a);const f={...a,visibleSelection:e};return j.isEqualSelectionCoords(f,a)?a:f}),e.cell&&mt(e.cell)},[S,J]),Tn=P(()=>{if(!t.current||S.ranges.length===0)return;const e=S.cell,a=S.ranges[S.rangeIndex],f=Yn({cell:e,rangeIndex:0,ranges:[a]}),c=f.ranges[f.rangeIndex];let g;g=c.rowStart===e.rowIndex&&c.colStart===e.colIndex?{rowIndex:c.rowStart,colIndex:c.colEnd}:c.rowStart===e.rowIndex&&c.colEnd===e.colIndex?{rowIndex:c.rowEnd,colIndex:c.colStart}:c.rowEnd===e.rowIndex&&c.colStart===e.colIndex?{rowIndex:c.rowEnd,colIndex:c.colEnd}:{rowIndex:c.rowStart,colIndex:c.colStart},ht(I=>{I=Dt(I);const p={...I,cell:g};return j.isEqualSelectionCoords(p,I)?I:p}),g&&mt(g)},[S,J]),gn=o.useCallback((e=!1)=>{rt(w.Down,e,!1,t.current.getDimensions().containerHeight)},[]),zt=o.useCallback((e=!1)=>{rt(w.Up,e,!1,t.current.getDimensions().containerHeight)},[]),wn=o.useCallback((e=!1)=>{rt(w.Right,e,!1,t.current.getDimensions().containerWidth)},[]),cn=o.useCallback((e=!1)=>{rt(w.Left,e,!1,t.current.getDimensions().containerWidth)},[]),xn=o.useCallback(()=>{Vt(w.Left)},[]),pn=o.useCallback(()=>{Vt(w.Right)},[]),Dn=o.useCallback(()=>{Vt(w.Up)},[]),On=o.useCallback(()=>{Vt(w.Down)},[]),an=o.useCallback(()=>{sn(w.Left)},[]),zn=o.useCallback(()=>{sn(w.Right)},[]),Ln=o.useCallback(()=>{Tn()},[]),mn=o.useCallback(()=>{rt(w.Left,!1,!1)},[]),h=o.useCallback(()=>{rt(w.Left,!0,!1)},[]),v=o.useCallback(()=>{rt(w.Left,!1,!0)},[]),E=o.useCallback(()=>{rt(w.Left,!0,!0)},[]),b=o.useCallback(()=>{rt(w.Right,!1,!1)},[]),C=o.useCallback(()=>{rt(w.Right,!0,!1)},[]),O=o.useCallback(()=>{rt(w.Right,!1,!0)},[]),ge=o.useCallback(()=>{rt(w.Right,!0,!0)},[]),se=o.useCallback(()=>{rt(w.Up,!1,!1)},[]),pe=o.useCallback(()=>{rt(w.Up,!0,!1)},[]),U=o.useCallback(()=>{rt(w.Up,!1,!0)},[]),Ce=o.useCallback(()=>{rt(w.Up,!0,!0)},[]),He=o.useCallback(()=>{rt(w.Down,!1,!1)},[]),$e=o.useCallback(()=>{rt(w.Down,!0,!1)},[]),Xe=o.useCallback(()=>{rt(w.Down,!1,!0)},[]),ke=o.useCallback(()=>{rt(w.Down,!0,!0)},[]),ue=o.useCallback(()=>{dt(e=>e.slice(0,-1))},[]),st=o.useMemo(()=>{const e=he();return((a,f,c,g,I)=>{const p=a.length;for(let Q=0;Q<p;Q++){const A=a[Q];if(A.rowStart===f&&A.colStart===c&&A.rowEnd===g&&A.colEnd===I)return!0}return!1})(S.ranges,e.top,e.left,e.bottom,e.right)},[W,S.ranges]),Ze=o.useCallback((e,a=!0)=>{_e.current=e,Je(e),a&&e&&t?.current&&mt(e)},[]),Be=P((e=!0)=>{const a=Nt.current;if(!le.current?.cell)return;const f=le.current?.ranges,c=le.current?.cell;if(!c||!a||!a)return;let g=null;if(g=f.length>0?f[f.length-1]:J(c),g.colEnd>=g.colStart&&g.rowEnd>=g.rowStart){const I=Xn(g,a);let p=e?Ft:M;try{p?.(g,a,I.direction)}catch(Q){console.warn(Q)}finally{e&&ye?.()}}},[J]),et=o.useRef(null),vt=o.useMemo(()=>({onPointerDown:(e,a)=>{if(kt.current=a,!t||!t.current)return!1;const f=t.current.getViewFromClient(e.nativeEvent.clientX,e.nativeEvent.clientY),c=f?.getCellCoordsFromClient(e.nativeEvent.clientX,e.nativeEvent.clientY);c&&(e.stopPropagation(),qt("crosshair"),et.current={anchor:f.getAnchor(),coords:c})},onPointerMoveOrWait:(e,a)=>{if(oe||!t?.current||!le.current||!et.current)return;const f=et.current.anchor;let c=t.current.getViewFromLocation(f),g=c.getCellCoordsFromClient(e.clientX,e.clientY);if(!g)return;et.current={anchor:f,coords:g};const I=le.current.ranges;let p=Ee(le.current.cell,g);if(!p)return;const Q=I.length>0,A=Q?I[I.length-1]:J(le.current.cell);if(!p)return;const V=p.rowStart<A.rowStart?w.Up:p.rowEnd>A.rowEnd?w.Down:p.colEnd>A.colEnd?w.Right:w.Left,X=he();V===w.Left&&(p={...A,colStart:Math.max(X.left,p.colStart)}),V===w.Up&&(p={...A,rowStart:Math.max(X.top,p.rowStart)}),V===w.Right&&(p={...A,colEnd:Math.min(X.right,p.colEnd)}),V===w.Down&&(p={...A,rowEnd:Math.min(X.bottom,p.rowEnd)});const Te=Xn(A,p);if(!je?.(A)){let nt;typeof Yt.current=="function"?nt=Yt.current(A):Ie&&(nt=Ie),p=((B,we,L,ce,Ge,xt)=>{const H={...we};if(L.length===0)return H;if(Ge===w.Left){const De=B.colEnd+1-B.colStart;H.colStart=B.colStart-Math.ceil(xt/De)*De,H.colStart<ce.left&&(H.colStart=H.colStart+Math.ceil((ce.left-H.colStart)/De)*De)}else if(Ge===w.Right){const De=B.colEnd+1-B.colStart;H.colEnd=B.colEnd+Math.ceil(xt/De)*De,H.colEnd>ce.right&&(H.colEnd=H.colEnd-Math.ceil((ce.right-H.colEnd)/De)*De)}else if(Ge===w.Up){const De=B.rowEnd+1-B.rowStart;H.rowStart=B.rowStart-Math.ceil(xt/De)*De,H.rowStart<ce.top&&(H.rowStart=H.rowStart+Math.ceil((ce.top-H.rowStart)/De)*De)}else if(Ge===w.Down){const De=B.rowEnd+1-B.rowStart;H.rowEnd=B.rowEnd+Math.ceil(xt/De)*De,H.rowEnd>ce.bottom&&(H.rowEnd=H.rowEnd-Math.ceil((ce.bottom-H.rowEnd)/De)*De)}return H})(A,p,nt,X,Te.direction,Te.amount)}if(Q&&j.isRangeWithinRange(p,A)&&(p=null),!j.isEqualRanges(p,Nt.current)){if(on(p),Nt.current=p,!p){try{y?.()}catch{}return void ye?.()}Be(!1)}kt.current=a,Cn(c,g,t)},onPointerUp:(e,a)=>{kt.current=a,Promise.resolve(Be(!0)).finally(()=>{ye?.(),on(null),Nt.current=null,et.current=null,qt(null),t.current?.focus()})}}),[J]),Ne=nn(vt),te=o.useMemo(()=>({onPointerDown:Ne}),[Ne]),[qe,gt]=o.useState(null),Me=o.useRef(null),tt=o.useMemo(()=>({onPointerDown:(e,a)=>{if(kt.current=a,!t||!t.current)return!1;const f=t.current.getViewFromClient(e.nativeEvent.clientX,e.nativeEvent.clientY),c=f?.getCellCoordsFromClient(e.nativeEvent.clientX,e.nativeEvent.clientY);if(!c)return;if(xe?.(e,c,S)===!1)return!1;e.stopPropagation(),qt("default");const g=f.getRelativePointFromClient(0,0),I=le.current?.ranges[le.current?.ranges.length-1]??j.cellToRange(le.current?.cell),p=f.toClipBounds(f.getRangeCoordsBounds(I)),Q={x:0,y:0};p.x-g.x>e.nativeEvent.clientX?Q.x=e.nativeEvent.clientX-(p.x-g.x):e.nativeEvent.clientX>=p.x-g.x+p.width&&(Q.x=Math.max(0,e.nativeEvent.clientX-(p.x-g.x+p.width))+1),p.y-g.y>e.nativeEvent.clientY?Q.y=e.nativeEvent.clientY-(p.y-g.y):e.nativeEvent.clientY>=p.y-g.y+p.height&&(Q.y=Math.max(0,e.nativeEvent.clientY-(p.y-g.y+p.height))+1),fe?.(I,e,a),Me.current={range:I,anchor:f.getAnchor(),cell:c,isMoving:!1,extrusion:Q}},onPointerMoveOrWait:(e,a,f)=>{if(Ke||!t?.current||!le.current||!Me.current)return;const c=e.clientX-f.clientX,g=e.clientY-f.clientY;if(Me.current.isMoving=Me.current.isMoving||Math.abs(c)>Math.max(1,2)||Math.abs(g)>Math.max(1,2)||performance.now()-f.timeStamp>500,!Me.current.isMoving)return;const I=Me.current.anchor,p=Me.current.extrusion;let Q=t.current.getViewFromLocation(I),A=Q.getCellCoordsFromClient(e.clientX-p.x,e.clientY-p.y,!0);if(!A)return;const V=Me.current.cell,X=Me.current.range,Te=he(),nt=X.colEnd-X.colStart+1,B=Math.min(Math.max(0,V.colIndex-X.colStart),nt-1),we=Math.min(Te.right-nt+1,Math.max(Te.left,A.colIndex-B)),L=X.rowEnd-X.rowStart+1,ce=Math.min(Math.max(0,V.rowIndex-X.rowStart),L-1),Ge=Math.min(Te.bottom-L+1,Math.max(Te.top,A.rowIndex-ce)),xt={colStart:we,colEnd:we+nt-1,rowStart:Ge,rowEnd:Ge+L-1};j.isEqualRanges(qe,xt)&&!(H=>!H||!kt.current||kt.current.ctrlKey!==H.ctrlKey||kt.current.shiftKey!==H.shiftKey||kt.current.altKey!==H.altKey||kt.current.metaKey!==H.metaKey)(e)||(gt(xt),Y?.(xt,e,a)),kt.current=a,Cn(Q,A,t)},onPointerUp:(e,a)=>{kt.current=a;const f=()=>{gt(null),Me.current=null,qt(null),t.current?.focus()};if(!Me.current)return void f();const c=Me.current.range,g=qe;q?.(c,e,a),Promise.resolve(c&&g&&m?.(c,g,e,a)).finally(()=>{f()})}}),[qe]),ze=nn(tt),Pe=o.useMemo(()=>({onPointerDown:ze}),[ze]),wt=o.useRef(null),ct=o.useMemo(()=>{const e=j.isEqualSelectionCoords(S,wt.current)?wt.current:S;return wt.current=e,e},[S]),St=o.useCallback(e=>{let a=null,f="br";const c=[],g={stroke:ee,fill:D,strokeWidth:.5},I=(B,we,L)=>{const ce=e.toClipBounds(e.getRangeCoordsBounds(B),$t);if(!ce)return;ce.x=ce.width>0?ce.x:ce.x-g.strokeWidth/2,ce.y=ce.height>0?ce.y:ce.y-g.strokeWidth/2,ce.width=Math.max(ce.width,g.strokeWidth),ce.height=Math.max(ce.height,g.strokeWidth);const Ge={key:`selection-fill-${we}`,range:B,...ce,...g};if(L){const xt=e.getCellCoordsAsRangeCoords(L);Ge.cell=L,Ge.boundsPath=e.toClipBounds(e.getRangeCoordsBounds(xt),$t),Ge.boundsPath&&(Ge.boundsPath.width<=0||Ge.boundsPath.height<=0)&&(delete Ge.boundsPath,delete Ge.cell)}return ve(Ge)};let p=Le.current||(S?Dt(S):null);const Q=p?.cell?e.getCellCoordsAsRangeCoords(p?.cell):Ao;!p||p.ranges&&p.ranges.length!==0||(p={ranges:[Q],rangeIndex:0,cell:p.cell});const A=p?p.ranges:null;A&&A.length;for(let B=0;p&&B<p.ranges.length;B++){const we=p.ranges[B],L=I(we,B,B===p.rangeIndex?p.cell:null);L&&c.push(L);const ce=2,Ge=.5,xt=e.toClipBounds(e.getRangeCoordsBounds(we,{top:0,left:0,right:0,bottom:0}),$t);if(xt){const H=(p.ranges.length,4);c.push(ve({range:we,key:`selection-inside-edge-${B}`,x:xt.x-1,y:xt.y-1,width:Math.max(xt.width+1,0),height:Math.max(xt.height+1,0),style:{overflow:"hidden"},stroke:ee,strokeWidth:H}))}if(p.ranges.length===1){const H=e.toClipBounds(e.getRangeCoordsBounds(we),$t);if(H){Ke||c.push(ve({range:we,key:`move-selection-hit-box-${B}`,x:H.width>1?H.x:H.x-(Se/2+1),y:H.height>1?H.y:H.y-(Se/2+1),width:Math.max(H.width+2,1),height:Math.max(H.height+2,1),stroke:"transparent",style:{boxShadow:"none"},propsPath:{cursor:qe?void 0:"move",pointerEvents:"stroke"},strokeWidth:Se,...Pe}));const De=ce;c.push(ve({range:we,key:`selection-single-${B}`,x:H.x-De/2,y:H.y-De/2,width:Math.max(H.width+De/2,1),height:Math.max(H.height+De/2,1),stroke:N,strokeWidth:De}))}}else{const H=e.toClipBounds(e.getRangeCoordsBounds(we,{top:-1,left:-1,right:-2,bottom:-2}),$t);H&&c.push(ve({range:we,key:`selection-multi-${B}`,x:H.width>1?H.x:H.x-Ge/2,y:H.height>1?H.y:H.y-Ge/2,width:Math.max(H.width,Ge)+1,height:Math.max(H.height,Ge)+1,stroke:N,style:{overflow:"hidden"},strokeWidth:2}))}if(p.ranges.length>1&&B===p.rangeIndex){const H=e.getCellCoordsAsRangeCoords(p.cell),De=e.toClipBounds(e.getRangeCoordsBounds(H,{top:1,left:1,right:-1,bottom:-1}),$t);De&&c.push(ve({range:we,key:`selection-anchor-${B}`,x:De.x,y:De.y,width:Math.max(De.width,Ge),height:Math.max(De.height,Ge),stroke:N,style:{overflow:"hidden"},strokeWidth:2}))}if(B===p.ranges.length-1){a=null,f=null;const H=we.rowStart===he().top&&we.rowEnd===he().bottom,De=we.colStart===he().left&&we.colEnd===he().right,Un=e.getRangeCoordsBounds(we);let Lt=null;if(H||De){if(Lt=e.toClipBounds(Un,$t),Object.keys(e.allViews()).length>1){const vn=e.getVisibleRangeCoords(),Vn=e.allViews()[Qe.TopLeft],vo=e.allViews()[Qe.Top],So=e.allViews()[Qe.Left],Sn=e.getAnchor();(De&&(Sn===Qe.Top&&Vn||Sn===Qe.Center&&So||!j.isCellWithinRange({colIndex:we.colStart,rowIndex:we.rowEnd},vn)&&!j.isCellWithinRange({colIndex:we.colStart,rowIndex:we.rowEnd+1},vn))||H&&(Sn===Qe.Left&&Vn||Sn===Qe.Center&&vo||!j.isCellWithinRange({colIndex:we.colEnd,rowIndex:we.rowStart},vn)&&!j.isCellWithinRange({colIndex:we.colEnd+1,rowIndex:we.rowStart},vn)))&&(Lt=null)}}else Lt=e.toClipBounds(Un,$t);if(!Lt||Lt.width===0||Lt.height===0)continue;a={x:Lt.x+Lt.width+1,y:Lt.y+Lt.height+1},Lt.width===0||Lt.height===0||we.rowStart===he().top&&we.colStart===he().left&&we.rowEnd===he().bottom&&we.colEnd===he().right||(H?(a.y=ce,f="tr"):De&&(a.x=ce,f="bl"))}}let V=null;if(Re){const B=e.toClipBounds(e.getRangeCoordsBounds(Re,{top:0,left:0,right:0,bottom:0}),$t);B&&(V=ve({...g,range:Re,key:"remove-selection",x:B.x,y:B.y,width:B.width,height:B.height,strokeWidth:2,stroke:It,fill:bt}))}let X=null;if(Rt){const B=e.toClipBounds(e.getRangeCoordsBounds(Rt,{top:0,left:0,right:0,bottom:0}),$t);B&&(X=ve({range:Rt,key:"selection-fill-outline",x:B.x-2/2,y:B.y-2/2,width:B.width+2/2,height:B.height+2/2,strokeWidth:2,stroke:N,strokeDasharray:"3 2"}))}let Te=null;!oe&&a&&!qe&&(Te=o.createElement(uo,{...a,corner:f,size:7.5,borderStroke:`${ee} solid`,style:{borderRadius:1},background:N,...te,key:"fillHandle"}));const nt=[...c];if(V&&nt.push(V),X&&nt.push(X),Te&&nt.push(Te),!ft&&Pt&&p?.ranges.length===1&&p.ranges[p.ranges.length-1]){const B=p.ranges[p.ranges.length-1],we=B.rowStart===he().top&&B.rowEnd===he().bottom,L=B.colStart===he().left&&B.colEnd===he().right,ce={view:e,range:B,borderStroke:`${N} solid 3px`,background:ee,selectionTouchPointerHandler:Rn,...at,onTouchSelectStart:Ge=>Qt(Ge),onTouchSelectEnd:()=>Qt(null),currentTouchAnchor:un};nt.push(ne.jsx(jn,{anchor:L?"b":we?"r":"br",scrollableElement:t.current,...ce},"touch-select-handle-after")),nt.push(ne.jsx(jn,{anchor:L?"t":we?"l":"tl",scrollableElement:t.current,...ce},"touch-select-handle-before"))}if(qe){const B=e.toClipBounds(e.getRangeCoordsBounds(qe,{top:1,left:1,right:1,bottom:1}),$t);B&&nt.push(ve({range:qe,key:"selection-move-outline",x:B.x-K/2,y:B.y-K/2,width:Math.max(B.width+K/2,1),height:Math.max(B.height+K/2,1),stroke:N,style:{boxShadow:"none",transitionDuration:"70ms",transitionTimingFunction:"ease-in",transitionProperty:"left, top, width, height",willChange:"left, top, width, height"},strokeWidth:K}))}return ne.jsx("div",{children:nt},"selection")},[ct,Re,oe,Rt,Ke,qe,he,ee,N,D,It,bt,ft,at,un]),Tt=o.useMemo(()=>{const e=()=>t.current;return[new ae("moveToPageDown",e,{label:"Page Down",description:"Shift viewport down one page.",shortcut:[{key:"PageDown"}]},()=>gn(!1)),new ae("selectToPageDown",e,{label:"Select To Page Down",description:"Shift viewport and select down one page.",shortcut:[{key:"PageDown",modifiers:[de.Shift]}]},()=>gn(!0)),new ae("moveToPageRight",e,{label:"Page Right",description:"Shift viewport right one page.",shortcut:[{key:"PageDown",modifiers:[de.Alt]}]},()=>wn(!1)),new ae("selectToPageRight",e,{label:"Page Right",description:"Shift viewport right one page.",shortcut:[{key:"PageDown",modifiers:[de.Alt,de.Shift]}]},()=>wn(!0)),new ae("moveToPageUp",e,{label:"Page Up",description:"Shift viewport up one page.",shortcut:[{key:"PageUp"}]},()=>zt(!1)),new ae("selectToPageUp",e,{label:"Page Up",description:"Shift viewport up one page.",shortcut:[{key:"PageUp",modifiers:[de.Shift]}]},()=>zt(!0)),new ae("moveToPageLeft",e,{label:"Page Left",description:"Shift viewport left one page.",shortcut:[{key:"PageUp",modifiers:[de.Alt]}]},()=>cn(!1)),new ae("selectToPageLeft",e,{label:"Page Left",description:"Shift viewport left one page.",shortcut:[{key:"PageUp",modifiers:[de.Alt,de.Shift]}]},()=>cn(!0)),new ae("selectColumn",e,{label:"Select Column",description:"Select the columns for the selected cells.",shortcut:{key:"Space",modifiers:[de.Ctrl]}},kn),new ae("selectRow",e,{label:"Select Row",description:"Select the rows for the selected cells.",shortcut:{key:"Space",modifiers:[de.Shift]}},Mn),new ae("selectToColumnStart",e,{label:"Select To Column Start",description:"Select the columns to the beginning of the sheet."},()=>fn(!0)),new ae("selectToColumnEnd",e,{label:"Select To Column End",description:"Select the columns to the end of the sheet."},()=>hn(!0)),new ae("moveToRowStart",e,{label:"Move to Row Home",description:"Move to the beginning of the row.",shortcut:[{key:"Home"}]},()=>rn(!1)),new ae("selectToRowStart",e,{label:"Select to Row Home",description:"Select to the beginning of the row.",shortcut:[{key:"Home",modifiers:[de.Shift]}]},()=>rn(!0)),new ae("moveToSheetStart",e,{label:"Move to Sheet Home",description:"Move to the beginning of the sheet.",shortcut:[{key:"Home",modifiers:[de.Ctrl]}]},()=>en(!1)),new ae("selectToSheetStart",e,{label:"Select to Sheet Home",description:"Select to the beginning of the sheet.",shortcut:[{key:"Home",modifiers:[de.Ctrl,de.Shift]}]},()=>en(!0)),new ae("moveToRowEnd",e,{label:"Move to Row End",description:"Move to the end of the row.",shortcut:[{key:"End"}]},()=>ln(!1)),new ae("selectToRowEnd",e,{label:"Select to Row End",description:"Select to the end of the row.",shortcut:[{key:"End",modifiers:[de.Shift]}]},()=>ln(!0)),new ae("moveToSheetEnd",e,{label:"Move to Sheet End",description:"Move to the end of the sheet.",shortcut:[{key:"End",modifiers:[de.Ctrl]}]},()=>Xt(!1)),new ae("selectToSheetEnd",e,{label:"Select to Sheet End",description:"Select to the end of the sheet.",shortcut:[{key:"End",modifiers:[de.Ctrl,de.Shift]}]},()=>Xt(!0)),new ae("scrollToActiveCoords",e,{label:"Scroll to Active Cell",description:"Scroll to the Active Cell.",shortcut:{key:"Backspace",modifiers:[de.Ctrl]}},_t),new ae("scrollToActiveCoordsClearSelection",e,{label:"Scroll to Active Cell",description:"Scroll to the Active Cell and clear selection.",shortcut:{key:"Backspace",modifiers:[de.Shift]}},()=>{Kt(),Ze(S.cell,!0)}),new ae("traverseSelectionRight",e,{label:"Traverse Right",description:"Traverse the selection moving rightward.",shortcut:{key:"Tab"}},pn),new ae("traverseSelectionLeft",e,{label:"Traverse Left",description:"Traverse the selection moving leftward.",shortcut:{key:"Tab",modifiers:[de.Shift]}},xn),new ae("traverseSelectionDown",e,{label:"Traverse Down",description:"Traverse the selection moving downward.",shortcut:[{key:"Enter"},{key:"NumpadEnter"}]},On),new ae("traverseSelectionUp",e,{label:"Traverse Up",description:"Traverse the selection moving upward.",shortcut:[{key:"Enter",modifiers:[de.Shift]},{key:"NumpadEnter",modifiers:[de.Shift]}]},Dn),new ae("moveLeft",e,{label:"Move Left",description:"Move active cell to the left.",shortcut:[{key:"ArrowLeft"}]},mn),new ae("selectLeft",e,{label:"Select Left",description:"Extend selection left.",shortcut:[{key:"ArrowLeft",modifiers:[de.Shift]}]},h),new ae("moveContentfulLeft",e,{label:"Move Left Contentful",description:"Move left to the next cell with content.",shortcut:[{key:"ArrowLeft",modifiers:[de.Ctrl]}]},v),new ae("selectContentfulLeft",e,{label:"Select Left Contentful",description:"Extend selection left to the next cell with content.",shortcut:[{key:"ArrowLeft",modifiers:[de.Ctrl,de.Shift]}]},E),new ae("moveRight",e,{label:"Move Right",description:"Move active cell to the right.",shortcut:[{key:"ArrowRight"}]},b),new ae("selectRight",e,{label:"Select Right",description:"Extend selection right.",shortcut:[{key:"ArrowRight",modifiers:[de.Shift]}]},C),new ae("moveContentfulRight",e,{label:"Move Right Contentful",description:"Move right to the next cell with content.",shortcut:[{key:"ArrowRight",modifiers:[de.Ctrl]}]},O),new ae("selectContentfulRight",e,{label:"Select Right Contentful",description:"Extend selection right to the next cell with content.",shortcut:[{key:"ArrowRight",modifiers:[de.Ctrl,de.Shift]}]},ge),new ae("moveUp",e,{label:"Move Up",description:"Move active cell to the up.",shortcut:[{key:"ArrowUp"}]},se),new ae("selectUp",e,{label:"Select Up",description:"Extend selection up.",shortcut:[{key:"ArrowUp",modifiers:[de.Shift]}]},pe),new ae("moveContentfulUp",e,{label:"Move Up Contentful",description:"Move up to the next cell with content.",shortcut:[{key:"ArrowUp",modifiers:[de.Ctrl]}]},U),new ae("selectContentfulUp",e,{label:"Select Up Contentful",description:"Extend selection up to the next cell with content.",shortcut:[{key:"ArrowUp",modifiers:[de.Ctrl,de.Shift]}]},Ce),new ae("moveDown",e,{label:"Move Down",description:"Move active cell to the down.",shortcut:[{key:"ArrowDown"}]},He),new ae("selectDown",e,{label:"Select Down",description:"Extend selection down.",shortcut:[{key:"ArrowDown",modifiers:[de.Shift]}]},$e),new ae("moveContentfulDown",e,{label:"Move Down Contentful",description:"Move down to the next cell with content.",shortcut:[{key:"ArrowDown",modifiers:[de.Ctrl]}]},Xe),new ae("selectContentfulDown",e,{label:"Select Down Contentful",description:"Extend selection down to the next cell with content.",shortcut:[{key:"ArrowDown",modifiers:[de.Ctrl,de.Shift]}]},ke),new ae("selectVisible",e,{label:"Select Visible",description:"Select visible cells only.",shortcut:{key:";",modifiers:[de.Alt]}},Pn),new ae("traverseSelectionPreviousRange",e,{label:"Traverse Previous Range",description:"Traverse the selection to the previous range.",shortcut:{key:"ArrowLeft",modifiers:[de.Ctrl,de.Alt]}},an),new ae("traverseSelectionNextRange",e,{label:"Traverse Next Range",description:"Traverse the selection to the next range.",shortcut:{key:"ArrowRight",modifiers:[de.Ctrl,de.Alt]}},zn),new ae("traverseSelectionCorners",e,{label:"Traverse Corners",description:"Traverse the selection through the corners of the selected range.",shortcut:{key:".",modifiers:[de.Ctrl]}},Ln)]},[]);return o.useMemo(()=>{n?.addCommands(Tt,!0)},[n]),{selection:ct,setSelectionCell:Ze,setSelectionRanges:dt,renderOverlay:St,cursor:Jt,onPointerDown:In,clearLastSelection:ue,newSelection:Ct,modifySelection:ut,appendSelection:be,clearSelections:Kt,isEntire:st,navigate:rt,navigateSelection:Vt}};function yn(t,n){if(!t)throw new Error("Invariant failed")}const Zn={"sheetxl-grid":"_sheetxl-grid_h9wwa_7"},Wo=Object.freeze({top:0,left:0}),Uo=Object.freeze({bottom:-4,right:-4}),Vo=Object.freeze({horizontal:!0,vertical:!0}),eo=[Qe.TopLeft,Qe.Top,Qe.Left,Qe.Center],Ht=3e3,Fn={},go=o.memo(o.forwardRef((t,n)=>{const{width:r,height:l,rowCount:d=1,columnCount:u=1,defaultRowHeight:s,defaultColumnWidth:i,getRowHeight:x,getColumnWidth:$,layout:z,onViewportScroll:k,onImmediateScroll:T,showGridLines:F=!0,gridLineColor:oe="rgb(224, 224, 224)",propsGridLineRows:ee,propsGridLineColumns:Z,clipCells:Oe=!0,cursor:ie,freezeLeft:R=0,freezeTop:G=0,propsFreezeLeft:me,propsFreezeTop:W,renderCell:xe,onViewportChange:Ae,onFirstRender:Ie,renderOverlay:je,propsOverlay:fe,renderOverlays:Y,propsOverlays:q,allowOverlaysOverflow:m=!1,propsStage:Ue,wrapperStage:Ke=null,hiddenRowsAt:J,hiddenColumnsAt:Se,hiddenCellAt:K,getVisibleCells:D,zoom:N=1,enableMouseWheel:It=!0,onWheelScroll:bt,getCellCoordsAsRangeCoords:ft=j.cellToRange,scrollPoint:at=Wo,style:he={},...Ft}=t;yn(xe),yn(!t?.children);const M=P(T,[T]),y=P(Ae,[Ae]),ye=P(k,[k]),re=P(bt,[bt]),ve=P(Ie,[Ie]),We=o.useRef(null),lt=o.useRef(null),yt=o.useRef(null),[it,Wt]=o.useReducer(h=>h+1,0),[ht,S]=o.useState({left:at?.left??0,top:at?.top??0,horizontalScrollDirection:null,verticalScrollDirection:null}),le=o.useRef(null),Le=o.useRef(ht),{top:dt,left:Je,verticalScrollDirection:Jt,horizontalScrollDirection:qt}=ht,Rt=o.useRef(!1),on=Io({rowCount:d,columnCount:u,defaultRowHeight:s,defaultColumnWidth:i,getRowHeight:x,getColumnWidth:$}),Nt=o.useRef(null),Re=o.useMemo(()=>{const h=z||on;return Nt.current=null,{getColOffset:v=>h.getColOffset(v)*N,getColIndex:v=>h.getColIndex(v/N),getRowOffset:v=>h.getRowOffset(v)*N,getRowIndex:v=>h.getRowIndex(v/N)}},[on,z,N]),At=(h,v,E)=>{const b=(v?.left??0)+0,C=(v?.top??0)+0;return{getColOffset:O=>h.getColOffset(O)-b,getColIndex:O=>h.getColIndex(O+b),getRowOffset:O=>h.getRowOffset(O)-C,getRowIndex:O=>h.getRowIndex(O+C)}},pt=P((h,v=!1)=>En(h,v,Re.getRowOffset,v?0:d),[d,Re?.getRowOffset]),Ot=P(J??pt,[J]),un=P((h,v=!1)=>En(h,v,Re.getColOffset,v?u:0),[u,Re?.getColOffset]),Qt=P(Se??un,[Se]),_e=o.useMemo(()=>Math.min(r??800,Re.getColOffset(u)),[Re.getColOffset,u,r]),Ve=o.useMemo(()=>Math.min(l??600,Re.getRowOffset(d)),[Re.getRowOffset,d,l]),Yt=o.useCallback(h=>{Bt.canUseDOM&&setTimeout(()=>{We.current?.focus({preventScroll:!0,...h})},0)},[]),mt=o.useCallback(h=>We.current?.contains(h)||lt.current?.contains(h),[]);o.useEffect(()=>{Rt.current&&(le.current&&le.current.left!==Le.current?.left&&le.current.top!==Le.current?.top||(le.current=null,ye?.({left:Je,top:dt})))},[Je,dt]);const Ut=P(()=>({top:dt,left:Je}),[dt,Je]),Ee=o.useMemo(()=>{const h=[];let v=0,E=0;typeof G=="number"?v=G:(v=G.index??0,E=(G.scrollOffset??0)*N);const b=E,C=Re.getRowOffset(v),O=C-b;if(v>0){const He=At(Re,{top:E+Re.getRowOffset(0)}),$e=Re.getRowIndex(b),Xe=Re.getRowIndex(C-1);let ke;h[1]={minIndex:$e,maxIndex:Xe,minCoord:0,maxCoord:v-1,minBounds:0,maxBounds:O,visibleIndices:()=>ke||(ke=Object.freeze(bn(Ot,$e,Xe)),ke),layout:He,maxVirtualBounds:C,scrollOffset:E,freezeOffset:E}}const ge=Math.max(0,Ve-O),se=At(Re,{top:dt+O}),pe=se.getRowIndex(0),U=se.getRowIndex(ge);let Ce;return h[0]={minIndex:pe,maxIndex:U,minCoord:v,maxCoord:d-1,minBounds:O,maxBounds:ge,visibleIndices:()=>Ce||(Ce=Object.freeze(bn(Ot,pe,U)),Ce),layout:se,maxVirtualBounds:Re.getRowOffset(d),scrollOffset:dt,freezeOffset:(v>0?Re.getRowOffset(v):0)-E},h},[Re.getRowIndex,Re.getRowOffset,Ot,Ve,d,G,dt,N]),Ye=o.useMemo(()=>{const h=[];let v=0,E=0;typeof R=="number"?v=R:(v=R.index??0,E=(R.scrollOffset??0)*N);const b=E,C=Re.getColOffset(v),O=C-b;if(v>0){const He=At(Re,{left:E+Re.getColOffset(0)}),$e=Re.getColIndex(b),Xe=Re.getColIndex(C-1);let ke;h[1]={minIndex:$e,maxIndex:Xe,minCoord:0,maxCoord:v-1,minBounds:0,maxBounds:O,visibleIndices:()=>ke||(ke=Object.freeze(bn(Qt,$e,Xe)),ke),layout:He,maxVirtualBounds:C,scrollOffset:E,freezeOffset:E}}const ge=Math.max(0,_e-O),se=At(Re,{left:Je+O}),pe=se.getColIndex(0),U=se.getColIndex(ge);let Ce;return h[0]={minIndex:pe,maxIndex:U,minCoord:v,maxCoord:u-1,minBounds:O,maxBounds:ge,visibleIndices:()=>Ce||(Ce=Object.freeze(bn(Qt,pe,U)),Ce),layout:se,maxVirtualBounds:Re.getColOffset(u),scrollOffset:Je,freezeOffset:(v>0?Re.getColOffset(v):0)-E},h},[Re.getColIndex,Re.getColOffset,Qt,_e,u,R,Je,N]),ut=o.useRef({}),Ct=o.useRef([]),be=o.useMemo(()=>{let h={};const v=(b,C,O,ge,se)=>{const pe={vertical:ge?.vertical||!1,horizontal:ge?.horizontal||!1};if(b>=Ye.length||C>=Ee.length)return null;const U={rowStart:Ee[C].minIndex,colStart:Ye[b].minIndex,rowEnd:Ee[C].maxIndex,colEnd:Ye[b].maxIndex};if(U.rowStart>U.rowEnd||U.colStart>U.colEnd)return null;const Ce={getColIndex:te=>Ye[b].layout.getColIndex(te),getColOffset:te=>Ye[b].layout.getColOffset(te),getRowIndex:te=>Ee[C].layout.getRowIndex(te),getRowOffset:te=>Ee[C].layout.getRowOffset(te)},He=Object.freeze({left:se?.left??0,top:se?.top??0,right:se?.right??0,bottom:se?.bottom??0}),$e=Object.freeze({x:Ye[b].minBounds,y:Ee[C].minBounds,width:Ye[b].maxBounds,height:Ee[C].maxBounds}),Xe=(te,qe)=>Jn(Ce,te??U,qe),ke={width:Ye[b].maxVirtualBounds,height:Ee[C].maxVirtualBounds},ue={left:Ye[b].scrollOffset,top:Ee[C].scrollOffset},st={left:Ye[b].freezeOffset,top:Ee[C].freezeOffset},Ze={width:_e,height:Ve};let Be=null,et=null;const vt=(st.top+(ge.vertical?ue.top:0))/N,Ne=(st.left+(ge.horizontal?ue.left:0))/N;return{getStage:()=>We.current??null,getVisibleRangeCoords:()=>U,toClipBounds:(te,qe)=>{let gt,Me=0;return qe===void 0||typeof qe=="number"?(gt=Xe(U),Me=qe):gt=qe,((tt,ze,Pe=0)=>{if(tt.x>ze.width||tt.y>ze.height)return null;const wt={left:tt.x,top:tt.y,bottom:tt.height+tt.y,right:tt.width+tt.x},ct={left:ze.x+Pe,top:ze.y+Pe,bottom:ze.height-2*Pe+ze.y,right:ze.width-2*Pe+ze.x},St={left:Math.max(wt.left,ct.left),top:Math.max(wt.top,ct.top),bottom:Math.min(wt.bottom,ct.bottom),right:Math.min(wt.right,ct.right)},Tt={x:St.left,y:St.top,width:St.right-St.left,height:St.bottom-St.top};return Tt.height<0||Tt.width<0?null:Tt})(te??{x:0,y:0,width:$e.width,height:$e.height},gt,Me)},toViewBounds:te=>Ne===0&&vt===0&&N===1?te:{x:(te.x-Ne)*N,y:(te.y-vt)*N,width:te.width*N,height:te.height*N},toAbsoluteBounds:te=>Ne===0&&vt===0&&N===1?te:{x:te.x/N+Ne,y:te.y/N+vt,width:te.width/N,height:te.height/N},getRelativePointFromClient:(te,qe)=>{const gt=Zt(te,qe);return{x:gt.x-$e.x,y:gt.y-$e.y}},getLayout:()=>Ce,getCellCoordsAsRangeCoords:ft,getVisibleColumns:()=>Ye[b].visibleIndices(),getVisibleRows:()=>Ee[C].visibleIndices(),getVisibleColumnOffsets:()=>(Be||(Be=Gn(Ye[b].layout,!0,Ye[b].visibleIndices(),U.colStart,U.colEnd)),Be),getVisibleRowOffsets:()=>(et||(et=Gn(Ee[C].layout,!1,Ee[C].visibleIndices(),U.rowStart,U.rowEnd)),et),getTotalRangeCoords:()=>({colStart:Ye[b].minCoord,colEnd:Ye[b].maxCoord,rowStart:Ee[C].minCoord,rowEnd:Ee[C].maxCoord}),getRangeCoordsBounds:Xe,scrollCellCoordsIntoView:(te,qe)=>rn(te,qe,O),getCellCoordsFromClient:(te,qe,gt=!1)=>{const Me=Zt(te,qe);if(!Me)return null;const tt=Ce.getColIndex(Me.x-$e.x),ze={rowIndex:Ce.getRowIndex(Me.y-$e.y),colIndex:tt};if(gt)return ze;const Pe=ft(ze);return{rowIndex:Pe.rowStart,colIndex:Pe.colStart}},getZoom:()=>N,getAnchor:()=>O,getBounds:()=>$e,getInsets:()=>He,getTotalSize:()=>ke,getViewportSize:()=>Ze,getScrollTopLeft:()=>ue,getFreezeTopLeft:()=>st,getScrollOrientation:()=>pe,allViews:()=>h}};let E=h[Qe.Center]=v(0,0,Qe.Center,Vo,Uo);return E&&(h[Qe.Center]=E),E=v(0,1,Qe.Top,{horizontal:!0}),E&&(h[Qe.Top]=E),E=v(1,0,Qe.Left,{vertical:!0}),E&&(h[Qe.Left]=E),E=v(1,1,Qe.TopLeft,{}),E&&(h[Qe.TopLeft]=E),ut.current=null,h=Object.freeze(h)},[Ee,Ye,ft]),Kt=Object.keys(be),Pt=Ye[0]?.maxVirtualBounds??0,ot=Ee[0]?.maxVirtualBounds??0,Et=o.useMemo(()=>({left:Ye[1]?Ye[1].layout.getColOffset(Ye[1].maxIndex+1):0,top:Ee[1]?Ee[1].layout.getRowOffset(Ee[1].maxIndex+1):0}),[be]);o.useEffect(()=>{if(Ct.current.length>0){for(let h=0;h<Ct.current.length;h++)Ct.current[h]();Ct.current=[]}},[be]);const kt=P(()=>({containerWidth:_e,containerHeight:Ve,totalWidth:Pt,totalHeight:ot}),[_e,Ve,Re]);o.useEffect(()=>{!le.current&&Rt.current&&y({top:dt,left:Je,width:_e,height:Ve,totalWidth:Pt,totalHeight:ot})},[dt,Je,Pt,ot]),o.useEffect(()=>{Rt.current&&y({top:dt,left:Je,width:_e,height:Ve,totalWidth:Pt,totalHeight:ot})},[_e,Ve]);const Zt=o.useCallback((h,v)=>{yn(typeof h=="number"&&typeof v=="number");const E=We.current?.getBoundingClientRect();return E?{x:h-E.x,y:v-E.y}:{x:h,y:v}},[]),In=P(h=>be[h]||null,[be]),Rn=P((h,v)=>{if(Object.keys(be).length===1)return be[Qe.Center];const E=Zt(h,v);if(!E)return null;const{x:b,y:C}=E;let O=null;const ge=eo,se=ge.length;for(let pe=0;!O&&pe<se;pe++){const U=be[ge[pe]];U&&Lo(b,C,U.getBounds())&&(O=U)}return O||(O=be[Qe.Center]),O},[be,ft]),rt=P(()=>be[Qe.Center].getVisibleRangeCoords(),[be[Qe.Center]]),Vt=o.useRef(null),kn=o.useCallback(()=>{Vt.current!==null&&Bt.cancelTimeout(Vt.current),Vt.current=Bt.requestTimeout(Mn,150)},[]),Mn=o.useCallback(()=>{Vt.current=null,S(h=>{const v={...h,verticalScrollDirection:null,horizontalScrollDirection:null};return Le.current=v,v})},[]),_t=P(h=>{const v=h?.left??h?.[0],E=h?.top??h?.[1];let b=Le.current.left;v!==void 0&&v!==b&&(v>b?(b=Math.max(Ye?.[1]?.scrollOffset??0,v),b=Math.min(Pt-_e,b)):b=Math.max(Ye?.[1]?.scrollOffset??0,v));let C=Le.current.top;if(E!==void 0&&E!==C&&(E>C?(C=Math.max(Ee?.[1]?.scrollOffset??0,E),C=Math.min(ot-Ve,C)):C=Math.max(Ee?.[1]?.scrollOffset??0,E)),Le.current.left===b&&Le.current.top===C)return;let O=null,ge=null;Le.current.left>b?O=w.Left:Le.current.left<b&&(O=w.Right),Le.current.top>C?ge=w.Up:Le.current.top<C&&(ge=w.Down),Bt.throttle(()=>{S(se=>{const pe={...se,left:b,top:C,horizontalScrollDirection:O,verticalScrollDirection:ge};return Le.current=pe,pe})},17)(),le.current?.top===C&&le.current?.left===b||(le.current={left:b,top:C},M({left:b,top:C}),y({left:b,top:C,width:_e,height:Ve,totalWidth:Pt,totalHeight:ot})),kn()},[Pt,ot,Ee,Ye]);o.useEffect(()=>{le.current||_t({left:Je,top:dt})},[_e,Ve]),o.useEffect(()=>{let h,v,E=!1;Le.current.left>Pt&&(h=0,E=!0),Le.current.top>ot&&(v=0,E=!0),E&&_t({left:h,top:v})},[Pt,ot]),o.useLayoutEffect(()=>{le.current={left:at?.left,top:at?.top},_t(le.current)},[at?.left,at?.top]);const fn=P(h=>{let v=h?.left??h?.[0],E=h?.top??h?.[1];if(v===void 0&&E===void 0)return;const b=h?.behavior??"auto";v!==void 0&&(v=Le.current.left+(v??0)),E!==void 0&&(E=Le.current.top+(E??0)),!(Le.current.left===v&&Le.current.top===E)&&_t({left:v,top:E,behavior:b})},[]),hn=o.useCallback(h=>{let v=null;if(Object.keys(be).length>1){const E=eo,b=E.length;for(let C=0;!v&&C<b;C++){const O=be[E[C]];O&&j.isCellWithinRange(h,O.getVisibleRangeCoords())&&(v=O)}}return v||(v=be[Qe.Center]),v},[be]),rn=P((h,v={inline:"nearest",block:"nearest"},E=null)=>{const b={rowIndex:0,colIndex:0,...h};let C=null;if(E!==null){if(C=be[E],C===null)return new Promise((Ze,Be)=>{Be("Invalid view")})}else C=hn(b);const O=ft(b),ge=C.getLayout(),se=ge.getColOffset(O.colStart),pe=ge.getRowOffset(O.rowStart),U=ge.getColOffset(O.colEnd+1),Ce=ge.getRowOffset(O.rowEnd+1),He=C.getBounds(),$e=C.getTotalSize(),Xe=C.getScrollTopLeft(),ke=((Ze,Be,et=!0)=>{et=et===!0?{block:"start",inline:"end"}:et===!1?{block:"end",inline:"end"}:{block:"end",inline:"end",...et};const vt=_n(et.inline,Ze.x,Ze.x+Ze.width,Be.left,Be.left+Be.width,Be.totalWidth),Ne=_n(et.block,Ze.y,Ze.y+Ze.height,Be.top,Be.top+Be.height,Be.totalHeight);if(vt!==void 0||Ne!==void 0)return{left:vt,top:Ne}})({x:se+Xe.left,y:pe+Xe.top,width:U-se,height:Ce-pe},{left:Xe.left,top:Xe.top,width:He.width,height:He.height,totalWidth:$e.width,totalHeight:$e.height},v);if(!ke)return Promise.resolve({...Xe});const ue={...ke};ue.left>Je?ue.left+=20:ue.left<Je&&(ue.left-=0),ue.top>dt?ue.top+=20:ue.top<dt&&(ue.top-=0);const st=C.getScrollOrientation();return st.horizontal&&h.colIndex!==void 0||delete ue.left,st.vertical&&h.rowIndex!==void 0||delete ue.top,new Promise((Ze,Be)=>{try{_t(ue),Ze(ue)}catch(et){Be(et)}})},[Pt,ot,be,ft]),en=P(h=>{const v=h.shiftKey;h.preventDefault();const{deltaX:E,deltaY:b,deltaMode:C}=h;if(yt.current||re?.(h)===!1)return;let O=v?b:E,ge=b;const se=v||Math.abs(O)>Math.abs(ge);C===1&&(ge*=0),yt.current=window.requestAnimationFrame(()=>{yt.current=null,fn(se?{left:O}:{top:ge})})},[re]),ln=o.useCallback((h=null)=>{Nt.current=null,ut.current=null,Wt()},[]);o.useLayoutEffect(()=>{ln()},[xe]);const Xt=ro(n,()=>({stage:We.current,focus:Yt,contains:mt,invalidate:ln,scrollTo:_t,scrollBy:fn,scrollCellCoordsIntoView:rn,getScrollPosition:Ut,getDimensions:kt,getViewport:rt,handleWheel:en,rowCount:d,columnCount:u,getLayout:()=>Re,getRelativePointFromClient:Zt,getViewFromClient:Rn,getViewFromCellCoords:hn,getViewFromLocation:In,onViewChangeOnce:h=>{Ct.current.push(h)}}),[d,u,be]);o.useEffect(()=>(It&&Xt.current?.addEventListener("wheel",en,{passive:!1}),Rt.current=!0,le.current=null,()=>{Xt.current?.removeEventListener("wheel",en)}),[It]);const sn=o.useRef([]),Pn=(h,v)=>{!h||!je||(sn.current=[],v.push(((E,b)=>{const C=`view:${E.getAnchor()}:overlay:${v.length}`,O=je({key:C,view:E,ref:se=>sn.current[b]=se});if(!O)return null;const ge=E.getBounds();return ne.jsx("div",{style:{position:"absolute",left:"0px",top:"0px",width:`${ge.width}px`,height:`${ge.height}px`,overflow:"hidden"},children:O},`overlay-${E.getAnchor()}-${b}`)})(h,0)))},Tn=o.useMemo(()=>{const h={},v=Object.keys(be),E=v.length;for(let b=0;b<E;b++){const C=v[b],O=[];Pn(be[C],O),h[C]={overlays:O}}return h},[it,je,d,u,Ee,Ye]),gn=(h,v,E,b,C,O,ge)=>{if(!h)return;const se=h.getVisibleColumns(),pe=h.getVisibleRows();if(se.length===0||pe.length===0)return;let U=null;if(D)U=D(h);else{U=[];const Me=pe.length,tt=se.length;for(let ze=0;ze<Me;ze++){const Pe=pe[ze];for(let wt=0;wt<tt;wt++){const ct={rowIndex:Pe,colIndex:se[wt]};if(K?.(ct))continue;const St={coords:ct,range:ft(ct)};U.push(St)}}}const Ce=h.getVisibleColumnOffsets(),He=h.getVisibleRowOffsets(),$e=h.getScrollTopLeft(),Xe=h.getFreezeTopLeft(),ke=$e.left+Xe.left,ue=$e.top+Xe.top,st=Math.trunc(ke/Ht),Ze=Math.trunc(ue/Ht),Be={},et=(Me,tt,ze,Pe,wt)=>{const ct=`view:${Me.getAnchor()}:cell:${Kn(tt.rowIndex,tt.colIndex)}`,St=Pe.x,Tt=Pe.y,e=Math.trunc((ke+St)/Ht)-st,a=Math.trunc((ue+Tt)/Ht)-Ze;Be[a]||(Be[a]={});let f=Be[a][e];f||(f=Be[a][e]=[]);let c=O?.get(ct);if(!c){const g=(ke+St)%Ht,I=(ue+Tt)%Ht;c=xe({key:ct,coords:tt,bounds:Pe,zoom:N,range:ze,view:Me,value:wt,style:{left:_.boundPixel(g),top:_.boundPixel(I),width:_.boundPixel(Pe.width,!0),height:_.boundPixel(Pe.height,!0)}})}ge?.set(ct,c),f.push(c)},vt=U.length;for(let Me=0;U&&Me<vt;Me++){const tt=U[Me],ze=tt?.coords??tt;if(!ze)continue;const Pe=tt?.range??{rowStart:ze.rowIndex,colStart:ze.colIndex,rowEnd:ze.rowIndex,colEnd:ze.colIndex},wt=h.getVisibleRangeCoords();if(!j.isRangesIntersect(Pe,wt)&&!j.isRangeWithinRange(Pe,wt))continue;const ct=Pe&&!j.isSingleCell(Pe);if(!ct&&K?.(ze))continue;const St=ze.rowIndex,Tt=ze.colIndex,e=He[St],a=Ce[Tt];let f=null;e&&a&&(f={x:a.offset,y:e.offset,width:a.size,height:e.size});const c=Kn(Pe.rowStart,Pe.colStart);if(ct){if(C.has(c))continue;C.add(c),Pe.rowEnd-Pe.rowStart>0&&E.push(Pe),Pe.colEnd-Pe.colStart>0&&b.push(Pe)}if(ct&&(f=Jn(h.getLayout(),Pe)),!f){console.warn("no bounds for cell",c);continue}const g=tt?.value;et(h,ze,Pe,f,g)}const Ne=ke%Ht,te=ue%Ht,qe=Object.keys(Be),gt=qe.length;for(let Me=0;Me<gt;Me++){const tt=qe[Me],ze=Be[tt];if(!ze)continue;const Pe=Object.keys(ze),wt=Pe.length;for(let ct=0;ct<wt;ct++){const St=Pe[ct],Tt=ze[St];if(!Tt)continue;const e=parseInt(tt),a=parseInt(St),f=e+Ze,c=a+st,g=`view:${h.getAnchor()}:segment:${c}:${f}`;v.push(ne.jsx("div",{className:"cell-container",style:{transform:`translate(${_.boundPixel(a*Ht-Ne,!0)}px, ${_.boundPixel(e*Ht-te,!0)}px)`,willChange:"transform"},children:Tt},g))}}},zt=o.useMemo(()=>{const h=Nt.current,v=new Map,E={},b=Object.keys(be),C=b.length;for(let O=0;O<C;O++){const ge=b[O],se=[],pe=[],U=[];gn(be[ge],U,se,pe,new Set,h,v),E[ge]={cells:U,rangesH:se,rangesV:pe}}return Nt.current=v,E},[it,d,u,Ee,Ye,F,he,Oe,K,D,Se,J,ft]),wn=(h,v,E,b,C)=>{if(!h)return;const O=h.getLayout(),ge=window.devicePixelRatio||1,se=String(1/ge);if(v){const pe=`view:${h.getAnchor()}:hl:`,U=h.getVisibleRows();if((U?U.length:0)===0)return;const Ce=C.sort(j.rowFirstRangeComparator),He=h.getVisibleRangeCoords(),$e=0,Xe=Math.min(h.getBounds().width,O.getColOffset(He.colEnd+1));let ke=[];for(let ue=0;ue<U.length&&U[ue]<=He.rowEnd;ue++){const st=U[ue];if(st<He.rowStart)continue;let Ze=!1;for(;Ce.length>0&&Ce[0].rowStart<=st;){const Ne=Ce.shift();Ne.rowEnd>st&&(ke.push(Ne),Ze=!0)}Ze&&(ke=ke.sort(j.columnFirstRangeComparator));const Be=O.getRowOffset(st+1);let et=$e;const vt=ke.length;for(let Ne=0;Ne<vt+1;Ne++){let te=et,qe=Xe;const gt=ke[Ne];Ne<vt&&(qe=Math.min(Xe,O.getColOffset(gt.colStart)),et=Math.min(Xe,O.getColOffset(gt.colEnd+1))),b.push(o.createElement("path",{d:`M ${_.boundPixel(te)} ${_.boundPixel(Be,!1,E)} L ${_.boundPixel(qe)} ${_.boundPixel(Be,!1,E)}`,stroke:oe,strokeWidth:se,vectorEffect:"non-scaling-stroke",...ee,key:pe+st+":"+Ne}))}for(let Ne=vt-1;Ne>=0;Ne--)ke[Ne].rowEnd<=U[ue+1]&&ke.splice(Ne,1)}}else{const pe=`view:${h.getAnchor()}:vl:`,U=h.getVisibleColumns(),Ce=U?U.length:0;if(Ce===0)return;const He=C.sort(j.columnFirstRangeComparator),$e=h.getVisibleRangeCoords(),Xe=0,ke=Math.min(h.getBounds().height,O.getRowOffset($e.rowEnd+1));let ue=[];for(let st=0;st<Ce&&U[st]<=$e.colEnd;st++){const Ze=U[st];if(Ze<$e.colStart)continue;let Be=!1;for(;He.length>0&&He[0].colStart<=Ze;){const te=He.shift();te.colEnd>Ze&&(ue.push(te),Be=!0)}Be&&(ue=ue.sort(j.rowFirstRangeComparator));const et=O.getColOffset(Ze+1);let vt=Xe;const Ne=ue.length;for(let te=0;te<Ne+1;te++){let qe=vt,gt=ke;const Me=ue[te];te<Ne&&(gt=Math.min(ke,O.getRowOffset(Me.rowStart)),vt=Math.min(ke,O.getRowOffset(Me.rowEnd+1))),b.push(ne.jsx("path",{d:`M ${_.boundPixel(et,!1,E)} ${_.boundPixel(qe)} L ${_.boundPixel(et,!1,E)} ${_.boundPixel(gt)}`,stroke:oe,strokeWidth:se,vectorEffect:"non-scaling-stroke",...Z},pe+Ze+":"+te))}for(let te=Ne-1;te>=0;te--)ue[te].colEnd<=U[st+1]&&ue.splice(te,1)}}},cn=h=>{if(!zt)return;const v={},E=Kt.length;for(let b=0;b<E;b++){const C=Kt[b],O=be[C],ge=[];wn(O,h,0,ge,h?zt[C].rangesH:zt[C].rangesV);const se=O.getRangeCoordsBounds(),pe=Math.ceil(se.width),U=Math.ceil(se.height);v[C]=ne.jsx("svg",{width:`${pe}`,height:`${U}`,viewBox:`0 0 ${pe} ${U}`,preserveAspectRatio:"none",shapeRendering:"crispEdges",style:{position:"absolute"},children:ge})}return v},xn=o.useMemo(()=>F===!0||F?.horizontal===!0?cn(!0):null,[it,F,Ee,G,R,oe,ee,d,u,_e,Pt,be,zt]),pn=o.useMemo(()=>F===!0||F?.vertical===!0?cn(!1):null,[it,F,Ye,G,R,oe,Z,d,u,Ve,ot,be,zt]),Dn=o.useMemo(()=>Et.left===0?null:ne.jsx(Qn,{linePoints:[0,0,0,Ve+1],bounds:{x:Et.left,y:0,width:1,height:Ve+1},...me}),[it,Et.left,Ve,me]),On=o.useMemo(()=>Et.top===0?null:ne.jsx(Qn,{linePoints:[0,0,_e+1,0],bounds:{x:0,y:Et.top,width:_e+1,height:1},...W}),[it,Et.top,_e,W]),an=o.useMemo(()=>{const h=[],v=b=>{if(!b||!be[b])return;const C=be[b].getBounds();return ne.jsxs("div",{style:{position:"absolute",pointerEvents:"none",left:C.x,top:C.y,width:C.width,height:C.height,clip:`rect(0, ${C.width+1}px, ${C.height+1}px, 0)`},className:`view view-${b}`,children:[xn?.[b],pn?.[b],zt?.[b].cells]},`view:${b}`)},E=Kt.length;for(let b=0;b<E;b++)h.push(v(Kt[b]));return ne.jsx(ne.Fragment,{children:h})},[be,xn,pn,zt]),zn=o.useMemo(()=>{if(!n)return;const h=(se,pe,U,Ce)=>{if(!Ce||Ce.length===0)return;const He=[],$e=Ce.length;for(let Xe=0;Xe<$e;Xe++){const ke=Ce[Xe];let ue=se?.get(ke);ue!==Fn&&(ue=ke(U)??Fn),pe.set(ke,ue),ue&&ue!==Fn&&He.push(ue)}return He},v=(se,pe,U)=>{if(!U)return;const Ce=U.getBounds(),He=U.getInsets(),$e=U.getAnchor();return ne.jsxs("div",{className:Gt("view",`view-${$e}`,Zn.view),style:{position:"absolute",pointerEvents:"none",left:Ce.x-He.left,top:Ce.y-He.top,width:Ce.width-(He.left+He.right),height:Ce.height-(He.top+He.bottom),clipPath:m?"inset(-2px)":"inset(0px)"},children:[h(se,pe,U,Y),Tn?.[$e].overlays]},`view:${$e}`)},E=ut.current,b={},C=[],O=Object.keys(be),ge=O.length;for(let se=0;se<ge;se++){const pe=O[se],U=E?.[pe],Ce=b[pe]=new Map;C.push(v(U,Ce,be[pe]))}return ut.current=b,C},[it,be,m,Y]),Ln=o.useMemo(()=>{const{style:h,...v}=Ue??Bt.EmptyObject;return ne.jsx("div",{style:{width:_e,height:Ve,...h},className:"sheetxl-stage",tabIndex:0,ref:We,...v,...Ft,children:Ke?Ke(an):an})},[_e,Ve,an,Ue,Ke]),mn=o.useRef(!1);return o.useEffect(()=>{!mn.current&&zt&&(mn.current=!0,ve?.(Xt.current))},[zt]),ne.jsxs("div",{className:Gt("sheetxl-grid",Zn["sheetxl-grid"]),style:{overflow:"visible",cursor:ie,maxWidth:_e,maxHeight:Ve,width:_e,height:Ve,...he},ref:Xt,children:[Ln,ne.jsxs("div",{className:Gt("sheetxl-overlays"),ref:lt,...q,children:[zn,Dn,On]})]})}));go.displayName="BaseGrid";var Ho=function(){},wo=typeof window<"u",No=wo?o.useLayoutEffect:o.useEffect,to={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};const qo=wo&&window.ResizeObserver!==void 0?function(){var t=o.useState(null),n=t[0],r=t[1],l=o.useState(to),d=l[0],u=l[1],s=o.useMemo(function(){return new window.ResizeObserver(function(i){if(i[0]){var x=i[0].contentRect,$=x.x,z=x.y,k=x.width,T=x.height,F=x.top,oe=x.left,ee=x.bottom,Z=x.right;u({x:$,y:z,width:k,height:T,top:F,left:oe,bottom:ee,right:Z})}})},[]);return No(function(){if(n)return s.observe(n),function(){s.disconnect()}},[n]),[r,d]}:function(){return[Ho,to]},xo=o.memo(o.forwardRef((t,n)=>{const{width:r,height:l,style:d={},className:u,...s}=t,[i,{width:x,height:$}]=qo();return ne.jsx("div",{className:u,style:{...d},children:ne.jsx("div",{style:{position:"relative",top:"0px",left:"0px",width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",boxSizing:"content-box"},ref:i,children:ne.jsx(go,{ref:n,width:r??x,height:l??$,...s})})})}));xo.displayName="Grid";const Ko=o.memo(o.forwardRef((t,n)=>{const{showVerticalScrollbar:r,showHorizontalScrollbar:l,renderScrollbarHorizontal:d,renderScrollbarVertical:u,createScrollCorner:s,viewport:i,onScrollViewport:x,style:$={},className:z,onScroll:k,...T}=t,[F,oe]=o.useState(null),ee=o.useRef(null),Z=o.useRef(null);yn(!i);const Oe=fo([Z,n]),ie=o.useCallback(R=>{Z.current?.scrollTo(R),x?.(R)},[]);return ne.jsx(bo,{className:z,style:$,ref:ee,showVerticalScrollbar:r,showHorizontalScrollbar:l,renderScrollbarHorizontal:d,renderScrollbarVertical:u,createScrollCorner:s,viewport:F,onScrollViewport:ie,children:ne.jsx(xo,{style:{width:"100%",height:"100%"},...T,onViewportChange:R=>oe(R),ref:Oe})})}));Ko.displayName="ScrollableGrid";const no=()=>!1,_o=o.memo(t=>{const{index:n,value:r,zoom:l,zoomScale:d=100,headerText:u=Y=>`${Y}`,headerStyle:s,headerStyleSelect:i=s,headerStyleSelectAll:x=i,headerStyleHover:$=x,verticalPadding:z=0,horizontalPadding:k=0,isSelected:T=no,isSelectedAll:F=no,coords:oe,bounds:ee,range:Z,orientation:Oe,view:ie,style:R,...G}=t,me=d/100,W=o.useRef(null),[xe,Ae]=o.useState(!1),Ie=T?.(n)||!1,je=F?.(n)?x:Ie?i:s;let fe=je;if(xe){let Y=$;typeof $=="function"&&(Y=$(je)),fe=Bt.mergeContentful(je,Y)}return ne.jsx("div",{ref:W,style:{background:fe.fill,color:fe.text?.fill,fontFamily:fe.text?.fontFamily??s.text?.fontFamily,fontSize:96*(fe.text?.fontSize??11)/72*me,fontStyle:fe.text?.fontStyle,fontWeight:fe.text?.fontWeight,lineHeight:1.2,display:"flex",justifyContent:"center",alignItems:"end",pointerEvents:"auto",paddingBottom:`${me}px`,...R,left:R.left-(Oe===jt.Column?1:0),top:R.top-(Oe===jt.Row?1:0),width:R.width+1,height:R.height+1,overflow:"hidden"},...G,onMouseMove:Y=>{_.detectIt().primaryInput!=="touch"&&Y.buttons===0&&Ae(!0)},onMouseOut:Y=>{Ae(!1)},children:u(n)})});_o.displayName="HeaderRenderer";const po="ew-resize",mo="ns-resize",Yo=o.memo(o.forwardRef((t,n)=>{const{orientation:r,view:l,index:d,className:u,style:s,disabled:i=!1,disabledResize:x=!1,isNextHidden:$,isHidden:z,isSelected:k,isSelectedAll:T,showTouchDivider:F,headerStyle:oe,headerStyleSelect:ee,headerStyleSelectAll:Z,headerStyleHover:Oe,bounds:ie,onPointerDown:R,onAutoFit:G,...me}=t,W=r===jt.Column;let xe=oe;k&&ee&&(xe=ee),T&&Z&&(xe=Z);const Ae=_.detectIt().primaryInput==="touch";let Ie=W?14:8,je=Ie/2,fe=0;$&&(fe=-2),z&&(fe=2),z&&(Ie=Ie/2+fe,je=2*fe);let Y=xe.dividerStrokeFill??xe.strokeFill;return!(k||T)&&fe===0&&(Y=`linear-gradient(${W?180:90}deg, ${xe.fill}, ${Y} 55%, ${Y} 100%)`),ne.jsxs("div",{className:Gt("header-divider",{disabled:i},u,`index-${d}`),ref:n,onPointerDown:Ae?void 0:R,onDoubleClick:Ae?void 0:()=>G?.(),style:{top:(W?0:-Ie/2+(fe-1))+"px",left:(W?-Ie/2+(fe-1):0)+"px",width:W?Ie:"calc(100% + 1px)",height:W?"calc(100% + 1px)":Ie,position:"absolute",overflow:"visible",pointerEvents:"all",cursor:i||x||Ae?void 0:W?po:mo,...s},...me,children:[ne.jsx("div",{style:{position:"relative",top:`${W?0:je}px`,left:`${W?je:0}px`,width:W?1:"100%",height:W?"100%":1,background:Y},onDoubleClick:()=>G?.()}),F&&Ae?ne.jsx("div",{style:{position:"absolute",cursor:"grab",zIndex:1,borderRadius:"4px",right:W?"-6px":"2px",bottom:W?"2px":"-9px",height:"24px",width:W?"24px":"18px",maxHeight:W?"calc(100% - 4px)":void 0,maxWidth:W?void 0:"calc(100% - 4px)",background:xe.fill,border:`${Z.edgeStrokeFill} solid 1px`,boxShadow:`0.5px 0.5px 0px 0px ${oe.text.fill}`,display:"flex",alignItems:"center",justifyContent:"center"},onPointerDown:R,children:ne.jsx("div",{style:{width:"6.4px",height:"12px",backgroundImage:`url("data:image/svg+xml,%3Csvg width='6.4' height='12' viewBox='0 0 9.6 16' version='1.1' fill='${encodeURIComponent(ee.text.fill)}' xmlns='http://www.w3.org/2000/svg' xmlns:svg='http://www.w3.org/2000/svg'%3E%3Cpath d='M 9.60008,14.40009 C 9.60008,15.28374 8.88368,16 8.00003,16 7.11639,16 6.40012,15.28374 6.40012,14.40009 c 0,-0.88365 0.71627,-1.60005 1.59991,-1.60005 0.88365,0 1.60005,0.7164 1.60005,1.60005 m 0,-6.40012 c 0,0.88364 -0.7164,1.60004 -1.60005,1.60004 -0.88364,0 -1.59991,-0.7164 -1.59991,-1.60004 0,-0.88365 0.71627,-1.60005 1.59991,-1.60005 0.88365,0 1.60005,0.7164 1.60005,1.60005 m 0,-6.40006 c 0,0.88365 -0.7164,1.60005 -1.60005,1.60005 -0.88364,0 -1.59991,-0.7164 -1.59991,-1.60005 C 6.40012,0.71626 7.11639,0 8.00003,0 8.88368,0 9.60008,0.71626 9.60008,1.59991 M 3.19996,14.40009 C 3.19996,15.28374 2.48369,16 1.60005,16 0.7164,16 0,15.28374 0,14.40009 c 0,-0.88365 0.7164,-1.60005 1.60005,-1.60005 0.88364,0 1.59991,0.7164 1.59991,1.60005 m 0,-6.40012 c 0,0.88364 -0.71627,1.60004 -1.59991,1.60004 C 0.7164,9.60001 0,8.88361 0,7.99997 0,7.11632 0.7164,6.39992 1.60005,6.39992 c 0.88364,0 1.59991,0.7164 1.59991,1.60005 m 0,-6.40006 c 0,0.88365 -0.71627,1.60005 -1.59991,1.60005 C 0.7164,3.19996 0,2.48356 0,1.59991 0,0.71626 0.7164,0 1.60005,0 2.48369,0 3.19996,0.71626 3.19996,1.59991' /%3E%3C/svg%3E%0A")`,backgroundRepeat:"no-repeat",backgroundPosition:"center",transform:W?void 0:"rotate(90deg)"}})}):null]})})),Xo=t=>ne.jsx(Yo,{...t}),lr=o.memo(o.forwardRef((t,n)=>{const{orientation:r,view:l,index:d,disabled:u=!1,disabledResize:s=!1,resizeThreshold:i=1,renderDivider:x=Xo,onDividerMouseDown:$,onDividerResizeStart:z,onDividerResize:k,onDividerResizeEnd:T,onDividerMouseUp:F,onDividerAutoFit:oe,onPointerDown:ee,...Z}=t,Oe=P(ee,[ee]),ie=P(oe,[oe]),R=r===jt.Column;let G=R?l.getVisibleColumns():l.getVisibleRows(),me=null;G.length>0&&(R?me=l.getRangeCoordsBounds({rowStart:0,rowEnd:0,colStart:G[0],colEnd:G[G.length-1]}):l.getRangeCoordsBounds({rowStart:G[0],rowEnd:G[G.length-1],colStart:0,colEnd:0}),me=l.toClipBounds(me,$t));const W=o.useRef(null),[xe,Ae]=o.useState(null),Ie=(J,Se)=>R?J.clientX-Se.clientX:J.clientY-Se.clientY,je=l.getLayout(),fe=R?je.getColOffset(d+1):je.getRowOffset(d+1),Y=nn({processTouch:!0,onPointerDown:J=>{if(Oe?.(J),!u&&!s){const Se=R?je.getColOffset(d):je.getRowOffset(d),K=fe-Se;W.current={isResizing:!1,startSize:K,index:d,view:l,orientation:r,onDividerMouseDown:$,onDividerResizeStart:z,onDividerResize:k,onDividerResizeEnd:T,onDividerMouseUp:F},Ae(W.current),$?.(d,K)}J.stopPropagation(),J.preventDefault()},onPointerUp:(J,Se,K)=>{if(!W.current)return;W.current.isResizing&&W.current.onDividerResizeEnd?.(W.current.index,Math.max(0,W.current.startSize+Ie(J,K)),W.current.startSize);const D=W.current;W.current=null,Ae(W.current),D.onDividerMouseUp?.(D.index)},onPointerMoveOrWait:(J,Se,K)=>{if(!W.current)return;const D=Ie(J,K);W.current.isResizing?W.current.onDividerResize?.(W.current.index,Math.max(0,W.current.startSize+D),W.current.startSize):Math.abs(D)>Math.max(1,i)&&(W.current={...W.current,isResizing:!0},Ae(W.current),W.current.onDividerResizeStart?.(W.current.index,Math.max(0,W.current.startSize+D))),J.stopPropagation(),J.preventDefault()}}),q=P(()=>{ie?.(d)},[d]);if(!me)return;const m=x({bounds:me,orientation:r,view:l,index:d,disabled:u,disabledResize:s,onAutoFit:q,onPointerDown:Y,ref:n,...Z});if(!m)return;const{getPortalContainer:Ue}=lo();let Ke=null;return xe&&xe.isResizing&&xe.index===d&&(Ke=oo.createPortal(ne.jsx("div",{style:{position:"absolute",cursor:R?po:mo,left:0,top:0,width:"100%",height:"100%"}}),Ue(),"divider:"+d)),ne.jsxs(ne.Fragment,{children:[Ke,ne.jsx("div",{className:Gt("header-divider-anchor"),style:{position:"absolute",pointerEvents:"auto",top:`${R?me.y:fe}px`,left:`${R?fe:me.x}px`,width:(R?0:me.width-1)+"px",height:(R?me.height-1:0)+"px",display:"flex"},tabIndex:-1,children:m})]})}));class Go{naturalDimensions(n,r={}){const l=document.createElement("div");let d=r?.lineHeight??"1";!r?.lineHeight&&r.paintableText?.fontSize&&(d=Math.ceil(1.2*r.paintableText.fontSize)+"px");const u=document.createElement("div");u.style.visibility="hidden",u.style.position="absolute",u.style.textRendering="geometricprecision",u.style.display="inline-grid",u.style.overflowWrap="break-word",u.style.maxWidth=r.maxWidth?r.maxWidth+"px":"100%",u.style.lineHeight=d,u.style.letterSpacing=(r.paintableText?.letterSpacing??0)+"px",u.style.fontSize=r.paintableText?.fontSize?r.paintableText.fontSize+"px":"unset",u.style.fontFamily=r.paintableText?.fontSize?r.paintableText.fontFamily:"unset",u.style.fontWeight=r.paintableText?.fontWeight?""+r.paintableText.fontWeight:"400",u.style.fontStyle=r.paintableText?.fontStyle?r.paintableText.fontStyle:"normal",u.style.whiteSpace=r.paintableText?.wrap==="wrap"?"break-spaces":"pre",l.appendChild(u);const s=n.split(`
`);for(let x=0;x<s.length;x++){let $=document.createElement("span");u.appendChild($),$.textContent=s[x]}s.length!==0&&s[s.length-1].length!==0||u.appendChild(document.createElement("br")),document.body.appendChild(u);let i=u.getBoundingClientRect();return u.remove(),{width:i.width,height:i.height,maxLineHeight:1.2*(r.paintableText?.fontSize||1056/72)}}}const Jo=(t=void 0)=>Object.freeze({clean:t,dirty:void 0,editMode:!1}),Qo=Jo(),ir=o.memo(o.forwardRef((t,n)=>{const{editState:r=Qo,defaultTextStyle:l,onStartEdit:d,onChangeEdit:u,onSubmitEdit:s,onCancelEdit:i,onDoneEdit:x,containerBounds:$,setNaturalSize:z,onNavigate:k,textProperties:T,style:F,autoFocus:oe,...ee}=t,Z=o.useRef(null),{width:Oe=0}=$??{},[ie,R]=o.useState(()=>r);o.useEffect(()=>{R(r)},[r]);const G=T?.align||"left",me=T?.vAlign||"middle",W=T?.fill||"#040404",xe=T?.wrap||"wrap",Ae=T?.fontFamily||"Calibri",Ie=T?.fontSize||11,je=T?.fontWeight||400,fe=T?.fontStyle||"normal",Y=ie.dirty??ie.clean??"";let q=2;const m=96*Ie/72,Ue=1.2*m;me==="right"&&(q+=1);const Ke=o.useMemo(()=>new Go().naturalDimensions(Y,{maxWidth:xe==="wrap"?Oe-q:void 0,lineHeight:`${Ue}px`,paintableText:{fontStyle:fe,wrap:xe,letterSpacing:-.25}}),[Y,xe,q,m,Ae,je,fe,z,Oe]),J=o.useCallback(()=>Ke.maxLineHeight?Ke.maxLineHeight+"px":"1.2",[Ke]),[Se,K]=o.useState(J);o.useLayoutEffect(()=>{K(J())},[$,Ke]),o.useLayoutEffect(()=>{z?.({width:xe==="wrap"?void 0:Ke.width+q,height:Ke.height})},[Ke,z]);const D=P(u,[u]),N=P(y=>{if(ie.dirty===y)return;const ye={...ie};ye.dirty=y,Z.current,R(ye),D?.(ye)},[ie]),It=P(y=>{if(ie.editMode===y)return;const ye={...ie};ye.editMode=y,R(ye),D?.(ye)},[ie]),bt=P(()=>{try{return s?.(ie),x?.(),!0}catch{return!1}},[s,ie]),ft=P(()=>{R(r),i?.(),x?.()},[i,r]),at=P(y=>{if(!Z.current)return;if(y.isDefaultPrevented(),!(y.isTrusted||y.nativeEvent.ctrlKey||y.nativeEvent.metaKey||y.nativeEvent.altKey||y.nativeEvent.isComposing)&&so.indexOf(y.nativeEvent.key)!==-1){const re={...ie};return re.dirty=y.nativeEvent.key==="Backspace"?"":(re.dirty??"")+y.key,R(re),D?.(re),void y.preventDefault()}const ye=y.nativeEvent.shiftKey;if(y.which===Mt.Escape)return y.preventDefault(),void ft();if(y.which===Mt.F2)return It(!0),void y.preventDefault();if(y.which===Mt.Enter&&(y.preventDefault(),bt()&&k?.(ye?w.Up:w.Down)),y.which===Mt.Tab)return y.preventDefault(),void(bt()&&k?.(ye?w.Left:w.Right));if(!ie.editMode){let re=null;switch(y.which){case Mt.Left:re=w.Left;break;case Mt.Right:re=w.Right;break;case Mt.Up:re=w.Up;break;case Mt.Down:re=w.Down}if(re)return void bt()}},[ie,k]),[he,Ft]=o.useState(!oe);o.useEffect(()=>{Ft(!1)},[]);const M=ro(n,()=>({startEdit(y){let ye=y?.initialSelection;if(!ye){const ve=Z.current.value.length??0;ye={start:ve,end:ve,direction:"forward"}}Z.current?.setSelectionRange(ye.start,ye.end,ye.direction);const re={...r,editMode:y?.editMode??!1};y?.text!==void 0&&(re.dirty=y.text),re.editMode===r.editMode&&re.dirty===r.dirty||(R(re),D?.(re))},submitEdit:()=>bt(),cancelEdit(){ft()},autoFocus(){Z.current?.focus()},getLineHeight:()=>Ke?.maxLineHeight??Ue,dispatchEvent:y=>Z.current.dispatchEvent(y)}),[r,d]);return ne.jsx("div",{ref:M,...ee,style:{background:"transparent",display:"flex",flexGrow:1,alignSelf:"center",height:Ke.height,maxWidth:"100%",maxHeight:"100%",...F},children:ne.jsx("textarea",{spellCheck:"false",ref:Z,value:Y,autoFocus:!1,disabled:he,name:"cell-editor",autoComplete:"off",autoCapitalize:"off",style:{flex:"1 1 100%",position:"relative",fontSize:`${m}px`,fontFamily:`${Ae}`,fontWeight:`${je}`,fontStyle:`${fe}`,padding:"0px",marginRight:G==="right"?"3px":"0px",marginLeft:G==="left"?"2px":"0px",lineHeight:Se,height:Ke.height,textRendering:"geometricPrecision",letterSpacing:"-0.25px",boxSizing:"border-box",borderWidth:0,outline:"none",resize:"none",overflow:"hidden",verticalAlign:"baseline",textAlign:G,background:"transparent",color:W,marginBottom:"0px",userSelect:"text",maxHeight:"100%",whiteSpace:xe==="wrap"?"break-spaces":"pre",wordWrap:"break-word"},onChange:y=>{N(y.target.value)},onDoubleClick:y=>{y.isTrusted},onMouseDown:y=>{It(!0)},onKeyDown:at})})})),sr=o.memo(t=>{const{value:n,view:r,bounds:l,range:d,zoom:u,children:s,style:i,...x}=t;return ne.jsx("div",{style:{padding:"2px 4px",fontFamily:"Calibri",letterSpacing:-.25,lineHeight:1.2,fontSize:i?.fontSize||1056/72,...i},...x,children:n})});export{go as E,xo as M,lr as S,$t as V,Bo as Y,Jo as a,sr as b,co as c,_o as l,rr as m,or as p,Ko as r,Qn as s,so as v,nr as x,ir as y};
