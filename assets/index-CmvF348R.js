const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./lRUYQdaIClvoTNGo-DCB-8J2N.js","./preload-helper-PPVm8Dsz.js","./index-CvKDCtrJ.js","./iframe-mGP4b_Fh.js","./index-BiBgeh3u.js","./index-DTwpo8e8.js","./client-BMu68Vok.js","./index-CXJVXQGg.js","./xXGFfp-8v8jL5akS-Civr6X0s.js","./CvVXzwNYb-2OZMBj-CnpeITyJ.js","./index-dIYXK-vs.js","./CL0VCEG7SV6dsMf0-JQkIxBW1.js","./CwNJi9uj-WfxZwSI-BURuWXAw.js"])))=>i.map(i=>d[i]);
import{_ as ao}from"./preload-helper-PPVm8Dsz.js";import{x as Pe,d as Tt,t as P,H as q,y as ct,e as Gw,f as Ih,g as lr,Z as Lt,n as $l,Y as cs,h as Vt,u as Ip,i as rs,r as li,j as Ap,o as Ec,X as Et,p as zr,q as Uw,w as qw,a as St,k as ke,T as Yn,J as Mo,z as Hi,N as Mp,L as Jw,A as Kw,_ as Xw,B as Zw,C as Ah,D as Ci,E as Rc,G as Qw,m as tt,O as jd,I as Ae,Q as Oe,M as Ua,W as Tp,c as Uu,K as In,P as Yw,F as e_,R as Bs,S as kp,$ as t_}from"./index-CvKDCtrJ.js";import{j as pe,r as os}from"./index-BiBgeh3u.js";import{r as M,g as it}from"./iframe-mGP4b_Fh.js";import{M as Fp,s as sl,m as Np,p as n_,S as r_,l as o_,c as Op,x as s_,V as qu,Y as i_,v as l_}from"./index-CXJVXQGg.js";/**
 * @license @sheetxl/primitives - Primitives - Base types for SheetXL functions. - v0.7.26
 *
 * (C) 2025-present SheetXL Inc. & Michael T. Ford
 * License: The license can be found at https://www.sheetxl.com/license.
 */const Le={Number:"n",String:"s",Boolean:"b",Error:"e",RichData:"r",Null:"z"};var B,il,$e;(il=B||(B={})).Orientation={Column:"column",Row:"row"},il.Orientations={...il.Orientation,Both:"both"},il.Direction={Up:"up",Down:"down",Left:"left",Right:"right"},(s=>{s.Code={Parse:0,Null:1,Div0:2,Value:3,Ref:4,Name:5,Num:6,NA:7,GettingData:8,Spill:9,Connect:10,Blocked:11,Unknown:12,Field:13,Calc:14,Busy:16,Python:19,Timeout:20},s.Label={Parse:"#PARSE!",Null:"#NULL!",Div0:"#DIV/0!",Value:"#VALUE!",Ref:"#REF!",Name:"#NAME?",Num:"#NUM!",NA:"#N/A",GettingData:"#GETTING_DATA",Spill:"#SPILL!",Connect:"#CONNECT!",Blocked:"#BLOCKED!",Unknown:"#UNKNOWN!",Field:"#FIELD!",Calc:"#CALC!",Busy:"#BUSY!",Python:"#PYTHON!",Timeout:"#TIMEOUT!"};const C=class C extends Error{constructor(Q,G,ee,ne){super(ee,ne),this._label=G,this._code=Q,this.details=ne}get isFormulaError(){return!0}getLabel(){return this._label}getCode(){return this._code}equals(Q){return!!Q&&(this._code===Q._code||this._code===Q.code)}get[Symbol.toStringTag](){return"[FormulaError]"}toString(){return this.message||this._label}};C.code=s.Code.Unknown;let e=C;s.Known=e;const _=class _ extends e{constructor(Q,G){super(s.Code.Parse,s.Label.Parse,Q,G)}getDetails(){const Q=this.details;return{line:Q?.line??1,column:Q?.column??1,offset:Q?.offset??0,length:Q?.length??0}}};_.code=s.Code.Parse;let t=_;s.Parse=t;const y=class y extends e{constructor(Q,G){super(s.Code.Null,s.Label.Null,Q,G)}};y.code=s.Code.Null;let n=y;s.Null=n;const v=class v extends e{constructor(Q,G){super(s.Code.Div0,s.Label.Div0,Q,G)}};v.code=s.Code.Div0;let r=v;s.Div0=r;const x=class x extends e{constructor(Q,G){super(s.Code.Value,s.Label.Value,Q,G)}};x.code=s.Code.Value;let o=x;s.Value=o;const E=class E extends e{constructor(Q,G){super(s.Code.Ref,s.Label.Ref,Q,G)}};E.code=s.Code.Ref;let i=E;s.Ref=i;const R=class R extends e{constructor(Q,G){super(s.Code.Name,s.Label.Name,Q,G)}};R.code=s.Code.Name;let l=R;s.Name=l;const I=class I extends e{constructor(Q,G){super(s.Code.Num,s.Label.Num,Q,G)}};I.code=s.Code.Num;let a=I;s.Num=a;const A=class A extends e{constructor(Q,G){super(s.Code.NA,s.Label.NA,Q,G)}};A.code=s.Code.NA;let c=A;s.NA=c;const T=class T extends e{constructor(Q,G){super(s.Code.GettingData,s.Label.GettingData,Q,G)}};T.code=s.Code.GettingData;let u=T;s.GettingData=u;const O=class O extends e{constructor(Q,G){super(s.Code.Spill,s.Label.Spill,Q,G)}};O.code=s.Code.Spill;let d=O;s.Spill=d;const N=class N extends e{constructor(Q,G){super(s.Code.Connect,s.Label.Connect,Q,G)}};N.code=s.Code.Connect;let h=N;s.Connect=h;const D=class D extends e{constructor(Q,G){super(s.Code.Blocked,s.Label.Blocked,Q,G)}};D.code=s.Code.Blocked;let f=D;s.Blocked=f;const F=class F extends e{constructor(Q,G){super(s.Code.Unknown,s.Label.Unknown,Q,G)}};F.code=s.Code.Unknown;let g=F;s.Unknown=g;const k=class k extends e{constructor(Q,G){super(s.Code.Field,s.Label.Field,Q,G)}};k.code=s.Code.Field;let m=k;s.Field=m;const L=class L extends e{constructor(Q,G){super(s.Code.Calc,s.Label.Calc,Q,G)}};L.code=s.Code.Calc;let p=L;s.Calc=p;const W=class W extends e{constructor(Q,G){super(s.Code.Busy,s.Label.Busy,Q,G)}};W.code=s.Code.Busy;let S=W;s.Busy=S;const $=class $ extends e{constructor(Q,G){super(s.Code.Python,s.Label.Python,Q,G)}};$.code=s.Code.Python;let w=$;s.Python=w;const J=class J extends e{constructor(Q,G){super(s.Code.Timeout,s.Label.Timeout,Q,G)}};J.code=s.Code.Timeout;let b=J;s.Timeout=b})($e||($e={}));const nn={};nn[$e.Code.Parse]=$e.Parse,nn[$e.Code.Null]=$e.Null,nn[$e.Code.Div0]=$e.Div0,nn[$e.Code.Value]=$e.Value,nn[$e.Code.Ref]=$e.Ref,nn[$e.Code.Name]=$e.Name,nn[$e.Code.Num]=$e.Num,nn[$e.Code.NA]=$e.NA,nn[$e.Code.GettingData]=$e.GettingData,nn[$e.Code.Spill]=$e.Spill,nn[$e.Code.Connect]=$e.Connect,nn[$e.Code.Blocked]=$e.Blocked,nn[$e.Code.Unknown]=$e.Unknown,nn[$e.Code.Field]=$e.Field,nn[$e.Code.Calc]=$e.Calc,nn[$e.Code.Busy]=$e.Busy,nn[$e.Code.Python]=$e.Python,nn[$e.Code.Timeout]=$e.Timeout;const Dp=new Map,Gd=new Map,Lp=new Map,Bp=new Map,Mh=Object.keys(nn);for(let s=0;s<Mh.length;s++){const e=Mh[s],t=nn[e];Lp.set($e.Label[e],t),Bp.set($e.Code[e],t);const n=new t;Dp.set(n.getLabel(),n),Gd.set(n.getCode(),n)}const a_=Gd.get($e.Code.Unknown);var Pt;(Pt=$e||($e={})).BuiltIn={Parse:new Pt.Parse,Null:new Pt.Null,Div0:new Pt.Div0,Value:new Pt.Value,Ref:new Pt.Ref,Name:new Pt.Name,Num:new Pt.Num,NA:new Pt.NA,GettingData:new Pt.GettingData,Spill:new Pt.Spill,Connect:new Pt.Connect,Blocked:new Pt.Blocked,Unknown:new Pt.Unknown,Field:new Pt.Field,Calc:new Pt.Calc,Busy:new Pt.Busy,Python:new Pt.Python,Timeout:new Pt.Timeout},Pt.getBuiltInByLabel=s=>Dp.get(s),Pt.newTypedError=(s,e,t)=>{let n;return n=typeof s=="string"?Lp.get(s):Bp.get(s),n||(n=Pt.Unknown),new n(e,t)},Pt.getBuiltInById=s=>Gd.get(s)||a_;class c_{constructor(e){this._subscribeFn=e}subscribe(e,t,n){const r=typeof e=="object"?{next:e.next||(()=>{}),error:e.error||(()=>{}),complete:e.complete||(()=>{}),unsubscribe:()=>{}}:{next:e||(()=>{}),error:t||(()=>{}),complete:n||(()=>{}),unsubscribe:()=>{}},o=this._subscribeFn(r);return r.unsubscribe=()=>{typeof o=="function"&&o()},r}}/**
 * @license @sheetxl/sdk - SDK - A high-performance, embeddable spreadsheet engine. - v0.7.26
 *
 * (C) 2025-present SheetXL Inc. & Michael T. Ford
 * License: The license can be found at https://www.sheetxl.com/license.
 */const Th=(s,e)=>{const t=new Map;return s.forEach((n,r)=>{e.get(r)!==n&&t.set(r,n)}),t};let kh=!1;class Fh{constructor(e){this._record=e}getId(){return this._record.id}getDescription(){return this._record.description}getMeta(){return Object.freeze(this._record.meta)}getAuthor(){return this._record.author}getTimestamp(){return this._record.timestamp}getOperation(){return this._record.operation}}const vh=class vh{constructor(e){this._listeners=new Set,this._listenersState=new Map,this._commits=new Map,this._locked=!1,this._current=null,this._pending=null,this._isSync=e?.sync??kh,this._isTransient=e?.transient??!1,this._author=e?.author;const t={id:"0",description:"initial",meta:{},author:this._author,timestamp:Date.now(),states:new Map,version:0,previousId:null},n={record:t,commit:new Fh(t)};this._current=n,this._cacheModel=null,this._cacheState=null,this._states=t.states,this._transactionStack=[],this._transactionOpen=!1;const r=new Map;r.set(t.id,n),this._commits=r}getLog(e,t=100){const n=[];let r=e;do{const o=this._commits.get(r);if(!o)throw new Error(`Invalid commit id: '${r}'`);if(n.push(o.commit),r=o.record.previousId,!r)return n}while(n.length<t)}getCommitCount(){return this._commits.size}isOpenTransaction(){return this._transactionStack.length>0||this._transactionOpen}getPendingView(){const e=this._transactionStack;return e.length>0?e[0].getView():null}getState(e){const t=this._transactionStack;if(t.length===0){if(this._cacheModel===e)return this._cacheState;const n=this._states.get(e);return this._cacheModel=e,this._cacheState=n,n}return t[t.length-1].getState(e)}getCurrentCommit(){return this._pending?.commit??this._current.commit}restore(e,t){const n=this._getCommitContainer(e,t);if(this._current.commit.getId()===n.commit.getId())return n.commit;let r;t?.viewId&&t?.viewId!=="custom"||(r=n.record.viewAfter);const o=Th(n.record.states,this._current.record.states);this._notifyStates("onBeforeCommitStart",this._current,o,r,!0,!1),this._current=n,this._states=this._current.record.states,this._cacheModel=null,this._cacheState=null,this._notifyStates("onAfterStateChange",n,o,r,!1,!0,!0),this._notify("onCommitChange",n.commit,!0),this._transactionOpen=!0;try{this._notifyStates("onRestoreOrRevert",n,n.record.states,r,!1,!0)}finally{this._transactionOpen=!1}return n.commit}revert(e,t){const n=this._getCommitContainer(e,t),r=this._commits.get(n.record.previousId);if(!r)throw new Error(`Invalid commit id: '${n.record.previousId}'`);let o;t?.viewId&&t?.viewId!==" custom"||(o=n.record.viewBefore??n.record.viewAfter);const i=Th(r.record.states,this._current.record.states);this._notifyStates("onBeforeCommitStart",this._current,i,o,!0,!1),this._current=r,this._states=this._current.record.states,this._cacheModel=null,this._cacheState=null,this._notifyStates("onAfterStateChange",r,i,o,!0,!1,!0),this._notify("onCommitChange",r.commit,!0),this._transactionOpen=!0;try{this._notifyStates("onRestoreOrRevert",r,r.record.states,o,!0,!0)}finally{this._transactionOpen=!1}return r.commit}_getCommitContainer(e,t){const n=this._commits.get(e);if(!n)throw new Error(`Invalid commit id: '${e}'`);if(this._isTransient)throw new Error("Cannot revert transient store");if(t?.force&&this._transactionStack.length>0&&this._transactionStack[0].rollback(),this._transactionStack.length!==0)throw new Error("Open transactions.");return n}_pruneForwards(e){}beginCommit(e,t){const n=this._transactionStack,r=n.length;if(this._locked)throw console.warn("TransactionStore locked",n),new Error(`TransactionStore is locked by '${n[r-1].getDescription()}`);const o=e?.preventFurtherTransactions,i=this,l=(c,u,d)=>{const h=i._transactionStack;r!==h.length-1&&console.warn("Transaction stack out of sync",r,h.length,h),o&&(this._locked=!1),h.pop(),t?.(c,u,d),h.length===0&&(i._pending=null)};let a;if(n.length===0){const c=this._current.record,u={states:new Map,id:P.uuidV4(),description:typeof e=="string"?e:e?.description??null,meta:{},timestamp:Date.now(),author:null,version:c.version+1,previousId:c.id,viewBefore:null,viewAfter:{},operation:e?.operation},d={record:u,commit:new Fh(u)};this._pending=d,this._notify("onCommitStart",d.commit),a=new u_(this,d,c?.states,e,l)}else a=n[n.length-1].beginTransaction(e,l);return o&&(this._locked=!0),this._transactionStack.push(a),a}doBatch(e,t,n){let r;const o=this.beginCommit(t,n),i=this.getCurrentCommit();try{r=e?.(i);const l=()=>{o.commit(t)};if(r&&typeof r.then=="function")return new Promise((a,c)=>{r.then(u=>{try{l(),a(u)}catch(d){c(d)}}).catch(u=>{o.rollback(),c(u)})});l()}catch(l){throw o.rollback(),l}return r}remove(e){return!!e}addListener(e){const t=this._listeners;return t.add(e),()=>{t.delete(e)}}addStateListener(e,t){if(!e)throw new Error("Model is required");if(!t)throw new Error("Listener is required");let n=this._listenersState.get(e);return n||(n=new Set,this._listenersState.set(e,n)),n.add(t),()=>{n.delete(t),n.size===0&&this._listenersState.delete(e)}}dispatchEvents(e,t=!1){!t||this._isSync?e():setTimeout(e,0)}_commitRecord(e,t,n){let r=e.record,o=e.commit;if(!this._isTransient){if(n){const i=this._commits.get(r.previousId);if(i){r.previousId=i.record.id;const l=i.record,a=l.states;a&&r.states.forEach((c,u)=>{a.set(u,c)}),l.viewAfter={...l.viewAfter,...r.viewAfter},l.meta={...l.meta,...r.meta},l.timestamp=r.timestamp,r=l,o=i.commit,e={record:r,commit:o}}}this._commits.set(r.id,e)}this._current=e,this._states=this._current.record.states,this._cacheModel=null,this._cacheState=null,n||this._notify("onCommitChange",o),this._notifyStates("onAfterStateChange",e,t,e.record.viewAfter,!1,!1,!0),n||this._notify("onCommitEnd",o,!0)}_notifyStates(e,t,n,r,o=!1,i=!1,l=!1){const a=t.commit,c=this._listenersState;n.forEach((u,d)=>{const h=c.get(d);h&&this.dispatchEvents(()=>{h.forEach(f=>{f[e]?.(u,r,a,o,i)})},l)})}_notify(e,t,n=!1){this.dispatchEvents(()=>{this._listeners.forEach(r=>{r[e]?.(t)})},n)}};vh.setDefaultSync=e=>{kh=e};let Hn=vh;class zp{constructor(e,t){this._children=new Set,this._depth=0,this._container=null,this._closed=!1,this._container=e,t=typeof t=="string"?{description:t}:t,this._description=t?.description??"",t?.viewBefore!==void 0&&(e.record.viewBefore=e.record.viewBefore&&t.viewBefore?{...e.record.viewBefore,...t.viewBefore}:t.viewBefore),t?.viewAfter!==void 0&&(e.record.viewAfter=e.record.viewAfter&&t.viewAfter?{...e.record.viewAfter,...t.viewAfter}:t.viewAfter)}getView(){return this._container.record.viewAfter??this._container.record.viewBefore}getDepth(){return this._depth}getDescription(){return this._description}getStates(){return this._states}beginTransaction(e,t){this._ensureOpen();const n=new d_(this,this._container,typeof e=="string"?{description:e}:e,t);return this._children||this._children,this._children.add(n),n}updateState(e,t){this._ensureOpen();const n=this.getState(e),r=typeof t=="function"?t(n):t===void 0?n:{...n,...t};if(r){let o=this._states;o||(o=new Map,this._states=o),o.set(e,r)}return r}commit(e){if(this._ensureOpen(),typeof e=="string"&&(e={description:e}),e){if(e.description&&(this._description=e.description),e.meta&&(this._meta=P.mergeContentful(e.meta,this._meta)),e.viewAfter!==void 0){const t=this._container.record;let n=e.viewAfter;if(n===null)t.viewAfter=null;else{const r=t.viewAfter;typeof n=="function"&&(n=n(r)),t.viewAfter={...r,...n}}}if(e.viewBefore!==void 0){const t=this._container.record;let n=e.viewBefore;if(n===null)t.viewAfter=null;else{const r=t.viewBefore;typeof n=="function"&&(n=n(r)),t.viewBefore={...r,...n}}}}return this._children&&this._children.forEach(t=>{t.commit(e)}),this}isClose(){return this._closed}_ensureOpen(){if(this._closed)throw this._descriptions&&console.warn(`stack: [${this._descriptions.join(",")}]`),new Error("Transaction already closed")}_removeChild(e){this._children.delete(e),this._mergeStates(e._states)}_mergeStates(e){if(!e||e.size===0)return;let t=this._states;return t?(e.forEach((n,r)=>{const o=this.updateState(r,n);t.set(r,o)}),t):(this._states=e,e)}}class u_ extends zp{constructor(e,t,n,r,o){super(t,r),this._store=e,this._prevStates=n,this._onClose=o,this._states=new Map,this._meta=t.record.meta}getId(){return this._container.commit.getId()}getParent(){return this}commit(e){const t=this._states,n=this._container,r=n.record.viewAfter;this._store._notifyStates("onBeforeCommitStart",n,t,r,!1,!1),super.commit(e),this._store._notifyStates("onBeforeCommitEnd",n,t,r,!1,!1);const o=new Map(this._prevStates);return this._states.forEach((i,l)=>{i===null?o.delete(l):o.set(l,i)}),this._states=o,this._description&&(n.record.description=this._description),this._meta&&(n.record.meta=this._meta),n.record.states=o,this._closed=!0,this._onClose?.(this,!1,e),this._store._commitRecord(n,t,e?.forceAmend??!1),this}rollback(){return this._ensureOpen(),this._children&&this._children.forEach(e=>{e.rollback()}),this._closed=!0,this._onClose?.(this,!0,null),this}updateState(e,t){const n=super.updateState(e,t);return this._states.set(e,n),n}getState(e){let t=this._states.get(e);return t||(t=this._prevStates.get(e)),t}_mergeStates(e){return!e||e.size===0?new Map:super._mergeStates(e)}}class d_ extends zp{constructor(e,t,n,r){if(super(t,n),!e)throw new Error("Parent transaction required");this._parent=e,this._depth=this._parent.getDepth()+1,this._onClose=r}getId(){return this._parent.getId()}getParent(){return this._parent}getState(e){const t=this._states?this._states.get(e):void 0;return t!==void 0?t:this._parent.getState(e)}commit(e){return super.commit(e),this._parent._removeChild(this),this._closed=!0,this._onClose?.(this,!1,e),this._parent??this}rollback(){return this._ensureOpen(),this._children&&this._children.forEach(e=>{e.rollback()}),this._parent._removeChild(this),this._closed=!0,this._onClose?.(this,!0,null),this._parent??this}}const Pp=()=>{try{return"0.7.26"}catch{return""}},Mr=Object.freeze(Object.defineProperty({__proto__:null,getBuildDate:()=>{try{return"Thu Oct 23 2025"}catch{return""}},getBuildVersion:Pp},Symbol.toStringTag,{value:"Module"})),h_=`
  https://www.sheetxl.com ${Pp()}`,Ic="#1976d2",g_=()=>typeof window=="object"?window.location.hostname:P.getOS(),$o=Object.freeze(Object.defineProperty({__proto__:null,generateNodeId:async()=>"0",getKey:async()=>{throw new Error("getKey is not implemented in browser environment")},printBanner:async s=>{const e=s?console.log:P.consoleWithNoSource,t=`%c
███████╗██╗  ██╗███████╗███████╗████████╗ ██╗  ██╗██╗
██╔════╝██║  ██║██╔════╝██╔════╝╚══██╔══╝ ╚██╗██╔╝██║
███████╗███████║█████╗  █████╗     ██║     ╚███╔╝ ██║
╚════██║██╔══██║██╔══╝  ██╔══╝     ██║     ██╔██╗ ██║
███████║██║  ██║███████╗███████╗   ██║    ██╔╝ ██╗███████╗
╚══════╝╚═╝  ╚═╝╚══════╝╚══════╝   ╚═╝    ╚═╝  ╚═╝╚══════╝${h_}
   `;return await e(`${t}`,`font-family:monospace;color:${Ic};font-size:12px;`),Promise.resolve()},printDetails:async(s,e=!1,t=!1,n=!1)=>{let r;const o=console.log,i=[`color:${Ic};font-size:12px`];if(s.isEval())i.push(`font-family:monospace;color:${Ic};font-size:12px;`),r="%cEvaluation Only",i[0]="color:#E12929;font-size:12px",r+=`%c
Please visit https://my.sheetxl.com to register.`;else{r=`%cLicensee: ${s.getLicensee()??"Invalid License"}`;const l=s.getExpiration()?.toLocaleDateString();l&&(r+=`
Expires: ${l}`);const a=s.getDomains();a&&a.length>0&&(r+=`
Domains: ${a.join(", ")}`);const c=s.getCpuCount();c>0&&(r+=`
Cpus: ${c}`)}if(!n&&s.hasExceptions()){i.push("color:red;font-size:12px"),r+=`
Exceptions:
%c`;const l=s.getExceptions(),a=l.length;for(let c=0;c<a;c++)r+=`  ${l[c]}`}if(t){i.push("color:#FFA726;font-size:12px"),r+="%c",r+=`
Location: '${g_()}'`;const l=s.getKeyFrom();l&&(r+=`
KeyFrom: '${l}'`)}return await o(`${r}`,...i),Promise.resolve()},setKey:async(s,e=!1)=>{throw new Error("setKey is not implemented in browser environment")}},Symbol.toStringTag,{value:"Module"})),f_=(s,e,t=126)=>((n,r,o=126)=>{let i=n.split("");for(let l=0;l<i.length;l++)i[l].charCodeAt(0)<=o&&(i[l]=String.fromCharCode((i[l].charCodeAt(0)+r)%o));return i.join("")})(s,t-e),m_=s=>typeof window=="object"?window.atob(s):Buffer.from(s,"base64").toString("ascii");(function(){const s="m6[z",e="c4UC",t="#SQF",n="Dhwd";function r(u,d,h,f,g){return dt(f- -537,h)}function o(u,d,h,f,g){return dt(g-562,f)}const i=Ud();function l(u,d,h,f,g){return dt(d- -66,g)}function a(u,d,h,f,g){return dt(f- -685,g)}function c(u,d,h,f,g){return dt(d-504,u)}for(;;)try{if(parseInt(o(0,0,0,"0ZNs",926))/1+-parseInt(a(0,0,0,-441,"c4UC"))/2+parseInt(a(0,0,0,-310,"HuZb"))/3*(-parseInt(a(0,0,0,-359,s))/4)+-parseInt(l(0,188,0,0,"$z%H"))/5*(parseInt(c(e,732))/6)+-parseInt(r(0,0,t,-121))/7+parseInt(a(0,0,0,-312,"6kl7"))/8+parseInt(r(0,0,n,-235))/9*(parseInt(l(0,248,0,0,"#SQF"))/10)===909922)break;i.push(i.shift())}catch{i.push(i.shift())}})();const ya=()=>{if(typeof window===r(-695,-711,"Dhwd",-619,-655))return window[s="6kl7",e=611,dt(e-324,s)][r(-523,-544,"5jxP",-510,-549)];var s,e,t,n;function r(o,i,l,a,c){return dt(c- -928,l)}return P[t=-168,n="xqvd",dt(t- -499,n)]()},Ju=()=>{const s="aOhw",e="BK*d",t="fUTY";function n(r,o,i,l,a){return dt(i- -428,l)}return ya()[n(0,0,-42,s)](dt(320,e))||ya()===n(0,0,-146,t)};function er(s,e,t,n,r){return dt(t-528,r)}function Vo(s,e,t,n,r){return dt(t- -886,r)}const Nh=s=>{const e="63Xd",t="qvo0",n="gSoT",r="BK*d";let o=P[l(960,"c3ZU",1067,1052)];function i(d,h,f,g,m){return dt(m-865,h)}function l(d,h,f,g,m){return dt(g-672,h)}if(Ju()||P[a="1@aT",c=716,dt(c-306,a)]()){const d=Mr[l(0,e,0,951)](),h=new Date(d),f=new Date;Math[i(0,"5jxP",0,0,1128)]((f[i(0,"5jxP",0,0,1143)]()-h[i(0,"([dm",0,0,1255)]())/864e5)>=120&&(o=[u(1234,1185,1083,1181,t)])}else o=[];var a,c;function u(d,h,f,g,m){return dt(g-919,m)}return{getLicensee:()=>i(0,"SL($",0,0,1149),getExpiration:()=>null,getDomains:()=>[ya()],getDeveloperCount:()=>1,getCpuCount:()=>0,getType:()=>dt(229,"m6[z"),isEval:()=>!0,getExceptions:()=>o,hasExceptions:()=>o[l(0,"6kl7",0,1024)]>0,isValidFor:()=>o[u(0,0,0,1274,"*ZDD")]===0,isValid:()=>!1,getFeatures:()=>Object[u(0,0,0,1291,"OwGA")]({}),getKeyFrom:()=>s,getBuildVersion:Mr[l(0,n,0,1026)],getBuildDate:Mr[l(0,r,0,952)]}};function Ar(s,e,t,n,r){return dt(t-474,s)}const Oh=()=>{const s="aOhw",e="8BTN";if(Ct[t=232,n="Bb8q",dt(t- -33,n)]&&Ct[i("nP7I",-232,-87,-171)])return!1;var t,n;const r=Ct[o(-340,-356,-418,s)];function o(l,a,c,u,d){return dt(c- -719,u)}function i(l,a,c,u,d){return dt(u- -421,l)}return!!(r[i(e,-154,-61,-114)]()||r[o(0,0,-406,"ta!D")]()||r[o(0,0,-443,"aNW$")]()?.pb)},Ct={promise:null,printNeeded:!1,details:null,bannerPrinted:!1,detailsPrinted:!1,licenseKey:null,keyFrom:null};let Ac=!1,Dh=!1;function Ud(){const s=["W5mFDSkRWOzEnSkyl0viWQWQwq","omoiuuXvWPddMmo7f8oB","W6pdR8o7W4pdVSk8pmozBCkx","gJyVWPtcG8kuWP0VECkSqCkqW40","W6ToWOLQgWa","jCk5ymk8hmopy8kkWQRdSSk/qN0","W7uWBGnnsW","EZRcLG4vWQVcP8okfG","W7FcSCoUpvHNEmo0WOm","WRtdN2BdM8k0wq0Po8kI","yudcOGldJuW","vbdcLrq","omoiuuPfWO3dLCo2lCondmkmlXRdJW","rHCiW4f9Eq","jmkaWPC1W5nz","W7FcT8o9of93","ESkyWQioWPSEWQlcNg3cImkwWPjX","WP7dT8ojnhvjACoU","jSkUFCkEaCoUz8kkWRFdSSkg","W43cV30hWOPkWP3dV2hcG8oPW7yi","Ec9ZqbhdRGJcPSoXW6SK","W7VdV8oOW4m","W7ufW5FdSSo7WOhdJMFcQ2NdNCoE","hSkbWOn5i0JcRG","wmk9WRdcUx3cG1BdKSk/vhTtWQq","W6ZcJCkgrCo/","aCkPW54/bNRcMCk/yCojW616b2y","iSkoWOavW6jEWQxdMXXOwJj+","nXL/EW","W4KcW4WAW4mIgJTm","g8oVW4JcSI92","pbxdTv3cIHFdSSkdW5VcNaVdQNSL","FsRcNY3dLmou","WQnNktfTxmkQWOSt","WP9DF1q","cZ1GWQhcICknWPOP","W4juDSkPWOZdUSoIWPJdQCoBWOZcHCoNECksW4FdJ8k6WPy","W43cSx02WPXiWPxdQG","WQJcMSk9WPVdOLBcP3qMbG","W7BcJSkKq8oVlW","jCkODCkcaCoFuCknWQ3dVW","WP94smkzWOL1","hCklWPPwjulcUeS9","AudcUatdKeJcTW","m8kYCmkdiSofCSkm","CJnlrXtdOd8","EudcTbe","iHtdQZDzWQ7cIG","qWdcKIGtWRlcRq","wGajW4TGySku","W7FcO8oGaunQD8o0","jSoaW47dJa","pCoDWPOgWPexWR/cV3RdGCkZWOnTjq","oCkvW4flgYXHW60RWOBcLqu","mCk5ymkYamofASkaWP3dTSkaqG","DepcT2idW7NdIvnJfSkTgHa","CJ/cHaNdJ8ojm8kH","rH0b","amoBrgrzWOddMmoMhG","WQHAW43dO8oNW5RcLa","e8kDWQb3lKm","m8oBW4S","pCk5BCk2b8odAW","WOtcHmkiWPNdUNS","WP94x8kdWOzMW5W","WQddJ8ovW43dLSkw","W6ysomkPlXLPlshcNSkHW64","emowWPGgWPqsWQJdJ23dKmkTWP56imk0WOqmWOW","psPbWP7cN8kb","W5GHWO7cNbi+u8kGqW","WQxdMCo1W4xdHSkB","WRjDWO3cSCkRW7ddNq","W5VcT8oJoeu","nGNdRZHeWO7cNeXfnCkA","t8oxW5GVErddRxyVW4JcNSkhqa","W5BcU3OjWPDq","W63dP8o2W4JdTCk9cCoGyCkaEcv1","igJcSmoKwKtdVmkNzdNcRCkpW7lcSSkYWPy","W5xcRgCSWOzRWPNdOxVcJ8o0","cSkCWOf1i1xcUa","hYndgGWZi2y","W7rEWPD9hq3dQK/dVmkxW5RdHG8","W4ddJ8kblSk0l0C","fwZcUmoMdKBdSmkHztlcUG","qr3cLHuiWQy","iaNdOZnkWQu","s3LXASoHmSooWQdcGWaBd8kyWO3cV8kdfmkSW4W","ih3dGJpdPCosbCkhwq","umkVW6tcImkPiXxcNmoUW7yjc8kqicK5pepdRCooDCkZW7tdRM7dPZO","W6BcJstcPSoKEXy4a8k+bG","WOfkrmkVWQT4nCkM","W6RdSmo5W4O","iSoRW4ZcUZX3WRD+WPe","Axm/yCo8oq","W7VdMSkhjSkZnW","rSkXW6dcGmkRpJpdNComW7epha","W57cPSoJjfrfBW","W4BcT2jSWP5rWOZdQNdcGSo1","W5HBWPvKarZdNvNdMmkeW5RdHaG","BmkfjYddUmkEW7hdN2SmkYRcLa","DqiuW49NzCk1d8kDhSk1WQKd","WQbNeCk8j0atn1FcKSkSaNCz","jcTMWP/cJ8kGWPePECkXrmkm","WRTcBCo6Df1PkG","bSoiWPWoWPypWO7cJMBdHSk4WOu","W6urW5K6W4mLhIfAvgNcRCoc","WOvcm8o+W5WlDCkYh2P1WOa1","WPqclSoTW5dcOmk3WRVdTSo3WQhcICoo","W6uaW4WeW541lczDwq","ftpdGXnKWPJcTxzTgCk9bYqMWRWaW63dGmoK","WQ1pWQtcSSkVW5O","WR3dHYZcTSowW73dLwZdNmoVaSk1W59j","W7irW5KxW4mQcb9BweZcVmoEW6a","W4qoy8k4WPTbeSkHkuq","uCkuoYFdS8ky","aKpdKCoxWQ4ebCknW63dKxjHFSktWPxcPGCj","ucNdP8kXt17dR8k8vtJcMW","W6yBpCkSkNzUfZRcQCks","W6fPWPz2cxBdNSkVWQNdUGS9eJu","W78hW6mzW44J","WOVcHCkOWORdOxi","W5P8WPb+dM7dQCkAWQ/dSGWLba","DqiuW49NzCkZc8kheCk5WRC","xCk5WQRcLw3cMgRdHmkax31fWQLyW58","W6rnECk2WPBdT8oZWQBdR8obW4tcU8oTwmkuW53dMCo5WPBcGehdQSkjW4eX","W4pcSMeTWOa","W7BcLKShWQzXWRq","pmkrW5TNcZDDW7SgWONcLqxcNq","A8kaW5XFW48CWPBcM0/dMSkV","p0ldQ8ozWQemdCoiW4xdMwvHq8kuWOldRWilWRRdLW","pSouW47dOw3dJmoXW6DtFx1IqG","oqPNutRdOWi","W5GBWO0sW4uRgIzhqGlcU8olW6hdGvfNWPqLha","WP9AzviPE8k0eINdGSkjWQe","WR/dNSoAW5JdLSknWR0aWRCz","thmlnSooW5e","oCoirhXfWPBdNmoH","W5JcTCoGpfHWFa","FcvPyb3dQc/cP8oSW7WY","W4mHAmoeCq","W4lcU3OwWPTeWP0","hsHtkY4Zo2P1W7xdSCkt","yNmLrmo9omohWQRcTarpgG","eKNdQCozWQqjgSk4W5VdMwHWsmkd","W6lcIcxcSCoHa1XUzG","W4dcPN4RWObq","fXL/EZ3dRrVcOSoozWiKemkgqaOGnq","oSkDWPW9W7noWQu","bSoiWPWoWPyp","yuRcRWtdJu3cQ8oD","WOTnEf00u8kInJRdGSklWQBcLh4","taadW4nZDa","W4qoy8k+WPPb","ir7dSHrfWQNcLu13nCkmmqmAWPC","FmkSW7pcGmkPAG","ySkbjYNdQCke","aL7dTmov","W5uYB8olEbL+z2pdNmoYq8oz","W4ZcOSo5nf1SACoLWPtcSSoUB8kWWQe","pSoDWPOLWO0sWQdcI0ZdICkPWPi","WR/dGw/cN8orW63dLsldISoYuSkxW4HvFsKKsXu","W7RcGx4WWP1DWPFdKeO","WQZdMh7cK8orW6RdTgFdM8oRs8ksW4K","mSk5ymkrhmoaDq","esLtA8kAW4jeF1FdRKu","mmk5ymkthCkeiCokW7y","W5pdI8kgh8kVkLRdHe4Z","WRTcBCo6Df1Pbd3cQq","hCklWPPCl1lcVgS1W6m","WRjbW63dSmoYW44","WQfsWPFcKSkVW4q","WQZdMh7cK8orW6O","mCk5ymkYamofASkaWO/dSSkgvg3cOwG","WR5ywmo+DKDO","WOrcW5RdR8o9W5BcUJvftSouFq","mCozWP0IWOayWQNcN3ZdGCkYWPL7","s8oEW50REN7cV1O7W6NcUq","iJb8WPJcJ8oe","oSkDWPO+W64","W6eLr8oPFqba","W7/dKcaao3TRWQO","W5SFBmkTWPTA","AxKYz8oKoCoeWR3cHa","oepcVCotWQGC","WRZdMmosW4tdLSkWWO8mWQCuoq","Ds0wW5rMzCkEnCk2","W7uWDc1Au8kgWRW8WOTpbCopmG","W7uiW5JdT8o3WOddRupcSg7dGmoK","WR7cSSkHWPxcQCo5h8ouASkNqa8","DNmLtCoTka","jcX8WPK","WQ1sWPFcPCkIW5/dJW","W4vEBmk7WORdUSo0","WOP4wmkJWRK","lmkIW5W/a3/cJG","WQThW5VdRG","WOP4wmkOWO9KW5GGW4Pl","e3/cVCo9h07dOW","cCkAWO9QpLxcIMSTW7G","WRZdMmouW4FdI8knWO8","lCk/W5G3ggO","fCkzWPi8W7nzWQhdNW0","W7ODW44tW4q1hGrmsa","W7rdWOjOgXddTwpdGmkmW5ddJrv6Amk4rWNdVW"];return(Ud=function(){return s})()}function gr(s,e,t,n,r){return dt(e- -97,s)}const Lh=Ar("5jxP",0,709)[gr("KIhQ",317)]("")[Ar("xqvd",0,857)]((s,e)=>e+s,"");function dt(s,e){const t=Ud();return dt=function(n,r){let o=t[n-=217];if(dt.mJvfUe===void 0){const a=function(c,u){let d,h,f=[],g=0,m="";for(c=(function(p){let S="",w="";for(let b,C,_=0,y=0;C=p.charAt(y++);~C&&(b=_%4?64*b+C:C,_++%4)?S+=String.fromCharCode(255&b>>(-2*_&6)):0)C="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(C);for(let b=0,C=S.length;b<C;b++)w+="%"+("00"+S.charCodeAt(b).toString(16)).slice(-2);return decodeURIComponent(w)})(c),h=0;h<256;h++)f[h]=h;for(h=0;h<256;h++)g=(g+f[h]+u.charCodeAt(h%u.length))%256,d=f[h],f[h]=f[g],f[g]=d;h=0,g=0;for(let p=0;p<c.length;p++)h=(h+1)%256,g=(g+f[h])%256,d=f[h],f[h]=f[g],f[g]=d,m+=String.fromCharCode(c.charCodeAt(p)^f[(f[h]+f[g])%256]);return m};dt.DMPHzv=a,s=arguments,dt.mJvfUe=!0}const i=n+t[0],l=s[i];return l?o=l:(dt.hDkvRf===void 0&&(dt.hDkvRf=!0),o=dt.DMPHzv(o,r),s[i]=o),o},dt(s,e)}class p_{constructor(){function e(t,n,r,o,i){return Ar(i,0,o- -882)}this[e(0,0,0,-59,"([dm")][e(0,0,0,-73,"$z%H")]=null}async[er(0,0,771,0,"nP7I")](e,t=!1){const n="1@aT",r="c4UC",o="Ice&",i="l9nU",l="#SQF",a="gSoT",c="aNW$",u="nP7I",d="aUmj",h="^p7z",f="5jxP";if(!e||e[b("aOhw",-182,-165)](S(n,1106,1036))||e[g(560,r,669,608)](w(-150,-88,o,-145,-157))||e[w(-48,-58,"#SQF",-38,-113)](S("&lsY",955,998))||e[b(i,-237,-275)](m(-443,-488,-539,-395,"SL($")))return Ac=!0,P[g(666,l,850,759)]()&&await $o[b("BK*d",-287,-220)](e,t),await this[b("KIhQ",-217,-197)](!0);if(Ac=!1,!t&&Ct[m(-473,-397,-494,-454,"nP7I")]){const C=await this[S(a,1156,1121)]();if(C[w(-56,-131,c,-57,-62)]()&&!C[S("c3ZU",1183,1126)]())return C}function g(C,_,y,v,x){return er(0,0,v- -171,0,_)}function m(C,_,y,v,x){return er(0,0,C- -1341,0,x)}Ct[b(u,-149,-207)]=e,Ct[m(-409,-356,-328,-397,"aOhw")]=m(-466,-389,-478,-396,"aOhw"),Ct[S("6kl7",1136,1106)]=null,Ct[m(-538,0,0,0,"KIhQ")]=null;const p=await this[b(u,-124,-176)]();function S(C,_,y,v,x){return Ar(C,0,y-247)}function w(C,_,y,v,x){return er(0,0,x- -977,0,y)}if(!p[m(-502,0,0,0,"7(@M")]())throw await this[w(0,0,d,0,-197)](!0),new Error(S(h,0,988));function b(C,_,y,v,x){return er(0,0,y- -1075,0,C)}return await $o[w(0,0,f,0,-32)](e,t),p}async[Vo(0,0,-547,0,"CQ2W")](e=!1){const t="5b@H",n="$z%H",r="CQ2W",o="KIhQ",i="*ZDD",l="%SFU",a="bXFq",c="$fOM",u="l9nU",d="^p7z",h="nP7I",f="aOhw",g="2RFy",m="bXFq",p="nEsj",S="CQ2W";function w(A,T,O,N,D){return Ar(O,0,N- -515)}if(e&&(Ct[R(1180,1210,1276,1307,"qvo0")]&&!Ct[R(1150,1117,1096,1030,"aUmj")]&&this[R(1142,1198,1197,1240,t)](),Ct[E(-33,43,140,-12,n)]=!0),Ct[E(92,139,110,106,"kjhz")])return Ct[w(0,0,r,244)];function b(A,T,O,N,D){return tr(A-131,O,O-458,N-864)}if(!this[E(73,145,144,172,"*ZDD")][E(219,235,294,262,"0ZNs")]&&(this[b(376,187,"5jxP",277)][I(1291,o,1223,1206)]=new Error("FV")),Ct[b(397,0,i,369)])return Ct[I(1212,"l9nU",1381,1309)];let C=null;Ct[E(138,39,36,14,"#SQF")]=new Promise(A=>{C=A});let _,y=null;const v=async(A,T)=>{try{const D=(k=>{let L=k;const W=L[L.length-1],$=W.charCodeAt(0)-52;if(L=L.substring(0,L.length-1),L=L.split("").reverse().join(""),L=m_(L),L=L.trim(),L[L.length-1]!==W)throw new Error;L=L.substring(0,L.length-1),L=f_(L,$);try{L.startsWith("{")||(L="{"+L);const J=JSON.parse(L),te={licensee:J.l,domains:J.d,nodeId:J.n,expiry:J.e,developerCount:J.dc,cpuCount:J.cc,type:J.t};return J.f&&(te.features=J.f),te}catch{throw new Error("Invalid license key.")}})(T),F=((k,L,W)=>{const $="aOhw",J="aUmj",te="BK*d";function Q(re,U,ue,oe,Z){return dt(oe-510,U)}function G(re,U,ue,oe,Z){return dt(oe-326,re)}function ee(re,U,ue,oe,Z){return dt(U-871,re)}function ne(re,U,ue,oe,Z){return dt(ue-310,U)}return{getLicensee:()=>k[Q(0,"7(@M",0,751)],getExpiration:()=>new Date(k[ne(0,"2RFy",648)]),getDomains:()=>k[ee("#SQF",1236)]??[],getDeveloperCount:()=>k[ee("KIhQ",1167)]??1,getCpuCount:()=>k[ne(0,"m)IG",708)]??0,getType:()=>k[ne(0,"m6[z",673)]??G("b(vL",0,0,737),getExceptions:()=>L,hasExceptions(){return!!L&&L[re=te,U=32,ne(0,re,U- -509)]>0;var re,U},isValidFor:re=>{return!(L?.[U=J,ue=-44,Q(0,U,0,ue- -847)]>0);var U,ue},isValid:()=>!0,isEval:()=>!1,getFeatures:()=>Object[ne(0,"c3ZU",568)](k[Q(0,"gSoT",0,784)]??{}),getKeyFrom:()=>W,getBuildVersion:Mr[Q(0,"sU[l",0,771)],getBuildDate:Mr[G($,0,0,722)]}})(D,await(async k=>{const L="([dm",W="CQ2W",$="nKhQ",J="1@aT",te="([dm",Q="ta!D",G="8BTN",ee="^p7z",ne="nP7I",re="c4UC",U="2RFy";function ue(he,fe,z,Fe,De){return dt(Fe-79,he)}function oe(he,fe,z,Fe,De){return dt(De-470,z)}const Z=k[Y(259,374,288,260,"bXFq")];function Y(he,fe,z,Fe,De){return dt(z- -101,De)}const we=k[Y(0,0,121,0,L)]?new Date(k[Y(0,0,182,0,"5jxP")]):null;function ge(he,fe,z,Fe,De){return dt(he- -729,z)}k[be(377,287,345,298,W)];const de=[];function be(he,fe,z,Fe,De){return dt(he-21,De)}if(we?isNaN(we)?de[Y(0,0,252,0,te)](ge(-320,0,Q)):we<new Date&&de[ue(G,0,0,412)](Y(0,0,197,0,"Lkb$")+we[be(274,0,0,0,ee)]()):de[Y(0,0,275,0,$)](ue(J,0,0,424)),!P[oe(0,0,"l9nU",0,882)]()){if(Ju())return de;if(Z&&Z[ge(-383,0,"$fOM")]!==0){let he=!1;const fe=ya();for(let z=0;!he&&z<Z[ue(re,0,0,398)];z++)he=fe[oe(0,0,"63Xd",0,688)](Z[z]);!he&&de[be(414,0,0,0,"%SFU")](ue(U,0,0,447))}else de[ge(-401,0,"1@aT")](Y(0,0,169,0,ne))}return de})(D),A);return F[O=S,N=-233,w(0,0,O,N- -561)]()&&(_=F),F}catch{_=(D=>{const F="Bb8q",k="Ice&";function L(te,Q,G,ee,ne){return dt(te- -422,ee)}function W(te,Q,G,ee,ne){return dt(G- -569,ne)}return{getLicensee:()=>null,getExpiration:()=>null,getDomains:()=>[],getDeveloperCount:()=>0,getCpuCount:()=>0,getType:()=>L(-93,0,0,"0ZNs"),getExceptions:()=>{return[(te=k,Q=1047,L(Q-1243,0,0,te)+D+"'")];var te,Q},hasExceptions:()=>!0,isValidFor:te=>!1,isValid:()=>!1,isEval:()=>!1,getFeatures:()=>Object[W(0,0,-280,0,"*ZDD")]({}),getKeyFrom:()=>D,getBuildVersion:Mr[W(0,0,-259,0,"aOhw")],getBuildDate:Mr[$=F,J=-323,dt(J- -718,$)]};var $,J})(A)}var O,N};Ct[I(1250,"m6[z",1361,1316)]&&(y=await v(Ct[E(160,91,139,93,"SL($")],Ct[b(265,0,"7(@M",283)]));let x=!1;function E(A,T,O,N,D){return er(0,0,T- -706,0,D)}function R(A,T,O,N,D){return gr(D,T-977)}if(Ac&&(x=!0,y=Nh(b(491,0,"$z%H",397))),!y)if(P[R(0,1261,0,0,"mu3)")]()){if(!y){const A=process[E(0,225,0,0,l)],T=A[R(0,1127,0,0,a)]||A[I(1189,"5jxP",1226,1236)]||A[E(0,223,0,0,"8BTN")]||A[E(0,163,0,0,c)];T&&(y=await v(b(297,0,"0ZNs",286),T))}if(!y){const A=await $o[E(0,170,0,0,"HuZb")]();A&&(y=await v(w(0,0,"aNW$",321),A))}!y&&(x=!0)}else{if(!y){let A=!1;try{const T=await fetch("./"+Lh);let O=null;if(T[b(239,0,"c4UC",268)]===200){const N=(await T[b(268,0,"6kl7",366)]())[I(1301,"mu3)",1319,1339,1422)](`
`),D=N[b(485,0,u,385)];for(let F=0;!O&&F<D;F++){const k=N[F][I(1285,d,1345,1266,1337)]();k[I(1380,"m)IG",1361,1346,1307)]!==0&&(k[b(270,0,h,224)](I(1236,"ta!D",1326,1330,1428))?A=!0:O=k)}}if(A&&O){const N=b(231,0,f,281)+Lh+"')";y=await v(N,O)}}catch{}}!y&&Ju()&&(x=!0)}function I(A,T,O,N,D){return tr(A-165,T,O-498,N-1858)}return!y&&x&&(y=Nh(R(0,1129,0,0,"Lkb$"))),!y&&_&&(y=_),!y&&(y={getLicensee:()=>null,getExpiration:()=>null,getDomains:()=>[],getDeveloperCount:()=>0,getCpuCount:()=>0,getType:()=>null,isEval:()=>!1,getExceptions:()=>[R(0,1104,0,0,"BK*d")],hasExceptions:()=>!0,isValidFor:A=>!1,isValid:()=>!1,getFeatures:()=>Object[w(0,0,"bXFq",182)]({}),getKeyFrom:()=>E(0,143,0,0,"^p7z"),getBuildVersion:Mr[I(1246,a,1187,1263)],getBuildDate:Mr[R(0,1177,0,0,"ta!D")]}),Ct[b(404,0,g,310)]=y,Ct[R(0,1202,0,0,"l9nU")]=e&&Oh(),C(y),Ct[R(0,1295,0,0,m)]&&this[R(0,1272,0,0,o)](),Ct[R(0,1100,0,0,p)]}async[tr(-584,"8BTN",-638,-574)](e){const t="5jxP",n="8BTN",r="%SFU",o="*ZDD",i="xqvd";Ct[f("&lsY",222,136)]=!0;const l=await this[c(1028,1116,945,"#SQF")]();function a(m,p,S,w,b){return er(0,0,w- -692,0,m)}function c(m,p,S,w,b){return Vo(0,0,m-1608,0,w)}var u,d,h;function f(m,p,S,w,b){return gr(m,S- -62)}function g(m,p,S,w,b){return gr(b,w- -369)}return await $o[f(t,313,261)](e),!e&&!Ct[a("^p7z",0,0,117)]&&(l[g(-157,-210,-259,-159,n)]()||l[g(-211,-295,-282,-198,r)]())&&await this[a(o,0,0,74)](e,l[u=497,d="ta!D",h=520,tr(u-158,d,h-48,h-1093)]()),Promise[c(1128,0,0,i)]()}async[gr("Lkb$",203)](e=!1,t=!1,n=!1){const r="&lsY",o="ta!D",i="nKhQ";function l(d,h,f,g,m){return gr(g,f- -663)}function a(d,h,f,g,m){return tr(d-397,d,f-89,f-695)}function c(d,h,f,g,m){return Ar(d,0,f- -678)}Ct[l(-279,-270,-366,"ta!D")]=!0;const u=await this[l(0,0,-409,"fUTY")]();Ct[c(r,0,91)]||!u[a("0ZNs",0,57)]()&&!u[a("5jxP",0,170)]()?await $o[a(i,0,80)](u,e,t,n):await this[c(o,0,38)](e)}async[er(0,0,905,0,"1@aT")](){const e="nEsj";if(Oh()){if(Dh)return void setTimeout(()=>{var r,o;this[r=-311,o=e,dt(r- -543,o)](!1,!1)},8e3);await this[t=92,n="KIhQ",gr(n,t- -168)](!1,!1)}var t,n}async[tr(-689,"ta!D",-582,-600)](e,t){const n="nKhQ",r="m6[z",o="Ice&",i="nP7I",l="EH3G";if(!e&&(Ct[u(58,20,-32,99,"Bb8q")]||Ct[u(81,-7,61,144,n)]))return;function a(S,w,b,C,_){return Ar(b,0,_-74)}Ct[a(992,1048,r,1025,966)]=!0,Ct[u(49,86,15,23,"EH3G")]=!0,await this[a(795,705,o,852,781)](e);const c=P[a(0,0,i,0,805)]();function u(S,w,b,C,_){return Vo(0,0,S-679,0,_)}const d=e||c?console[h=-620,f="*ZDD",g=-558,tr(h-99,f,f-122,g- -71)]:P[u(171,0,0,0,"qvo0")];var h,f,g,m,p;c&&d(""),await this[m=l,p=429,gr(m,p-267)](e,t),d("")}[tr(-533,"xqvd",-607,-552)](){return this[e="OwGA",t=169,Vo(0,0,t-825,0,e)](!0);var e,t}[Vo(0,0,-570,0,"CQ2W")](e){return this[t=-331,n="Lkb$",r=-290,o=-280,tr(t-383,n,r-155,o-297)](!0,e);var t,n,r,o}[tr(-671,"nEsj",-513,-582)](){return Ct[n="sU[l",r=-315,Vo(0,0,r-205,0,n)]||Ct[e="c4UC",t=-356,tr(e-8,e,t-242,t-188)];var e,t,n,r}[er(0,0,747,0,"$fOM")](e){Dh=!0}async[gr("aOhw",263)](){return this[e="*ZDD",t=112,er(0,0,t- -676,0,e)](!0);var e,t}async[er(0,0,768,0,"1@aT")](e,t){const n="gSoT",r=await this[o(1124,1108,1184,1180,n)]();function o(i,l,a,c,u){return Ar(u,0,l-291)}return await this[o(0,1001,0,0,"$fOM")](!0,e,t),r}async[Ar("#SQF",0,858)](){const e="HuZb";var t,n;return await $o[t=1290,n=e,gr(n,t-1063)]()}}const qa=new p_;function tr(s,e,t,n,r){return dt(n- -886,e)}const Ku=(s,e)=>{const t=[];for(let n=0;n<s.length;n++){const r=s[n];t.push({x:r.x+e.x,y:r.y+e.y})}return t},Xu=(s,e)=>{if(!s)return{...e};if(!e)return{...s};let t=Math.min(s.x,e.x),n=Math.min(s.y,e.y);return{x:t,y:n,width:Math.max(s.width+s.x,e.width+e.x)-t,height:Math.max(s.height+s.y,e.height+e.y)-n}},Mc=s=>[{x:s.x,y:s.y},{x:s.x+s.width,y:s.y},{x:s.x+s.width,y:s.y+s.height},{x:s.x,y:s.y+s.height}],Zu=s=>{let e=Number.MAX_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(let o=0;o<s.length;o++){let i=s[o];e=Math.min(e,i.x),t=Math.min(t,i.y),n=Math.max(n,i.x),r=Math.max(r,i.y)}return{x:e,y:t,width:n-e,height:r-t}},Tc=(s,e,t)=>{if(!t){const l=Zu(s);t={x:l.x+l.width/2,y:l.y+l.height/2}}s=Ku(s,{x:-t.x,y:-t.y});const n=e*Math.PI/180,r=Math.sin(n),o=Math.cos(n),i=[];for(let l=0;l<s.length;l++){const a=s[l],c=o*a.x-r*a.y,u=r*a.x+o*a.y;i.push({x:c,y:u})}return s=Ku(i,{x:t.x,y:t.y})},Hp=(s,e,t,n,r,o,i,l,a=!0)=>{if(s===t&&e===n||r===i&&o===l)return!1;let c=(l-o)*(t-s)-(i-r)*(n-e);if(c===0)return!1;let u=((i-r)*(e-o)-(l-o)*(s-r))/c,d=((t-s)*(e-o)-(n-e)*(s-r))/c;return(!a||!(u<0||u>1||d<0||d>1))&&{x:s+u*(t-s),y:e+u*(n-e)}},Cn=(s,e,t=!0)=>Hp(s.p1.x,s.p1.y,s.p2.x,s.p2.y,e.p1.x,e.p1.y,e.p2.x,e.p2.y,t),ll=s=>({top:{p1:s[0],p2:s[1]},left:{p1:s[3],p2:s[0]},right:{p1:s[1],p2:s[2]},bottom:{p1:s[2],p2:s[3]}}),Bh=(s,e,t)=>{let n=t*Math.PI/180,r=Math.sin(n),o=Math.cos(n);return{x:s*o-e*r,y:s*r+e*o}},Vr=(s,e)=>{let t=s.p2.x-e.x,n=s.p2.y-e.y;const r=Bh(t,n,90);t=r.x+e.x,n=r.y+e.y;let o=s.p1.x-e.x,i=s.p1.y-e.y;const l=Bh(o,i,90);return o=l.x+e.x,i=l.y+e.y,{p1:{x:o,y:i},p2:{x:t,y:n}}},an=Object.freeze(Object.defineProperty({__proto__:null,angleToPoints:(s,e)=>{const t=(180-s)/180*Math.PI,n=Math.abs(e.width*Math.sin(t))+Math.abs(e.height*Math.cos(t)),r=Math.sin(t)*n/2,o=Math.cos(t)*n/2,i=e.width/2,l=e.height/2;return{x1:i-r,y1:l-o,x2:i+r,y2:l+o}},boundsToPoints:Mc,centerPoint:s=>({x:s.width/2+s.x,y:s.height/2+s.y}),clipToOuterRect:(s,e,t=0)=>{if(t<0&&(t+=360),t>90&&t<=180?t+=180:t>180&&t<=270&&(t-=180),t===0||t===180)return{height:e.height,width:e.width};if(t===90||t===270)return{height:e.width,width:e.height};let n=Mc({...e,x:0,y:0}),r=Mc({...s,x:0,y:0});r=Ku(r,{x:e.width/2-s.width/2,y:e.height/2-s.height/2}),r=Tc(r,t);let o=ll(r),i=ll(n);if(t>90){const a=Cn(o.top,i.top);if(a){const u=a,d=Cn(o.bottom,i.bottom,!1)||r[3];r[0]=Cn(o.top,Vr(o.bottom,d),!1)||r[0],r[1]=u,r[3]=d,r[2]=Cn(o.bottom,Vr(o.top,u),!1)||r[2],o=ll(r)}const c=Cn(o.top,i.left);if(c){const u=c,d=Cn(o.bottom,i.right,!1)||r[2];r[0]=u,r[1]=Cn(o.top,Vr(o.bottom,d),!1)||r[1],r[3]=Cn(o.bottom,Vr(o.top,u),!1)||r[3],r[2]=d}}else if(t<90){const a=Cn(o.top,i.top);if(a){const u=a,d=Cn(o.bottom,i.bottom,!1)||r[2];r[0]=u,r[1]=Cn(o.top,Vr(o.bottom,d),!1)||r[1],r[3]=Cn(o.bottom,Vr(o.top,u),!1)||r[3],r[2]=d,o=ll(r)}const c=Cn(o.top,i.right);if(c){const u=c,d=Cn(o.bottom,i.left,!1)||r[3];r[0]=Cn(o.top,Vr(o.bottom,d),!1)||r[0],r[1]=u,r[3]=d,r[2]=Cn(o.bottom,Vr(o.top,u),!1)||r[2]}}r=Tc(r,-t);const l=Zu(r);return{width:l.width,height:l.height}},findIntersectMath:(s,e,t,n)=>{let r=Hp(s.x,s.y,e.x,e.y,5e4,0,-5e4,0);return r&&(t=Math.min(t,r.x),n=Math.max(n,r.x)),{min:t,max:n}},leastSquaresSlopeAndIntercept:s=>{let e=0,t=0,n=0,r=0,o=0,i=0,l=0,a=s.length;if(a===0)return{m:0,b:0};if(a===1)return{m:1,b:s[0]};for(let u=0;u<a;u++)i=u+1,l=s[u],l==null||isNaN(l)||(e+=i,t+=l,r+=i*i,n+=i*l,o++);const c=(o*n-e*t)/(o*r-e*e);return{m:c,b:t/o-c*e/o}},minBoundingRect:Zu,rotatePoints:Tc,unionBounds:Xu},Symbol.toStringTag,{value:"Module"}));class ft{constructor(e,t,n){this._root=kc,this._size=0,this._maxNodeSize=n>=4?Math.min(n,256):32,this._compare=t||ft.defaultComparator,e&&this.setPairs(e)}get size(){return this._size}get length(){return this._size}get isEmpty(){return this._size===0}clear(){this._root=kc,this._size=0}forEach(e,t){return t!==void 0&&(e=e.bind(t)),this.forEachPair((n,r)=>e(r,n,this))}forEachPair(e,t){const n=this.minKey(),r=this.maxKey();return this.forRange(n,r,!0,e,t)}get(e,t){return this._root.get(e,t,this)}set(e,t,n){this._root.isShared&&(this._root=this._root.clone());const r=this._root.set(e,t,n,this);return r===!0||r===!1?r:(this._root=new S_([this._root,r]),!0)}has(e){return this.forRange(e,e,!0,void 0)!==0}delete(e){return this.editRange(e,e,!0,ft.DeleteRange)!==0}with(e,t,n){const r=this.clone();return r.set(e,t,n)||n?r:this}withPairs(e,t){const n=this.clone();return n.setPairs(e,t)!==0||t?n:this}withKeys(e,t){const n=this.clone();let r=!1;for(let o=0;o<e.length;o++)r=n.set(e[o],void 0,!1)||r;return t&&!r?this:n}without(e,t){return this.withoutRange(e,e,!0,t)}withoutKeys(e,t){const n=this.clone();return n.deleteKeys(e)||!t?n:this}withoutRange(e,t,n,r){const o=this.clone();return o.deleteRange(e,t,n)===0&&r?this:o}filter(e,t){const n=this.greedyClone();let r;return n.editAll((o,i,l)=>{if(!e(o,i,l))return r=ft.DeleteValue}),!r&&t?this:n}mapValues(e){const t=this.greedyClone();return t.editAll((n,r,o)=>e(r,n,o)),t}reduce(e,t){let n,r=0,o=t;const i=this.entries(this.minKey());for(;!(n=i.next()).done;)o=e(o,n.value,r++,this);return o}entries(e,t){const n=this.findPath(e);if(n===void 0)return Wo();let{nodeQueue:r,nodeIndex:o,leaf:i}=n,l=t!==void 0?1:0,a=e===void 0?-1:i.indexOf(e,0,this._compare)-1;return Wo(()=>{e:for(;;)switch(l){case 0:if(++a<i.keys.length)return{done:!1,value:[i.keys[a],i.values[a]]};l=2;continue;case 1:if(++a<i.keys.length){const u=i.keys[a],d=i.values[a];return t?(t.done=!1,t.value[0]=u,t.value[1]=d,t):{done:!1,value:[u,d]}}l=2;case 2:for(var c=-1;;){if(++c>=r.length){l=3;continue e}if(++o[c]<r[c].length)break}for(;c>0;c--)r[c-1]=r[c][o[c]].children,o[c-1]=0;i=r[0][o[0]],a=-1,l=t!==void 0?1:0;continue;case 3:return Yu}})}entriesReversed(e,t,n){if(e===void 0&&(n=void 0,(e=this.maxKey())===void 0))return Wo();let{nodeQueue:r,nodeIndex:o,leaf:i}=this.findPath(e)||this.findPath(this.maxKey());Bn(!r[0]||i===r[0][o[0]],"wat!");let l=i.indexOf(e,0,this._compare);!n&&l<i.keys.length&&this._compare(i.keys[l],e)<=0&&l++;let a=t!==void 0?1:0;return Wo(()=>{e:for(;;)switch(a){case 0:if(--l>=0)return{done:!1,value:[i.keys[l],i.values[l]]};a=2;continue;case 1:if(--l>=0){const u=i.keys[l],d=i.values[l];return t?(t.done=!1,t.value[0]=u,t.value[1]=d,t):{done:!1,value:[u,d]}}a=2;case 2:for(var c=-1;;){if(++c>=r.length){a=3;continue e}if(--o[c]>=0)break}for(;c>0;c--)r[c-1]=r[c][o[c]].children,o[c-1]=r[c-1].length-1;i=r[0][o[0]],l=i.keys.length,a=t!==void 0?1:0;continue;case 3:return Yu}})}findPath(e){let t,n,r=this._root;if(r.isLeaf)t=zh,n=zh;else{t=[],n=[];for(let o=0;!r.isLeaf;o++){if(t[o]=r.children,n[o]=e===void 0?0:r.indexOf(e,0,this._compare),n[o]>=t[o].length)return;r=t[o][n[o]]}t.reverse(),n.reverse()}return{nodeQueue:t,nodeIndex:n,leaf:r}}diffAgainst(e,t,n,r){if(e._compare!==this._compare)throw new Error("SortedMap: Comparators are not the same.");if(this.isEmpty||e.isEmpty)return this.isEmpty&&e.isEmpty?void 0:this.isEmpty?n===void 0?void 0:ft.stepToEnd(ft.makeDiffCursor(e),n):t===void 0?void 0:ft.stepToEnd(ft.makeDiffCursor(this),t);const{_compare:o}=this,i=ft.makeDiffCursor(this),l=ft.makeDiffCursor(e);let a=!0,c=!0,u=ft.compare(i,l,o);for(;a&&c;){const d=ft.compare(i,l,o),{leaf:h,internalSpine:f,levelIndices:g}=i,{leaf:m,internalSpine:p,levelIndices:S}=l;if(h||m){if(u!==0){if(d===0){if(h&&m&&r){const w=h.values[g[g.length-1]],b=m.values[S[S.length-1]];if(!Object.is(w,b)){const C=r(i.currentKey,w,b);if(C&&C.break)return C.break}}}else if(d>0){if(m&&n){const w=m.values[S[S.length-1]],b=n(l.currentKey,w);if(b&&b.break)return b.break}}else if(t&&h&&u!==0){const w=h.values[g[g.length-1]],b=t(i.currentKey,w);if(b&&b.break)return b.break}}}else if(!h&&!m&&d===0){const w=f.length-1,b=p.length-1,C=f[w][g[w]];if(p[b][S[b]]===C){u=0,a=ft.step(i,!0),c=ft.step(l,!0);continue}}u=d,d<0?a=ft.step(i):c=ft.step(l)}return a&&t?ft.finishCursorWalk(i,l,o,t):c&&n?ft.finishCursorWalk(l,i,o,n):void 0}static finishCursorWalk(e,t,n,r){const o=ft.compare(e,t,n);if(o===0){if(!ft.step(e))return}else o<0&&Bn(!1,"cursor walk terminated early");return ft.stepToEnd(e,r)}static stepToEnd(e,t){let n=!0;for(;n;){const{leaf:r,levelIndices:o,currentKey:i}=e;if(r){const l=t(i,r.values[o[o.length-1]]);if(l&&l.break)return l.break}n=ft.step(e)}}static makeDiffCursor(e){const{_root:t,height:n}=e;return{height:n,internalSpine:[[t]],levelIndices:[0],leaf:void 0,currentKey:t.maxKey()}}static step(e,t){const{internalSpine:n,levelIndices:r,leaf:o}=e;if(t===!0||o){const i=r.length;if(t===!0||r[i-1]===0){const l=n.length;if(l===0)return!1;const a=l-1;let c=a;for(;c>=0;){if(r[c]>0)return c<i-1&&(e.leaf=void 0,r.pop()),c<a&&(e.internalSpine=n.slice(0,c+1)),e.currentKey=n[c][--r[c]].maxKey(),!0;c--}return!1}{const l=--r[i-1];return e.currentKey=o.keys[l],!0}}{const i=n.length,l=i-1,a=n[l][r[l]];if(a.isLeaf){e.leaf=a;const c=r[i]=a.values.length-1;e.currentKey=a.keys[c]}else{const c=a.children;n[i]=c;const u=c.length-1;r[i]=u,e.currentKey=c[u].maxKey()}return!0}}static compare(e,t,n){const{height:r,currentKey:o,levelIndices:i}=e,{height:l,currentKey:a,levelIndices:c}=t,u=n(a,o);if(u!==0)return u;const d=r<l?r:l;return i.length-(r-d)-(c.length-(l-d))}keys(e,t){const n=this.entries(e,t);return Wo(()=>{const r=n.next();return r.value&&(r.value=r.value[0]),r})}values(e,t){const n=this.entries(e,t);return Wo(()=>{const r=n.next();return r.value&&(r.value=r.value[1]),r})}get maxNodeSize(){return this._maxNodeSize}minKey(){return this._root.minKey()}maxKey(){return this._root.maxKey()}clone(){this._root.isShared=!0;const e=new ft(void 0,this._compare,this._maxNodeSize);return e._root=this._root,e._size=this._size,e}greedyClone(e){const t=new ft(void 0,this._compare,this._maxNodeSize);return t._root=this._root.greedyClone(e),t._size=this._size,t}toArray(e=2147483647){const t=this.minKey(),n=this.maxKey();return t!==void 0?this.getRange(t,n,!0,e):[]}keysArray(){const e=[];return this._root.forRange(this.minKey(),this.maxKey(),!0,!1,this,0,(t,n)=>{e.push(t)}),e}valuesArray(){const e=[];return this._root.forRange(this.minKey(),this.maxKey(),!0,!1,this,0,(t,n)=>{e.push(n)}),e}toString(){return this.toArray().toString()}setIfNotPresent(e,t){return this.set(e,t,!1)}nextHigherPair(e,t){return e===void 0?this._root.minPair(t):this._root.getPairOrNextHigher(e,this._compare,!1,t)}nextHigherKey(e,t){const n=this.nextHigherPair(e,t);return n&&n[0]}nextLowerPair(e,t){return e===void 0?this._root.maxPair(t):this._root.getPairOrNextLower(e,this._compare,!1,t)}nextLowerKey(e,t){const n=this.nextLowerPair(e,t);return n&&n[0]}getPairOrNextLower(e,t){return this._root.getPairOrNextLower(e,this._compare,!0,t)}getPairOrNextHigher(e,t){return this._root.getPairOrNextHigher(e,this._compare,!0,t)}changeIfPresent(e,t){return this.editRange(e,e,!0,(n,r)=>({value:t}))!==0}getRange(e,t,n,r=67108863){const o=[];return this._root.forRange(e,t,n,!1,this,0,(i,l)=>(o.push([i,l]),o.length>r?ft.Break:void 0)),o}setPairs(e,t){let n=0;for(let r=0;r<e.length;r++)this.set(e[r][0],e[r][1],t)&&n++;return n}forRange(e,t,n,r,o){const i=this._root.forRange(e,t,n,!1,this,o||0,r);return typeof i=="number"?i:i.break}forEditRange(e,t,n,r,o,i){return this._root.forRange(e,t,n,r,this,i||0,o)}editRange(e,t,n,r,o){let i=this._root;i.isShared&&(this._root=i=i.clone());try{const l=i.forRange(e,t,n,!0,this,o||0,r);return typeof l=="number"?l:l.break}finally{let l;for(;i.keys.length<=1&&!i.isLeaf;)l||=i.isShared,this._root=i=i.keys.length===0?kc:i.children[0];l&&(i.isShared=!0)}}editAll(e,t){return this.editRange(this.minKey(),this.maxKey(),!0,e,t)}deleteRange(e,t,n){return this.editRange(e,t,n,ft.DeleteRange)}deleteKeys(e){let t=0;for(let n=0;n<e.length;n++)this.delete(e[n])&&t++;return t}get height(){let e=this._root,t=-1;for(;e;)t++,e=e.isLeaf?void 0:e.children[0];return t}freeze(){const e=this;e.clear=e.set=e.editRange=function(){throw new Error("SortedMap: Attempted to modify when frozen.")}}unfreeze(){delete this.clear,delete this.set,delete this.editRange}get isFrozen(){return this.hasOwnProperty("editRange")}checkValid(){const e=this._root.checkValid(0,this,0);Bn(e===this.size,"size mismatch: counted ",e,"but stored",this.size)}}function Wo(s=()=>Yu){const e={next:s};return Symbol&&Symbol.iterator&&(e[Symbol.iterator]=function(){return this}),e}Symbol&&Symbol.iterator&&(ft.prototype[Symbol.iterator]=ft.prototype.entries),ft.prototype.where=ft.prototype.filter,ft.prototype.setRange=ft.prototype.setPairs,ft.prototype.add=ft.prototype.set;let $p=class Qu{get isLeaf(){return this.children===void 0}constructor(e=[],t){this.keys=e,this.values=t||fn,this.isShared=void 0}maxKey(){return this.keys[this.keys.length-1]}indexOf(e,t,n){const r=this.keys;let o=0,i=r.length,l=i>>1;for(;o<i;){const a=n(r[l],e);if(a<0)o=l+1;else{if(!(a>0)){if(a===0)return l;if(e==e)return r.length;throw new Error("SortedMap: NaN was used as a key.")}i=l}l=o+i>>1}return l^t}minKey(){return this.keys[0]}minPair(e){if(this.keys.length!==0)return(e=e??[null,null])[0]=this.keys[0],e[1]=this.values[0],e}maxPair(e){if(this.keys.length===0)return;const t=this.keys.length-1;return(e=e??[null,null])[0]=this.keys[t],e[1]=this.values[t],e}clone(){const e=this.values,t=e===fn?e:e.slice(0),n=this.keys.slice(0);return new Qu(n,t)}greedyClone(e){return this.isShared&&!e?this:this.clone()}get(e,t,n){const r=this.indexOf(e,-1,n._compare);return r<0?t:this.values[r]}getPairOrNextLower(e,t,n,r){const o=this.indexOf(e,-1,t),i=o<0?~o-1:n?o:o-1;if(i>=0){const l=this.keys[i],a=this.values[i];return r?(r[0]=l,r[1]=a,r):[l,a]}}getPairOrNextHigher(e,t,n,r){const o=this.indexOf(e,-1,t),i=o<0?~o:n?o:o+1;if(i<this.keys.length){const l=this.keys[i],a=this.values[i];return r?(r[0]=l,r[1]=a,r):[l,a]}}checkValid(e,t,n){const r=this.keys.length,o=this.values.length;return Bn(this.values===fn?r<=o:r===o,"keys/values length mismatch: depth",e,"with lengths",r,o,"and baseIndex",n),Bn(e===0||r>0,"empty leaf at depth",e,"and baseIndex",n),r}set(e,t,n,r){let o=this.indexOf(e,-1,r._compare);if(o<0){if(o=~o,r._size++,this.keys.length<r._maxNodeSize)return this.insertInLeaf(o,e,t,n,r);{const i=this.splitOffRightSide();let l=this;return o>this.keys.length&&(o-=this.keys.length,l=i),l.insertInLeaf(o,e,t,n,r),i}}if(n!==!1){t!==void 0&&this.reifyValues(),this.keys[o]=e;let i=t;if(typeof n=="function"){const l=n(this.values[o],e,t);l!==void 0&&(i=l)}this.values[o]=i}return!1}reifyValues(){return this.values===fn?this.values=this.values.slice(0,this.keys.length):this.values}insertInLeaf(e,t,n,r,o){if(this.keys.splice(e,0,t),this.values===fn){for(;fn.length<o._maxNodeSize;)fn.push(void 0);if(n===void 0)return!0;this.values=fn.slice(0,this.keys.length-1)}let i=n;if(typeof r=="function"){const l=r(void 0,t,n);l!==void 0&&(i=l)}return this.values.splice(e,0,i),!0}takeFromRight(e){let t=this.values;e.values===fn?t!==fn&&t.push(void 0):(t=this.reifyValues(),t.push(e.values.shift())),this.keys.push(e.keys.shift())}takeFromLeft(e){let t=this.values;e.values===fn?t!==fn&&t.unshift(void 0):(t=this.reifyValues(),t.unshift(e.values.pop())),this.keys.unshift(e.keys.pop())}splitOffRightSide(){const e=this.keys.length>>1,t=this.keys.splice(e),n=this.values===fn?fn:this.values.splice(e);return new Qu(t,n)}forRange(e,t,n,r,o,i,l){const a=o._compare;let c,u;if(t===e){if(!n||(u=(c=this.indexOf(e,-1,a))+1,c<0))return i}else c=this.indexOf(e,0,a),u=this.indexOf(t,-1,a),u<0?u=~u:n===!0&&u++;const d=this.keys,h=this.values;if(l!==void 0)for(let f=c;f<u;f++){const g=d[f],m=l(g,h[f],i++);if(m!==void 0){if(m.break!==void 0)return m;if(r===!0){if(g!==d[f]&&o._compare(g,d[f])!==0||this.isShared===!0)throw new Error("SortedMap: illegally changed or cloned in editRange.");m.delete?(this.keys.splice(f,1),this.values!==fn&&this.values.splice(f,1),o._size--,f--,u--):m.hasOwnProperty("value")&&(h[f]=m.value)}}}else i+=u-c;return i}mergeSibling(e,t){if(this.keys.push.apply(this.keys,e.keys),this.values===fn){if(e.values===fn)return;this.values=this.values.slice(0,this.keys.length)}this.values.push.apply(this.values,e.reifyValues())}},S_=class Vl extends $p{constructor(e,t){if(!t){t=[];for(let n=0;n<e.length;n++)t[n]=e[n].maxKey()}super(t),this.children=e}clone(){const e=this.children.slice(0);for(let t=0;t<e.length;t++)e[t].isShared=!0;return new Vl(e,this.keys.slice(0))}greedyClone(e){if(this.isShared&&!e)return this;const t=new Vl(this.children.slice(0),this.keys.slice(0));for(let n=0;n<t.children.length;n++)t.children[n]=t.children[n].greedyClone(e);return t}minKey(){return this.children[0].minKey()}minPair(e){return this.children[0].minPair(e)}maxPair(e){return this.children[this.children.length-1].maxPair(e)}get(e,t,n){const r=this.indexOf(e,0,n._compare),o=this.children;return r<o.length?o[r].get(e,t,n):void 0}getPairOrNextLower(e,t,n,r){const o=this.indexOf(e,0,t),i=this.children;if(o>=i.length)return this.maxPair(r);const l=i[o].getPairOrNextLower(e,t,n,r);return l===void 0&&o>0?i[o-1].maxPair(r):l}getPairOrNextHigher(e,t,n,r){const o=this.indexOf(e,0,t),i=this.children,l=i.length;if(o>=l)return;const a=i[o].getPairOrNextHigher(e,t,n,r);return a===void 0&&o<l-1?i[o+1].minPair(r):a}checkValid(e,t,n){const r=this.keys.length,o=this.children.length;Bn(r===o,"keys/children length mismatch: depth",e,"lengths",r,o,"baseIndex",n),Bn(r>1||e>0,"internal node has length",r,"at depth",e,"baseIndex",n);let i=0,l=this.children,a=this.keys,c=0;for(let d=0;d<o;d++)i+=l[d].checkValid(e+1,t,n+i),c+=l[d].keys.length,Bn(i>=c,"wtf",n),Bn(d===0||l[d-1].constructor===l[d].constructor,"type mismatch, baseIndex:",n),l[d].maxKey()!==a[d]&&Bn(!1,"keys[",d,"] =",a[d],"is wrong, should be ",l[d].maxKey(),"at depth",e,"baseIndex",n),d===0||t._compare(a[d-1],a[d])<0||Bn(!1,"sort violation at depth",e,"index",d,"keys",a[d-1],a[d]);const u=c===0;return(u||c>t.maxNodeSize*o)&&Bn(!1,u?"too few":"too many","children (",c,i,") at depth",e,"maxNodeSize:",t.maxNodeSize,"children.length:",o,"baseIndex:",n),i}set(e,t,n,r){const o=this.children,i=r._maxNodeSize,l=r._compare;let a=Math.min(this.indexOf(e,0,l),o.length-1),c=o[a];if(c.isShared&&(o[a]=c=c.clone()),c.keys.length>=i){let d;a>0&&(d=o[a-1]).keys.length<i&&l(c.keys[0],e)<0?(d.isShared&&(o[a-1]=d=d.clone()),d.takeFromRight(c),this.keys[a-1]=d.maxKey()):(d=o[a+1])!==void 0&&d.keys.length<i&&l(c.maxKey(),e)<0&&(d.isShared&&(o[a+1]=d=d.clone()),d.takeFromLeft(c),this.keys[a]=o[a].maxKey())}const u=c.set(e,t,n,r);if(u===!1)return!1;if(this.keys[a]=c.maxKey(),u===!0)return!0;if(this.keys.length<i)return this.insert(a+1,u),!0;{const d=this.splitOffRightSide();let h=this;return l(u.maxKey(),this.maxKey())>0&&(h=d,a-=this.keys.length),h.insert(a+1,u),d}}insert(e,t){this.children.splice(e,0,t),this.keys.splice(e,0,t.maxKey())}splitOffRightSide(){const e=this.children.length>>1;return new Vl(this.children.splice(e),this.keys.splice(e))}takeFromRight(e){this.keys.push(e.keys.shift()),this.children.push(e.children.shift())}takeFromLeft(e){this.keys.unshift(e.keys.pop()),this.children.unshift(e.children.pop())}forRange(e,t,n,r,o,i,l){const a=o._compare,c=this.keys,u=this.children;let d=this.indexOf(e,0,a),h=d,f=Math.min(t===e?d:this.indexOf(t,0,a),c.length-1);if(r){if(h<=f)try{for(;h<=f;h++){u[h].isShared&&(u[h]=u[h].clone());const g=u[h].forRange(e,t,n,r,o,i,l);if(c[h]=u[h].maxKey(),typeof g!="number")return g;i=g}}finally{const g=o._maxNodeSize>>1;for(d>0&&d--,h=f;h>=d;h--)u[h].keys.length<=g&&(u[h].keys.length!==0?this.tryMerge(h,o._maxNodeSize):(c.splice(h,1),u.splice(h,1)));u.length!==0&&u[0].keys.length===0&&Bn(!1,"emptiness bug")}}else for(;h<=f;h++){const g=u[h].forRange(e,t,n,r,o,i,l);if(typeof g!="number")return g;i=g}return i}tryMerge(e,t){const n=this.children;return e>=0&&e+1<n.length&&n[e].keys.length+n[e+1].keys.length<=t&&(n[e].isShared&&(n[e]=n[e].clone()),n[e].mergeSibling(n[e+1],t),n.splice(e+1,1),this.keys.splice(e+1,1),this.keys[e]=n[e].maxKey(),!0)}mergeSibling(e,t){const n=this.keys.length;this.keys.push.apply(this.keys,e.keys);const r=e.children;if(this.children.push.apply(this.children,r),e.isShared&&!this.isShared)for(let o=0;o<r.length;o++)r[o].isShared=!0;this.tryMerge(n-1,t)}};const fn=[],Yu=Object.freeze({done:!0,value:void 0}),kc=(function(){const s=new $p;return s.isShared=!0,s})(),zh=[],Bn=(s,...e)=>{if(!s)throw e.unshift("SortedMap:"),new Error(e.join(" "))};var Wr;(Wr=ft||(ft={})).DeleteValue=Object.freeze({delete:!0}),Wr.Break=Object.freeze({break:!0}),Wr.DeleteRange=()=>Wr.DeleteValue,Wr.EmptySortedMap=(()=>{const s=new Wr;return s.freeze(),s})(),Wr.defaultComparator=function(s,e){if(Number.isFinite(s)&&Number.isFinite(e))return s-e;let t=typeof s,n=typeof e;if(t!==n)return t<n?-1:1;if(t==="object"){if(s===null)return e===null?0:-1;if(e===null)return 1;if(t=typeof(s=s.valueOf()),n=typeof(e=e.valueOf()),t!==n)return t<n?-1:1}return s<e?-1:s>e?1:s===e?0:Number.isNaN(s)?Number.isNaN(e)?0:-1:Number.isNaN(e)?1:Array.isArray(s)?0:Number.NaN},Wr.simpleComparator=function(s,e){return s>e?1:s<e?-1:0};const Ph=[-1,null],w_={done:!1,value:[-1,null]};var Mt;(s=>{s.Builder=class{constructor(t,n=0,r=0){this._tuples=[],this._minors=null,this._values=null,this._minorMin=Number.MAX_SAFE_INTEGER,this._minorMax=0,this._majorIndex=Number.MIN_SAFE_INTEGER,this._minorIndex=Number.MIN_SAFE_INTEGER,this._offsetMajor=0,this._offsetMinor=0,this._createList=t,this._offsetMajor=n,this._offsetMinor=r}addValues(t,n,r){if(r&&r.isIList)return this.addValue(t,n,r);Array.isArray(r)||(r=[r]),this.addValue(t,n,r[0]);const o=r.length,i=this._values;for(let l=1;l<o;l++)i.push(r[l]);return this._minorIndex=this._minorIndex+i.length-1,this}addValue(t,n,r){const o=this._majorIndex,i=this._minorIndex;if(t+=this._offsetMajor,n+=this._offsetMinor,t<o||t===o&&n<=i)throw new e(`major: ${t}, minor: ${n}, prevMajor: ${this._majorIndex}, prevMinor: ${this._minorIndex}`);let l=this._minors;if(t!==o){if(l){this._minorMin=Math.min(this._minorMin,l[0][0]);const a=l[l.length-1];this._minorMax=Math.max(this._minorMax,a[0]+a[1].length-1)}this._minors=l=[],this._tuples.push([t,l]),this._majorIndex=t}if(r&&r.isIList){n===i+1&&o!==t&&this._values;const a=r;l.push([n,a]),n=n+a.length-1}else{let a=null;n!==i+1||o!==t?(this._values=a=[],l.push([n,a])):a=this._values,a.push(r)}return this._minorIndex=n,this}build(){const t=this._tuples;if(t.length===0)return null;const n=this._minors;this._minorMin=Math.min(this._minorMin,n[0][0]);const r=n[n.length-1];this._minorMax=Math.max(this._minorMax,r[0]+r[1].length-1);const o=this._createList;if(o){const i=n.length;for(let l=0;l<i;l++)n[l][1]=o(n[l][1])}return{tuples:t,bounds:{majorStart:t[0][0],minorStart:this._minorMin,majorEnd:t[t.length-1][0],minorEnd:this._minorMax}}}},s.TransposedBuilder=class{constructor(t,n=0,r=0){this._majorMin=Number.MAX_SAFE_INTEGER,this._majorMax=0,this._majorIndex=Number.MIN_SAFE_INTEGER,this._minorIndex=Number.MIN_SAFE_INTEGER,this._offsetMajor=0,this._offsetMinor=0,this._createList=t,this._offsetMajor=n,this._offsetMinor=r,this._minors=new ft}addValues(t,n,r){Array.isArray(r)||(r=[r]);const o=r.length;for(let i=0;i<o;i++){const l=n+i;this.addValue(t,l,r[i])}return this}addValue(t,n,r){let o,i;const l=this._majorIndex;let a=this._minorIndex;if(t+=this._offsetMajor,n+=this._offsetMinor,i=this._current,t!==l){if(this._majorIndex=t,t<l)throw new e(`major: ${t}, minor: ${n}, prevMajor: ${this._majorIndex}, prevMinor: ${this._minorIndex}`);a=Number.MIN_SAFE_INTEGER}else if(i=this._current,n<=a)throw new e(`major: ${t}, minor: ${n}, prevMajor: ${this._majorIndex}, prevMinor: ${this._minorIndex}`);if(i&&i.minor===n&&(o=i.span),o)i.minor>=n&&i.next&&(this._current=i.next);else{const f=this._minors,g=i?i.next??i.prev:null;if(g){let m;const p=g.minor;g&&g.minor===n?(i=g,o=i.span):m=p>n?f.getPairOrNextHigher(n,Ph):f.getPairOrNextLower(n,Ph),m&&(i=m[1],m[0]===n&&(o=i.span))}if(!o){this._majorMin=Math.min(this._majorMin,t),o=[n,[[t,[]]]];const m={minor:n,span:o,prev:null,next:null};i&&(i.minor<n?(m.prev=i,m.next=i.next,i.next&&(i.next.prev=m),i.next=m):(m.prev=i.prev,m.next=i,i.prev&&(i.prev.next=m),i.prev=m)),f.set(n,m),this._current=m;const p=this._first;(!p||n<p.minor)&&(this._first=m),m.next&&(this._current=m.next)}}let c=o[1];const u=c[c.length-1];let d=u[0],h=u[1];return d+h.length!==t&&(h=[],d=t,c.push([d,h])),h.push(r),this._majorMax=Math.max(this._majorMax,t),this._minorIndex=n,this}build(){const t=[],n=this._createList,r=this._minors.entries(void 0,w_);let o=r.next();for(;!o.done;){const i=o.value[1].span;if(n){const l=i.length;for(let a=0;a<l;a++)i[a][1]=this._createList(i[a][1])}t.push(i),o=r.next()}return t.length===0?null:{tuples:t,bounds:{majorStart:t[0][0],minorStart:this._majorMin,majorEnd:t[t.length-1][0],minorEnd:this._majorMax}}}};class e extends qw{constructor(n="Out of order",r=null){super(n,r),this.name="OutOfOrderError"}}s.OutOfOrderError=e})(Mt||(Mt={}));const __={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function Fc(s){return(e={})=>{const t=e.width?String(e.width):s.defaultWidth;return s.formats[t]||s.formats[s.defaultWidth]}}const y_={date:Fc({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:Fc({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:Fc({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},b_={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function zs(s){return(e,t)=>{let n;if((t?.context?String(t.context):"standalone")==="formatting"&&s.formattingValues){const r=s.defaultFormattingWidth||s.defaultWidth,o=t?.width?String(t.width):r;n=s.formattingValues[o]||s.formattingValues[r]}else{const r=s.defaultWidth,o=t?.width?String(t.width):s.defaultWidth;n=s.values[o]||s.values[r]}return n[s.argumentCallback?s.argumentCallback(e):e]}}function Ps(s){return(e,t={})=>{const n=t.width,r=n&&s.matchPatterns[n]||s.matchPatterns[s.defaultMatchWidth],o=e.match(r);if(!o)return null;const i=o[0],l=n&&s.parsePatterns[n]||s.parsePatterns[s.defaultParseWidth],a=Array.isArray(l)?(function(u,d){for(let h=0;h<u.length;h++)if(d(u[h]))return h})(l,u=>u.test(i)):(function(u,d){for(const h in u)if(Object.prototype.hasOwnProperty.call(u,h)&&d(u[h]))return h})(l,u=>u.test(i));let c;return c=s.valueCallback?s.valueCallback(a):a,c=t.valueCallback?t.valueCallback(c):c,{value:c,rest:e.slice(i.length)}}}var Hs;const C_={code:"en-US",formatDistance:(s,e,t)=>{let n;const r=__[s];return n=typeof r=="string"?r:e===1?r.one:r.other.replace("{{count}}",e.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+n:n+" ago":n},formatLong:y_,formatRelative:(s,e,t,n)=>b_[s],localize:{ordinalNumber:(s,e)=>{const t=Number(s),n=t%100;if(n>20||n<10)switch(n%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},era:zs({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:zs({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:s=>s-1}),month:zs({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:zs({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:zs({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(Hs={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:s=>parseInt(s,10)},(s,e={})=>{const t=s.match(Hs.matchPattern);if(!t)return null;const n=t[0],r=s.match(Hs.parsePattern);if(!r)return null;let o=Hs.valueCallback?Hs.valueCallback(r[0]):r[0];return o=e.valueCallback?e.valueCallback(o):o,{value:o,rest:s.slice(n.length)}}),era:Ps({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:Ps({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:s=>s+1}),month:Ps({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:Ps({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:Ps({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}},Hh=(s,e)=>{switch(s){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});default:return e.date({width:"full"})}},$h=(s,e)=>{switch(s){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});default:return e.time({width:"full"})}},Vh={p:$h,P:(s,e)=>{const t=s.match(/(P+)(p+)?/)||[],n=t[1],r=t[2];if(!r)return Hh(s,e);let o;switch(n){case"P":o=e.dateTime({width:"short"});break;case"PP":o=e.dateTime({width:"medium"});break;case"PPP":o=e.dateTime({width:"long"});break;default:o=e.dateTime({width:"full"})}return o.replace("{{date}}",Hh(n,e)).replace("{{time}}",$h(r,e))}},v_=/^D+$/,x_=/^Y+$/,E_=["D","DD","YY","YYYY"];function R_(s){return v_.test(s)}function I_(s){return x_.test(s)}function Wh(s,e,t){const n=(function(r,o,i){const l=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${o}\`) for formatting ${l} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`})(s,e,t);if(console.warn(n),E_.includes(s))throw new RangeError(n)}const jh=Symbol.for("constructDateFrom");function us(s,e){return typeof s=="function"?s(e):s&&typeof s=="object"&&jh in s?s[jh](e):s instanceof Date?new s.constructor(e):new Date(e)}let A_={};function Vp(){return A_}function ba(s,e){return us(e||s,s)}class Wp{constructor(){this.subPriority=0}validate(e,t){return!0}}class M_ extends Wp{constructor(e,t,n,r,o){super(),this.value=e,this.validateValue=t,this.setValue=n,this.priority=r,o&&(this.subPriority=o)}validate(e,t){return this.validateValue(e,this.value,t)}set(e,t,n){return this.setValue(e,t,this.value,n)}}class T_ extends Wp{constructor(e,t){super(),this.priority=10,this.subPriority=-1,this.context=e||(n=>us(t,n))}set(e,t){return t.timestampIsSet?e:us(e,(function(n,r){const o=(function(i){return typeof i=="function"&&i.prototype?.constructor===i})(r)?new r(0):us(r,0);return o.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),o.setHours(n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),o})(e,this.context))}}let Wl=class{run(e,t,n,r){const o=this.parse(e,t,n,r);return o?{setter:new M_(o.value,this.validate,this.set,this.priority,this.subPriority),rest:o.rest}:null}validate(e,t,n){return!0}};const jp=/^(1[0-2]|0?\d)/,k_=/^(3[0-1]|[0-2]?\d)/,F_=/^\d/,N_=/^\d{1,2}/,O_=/^\d{1,3}/,D_=/^\d{1,4}/;function Dr(s,e){return s&&{value:e(s.value),rest:s.rest}}function eo(s,e){const t=e.match(s);return t?{value:parseInt(t[0],10),rest:e.slice(t[0].length)}:null}function vi(s,e){switch(s){case 1:return eo(F_,e);case 2:return eo(N_,e);case 3:return eo(O_,e);case 4:return eo(D_,e);default:return eo(new RegExp("^\\d{1,"+s+"}"),e)}}class Gp extends Wl{constructor(){super(...arguments),this.incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"],this.priority=110}parse(e,t,n){const r=o=>o-1;switch(t){case"M":return Dr(eo(jp,e),r);case"MM":return Dr(vi(2,e),r);case"Mo":return Dr(n.ordinalNumber(e,{unit:"month"}),r);case"MMM":return n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return n.month(e,{width:"narrow",context:"formatting"});default:return n.month(e,{width:"wide",context:"formatting"})||n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=11}set(e,t,n){return e.setMonth(n,1),e.setHours(0,0,0,0),e}}const L_=[31,28,31,30,31,30,31,31,30,31,30,31],B_=[31,29,31,30,31,30,31,31,30,31,30,31];function z_(s,e,t){const n=Vp(),r=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,o=ba(s,t?.in),i=o.getDay(),l=7-r;return(function(a,c,u){const d=ba(a,u?.in);return isNaN(c)?us(u?.in||a,NaN):(c&&d.setDate(d.getDate()+c),d)})(o,e<0||e>6?e-(i+l)%7:((e%7+7)%7+l)%7-(i+l)%7,t)}const ai={y:new class extends Wl{constructor(){super(...arguments),this.priority=130,this.incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"]}parse(s,e,t){const n=r=>({year:r,isTwoDigitYear:e==="yy"});switch(e){case"y":return Dr(vi(4,s),n);case"yo":return Dr(t.ordinalNumber(s,{unit:"year"}),n);default:return Dr(vi(e.length,s),n)}}validate(s,e){return e.isTwoDigitYear||e.year>0}set(s,e,t){const n=s.getFullYear();if(t.isTwoDigitYear){const o=(function(i,l){const a=l>0,c=a?l:1-l;let u;if(c<=50)u=i||100;else{const d=c+50;u=i+100*Math.trunc(d/100)-(i>=d%100?100:0)}return a?u:1-u})(t.year,n);return s.setFullYear(o,0,1),s.setHours(0,0,0,0),s}const r="era"in e&&e.era!==1?1-t.year:t.year;return s.setFullYear(r,0,1),s.setHours(0,0,0,0),s}},M:new Gp,d:new class extends Wl{constructor(){super(...arguments),this.priority=90,this.subPriority=1,this.incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]}parse(s,e,t){switch(e){case"d":return eo(k_,s);case"do":return t.ordinalNumber(s,{unit:"date"});default:return vi(e.length,s)}}validate(s,e){const t=(function(r){return r%400==0||r%4==0&&r%100!=0})(s.getFullYear()),n=s.getMonth();return t?e>=1&&e<=B_[n]:e>=1&&e<=L_[n]}set(s,e,t){return s.setDate(t),s.setHours(0,0,0,0),s}},E:new class extends Wl{constructor(){super(...arguments),this.priority=90,this.incompatibleTokens=["D","i","e","c","t","T"]}parse(s,e,t){switch(e){case"E":case"EE":case"EEE":return t.day(s,{width:"abbreviated",context:"formatting"})||t.day(s,{width:"short",context:"formatting"})||t.day(s,{width:"narrow",context:"formatting"});case"EEEEE":return t.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(s,{width:"short",context:"formatting"})||t.day(s,{width:"narrow",context:"formatting"});default:return t.day(s,{width:"wide",context:"formatting"})||t.day(s,{width:"abbreviated",context:"formatting"})||t.day(s,{width:"short",context:"formatting"})||t.day(s,{width:"narrow",context:"formatting"})}}validate(s,e){return e>=0&&e<=6}set(s,e,t,n){return(s=z_(s,t,n)).setHours(0,0,0,0),s}}},P_=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,H_=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,$_=/^'([^]*?)'?$/,V_=/''/g,W_=/\S/,j_=/[a-zA-Z]/;function G_(s,e,t,n){const r=()=>us(n?.in||t,NaN),o=Object.assign({},Vp()),i=n?.locale??o.locale??C_,l=n?.firstWeekContainsDate??n?.locale?.options?.firstWeekContainsDate??o.firstWeekContainsDate??o.locale?.options?.firstWeekContainsDate??1,a=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??o.weekStartsOn??o.locale?.options?.weekStartsOn??0;if(!e)return s?r():ba(t,n?.in);const c={firstWeekContainsDate:l,weekStartsOn:a,locale:i},u=[new T_(n?.in,t)],d=e.match(H_).map(p=>{const S=p[0];return S in Vh?(0,Vh[S])(p,i.formatLong):p}).join("").match(P_),h=[];for(let p of d){!n?.useAdditionalWeekYearTokens&&I_(p)&&Wh(p,e,s),!n?.useAdditionalDayOfYearTokens&&R_(p)&&Wh(p,e,s);const S=p[0],w=ai[S];if(w){const{incompatibleTokens:b}=w;if(Array.isArray(b)){const _=h.find(y=>b.includes(y.token)||y.token===S);if(_)throw new RangeError(`The format string mustn't contain \`${_.fullToken}\` and \`${p}\` at the same time`)}else if(w.incompatibleTokens==="*"&&h.length>0)throw new RangeError(`The format string mustn't contain \`${p}\` and any other token at the same time`);h.push({token:S,fullToken:p});const C=w.run(s,p,i.match,c);if(!C)return r();u.push(C.setter),s=C.rest}else{if(S.match(j_))throw new RangeError("Format string contains an unescaped latin alphabet character `"+S+"`");if(p==="''"?p="'":S==="'"&&(p=U_(p)),s.indexOf(p)!==0)return r();s=s.slice(p.length)}}if(s.length>0&&W_.test(s))return r();const f=u.map(p=>p.priority).sort((p,S)=>S-p).filter((p,S,w)=>w.indexOf(p)===S).map(p=>u.filter(S=>S.priority===p).sort((S,w)=>w.subPriority-S.subPriority)).map(p=>p[0]);let g=ba(t,n?.in);if(isNaN(+g))return r();const m={};for(const p of f){if(!p.validate(g,c))return r();const S=p.set(g,m,c);Array.isArray(S)?(g=S[0],Object.assign(m,S[1])):g=S}return g}function U_(s){return s.match($_)[1].replace(V_,"'")}const Up=s=>!isNaN(s)&&(Object.prototype.toString.call(s)==="[object Date]"||s instanceof Date);function Gh(s,e,t){let n=s,r=s.length,o=e.length;for(var i=r;i<o;++i){const l=e[i];if(l==="#")return n;n=t?n+l:l+n}return n}function Pn(s,e){for(var t="";t.length<e;)t+=s;return t}function ds(s){for(var e="",t=s.length-1;t>=0;)e+=s.charAt(t--);return e}function Zn(s,e){var t=""+s;return t.length>=e?t:Pn("0",e-t.length)+t}function ed(s,e){var t=""+s;return t.length>=e?t:Pn(" ",e-t.length)+t}function Ca(s,e){var t=""+s;return t.length>=e?t:t+Pn(" ",e-t.length)}var Uh=Math.pow(2,32);function jo(s,e){return s>Uh||s<-Uh?(function(t,n){var r=""+Math.round(t);return r.length>=n?r:Pn("0",n-r.length)+r})(s,e):(function(t,n){var r=""+t;return r.length>=n?r:Pn("0",n-r.length)+r})(Math.round(s),e)}function jl(s,e){return e=e||0,s.length>=7+e&&(32|s.charCodeAt(e))==103&&(32|s.charCodeAt(e+1))==101&&(32|s.charCodeAt(e+2))==110&&(32|s.charCodeAt(e+3))==101&&(32|s.charCodeAt(e+4))==114&&(32|s.charCodeAt(e+5))==97&&(32|s.charCodeAt(e+6))==108}var qh=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],Nc=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]],vo={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",5:"$#,##0_);($#,##0)",6:"$#,##0_);[Red]($#,##0)",7:"$#,##0.00_);($#,##0.00)",8:"$#,##0.00_);[Red]($#,##0.00)",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",23:"General",24:"General",25:"General",26:"General",27:"m/d/yyyy",28:"m/d/yyyy",29:"m/d/yyyy",30:"m/d/yyyy",32:"h:mm:ss",31:"m/d/yyyy",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yyyy",37:"#,##0_);(#,##0)",38:"#,##0_);[Red](#,##0)",39:"#,##0.00_);(#,##0.00)",40:"#,##0.00_);[Red](#,##0.00)",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_($* #,##0_);_($* (#,##0);_($* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)',45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",50:"m/d/yyyy",51:"m/d/yyyy",52:"m/d/yyyy",53:"m/d/yyyy",54:"m/d/yyyy",55:"m/d/yyyy",56:'"上午/下午 "hh"時"mm"分"ss"秒 "'},Jh={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},q_={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function va(s,e,t){for(var n=s<0?-1:1,r=s*n,o=0,i=1,l=0,a=1,c=0,u=0,d=Math.floor(r);c<e&&(l=(d=Math.floor(r))*i+o,u=d*c+a,!(r-d<5e-8));)r=1/(r-d),o=i,i=l,a=c,c=u;if(u>e&&(c>e?(u=a,l=o):(u=c,l=i)),!t)return[0,n*l,u];var h=Math.floor(n*l/u);return[h,n*l-h*u,u]}function ci(s,e,t){if(s>2958465||s<0)return null;var n=0|s,r=Math.floor(86400*(s-n)),o=0,i=[],l={D:n,T:r,u:86400*(s-n)-r,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(l.u)<1e-6&&(l.u=0),e&&e.date1904&&(n+=1462),l.u>.9999&&(l.u=0,++r===86400&&(l.T=r=0,++n,++l.D)),n===60)i=t?[1317,10,29]:[1900,2,29],o=3;else if(n===0)i=t?[1317,8,29]:[1900,1,0],o=6;else{n>60&&--n;var a=new Date(1900,0,1);a.setDate(a.getDate()+n-1),i=[a.getFullYear(),a.getMonth()+1,a.getDate()],o=a.getDay(),n<60&&(o=(o+6)%7),t&&(o=(function(c,u){u[0]-=581;var d=c.getDay();return c<60&&(d=(d+6)%7),d})(a,i))}return l.y=i[0],l.m=i[1],l.d=i[2],l.S=r%60,r=Math.floor(r/60),l.M=r%60,r=Math.floor(r/60),l.H=r,l.q=o,l}var qp=new Date(1899,11,31,0,0,0),J_=qp.getTime(),K_=new Date(1900,2,1,0,0,0);function qd(s,e=!1){var t=s.getTime();return e?t-=1262304e5:s>=K_&&(t+=864e5),(t-(J_+6e4*(s.getTimezoneOffset()-qp.getTimezoneOffset())))/864e5}function Oc(s){return s.indexOf(".")===-1?s:s.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function X_(s){var e,t=Math.floor(Math.log(Math.abs(s))*Math.LOG10E);return e=t>=-4&&t<=-1?s.toPrecision(10+t):Math.abs(t)<=9?(function(n){var r=n<0?12:11,o=Oc(n.toFixed(12));return o.length<=r||(o=n.toPrecision(10)).length<=r?o:n.toExponential(5)})(s):t===10?s.toFixed(10).substr(0,12):(function(n){var r=Oc(n.toFixed(11));return r.length>(n<0?12:11)||r==="0"||r==="-0"?n.toPrecision(6):r})(s),Oc((function(n){return n.indexOf("E")===-1?n:n.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")})(e.toUpperCase()))}function Dc(s,e){switch(typeof s){case"string":return s;case"boolean":return s?"TRUE":"FALSE";case"number":return(0|s)===s?s.toString(10):X_(s);case"undefined":return"";case"object":if(s==null)return"";if(Up(s))return o0(14,qd(s,e&&e.date1904),e)}throw new Error("unsupported value in General format: "+s)}function Z_(s,e,t,n){var r,o="",i=0,l=0,a=t.y,c=0;switch(s){case 98:a=t.y+543;case 121:switch(e.length){case 1:case 2:r=a%100,c=2;break;default:r=a%1e4,c=4}break;case 109:switch(e.length){case 1:case 2:r=t.m,c=e.length;break;case 3:return Nc[t.m-1][1];case 5:return Nc[t.m-1][0];default:return Nc[t.m-1][2]}break;case 100:switch(e.length){case 1:case 2:r=t.d,c=e.length;break;case 3:return qh[t.q][0];default:return qh[t.q][1]}break;case 104:switch(e.length){case 1:case 2:r=1+(t.H+11)%12,c=e.length;break;default:throw new Error("bad hour format: "+e)}break;case 72:switch(e.length){case 1:case 2:r=t.H,c=e.length;break;default:throw new Error("bad hour format: "+e)}break;case 77:switch(e.length){case 1:case 2:r=t.M,c=e.length;break;default:throw new Error("bad minute format: "+e)}break;case 115:if(e!=="s"&&e!=="ss"&&e!==".0"&&e!==".00"&&e!==".000")throw new Error("bad second format: "+e);return t.u!==0||e!=="s"&&e!=="ss"?(l=n>=2?n===3?1e3:100:n===1?10:1,(i=Math.round(l*(t.S+t.u)))>=60*l&&(i=0),e==="s"?i===0?"0":""+i/l:(o=Zn(i,2+n),e==="ss"?o.substr(0,2):"."+o.substr(2,e.length-1))):Zn(t.S,e.length);case 90:switch(e){case"[h]":case"[hh]":r=24*t.D+t.H;break;case"[m]":case"[mm]":r=60*(24*t.D+t.H)+t.M;break;case"[s]":case"[ss]":r=60*(60*(24*t.D+t.H)+t.M)+Math.round(t.S+t.u);break;default:throw new Error("bad absolute time format: "+e)}c=e.length===3?1:2;break;case 101:r=a,c=1}return c>0?Zn(r,c):""}function ro(s){if(s.length<=3)return s;for(var e=s.length%3,t=s.substr(0,e);e!==s.length;e+=3)t+=(t.length>0?",":"")+s.substr(e,3);return t}var Jp=/%/g;function Kp(s,e){var t,n=s.indexOf("E")-s.indexOf(".")-1;if(s.match(/^#+0.0E\+0$/)){if(e===0)return"0.0E+0";if(e<0)return"-"+Kp(s,-e);var r=s.indexOf(".");r===-1&&(r=s.indexOf("E"));var o=Math.floor(Math.log(e)*Math.LOG10E)%r;if(o<0&&(o+=r),(t=(e/Math.pow(10,o)).toPrecision(n+1+(r+o)%r)).indexOf("e")===-1){var i=Math.floor(Math.log(e)*Math.LOG10E);for(t.indexOf(".")===-1?t=t.charAt(0)+"."+t.substr(1)+"E+"+(i-t.length+o):t+="E+"+(i-o);t.substr(0,2)==="0.";)t=(t=t.charAt(0)+t.substr(2,r)+"."+t.substr(2+r)).replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");t=t.replace(/\+-/,"-")}t=t.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(l,a,c,u){return a+c+u.substr(0,(r+o)%r)+"."+u.substr(o)+"E"})}else t=e.toExponential(n);return s.match(/E\+00$/)&&t.match(/e[+-]\d$/)&&(t=t.substr(0,t.length-1)+"0"+t.charAt(t.length-1)),s.match(/E-/)&&t.match(/e\+/)&&(t=t.replace(/e\+/,"e")),t.replace("e","E")}var Xp=/[0#?] (\?+)( ?)\/( ?)(\d+)/,Zp=/^([0#?]+)\.([0#?]+)/,Qp=/\).*[0#]/,Yp=/\(###\) ###\\?-####/;function qn(s){var e="";let t,n=s.length;for(var r=0;r!==n;++r)switch(t=s.charAt(r),t){case"#":break;case" ":e+=" ";break;case"0":e+="0";break;case"?":e+="?";break;default:e+=String.fromCharCode(cc)}return e}function Kh(s,e){var t=Math.pow(10,e);return""+Math.round(s*t)/t}function Xh(s,e){var t=Math.pow(10,e);return Math.round(s*t)/t}function Zh(s,e){var t=s-Math.floor(s),n=Math.pow(10,e);return e<(""+Math.round(t*n)).length?0:Math.round(t*n)}function Dn(s,e,t){if(s.charCodeAt(0)===40&&!e.match(Qp)){var n=e.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return t>=0?Dn("n",n,t):"("+Dn("n",n,-t)+")"}if(e.charCodeAt(e.length-1)===44)return(function(m,p,S){let w=p.length-1;for(;p.charCodeAt(w-1)===44;)--w;return Lr(m,p.substr(0,w),S/Math.pow(10,3*(p.length-w)))})(s,e,t);if(e.indexOf("%")!==-1)return(function(m,p,S){let w=p.replace(Jp,""),b=p.length-w.length;return Lr(m,w,S*Math.pow(10,2*b))+Pn("%",b)})(s,e,t);if(e.indexOf("E")!==-1)return Kp(e,t);if(e.charCodeAt(0)===36)return"$"+Dn(s,e.substr(e.charAt(1)===" "?2:1),t);var r,o,i,l,a=Math.abs(t),c=t<0?"-":"";if(e.match(/^00+$/))return c+jo(a,e.length);if(e.match(/^[#?]+$/))return(r=jo(t,0))==="0"&&(r=""),r.length>e.length?r:qn(e.substr(0,e.length-r.length))+r;if(o=e.match(Xp))return(function(m,p,S){var w=parseInt(m[4],10),b=Math.round(p*w),C=Math.floor(b/w),_=b-C*w,y=w;return S+(C===0?"":""+C)+" "+(_===0?Pn(" ",m[1].length+1+m[4].length):ed(_,m[1].length)+m[2]+"/"+m[3]+Zn(y,m[4].length))})(o,a,c);if(e.match(/^#+0+$/))return c+jo(a,e.length-e.indexOf("0"));if(o=e.match(Zp)){i=Math.trunc(Kh(t,o[2].length));var u=(function(m){if(!isFinite(m))return 0;for(var p=1,S=0;Math.round(m*p)/p!==m;)p*=10,S++;return S})(l=Xh(Math.abs(i-t),o[2].length));return l=(l=""+Xh(l,u)).replace(/^0\./,""),r=Gh(""+Math.abs(i),o[1])+"."+Gh(""+l,o[2],!0),r=e.indexOf("0.")!==-1?r:r.replace(/^0\./,"."),t<0?"-"+r:r}if(o=(e=e.replace(/^#+([0.])/,"$1")).match(/^(0*)\.(#*)$/))return c+Kh(a,o[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,o[1].length?"0.":".");if(o=e.match(/^#{1,3},##0(\.?)$/))return c+ro(jo(a,0));if(o=e.match(/^#,##0\.([#0]*0)$/))return t<0?"-"+Dn(s,e,-t):ro(""+(Math.floor(t)+(function(m,p){return p<(""+Math.round((m-Math.floor(m))*Math.pow(10,p))).length?1:0})(t,o[1].length)))+"."+Zn(Zh(t,o[1].length),o[1].length);if(o=e.match(/^#,#*,#0/))return Dn(s,e.replace(/^#,#*,/,""),t);if(o=e.match(/^([0#]+)(\\?-([0#]+))+$/))return r=ds(Dn(s,e.replace(/[\\-]/g,""),t)),i=0,ds(ds(e.replace(/\\/g,"")).replace(/[0#]/g,function(m){return i<r.length?r.charAt(i++):m==="0"?"0":""}));if(e.match(Yp))return"("+(r=Dn(s,"##########",t)).substr(0,3)+") "+r.substr(3,3)+"-"+r.substr(6);var d="";if(o=e.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(o[4].length,7),l=va(a,Math.pow(10,i)-1,!1),r=""+c,(d=Lr("n",o[1],l[1])).charAt(d.length-1)===" "&&(d=d.substr(0,d.length-1)+"0"),r+=d+o[2]+"/"+o[3],(d=Ca(l[2],i)).length<o[4].length&&(d=qn(o[4].substr(o[4].length-d.length))+d),r+=d;if(o=e.match(/[#0?] ([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(Math.max(o[1].length,o[4].length),7),l=va(a,Math.pow(10,i)-1,!0),c+Dn(s,e.substring(0,o.index+1),l[0])+" "+(l[1]?ed(l[1],i)+o[2]+"/"+o[3]+Ca(l[2],i):Pn(" ",2*i+1+o[2].length+o[3].length));if(o=e.match(/^[#0?]+$/))return r=jo(t,0),e.length<=r.length?r:qn(e.substr(0,e.length-r.length))+r;if(o=e.match(/^([#0?]+)\.([#0]+)$/)){r=""+t.toFixed(Math.min(o[2].length,10)).replace(/([^0])0+$/,"$1"),i=r.indexOf(".");var h=e.indexOf(".")-i,f=e.length-r.length-h;return qn(e.substr(0,h)+r+e.substr(e.length-f))}if(o=e.match(/^00,000\.([#0]*0)$/))return i=Zh(t,o[1].length),t<0?"-"+Dn(s,e,-t):ro((function(m){return m<2147483647&&m>-2147483648?""+(m>=0?0|m:m-1|0):""+Math.floor(m)})(t)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(m){return"00,"+(m.length<3?Zn(0,3-m.length):"")+m})+"."+Zn(i,o[1].length);switch(e){case"###,##0.00":return Dn(s,"#,##0.00",t);case"###,###":case"##,###":case"#,###":var g=ro(jo(a,0));return g!=="0"?c+g:"";case"###,###.00":return Dn(s,"###,##0.00",t).replace(/^0\./,".");case"#,###.00":return Dn(s,"#,##0.00",t).replace(/^0\./,".")}throw new Error("unsupported format |"+e+"|")}function e0(s,e){var t,n=s.indexOf("E")-s.indexOf(".")-1;if(s.match(/^#+0.0E\+0$/)){if(e===0)return"0.0E+0";if(e<0)return"-"+e0(s,-e);var r=s.indexOf(".");r===-1&&(r=s.indexOf("E"));var o=Math.floor(Math.log(e)*Math.LOG10E)%r;if(o<0&&(o+=r),!(t=(e/Math.pow(10,o)).toPrecision(n+1+(r+o)%r)).match(/[Ee]/)){var i=Math.floor(Math.log(e)*Math.LOG10E);t.indexOf(".")===-1?t=t.charAt(0)+"."+t.substr(1)+"E+"+(i-t.length+o):t+="E+"+(i-o),t=t.replace(/\+-/,"-")}t=t.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(l,a,c,u){return a+c+u.substr(0,(r+o)%r)+"."+u.substr(o)+"E"})}else t=e.toExponential(n);return s.match(/E\+00$/)&&t.match(/e[+-]\d$/)&&(t=t.substr(0,t.length-1)+"0"+t.charAt(t.length-1)),s.match(/E-/)&&t.match(/e\+/)&&(t=t.replace(/e\+/,"e")),t.replace("e","E")}function fr(s,e,t){if(s.charCodeAt(0)===40&&!e.match(Qp)){var n=e.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return t>=0?fr("n",n,t):"("+fr("n",n,-t)+")"}if(e.charCodeAt(e.length-1)===44)return(function(g,m,p){for(var S=m.length-1;m.charCodeAt(S-1)===44;)--S;return Lr(g,m.substr(0,S),p/Math.pow(10,3*(m.length-S)))})(s,e,t);if(e.indexOf("%")!==-1)return(function(g,m,p){var S=m.replace(Jp,""),w=m.length-S.length;return Lr(g,S,p*Math.pow(10,2*w))+Pn("%",w)})(s,e,t);if(e.indexOf("E")!==-1)return e0(e,t);if(e.charCodeAt(0)===36)return"$"+fr(s,e.substr(e.charAt(1)===" "?2:1),t);var r,o,i,l,a=Math.abs(t),c=t<0?"-":"";if(e.match(/^00+$/))return c+Zn(a,e.length);if(e.match(/^[#?]+$/))return r=""+t,t===0&&(r=""),r.length>e.length?r:qn(e.substr(0,e.length-r.length))+r;if(o=e.match(Xp))return(function(g,m,p){return p+(m===0?"":""+m)+Pn(" ",g[1].length+2+g[4].length)})(o,a,c);if(e.match(/^#+0+$/))return c+Zn(a,e.length-e.indexOf("0"));if(o=e.match(Zp))return r=(""+t).replace(/^([^.]+)$/,"."+qn(o[2])).replace(/\.$/,"."+qn(o[2])),r=Zn(Math.abs(t),o[1].length)+r.replace(/\.(\d*)$/,function(g,m){return"."+m+Pn("0",qn(o[2]).length-m.length)}),r=e.indexOf("0.")!==-1?r:r.replace(/^0\./,"."),t<0?"-"+r:r;if(e=e.replace(/^#+([0.])/,"$1"),o=e.match(/^(0*)\.(#*)$/))return c+(""+a).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,o[1].length?"0.":".");if(o=e.match(/^#{1,3},##0(\.?)$/))return c+ro(""+a);if(o=e.match(/^#,##0\.([#0]*0)$/))return t<0?"-"+fr(s,e,-t):ro(""+t)+"."+Pn("0",o[1].length);if(o=e.match(/^#,#*,#0/))return fr(s,e.replace(/^#,#*,/,""),t);if(o=e.match(/^([0#]+)(\\?-([0#]+))+$/))return r=ds(fr(s,e.replace(/[\\-]/g,""),t)),i=0,ds(ds(e.replace(/\\/g,"")).replace(/[0#]/g,function(g){return i<r.length?r.charAt(i++):g==="0"?"0":""}));if(e.match(Yp))return"("+(r=fr(s,"##########",t)).substr(0,3)+") "+r.substr(3,3)+"-"+r.substr(6);var u="";if(o=e.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(o[4].length,7),l=va(a,Math.pow(10,i)-1,!1),r=""+c,(u=Lr("n",o[1],l[1])).charAt(u.length-1)===" "&&(u=u.substr(0,u.length-1)+"0"),r+=u+o[2]+"/"+o[3],(u=Ca(l[2],i)).length<o[4].length&&(u=qn(o[4].substr(o[4].length-u.length))+u),r+=u;if(o=e.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(Math.max(o[1].length,o[4].length),7),c+((l=va(a,Math.pow(10,i)-1,!0))[0]||(l[1]?"":"0"))+" "+(l[1]?ed(l[1],i)+o[2]+"/"+o[3]+Ca(l[2],i):Pn(" ",2*i+1+o[2].length+o[3].length));if(o=e.match(/^[#0?]+$/))return r=""+t,e.length<=r.length?r:qn(e.substr(0,e.length-r.length))+r;if(o=e.match(/^([#0]+)\.([#0]+)$/)){r=""+t.toFixed(Math.min(o[2].length,10)).replace(/([^0])0+$/,"$1"),i=r.indexOf(".");var d=e.indexOf(".")-i,h=e.length-r.length-d;return qn(e.substr(0,d)+r+e.substr(e.length-h))}if(o=e.match(/^00,000\.([#0]*0)$/))return t<0?"-"+fr(s,e,-t):ro(""+t).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(g){return"00,"+(g.length<3?Zn(0,3-g.length):"")+g})+"."+Zn(0,o[1].length);switch(e){case"###,###":case"##,###":case"#,###":var f=ro(""+a);return f!=="0"?c+f:"";default:if(e.match(/\.[0#?]*$/))return fr(s,e.slice(0,e.lastIndexOf(".")),t)+qn(e.slice(e.lastIndexOf(".")))}throw new Error("unsupported format |"+e+"|")}function Lr(s,e,t){return(0|t)===t?fr(s,e,t):Dn(s,e,t)}function t0(s){var e=[],t=!1;const n=s.length;for(var r=0,o=0;r<n;++r)switch(s.charCodeAt(r)){case 34:t=!t;break;case 95:case 42:case 92:++r;break;case 59:e[e.length]=s.substr(o,r-o),o=r+1}if(e[e.length]=s.substr(o),t===!0)throw new Error("Format |"+s+"| unterminated string ");return e}var n0=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function r0(s){for(var e=0,t="",n="",r=s.length;e<r;)switch(t=s.charAt(e)){case"G":jl(s,e)&&(e+=6),e++;break;case'"':for(;s.charCodeAt(++e)!==34&&e<s.length;);++e;break;case"\\":case"_":e+=2;break;case"@":++e;break;case"B":case"b":if(s.charAt(e+1)==="1"||s.charAt(e+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"上":if(s.substr(e,3).toUpperCase()==="A/P"||s.substr(e,5).toUpperCase()==="AM/PM"||s.substr(e,5).toUpperCase()==="上午/下午")return!0;++e;break;case"[":for(n=t;s.charAt(e++)!=="]"&&e<s.length;)n+=s.charAt(e);if(n.match(n0))return!0;break;case".":case"0":case"#":for(;e<s.length&&("0#?.,E+-%".indexOf(t=s.charAt(++e))>-1||t==="\\"&&s.charAt(e+1)==="-"&&"0#".indexOf(s.charAt(e+2))>-1););break;case"?":for(;s.charAt(++e)===t;);break;case"*":++e,s.charAt(e)!==" "&&s.charAt(e)!=="*"||++e;break;case"(":case")":++e;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;e<s.length&&"0123456789".indexOf(s.charAt(++e))>-1;);break;default:++e}return!1}var Qh=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function Yh(s,e){if(e==null)return!1;var t=parseFloat(e[2]);switch(e[1]){case"=":if(s===t)return!0;break;case">":if(s>t)return!0;break;case"<":if(s<t)return!0;break;case"<>":if(s!==t)return!0;break;case">=":if(s>=t)return!0;break;case"<=":if(s<=t)return!0}return!1}function o0(s,e,t){t==null&&(t=P.EmptyObject);var n="";switch(typeof s){case"string":n=s==="m/d/yy"&&t.dateNF?t.dateNF:s;break;case"number":(n=s===14&&t.dateNF?t.dateNF:(t.table!=null?t.table:vo)[s])==null&&(n=t.table&&t.table[Jh[s]]||vo[Jh[s]]),n==null&&(n=q_[s]||"General")}if(jl(n,0))return Dc(e,t);Up(e)&&(e=qd(e,t.date1904));var r=(function(o,i){var l=t0(o),a=l.length,c=l[a-1].indexOf("@");if(c!==-1&&l[a-1][c-1]==="\\"&&(c=-1),a<4&&c>-1&&--a,l.length>4)throw new Error("We can't find right format for |"+l.join("|")+"|");if(typeof i!="number")return[4,l.length===4||c>-1?l[l.length-1]:"@"];switch(l.length){case 1:l=c>-1?["General","General","General",l[0]]:[l[0],l[0],l[0],"@"];break;case 2:l=c>-1?[l[0],l[0],l[0],l[1]]:[l[0],l[1],l[0],"@"];break;case 3:l=c>-1?[l[0],l[1],l[0],l[2]]:[l[0],l[1],l[2],"@"]}var u=i>0?l[0]:i<0?l[1]:l[2];if(l[0].indexOf("[")===-1&&l[1].indexOf("[")===-1)return[a,u];if(l[0].match(/\[[=<>]/)!=null||l[1].match(/\[[=<>]/)!=null){var d=l[0].match(Qh),h=l[1].match(Qh);return Yh(i,d)?[a,l[0]]:Yh(i,h)?[a,l[1]]:[a,l[d!=null&&h!=null?2:1]]}return[a,u]})(n,e);if(jl(r[1]))return Dc(e,t);if(e===!0)e="TRUE";else if(e===!1)e="FALSE";else if(e===""||e==null)return"";return(function(o,i,l,a){var c,u,d,h=[],f="",g=0,m="",p="t",S="H";let w=o.length;for(;g<w;)switch(m=o.charAt(g)){case"G":if(!jl(o,g))throw new Error("unrecognized character "+m+" in "+o);h[h.length]={t:"G",v:"General"},g+=7;break;case'"':for(f="";(d=o.charCodeAt(++g))!==34&&g<o.length;)f+=String.fromCharCode(d);h[h.length]={t:"t",v:f},++g;break;case"\\":var b=o.charAt(++g),C=b==="("||b===")"?b:"t";h[h.length]={t:C,v:b},++g;break;case"@":h[h.length]={t:"T",v:i},++g;break;case"B":case"b":if(o.charAt(g+1)==="1"||o.charAt(g+1)==="2"){if(c==null&&(c=ci(i,l,o.charAt(g+1)==="2"))==null)return"";h[h.length]={t:"X",v:o.substr(g,2)},p=m,g+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":m=m.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(i<0||c==null&&(c=ci(i,l))==null)return"";for(f=m;++g<o.length&&o.charAt(g).toLowerCase()===m;)f+=m;m==="m"&&p.toLowerCase()==="h"&&(m="M"),m==="h"&&(m=S),h[h.length]={t:m,v:f},p=m;break;case"A":case"a":case"上":var _={t:m,v:m};if(c==null&&(c=ci(i,l)),o.substr(g,3).toUpperCase()==="A/P"?(c!=null&&(_.v=c.H>=12?"P":"A"),_.t="T",S="h",g+=3):o.substr(g,5).toUpperCase()==="AM/PM"?(c!=null&&(_.v=c.H>=12?"PM":"AM"),_.t="T",g+=5,S="h"):o.substr(g,5).toUpperCase()==="上午/下午"?(c!=null&&(_.v=c.H>=12?"下午":"上午"),_.t="T",g+=5,S="h"):(_.t="t",++g),c==null&&_.t==="T")return"";h[h.length]=_,p=m;break;case"[":for(f=m;o.charAt(g++)!=="]"&&g<o.length;)f+=o.charAt(g);if(f.slice(-1)!=="]")throw new Error('unterminated "[" block: |'+f+"|");if(f.match(n0)){if(c==null&&(c=ci(i,l))==null)return"";h[h.length]={t:"Z",v:f.toLowerCase()},p=f.charAt(1)}else f.indexOf("$")>-1&&(f=(f.match(/\$([^-[\]]*)/)||[])[1]||"$",r0(o)||(h[h.length]={t:"t",v:f}));break;case".":if(c!=null){for(f=m;++g<o.length&&(m=o.charAt(g))==="0";)f+=m;h[h.length]={t:"s",v:f};break}case"0":case"#":for(f=m;++g<o.length&&"0#?.,E+-%".indexOf(m=o.charAt(g))>-1;)f+=m;h[h.length]={t:"n",v:f};break;case"?":for(f=m;o.charAt(++g)===m;)f+=m;h[h.length]={t:m,v:f},p=m;break;case"*":if(++g,!(f=o.charAt(g)))throw new Error("no character specified for repeat function: "+o);h[h.length]={t:"R",v:f},++g;break;case"_":if(++g,!(f=o.charAt(g)))throw new Error("no character specified for spacing function: "+o);h[h.length]={t:"S",v:f},++g;break;case"(":case")":h[h.length]={t:a===1?"t":m,v:m},++g;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(f=m;g<o.length&&"0123456789".indexOf(o.charAt(++g))>-1;)f+=o.charAt(g);h[h.length]={t:"D",v:f};break;case" ":h[h.length]={t:m,v:m},++g;break;case"$":h[h.length]={t:"t",v:"$"},++g;break;default:if(",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(m)===-1)throw new Error("unrecognized character "+m+" in "+o);h[h.length]={t:"t",v:m},++g}var y,v=0,x=0;for(g=h.length-1,p="t";g>=0;--g)switch(h[g].t){case"h":case"H":h[g].t=S,p="h",v<1&&(v=1);break;case"s":(y=h[g].v.match(/\.0+$/))&&(x=Math.max(x,y[0].length-1)),v<3&&(v=3);case"d":case"y":case"M":case"e":p=h[g].t;break;case"m":p==="s"&&(h[g].t="M",v<2&&(v=2));break;case"X":break;case"Z":v<1&&h[g].v.match(/[Hh]/)&&(v=1),v<2&&h[g].v.match(/[Mm]/)&&(v=2),v<3&&h[g].v.match(/[Ss]/)&&(v=3)}switch(v){case 0:break;case 1:c.u>=.5&&(c.u=0,++c.S),c.S>=60&&(c.S=0,++c.M),c.M>=60&&(c.M=0,++c.H);break;case 2:c.u>=.5&&(c.u=0,++c.S),c.S>=60&&(c.S=0,++c.M)}var E,R="";for(w=h.length,g=0;g<w;++g)switch(h[g].t){case"t":case"T":case" ":case"D":break;case"X":h[g].v="",h[g].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":h[g].v=Z_(h[g].t.charCodeAt(0),h[g].v,c,x),h[g].t="t";break;case"n":case"?":for(E=g+1;h[E]!=null&&((m=h[E].t)==="?"||m==="D"||(m===" "||m==="t")&&h[E+1]!=null&&(h[E+1].t==="?"||h[E+1].t==="t"&&h[E+1].v==="/")||h[g].t==="("&&(m===" "||m==="n"||m===")")||m==="t"&&(h[E].v==="/"||h[E].v===" "&&h[E+1]!=null&&h[E+1].t==="?"));)h[g].v+=h[E].v,h[E]={v:"",t:";"},++E;R+=h[g].v,g=E-1;break;case"G":h[g].t="t",h[g].v=Dc(i,l)}var I,A,T="";if(R.length>0){R.charCodeAt(0)===40?(I=i<0&&R.charCodeAt(0)===45?-i:i,A=Lr("n",R,I)):(A=Lr("n",R,I=i<0&&a>1?-i:i),I<0&&h[0]&&h[0].t==="t"&&(A=A.substr(1),h[0].v="-"+h[0].v)),E=A.length-1;var O=h.length;for(w=h.length,g=0;g<w;++g)if(h[g]!=null&&h[g].t!=="t"&&h[g].v.indexOf(".")>-1){O=g;break}var N=w;if(O===w&&A.indexOf("E")===-1){for(g=h.length-1;g>=0;--g)h[g]!=null&&"n?".indexOf(h[g].t)!==-1&&(E>=h[g].v.length-1?(E-=h[g].v.length,h[g].v=A.substr(E+1,h[g].v.length)):E<0?h[g].v="":(h[g].v=A.substr(0,E+1),E=-1),h[g].t=h[g].v.indexOf("?")>=0?"N":"t",N=g);E>=0&&N<h.length&&(h[N].v=A.substr(0,E+1)+h[N].v)}else if(O!==h.length&&A.indexOf("E")===-1){for(E=A.indexOf(".")-1,g=O;g>=0;--g)if(h[g]!=null&&"n?".indexOf(h[g].t)!==-1){for(u=h[g].v.indexOf(".")>-1&&g===O?h[g].v.indexOf(".")-1:h[g].v.length-1,T=h[g].v.substr(u+1);u>=0;--u)E>=0&&(h[g].v.charAt(u)==="0"||h[g].v.charAt(u)==="#"||h[g].v.charAt(u)==="?")&&(T=A.charAt(E--)+T);h[g].v=T,h[g].t=T.indexOf("?")>=0?"N":"t",N=g}for(E>=0&&N<h.length&&(h[N].v=A.substr(0,E+1)+h[N].v),E=A.indexOf(".")+1,g=O;g<h.length;++g)if(h[g]!=null&&("n?(".indexOf(h[g].t)!==-1||g===O)){for(u=h[g].v.indexOf(".")>-1&&g===O?h[g].v.indexOf(".")+1:0,T=h[g].v.substr(0,u);u<h[g].v.length;++u)E<A.length&&(T+=A.charAt(E++));h[g].v=T,h[g].t=T.indexOf("?")>=0?"N":"t",N=g}}}for(g=0;g<w;++g)h[g]!=null&&"n?".indexOf(h[g].t)>-1&&(I=a>1&&i<0&&g>0&&h[g-1].v==="-"?-i:i,h[g].v=Lr(h[g].t,h[g].v,I),h[g].t=h[g].v.indexOf("?")>=0?"N":"t");var D="";for(w=h.length,g=0;g<w;g++)if(h[g].t==="R")l?.onRepeatChar?.(D.length,h[g].v);else if(h[g].t==="S")l?.onSpacingChar?.(D.length,h[g].v),D+=l?.spacingCharacter??" ";else if(h[g].t==="N"){T=h[g].v;for(var F=0;F<T.length;F++)(m=T[F])==="?"&&(l?.onDigitChar?.(D.length,m),m=l?.digitCharacter??" "),D+=m}else h[g]!=null&&(D+=h[g].v);return D})(r[1],e,t,r[0])}function eg(s,e){if(typeof e!="number"){e=+e||-1;for(var t=0;t<392;++t)if(vo[t]!==void 0){if(vo[t]===s){e=t;break}}else e<0&&(e=t);e<0&&(e=391)}return vo[e]=s,e}const Zt={format:o0,dateNumLocal:qd,load:eg,split_fmt:t0,_table:vo,load_table:function(s){for(var e=0;e!==392;++e)s[e]!==void 0&&eg(s[e],e)},parse_date_code:ci,is_date:r0,get_table:function(){return Zt._table=vo}},en="\\s*([-]?[0-9e]*[.]?[0-9]+)",Q_=new RegExp(`^rgb\\(${en},${en},${en}\\)$`),Y_=new RegExp(`^rgba\\(${en},${en},${en},${en}\\)$`),ey=new RegExp(`^lrgb\\(${en},${en},${en}\\)$`),ty=new RegExp(`^lrgba\\(${en},${en},${en},${en}\\)$`),ny=new RegExp(`^hsl\\(${en},${en},${en}\\)$`),ry=new RegExp(`^hsla\\(${en},${en},${en},${en}\\)$`),oy=new RegExp(/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/),sy=new RegExp(/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/),iy=new RegExp("^index(\\d+)$","i"),Lc=(s,e,t)=>[parseFloat(s),parseFloat(e),parseFloat(t)],Bc=(s,e=255)=>{const t=[...s];for(var n=0;n<s.length;n++)t[n]=s[n]/e;return t},tg=(s,e=0)=>{const t=[...s];for(var n=0;n<s.length;n++)P.roundAccurately(s[n],e+8)%1==.5?t[n]=Math.floor(s[n]):t[n]=P.roundAccurately(s[n],e);return t},_n=(s,e=!0)=>{const t=[...s],n=e?1:255;for(var r=0;r<s.length;r++)t[r]=Math.max(0,Math.min(n,s[r]));return t},ss=s=>Math.max(0,Math.min(1,s)),s0=s=>((s%=360)<0&&(s-=360),s),Eo=s=>{const e=[...s];for(var t=0;t<s.length;t++)e[t]=Gl(s[t]);return e},To=s=>{const e=[...s];for(var t=0;t<s.length;t++)e[t]=Ul(s[t]);return e},Gl=s=>s<.04045?s/12.92:Math.pow((s+.055)/1.055,2.4),Ul=s=>s<.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055,ko=s=>{let e=s[0],t=s[1],n=s[2];e%=360,e/=360,t/=100,n/=100;let r=n<.5?n*(1+t):n+t-t*n,o=2*n-r;return[Math.max(0,zc(o,r,e+1/3)),Math.max(0,zc(o,r,e)),Math.max(0,zc(o,r,e-1/3))]},zc=(s,e,t)=>(t<0&&(t+=1),t>1&&(t-=1),6*t<1?s+6*(e-s)*t:2*t<1?e:3*t<2?s+6*(e-s)*(2/3-t):s),io=s=>{let e=s[0],t=s[1],n=s[2],r=Math.min(e,Math.min(t,n)),o=Math.max(e,Math.max(t,n)),i=0;o===r?i=0:o===e?i=(60*(t-n)/(o-r)+360)%360:o===t?i=60*(n-e)/(o-r)+120:o===n&&(i=60*(e-t)/(o-r)+240);const l=(o+r)/2;let a=0;return a=o===r?0:l<=.5?(o-r)/(o+r):(o-r)/(2-o-r),[i,100*a,100*l]},wn=0,Pc=1,$s=2,ql=0,Jl=1,Kl=2,Xl=0,Zl=1,Ql=2,ly=(s,e)=>{let t=e/100;return((n,r)=>{let o=Eo(n);o[0]=r(o[0],o),o[1]=r(o[1],o),o[2]=r(o[2],o);let i=To(o);return i=_n(i),i})(s,(n,r)=>n*t)},al=2.55,ay=(s,e)=>{const t=io(s),n=t[2],r=P.roundAccurately((o=n,(i=e)>0?(o*al*(1-i)+(255-255*(1-i)))/al:i<0?o*al*(1+i)/al:o),3);var o,i;t[2]=r;let l=ko(t);return l=_n(l),l},cy=(s,e)=>{let t=Eo(s),n=e/100;for(var r=0;r<3;r++)t[r]=t[r]*n+(1-n);let o=To(t);return o=_n(o),o},Hc=(s,e,t)=>{let n=io(e),r=t/1;s===wn&&(r=s0(t)),n[s]=r;let o=ko(n);return o=_n(o),o},$c=(s,e,t)=>{let n=io(e);if(s===wn){let o=t/360;n[wn]=360*(n[wn]/360+o),n[wn]%=360,n[wn]<0&&(n[wn]-=360)}else{let o=t/.1;n[s]=.1*(n[s]/.1+o)}let r=ko(n);return r=_n(r),r},Vc=(s,e,t)=>{let n=io(e),r=t/100;n[s]=n[s]*r,s===wn&&(n[wn]=s0(n[wn]));let o=ko(n);return o=_n(o),o},br=(s,e,t,n)=>{let r=Eo(e),o=t/100;n===Xl?r[s]=o:n===Zl?r[s]+=o:n===Ql&&(r[s]*=o);let i=To(r);return i=_n(i),i},uy=s=>{let e=Eo(s),t=.213*e[ql]+.715*e[Jl]+.072*e[Kl];e[0]=t,e[1]=t,e[2]=t;let n=To(e);return n=_n(n),n},dy=s=>{let e=io(s);e[wn]+=180,e[wn]%=360,e[wn]<0&&(e[wn]-=360);let t=ko(e);return t=_n(t),t},ng=(s,e=!0)=>{let t=e?Eo(s):[...s];const n=e?1:255;return t[0]=n-t[0],t[1]=n-t[1],t[2]=n-t[2],e&&(t=To(t)),t=_n(t,e),t},hy=s=>{const e=[0,0,0];return e[0]=Ul(s[0]),e[1]=Ul(s[1]),e[2]=Ul(s[2]),_n(e)},gy=s=>{const e=[0,0,0];return e[0]=Gl(s[0]),e[1]=Gl(s[1]),e[2]=Gl(s[2]),_n(e)},rg=(s,e,t,n=null)=>{const r=o=>{let i=o.toString(16);return i.length===1?"0"+i:i};return(n===null?"":r(Math.round(255*n)))+r(Number(s)).toUpperCase()+r(Number(e)).toUpperCase()+r(Number(t)).toUpperCase()},Go=.2126,jr=.7152,Uo=.0722;var Fr;(s=>{s.RGBA=class{constructor(t,n,r,o=1){this._private={red:t,green:n,blue:r,alpha:o}}get red(){return this._private.red}get green(){return this._private.green}get blue(){return this._private.blue}get alpha(){return this._private.alpha??1}toString(t=!0){return t&&this._private.alpha!==null?`rgba(${this.red},${this.green},${this.blue},${this.alpha})`:`rgb(${this.red},${this.green},${this.blue})`}isEqual(t){return!!t&&t.red===this.red&&t.green===this.green&&t.blue===this.blue&&t.alpha===this.alpha}isAlmostEqual(t){if(!t)return!1;const n=1.5;return!(Math.abs(t.red-this.red)>n)&&!(Math.abs(t.green-this.green)>n)&&!(Math.abs(t.blue-this.blue)>n)&&!(Math.abs(t.alpha-this.alpha)>n)}},s.HSLA=class{constructor(t,n,r,o){this._private={hue:t,sat:n,lum:r,alpha:o}}get hue(){return this._private.hue}get sat(){return this._private.sat}get lum(){return this._private.lum}get alpha(){return this._private.alpha??1}toString(t=!0){return t&&this._private.alpha!==null?`hsla(${this.hue},${this.sat},${this.lum},${this.alpha})`:`hsl(${this.hue},${this.sat},${this.lum})`}isEqual(t){return!!t&&t.hue===this.hue&&t.sat===this.sat&&t.lum===this.lum&&t.alpha===this.alpha}isAlmostEqual(t){if(!t)return!1;const n=1.5;return!(Math.abs(t.hue-this.hue)>n)&&!(Math.abs(t.sat-this.sat)>n)&&!(Math.abs(t.lum-this.lum)>n)&&!(Math.abs(t.alpha-this.alpha)>n)}};class e extends s.RGBA{toString(n=!0){return n&&this._private.alpha!==null?"#"+rg(this.red,this.green,this.blue,this.alpha??1).toUpperCase():"#"+rg(this.red,this.green,this.blue).toUpperCase()}}s.HEX=e})(Fr||(Fr={}));const fy=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,my=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,Yl=function(s){if(!s)return null;s=s.replace(fy,function(t,n,r,o){return n+n+r+r+o+o});let e=my.exec(s);return e?new Fr.RGBA(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)):null},og=["000000","FFFFFF","FF0000","00FF00","0000FF","FFFF00","FF00FF","00FFFF","000000","FFFFFF","FF0000","00FF00","0000FF","FFFF00","FF00FF","00FFFF","800000","008000","000080","808000","800080","008080","C0C0C0","808080","9999FF","993366","FFFFCC","CCFFFF","660066","FF8080","0066CC","CCCCFF","000080","FF00FF","FFFF00","00FFFF","800080","800000","008080","0000FF","00CCFF","CCFFFF","CCFFCC","FFFF99","99CCFF","FF99CC","CC99FF","FFCC99","3366FF","33CCCC","99CC00","FFCC00","FF9900","FF6600","666699","969696","003366","339966","003300","333300","993300","993366","333399","333333"],_o=new Map;for(let s=0;s<og.length;s++)_o.set(s,Yl(og[s]));_o.set(-4105,null),_o.set(-4142,null),_o.set(64,Yl("000000")),_o.set(65,Yl("FFFFFF")),_o.set(81,Yl("FFFFFF"));const xa=s=>_o.get(s),st={General:"General",Number:"Number",Currency:"Currency",Accounting:"Accounting",ShortDate:"Short Date",LongDate:"Long Date",MediumDate:"Medium Date",ShortTime:"Short Time",MediumTime:"Medium Time",LongTime:"Long Time",Comma:"Comma",Percentage:"Percentage",Fraction:"Fraction",Scientific:"Scientific",Text:"Text",Special:"Special",Custom:"Custom"};let Wc=null;const i0=()=>Wc||(Wc=Intl.DateTimeFormat().resolvedOptions().locale??"en-US",Wc),py=/^\[\$-(.*?)\]/i,Sy=/^[0-9a-fA-F]+$/,wy=Zt.split_fmt,Jd=(s,e,t)=>{const n=py.exec(s);let r=i0();if(n&&n[1]){let o=n[1];Sy.test(o)||o.includes("-")}if(sg[s]&&(s=sg[s]),typeof e=="number"){const o=ui(s,e,{locale:r,...t});if(o!==null)return o.fmt}return Zt.format(s,e,t)},ui=(s,e,t)=>{if(typeof e!="number")return null;const n=Ms(e,t?.date1904??!1),r=t?.locale??i0();let o=!1,i=s,l=-1;if((l=i.indexOf("Short Date"))!==-1){const a=new Intl.DateTimeFormat(r).format(n);i=i.substring(0,l)+a+i.substring(l+10),o=!0}if((l=i.indexOf("Medium Date"))!==-1){const a=Zt.format(Zt.get_table()[15],e,t);i=i.substring(0,l)+a+i.substring(l+11),o=!0}if((l=i.indexOf("Long Date"))!==-1){const a=new Intl.DateTimeFormat(r,{dateStyle:"full"}).format(n);i=i.substring(0,l)+a+i.substring(l+9),o=!0}if((l=i.indexOf("Short Time"))!==-1){const a=Zt.format(Zt.get_table()[20],e,t);i=i.substring(0,l)+a+i.substring(l+10),o=!0}if((l=i.indexOf("Medium Time"))!==-1){const a=Zt.format(Zt.get_table()[18],e,t);i=i.substring(0,l)+a+i.substring(l+11),o=!0}if((l=i.indexOf("Long Time"))!==-1){const a=new Intl.DateTimeFormat(r,{timeStyle:"medium"}).format(n);i=i.substring(0,l)+a+i.substring(l+9),o=!0}return o?{fmt:i,date:n}:null},sg=Object.freeze({"General Number":"General","General Date":"m/d/yyyy h:mm","Medium Date":Zt.get_table()[15],"Medium Time":Zt.get_table()[18],"Short Time":Zt.get_table()[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:Zt.get_table()[2],Standard:Zt.get_table()[4],Percent:Zt.get_table()[10],Scientific:Zt.get_table()[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'}),_y=Object.freeze({black:0,white:1,red:2,green:3,blue:4,yellow:5,magenta:6,cyan:7}),yy=s=>{let e=null;if((s=s.toLowerCase()).startsWith("color")){const t=parseInt(s.substring(5));t>=0&&t<=56&&(e=`Index${t+7}`)}if(!e){const t=_y[s];t!==void 0&&(e=xa(t).toString())}return e},l0="=",by="<>",a0=">",c0="<",u0=">=",Cy="<=",So=new Map;So.set(l0,(s,e)=>s===e),So.set(by,(s,e)=>s!==e),So.set(a0,(s,e)=>s>e),So.set(c0,(s,e)=>s<e),So.set(u0,(s,e)=>s>=e),So.set(Cy,(s,e)=>s<=e);const vy=/(Black|Blue|Cyan|Green|Magenta|Red|White|Yellow|Color[0-9]+)/i,xy=/(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)/i,Ey=/\[(.*?)\]/g,Ry=(s,e)=>{const t={color:null,condition:null};let n=null,r=new RegExp(Ey);for(;(n=r.exec(s))!==null;){let o=!1,i=vy.exec(n[1]);if(i){if(o=!0,t.color)throw new Error(`format error, two colors specified: '${s}' and '${t.color}'.`);t.color=yy(i[1]),t.color||console.warn("Unable to parse LegacyColor",i[1])}let l=xy.exec(n[1]);if(l){if(o=!0,t.condition)throw new Error(`Format error, two conditions specified: ' ${s}'`);t.condition={op:l[1],comp:parseFloat(l[2])}}if(!o)return t}return t.condition||(t.condition=e),t},Iy=Object.freeze({op:u0,comp:0}),ig=Object.freeze({op:c0,comp:0}),Ay=Object.freeze({op:a0,comp:0}),My=Object.freeze({op:l0,comp:0}),Ty=(s,e)=>{let t=(o=>{if(!o)return P.EmptyArray;const i=[],l=o.split(";"),a=l.length;for(let c=0;c<a;c++){let u=null;a===2?c===0?u=Iy:c===1&&(u=ig):a!==3&&a!==4||(u=c===0?Ay:c===1?ig:c===2?My:null);const d=l[c],h=Ry(d,u);i.push({format:d,colorAndCondition:h})}return i})(s);const n=t.length;if(n===0)return null;let r=t[0].colorAndCondition;if(n===1&&r&&!r.condition&&r.color)return r.color;for(let o=0;o<n;o++){r=t[o].colorAndCondition;let i=r?.condition??void 0;if(o===3)return typeof e=="string"&&r?.color?r.color:null;if(i&&typeof e=="number"&&So.get(i.op)(e,i.comp))return r?.color??null}},lg=s=>{if(s===st.MediumDate||s===st.LongDate||s===st.ShortDate||s===st.MediumTime||s===st.LongTime||s===st.ShortTime)return!0},ky=(s,e)=>s===e?0:lg(s)?1:lg(e)?-1:s===st.Percentage?1:e===st.Percentage?-1:s===st.Currency||s===st.Accounting?1:e===st.Currency||e===st.Accounting?-1:0,As=s=>(s instanceof Date||Object.prototype.toString.call(s)==="[object Date]")&&!isNaN(s.getTime()),Fy=(s,e,t)=>{return t==="month"||t==="months"||t==="m"?(n=s,12*((r=e).getUTCFullYear()-n.getUTCFullYear())+(r.getUTCMonth()-n.getUTCMonth())+(r.getUTCDate()-n.getUTCDate()<0?-1:0)):t==="year"||t==="years"||t==="y"?((o,i)=>Math.abs(i.getFullYear()-o.getFullYear()))(s,e):t==="day"||t==="days"||t==="d"?((o,i)=>Math.floor((Date.UTC(i.getFullYear(),i.getMonth(),i.getDate())-Date.UTC(o.getFullYear(),o.getMonth(),o.getDate()))/864e5))(s,e):void console.warn("invalid unit"+t);var n,r},cl="d",ag="m",cg="y",ug=(s,e,t)=>{if(t==="month"||t==="months"||t==="m"){const n=new Date(s.getTime());return new Date(n.setMonth(n.getMonth()+e))}if(t==="year"||t==="years"||t==="y"){const n=new Date(s.getTime());return n.setFullYear(n.getFullYear()+e),n}if(t==="day"||t==="days"||t==="d"){const n=new Date(s.getTime());return n.setDate(n.getDate()+e),n}if(t==="hour"||t==="hours"||t==="h"){const n=new Date(s.getTime());return n.setHours(n.getHours()+e),n}return console.warn("invalid unit"+t),null},Ms=(s,e=!1)=>{let t=Zt.parse_date_code(s,{date1904:e});return t?new Date(t.y,t.m-1,t.d,t.H,t.M,t.S,Math.round(1e3*t.u)):null},$i=(s,e=!1)=>isNaN(s)?null:Zt.dateNumLocal(s,e),Ny=new class extends Gp{parse(s,e,t){const n=r=>r-1;switch(e){case"M":return Dr(eo(jp,s),n);case"MM":return Dr(vi(2,s),n);case"Mo":return Dr(t.ordinalNumber(s,{unit:"month"}),n);case"MMM":return t.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(s,{width:"narrow",context:"formatting"});default:return t.month(s,{width:"wide",context:"formatting"})}}},Cr=(s=>{let e=s,t=[];for(let n=0;n<e.length;n++){let r=e[n][0].indexOf("yyy")>-1,o=e[n][0].indexOf(".")>-1,i=e[n][0].indexOf("-")>-1;t.push({parseFormat:e[n][0],numberFormat:e[n][1],todaysYear:!r,windowYear:!0,containsDot:o,containsDash:i}),r&&t.push({parseFormat:e[n][0].replace(/yyy/g,"yyyy"),numberFormat:e[n][1],todaysYear:!1,windowYear:!1,containsDot:o,containsDash:i})}return t})([["MM-d","d-mmm"],["MM-yyy","mmm-yy"],["M-yyy","mmm-yy"],["M-d-yyy","m/d/yyyy"],["yyy-M-d","m/d/yyyy"],["yyy-d-M","m/d/yyyy"],["d.MMM","d-mmm"],["d.MMMM","d-mmm"],["d.MMM.yyy","d-mmm-yy"],["d.MMMM.yyy","d-mmm-yy"],["MMM.d","d-mmm"],["MMMM.d","d-mmm"],["MMM.yyy","mmm-yy"],["MMMM.yyy","mmm-yy"],["MMM dd, yyy","d-mmm-yy"],["MMMM dd, yyy","d-mmm-yy"],["EEE, MMMM dd, yyy","[$-x-sysdate]ddd, mmmm dd, yyyy"],["EEEE, MMMM dd, yyy","[$-x-sysdate]dddd, mmmm dd, yyyy"]]),Oy={year:0,month:1,day:0,hour:0,minute:0,second:0,millis:0},Dy=(s,e=!1)=>{const t={...Oy,...s};return t.year=e?1904:1900,t.dow=-1,t.oaDateTime=((n,r=!1)=>{if(!n)return null;let o=n.day,i=n.hour;i>24&&(o+=Math.floor(i/24),i%=24),o>60&&--o;const l=new Date(n.year,n.month-1,o,i,n.minute,n.second,n.millis);return $i(l,r)})(t,e),t},Ly=new RegExp("([0-9]{1,2})\\s*(P[M]?|A[M]?)\\s*$","i"),By=new RegExp("([0-9]+)\\s*\\:$","i"),jc=new RegExp("(\\s*[0-9]{1,2})\\s+(P[M]?|A[M]?)\\s*$","i"),dg=new RegExp("(\\s*[0-9]{1,4})\\s*([\\.]{1}\\s*[0-9]+)?\\s*\\:","i"),zy=new RegExp("(\\s*[0-9]{1,4})\\s*([\\.]{1}\\s*[0-9]*)?\\s*$","i"),d0=(s,e=!1,t=!1)=>{if(!s||s.trim().length<2||s.indexOf(":")===-1&&s.match(jc)===null)return null;let n=null,r=null,o=null,i=!1,l=!1,a="h:mm AM/PM",c=[],u=s,d=null;do{let p=u.indexOf(":");p===-1?(c.push(u),u=null):(c.push(u.substring(0,p+1)),u=u.substring(p+1,u.length))}while(c.length<3&&u&&u.length>0);if(u?.length>0)return null;const h=(p,S,w)=>{let b=p.match(S);if(!b)return null;d===null&&(d=p.substring(0,b.index));let C=parseInt(b[1]);if(b[2]&&o===null){if(w){let y=parseFloat(b[2].substring(1,b[2].length));isNaN(y)||(r=y)}let _=parseFloat(b[2]);isNaN(_)||(n=_),o=w}return C},f=(p,S)=>{let w=p.match(S);if(!w||w.length!==3)return null;d===null&&(d=p.substring(0,w.index)),i=!0;let b=parseInt(w[1]);return l=w[2].charAt(0)==="p"||w[2].charAt(0)==="P",b};c[c.length-1].trim().length===0&&c.pop();const g=[];if(c.length>0){let p=h(c[0],By,!1);if(p===null&&(p=f(c[0],Ly)),p===null)return null;g.push(p)}if(c.length>2){let p=h(c[1],dg,!0);if(p===null&&(p=f(c[0],jc)),p===null)return null;g.push(p)}if(c.length>1){const p=c[c.length-1];let S=h(p,dg,!1);if(S===null&&(S=h(p,zy,!1)),S===null&&(S=f(p,jc)),S===null)return null;g.push(S)}if(d!==null&&d.length>0&&!t)return null;if(o===!0&&(g.length===2&&g.splice(1,0,0),g[2]=r||0),i){if(g[0]>12||g[1]>=60||g[2]>=60)return null;g[0]===12?g[0]=l?12:0:l&&(g[0]+=12)}else a=c.length>2?"h:mm:ss":"h:mm",g[0]>23&&(a="[h]:mm:ss"),n!==null&&(a="mm:ss.0"),g[1]>=60&&(a="General"),g[2]>=60&&(a="General");a!=="General"&&(g.length===1&&g.push(0),g.length===2&&(n===null?g.push(0):g.unshift(0)));let m={hour:g[0]??0,minute:g[1]??0,second:g[2]??0,millis:1e3*(n??0)};return{numberFormat:a,parsed:Dy(m,e),leadingText:d}},Py={},Kd=(s,e=!1,t=null)=>{const n=t??Date.now(),r=new Date(n).getFullYear();let o=s.trim().replaceAll(/\s+/g," ");o=o.replaceAll(/\s*([-/])\s*/g,"$1");let i=o.replaceAll(/[-/ ]/g,"."),l=o.replaceAll(/[/]/g,"-");const a=ai.M;ai.M=Ny;for(let c=0;c<Cr.length;c++){let u=o;Cr[c].containsDot?u=i:Cr[c].containsDash&&(u=l);let d=G_(u,Cr[c].parseFormat,n,Py),h=Zt.dateNumLocal(d,e);if(As(d)&&(Cr[c].windowYear||h>0)){if(Cr[c].windowYear){let g=d.getFullYear()<=29?2e3+d.getFullYear():1900+d.getFullYear();d.setFullYear(g)}if(Cr[c].todaysYear&&d.setFullYear(r),h=Zt.dateNumLocal(d,e),Cr[c].parseFormat.indexOf("EEE")>-1){const g=Jd("ddd",h,{date1904:e});if(!u.toLowerCase().includes(g.toLowerCase()))return null}let f=Cr[c].numberFormat;return ai.M=a,{asOADate:h,asJSDate:d,numberFormat:f}}}return ai.M=a,null};function Vi(s){if(!s)return!1;let e=s.replaceAll(/\[([^)]+)\]/g,"").toLowerCase();return e=e.replaceAll(/".*"/g,""),e=e.replaceAll(/\\./g,""),e=e.replace(/[_*]./g,""),!e.includes("time")&&!!(e.includes("d")||e.includes("m")&&!e.includes("h")&&!e.includes("s")||e.includes("y")||e==="short date"||e==="medium date"||e==="long date")}function Ja(s){if(!s)return!1;let e=s.replaceAll(/\[([^)]+)\]/g,"").toLowerCase();return e=e.replaceAll(/".*"/g,""),e=e.replaceAll(/\\./g,""),e=e.replace(/[_*]./g,""),!e.includes("date")&&!(!e.includes("h")&&!e.includes("s")&&e!=="short time"&&e!=="medium time"&&e!=="long time")}var Ea,hg,ce,vr;(hg=Ea||(Ea={})).SmallCaps={None:"none",Small:"small",All:"all"},hg.StrikeStyle={None:"none",Single:"single",Double:"double"},(vr=ce||(ce={})).TabStop=class{},vr.HorizontalAlignment={General:"general",Left:"left",Center:"center",Right:"right",Justify:"justify",Distributed:"distributed",CenterContinuous:"centerContinuous",Fill:"fill"},vr.VerticalAlignment={Top:"top",Center:"center",Bottom:"bottom",Justify:"justify",Distributed:"distributed"},vr.Orientation={Horizontal:"horizontal",Vertical:"90",Vertical270:"270",Stacked:"stacked"},vr.ReadingDirection={Auto:"auto",LeftToRight:"ltr",RightToLeft:"rtl"},vr.Overflow={Visible:"visible",Wrap:"wrap",Clip:"clip",Shrink:"shrink",Ellipsis:"ellipsis"},vr.Autofit={None:"none",Normal:"normal",Shape:"shape"},vr.TabStopAlignment={Default:"default",Left:"left",Right:"right",Center:"center"},vr.toCSSHorizontalTextAlign=s=>s?s.toLowerCase():null;const h0=(s,e,t=1e3)=>{if(!s)throw new Error("A template string must be specified.");if(e(s))return s;let n=new RegExp(/\d+/,"g").exec(s),r=null,o=0;n!==null?(r=s,o=parseFloat(n[0]),isNaN(o)&&(o=0)):(o=1,r=`${s}_${o}`);let i=isNaN(o)?0:o;for(;o<i+t;)try{const l=r.replace(/\d+/g,()=>""+o++);if(e(l))return l}catch{}throw new Error(`Unable to find valid name for '${s}'.`)},_s=(s,e=!1)=>{if(!s||s.length===0)return s;const t=s.charAt(0);if(t>="a"&&t<="z"){const n=String.fromCharCode(t.charCodeAt(0)-32);return e?n+s.slice(1).toLowerCase():n+s.slice(1)}return s},gg=s=>{if(!s||typeof s!="string")return"";const e=s.split(/[\\/]/).pop()||"",t=e.lastIndexOf(".");return e===""||t<1?"":e.slice(t+1)},g0=s=>s.toLowerCase().replace(/([-_][a-z])/g,e=>e.toUpperCase().replace("-","").replace("_","")),f0=(s,e=36)=>s.substring(0,36)+(s.length>e?"…":""),ea=s=>{if(s===void 0)return 0;let e=s.toString().split(".");return e.length<=1?0:e[1].length||0},m0=new RegExp(/^["|'|`](.*)["|'|`]$/),Hy=new RegExp("^([a-zA-Z]+:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i"),p0=(s=",",e="'")=>new RegExp(`\\s*${s}\\s*(?=(?:[^${e}]*${e}[^${e}]*${e})*[^${e}]*$)`,"g"),S0=p0(),w0=s=>s&&s.length>1&&m0.test(s)&&s[0]===s[s.length-1],Xd=s=>s.replace(m0,"$1"),_0=(s,e="'")=>`${e}${s}${e}`,y0=(s,e=void 0,t=void 0)=>{let n=S0;return e===void 0&&t===void 0||(n=p0(e,t)),s.split(n)},b0=s=>{let e;try{e=new URL(s)}catch{return!1}return(e.protocol==="http:"||e.protocol==="https:")&&Hy.test(s)},$y=new RegExp(/^[^\s@]+@[^\s@]+\.[^\s@]+$/i),C0=s=>!!s.toLowerCase().startsWith("mailto:")||$y.test(s),v0=s=>((s>=26?v0((s/26|0)-1):"")+"abcdefghijklmnopqrstuvwxyz"[s%26|0]).toUpperCase(),Zd=Object.freeze(Object.defineProperty({__proto__:null,DefaultUnQuoteRegEx:S0,camelToSnake:s=>s&&s.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`),capitalize:_s,clampString:f0,countDecimals:ea,findValidTextValue:h0,getBaseName:(s,e=!1)=>{if(!s||typeof s!="string")return"";const t=s.split(/[\\/]/).pop()||"";if(t==="")return"";const n=gg(t),r=n.length===0?t:t.slice(0,t.length-n.length-1);return e?_s(r,!0):r},getFileNameExtension:gg,isQuoted:w0,isValidEmail:C0,isValidHttpUrl:b0,numberToAlphabet:v0,quote:_0,snakeToCamel:g0,splitUnquoted:y0,unquote:Xd},Symbol.toStringTag,{value:"Module"})),Vy=(s,e,t,n=null)=>{const r=(e||11*Be.getDeviceScale())/Be.getDeviceScale(),o=n?.letterSpacing||0,i=s.length,l=i*(.55*r)-(s.match(/[il.,;!|]/g)||[]).length*r*.15+(s.match(/[mwMW]/g)||[]).length*r*.1+(i>0?(i-1)*o:0),a=Math.ceil(1.2*r),c=Math.ceil(.8*r),u=Math.ceil(.2*r),d=Math.ceil(.45*r),h=Math.ceil(1.1*r),f=Math.max(1,Math.ceil(.08*r));return{width:l,lineHeight:a,baseline:c,lineGap:u,strikePosition:d,underlinePosition:h,strikeThickness:f,underlineThickness:f,actualBoundingBoxLeft:0,actualBoundingBoxRight:l,actualBoundingBoxAscent:c,actualBoundingBoxDescent:a-c,fontBoundingBoxAscent:c,fontBoundingBoxDescent:a-c,emHeightAscent:c,emHeightDescent:a-c,hangingBaseline:.8*c,alphabeticBaseline:c,ideographicBaseline:a}},mn={},fg=(s,e)=>{let t="normal";return s&&e?t="bold italic":s?t="bold":e&&(t="italic"),t},mg=s=>s.split(",").map(e=>{const t=(e=e.trim()).indexOf(" ")>=0,n=e.indexOf('"')>=0||e.indexOf("'")>=0;return t&&!n&&(e=`"${e}"`),e}).join(", "),pg=new Map,Gc=new Map;let xr=null;const Wy=(s,e,t,n=null)=>{const r=n?.letterSpacing||0;typeof window>"u"||mn.contextMeasure||(mn.canvasMeasure=document?document.createElement("canvas"):null,mn.contextMeasure=mn.canvasMeasure.getContext("2d"),mn.contextMeasure.letterSpacing=`${r}px`,mn.contextMeasure.textRendering="geometricPrecision",mn.contextMeasure.textBaseline="alphabetic",mn.contextMeasure.textAlign="left");const o=t||"calibri",i=e||11*Be.getDeviceScale(),l=n?.isBold||!1,a=n?.isItalic||!1;let c=null;if(s==="#"||s==="0"||s==="M"||s===""||s==="_"||s==="-"){c=((m,p,S,w,b,C)=>m+Math.round(100*p)/100+S+w+b+C)(s,i,o,l,a,r);const g=pg.get(c);if(g)return g}if(xr&&xr.text===s&&xr.size===e&&xr.family===t&&xr.options?.isBold===n?.isBold&&xr.options?.isItalic===n?.isItalic&&xr.options?.letterSpacing===n?.letterSpacing)return xr.metrics;let u={};const d=fg(l,a)+" "+P.roundAccurately(i,2)+"px "+mg(o);mn.contextMeasure?(mn.contextMeasure.font=d,mn.contextMeasure.letterSpacing=`${n?.letterSpacing??0}px`,u=mn.contextMeasure.measureText(s)):u.width=s.length*P.roundAccurately(i/Be.getDeviceScale()*.6,2);let h=Gc.get(d);if(!h&&typeof window<"u"){const g=document.createElement("div");g.style.visibility="hidden",g.style.position="absolute";const m=document.createElement("span");m.textContent="Mj",m.style.fontSize="100px",m.style.fontWeight=n?.isBold?"bold":"normal",m.style.fontStyle=n?.isItalic?"italic":"normal",m.style.fontFamily=`'${o}'`,m.style.lineHeight="1.2",g.appendChild(m),document.body.appendChild(g);const p=g.getBoundingClientRect(),S=m.getBoundingClientRect();document.body.removeChild(g),mn.contextMeasure.font=fg(l,a)+" "+P.roundAccurately(100,2)+"px "+mg(o);const w=mn.contextMeasure.measureText("M"),b=p.bottom-p.top,C=b-(w.fontBoundingBoxAscent+w.fontBoundingBoxDescent),_=w.fontBoundingBoxAscent+S.top,y=mn.contextMeasure.measureText("_"),v=_-y.actualBoundingBoxAscent,x=Math.max(1,Math.abs(y.actualBoundingBoxAscent+y.actualBoundingBoxDescent)),E=mn.contextMeasure.measureText("-"),R=P.roundAccurately(_-E.actualBoundingBoxAscent+Math.max(1,.05*b,0)),I=x,A=i/100;h={lineHeight:Math.ceil(b*A),baseline:Math.ceil(_*A),lineGap:Math.ceil(C*A),strikePosition:Math.ceil(R*A),underlinePosition:Math.ceil(v*A),strikeThickness:Math.ceil(I*A),underlineThickness:Math.ceil(x*A)},mn.contextMeasure.font=d,Gc.set(d,h)}h||(h={lineHeight:Math.ceil(1.2*i),baseline:Math.ceil(i)+Math.floor(.1*i),lineGap:Math.ceil(.1*i),strikePosition:Math.ceil(.55*i)+Math.floor(.1*i),strikeThickness:1,underlinePosition:Math.ceil(1.1*i),underlineThickness:1},Gc.set(d,h));const f={...u,width:u.width,...h};return c!==null&&pg.set(c,f),xr={text:s,size:e,family:t,options:n,metrics:f},f};let qo=null;const jy=()=>{if(qo)return qo;try{const s=document.createElement("canvas"),e=s.getContext&&s.getContext("2d");e&&typeof e.fillText=="function"&&(qo=Wy)}catch{}return qo||(console.warn("⚠️ CanvasFontMeasurer not available, falling back to SimpleFontMeasurer"),qo=Vy),qo};let ul=null;var Be,Er;(Er=Be||(Be={})).Style={Normal:"normal",Italic:"italic"},Er.Scheme={Major:"major",Minor:"minor",None:"none"},Er.UnderlineStyle={None:"none",Double:"double",DoubleAccounting:"doubleAccounting",Single:"single",SingleAccounting:"singleAccounting"},Er.VerticalAlignment={Baseline:"baseline",Sub:"sub",Super:"super"},Er.setSharedMeasurer=s=>{ul=s},Er.getSharedMeasurer=()=>ul||(ul=jy(),ul),Er.getDeviceScale=()=>96/72*1,Er.getPanoseFallback=s=>{const e=[],t=s.length;for(let i=0;i<t;i+=2)e.push(parseInt(s.substring(i,i+2),16));const n=e[0],r=e[1],o=e[3];switch(n){case 2:return o===9?"monospace":r>=2&&r<=8?"serif":"sans-serif";case 3:return"cursive";case 4:return"fantasy";case 5:return"monospace";default:return"sans-serif"}},Er.GenericName={Serif:"serif",SanSerif:"sans-serif",MonoSpace:"monospace",Cursive:"cursive",Fantasy:"fantasy",SystemUI:"system-ui",UISystem:"ui-system",UISerif:"ui-serif",UISanSerif:"ui-sans-serif",UIMonoSpace:"ui-monospace",UIRounded:"ui-rounded",Math:"math",Emoji:"emoji",Fangsong:"fangsong"};class Gy{constructor(e){this._private={input:e},typeof e=="string"?this._private.name=e:Object.assign(this._private,e)}toJSON(){return this._private.input}getFamily(){return this._private.name}getPitch(){return this._private.pitch}getPanose(){return this._private.panose}toString(){return typeof this._private.input=="string"?this._private.input:JSON.stringify(this._private.input)}get isIFont(){return!0}}const x0=["Arial","Arial Black","Brush Script MT","Calibri","Comic Sans MS","Courier New","Garamond","Georgia","Impact","Luminari","Palatino Linotype","Tahoma","Times New Roman","Trebuchet MS","Verdana"],kn=new Map;kn.set(Be.GenericName.Serif,["Tahoma"]),kn.set(Be.GenericName.SanSerif,["Calibri"]),kn.set(Be.GenericName.MonoSpace,["Courier New"]),kn.set(Be.GenericName.Cursive,["Comic Sans MS"]),kn.set(Be.GenericName.Fantasy,["Luminari"]),kn.set(Be.GenericName.UISystem,["Arial"]),kn.set(Be.GenericName.UISerif,["Tahoma"]),kn.set(Be.GenericName.UISanSerif,["Arial"]),kn.set(Be.GenericName.UIMonoSpace,["Courier New"]),kn.set(Be.GenericName.UIRounded,["Arial"]),kn.set(Be.GenericName.Math,[]),kn.set(Be.GenericName.Emoji,[]),kn.set(Be.GenericName.Fangsong,[]);const td=new Map;let E0=[];Qd(x0);const Uy=eval;function Qd(s){s||Qd(x0);let e=[];for(let t=0;t<s.length;t++){let n=s[t];typeof n=="string"&&(n=new Gy(n));let r=!0;const o="document";try{r=Uy(`${o}.fonts.check('12px ${n.getFamily()}')`)}catch{}const i={fontRef:n,loaded:r};e.push(i),td.set(n.getFamily(),i)}E0=Object.freeze(e)}const Uc=new Map,f2=Object.freeze(Object.defineProperty({__proto__:null,findBestMatch:(s,e)=>{const t=Uc.get(s);if(t)return t.fontRef===null?null:t;let n=[s];e.fallbacks&&(n=n.concat(e.fallbacks));let r=null;for(let o=0;!r&&o<n.length;o++){let i=n[o];if(r=td.get(i),!r){const l=kn.get(i);if(l)for(let a=0;!r&&a<l.length;a++)r=td.get(l[a])}}return r?Uc.set(s,r):Uc.set(s,{fontRef:null,loaded:!1}),r},getFontList:function(){return E0},setFontList:Qd},Symbol.toStringTag,{value:"Module"})),Sg=Object.freeze([8,9,10,11,12,14,16,18,20,22,24,26,28,30,36,48,72]),wg=Object.freeze(Object.defineProperty({__proto__:null,DefaultFontSizes:Sg,findNextFontSize:(s,e=!0,t=Sg)=>{if(!t||t.length===0)return s;if(s===void 0)return t[0];if(e&&s>=t[t.length-1]||!e&&s<=t[0])return s;let n=P.findEqualOrGreater(t,s);return e?(t[n]===s&&(n+=1),t[n]||(n-=1),t[n]):(n-=1,t[n])}},Symbol.toStringTag,{value:"Module"}));let R0=class I0{constructor(e,t,n,r=null,o=null,i=null){this._private={wrapped:!0,insets:zr.EmptyRect,orientation:ce.Orientation.Horizontal,autoFit:ce.Autofit.None,fontScale:1,vertical:!1,columnCount:1,columnSpacing:0,verticalAlignment:ce.VerticalAlignment.Center,horizontalCentered:!1,lineReduction:0,isSpaceFirstLastPara:!1,presetTextWarp:null,paragraphs:P.EmptyArray},this._bounds=null,this._textBounds=null,this._lines=null,this._lastLayoutSize=void 0,this._lastLayout=void 0,this._private=Object.assign(this._private,e||{}),this._defaultFont=t,this._alignment=n,this._lines=r,this._bounds=Object.freeze(o),this._textBounds=Object.freeze(i)}visitParas(e){e?.visitTextFrame?.(this);const t=this.paragraphs,n=t.length;for(let r=0;r<n;r++){const o=t[r];e?.visitTextParagraph?.(o,r,n);const i=o.runs,l=i.length;for(let a=0;a<l;a++)e?.visitTextRun?.(i[a],a,l)}}visitLines(e){e?.visitTextFrame?.(this);const t=this.lines,n=t.length;for(let r=0;r<n;r++){const o=t[r];e?.visitTextLine?.(o,r,n);const i=o.runs,l=i.length;for(let a=0;a<l;a++)e?.visitTextRun?.(i[a],a,l)}}layout(e=null){return this._lastLayout&&this._lastLayoutSize?.width===e?.width&&this._lastLayoutSize?.height===e?.height||(this._lastLayout=e1(this,this._defaultFont,this._alignment,e),this._lastLayoutSize=e),this._lastLayout}clone(e){const t=e?.visitTextFrame?.(this),n=Object.assign(this._private,t||{});return delete n.bounds,new I0(n,this._defaultFont,this._alignment)}equals(e){return P.deepEqual(this._private,e._private)}createTemporaryTextFrame(e,t){return Ka(e,this._defaultFont,this._alignment,t??this._private.wrapped)}get bounds(){if(this._bounds===null)throw new Error(_g);return this._bounds}get textBounds(){if(this._textBounds===null)throw new Error(_g);return this._textBounds}get lines(){return this._lines}get wrapped(){return this._private.wrapped}get insets(){return this._private.insets}get orientation(){return this._private.orientation}get autoFit(){return this._private.autoFit}get fontScale(){return this._private.fontScale}get vertical(){return this._private.vertical}get columnCount(){return this._private.columnCount}get columnSpacing(){return this._private.columnSpacing}get verticalAlignment(){return this._private.verticalAlignment}get horizontalCentered(){return this._private.horizontalCentered}get lineReduction(){return this._private.lineReduction}get isSpaceFirstLastPara(){return this._private.isSpaceFirstLastPara}get presetTextWarp(){return this._private.presetTextWarp}get paragraphs(){return this._private.paragraphs}};const _g="bounds can not be used until layout",ki=class ki{};ki.NL=`
`,ki.DefaultLineSpacing=100,ki.DefaultTabWidth=72;let Ra=ki,A0=class M0{constructor(e){this._private={defaultFontSize:11,defaultTabSize:Ra.DefaultTabWidth,tabOverrides:P.EmptyArray,spacingBefore:0,spacingAfter:0,lineSpacing:Ra.DefaultLineSpacing,align:ce.HorizontalAlignment.Left,endParagraphSize:0,indentLevel:0,leadingIndent:0,hangingIndent:0,rightMargin:0,bullet:null},this._private=Object.assign(this._private,e||{})}clone(e){const t=e?.visitTextParagraph?.(this,0,1),n=Object.assign(this._private,t||{});return delete n.bounds,new M0(n)}equals(e){return P.deepEqual(this._private,e._private)}get bounds(){return this._bounds}get defaultFontSize(){return this._private.defaultFontSize}get defaultTabSize(){return this._private.defaultTabSize}get tabOverrides(){return this._private.tabOverrides}get spacingBefore(){return this._private.spacingBefore}get spacingAfter(){return this._private.spacingAfter}get lineSpacing(){return this._private.lineSpacing}get align(){return this._private.align}get endParagraphSize(){return this._private.endParagraphSize}get indentLevel(){return this._private.indentLevel}get leadingIndent(){return this._private.leadingIndent}get hangingIndent(){return this._private.hangingIndent}get rightMargin(){return this._private.rightMargin}get bullet(){return this._private.bullet}get runs(){return this._private.runs}},T0=class k0{constructor(e,t=null){this._private={text:null,fontName:"Arial",bold:!1,italic:!1,superSub:!1,fontSize:11,letterSpacing:0,kerningMin:10,smallCaps:Ea.SmallCaps.None,offset:0,strikeStyle:Ea.StrikeStyle.None},this._private={...this._private,...e},this._bounds=t}clone(e){const t=e?.visitTextRun?.(this,0,1),n=Object.assign(this._private,t||{});return delete n.bounds,new k0(n)}equals(e){return P.deepEqual(this._private,e._private)}get bounds(){return this._bounds}get text(){return this._private.text}get fontName(){return this._private.fontName}get bold(){return this._private.bold}get italic(){return this._private.italic}get fontSize(){return this._private.fontSize}get superSub(){return this._private.superSub}get letterSpacing(){return this._private.letterSpacing}get kerningMin(){return this._private.kerningMin}get smallCaps(){return this._private.smallCaps}get offset(){return this._private.offset}get strikeStyle(){return this._private.strikeStyle}};class F0{constructor(e,t,n){this._private={},this._private={bounds:e,baseline:t,runs:n}}get bounds(){return this._private.bounds}get baseline(){return this._private.baseline}get runs(){return this._private.runs}get bullet(){return null}}function N0(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var yg,bg,Cg,vg,xg,Eg;function qy(){if(vg)return Cg;vg=1;const s=new Uint8Array(new Uint32Array([305419896]).buffer)[0]===18,e=(t,n,r)=>{let o=t[n];t[n]=t[r],t[r]=o};return Cg={swap32LE:t=>{s&&(n=>{const r=n.length;for(let o=0;o<r;o+=4)e(n,o,o+3),e(n,o+1,o+2)})(t)}}}var Jy=(function(){if(Eg)return xg;Eg=1;const s=(function(){if(bg)return yg;function t(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function n(y,v){this.source=y,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=v,this.destLen=0,this.ltree=new t,this.dtree=new t}bg=1;var r=new t,o=new t,i=new Uint8Array(30),l=new Uint16Array(30),a=new Uint8Array(30),c=new Uint16Array(30),u=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=new t,h=new Uint8Array(320);function f(y,v,x,E){var R,I;for(R=0;R<x;++R)y[R]=0;for(R=0;R<30-x;++R)y[R+x]=R/x|0;for(I=E,R=0;R<30;++R)v[R]=I,I+=1<<y[R]}var g=new Uint16Array(16);function m(y,v,x,E){var R,I;for(R=0;R<16;++R)y.table[R]=0;for(R=0;R<E;++R)y.table[v[x+R]]++;for(y.table[0]=0,I=0,R=0;R<16;++R)g[R]=I,I+=y.table[R];for(R=0;R<E;++R)v[x+R]&&(y.trans[g[v[x+R]]++]=R)}function p(y){y.bitcount--||(y.tag=y.source[y.sourceIndex++],y.bitcount=7);var v=1&y.tag;return y.tag>>>=1,v}function S(y,v,x){if(!v)return x;for(;y.bitcount<24;)y.tag|=y.source[y.sourceIndex++]<<y.bitcount,y.bitcount+=8;var E=y.tag&65535>>>16-v;return y.tag>>>=v,y.bitcount-=v,E+x}function w(y,v){for(;y.bitcount<24;)y.tag|=y.source[y.sourceIndex++]<<y.bitcount,y.bitcount+=8;var x=0,E=0,R=0,I=y.tag;do E=2*E+(1&I),I>>>=1,++R,x+=v.table[R],E-=v.table[R];while(E>=0);return y.tag=I,y.bitcount-=R,v.trans[x+E]}function b(y,v,x){var E,R,I,A,T,O;for(E=S(y,5,257),R=S(y,5,1),I=S(y,4,4),A=0;A<19;++A)h[A]=0;for(A=0;A<I;++A){var N=S(y,3,0);h[u[A]]=N}for(m(d,h,0,19),T=0;T<E+R;){var D=w(y,d);switch(D){case 16:var F=h[T-1];for(O=S(y,2,3);O;--O)h[T++]=F;break;case 17:for(O=S(y,3,3);O;--O)h[T++]=0;break;case 18:for(O=S(y,7,11);O;--O)h[T++]=0;break;default:h[T++]=D}}m(v,h,0,E),m(x,h,E,R)}function C(y,v,x){for(;;){var E,R,I,A,T=w(y,v);if(T===256)return 0;if(T<256)y.dest[y.destLen++]=T;else for(E=S(y,i[T-=257],l[T]),R=w(y,x),A=I=y.destLen-S(y,a[R],c[R]);A<I+E;++A)y.dest[y.destLen++]=y.dest[A]}}function _(y){for(var v,x;y.bitcount>8;)y.sourceIndex--,y.bitcount-=8;if((v=256*(v=y.source[y.sourceIndex+1])+y.source[y.sourceIndex])!==(65535&~(256*y.source[y.sourceIndex+3]+y.source[y.sourceIndex+2])))return-3;for(y.sourceIndex+=4,x=v;x;--x)y.dest[y.destLen++]=y.source[y.sourceIndex++];return y.bitcount=0,0}return(function(y,v){var x;for(x=0;x<7;++x)y.table[x]=0;for(y.table[7]=24,y.table[8]=152,y.table[9]=112,x=0;x<24;++x)y.trans[x]=256+x;for(x=0;x<144;++x)y.trans[24+x]=x;for(x=0;x<8;++x)y.trans[168+x]=280+x;for(x=0;x<112;++x)y.trans[176+x]=144+x;for(x=0;x<5;++x)v.table[x]=0;for(v.table[5]=32,x=0;x<32;++x)v.trans[x]=x})(r,o),f(i,l,4,3),f(a,c,2,1),i[28]=0,l[28]=258,yg=function(y,v){var x,E,R=new n(y,v);do{switch(x=p(R),S(R,2,0)){case 0:E=_(R);break;case 1:E=C(R,r,o);break;case 2:b(R,R.ltree,R.dtree),E=C(R,R.ltree,R.dtree);break;default:E=-3}if(E!==0)throw new Error("Data error")}while(!x);return R.destLen<R.dest.length?typeof R.dest.slice=="function"?R.dest.slice(0,R.destLen):R.dest.subarray(0,R.destLen):R.dest}})(),{swap32LE:e}=qy();return xg=class{constructor(t){const n=typeof t.readUInt32BE=="function"&&typeof t.slice=="function";if(n||t instanceof Uint8Array){let r;if(n)this.highStart=t.readUInt32LE(0),this.errorValue=t.readUInt32LE(4),r=t.readUInt32LE(8),t=t.slice(12);else{const o=new DataView(t.buffer);this.highStart=o.getUint32(0,!0),this.errorValue=o.getUint32(4,!0),r=o.getUint32(8,!0),t=t.subarray(12)}t=s(t,new Uint8Array(r)),t=s(t,new Uint8Array(r)),e(t),this.data=new Uint32Array(t.buffer)}else({data:this.data,highStart:this.highStart,errorValue:this.errorValue}=t)}get(t){let n;return t<0||t>1114111?this.errorValue:t<55296||t>56319&&t<=65535?(n=(this.data[t>>5]<<2)+(31&t),this.data[n]):t<=65535?(n=(this.data[2048+(t-55296>>5)]<<2)+(31&t),this.data[n]):t<this.highStart?(n=this.data[2080+(t>>11)],n=this.data[n+(t>>5&63)],n=(n<<2)+(31&t),this.data[n]):this.data[this.data.length-4]}}})();const Ky=N0(Jy);var Rg,Ig={},Xy=(Rg||(Rg=1,(function(s){var e=typeof Uint8Array<"u"?Uint8Array:Array,t=43,n=47,r=48,o=97,i=65,l=45,a=95;function c(u){var d=u.charCodeAt(0);return d===t||d===l?62:d===n||d===a?63:d<r?-1:d<r+10?d-r+26+26:d<i+26?d-i:d<o+26?d-o+26:void 0}s.toByteArray=function(u){var d,h,f,g,m,p;if(u.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var S=u.length;m=u.charAt(S-2)==="="?2:u.charAt(S-1)==="="?1:0,p=new e(3*u.length/4-m),f=m>0?u.length-4:u.length;var w=0;function b(C){p[w++]=C}for(d=0,h=0;d<f;d+=4,h+=3)b((16711680&(g=c(u.charAt(d))<<18|c(u.charAt(d+1))<<12|c(u.charAt(d+2))<<6|c(u.charAt(d+3))))>>16),b((65280&g)>>8),b(255&g);return m===2?b(255&(g=c(u.charAt(d))<<2|c(u.charAt(d+1))>>4)):m===1&&(b((g=c(u.charAt(d))<<10|c(u.charAt(d+1))<<4|c(u.charAt(d+2))>>2)>>8&255),b(255&g)),p},s.fromByteArray=function(u){var d,h,f,g=u.length%3,m="";function p(w){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(w)}function S(w){return p(w>>18&63)+p(w>>12&63)+p(w>>6&63)+p(63&w)}for(d=0,f=u.length-g;d<f;d+=3)m+=S(h=(u[d]<<16)+(u[d+1]<<8)+u[d+2]);switch(g){case 1:m+=p((h=u[u.length-1])>>2),m+=p(h<<4&63),m+="==";break;case 2:m+=p((h=(u[u.length-2]<<8)+u[u.length-1])>>10),m+=p(h>>4&63),m+=p(h<<2&63),m+="="}return m}})(Ig)),Ig),nd={};const Zy=[[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,4,4,4,4,4,4,4,4,4,4,4],[0,4,4,1,1,4,4,4,4,1,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,1,4,4,4,4,1,1,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[4,4,4,1,1,1,4,4,4,1,1,1,1,1,1,1,1,1,1,1,4,2,4,1,1,1,1,1,1,1,1,1,1],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,1,1,1,1,1,1,4,2,4,1,1,1,1,1,1,1,1,1,1],[0,4,4,1,1,1,4,4,4,0,0,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,0,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,0,1,0,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,0,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[1,4,4,1,1,1,4,4,4,0,0,1,1,1,1,1,1,1,0,0,4,2,4,1,1,1,1,1,0,1,1,1,0],[1,4,4,1,1,1,4,4,4,0,0,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,0,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,0,1,4,4,4,0,0,1,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,0,1,4,4,4,0,0,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,1,1,1,1,1,1,4,2,4,1,1,1,1,1,1,1,1,1,0],[0,4,4,1,1,1,4,4,4,0,0,0,0,0,0,1,1,1,0,4,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,1,1,1,1,1,1,4,2,4,1,1,1,1,1,1,1,1,1,1],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,1,1,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,1,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,1,1,1,1,0,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,1,1,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,1,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,0,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,1,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,1,1,0],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,1,0,4,4,4,0,0,0,0,0,0,0,0,0,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0]],Qy=new Ky(N0(Xy).toByteArray("AAgOAAAAAAAQ4QAAAQ0P8vDtnQuMXUUZx+eyu7d7797d9m5bHoWltKVUlsjLWE0VJNigQoMVqkStEoNQQUl5GIo1KKmogEgqkKbBRki72lYabZMGKoGAjQRtJJDaCCIRiiigREBQS3z+xzOTnZ3O+3HOhd5NfpkzZx7fN9988zivu2M9hGwB28F94DnwEngd/Asc1EtIs9c/bIPDwCxwLDgezHcodyo4w5C+CCwBS8FnwSXgCnA1uFbI93XwbXAbWAfWgx+CzWAb+An4KfgFeAzsYWWfYuFz4CXwGvgb+Dfo6yNkEEwGh4CZYB44FpwI3g1OY+kfBItZOo2fB84Hy8DF4HJwNbiWpV8PVoO1LH4n2NRXyN+KcAd4kNVP9XsY4aPgcfAbsBfs6SniL4K/sPjfEf6HlanXCRkCw2BGvUh/keWfXS/CY+pFXs7x9XHmM94LTmWIeU2cgbxnS/k/B3kf86jDhU8L9V2E40vAFWAlWFUfb++NOL4F3C7JX4/4GiE+hvgWsF0oS7mXldspnN+F493gyXrh9xTav0cg3EvzgVfBG6wsmVSEkxBOBgdPGpd7JI6PnqRvJ68/xlbHof53gPeA94OzwLngk+ACsAwsByvASrAK3MB0Ws3CtQjvBJvAVrADPMDSHkb4CNijaccTwvnf4fiPEs8Lxy+D18A/QU8/xjgYBjPAbDAKTgYLwOngTHAO+EQ/8wuEF4EvsPiVCFf2+9tsFStzA8LVHuXXBsi6QyqzUYiPMR/7Mc7dAx7oL8bzw/3u/Bw8Bp4Az4AXwCtgHzsmDXP5fiF9iiVvly5d0sHngar16NKlS5cuXbp06fLmYlqHXrcd3ph4P0THUY3iXh49novju4S0tzfs5d+JPKewfAsRntZb3K9ZhOMlrO6lCC8An28U9+OuovcPcPxlVu5rCL/VmHh/iHIrzn3fIPu7SN8Axmg+8AOwEWwCm7tp3bRuWjetm5Y8bSu4B9zbKO6ZVsnORrVU3f4uXTqZ2H3sLoyx3eDXjfDndE9qyj6L838CfwVvgFpzYnof4oNgOhgBc8Fos9DrZIQLmtXPP1MmF6wGj4H+KXoWguvADkXaPil+YpuQy8Am8Ey7ODdtmJDF4HowBp4De6HDTNjhfHAHeBr0DBBy0kDxfPbcgSIusgrcWhtnJ8vL+TPix7UIOQtcBq4C28Cr4KRBnANbwSuDE+s50JgyNNFuXbp06XIgsXjIvPafjvXozKY+fVFz/z0LT1uCtKVSWbrOLWPnztG8e0Xfy7ol8XtZJi7WtG+5od2UFXQ/A12vUeS7jp27yVKHjdsU9lXB869TyNvAzt0lpP2oWbwLdjiO78bx/Sz+EMJHwK9Y/LcIfw+eZ3F67/Hl5vh9xX80J+rwX8SvRDhpgL17iPAQMHNArfPrqHPewLheI+AERV6efwV418B4nOZ/H+IfYHV8GOF5LJ3eAz0fx8sM9S0fUNud39O9CulfGZhY5huI3wzWgNvBelbHZoTbNPVpfYjKQpkHwUNgl0LWblbnk0LbbDxr0OMFpL3iqWdu9nWYPlVAWkXY39LnGdCkDbeqv1YNbfcMQ3t9oe8lzm6NH9N1ZB6Ln4BwfkJZJk7RyFnYKt6b/JDQXx9p5X+eFdqOjzM9P9MB/lUlFzr20aXIdzlY4dmn9F3YqtvoO76/2hp/D/xA5Zue88nNyL8GbFbs075X0tyUig3Qd2MCnf//HjnzpbsR3g9+1kHzzVjdnE71/qVBX9rGPUh/ysNWe1neFzvIDi5zAufV1sT0N0poR22wkFUfTOPfA4N2mbZ5fSrqOHSw+IbkSBbOGSzSRgf91/GTUWYBOB2cIZQ/G8cfBZ8CFwrnL8XxF8FKcA24jqXdiPA7Qr61OF7H4mMItwzuv2/YLth1ISt3Hzu3k4W7EH5JqPdRHD/O4k+z8A8IX5Lq3y7Z4nXE9xn6kX6vQ4bKfy+ok+hH+xf3hq9dnTTHhjKd2GmDuWA242iHMq4cC7A8kJ7i8o1+skSa7Jieo38HCWnoNjKFhdSFBxzpZ7QE6lI8N4S14aASZcryaV/WWHw66f6NHuCoxuQxmvM56GX9QMd8Q4D65ywGP+ZzRJuM+zQvx/MOS2VFeqQ4IXnH26zM9Xe6/E6D+4foAzzuajPZp8Qyw5ayZVDWuH0z0BtYRkeIDqH9KO9VbH1btd/lhNqCzvl8zeLnG0S/hnU6baHfpiuO6yy0rd+DHURo/zYF5H26j03rQsip2ndzz82u1z9N4VjWKWeb68Tedpt95HRVXp7H1R6p+/Wt4FPy/PpWwscOLRJ+PVWF/+W0iVyGzs18TIvXkOJ1Wxm66vSXz+vylenrZcj1ub439W+K8RNCGTJi2p/TJ1K23VaXr35tRpnzmjxequgfcfyk6B/TGBVlyedsNgpdd/h+W1U3P99QyFPNo1X3TwpM/WLTIWYfoBqXrv6iskHZ/RFr79R6hIyHBrH3f1nrUVnjP8SnZZ+rYtzr9Exld5MNbPNErusAPg+77u/eDOPftU9yj39TH7rezxd1LvsZQJlzkWlOirG/79zjMj/mtHUKu7vKy+3/LnXr9okyKedjX5/0He9iP/j63LwOQdarEVlfy8OO/Lqw023j6xcqmwxLiOd6heM2i9cV9LJy8jMJ23yQ+rpbfu7EQ/pXE8KYvUSqvVnb4XzZa6LrHMXHR+zcLvqWbm/Bn0/HzIs6fWPHoat8XfnDKmZGxRxeMbn2UqZ5Q94nmcZRbqqUXbZ8+lcjE+cPX11t814orvvAXNcG8vqj2vvk1MGn3anlj0bIT72v47bvE+Lc98T9b6r7AKn6j+8Duf7D0nnZx/j7Zjn0j9nbpSTndaLr9WNLivP+iN23xF7L+fqv6ZouFyb78jxVXvv5jJ9YUs9/sddO8h7KNg5jrhfaJGztT6G7KF+1d6yCmD5Kdb2fan60rSc552fZr3zeQ9DpnPp+Si5cx5Ktv2QfSzF/mMbWdOm46rFI4XstnU9xeqX4NKb7TKEdcr6pZOK3ID1k/LvFHkVczEuZLEDr499YqvqBym1aEHWgcvoYOtv0M91qQl5TfpO/in6rWx8OVpT1Wedkv3f5xom3T/xeR/6Gx6V86PWAOB4bBpqWdN+yTcVxjIyGRz/FrDGu6w/3d7kPm8StX8RyPu+uuvpNju/vTLJV37GpvoM0oZPnW87VLnL/5pDno1NoW1R6yedU6TyUv3u19a3KFnIbTLYz+ZCLP4T0tU1uivFgso0pnsJ/UtXvarNY28Xq5cvkBDrQP/E5ZaiuQwwfmTlsOiQRU1fMuqrDd/3ISSuwjOwXOfTyGUMpZIXq4GpLn3pUcdfzch2x7XO1u2uZHOPb1G6b3Xg9PH1IIWeEpJlPQtqos2EKW8b0u8rnuP1UeVLoXJb9be0uG9nnbchjU+XTszT5VeNBThPHnc5OKj1U9aj0GTHIVaGy1YhEWT4ixns00DT+XEzWn/7VAsIc63Cov3OdyhwjrnaqQqZvWKXdypRdlq+k8msZ031U+Rm4fA+3TtyeR9hwfW9G9yxDN0fZMN33F+9TE6md4hwoxumfaUzI9fN3PFT3xVV2msrQ3UsnChm6Nulk8TndpS28D3zX9tTIPsF/z7Am5OkTjm1tI1JZW74+4VgsZ0N3L1yXV3WeP5uR7TGHHdvC3JQlxybfpd22tDlk/2eofRK8TzrN/qnar/K/OUTth6I/+jAnEptNbPvFHP2gs40N3+dfMWtwqvVct7/wfd8gtQ7imifial9ZJ9/3IHLYU6eDj3+4PhsNhX+vwvcWLnu6kGfEMe8DuciPfUfGZB8X/7HJy/Gefe5n+VRGFd/wyP2ta7/LO4yh/sbLV/k9lev6kfO9Dt/5U67b1/6u/epqB1U9Me23jfHY9sscAg4tkbLl+e4/U36rJ9ddxfd6sg5vq5ice42Wpk/pb9FOJ36/W9tpv4kbC79nUbZceX8Zu6/qJ+P3WvhvA8v3reh7Jbn2d6rrNC7XNZTLma4Ba0JI9efX2uLzF5scG/w9UNU1ZxW+ymUfzELeTllXlQ1rUuhzjS5fp9c964iFBOqeSz63bU065nZKdU+mDEz3qHIjjifquw0pnb/raRtvrnsYcb46ihT3taoYz6brdNW9l6rWRnE/navdPn1XlR1km7hcz1WlH/elKuSOSvLLuE8U6m8uzwRdfcGl73VyTHuyMvzJ1Sa2cWDTP/Z63Kc94n2B1PYr24dz1JlyHLlcP+S4B6vD1c9EW4q2LWstCvUjeVy63k/LMYdUNd5D1xQfvVTzX1VjkMsUv88N8VH5fReVn/Fjn++/h6X6Q8a6b1/q3g/i/ewi0/Scs8zxXeV6mWIOUPlPzBgdFerW+bZrm2P18dnjuK6HunEp+rHvPMXbr+sHVb/lnL+pTP57jPw9Cvk3PW178JD9qChfzuvTf7Htl38L1QUf/VKu9SFjwWbTWPvFEvu7Uq76y7+31g6QlYPc669pbsm9Xur2LWI9Pu8ypfDXqm3A2z8s1FWGn4ntL9NfQu2oSlftX9uetvTtv7J8Ql4zxfXGZ3zk8PeQ9w59x2uMfqI8/q5eKh/l9cb2rwsu9rSNl06ZP2Pmxtz+rNMx93yno0n2/82rVH7rQ+y9P15H6FyRun9ViH81ATmffI7nJ5r8uXXW6enbP6b/B8/l5OifVHYLnb9S39s2zcc+Ph+rh8+eQgVPS72elzGWY/tUtbbabBpDiI7yN1q6/4th2y+ErAc5+9BVvu/7KamJbWNZeuqI/R4tRf+YyD1HmOZM1bMV3/14Sn10c0Xu+Sj1nOXb5jL73ncdy02uvlXZNde65dOHYl7Vs4KYuS6FzWLn2zJlpZqPXPVPOa5yzKOyn1VhT9lmMfdbfH7D11Wf2PXN5h9y+dD287+qxgSnaYmnIrRtIb8pJe6/Uv9OVer6Whn0zfGO/BEloZI9ojmfAlUflClDd178bTmVHVTpZXOkAlk/lb42UujmI89HH5V+cl7XtowY6vTxLVWok6UrGzoGTHN+bB+6ri05687VNpvfuvRfaP2uMlNQth1D5JjGelm/8yn+9p3p/7qk9gnfeddXZmq/Sm333PJT659Kv1zjNbZ9uv2Oi//67CV8/N1nj1DmviyXDNVeJkaeaX8UsyesYg8cu2+NvdaPfb+lLDu5tvt/")),Ag=function(s){switch(s){case 33:case 39:case 40:case 42:return 12;case 35:return 5;default:return s}},Mg=function(s){switch(s){case 37:case 38:return 34;case 41:return 22;default:return s}};let qc=class{constructor(e,t=!1){this.position=e,this.required=t}};nd=class{nextCodePoint(){const s=this.string.charCodeAt(this.pos++),e=this.string.charCodeAt(this.pos);return 55296<=s&&s<=56319&&56320<=e&&e<=57343?(this.pos++,1024*(s-55296)+(e-56320)+65536):s}nextCharClass(){return Ag(Qy.get(this.nextCodePoint()))}getSimpleBreak(){switch(this.nextClass){case 41:return!1;case 34:case 37:case 38:return this.curClass=34,!1;case 36:return this.curClass=36,!1}return null}getPairTableBreak(s){let e=!1;switch(Zy[this.curClass][this.nextClass]){case 0:e=!0;break;case 1:e=s===41;break;case 2:if(e=s===41,!e)return e=!1,e;break;case 3:if(s!==41)return e}return this.LB8a&&(e=!1),!this.LB21a||this.curClass!==16&&this.curClass!==17?this.LB21a=this.curClass===13:(e=!1,this.LB21a=!1),this.curClass===28?(this.LB30a++,this.LB30a==2&&this.nextClass===28&&(e=!0,this.LB30a=0)):this.LB30a=0,this.curClass=this.nextClass,e}nextBreak(){if(this.curClass==null){let s=this.nextCharClass();this.curClass=Mg(s),this.nextClass=s,this.LB8a=s===31,this.LB30a=0}for(;this.pos<this.string.length;){this.lastPos=this.pos;const s=this.nextClass;if(this.nextClass=this.nextCharClass(),this.curClass===34||this.curClass===36&&this.nextClass!==37)return this.curClass=Mg(Ag(this.nextClass)),new qc(this.lastPos,!0);let e=this.getSimpleBreak();if(e===null&&(e=this.getPairTableBreak(s)),this.LB8a=this.nextClass===31,e)return new qc(this.lastPos)}return this.lastPos<this.string.length?(this.lastPos=this.string.length,new qc(this.string.length)):null}constructor(s){this.string=s,this.pos=0,this.lastPos=0,this.curClass=null,this.nextClass=null,this.LB8a=!1,this.LB21a=!1,this.LB30a=0}};class Yy{constructor(e){this._textMeasurer=e}_measureText(e){const t=this._fontSize,n=this._fontName,r=this._metricOptions;if(this._isSuperSub){const o=this._textMeasurer(e,.6*t,n,r);return{...this._textMeasurer("M",t,n,r),width:o.width}}return this._textMeasurer(e,t,n,r)}_breakWord(e,t,n){let r=0;for(;r<e.length;){let o={startPosition:this._charactersRead+r,text:"",x:0,y:0,width:0,widthWhitespace:0,height:0,baseline:0},i=!1,l=0;const a=this._maxWidth;do{i=!1;const c=e.substring(r,r+l+1),u=c.replace(/\s+$/,""),d=this._measureText(u);let h=d;c.length!==u.length&&(h=this._measureText(c)),(o.x+d.width<=a||c.length<=1)&&(o.text=c,o.width=d.width,o.widthWhitespace=h.width,o.height=Math.max(o.height,d.lineHeight),o.baseline=Math.max(o.baseline,d.baseline),i=!0,l++)}while(i&&r+l<e.length);if(i){const c=e.substring(r,e.length),u=c.replace(/\s+$/,""),d=this._measureText(u);let h=d;c.length!==u.length&&(h=this._measureText(c)),t.startPosition=this._charactersRead+r,t.width=d.width,o.widthWhitespace=h.width,t.height=Math.max(t.height,d.lineHeight),t.baseline=Math.max(t.baseline,d.baseline),t.text=c}else if(n?.(o)===!1)return!1;r+=l}}_breakWhiteSpace(e,t=null){for(;e&&this._charactersRead<e.length;){let n={startPosition:this._charactersRead,text:"",x:0,y:0,width:0,widthWhitespace:0,height:0,baseline:0},r=!1;const o=this._maxWidth,i=this._indent,l=this._breaker;do if(r=!1,n.startPosition===0&&n.text.length===0&&(n.x=i,this._lastBreak=l.nextBreak()),this._lastBreak){const a=e.substring(n.startPosition,this._lastBreak.position),c=a.replace(/\s+$/,""),u=this._measureText(c);let d=u;a.length!==c.length&&(d=this._measureText(a)),n.x+u.width<=o?(n.text=a,n.width=u.width,n.widthWhitespace=d.width,n.height=Math.max(n.height,u.lineHeight),n.baseline=Math.max(n.baseline,u.baseline),r=!0,this._charactersRead=this._lastBreak.position):n.text.length===0&&this._breakWord(a,n,t)!==!1&&(r=!0,this._charactersRead=this._lastBreak.position),(r||a.indexOf(`
`)===-1)&&this._lastBreak.required&&(this._lastBreak=l.nextBreak(),r=!1)}while(r&&(this._lastBreak=l.nextBreak()));if(t?.(n)===!1)return!1}}wrap(e,t=null){this._breaker=new nd(e),this._linesRead=[],this._charactersRead=0,this._maxXRead=0,this._maxXWhitespaceRead=0,this._maxYRead=0,this._fontName=t?.fontName??"Arial",this._fontSize=t?.fontSize??12,this._metricOptions={isBold:t?.bold??!1,isItalic:t?.italic??!1,letterSpacing:t?.letterSpacing??0},this._isSuperSub=t?.superSub??!1,this._indent=t?.indent??0,this._maxWidth=t?.maxWidth??Number.MAX_SAFE_INTEGER,this._maxWidth<=0&&(this._maxWidth=Number.MAX_SAFE_INTEGER),this._maxHeight=t?.maxHeight??Number.MAX_SAFE_INTEGER,this._maxHeight<=0&&(this._maxHeight=Number.MAX_SAFE_INTEGER);const n=o=>{if(this._linesRead.length>0){let i=this._linesRead[this._linesRead.length-1];o.y=i.y+i.height}if(o.y+o.height>this._maxHeight)return!1;this._maxXRead=Math.max(this._maxXRead,o.x+o.width),this._maxXWhitespaceRead=Math.max(this._maxXWhitespaceRead,o.x+o.widthWhitespace),this._maxYRead=Math.max(this._maxYRead,o.y+o.height),this._linesRead.push(o)};if(e===""){const o=this._measureText(e);n({startPosition:0,text:"",x:0,y:0,width:0,widthWhitespace:0,height:o.lineHeight,baseline:o.baseline})}else if(this._breakWhiteSpace(e,n),new nd(e.charAt(e.length-1).repeat(2)).nextBreak().required){const o=this._measureText(e);n({startPosition:e.length,text:"",x:0,y:0,width:0,widthWhitespace:0,height:o.lineHeight,baseline:o.baseline})}const r={bounds:{x:0,y:0,width:this._maxXRead,widthWhitespace:this._maxXWhitespaceRead,height:this._maxYRead},lines:this._linesRead};return this._breaker=null,this._linesRead=[],r}}const e1=(s,e,t,n=null,r=Be.getSharedMeasurer())=>{let o="",i=null,l=null;const a=s.paragraphs,c=a.length;for(let C=0;C<c;C++){const _=a[C].runs,y=_.length;for(let v=0;v<y;v++)o+=_[v].text,v===0&&(i=_[v]);C===0&&(l=a[C])}const u=s.insets??zr.EmptyRect,d=new Yy(r),h=n?.width?n.width-u.right-u.left:n?.width,f=n?.height?n.height-u.bottom-u.top:null,g=d.wrap(o,{fontName:i.fontName,fontSize:i.fontSize*Be.getDeviceScale(),bold:i.bold,italic:i.italic,superSub:i.superSub,letterSpacing:i.letterSpacing,maxWidth:s.wrapped&&h?h:null,maxHeight:f});let m=[];const p=g.lines,S=p.length,w=new Array(S);for(let C=0;C<S;C++){const _=p[C],y={x:_.x,y:_.y,width:_.width,height:_.height},v=new T0({text:_.text,fontName:i.fontFamily,fontSize:i.fontSize,bold:i.bold,italic:i.italic,superSub:i.superSub,letterSpacing:i.letterSpacing},y);m.push(v),w[C]=new F0(y,_.baseline,[v])}const b=new A0({runs:m,align:l.align});return new R0({paragraphs:[b],wrapped:s.wrapped,verticalAlignment:s.verticalAlignment},e,t,w,{x:g.bounds.x,y:g.bounds.y,width:g.bounds.widthWhitespace,height:g.bounds.height},{x:g.bounds.x,y:g.bounds.y,width:g.bounds.width,height:g.bounds.height})},Tg=s=>{let e=!1,t=!1;for(let n=0;n<s.length;n++){const r=s.charCodeAt(n);if(r>=65&&r<=90?e=!0:r>=97&&r<=122&&(t=!0),e&&t)return 0}return e?1:t?-1:0},Ka=(s,e,t,n,r=!1)=>{if(s==null)return null;const o=new T0({text:s,fontName:e.toCSS().fontFamily,fontSize:e.getSize(),bold:e.getWeight()>400,italic:e.getStyle()===Be.Style.Italic,superSub:!r&&(e.getVerticalAlignment()===Be.VerticalAlignment.Sub||e.getVerticalAlignment()===Be.VerticalAlignment.Super),letterSpacing:e.getLetterSpacing()}),i=r?ce.HorizontalAlignment.Left:t.getHorizontal(),l=t.getVertical(),a=new A0({runs:[o],align:i});let c=[];return c.push(new F0(null,e.getSize(),[o])),new R0({paragraphs:[a],wrapped:n&&(t.getOverflow()===ce.Overflow.Wrap||i===ce.HorizontalAlignment.Justify||i===ce.HorizontalAlignment.Distributed||l===ce.VerticalAlignment.Justify||l===ce.VerticalAlignment.Distributed),verticalAlignment:l},e,t,c)},dl=(s,e,t,n)=>({x:s*n-e*t,y:s*t+e*n}),kg=s=>{let e=0,t=0,n=0,r=0,o=0,i=0,l=0,a=s.length;if(a===0)return{m:0,b:0};if(a===1)return{m:1,b:s[0]};for(let u=0;u<a;u++)i=u+1,l=s[u],l==null||isNaN(l)||(e+=i,t+=l,r+=i*i,n+=i*l,o++);const c=(o*n-e*t)/(o*r-e*e);return{m:c,b:t/o-c*e/o}},rd=(s,e)=>{if(e===null)return null;const t=P.isObject(e);return s!=null&&t?P.mergeContentful(s,e):t?P.cloneObject(e):e},t1=(s,e,t)=>s==null||typeof s=="object"&&Object.keys(s).length===0;function Yd(s,e,t,n){if(s===e)return s??null}function n1(s){return s==null}function r1(s,e,t=1,n){if(t===0)return{preceding:s?[...s]:[],modified:[],trailing:[]};const r=(function(a,c,u=1){let d=P.findEqualOrGreater(a,c,m=>m.max);const h=a.slice(0,d),f=[],g=[];if(!a[d])return{preceding:h,modified:f,trailing:g};for(let m=d;m<a.length;m++)c+u<a[m].min?g.push({...a[m],min:a[m].min-u,max:a[m].max-u}):c>=a[m].min?Math.max(c,a[m].max+1-u)>a[m].min&&f.push({...a[m],max:Math.max(c-1,a[m].max-u)}):c<a[m].min&&c+u<=a[m].max&&f.push({...a[m],min:Math.max(c,a[m].min-u),max:a[m].max-u});return{preceding:h,modified:f,trailing:g}})(s,e,t),o=r.preceding,i=r.trailing;let l=[];return o.length>0&&l.push(o.pop()),l=l.concat(r.modified),i.length>0&&l.push(i.shift()),{preceding:o,modified:Ro(l,{onMerge:Yd}).modified,trailing:i}}function Fg(s,e,t){if(!s)throw new Error("runs can not be null");if(!e)return{preceding:[],modified:s?[...s]:[],trailing:[]};const n=(function(i,l,a,c,u=!1){if(!l)return{preceding:[],modified:i?[...i]:[],trailing:[]};let d,h=P.findEqualOrGreater(i,l.min,w=>w.max),f=i.slice(0,h),g=i.slice(h),m=[],p={...l},S=g[0]||{min:l.min,max:l.max,value:void 0};for(d=u?(w,b,C)=>{const _=(c||rd)(b,C,w);_!==void 0?w.value=_:delete w.value,m.push(w)}:(w,b,C)=>{let _=(c||rd)(b??null,C,w);_!==void 0?w.value=_:delete w.value,m.push(w)};g.length>=0&&p.max-p.min>=0;){if(p.min<S.min)d({min:p.min,max:Math.min(p.max,S.min-1)},void 0,p.value),p={min:S.min,max:p.max,value:p.value},S={min:p.min,max:S.max,value:S.value};else if(p.min>S.min){const w=S.value!==void 0&&a?a(S,p.min):[S.value,S.value];m.push({min:S.min,max:Math.min(p.min,S.max)-1,value:w[0]}),p={min:Math.min(p.min,S.max),max:p.max,value:p.value},S={min:p.min,max:S.max,value:w[1]}}else{const w=S.value!==void 0&&a?a(S,p.min):[S.value,S.value];d({min:S.min,max:Math.min(p.max,S.max)},w[0],p.value),p={min:Math.min(p.max,S.max)+1,max:p.max,value:p.value},S={min:Math.min(p.max,S.max)+1,max:S.max,value:w[1]}}S.min<=S.max?g[0]=S:(g=g.slice(1),S=g[0]||{min:S.min,max:p.max})}return{preceding:f,modified:m,trailing:g}})(s,e,t?.onSplit,t?.onUpdate,t?.inPlace);let r=[];n.preceding.length>0&&r.push(n.preceding.pop()),r=r.concat(n.modified),n.trailing.length>0&&r.push(n.trailing.shift());const o=(function(i,l){if(!i||i.length===0)return{preceding:[],modified:i?[...i]:[],trailing:[]};const a=Math.min(i.length-1,l?.startOffset??0),c=Math.min(i.length,l?.endOffset??i.length),u=l?.cull??n1;let d=i.slice(0,a),h=i.slice(c);const f=[];for(let g=a;g<c;g++)u(i[g].value,i[g].min,i[g].max)!==!0&&f.push(i[g]);return{preceding:d,modified:f,trailing:h}})(Ro(r,{onMerge:t?.onMerge??Yd}).modified,{cull:t?.isCull||t1});return{preceding:n.preceding,modified:o.modified,trailing:n.trailing}}function Tr(s){return[...s.preceding,...s.modified,...s.trailing]}function Ro(s,e){if(!s||s.length===0)return{preceding:[],modified:s?[...s]:[],trailing:[]};const t=Math.min(s.length-1,e?.startOffset??0),n=Math.min(s.length,e?.endOffset??s.length),r=e?.onMerge??Yd;let o=s.slice(0,t),i=s.slice(n);const l=[];let a={...s[t]},c=s[t]?.max||0;for(let u=t+1;u<=n;u++){const d=s[u];let h=!1;if(d&&d.min<=s[u-1].max+1)if(a.value===void 0&&d.value===void 0)h=!0;else{const f=r(a.value,d.value,a.max-a.min+1,d.max-d.min+1);f!==void 0&&(h=!0,a.value=f)}h?a.max=Math.max(c,d.max):(l.push(a),a={...s[u]},d&&(a.max=Math.max(c,d.max))),a&&(c=a.max)}return{preceding:o,modified:l,trailing:i}}function Ng(s){return s&&s.sort((e,t)=>{let n=e.min-t.min;return n===0&&(n=e.max-t.max),n})}const Og=(s,e=!1)=>{if(!s||s.length===0)return P.EmptyArray;const t=e?s:s.sort(),n=[];let r=null;for(let o=0;o<t.length;o++){const i=t[o];r?r.max===i-1?r.max=i:(n.push(r),r={min:i,max:i}):r={min:i,max:i}}return r&&n.push(r),n},Dg=(s,e)=>s?e?s||e?s.min>e.max||s.max<e.min?null:{min:Math.max(s.min,e.min),max:Math.min(s.max,e.max)}:null:{...s}:{...e},O0=s=>{const e=s.length===0;return{runs:s,run:{min:e?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,max:e?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,value:null},index:Number.MAX_SAFE_INTEGER}},D0=(s,e)=>{const t=e.run,n=t.min,r=t.max;if(s>=n&&s<=r)return t.value;let o=e.index;const i=e.runs;if(o<i.length-1&&s>r){o++;const u=i[o],d=u.min,h=u.max;if(s>=d&&s<=h)return e.index=o,t.min=d,t.max=h,t.value=u.value,t.value}if(o!==Number.MAX_SAFE_INTEGER&&o>0&&s<n){o--;const u=i[o],d=u.min,h=u.max;if(s>=d&&s<=h)return e.index=o,t.min=d,t.max=h,t.value=u.value,t.value}if(o=P.findEqualOrGreater(i,s,u=>u.max),o===i.length)return o=i.length,e.index=o,t.min=i[o-1].max+1,t.max=Number.MAX_SAFE_INTEGER,t.value=null,null;const l=i[o],a=l.min,c=l.max;if(s>=a&&s<=c){e.index=o,t.min=a,t.max=c;const u=l.value;return t.value=u,u}return o--,e.index=o,t.min=o>=0?i[o].max+1:Number.MIN_SAFE_INTEGER,t.max=a-1,t.value=null,null},L0=function(s,e,t,n){if(s.length===0){if(t!=null||n!=null){const c=e({min:t??n,max:n??t});if(c&&c.break)return c}return}const r=t??s[0].min,o=n??s[s.length-1].max;let i=r-1,l=P.findEqualOrGreater(s,r,c=>c.max),a=s[l];for(;a&&a.min<=o;){if(i<a.min-1){const u=e({min:Math.max(i+1,r),max:Math.min(a.min-1,o)});if(u&&u.break)return u}const c=e({...a,min:Math.max(a.min,r),max:Math.min(a.max,o)});if(c&&c.break)return c;i=a.max,a=s[++l]}if(i<o){const c=e({min:Math.min(i+1,o),max:o});if(c&&c.break)return c}},Lg=new RegExp("([0-9]+)$");var Fi,He,hl,V,gl;(s=>{s.Date=class{constructor(l){this._options=l}canFill(l,a){return As(l)}createFillAt(l,a){a={...this._options,...a};let c=0,u=this._options?.unit;u||(u=l.length===1?cl:((f,g=!1)=>{if(!f||f.length<1)return cl;let m=f;g||(m=f.slice(),m=m.sort((b,C)=>b.getTime()-C.getTime()));let p=!1,S=-1,w=-1;for(let b=0;b<m.length;b++){let C=m[b];if(b>m.length-1&&C.getTime()<m[b+1].getTime())throw new Error("Dates are expected to be sorted.");let _=12*C.getFullYear()+C.getMonth();if(_===w)return cl;w=_;let y=C.getFullYear();y>S?S=y:p=!0}return p?ag:cg})(l));const d=ug(l[0],0,u);d.setHours(0,0,0,0);let h=1;a?.reverse&&(h*=-1,c*=-1);for(let f=1;f<l.length;f++){let g=Fy(l[f-1],l[f],u);if(f===1)h=g;else if(g!==h)return null}return l.length===1&&a.multiFill,f=>{const g=ug(d,h*f,u);if(c!==0){const m=0+c*f,p=m%1440,S=Math.floor(p/60),w=p%60;g.setHours(S,w,0,0);const b=Math.floor(m/1440),C=Math.floor(b/365),_=b%365,y=Math.floor(_/30),v=_%30;C>0&&g.setFullYear(g.getFullYear()+C),y>0&&g.setMonth(g.getMonth()+y),v>0&&g.setDate(g.getDate()+v)}return g}}},s.Linear=class{constructor(l){this._options=l}canFill(l,a){return typeof l=="number"||l===null}createFillAt(l,a){a={...this._options,...a};const c=kg(l),u=c.b;let d=c.m;return l.length===1?(a.reverse&&(d=-d),a.multiFill?h=>h*d+u:null):h=>d*(h+1)+u}};const e={value:null,template:null},t={sensitivity:"accent"};s.Ordinal=class{_template(l){const a=l.match(Lg);if(!a)return null;const c=a[1],u=l.lastIndexOf(c);return u===-1?null:l.substring(0,u)}canFill(l,a){if(l===null)return!0;if(typeof l!="string")return e.value=null,!1;const c=this._template(l);return c&&(a===void 0||a===e.value&&c.localeCompare(e.template,void 0,t)===0)?(e.value=l,e.template=c,!0):(e.value=null,!1)}createFillAt(l,a){const c=[],u=l[0];let d=null,h=null,f=0;if(u){const w=u.match(Lg);if(w){d=w[1],d.startsWith("0")&&(f=d.length);const b=u.lastIndexOf(d);h=u.substring(0,b)}}const g=l.length;for(let w=0;w<g;w++){const b=l[w];let C=null;if(b){const _=b.substring(h.length,b.length);_.startsWith("0")&&(f=Math.max(f,_.length));const y=parseFloat(_);isNaN(y)||(C=y)}c.push(C)}const m=kg(c),p=m.b;let S=m.m;return S!==0&&Number.isInteger(S)?w=>{if(l[w%g]===null)return null;const b=(g===1?a.reverse?-w:w:S*(w+1))+p,C=""+Math.abs(b),_="0".repeat(Math.max(0,f-C.length))+C;return h+_}:null}},s.Copy=class{canFill(l,a){return!0}createFillAt(l,a){const c=l.length;return u=>l[u%c]??null}};const n=Object.freeze(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]),r=Object.freeze(["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]),o=Object.freeze(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),i=Object.freeze(["January","February","March","April","May","June","July","August","September","October","November","December"]);s.List=class{constructor(l){this._lists=[],this._map=new Map;const a=[];if(l?.customLists){const d=l.customLists;for(let h=d.length-1;h>0;h--)a.push(d[h])}a.push(i),a.push(o),a.push(r),a.push(n);const c=this._map,u=[];for(let d=0;d<a.length;d++){const h=a[d],f=[];u.push(f);for(let g=0;g<h.length;g++){const m=h[g],p=_s(m,!0),S=p.toLowerCase().trim();let w=c.get(S);w||(w=[],c.set(S,w));const b={value:p,asKey:S,major:d,minor:g};w.push(b),f.push(b)}}this._lists=Object.freeze(u)}canFill(l,a){return l===null?!0:typeof l!="string"?!1:!!this._map.get(l.toLowerCase().trim())}createFillAt(l,a){const c=[],u=l[0];c.push(u.toLowerCase().trim());const d=this._map.get(c[0]);let h;const f=new Map,g=new Set;for(let R=0;R<d.length;R++){const I=d[R];f.set(I.major,I)}if(l.length>1){for(let R=1;R<l.length;R++){const I=l[R].toLowerCase().trim(),A=this._map.get(I);if(!A)return null;R===1&&(h=A),c.push(I);for(let T=0;T<A.length;T++){const O=A[T].major;f.has(O)&&g.add(O)}}if(g.size===0)return null}let m=null;const p=this._lists;for(let R=0;!m&&R<p.length;R++)(l.length===1||g.has(R))&&(m=f.get(R));if(!m)return null;let S=null;for(let R=0;!S&&h&&R<h.length;R++)h[R].asKey===c[1]&&(S=h[R]);let w=!1,b=!1;const C=Tg(u);C===1?w=!0:(C===-1||Tg(u[0])===-1)&&(b=!0);const _=p[m.major];let y=m.minor,v=1;if(c.length>1){v=S.minor-m.minor;for(let R=2;R<c.length;R++)if(_[R+y].minor-_[R-1+y].minor!==v)return null}l.length===1&&a?.reverse&&(v=-v);const x=l.length,E=_.length;return R=>{if(l[R%x]===null)return null;let I=(R*v+y)%E;I<0&&(I=E+I);const A=_[I].value??null;return w?A.toUpperCase():b?A.toLowerCase():A}}},s.Composite=class{constructor(l){l=Array.isArray(l)?[...l]:[l],this._fillers=l}canFill(l,a){return!0}createFillAt(l,a){const c=this._fillers;a={multiFill:l.length>1,...a};const u=l.length;let d=0,h=!1;for(let v=0;!h&&v<=u;v++)l[v]===null?d++:h=!0;let f=0;h=!1;for(let v=u-1;!h&&v>=d;v--)l[v]===null?f++:h=!0;const g=[];let m=null,p=null,S=[],w=d,b=0;const C=v=>{if(m&&m.max+1===w){const x=m.value;x.fillAt.push(v),m.max=w,x.length++,x.valuesLength++}else m={min:w,max:w,value:{fillAt:[v],start:w,length:1,valuesLength:u,blankInterval:0}};g.push(m)},_=u-f;for(w=d;w<_;){let v=l[w];if(v===null){w++;continue}p=null;let x,E=1,R=!1;for(let O=0;!R&&O<c.length+1;O++){const N=c[O];N&&(R=N.canFill(v,x),R&&(p=N))}if(!p){v!==null&&C(v),w++;continue}let I=0;b=0,x=v;do v=l[w+E],R=p.canFill(v,x),R&&(v!==null?(x=v,I>0&&(E-I===1?b=I:I!==b&&(b=0)),I=0):I++,E++);while(R&&w+E<_);S=[l[w]];const A=1+b,T=E-I;for(let O=A;O<T;O+=A)S.push(l[w+O]);if(S.length>0){const O=S.length,N=O+(O-1)*b,D=p.createFillAt?.(S,a)??S;g.push({min:w,max:w+N-1,value:{fillAt:D,start:w,length:N,valuesLength:O,blankInterval:b}})}w+=E}const y=O0(g);return v=>{const x=v>=0,E=Math.abs(v),R=D0(E%u,y);if(!R)return null;const I=Math.floor(E/u),A=R.length,T=R.start,O=(I+(x?1:0))*T+(I+(x?0:1))*(u-(T+A));let N=v+(x?-O:O);const D=R.blankInterval;if(D!==0){let k=N%A;if(k%(1+D)!==0)return null;N=Math.floor(k/(1+D))+R.valuesLength*I}const F=R.fillAt;return typeof F=="function"?F(N):F[N%F.length]}}},s.Types={Series:new s.Composite([new s.Date,new s.Linear,new s.Ordinal,new s.List]),DateDays:new s.Date({unit:cl}),DateMonths:new s.Date({unit:ag}),DateYears:new s.Date({unit:cg}),Copy:new s.Copy},s.fillTo=(l,a,c,u)=>{const d=[],h=a.length,f=l.createFillAt(a,u);for(let g=h;g<c;g++)d.push(f(g));return d}})(Fi||(Fi={})),(hl=He||(He={})).Type={None:"none",Solid:"solid",Gradient:"gradient",Pattern:"pattern",Image:"pattern",Background:"background",Group:"group",Custom:"custom"},hl.GradientType={Linear:"linear",Path:"path",Circular:"circular",Rect:"rect"},hl.TileMirror={None:"none",Vertical:"v",Horizontal:"h",Both:"b"},hl.BuiltInSheetPattern={None:"none",Solid:"solid",DarkGray:"darkGray",MediumGray:"mediumGray",LightGray:"lightGray",Gray0625:"gray0625",Gray125:"gray125",DarkHorizontal:"darkHorizontal",DarkVertical:"darkVertical",DarkDown:"darkDown",DarkUp:"darkUp",DarkGrid:"darkGrid",DarkTrellis:"darkTrellis",LightHorizontal:"lightHorizontal",LightVertical:"lightVertical",LightDown:"lightDown",LightUp:"lightUp",LightGrid:"lightGrid",LightTrellis:"lightTrellis",Custom:"custom"},(gl=V||(V={})).AdjustmentType={Alpha:"alpha",AlphaOff:"alphaOff",AlphaMod:"alphaMod",Hue:"hue",Sat:"sat",Lum:"lum",HueOff:"hueOff",SatOff:"satOff",LumOff:"lumOff",HueMod:"hueMod",SatMod:"satMod",LumMod:"lumMod",Red:"red",Green:"green",Blue:"blue",RedOff:"redOff",GreenOff:"greenOff",BlueOff:"blueOff",RedMod:"redMod",GreenMod:"greenMod",BlueMod:"blueMod",Shade:"shade",Tint:"tint",ETint:"eTint",Gray:"gray",Comp:"comp",Inv:"inv",Gamma:"gamma",InvGamma:"invGamma"},gl.Named={ActiveBorder:"activeBorder",ActiveCaption:"activeCaption",CaptionText:"captionText",AppWorkspace:"appWorkspace",BtnFace:"btnFace",BtnShadow:"btnShadow",DkShadow3d:"3dDkShadow",BtnHighlight:"btnHighlight",Light3d:"3dLight",BtnText:"btnText",Background:"background",GrayText:"grayText",Highlight:"highlight",HighlightText:"highlightText",HotLight:"hotLight",InactiveBorder:"inactiveBorder",InactiveCaption:"inactiveCaption",InactiveCaptionText:"inactiveCaptionText",InfoBk:"infoBk",InfoText:"infoText",Menu:"menu",MenuText:"menuText",ScrollBar:"scrollBar",Window:"window",WindowFrame:"windowFrame",WindowText:"windowText",Transparent:"transparent",AliceBlue:"aliceBlue",AntiqueWhite:"antiqueWhite",Aqua:"aqua",Aquamarine:"aquamarine",Azure:"azure",Beige:"beige",Bisque:"bisque",Black:"black",BlanchedAlmond:"blanchedAlmond",Blue:"blue",BlueViolet:"blueViolet",Brown:"brown",BurlyWood:"burlyWood",CadetBlue:"cadetBlue",Chartreuse:"chartreuse",Chocolate:"chocolate",Coral:"coral",CornflowerBlue:"cornflowerBlue",Cornsilk:"cornsilk",Crimson:"crimson",Cyan:"cyan",DkBlue:"dkBlue",DkCyan:"dkCyan",DkGoldenrod:"dkGoldenrod",DkGray:"dkGray",DkGreen:"dkGreen",DkKhaki:"dkKhaki",DkMagenta:"dkMagenta",DkOliveGreen:"dkOliveGreen",DkOrange:"dkOrange",DkOrchid:"dkOrchid",DkRed:"dkRed",DkSalmon:"dkSalmon",DkSeaGreen:"dkSeaGreen",DkSlateBlue:"dkSlateBlue",DkSlateGray:"dkSlateGray",DkTurquoise:"dkTurquoise",DkViolet:"dkViolet",DeepPink:"deepPink",DeepSkyBlue:"deepSkyBlue",DimGray:"dimGray",DodgerBlue:"dodgerBlue",Firebrick:"firebrick",FloralWhite:"floralWhite",ForestGreen:"forestGreen",Fuchsia:"fuchsia",Gainsboro:"gainsboro",GhostWhite:"ghostWhite",Gold:"gold",Goldenrod:"goldenrod",Gray:"gray",Green:"green",GreenYellow:"greenYellow",Honeydew:"honeydew",HotPink:"hotPink",IndianRed:"indianRed",Indigo:"indigo",Ivory:"ivory",Khaki:"khaki",Lavender:"lavender",LavenderBlush:"lavenderBlush",LawnGreen:"lawnGreen",LemonChiffon:"lemonChiffon",LtBlue:"ltBlue",LtCoral:"ltCoral",LtCyan:"ltCyan",LtGoldenrodYellow:"ltGoldenrodYellow",LtGray:"ltGray",LtGreen:"ltGreen",LtPink:"ltPink",LtSalmon:"ltSalmon",LtSeaGreen:"ltSeaGreen",LtSkyBlue:"ltSkyBlue",LtSlateGray:"ltSlateGray",LtSteelBlue:"ltSteelBlue",LtYellow:"ltYellow",Lime:"lime",LimeGreen:"limeGreen",Linen:"linen",Magenta:"magenta",Maroon:"maroon",MedAquamarine:"medAquamarine",MedBlue:"medBlue",MedOrchid:"medOrchid",MedPurple:"medPurple",MedSeaGreen:"medSeaGreen",MedSlateBlue:"medSlateBlue",MedSpringGreen:"medSpringGreen",MedTurquoise:"medTurquoise",MedVioletRed:"medVioletRed",MidnightBlue:"midnightBlue",MintCream:"mintCream",MistyRose:"mistyRose",Moccasin:"moccasin",NavajoWhite:"navajoWhite",Navy:"navy",OldLace:"oldLace",Olive:"olive",OliveDrab:"oliveDrab",Orange:"orange",OrangeRed:"orangeRed",Orchid:"orchid",PaleGoldenrod:"paleGoldenrod",PaleGreen:"paleGreen",PaleTurquoise:"paleTurquoise",PaleVioletRed:"paleVioletRed",PapayaWhip:"papayaWhip",PeachPuff:"peachPuff",Peru:"peru",Pink:"pink",Plum:"plum",PowderBlue:"powderBlue",Purple:"purple",Red:"red",RosyBrown:"rosyBrown",RoyalBlue:"royalBlue",SaddleBrown:"saddleBrown",Salmon:"salmon",SandyBrown:"sandyBrown",SeaGreen:"seaGreen",SeaShell:"seaShell",Sienna:"sienna",Silver:"silver",SkyBlue:"skyBlue",SlateBlue:"slateBlue",SlateGray:"slateGray",Snow:"snow",SpringGreen:"springGreen",SteelBlue:"steelBlue",Tan:"tan",Teal:"teal",Thistle:"thistle",Tomato:"tomato",Turquoise:"turquoise",Violet:"violet",Wheat:"wheat",White:"white",WhiteSmoke:"whiteSmoke",Yellow:"yellow",YellowGreen:"yellowGreen",ButtonFace:"buttonFace",ButtonHighlight:"buttonHighlight",ButtonShadow:"buttonShadow",GradientActiveCaption:"gradientActiveCaption",GradientInactiveCaption:"gradientInactiveCaption",MenuBar:"menuBar",MenuHighlight:"menuHighlight"},gl.Scheme={Bg1:"bg1",Bg2:"bg2",Tx1:"tx1",Tx2:"tx2",Accent1:"accent1",Accent2:"accent2",Accent3:"accent3",Accent4:"accent4",Accent5:"accent5",Accent6:"accent6",Hlink:"hlink",FolHlink:"folHlink"},gl.Type={Scheme:"scheme",Named:"named",Index:"index",HSL:"hsl",RGB:"rgb",LRGB:"lrgb",Hex:"hex"};const Bg=[[4290032820,1,V.Named.ActiveBorder,!0],[4288263377,2,V.Named.ActiveCaption,!0],[4278190080,3,V.Named.CaptionText,!0],[4289440683,4,V.Named.AppWorkspace,!0],[4293980400,5,V.Named.BtnFace,!0],[4285098345,6,V.Named.BtnShadow,!0],[4278190080,7,V.Named.DkShadow3d,!0],[4293125091,8,V.Named.BtnHighlight,!0],[4293125091,9,V.Named.Light3d,!0],[4278190080,10,V.Named.BtnText,!0],[4278190080,11,V.Named.Background,!0],[4285361517,12,V.Named.GrayText,!0],[4281571839,13,V.Named.Highlight,!0],[4294967295,14,V.Named.HighlightText,!0],[4278216396,15,V.Named.HotLight,!0],[4294244348,16,V.Named.InactiveBorder,!0],[4290760155,17,V.Named.InactiveCaption,!0],[4278190080,18,V.Named.InactiveCaptionText,!0],[4294967265,19,V.Named.InfoBk,!0],[4278190080,20,V.Named.InfoText,!0],[4293980400,21,V.Named.Menu,!0],[4278190080,22,V.Named.MenuText,!0],[4291348680,23,V.Named.ScrollBar,!0],[4294967295,24,V.Named.Window,!0],[4284769380,25,V.Named.WindowFrame,!0],[4278190080,26,V.Named.WindowText,!0],[16777215,27,V.Named.Transparent],[4293982463,28,V.Named.AliceBlue],[4294634455,29,V.Named.AntiqueWhite],[4278255615,30,V.Named.Aqua],[4286578644,31,V.Named.Aquamarine],[4293984255,32,V.Named.Azure],[4294309340,33,V.Named.Beige],[4294960324,34,V.Named.Bisque],[4278190080,35,V.Named.Black],[4294962125,36,V.Named.BlanchedAlmond],[4278190335,37,V.Named.Blue],[4287245282,38,V.Named.BlueViolet],[4289014314,39,V.Named.Brown],[4292786311,40,V.Named.BurlyWood],[4284456608,41,V.Named.CadetBlue],[4286578432,42,V.Named.Chartreuse],[4291979550,43,V.Named.Chocolate],[4294934352,44,V.Named.Coral],[4284782061,45,V.Named.CornflowerBlue],[4294965468,46,V.Named.Cornsilk],[4292613180,47,V.Named.Crimson],[4278255615,48,V.Named.Cyan],[4278190219,49,V.Named.DkBlue],[4278225803,50,V.Named.DkCyan],[4290283019,51,V.Named.DkGoldenrod],[4289309097,52,V.Named.DkGray],[4278215680,53,V.Named.DkGreen],[4290623339,54,V.Named.DkKhaki],[4287299723,55,V.Named.DkMagenta],[4283788079,56,V.Named.DkOliveGreen],[4294937600,57,V.Named.DkOrange],[4288230092,58,V.Named.DkOrchid],[4287299584,59,V.Named.DkRed],[4293498490,60,V.Named.DkSalmon],[4287609995,61,V.Named.DkSeaGreen],[4282924427,62,V.Named.DkSlateBlue],[4281290575,63,V.Named.DkSlateGray],[4278243025,64,V.Named.DkTurquoise],[4287889619,65,V.Named.DkViolet],[4294907027,66,V.Named.DeepPink],[4278239231,67,V.Named.DeepSkyBlue],[4285098345,68,V.Named.DimGray],[4280193279,69,V.Named.DodgerBlue],[4289864226,70,V.Named.Firebrick],[4294966e3,71,V.Named.FloralWhite],[4280453922,72,V.Named.ForestGreen],[4294902015,73,V.Named.Fuchsia],[4292664540,74,V.Named.Gainsboro],[4294506751,75,V.Named.GhostWhite],[4294956800,76,V.Named.Gold],[4292519200,77,V.Named.Goldenrod],[4286611584,78,V.Named.Gray],[4278222848,79,V.Named.Green],[4289593135,80,V.Named.GreenYellow],[4293984240,81,V.Named.Honeydew],[4294928820,82,V.Named.HotPink],[4291648604,83,V.Named.IndianRed],[4283105410,84,V.Named.Indigo],[4294967280,85,V.Named.Ivory],[4293977740,86,V.Named.Khaki],[4293322490,87,V.Named.Lavender],[4294963445,88,V.Named.LavenderBlush],[4286381056,89,V.Named.LawnGreen],[4294965965,90,V.Named.LemonChiffon],[4289583334,91,V.Named.LtBlue],[4293951616,92,V.Named.LtCoral],[4292935679,93,V.Named.LtCyan],[4294638200,94,V.Named.LtGoldenrodYellow],[4292072403,95,V.Named.LtGray],[4287688336,96,V.Named.LtGreen],[4294948545,97,V.Named.LtPink],[4294942842,98,V.Named.LtSalmon],[4280332970,99,V.Named.LtSeaGreen],[4287090426,100,V.Named.LtSkyBlue],[4286023833,101,V.Named.LtSlateGray],[4289774814,102,V.Named.LtSteelBlue],[4294967264,103,V.Named.LtYellow],[4278255360,104,V.Named.Lime],[4281519410,105,V.Named.LimeGreen],[4294635750,106,V.Named.Linen],[4294902015,107,V.Named.Magenta],[4286578688,108,V.Named.Maroon],[4284927402,109,V.Named.MedAquamarine],[4278190285,110,V.Named.MedBlue],[4290401747,111,V.Named.MedOrchid],[4287852763,112,V.Named.MedPurple],[4282168177,113,V.Named.MedSeaGreen],[4286277870,114,V.Named.MedSlateBlue],[4278254234,115,V.Named.MedSpringGreen],[4282962380,116,V.Named.MedTurquoise],[4291237253,117,V.Named.MedVioletRed],[4279834992,118,V.Named.MidnightBlue],[4294311930,119,V.Named.MintCream],[4294960353,120,V.Named.MistyRose],[4294960309,121,V.Named.Moccasin],[4294958765,122,V.Named.NavajoWhite],[4278190208,123,V.Named.Navy],[4294833638,124,V.Named.OldLace],[4286611456,125,V.Named.Olive],[4285238819,126,V.Named.OliveDrab],[4294944e3,127,V.Named.Orange],[4294919424,128,V.Named.OrangeRed],[4292505814,129,V.Named.Orchid],[4293847210,130,V.Named.PaleGoldenrod],[4288215960,131,V.Named.PaleGreen],[4289720046,132,V.Named.PaleTurquoise],[4292571283,133,V.Named.PaleVioletRed],[4294963157,134,V.Named.PapayaWhip],[4294957753,135,V.Named.PeachPuff],[4291659071,136,V.Named.Peru],[4294951115,137,V.Named.Pink],[4292714717,138,V.Named.Plum],[4289781990,139,V.Named.PowderBlue],[4286578816,140,V.Named.Purple],[4294901760,141,V.Named.Red],[4290547599,142,V.Named.RosyBrown],[4282477025,143,V.Named.RoyalBlue],[4287317267,144,V.Named.SaddleBrown],[4294606962,145,V.Named.Salmon],[4294222944,146,V.Named.SandyBrown],[4281240407,147,V.Named.SeaGreen],[4294964718,148,V.Named.SeaShell],[4288696877,149,V.Named.Sienna],[4290822336,150,V.Named.Silver],[4287090411,151,V.Named.SkyBlue],[4285160141,152,V.Named.SlateBlue],[4285563024,153,V.Named.SlateGray],[4294966010,154,V.Named.Snow],[4278255487,155,V.Named.SpringGreen],[4282811060,156,V.Named.SteelBlue],[4291998860,157,V.Named.Tan],[4278222976,158,V.Named.Teal],[4292394968,159,V.Named.Thistle],[4294927175,160,V.Named.Tomato],[4282441936,161,V.Named.Turquoise],[4293821166,162,V.Named.Violet],[4294303411,163,V.Named.Wheat],[4294967295,164,V.Named.White],[4294309365,165,V.Named.WhiteSmoke],[4294967040,166,V.Named.Yellow],[4288335154,167,V.Named.YellowGreen],[4293980400,168,V.Named.ButtonFace],[4294967295,169,V.Named.ButtonHighlight],[4288716960,170,V.Named.ButtonShadow],[4290367978,171,V.Named.GradientActiveCaption],[4292338930,172,V.Named.GradientInactiveCaption],[4293980400,173,V.Named.MenuBar],[4281571839,174,V.Named.MenuHighlight]],o1=new class{constructor(){this._lookupByName=new Map;for(let s=0;s<Bg.length;s++){const e=Bg[s],t=e[0],n=(t>>24&255)/255,r=t>>16&255,o=t>>8&255,i=255&t,l={id:e[1],name:e[2],rgbaColor:{r,g:o,b:i,a:n},system:e.length>3};this._lookupByName.set(l.name.toLowerCase(),l)}}valueOfName(s){return this._lookupByName.get(s?s.toLowerCase():"transparent")}},Jc=[{scheme:V.Scheme.Tx1,description:"First Text Color"},{scheme:V.Scheme.Tx2,description:"Second Text Color"},{scheme:V.Scheme.Bg1,description:"First Background Color"},{scheme:V.Scheme.Bg2,description:"Second Background Color"},{scheme:V.Scheme.Accent1,description:"Accent 1"},{scheme:V.Scheme.Accent2,description:"Accent 2"},{scheme:V.Scheme.Accent3,description:"Accent 3"},{scheme:V.Scheme.Accent4,description:"Accent 4"},{scheme:V.Scheme.Accent5,description:"Accent 5"},{scheme:V.Scheme.Accent6,description:"Accent 6"},{scheme:V.Scheme.Hlink,description:"Hyperlink"},{scheme:V.Scheme.FolHlink,description:"Followed Hyperlink"},{scheme:"dk1",description:"Text/Background - Dark 1"},{scheme:"lt1",description:"Text/Background - Light 1"},{scheme:"dk2",description:"Text/Background - Dark 2"},{scheme:"lt2",description:"Text/Background - Light 2"}],B0=new Map;for(let s=0;s<Jc.length;s++)B0.set(Jc[s].scheme.toLowerCase(),Jc[s]);const zg=s=>s?{srgb:[s.red/255,s.green/255,s.blue/255],alpha:s.alpha!==void 0?s.alpha:1}:null,Pg=function(s,e,t,n){let r=zg((c=>{let u=o1.valueOfName(c);return u?new Fr.RGBA(u.rgbaColor.r,u.rgbaColor.g,u.rgbaColor.b,u.rgbaColor.a):null})(s)),o=null,i=null,l=null;if(r===null&&(a=s,B0.get(a.toLowerCase()))){if(!e)throw new Error("a scheme val was used but a schemeLookup was not provided");o=s,i=e(o),r=zg(i),l=V.Type.Scheme}var a;if(r===null){let c=s.match(oy)||s.match(sy);if(c){let u,d=1;c.length===4?u=[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]:(u=[parseInt(c[2],16),parseInt(c[3],16),parseInt(c[4],16)],d=ss(parseInt(c[1],16)/255)),u=Bc(u),u=_n(u),r={srgb:u,alpha:d},l=V.Type.Hex}}if(r===null){let c=s.match(Q_)||s.match(Y_);if(c){let u=Lc(c[1],c[2],c[3]);u=Bc(u),u=_n(u),r={srgb:u,alpha:c[4]?ss(parseFloat(c[4])):1},l=V.Type.RGB}}if(r===null){let c=s.match(ey)||s.match(ty);if(c){let u=Lc(c[1],c[2],c[3]);u=Bc(u,100),u=To(u),u=_n(u),r={srgb:u,alpha:c[4]?ss(parseFloat(c[4])):1},l=V.Type.LRGB}}if(r===null){let c=s.match(ny)||s.match(ry);if(c){let u=Lc(c[1],c[2],c[3]);u=ko(u),u=_n(u),r={srgb:u,alpha:c[4]?ss(parseFloat(c[4])):1},l=V.Type.HSL}}if(r===null){let c=s.match(iy);if(c){const u=parseInt(c[1]);let d=t?.(u)??xa(u);d&&(r={srgb:[d.red/255,d.green/255,d.blue/255],alpha:d.alpha},l=V.Type.Index)}}if(r===null)throw new Error("Not a valid color format: "+s);return{srgbAlpha:r,key:o,color:i,type:l}},od=new Map,z0=Object.keys(V.AdjustmentType),s1=z0.length;for(let s=0;s<s1;s++){const e=z0[s];od.set(V.AdjustmentType[e].toLowerCase(),V.AdjustmentType[e])}const Hg=new RegExp("\\s+\\s*(?![^()]*\\))|,\\s*(?![^()]*\\))"),$g=new RegExp("\\s*[,]\\s*|\\s+");let Kc=null;const Vg={[V.Scheme.Bg1]:"window",[V.Scheme.Bg2]:"E7E6E6",[V.Scheme.Tx1]:"windowText",[V.Scheme.Tx2]:"44546A",[V.Scheme.Accent1]:"4472C4",[V.Scheme.Accent2]:"ED7D31",[V.Scheme.Accent3]:"A5A5A5",[V.Scheme.Accent4]:"FFC000",[V.Scheme.Accent5]:"5B9BD5",[V.Scheme.Accent6]:"70AD47",[V.Scheme.Hlink]:"0563C1",[V.Scheme.FolHlink]:"954F72"};class Gt{constructor(e,t,n,r=null){let o=null,i=null;if(e instanceof Gt)o=e.getVal(),e.getAdjustments()&&(i=[...e.getAdjustments()]);else if(typeof e=="string"){const l=this._parse(e);o=l.val,i=l.adjs}else e?.val&&(o=e.val,i=e.adjs);if(!o)throw new Error("Unable to determine color value");this._private={val:o,adjs:i,schemeLookup:t,indexedLookup:n,parsedVal:Pg(o,t,n),adjusted:null,resolved:null}}_parse(e){let t=null,n=e.toLowerCase().trim();const r=n.split(Hg);if(r&&(t=r[0],n=n.substring(t.length,n.length).trim()),!t)throw new Error("no color key found");const o=[],i=n.split($g),l=i.length;for(let a=0;a<l;a++){const c=i[a];if(!c)continue;const u=od.get(c.toLowerCase());if(!u)throw new Error("Invalid adjustment type:"+c);let d=null;if(!(u===V.AdjustmentType.Gray||u===V.AdjustmentType.Comp||u===V.AdjustmentType.Inv||u===V.AdjustmentType.Gamma||u===V.AdjustmentType.InvGamma)){a++;const h=i[a];if(d=parseFloat(h),d==null)throw new Error(`Invalid adjustment value: missing value for'${c}'`);if(isNaN(d))throw new Error("Invalid adjustment value:"+h)}o.push({[u]:d})}return{val:t,adjs:o}}_forceDark(e=!0){this._resolve();const t=this._private.resolved;let n=[t.red,t.green,t.blue];n=((l,a)=>{a=(a%360+360)%360;const c=[1,0,0,0,1,0,0,0,1],u=Math.cos(a*Math.PI/180),d=Math.sin(a*Math.PI/180);c[0]=Go+.7874*u-Go*d,c[1]=jr-jr*u-jr*d,c[2]=Uo-Uo*u+.9278*d,c[3]=Go-Go*u+.143*d,c[4]=jr+(1-jr)*u+.14*d,c[5]=Uo-Uo*u-.283*d,c[6]=Go-Go*u-.7874*d,c[7]=jr-jr*u+jr*d,c[8]=Uo+.9278*u+Uo*d;const h=p=>Math.round(Math.max(0,Math.min(255,p))),f=l[0],g=l[1],m=l[2];return[h(c[0]*f+c[1]*g+c[2]*m),h(c[3]*f+c[4]*g+c[5]*m),h(c[6]*f+c[7]*g+c[8]*m)]})(n,180),n=ng(n,!1);let r=Eo(n);const o=io(r);if(o[$s]=.95*o[$s],r=ko(o),n=To(r),n=tg(n),n=_n(n,!1),e)return new Fr.RGBA(n[0],n[1],n[2],t.alpha);const i=io(Eo(n));return new Fr.HSLA(i[0],i[1],i[2],t.alpha)}_resolve(){if(this._private.resolved){if(!this._private.parsedVal.key)return;let o=this._private.schemeLookup(this._private.parsedVal.key);if(o===this._private.parsedVal.color||o?.isEqual(this._private.parsedVal.color))return}const e=Pg(this._private.val,this._private.schemeLookup,this._private.indexedLookup,this._private.last);let t=((o,i)=>{let l=[...o.srgb],a=o.alpha!==void 0?o.alpha:1;const c=i?i.length:0;for(var u=0;u<c;u++){const d=i[u],h=Object.keys(d)[0],f=d[h];h===V.AdjustmentType.Alpha?(a=f/100,a=Math.max(0,Math.min(1,a))):h===V.AdjustmentType.AlphaOff?(a+=f/100,a=Math.max(0,Math.min(1,a))):h===V.AdjustmentType.AlphaMod?(a*=f/100,a=Math.max(0,Math.min(1,a))):h===V.AdjustmentType.Hue?l=Hc(wn,l,f):h===V.AdjustmentType.Sat?l=Hc(Pc,l,f):h===V.AdjustmentType.Lum?l=Hc($s,l,f):h===V.AdjustmentType.HueOff?l=$c(wn,l,f):h===V.AdjustmentType.SatOff?l=$c(Pc,l,f):h===V.AdjustmentType.LumOff?l=$c($s,l,f):h===V.AdjustmentType.HueMod?l=Vc(wn,l,f):h===V.AdjustmentType.SatMod?l=Vc(Pc,l,f):h===V.AdjustmentType.LumMod?l=Vc($s,l,f):h===V.AdjustmentType.Red?l=br(ql,l,f,Xl):h===V.AdjustmentType.Green?l=br(Jl,l,f,Xl):h===V.AdjustmentType.Blue?l=br(Kl,l,f,Xl):h===V.AdjustmentType.RedOff?l=br(ql,l,f,Zl):h===V.AdjustmentType.GreenOff?l=br(Jl,l,f,Zl):h===V.AdjustmentType.BlueOff?l=br(Kl,l,f,Zl):h===V.AdjustmentType.RedMod?l=br(ql,l,f,Ql):h===V.AdjustmentType.GreenMod?l=br(Jl,l,f,Ql):h===V.AdjustmentType.BlueMod?l=br(Kl,l,f,Ql):h===V.AdjustmentType.Shade?l=ly(l,f):h===V.AdjustmentType.Tint?l=cy(l,f):h===V.AdjustmentType.ETint?l=ay(l,f):h===V.AdjustmentType.Gray?l=uy(l):h===V.AdjustmentType.Comp?l=dy(l):h===V.AdjustmentType.Inv?l=ng(l,f):h===V.AdjustmentType.Gamma?l=hy(l):h===V.AdjustmentType.InvGamma?l=gy(l):console.warn("unknown adjustmentType: "+h)}return{srgb:l,alpha:a}})(e.srgbAlpha,this._private.adjs),n=((o,i=255)=>{const l=[...o];for(var a=0;a<o.length;a++)l[a]=o[a]*i;return l})(t.srgb);n=tg(n);let r=ss(t.alpha);this._private.adjusted=t,this._private.parsedVal=e,this._private.resolved=new Fr.RGBA(n[0],n[1],n[2],r)}static parse(e,t,n,r=null){if(e instanceof Gt)return e;const o=e;let i=null,l=o?.trim(),a=null;try{if(!i){const h=l?.split(Hg);h&&(i=h[0],l=l.substring(i.length,l.length).trim())}if(!i)throw new Error("no color found");const c=[],u=l.split($g),d=u.length;for(let h=0;h<d;h++){const f=u[h];if(!f)continue;const g=od.get(f.toLowerCase());if(!g)throw new Error("Invalid adjustment type:"+f);let m=null;if(!(g===V.AdjustmentType.Gray||g===V.AdjustmentType.Comp||g===V.AdjustmentType.Inv||g===V.AdjustmentType.Gamma||g===V.AdjustmentType.InvGamma)){h++;const p=u[h];if(m=parseFloat(p),m==null)throw new Error(`Invalid adjustment value: missing value for'${f}'`);if(isNaN(m))throw new Error("Invalid adjustment value:"+p)}c.push({[g]:m})}a=new Gt({val:i,adjs:c},t,n,r)}catch(c){throw c}return a}static getDefaultSchemeLookup(){if(!Kc){const e=new Map,t=Object.keys(Vg),n=t.length;for(let r=0;r<n;r++){const o=t[r];e.set(o.toLowerCase(),Gt.parse(Vg[o],null))}Kc=r=>e.get(r.toLowerCase())?.toRGBA()}return Kc}isEqual(e){return e instanceof Gt&&this.toString().toLowerCase()===e.toString().toLowerCase()}getVal(){return this._private.val}getAdjustments(){return this._private.adjs}adjust(e){return new Gt({val:this._private.val,adjs:this._private.adjs?this._private.adjs.concat(e):e},this._private.schemeLookup,this._private.indexedLookup,this._private.last)}getType(){return this._resolve(),this._private.parsedVal.type??null}toCSS(e=!1,t=!1){const n=e?this._forceDark():this.toRGBA();return n.alpha===0?"none":n.toString(t)}toRGBA(e=!1){return this._resolve(),e?this._forceDark():this._private.resolved}toHSLA(e=!1){if(this._resolve(),e)return this._forceDark(!1);let t=io(this._private.adjusted.srgb);return new Fr.HSLA(t[0],t[1],t[2],ss(this._private.adjusted.alpha??1))}toHex(e=!1){this._resolve();const t=e?this._forceDark():this._private.resolved;return new Fr.HEX(t.red,t.green,t.blue,t.alpha??1)}toBlackOrWhite(e=!1,t=157){const n=this.toRGBA(e),r=.299*n.red+.587*n.green+.114*n.blue>t;return new Gt(r?"#000000":"#FFFFFF",this._private.schemeLookup,this._private.indexedLookup,this._private.last)}get[Symbol.toStringTag](){return this.toString()}toString(){let e=this._private.val;const t=this._private.adjs,n=t?t.length:0;for(let r=0;r<n;r++){const o=t[r];if(!o)continue;const i=Object.keys(o)[0];e+=" "+i;const l=o[i];typeof l=="number"&&(e+=" "+l),r<n-1&&(e+=",")}return e}get isIColor(){return!0}}var Ce,Wg;(Wg=Ce||(Ce={})).StrokeStyle={None:"none",DashDot:"dashDot",MediumDashDot:"mediumDashDot",Dotted:"dotted",Hair:"hair",Thin:"thin",Medium:"medium",Thick:"thick",MediumDashDotDot:"mediumDashDotDot",DashDotDot:"dashDotDot",Dashed:"dashed",MediumDashed:"mediumDashed",SlantDashDot:"slantDashDot",Double:"double"},Wg.Edge={Left:"left",Top:"top",Right:"right",Bottom:"bottom",Horizontal:"horizontal",Vertical:"vertical",DiagonalUp:"diagonalUp",DiagonalDown:"diagonalDown"};const P0=[],H0=new Map,jg=Object.freeze([[Ce.StrokeStyle.Thin,"Thin",1,null],[Ce.StrokeStyle.Hair,"Hair",1,[1,1]],[Ce.StrokeStyle.Dotted,"Dotted",1,[2,2]],[Ce.StrokeStyle.Dashed,"Dashed",1,[3,1]],[Ce.StrokeStyle.DashDot,"Dash Dot",1,[3,3,9,3]],[Ce.StrokeStyle.DashDotDot,"Dash Dot Dot",1,[3,3,3,3,9,3]],[Ce.StrokeStyle.Double,"Double",3,null],[Ce.StrokeStyle.Medium,"Medium",2,null],[Ce.StrokeStyle.MediumDashed,"Medium Dashed",2,[9,3]],[Ce.StrokeStyle.MediumDashDot,"Medium Dash Dot",2,[3,3,9,3]],[Ce.StrokeStyle.MediumDashDotDot,"Medium Dash Dot Dot",2,[3,3,3,3,9,3]],[Ce.StrokeStyle.SlantDashDot,"Slant Dash Dot",2,[5,1,11,1]],[Ce.StrokeStyle.Thick,"Thick",3,null],[Ce.StrokeStyle.None,"None",0,null]]);for(let s=0;s<jg.length;s++){const e=jg[s],t=e[0],n=Object.freeze({style:t,description:e[1],width:e[2],pattern:e[3]});P0.push(n),H0.set(t,n)}(s=>{s.isEqualStrokes=(e,t)=>!(e&&!t||t&&!e)&&(e===t||e.getStyle()===t.getStyle()&&e.getColor().isEqual(t.getColor())),s.oppositeEdge=e=>e===s.Edge.Left?s.Edge.Right:e===s.Edge.Right?s.Edge.Left:e===s.Edge.Top?s.Edge.Bottom:e===s.Edge.Bottom?s.Edge.Top:e,s.BuiltInDefinitionsArray=P0,s.BuiltInDefinitions=H0})(Ce||(Ce={}));const i1={Text:"text",Repeat:"repeat",Spacing:"spacing"},Gg=s=>!(!s.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/)&&!s.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/)),l1=Object.freeze({formatValue:Jd,isFractionFormat:Gg,adjustDecimalPlaces:(s,e)=>{if(!s)return"";const t=(i,l)=>{let a=i||"";const c=a.length===0||a.endsWith(".")?"0":a.charAt(a.length-1);return l<0?(a=a.substring(0,Math.max(0,a.length+l)),a==="."&&(a="")):(a.startsWith(".")||(a+="."),a+=c.repeat(l)),a},n=(i,l)=>{if(i==="General")return l>0?"0"+t("",l):i;if(Gg(i))return i;let a=i,c=-1,u=-1,d=a.indexOf("E");if(d>=0&&(a=a.substring(0,d)),c=a.indexOf("."),c>=0){a=a.substring(c,a.length);let h=a&&a.match(/([.]{1}[0,#]+)/);if(!h)return i;a=h[1],u=c+a.length}else{if(l<=0)return i;c=a.lastIndexOf("0"),c<0&&(c=a.lastIndexOf("#")),c>=0&&(c+=1),u=c,a=""}return c===-1?i:(a=t(a,l),i.substring(0,c)+a+i.substring(u,i.length))},r=[];let o=wy(s);for(let i=0;i<o.length;i++)r.push(n(o[i].trim(),e));return r.join(";")}}),a1=Zt._table,eh=s=>s===14?"Short Date":a1[s]??null,Vs=[{numberFormat:"General",formatType:st.General,primary:1},{numberFormat:"0",formatType:st.Number,regMatch:/^0[.]{0,1}[0]*$/,args:{decimalPlaces:0,separator:!1}},{numberFormat:"#,##0.00",formatType:st.Number,regMatch:/^#,##0[.]{0,1}[0]*$/,primary:2,args:{decimalPlaces:2,separator:!0}},{numberFormat:"#,##0_);(#,##0)",formatType:st.Number,args:{decimalPlaces:0,separator:!0}},{numberFormat:"#,##0_);[Red](#,##0)",formatType:st.Number,args:{decimalPlaces:0,separator:!0}},{numberFormat:"#,##0.00_);(#,##0.00)",formatType:st.Number,args:{decimalPlaces:2,separator:!0}},{numberFormat:"#,##0.00_);[Red](#,##0.00)",formatType:st.Number,args:{decimalPlaces:2,separator:!0}},{numberFormat:"$#,##0.00",formatType:st.Currency,primary:3,args:{decimalPlaces:2,currencySymbol:"$"}},{numberFormat:"$#,##0_);($#,##0)",formatType:st.Currency,args:{decimalPlaces:0,currencySymbol:"$"}},{numberFormat:"$#,##0_);[Red]($#,##0)",formatType:st.Currency,args:{decimalPlaces:0,currencySymbol:"$"}},{numberFormat:"$#,##0.00_);($#,##0.00)",formatType:st.Currency,args:{decimalPlaces:2,currencySymbol:"$"}},{numberFormat:"$#,##0.00_);[Red]($#,##0.00)",formatType:st.Currency,args:{decimalPlaces:2,currencySymbol:"$"}},{numberFormat:'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)',primary:4,formatType:st.Accounting},{numberFormat:'_($* #,##0_);_($* (#,##0);_($* "-"_);_(@_)',formatType:st.Accounting},{numberFormat:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',formatType:st.Accounting},{numberFormat:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',formatType:st.Accounting},{numberFormat:"Short Date",formatType:st.ShortDate,primary:5},{numberFormat:"d-mmm-yy",formatType:st.MediumDate,primary:5.5},{numberFormat:"Long Date",formatType:st.LongDate,primary:6},{numberFormat:"h:mm",formatType:st.ShortTime,primary:7},{numberFormat:"h:mm AM/PM",formatType:st.MediumTime,primary:7.5},{numberFormat:"Long Time",formatType:st.LongTime,primary:8},{numberFormat:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',formatType:st.Comma,primary:9},{numberFormat:"0.00%",formatType:st.Percentage,primary:10,args:{decimalPlaces:2},regMatch:/^^[0#?]*[.]{0,1}[0#?]*%*$/},{numberFormat:"0%",formatType:st.Percentage,args:{decimalPlaces:0}},{numberFormat:"# ?/?",formatType:st.Fraction,primary:11},{numberFormat:"# ??/??",formatType:st.Fraction},{numberFormat:"0.00E+00",formatType:st.Scientific,primary:12,args:{decimalPlaces:2},regMatch:/^[0#?]*[.]{0,1}[0#?]*E\+[0#?]*$/},{numberFormat:"##0.0E+0",formatType:st.Custom,args:{decimalPlaces:0}},{numberFormat:"@",formatType:st.Text,primary:13},{numberFormat:"d-mmm",formatType:st.Custom},{numberFormat:"mmm-yy",formatType:st.Custom},{numberFormat:"h:mm:ss",formatType:st.Custom},{numberFormat:"m/d/yyyy h:mm",formatType:st.Custom},{numberFormat:"mm:ss",formatType:st.Custom},{numberFormat:"mm:ss.0",formatType:st.Custom},{numberFormat:"[h]:mm:ss",formatType:st.Custom}],Xc=[{numberFormat:"00000",formatType:st.Special,primary:11},{numberFormat:"00000-0000",formatType:st.Special},{numberFormat:"[<=9999999]###-####;(###) ###-####",formatType:st.Special},{numberFormat:"000-00-0000",formatType:st.Special}],Wi=new Map,di=[];for(let s=0;s<Vs.length;s++){let e=Vs[s].numberFormat.toLowerCase();Wi.set(e,Vs[s]),Vs[s].regMatch&&di.unshift(Vs[s])}for(let s=0;s<Xc.length;s++){let e=Xc[s].numberFormat.toLowerCase();Wi.set(e,Xc[s])}const sd=[],$0=new Map;Wi.forEach(function(s,e,t){s.primary&&(sd.push(s),$0.set(P.textToKey(s.formatType),s.numberFormat))}),sd.sort(function(s,e){return s.primary-e.primary});const Ug=Wi.get(st.General.toLowerCase());class c1{lookupStyle(e){if(!e)return Ug;if(typeof e=="number"&&(e=eh(e)),!e.toLowerCase)return console.warn("Invalid numberFormat",e),Ug;e=e.toLowerCase();let t=Wi.get(e);if(t)return t;for(let n=0;!t&&n<di.length;n++)di[n].regMatch&&e.match(di[n].regMatch)&&(t=di[n]);return t||{numberFormat:e,formatType:st.Custom}}lookupPrimary(){return sd}lookupDefault(e){return $0.get(P.textToKey(e))}}var Ut,fl,Qe,qg;(fl=Ut||(Ut={})).Type=st,fl.Parser=l1,fl.Styles=new c1,fl.ParseRunType=i1,(qg=Qe||(Qe={})).BuiltInName={Normal:"Normal",RowLevel:"RowLevel_#",ColLevel:"ColLevel_#",Comma:"Comma",Currency:"Currency",Percent:"Percent",Comma0:"Comma [0]",Currency0:"Currency [0]",Hyperlink:"Hyperlink",FollowedHyperlink:"Followed Hyperlink",Note:"Note",WarningText:"Warning Text",Unknown12:"??-12",Unknown13:"??-13",Unknown14:"??-14",Title:"Title",Heading1:"Heading 1",Heading2:"Heading 2",Heading3:"Heading 3",Heading4:"Heading 4",Input:"Input",Output:"Output",Calculation:"Calculation",CheckCell:"Check Cell",LinkedCell:"Linked Cell",Total:"Total",Good:"Good",Bad:"Bad",Neutral:"Neutral",Accent1:"Accent1",Accent1_20:"20% - Accent1",Accent1_40:"40% - Accent1",Accent1_60:"60% - Accent1",Accent2:"Accent2",Accent2_20:"20% - Accent2",Accent2_40:"40% - Accent2",Accent2_60:"60% - Accent2",Accent3:"Accent3",Accent3_20:"20% - Accent3",Accent3_40:"40% - Accent3",Accent3_60:"60% - Accent3",Accent4:"Accent4",Accent4_20:"20% - Accent4",Accent4_40:"40% - Accent4",Accent4_60:"60% - Accent4",Accent5:"Accent5",Accent5_20:"20% - Accent5",Accent5_40:"40% - Accent5",Accent5_60:"60% - Accent5",Accent6:"Accent6",Accent6_20:"20% - Accent6",Accent6_40:"40% - Accent6",Accent6_60:"60% - Accent6",ExplanatoryText:"Explanatory Text"},qg.IconSet={Arrows3:"3Arrows",ArrowsGray3:"3ArrowsGray",Flags3:"3Flags",Signs3:"3Signs",Symbols3:"3Symbols",Symbols3_2:"3Symbols2",TrafficLights3:"3TrafficLights1",TrafficLights3_2:"3TrafficLights2",Arrows4:"4Arrows",ArrowsGray4:"4ArrowsGray",Rating4:"4Rating",RedToBlack4:"4RedToBlack",TrafficLights4:"4TrafficLights",Arrows5:"5Arrows",ArrowsGray5:"5ArrowsGray",Quarters5:"5Quarters",Rating5:"5Rating"};const u1=(s,e,t,n,r)=>{const o=JSON.parse(JSON.stringify(s.definition));o.adjs||(o.adjs=[]);let i="",l=0,a=0;e>0?(a=e,l=100-e,i=`Lighter ${e}%`):e<0&&(l=100+e,i=`Darker ${-e}%`),l&&o.adjs.push({[V.AdjustmentType.LumMod]:l}),a&&o.adjs.push({[V.AdjustmentType.LumOff]:a});const c=new Gt({val:o.val,adjs:o.adjs},t),u=c.toString();n?.set(u,c);const d=c.toRGBA().toString();return r?.set(d,c),{description:s.description+", "+i,definition:o}},d1=(s,e,t,n)=>{let r=[];for(let o=0;o<s.length;o++){let i=[];r.push(i);const l=c=>{for(let u=0;u<c.length;u++)i.push(u1(s[o],c[u],e,t,n))};let a=new Gt({val:s[o].definition.val,adjs:s[o].definition.adjs},e).toHSLA().lum;l(a===0?[50,35,25,15,5]:a===100?[-5,-15,-25,-35,-50]:a<=20?[90,75,50,25,10]:a>=80?[-10,-25,-50,-75,-90]:[80,60,40,-25,-50])}return r};var Jg,yo;(Jg||(Jg={})).buildPalette=d1,(yo||(yo={})).BuiltInFilterType={BuiltIn:"builtIn",All:"all",Custom:"custom"};const h1=[["Office","windowText","window","0E2841","E8E8E8","156082","E97132","196B24","0F9ED5","A02B93","4EA72E","467886","96607D"],["Office 2013-2022","windowText","window","44546A","E7E6E6","4472C4","ED7D31","A5A5A5","FFC000","5B9BD5","70AD47","0563C1","954F72"],["Office 2007-2010","windowText","window","1F497D","EEECE1","4F81BD","C0504D","9BBB59","8064A2","4BACC6","F79646","0000FF","800080"],["Grayscale","windowText","window","000000","F8F8F8","DDDDDD","B2B2B2","969696","808080","5F5F5F","4D4D4D","5F5F5F","919191"],["Atlas","windowText","window","454545","E0E0E0","F81B02","FC7715","AFBF41","50C49F","3B95C4","B560D4","FC5A1A","B49E74"],["Banded","2C2C2C","FFFFFF","099BDD","F2F2F2","FFC000","A5D028","08CC78","F24099","828288","F56617","005DBA","6C606A"],["Basis","000000","FFFFFF","565349","DDDDDD","A6B727","DF5327","FE9E00","418AB3","D7D447","818183","F59E00","B2B2B2"],["Berlin","windowText","window","9D360E","E7E6E6","F09415","C1B56B","4BAF73","5AA6C0","D17DF9","FA7E5C","FFAE3E","FCC77E"],["Celestial","windowText","window","18276C","EBEBEB","AC3EC1","477BD1","46B298","90BA4C","DD9D31","E25247","C573D2","CCAEE8"],["Circuit","windowText","window","134770","82FFFF","9ACD4C","FAA93A","D35940","B258D3","63A0CC","8AC4A7","B8FA56","7AF8CC"],["Damask","windowText","window","2A5B7F","ABDAFC","9EC544","50BEA3","4A9CCC","9A66CA","C54F71","DE9C3C","6BA9DA","A0BCD3"],["Depth","windowText","window","455F51","94D7E4","41AEBD","97E9D5","A2CF49","608F3D","F4DE3A","FCB11C","FBCA98","D3B86D"],["Dividend","windowText","window","3D3D3D","EBEBEB","4D1434","903163","B2324B","969FA7","66B1CE","40619D","828282","A5A5A5"],["Droplet","windowText","window","355071","AABED7","2FA3EE","4BCAAD","86C157","D99C3F","CE6633","A35DD1","56BCFE","97C5E3"],["Facet","windowText","window","2C3C43","EBEBEB","90C226","54A021","E6B91E","E76618","C42F1A","918655","99CA3C","B9D181"],["Frame","000000","FFFFFF","545454","BFBFBF","40BAD2","FAB900","90BB23","EE7008","1AB39F","D5393D","90BB23","EE7008"],["Gallery","windowText","window","454545","DFDBD5","B71E42","DE478E","BC72F0","795FAF","586EA6","6892A0","FA2B5C","BC658E"],["Integral","windowText","window","335B74","DFE3E5","1CADE4","2683C6","27CED7","42BA97","3E8853","62A39F","6B9F25","B26B02"],["Ion Boardroom","windowText","window","3B3059","EBEBEB","B31166","E33D6F","E45F3C","E9943A","9B6BF2","D53DD0","8F8F8F","A5A5A5"],["Ion","windowText","window","1E5155","EBEBEB","B01513","EA6312","E6B729","6AAC90","54849A","9E5E9B","58C1BA","9DFFCB"],["Madison","windowText","window","1F2D29","C5FAEB","A1D68B","5EC795","4DADCF","CDB756","E29C36","8EC0C1","6D9D9B","6D8583"],["Main Event","windowText","window","424242","C8C8C8","B80E0F","A6987D","7F9A71","64969F","9B75B2","80737A","F21213","B6A394"],["Mesh","windowText","window","363D46","EBEBEB","6F6F6F","BFBFA5","DCD084","E7BF5F","E9A039","CF7133","F28943","F1B76C"],["Metropolitan","windowText","window","162F33","EAF0E0","50B4C8","A8B97F","9B9256","657689","7A855D","84AC9D","2370CD","877589"],["Organic","windowText","window","212121","DADADA","83992A","3C9770","44709D","A23C33","D97828","DEB340","A8BF4D","B4CA80"],["Parallax","windowText","window","212121","CDD0D1","30ACEC","80C34F","E29D3E","D64A3B","D64787","A666E1","3085ED","82B6F4"],["Parcel","000000","FFFFFF","4A5356","E8E3CE","F6A21D","9BAFB5","C96731","9CA383","87795D","A0988C","00B0F0","738F97"],["Quotable","windowText","window","212121","636363","00C6BB","6FEBA0","B6DF5E","EFB251","EF755F","ED515C","8F8F8F","A5A5A5"],["Retrospect","000000","window","637052","CCDDEA","E48312","BD582C","865640","9B8357","C2BC80","94A088","2998E3","8C8C8C"],["Savon","windowText","window","1485A4","E3DED1","1CADE4","2683C6","27CED7","42BA97","3E8853","62A39F","F49100","739D9B"],["Slate","windowText","window","212123","DADADA","BC451B","D3BA68","BB8640","AD9277","A55A43","AD9D7B","E98052","F4B69B"],["Slice","windowText","window","146194","76DBF4","052F61","A50E82","14967C","6A9E1F","E87D37","C62324","0D2E46","356A95"],["Vapor Trail","windowText","window","454545","DADADA","DF2E28","FE801A","E9BF35","81BB42","32C7A9","4A9BDC","F0532B","F38B53"],["View","000000","FFFFFF","46464A","D6D3CC","6F6F74","92A9B9","A7B789","B9A489","8D6374","9B7362","67AABF","ABAFA5"],["Wisp","windowText","window","766F54","E3EACF","A53010","DE7E18","9F8351","728653","92AA4C","6AAC91","FB4A18","FB9318"],["Wood Type","windowText","window","696464","E9E5DC","D34817","9B2D1F","A28E6A","956251","918485","855D5D","CC9900","96A9A9"]],g1=[["Office","Calibri Light","Calibri"],["Office 2013-2022","Calibri Light","Calibri"],["Office 2007-2010","Calibri Light","Calibri"],["Grayscale","Calibri Light","Calibri"],["Atlas","Calibri Light","Rockwell"],["Banded","Corbel","Corbel"],["Basis","Corbel","Corbel"],["Berlin","Trebuchet MS","Trebuchet MS"],["Celestial","Calibri Light","Calibri"],["Circuit","Tw Cen MT","Tw Cen MT"],["Damask","Bookman Old Style","Rockwell"],["Depth","Corbel","Corbel"],["Madison","Arial","Arial"],["Main Event","Impact","Impact"],["Mesh","Century Gothic","Century Gothic"],["Metropolitan","Calibri Light","Calibri Light"],["Organic","Garamond","Garamond"],["Parallax","Corbel","Corbel"],["Parcel","Gill Sans MT","Gill Sans MT"],["Quotable","Century Gothic","Century Gothic"],["Retrospect","Calibri Light","Calibri"],["Savon","Century Gothic","Century Gothic"],["Slate","Calisto MT","Calisto MT"],["Slice","Century Gothic","Century Gothic"],["Vapor Trail","Century Gothic","Century Gothic"],["View","Century Schoolbook","Century Schoolbook"],["Wisp","Century Gothic","Century Gothic"],["Wood Type","Rockwell Condensed","Rockwell"]],f1=[["Office","Office","Office"],["2013-2022","Office 2013-2022","Office 2013-2022"],["Atlas","Atlas","Atlas"],["Banded","Banded","Banded"],["Basis","Basis","Basis"],["Berlin","Berlin","Berlin"],["Celestial","Celestial","Celestial"],["Circuit","Circuit","Circuit"],["Damask","Damask","Damask"],["Depth","Depth","Depth"],["Dividend","Dividend","Dividend"],["Droplet","Droplet","Droplet"],["Facet","Facet","Facet"],["Frame","Frame","Frame"],["Gallery","Gallery","Gallery"],["Grayscale","Grayscale","Grayscale"],["Integral","Integral","Integral"],["Ion Boardroom","Ion Boardroom","Ion Boardroom"],["Ion","Ion","Ion"],["Madison","Madison","Madison"],["Main Event","Main Event","Main Event"],["Mesh","Mesh","Mesh"],["Metropolitan","Metropolitan","Metropolitan"],["Organic","Organic","Organic"],["Parallax","Parallax","Parallax"],["Parcel","Parcel","Parcel"],["Quotable","Quotable","Quotable"],["Retrospect","Retrospect","Retrospect"],["Savon","Savon","Savon"],["Slate","Slate","Slate"],["Slice","Slice","Slice"],["Vapor Trail","Vapor Trail","Vapor Trail"],["View","View","View"],["Wisp","Wisp","Wisp"],["Wood Type","Wood Type","Wood Type"],["Office 2007-2010","Office 2007-2010","Office 2007-2010"]],Zc="Themes is readonly. To make modifications create a new DocsThemes instance.",Kg={[V.Scheme.Bg1]:"lt1",[V.Scheme.Bg2]:"lt2",[V.Scheme.Tx1]:"dk1",[V.Scheme.Tx2]:"dk2",[V.Scheme.Accent1]:"accent1",[V.Scheme.Accent2]:"accent2",[V.Scheme.Accent3]:"accent3",[V.Scheme.Accent4]:"accent4",[V.Scheme.Accent5]:"accent5",[V.Scheme.Accent6]:"accent6",[V.Scheme.Hlink]:"hlink",[V.Scheme.FolHlink]:"folHlink"},ys="Office",id=[ys,"Calibri Light","Calibri"],bs=["dk1","lt1","dk2","lt2","accent1","accent2","accent3","accent4","accent5","accent6","hlink","folHlink"],V0=s=>{const e={};for(let t=0;t<s.length;t++){const n=s[t],r=n[0],o={name:r};e[r]=o;for(let i=0;i<bs.length;i++){const l=bs[i],a=n[i+1];if(!a)continue;const c=Gt.parse(a);a&&(o[l]=c.toString())}}return e},W0=s=>{const e={};for(let t=0;t<s.length;t++){const n=s[t],r=n[0],o={name:r};e[r]=o,o.majorFont=n[1]??id[1],o.minorFont=n[2]??id[2]}return e},m1=V0([[ys,"windowText","window","44546A","E7E6E6","4472C4","ED7D31","A5A5A5","FFC000","5B9BD5","70AD47","0563C1","954F72"]]),p1=W0([id]),Ni=m1[ys],ts=p1[ys];let pr=null;const S1=new class{constructor(){this._colors={};for(let s=0;s<bs.length;s++){const e=bs[s],t=Gt.parse(Ni[e]);this._colors[e]=t}}getName(){return Ni.name}getDk1(){return this._colors.dk1}getLt1(){return this._colors.lt1}getDk2(){return this._colors.dk2}getLt2(){return this._colors.lt2}getAccent1(){return this._colors.accent1}getAccent2(){return this._colors.accent2}getAccent3(){return this._colors.accent3}getAccent4(){return this._colors.accent4}getAccent5(){return this._colors.accent5}getAccent6(){return this._colors.accent6}getHlink(){return this._colors.hlink}getFolHlink(){return this._colors.folHlink}toJSON(){return null}};class w1{constructor(e,t=S1){this._delegate=t,this._fromJSON(e)}_fromJSON(e){if(this._overrides={},!e)return;const t=Object.keys(e);if(t.length!==0)for(let n=0;n<t.length;n++){const r=t[n];this._overrides[r]=r==="name"?e[r]:Gt.parse(e[r])}}_value(e,t){return this._overrides&&this._overrides[e]!==null&&this._overrides[e]!==void 0?this._overrides[e]:this._delegate?.[t]?.()}getName(){return this._value("name","getName")}getDk1(){return this._value("dk1","getDk1")}getLt1(){return this._value("lt1","getLt1")}getDk2(){return this._value("dk2","getDk2")}getLt2(){return this._value("lt2","getLt2")}getAccent1(){return this._value("accent1","getAccent1")}getAccent2(){return this._value("accent2","getAccent2")}getAccent3(){return this._value("accent3","getAccent3")}getAccent4(){return this._value("accent4","getAccent4")}getAccent5(){return this._value("accent5","getAccent5")}getAccent6(){return this._value("accent6","getAccent6")}getHlink(){return this._value("hlink","getHlink")}getFolHlink(){return this._value("folHlink","getFolHlink")}toJSON(){const e=P.toSafeJSON(this._overrides),t=this.getName();return t&&(e.name=t),e}}const _1=new class{constructor(){this._colors={};for(let s=0;s<bs.length;s++){const e=bs[s],t=Gt.parse(Ni[e]);this._colors[e]=t}}getName(){return ts.name}getMajorFont(){return ts.majorFont}getMinorFont(){return ts.minorFont}getMajorFallbacks(){return ts.majorFallbacks}getMinorFallbacks(){return ts.minorFallbacks}};class y1{constructor(e,t=_1){this._delegate=t,this._fromJSON(e)}_fromJSON(e){if(this._overrides={},!e)return;const t=Object.keys(e);if(t.length!==0)for(let n=0;n<t.length;n++){const r=t[n];this._overrides[r]=e[r]}}_value(e,t){return this._overrides&&this._overrides[e]!==null&&this._overrides[e]!==void 0?this._overrides[e]:this._delegate?.[t]?.()}getName(){return this._value("name","getName")}getMajorFont(){return this._value("majorFont","getMajorFont")}getMinorFont(){return this._value("minorFont","getMinorFont")}getMajorFallbacks(){return this._value("majorFallbacks","getMajorFallbacks")}getMinorFallbacks(){return this._value("minorFallbacks","getMinorFallbacks")}toJSON(){const e=P.toSafeJSON(this._overrides),t=this.getName();return t&&(e.name=t),e}}let ld=class{constructor(e,t=null,n=null){if(this._cacheColors=new Map,!t&&e?.name){const a=pr?pr.get(e.name.toLowerCase()):null;a&&(t=a)}if(!t&&pr&&(t=pr.get(ys.toLowerCase())),this._name=e?.name??t?.getName(),!this._name)throw new Error("Theme must have a name.");this._builtInID=n,this._delegate=t,this._colors=new w1(e?.colors,this._delegate?.getColorScheme()),this._fonts=new y1(e?.fonts,this._delegate?.getFontScheme());const r=Kg,o={},i=Object.keys(r);for(let a=0;a<i.length;a++){const c=i[a];o[c]=`get${_s(r[c])}`}o.dk1="getDk1",o.dk2="getDk2",o.lt1="getLt1",o.lt2="getLt2",o.folhlink="getFolHlink",this._colorMap=o;const l=this;this._schemeLookup=a=>{let c=l._cacheColors[a];if(c)return c;const u=l._colorMap[a];if(!u)throw new Error(`Invalid color scheme key: ${a}`);const d=l.getColorScheme();let h=d[u].bind(d)();return h||(h=Ni[Kg[a]??a]),c=new Gt(h).toRGBA(),l._cacheColors[a]=c,c}}get builtInID(){return this._builtInID??null}getName(){return this._name??this._delegate?.getName()??null}isCustom(){return this._builtInID!==null&&this._builtInID!==void 0}getColorScheme(){return this._colors}getFontScheme(){return this._fonts}schemeLookup(){return this._schemeLookup}parseColor(e){return Gt.parse(e,this._schemeLookup)}toJSON(){const e={name:this.getName()},t=this._colors.toJSON();t&&(Object.keys(t).length>1||t.name&&t.name!==e.name)&&(e.colors=t);const n=this._fonts.toJSON();return n&&(Object.keys(n).length>1||n.name&&n.name!==e.name)&&(e.fonts=n),Object.keys(e).length===1&&e.name===ys?null:e}};const b1=()=>{if(pr)return pr;const s=((t,n,r)=>{const o=[];for(let i=0;i<t.length;i++){const l=t[i],a=l[0],c=n[l[1]]??Ni,u=r[l[2]]??ts;o.push({name:a,colors:c,fonts:u})}return o})(f1,V0(h1),W0(g1)),e=new Map;for(let t=0;t<s.length;t++){const n=new ld(s[t]),r=new ld(null,n,t+1);e.set(r.getName().toLowerCase(),r)}return pr=e,e};class th{constructor(e=null,t=!1){b1(),this._isReadOnly=t,this._customMap=new Map,this._defaultTheme=this.getByName("Office")}getDefaultTheme(){return this._defaultTheme}setDefaultTheme(e){if(this._isReadOnly)throw new Error(Zc);if(!e)throw new Error("Theme cannot be null.");const t=this.getDefaultTheme();return this.getByName(e.getName())||this.setCustomTheme(e),this._defaultTheme=e,t}getByName(e){return e=e.toLowerCase(),this._customMap.get(e)||(pr.get(e)??null)}getItems(e){const t=e?.type??yo.BuiltInFilterType.All,n=new Map;return t!==yo.BuiltInFilterType.BuiltIn&&t!==yo.BuiltInFilterType.All||pr.forEach((r,o)=>n.set(o,r)),t!==yo.BuiltInFilterType.Custom&&t!==yo.BuiltInFilterType.All||this._customMap.forEach((r,o)=>n.set(o,r)),e?.selected&&n.set(e.selected.getName().toLowerCase(),e.selected),(r=>{const o=[...r];return o.sort((i,l)=>P.isDefined(i.builtInID)&&!P.isDefined(l.builtInID)?1:!P.isDefined(i.builtInID)&&P.isDefined(l.builtInID)?-1:P.isDefined(i.builtInID)&&P.isDefined(l.builtInID)?i.builtInID-l.builtInID:i.getName().localeCompare(l.getName())),o})(Array.from(n.values()))}getCount(){return this._customMap.size+pr.size}setCustomTheme(e){if(this._isReadOnly)throw new Error(Zc);const t=e.getName().toLowerCase(),n=this._customMap.get(t);return this._customMap.set(t,e),n??null}deleteCustomTheme(e){if(this._isReadOnly)throw new Error(Zc);let t=null;t=typeof e=="string"?e.toLowerCase():e.getName().toLowerCase();const n=this._customMap.get(t);return this._customMap.delete(t),n??null}}var bo,Xt;(bo||(bo={})).ElementType={WholeTable:"wholeTable",FirstColumnStripe:"firstColumnStripe",SecondColumnStripe:"secondColumnStripe",FirstRowStripe:"firstRowStripe",SecondRowStripe:"secondRowStripe",LastColumn:"lastColumn",FirstColumn:"firstColumn",HeaderRow:"headerRow",TotalRow:"totalRow",FirstHeaderCell:"firstHeaderCell",LastHeaderCell:"lastHeaderCell",FirstTotalCell:"firstTotalCell",LastTotalCell:"lastTotalCell"},(bo||(bo={})).Empty=class{constructor(s){this._normalStyle=s}getName(){return"None"}isShownInTableStyles(){return!1}isShownInPivotStyles(){return!1}getRanged(s){return null}getProperties(){return P.EmptyObject}isBuiltIn(){return!0}delete(){}toJSON(){return null}get isITableStyle(){return!0}},(Xt||(Xt={})).Type={Absolute:"absolute",OneCell:"oneCell",TwoCell:"twoCell"};const Xn="Model has been closed. No further operations are allowed.",Xg="Name is required";class gn{constructor(e,t){this._listeners=new Set,this._pending=null,this._listeners=new Set,this._transactions=t??new Hn({transient:!0}),this._src=e;const n=this;this._transactionsRemoveListener=this._transactions?.addListener({onCommitEnd(r){const o=n._pending;if(!o)return;n._pending=null;const i=r.getId(),l=new Set,a=o.length;for(let c=0;c<a;c++){const u=o[c];u.commitId===i&&n._doNotify(u.listeners,u.removes,u.options,l)}}})}addListeners(e,t){const n=t?.transactional??this._transactions.isOpenTransaction(),r={listeners:e},o=this,i=()=>{if(!n)return void o._listeners.delete(r);const l=o._transactions.getState(o)?.listeners,a=new Set(l);a.delete(r);const c=o._transactions.beginCommit();try{c.updateState(o,{listeners:a}),c.commit({forceAmend:!0})}catch(u){throw c.rollback(),u}};if(r.remove=t?.once?i:null,n){const l=o._transactions.getState(o)?.listeners,a=new Set(l);a.add(r);const c=this._transactions.beginCommit();try{c.updateState(o,{listeners:a}),c.commit({forceAmend:!0})}catch(u){throw c.rollback(),u}}else o._listeners.add(r);return i}async _doNotify(e,t=null,n,r){const o=n?.source??this._src,i=[],l=n?.params,a=e.length;for(let u=0;u<a;u++){const d=e[u];r&&r.has(d)||(r?.add(d),i.push(d(o,l)))}let c=null;if(t&&(c=()=>{const u=t.length;for(let d=0;d<u;d++)t[d]()}),n?.async)return new Promise(async(u,d)=>{try{const h=await Promise.all(i);c?.(),u(h)}catch(h){c?.(),d(h)}});c?.()}notify(e,t){let n=null,r=null;const o=d=>{d.forEach(h=>{const f=h.listeners[e];f&&(n||(n=[]),n.push(f),h.remove&&(r||(r=[]),r.push(h.remove)))})},i=t?.transactional??this._transactions.isOpenTransaction();if(i){const d=this._transactions.getState(this)?.listeners;d&&o(d)}const l=n,a=r;n=null,r=null,o(this._listeners);const c=n,u=r;if(n=null,r=null,i){if(l&&this._doNotify(l,a,t),c){let d=this._pending;return d||(this._pending=d=[]),d.push({commitId:this._transactions.getCurrentCommit().getId(),listeners:c,removes:u,options:t}),this._doNotify(c,a,t)}}else if(c)return this._doNotify(c,u,t)}close(){this._transactions.remove(this),this._transactionsRemoveListener()}}let Fo=class{constructor(e){this._emitter=null,this._closed=!1,this._options={...e};const t=this;this._transactions=this._options?.transactions??new Hn({transient:!0}),this._emitter=new gn(this,this._transactions),this._updateState({isDeleted:!1}),e?.json&&this._fromJSON(e.json),this._options?.setContainerReadOnlyCallback?.(()=>{t._processOnContainerReadOnly()}),this._transactionsRemoveListener=this._transactions.addStateListener(this,{onAfterStateChange(n,r,o){t._processStateChange(n,r,o)},onRestoreOrRevert(n,r,o){t._processRestoreOrRevert(n,r,o)}}),this._processInit()}_fromJSON(e){}isReadOnly(){return this._options.isReadOnly?.()??!1}isDeleted(){return this._getState().isDeleted??!1}getType(){return this._options.type}get isIModel(){return!0}_processTransactionDone(e){}_getDescription(){return null}_getState(){if(this._closed)throw new Error(Xn);return this._transactions.getState(this)}_beginCommit(e){return this._transactions.beginCommit(typeof e=="string"?{description:e}:e)}_getTransactions(){return this._transactions}_updateState(e,t,n){if(this._closed)throw new Error(Xn);if(!e)return;const r=this._beginCommit(t?.description);try{r.updateState(this,e);let o=!1;if(n)for(let i=0;i<n.length;i++){const l=n[i];o=o||l==="onAnyChange",this._emitter.notify(l)}!o&&n&&n.length>0&&this._emitter.notify("onAnyChange"),r.commit()}catch(o){throw r.rollback(),o}return this}_getEmitter(){return this._emitter}_processInit(){}_processStateChange(e,t,n){}_processRestoreOrRevert(e,t,n){this._emitter.notify("onInvalidated")}delete(e){if(this._getState().isDeleted)throw new Error("Model has been deleted.");this._options.deleteFromContainer&&this._options.deleteFromContainer?.(e),this._delete()}_delete(){const e=this._getDescription(),t="Delete",n=e?`${t} ${e}`:t,r=this._beginCommit(n);try{this._processDelete(),r.commit()}catch(o){throw r.rollback(),o}}_processOnContainerDeleted(){this._processDelete()}_processDelete(){this._updateState({isDeleted:!0},null,["onDelete"])}_processOnContainerReadOnly(){this._emitter.notify("onReadOnlyChange")}addListeners(e,t){return this._emitter.addListeners(e,t)}beginCommit(e){return this._beginCommit(e)}doBatch(e,t){const n=this;return this._transactions.doBatch(e,typeof t=="string"?{description:t}:t,r=>{n._processTransactionDone(r)})}isClosed(){return this._closed}close(){this._closed||(this._emitter.notify("onClose"),this._closed=!0,this._transactionsRemoveListener?.())}};class j0 extends Fo{_fromJSON(e){const t={};if(t.name=e?.name??null,!t.name)throw new Error(Xg);t.comment=e?.comment??null,t.hidden=e?.hidden??!1,t.scope=e?.scope??null,this._updateState(t,{description:this._options.createDescription??"Create Item"+(t.name?` '${t.name}'`:"")})}_toJSON(){const e=this._getState(),t={name:e.name};return e.comment&&(t.comment=e.comment),e.hidden&&(t.hidden=e.hidden),e.hidden&&(t.hidden=e.hidden),t}getName(){return this._getState().name}setName(e,t){if(!e)throw new Error(Xg);return this._updateState({name:e},{description:`Update Named '${e}'`,...t})}getComment(){return this._getState().comment}setComment(e,t){return this._updateState({comment:e},{description:"Set Comment",...t})}isHidden(){return this._getState().hidden}getScope(){return this._getState().scope}get isINamed(){return!0}}var Zg,hs,Tn;(Zg||(Zg={})).SortOn={Value:"value",FillColor:"fillColor",FontColor:"fontColor",Icon:"icon"},(Tn=hs||(hs={})).CaseInsensitiveOptions={sensitivity:"base",numeric:!1},Tn.CaseSensitiveOptions={sensitivity:"case",numeric:!1},Tn.BooleanCollator=Object.freeze({type:Le.Boolean,compare:(s,e,t)=>s===!0?1:-1}),Tn.StringCollator=Object.freeze({type:Le.String,compare:(s,e,t)=>s.localeCompare(e,"en",t),defaultOptions:Tn.CaseInsensitiveOptions}),Tn.NumberCollator=Object.freeze({type:Le.Number,compare:(s,e,t)=>s<e?-1:1}),Tn.RichDataCollator=Object.freeze({type:Le.RichData,compare:(s,e,t)=>s.type.localeCompare(e.type,"en")}),Tn.DefaultRangeOptions=Object.freeze({hasHeader:!1,reverse:!1,includeHidden:!1,collatorOptions:Tn.CaseInsensitiveOptions,orientation:B.Orientation.Row,offset:0}),Tn.DefaultCollators=Object.freeze([Tn.BooleanCollator,Tn.StringCollator,Tn.NumberCollator,Tn.RichDataCollator]);const C1=(s,e,t,n)=>{let r;for(;!(r=s.next()).done;)try{e(r.value[1],r.value[0],t)}catch(o){if(typeof s.throw!="function")throw o;s.throw(o)}typeof s.return=="function"&&s.return()},G0=s=>{const e=s.next.bind(s),t={next:n=>{const r=e(n);return r.done?xt:{done:r.done,value:r.value[1]}},[Symbol.iterator]:()=>t,...s.return&&{return:s.return.bind(s)},...s.throw&&{throw:s.throw.bind(s)}};return t},Ws=s=>{if(!s||s.length===0)return null;let e=Number.MAX_SAFE_INTEGER,t=-1,n=null;return(r,o=!1)=>{if(r===e)return r;o!==!1&&(e=Number.MAX_SAFE_INTEGER),r!==e+(o?-1:1)&&(t=((l,a,c=!0)=>{if(!l||l.length===0)return null;let u,d=-1;return c?(d=P.findEqualOrGreater(l,a,h=>h.max),u=l[d]):(d=P.findEqualOrLesser(l,a,h=>h.min),u=l[d]),u?(c?a>u.max&&(d+=1,u=l[d]):a<u.min&&(d-=1,u=l[d]),u?d:-1):-1})(s,r,!o),n=s[t]);let i=r;if(o)for(;n&&i<=n.max;)i=n.min-1,n=s[--t];else for(;n&&i>=n.min;)i=n.max+1,n=s[++t];return e=i,i}},xt=Object.freeze({done:!0,value:void 0}),Qt=Object.freeze({next:()=>xt,[Symbol.iterator]:()=>Qt});var gs;Object.seal({done:!1,value:void 0}),(s=>{s.isList=t=>!!t&&!!t.isIList,s.isListLike=t=>!!t&&typeof t.length=="number"&&typeof t.at=="function",s.fromArray=(t,n,r,o)=>new e(t,n,r,o);class e{constructor(n,r,o,i){this.g=r,this.s=o;let l=n??i;if(o&&n&&!i){i=new Array(n.length);for(let a=0;a<n.length;a++){let c=n[a];i[a]=o(c,a)}l=i}this.a=l??P.EmptyArray,r&&(this.at=a=>{a<0&&(a=l.length+a);const c=l[a];if(c!==void 0)return r(c,a)})}at(n){const r=this.a;return n<0&&(n=r.length+n),r[n]}fromArray(n){return new e(n,this.g,this.s)}get length(){return this.a.length}get isIList(){return!0}}s.ArrayList=e})(gs||(gs={}));class Qn{constructor(e){if(this._s=null,this._r=null,this._l=0,e&&e.length>0){const t=gs.isList(e)&&!Array.isArray(e)?e:new gs.ArrayList(e);this._s=t,this._l=e.length}}at(e){const t=this._s;if(t)return t.at(e);const n=this._c;if(n&&n.min<=e&&n.max>=e){const l=n.value;return l.v.at(e-n.min+l.s)}const r=this._r,o=r[P.findEqualOrGreater(r,e,l=>l.max)];if(!o)return;const i=o.value;return this._c=o,i.v.at(e-o.min+i.s)}toArray(e=Number.MAX_SAFE_INTEGER){const t=[],n=this.entries(v1);let r=n.next();for(;!r.done&&t.length<e;)t.push(r.value[1]),r=n.next();return t}entries(e){const t=this.length;if(t===0)return Qt;let n,r,o,i=!0,l=0,a=t-1;if(e){i=!e.reverse;const f=e.bounds;f&&(l=Math.max(f.min??l,l),a=Math.min(f.max??a,a)),n=e.reuseResult??null,r=e.processSkip}const c=i?1:-1;let u=(i?l:a)-c;const d=this._s;if(d)o=f=>{if(!(f<l||f>a))return d.at(f)};else{const f=this._r;let g=i?0:f.length-1,m=f[g];const p=(S,w)=>{const b=S===g?m:f[S];if(b&&w>=b.min&&w<=b.max)return g=S,m=b,b};o=S=>{if(S<l||S>a)return;let w=p(g,S);if(w||(w=p(g+c,S)),!w){const C=P.findEqualOrGreater(f,S,_=>_.max);w=p(C,S)}if(!w)return;const b=w.value;return b.v.at(S-w.min+b.s)}}const h={next:f=>{let g,m=u+c;return f!==void 0&&(f<0&&(f=t+f),m=f),m<l||m>a||r&&(m=r(m,!i),m<l||m>a)?xt:(g=o(m),u=m,n?(hi.done=!1,hi.value[0]=m,hi.value[1]=g,hi):{done:!1,value:[u,g]})},[Symbol.iterator]:()=>h};return h}slice(e,t=void 0){const n=this._r??Qg(this._s);if(!n)return Qc;const r=this.length;if(e=Math.min(Math.max(0,e),r),(t=Math.min(Math.max(0,t??r),r))-e<=0)return Qc;if(e<=0&&t>=r)return this;const o=e,i=t-1;let l=[],a=0;for(let u=0;u<n.length;u++){let d=n[u];const h=d.max;if(o===0&&h<=i){l.push(d);continue}const f=d.min;if(f>i){u=n.length;continue}if(h<o){a=h+1;continue}const g=Math.max(0,o-f),m=Math.max(0,h-i),p=m+g,S=d.value;l.push({min:f-a,max:h-p-a,value:{s:S.s+g,e:S.e-m,v:S.v}}),a+=p}const c=new Qn;return c._r=l,c._l=i-o+1,c}concat(e){if(!e)return this;if(!gs.isListLike(e))throw new Error("Value must be IListLike");const t=this._l;if(t===0)return e.isIReadableList?e:e.length===0?Qc:new Qn(e);const n=e,r=e.length;if(r===0)return this;const o=this._r??Qg(this._s),i=o.slice(0,o.length-1);let l=o[o.length-1],a=l?l.min:0,c=l?l.max:0,u=l?l.value:null,d=u?u.v:null,h=u?u.e-u.s:0;const f=p=>{const S=p.s,w=p.e,b=w-S;if(b+h<x1&&d&&d.fromArray){let y=p.v;const v=[],x=u.s,E=u.e;for(let I=x;I<=E;I++)v.push(d.at(I));for(let I=S;I<=w;I++)v.push(y.at(I));const R=d.fromArray(v);if(R)return y=R,h=y.length-1,u={s:0,e:h,v:y},l={min:a,max:a+h,value:u},c=a+h,void(d=y)}i.push(l);const C=c+1,_=C+b;l={min:C,max:_,value:p},a=C,c=_,u=l?l.value:null,d=u?u.v:null,h=u?u.e-u.s:0};if(e instanceof Qn){const p=e._s;if(p)f({s:0,e:p.length-1,v:p});else{const S=e._r;for(let w=0;w<S.length;w++)f(S[w].value)}}else f({s:0,e:r-1,v:n});i.push(l);const g=new Qn,m=t+r;return i.length===1&&i[0].min===0&&i[0].max===m-1?g._s=i[0].value.v:g._r=i,g._l=m,g}get length(){return this._l}[Symbol.iterator](){return G0(this.entries())}get isIReadableList(){return!0}get isIList(){return!0}get[Symbol.toStringTag](){return"[ImmutableList]"}toString(){const e=this.length;if(e===0)return"";let t="";for(let n=0;n<e;n++){n>0&&(t+=",");const r=this.at(n);t+=r==null?"":String(r)}return t}}const Qg=s=>[{min:0,max:s.length-1,value:{s:0,e:s.length-1,v:s}}],Qc=new Qn,hi=Object.seal({done:!1,value:[-1,null]}),v1=Object.freeze({reverse:!1,bounds:{min:0,max:Number.MAX_SAFE_INTEGER},skipRuns:null,reuseResult:hi}),x1=4;var Oi;(s=>{const e=(n,r)=>{const o=n!==ct.Row;return r?(i,l)=>{if(i===l)return 0;const a=i[0],c=i[1],u=l[1];if(c===u)return a?-1:1;const d=l[0];let h=0,f=0;if(o?(h=a?c.colEnd:c.colStart,f=d?u.colEnd:u.colStart):(h=a?c.rowEnd:c.rowStart,f=d?u.rowEnd:u.rowStart),h===f&&a!==d)return a?-1:1;if(h!==f)return f-h;let g=0,m=0;if(o?(g=a?c.colStart:c.colEnd,m=d?u.colStart:u.colEnd):(g=a?c.rowStart:c.rowEnd,m=d?u.rowStart:u.rowEnd),g===m&&a!==d)return a?-1:1;if(g!==m)return m-g;const p=i[2]??0;return(l[2]??0)-p}:(i,l)=>{if(i===l)return 0;const a=i[0],c=i[1],u=l[1];if(c===u)return a?-1:1;const d=l[0];let h=0,f=0;if(o?(h=a?c.colStart:c.colEnd,f=d?u.colStart:u.colEnd):(h=a?c.rowStart:c.rowEnd,f=d?u.rowStart:u.rowEnd),h===f&&a!==d)return a?-1:1;if(h!==f)return h-f;let g=0,m=0;return o?(g=a?c.colEnd:c.colStart,m=d?u.colEnd:u.colStart):(g=a?c.rowEnd:c.rowStart,m=d?u.rowEnd:u.rowStart),g===m&&a!==d?a?-1:1:g!==m?g-m:(i[2]??0)-(l[2]??0)}};class t{constructor(r,o){if(this._isColumn=!0,this._isByCell=!1,this._isReverse=!1,this._cursor=null,this._reuse=null,this._localReuse={done:!1,value:[null,null]},this._eventsMajor=null,this._eventMajorIndex=0,this._majorStart=0,this._majorEnd=0,this._eventMinorPeek=null,this._minorStart=0,this._minorEnd=0,!r||r.length===0)return;let i=ct.Column,l=!1,a=!0,c=!1;o&&(i=o.orientation??ct.Column,this._isColumn=a=i!==ct.Row,this._isReverse=l=o.reverse??!1,this._isByCell=c=o.byCell??!1);const u=r.length,d=new Array(2*u);for(let g=0;g<u;g++){const m=r[g],p=[null,null];d[2*g]=[!0,m,g,p],d[2*g+1]=[!1,m,g,p]}d.sort(e(i,l)),this._eventsMajor=d;const h=d[0][1];this._majorStart=l?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,this._majorEnd=a?l?h.colEnd+1:h.colStart-1:l?h.rowEnd+1:h.rowStart-1,this._eventsMinor=new ft(null,e(a?ct.Row:ct.Column,l));const f=new Array(16);if(f.length=0,this._cursor={cell:null,range:{colStart:h.colStart,rowStart:h.rowStart,colEnd:h.colEnd,rowEnd:h.rowEnd},overlaps:f},c&&(this._cursor.cell={colIndex:l?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,rowIndex:l?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER}),o?.reuseIterator)throw new Error("Not implemented yet")}next(r){const o=this._isColumn,i=this._isReverse;if(r){if(!this._isByCell)throw new Error("nextCell is only supported when byCell is true");const I=q.createCellComparator(o?ct.Column:ct.Row,i);let A;do{const T=this._cursor,O=T.cell,N=O.colIndex===Number.MAX_SAFE_INTEGER||O.rowIndex===Number.MAX_SAFE_INTEGER;if(!N&&I(O,r)>=0)throw new Error("nextCell must be after the current iteration cell");if(A=this.next(),A.done)return A;const D=A.value.cell;if(I(D,r)>=0)return A;const F=T.range;if(o){const k=r.colIndex===O.colIndex;O.rowIndex=i?k?Math.max(r.rowIndex,F.rowStart):F.rowStart:k?Math.min(r.rowIndex,F.rowEnd):F.rowEnd}else{const k=r.rowIndex===O.rowIndex;O.colIndex=i?k?Math.max(r.colIndex,F.colStart):F.colStart:k?Math.min(r.colIndex,F.colEnd):F.colEnd}if(!N&&I(O,r)>=0)return D.rowIndex=O.rowIndex,D.colIndex=O.colIndex,A}while(!A.done);return A}let l=this._cursor;if(!l)return xt;let a=this._reuse;const c=l.cell,u=l.range;if(a){a.done=!1;const I=a.value,A=I.cell;c?(A.colIndex=c.colIndex,A.rowIndex=c.rowIndex):A&&(A.colIndex=-1,A.rowIndex=-1);const T=I.range;T.colStart=u.colStart,T.rowStart=u.rowStart,T.colEnd=u.colEnd,T.rowEnd=u.rowEnd,I.overlaps=[...l.overlaps],this._cursor.overlaps=I.overlaps}else{const I={cell:null,range:{colStart:u.colStart,rowStart:u.rowStart,colEnd:u.colEnd,rowEnd:u.rowEnd},overlaps:[...l.overlaps]};c&&(I.cell={colIndex:c.colIndex,rowIndex:c.rowIndex}),this._cursor=I,a={done:!1,value:I}}const d=a.value,h=d.range,f=d.cell,g=this._isByCell,m=i?-1:1;let p=!1;if(g){const I=f.rowIndex,A=f.colIndex,T=o?I:A,O=o?i?h.rowStart:h.rowEnd:i?h.colStart:h.colEnd;if((i?T>=O:T<=O)&&(o?f.rowIndex=I+m:f.colIndex=A+m,i?T>O:T<O))return a;const N=o?f.colIndex:f.rowIndex,D=o?i?h.colStart:h.colEnd:i?h.rowStart:h.rowEnd;(i?N>D:N<D)&&(p=!0)}const S=d.overlaps;let w=this._majorStart,b=this._majorEnd,C=this._eventsMinor,_=this._minorStart,y=this._minorEnd,v=this._eventsMinorIterator,x=this._eventMinorPeek,E=x;for(;E&&!E.done;){const I=E.value[0];if(I[0])E=null;else{if(x=v.next(),x.done)S.length=0;else{const A=I[1];let T=S.length;if(T>1){const O=S.indexOf(A);O!==-1&&(S[O]=S[T-1])}if(S.length=T-1,T=S.length,T>0){const O=x.value[0],N=O[1],D=o?i?N.colStart:N.colEnd:i?N.rowStart:N.rowEnd;if(i?w>=D:w<=D){let F=!1;if(O[0]){const k=o?i?N.rowEnd:N.rowStart:i?N.colEnd:N.colStart;(i?k<y+m:k>y+m)&&(_=y+m,y=k-m,F=!0)}else{const k=o?i?N.rowStart:N.rowEnd:i?N.colStart:N.colEnd;(i?k<y:k>y)&&(_=y+m,y=k,F=!0)}if(F)return o?(h.rowStart=i?y:_,h.rowEnd=i?_:y):(h.colStart=i?y:_,h.colEnd=i?_:y),this._minorStart=_,this._minorEnd=y,this._eventMinorPeek=x,a}}}x.done&&(x=null),E=x}}if(!x)if(p){v=C.entries(void 0,this._localReuse),x=v.next(),this._eventsMinorIterator=v;const I=x.value[0][1],A=o?i?I.rowEnd:I.rowStart:i?I.colEnd:I.colStart;o?(f.colIndex=f.colIndex+m,f.rowIndex=A):(f.colIndex=A,f.rowIndex=f.rowIndex+m)}else{let I=this._eventMajorIndex;const A=this._eventsMajor,T=A.length;if(I>=T)return this._cursor=null,xt;let O=A[I],N=O[0],D=!1;for(;!N&&!D&&O;){const k=O[1],L=o?i?k.colStart:k.colEnd:i?k.rowStart:k.rowEnd;if(i?L<b:L>b){D=!0;continue}const W=O[3];C.delete(W[0]),C.delete(W[1]),I++,O=A[I],O&&(N=O[0])}let F=C.size>0?b+m:-1;for(D=!1;N&&!D&&O;){const k=O[1];if(F!==-1&&(o?i?k.colEnd:k.colStart:i?k.rowEnd:k.rowStart)!==F){D=!0;continue}const L=O[2],W=[!0,k,L],$=[!1,k,L],J=O[3];if(J[0]=W,J[1]=$,C.set(W,0),C.set($,0),F===-1&&(F=o?i?k.colEnd:k.colStart:i?k.rowEnd:k.rowStart),I++,O=A[I],!O||(N=O[0],!N))continue;const te=O[1];(o?i?te.colEnd:te.colStart:i?te.rowEnd:te.rowStart)!==F&&(D=!0)}if(F!==-1&&(w=F),g&&(o?f.colIndex=w:f.rowIndex=w),this._eventMajorIndex=I,I>=T)return this._eventsMinorIterator=v,this._cursor=null,xt;if(O){const k=O[0],L=O[1],W=o?i?L.colEnd:L.colStart:i?L.rowEnd:L.rowStart,$=o?i?L.colStart:L.colEnd:i?L.rowStart:L.rowEnd;b=k?W-m:$}S.length=0,v=C.entries(void 0,this._localReuse),x=v.next(),this._eventsMinorIterator=v}let R=x;do{const I=R.value;R=null;const A=I[0],T=A[1];if(!A[0])continue;const O=o?i?T.rowEnd:T.rowStart:i?T.colEnd:T.colStart;_!==O&&(_=O),x=v.next();const N=x.value[0],D=N[0],F=N[1],k=o?i?F.rowEnd:F.rowStart:i?F.colEnd:F.colStart;if(D&&k===_)R=x;else{const L=o?i?T.rowStart:T.rowEnd:i?T.colStart:T.colEnd,W=o?i?F.rowStart:F.rowEnd:i?F.colStart:F.colEnd;y=(i?Math.max:Math.min)(L,D?k-m:W),g&&(o?f.rowIndex=_:f.colIndex=_)}S[S.length]=Object.freeze(T)}while(R);return o?(h.colStart=i?b:w,h.colEnd=i?w:b,h.rowStart=i?y:_,h.rowEnd=i?_:y):(h.rowStart=i?b:w,h.rowEnd=i?w:b,h.colStart=i?y:_,h.colEnd=i?_:y),this._eventMinorPeek=x,this._minorStart=_,this._minorEnd=y,this._majorStart=w,this._majorEnd=b,a}return(r){return null}throw(r){return null}[Symbol.iterator](){return this}}s.IteratorInstance=t})(Oi||(Oi={}));const Kr=(s,e=Lt.Right,t=null)=>{if(!s)return s;if(s.length===0)return[];const n=e===Lt.Right,r=e===Lt.Left,o=e===Lt.Up,i=e===Lt.Down;return s.sort((l,a)=>{if(!l&&!a)return 0;if(l&&!a)return-1;if(a&&!l)return 1;const c=t?.(l,a)??0;return c!==0?c:n?l.rowStart===a.rowStart?l.colStart-a.colStart:l.rowStart-a.rowStart:i?l.colStart===a.colStart?l.rowStart-a.rowStart:l.colStart-a.colStart:r?l.rowStart===a.rowStart?a.colStart-l.colStart:a.rowStart-l.rowStart:o?l.colStart===a.colStart?a.rowStart-l.rowStart:a.colStart-l.colStart:0})},E1=(s,e)=>{const t=e.min,n=s.min;if(e.max===Number.MAX_SAFE_INTEGER){const r=t,o=s.max;return n<=r&&r<=o?0:o<r?-1:n>r?1:(console.warn("coords are not inserted correctly",s,e),0)}return n-t};let xi=class ad{constructor(e){this._runs=null,this._dataCoords=null,this._count=0,this._length=0,this._maxCoords=null,this._options=e,e?.maxCoords&&(this._maxCoords=Object.freeze({...e.maxCoords})),this._runs=new ft(void 0,E1,e?.nodeSize),this._reuseRunsIterator={done:!1,value:[null,null]},this._reuseRunsEntry=[null,null]}_validateBounds(e=Number.MIN_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER){const n=this._maxCoords,r=n?.min??Number.MIN_SAFE_INTEGER,o=n?.max??Number.MAX_SAFE_INTEGER;if(e<r||t>o)throw new Tt}entries(e){let t,n,r=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,i=!0;e&&(e?.bounds&&(r=e.bounds?.min??Number.MIN_SAFE_INTEGER,o=e.bounds?.max??Number.MAX_SAFE_INTEGER,this._validateBounds(r,o)),i=!e.reverse,t=R1(e.reuseResult),n=e.processSkip);const l=this._dataCoords;if(!l)return Qt;r=Math.max(l.min,r),o=Math.min(l.max,o);let a=null,c=null,u=Number.MAX_SAFE_INTEGER,d=Number.MIN_SAFE_INTEGER;if(n){const p=n;n=(S,w)=>p(S+u,w)-u}const h=p=>{let S;p!==Number.MIN_SAFE_INTEGER&&p!==Number.MAX_SAFE_INTEGER&&(Wn.min=p,S=Wn),a=i?this._runs.entries(S,this._reuseRunsIterator):this._runs.entriesReversed(S,this._reuseRunsIterator),u=Number.MAX_SAFE_INTEGER,d=Number.MIN_SAFE_INTEGER,c=null},f=p=>{if(p!==void 0){if(p<u||p>d)return void(c=void 0);p-=u}if(!c)return;let S=c.next(p);if(!c)return;let w=S.value,b=w?.[1];return S.done?void(c=void 0):I1(w[0]+u,b,t)},g=p=>{let S;return S=f(p),S||(S=(w=>{let b;do{if(w!==void 0&&h(w),!a)return;if(b=a.next(),b.done)return void(a=void 0);const C=b.value,_=C[0],y=C[1],v=_.min,x=_.max,E=Math.max(v,r)-v,R=Math.max(E,Math.min(x,o))-v;Jo.bounds.min=E,Jo.bounds.max=R,Jo.reverse=!i,Jo.processSkip=n,Jo.reuseResult=t,u=v,d=x,c=y.entries(Jo);const I=f(w);if(I)return I;w=void 0}while(!b.done);a=void 0})(p),S||xt)},m={next(p){if(p!==void 0&&(p<0||p>o))throw new Tt;return g(p)},return:p=>null,throw:p=>null};return h(i?r:o),m}runs(e){let t,n=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,o=!0,i=!1;e&&(e.bounds&&(n=e.bounds?.min??Number.MIN_SAFE_INTEGER,r=e.bounds?.max??Number.MAX_SAFE_INTEGER,this._validateBounds(n,r),e.overflowRun&&(i=!0)),o=!e.reverse,t=A1(e.reuseResult));const l=this._dataCoords;if(!l)return Qt;n=Math.max(l.min,n),r=Math.min(l.max,r);let a=null;const c=d=>{let h;d!==Number.MIN_SAFE_INTEGER&&d!==Number.MAX_SAFE_INTEGER&&(Wn.min=d,h=Wn),a=o?this._runs.entries(h,this._reuseRunsIterator):this._runs.entriesReversed(h,this._reuseRunsIterator)},u={next(d){if(d!==void 0){if(d<n||d>r)throw new Tt;c(d)}if(!a)return xt;const h=a.next();if(h.done)return a=void 0,xt;const f=h.value,g=f[0];let m=g;const p=m.min,S=m.max;if(o&&p>r||!o&&S<n)return xt;let w=f[1];return i||(S>r&&(w=w.slice(0,w.length-(S-r)),m={...m},m.max=r),p<n&&(w=w.slice(n-p),m===g&&(m={...m}),m.min=n)),M1(m,w,t)},return:d=>null,throw:d=>null};return c(o?n:r),u}slice(e,t){const n=this._runs,r=n.minKey().min,o=n.maxKey().max;if(t===void 0&&(t=o+1),this._count===0||e<=r&&t-1>=o)return this.clone();const i=Math.max(r,e),l=Math.min(o,t-1),a=l-i,c=[];let u=0;eu.bounds.min=i,eu.bounds.max=l;const d=this.runs(eu);let h=d.next();for(;!h.done;){const g=h.value;let m=g[0],p=g[1];m={min:m.min-i,max:m.max-i},m.min<0&&(p=p.slice(-m.min),m.min=0),m.max>=a&&(p=p.slice(0,p.length-(m.max-a)),m.max=a),u+=p.length,c.push([m,p]),h=d.next()}const f=new ad(this._options);return f._runs.setPairs(c),f._updateCount(u),f}concat(e){const t=this.clone();if(!e||e.length===0)return t;const n=this._runs.nextLowerPair(void 0,this._reuseRunsEntry),r=n[0],o=n[1],i=r.max+1;let l=!1,a=0;const c=[];if(e.isISparseList){const u=e.runs();let d=u.next();for(;!d.done;){const h=d.value;let f=h[0];const g={min:f.min+i,max:f.max+i};let m=h[1];if(f.min===0){l=!0,a-=o.length,m=o.concat(m);const p=r.min;g.min=p,g.max=m.length-1+p}a+=m.length,c.push([g,m]),d=u.next()}}else{const u=e.length,d={min:r.min,max:u-1+i};e=o.concat(e),l=!0,a+=u,c.push([d,e])}return l&&t._runs.delete(r),t._runs.setPairs(c),t._updateCount(a),t}toArray(e=Number.MAX_SAFE_INTEGER,t=!0){if(this.length===0)return P.EmptyArray;const n=t?0:Number.MIN_SAFE_INTEGER,r=Math.min(this._runs.maxKey().max,e);return Yc.bounds.min=Number.MIN_SAFE_INTEGER,Yc.bounds.max=r,T1(this.entries(Yc),t,r,n)}get isIReadableList(){return!0}get length(){return this._length}getCoords(){return this._dataCoords}clear(){this._runs.clear(),this._dataCoords=null,this._count=0,this._length=0}get isISparseList(){return!0}get isIList(){return!0}_updateCount(e){if(this._count+=e,this._lastRunsRead=void 0,this._lastListRead=void 0,this._count>0){const t=this._runs,n=Object.freeze({min:t.minKey().min,max:t.maxKey().max});this._dataCoords=n,this._length=n.max+1}else this._dataCoords=null,this._length=0}_update(e,t,n=null,r=void 0){const o=e,i=o+t-1;let l=0,a=i,c=i,u=null,d=null;Wn.min=o,Ko.min=i,(n||r)&&(Wn.min-=1,Ko.min+=1);const h=this._runs;let f=!1;if(h.editRange(Wn,Ko,!0,(g,m,p)=>{const S=g.min,w=g.max;return S<o&&w+1>=o&&(a=S,u=m),S-1<=i&&w>i&&(c=S,d=m),l-=w-S+1,f=!0,ft.DeleteValue}),n||r===void 0||(n=new Qn([r])),n){let g=n;f=!0;let m=o;u&&(u=u.slice(0,o-a),g=u.concat(g),m=a),d&&(d=d.slice(i+1-c),g=g.concat(d)),l+=g.length,h.set({min:m,max:m+g.length-1},g)}else u&&(u=u.slice(0,o-a),l+=u.length,h.set({min:a,max:a+u.length-1},u)),d&&(d=d.slice(i+1-c),l+=d.length,h.set({min:i+1,max:i+d.length},d));return this._updateCount(l),f}setAt(e,t){if(e===void 0)throw new lr;return this._validateBounds(e,e),this._update(e,1,null,t)}setRunAt(e,t){if(!t||t.length===0)return!1;if(e===void 0||!t.length)throw new lr;const n=t.length;return this._validateBounds(e,e+n-1),this._update(e,n,t)}delete(e,t){return t===void 0&&(t=Math.max(this.getCoords().max-e+1,0)),!(t<=0)&&(this._validateBounds(e,e),this._update(e,t,null))}shift(e,t){if(t===0)return!1;let n=e,r=e;t<0&&(r=e-t-1),this._validateBounds(n,r);const o=this._runs,i=o.maxKey();if(t<0&&r>=i.max&&n<=o.minKey().min)return this._runs.clear(),this._dataCoords=null,this._count=0,this._length=0,!0;let l=0,a=n,c=r,u=null,d=null;Wn.min=a,Ko.min=i.min,t<0&&(Wn.min-=1,Ko.min+=1);let h=!1;const f=[];if(o.editRange(Wn,Ko,!0,(g,m,p)=>{const S=g.min,w=g.max;return S<n&&w+1>=n&&(a=S,u=m),(S<n||t<0)&&S-1<=r&&g.max>r&&(c=S,d=m),t>0&&S>=n||t<0&&S-1>r?f.push([{min:S+t,max:w+t},m]):l-=w-S+1,h=!0,ft.DeleteValue}),t>0){const g=u||d;g&&(u=g.slice(0,n-a),c=e+t,d=g.slice(n-a))}else u&&(u=u.slice(0,n-a)),d&&(d=d.slice(r+1-c),c=e),u&&d&&a+u.length===c&&(u=u.concat(d),d=null);return u&&u.length>0&&(l+=u.length,o.set({min:a,max:a+u.length-1},u)),d&&(l+=d.length,o.set({min:c,max:c+d.length-1},d)),f.length>0&&o.setPairs(f),this._updateCount(l),h}at(e){Wn.min=e;const t=this._lastRunsRead;if(t){const i=t.min;if(i<=e&&t.max>=e)return this._lastListRead.at(e-i)}let n,r;const o=this._runs.getPairOrNextHigher(Wn,F1);if(o&&(n=o[0],r=o[1]),this._lastRunsRead=n,this._lastListRead=r,!(!n||e<n.min||e>n.max))return r.at(e-n.min)}[Symbol.iterator](){return G0(this.entries())}clone(){const e=new ad(this._options);return e._runs=this._runs.clone(),e._count=this._count,e._dataCoords=this._dataCoords,e._length=this._length,e}getMaxCoords(){return this._maxCoords||null}getCount(){return this._count}getRunsCount(){return this._runs.size}get[Symbol.toStringTag](){return"[SparseList]"}};xi||(xi={});const R1=s=>typeof s!="boolean"?(s&&!s.value&&(s.value=[-1,null]),s):s===!0?nh:void 0,I1=(s,e,t)=>{const n=t??{done:!1,value:[-1,null]},r=n.value;return r[0]=s,r[1]=e,n},A1=s=>typeof s!="boolean"?(s&&!s.value&&(s.value=[null,null]),s):s===!0?k1:void 0,M1=(s,e,t)=>{const n=t??{done:!1,value:[null,null]},r=n.value;return r[0]=s,r[1]=e,n},T1=(s,e=!1,t=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER)=>{const r=[];let o=s.next(),i=Math.max(n,0)-1;for(;!o.done;){if(e){const l=o.value[0];for(let a=i;a<l-1;a++)r.push(void 0);i=l}r.push(o.value[1]),o=s.next()}if(e)for(let l=i;l<t;l++)r.push(void 0);return r},k1=Object.seal({done:!1,value:[{min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER},null]}),nh=Object.seal({done:!1,value:[-1,null]}),Jo={reverse:!1,bounds:{min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER},processSkip:null,reuseResult:nh},Yc=Object.freeze({reverse:!1,bounds:{min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER},processSkip:null,reuseResult:nh}),Wn={min:0,max:Number.MAX_SAFE_INTEGER},Ko={min:0,max:Number.MAX_SAFE_INTEGER},F1=[null,null],eu={bounds:{min:0,max:0},overflowRun:!0};class N1{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(e){return this.data.children.length===0?[]:this._all(this.data,e??[])}isEmpty(){return this.data.children.length===0}search(e,t){let n=this.data;if(n.children.length===0)return P.EmptyArray;if(!pl(e,n))return P.EmptyArray;const r=t??[],o=this.toBBox,i=[];for(;n;){const l=n.children,a=l.length,c=n.leaf;for(let u=0;u<a;u++){const d=l[u],h=c?o(d):d;pl(e,h)&&(c?r.push(d):nu(e,h)?this._all(d,r):i.push(d))}n=i.pop()}return r}collides(e){let t=this.data;if(!pl(e,t))return!1;const n=[];for(;t;){for(let r=0;r<t.children.length;r++){const o=t.children[r],i=t.leaf?this.toBBox(o):o;if(pl(e,i)){if(t.leaf||nu(e,i))return!0;n.push(o)}}t=n.pop()}return!1}load(e){if(!e||!e.length)return this;const t=this._minEntries;if(e.length<t){for(let r=0;r<e.length;r++)this.insert(e[r]);return this}let n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){const r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=ns([]),this}remove(e,t){if(!e)return this;let n=this.data;const r=this.toBBox(e),o=[],i=[];let l,a,c;for(;n||o.length;){if(n||(n=o.pop(),a=o[o.length-1],l=i.pop(),c=!0),n.leaf){const u=O1(e,n.children,t);if(u!==-1)return n.children.splice(u,1),o.push(n),this._condense(o),this}c||n.leaf||!nu(n,r)?a?(l++,n=a.children[l],c=!1):n=null:(o.push(n),i.push(l),l=0,a=n,n=n.children[0])}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const n=[];for(;e;)e.leaf?t.push(...e.children):n.push(...e.children),e=n.pop();return t}_build(e,t,n,r){const o=n-t+1;let i,l=this._maxEntries;if(o<=l)return i=ns(e.slice(t,n+1)),Xo(i,this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(l)),l=Math.ceil(o/Math.pow(l,r-1))),i=ns([]),i.leaf=!1,i.height=r;const a=Math.ceil(o/l),c=a*Math.ceil(Math.sqrt(l));Yg(e,t,n,c,this.compareMinX);for(let u=t;u<=n;u+=c){const d=Math.min(u+c-1,n);Yg(e,u,d,a,this.compareMinY);for(let h=u;h<=d;h+=a){const f=Math.min(h+a-1,d);i.children.push(this._build(e,h,f,r-1))}}return Xo(i,this.toBBox),i}_chooseSubtree(e,t,n,r){for(;r.push(t),!t.leaf&&r.length-1!==n;){let o,i=1/0,l=1/0;for(let a=0;a<t.children.length;a++){const c=t.children[a],u=tu(c),d=B1(e,c)-u;d<l?(l=d,i=u<i?u:i,o=c):d===l&&u<i&&(i=u,o=c)}t=o||t.children[0]}return t}_insert(e,t,n=!1){const r=n?e:this.toBBox(e),o=[],i=this._chooseSubtree(r,this.data,t,o);for(i.children.push(e),fi(i,r);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(r,o,t)}_split(e,t){const n=e[t],r=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,r);const i=this._chooseSplitIndex(n,o,r),l=ns(n.children.splice(i,n.children.length-i));l.height=n.height,l.leaf=n.leaf,Xo(n,this.toBBox),Xo(l,this.toBBox),t?e[t-1].children.push(l):this._splitRoot(n,l)}_splitRoot(e,t){this.data=ns([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Xo(this.data,this.toBBox)}_chooseSplitIndex(e,t,n){let r=-1,o=1/0,i=1/0;for(let l=t;l<=n-t;l++){const a=gi(e,0,l,this.toBBox),c=gi(e,l,n,this.toBBox),u=z1(a,c),d=tu(a)+tu(c);u<o?(o=u,r=l,i=d<i?d:i):u===o&&d<i&&(i=d,r=l)}return r||n-t}_chooseSplitAxis(e,t,n){const r=e.leaf?this.compareMinX:D1,o=e.leaf?this.compareMinY:L1;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,o)&&e.children.sort(r)}_allDistMargin(e,t,n,r){e.children.sort(r);const o=this.toBBox,i=gi(e,0,t,o),l=gi(e,n-t,n,o);let a=ml(i)+ml(l);for(let c=t;c<n-t;c++){const u=e.children[c];fi(i,e.leaf?o(u):u),a+=ml(i)}for(let c=n-t-1;c>=t;c--){const u=e.children[c];fi(l,e.leaf?o(u):u),a+=ml(l)}return a}_adjustParentBBoxes(e,t,n){for(let r=n;r>=0;r--)fi(t[r],e)}_condense(e){for(let t,n=e.length-1;n>=0;n--)e[n].children.length===0?n>0?(t=e[n-1].children,t.splice(t.indexOf(e[n]),1)):this.clear():Xo(e[n],this.toBBox)}}function O1(s,e,t){if(!t)return e.indexOf(s);for(let n=0;n<e.length;n++)if(t(s,e[n]))return n;return-1}function Xo(s,e){gi(s,0,s.children.length,e,s)}function gi(s,e,t,n,r=null){r||(r=ns(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let o=e;o<t;o++){const i=s.children[o];fi(r,s.leaf?n(i):i)}return r}function fi(s,e){return s.minX=Math.min(s.minX,e.minX),s.minY=Math.min(s.minY,e.minY),s.maxX=Math.max(s.maxX,e.maxX),s.maxY=Math.max(s.maxY,e.maxY),s}function D1(s,e){return s.minX-e.minX}function L1(s,e){return s.minY-e.minY}function tu(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function ml(s){return s.maxX-s.minX+(s.maxY-s.minY)}function B1(s,e){return(Math.max(e.maxX,s.maxX)-Math.min(e.minX,s.minX))*(Math.max(e.maxY,s.maxY)-Math.min(e.minY,s.minY))}function z1(s,e){const t=Math.max(s.minX,e.minX),n=Math.max(s.minY,e.minY),r=Math.min(s.maxX,e.maxX),o=Math.min(s.maxY,e.maxY);return Math.max(0,r-t)*Math.max(0,o-n)}function nu(s,e){return s.minX<=e.minX&&s.minY<=e.minY&&e.maxX<=s.maxX&&e.maxY<=s.maxY}function pl(s,e){return e.minX<=s.maxX&&e.minY<=s.maxY&&e.maxX>=s.minX&&e.maxY>=s.minY}function ns(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Yg(s,e,t,n,r){const o=[e,t];for(;o.length;){if((t=o.pop())-(e=o.pop())<=n)continue;const i=e+Math.ceil((t-e)/n/2)*n;U0(s,i,e,t,r),o.push(e,i,i,t)}}function U0(s,e,t,n,r){for(;n>t;){if(n-t>600){const a=n-t+1,c=e-t+1,u=Math.log(a),d=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*d*(a-d)/a)*(c-a/2<0?-1:1);U0(s,e,Math.max(t,Math.floor(e-c*d/a+h)),Math.min(n,Math.floor(e+(a-c)*d/a+h)),r)}const o=s[e];let i=t,l=n;for(js(s,t,e),r(s[n],o)>0&&js(s,t,n);i<l;){for(js(s,i,l),i++,l--;r(s[i],o)<0;)i++;for(;r(s[l],o)>0;)l--}r(s[t],o)===0?js(s,t,l):(l++,js(s,l,n)),l<=e&&(t=l+1),e<=l&&(n=l-1)}}function js(s,e,t){const n=s[e];s[e]=s[t],s[t]=n}class ef extends N1{toBBox(e){return{minX:10*e.colStart,minY:10*e.rowStart,maxX:10*e.colEnd+5,maxY:10*e.rowEnd+5}}compareMinX(e,t){return e.colStart-t.colStart}compareMinY(e,t){return e.rowStart-t.rowStart}isEmpty(){return this.data.children.length===0}searchRange(e,t=!1,n){if(this.isEmpty())return P.EmptyArray;const r=this.search(this.toBBox(e),n);return t?r.filter(o=>o.colStart>=e.colStart&&o.rowStart>=e.rowStart&&o.colEnd<=e.colEnd&&o.rowEnd<=e.rowEnd):r}}class yt{constructor(e){this._shared=null,this._rTree=null,this._cloneKey=null,this._lastMiss={colStart:Number.MAX_SAFE_INTEGER,rowStart:0,colEnd:0,rowEnd:0},this._lastSingle=null,this._lastSingleResult=null,this._options=e,this._rTree=new ef(e?.maxNodeEntries??16)}visitRanges(e,t,n=null){let r=this.search(e);n&&(r=Kr(r,n));const o=[],i=[];let l=null;const a=r.length;for(let c=0;!l&&c<a;c++){const u=r[c],d=t?.(u);d&&(d.delete===!0?i.push(u):d.update!==void 0&&(i.push(u),o.push(d.update)),d&&d.break===!0&&(l=d))}for(let c=0;c<i.length;c++)this.remove(i[c]);return this.load(o),l}getBoundingCoords(){const e=this._getReadTree().toJSON();return e&&e.children&&e.children.length!==0?{colStart:e.minX/10,rowStart:e.minY/10,colEnd:(e.maxX-5)/10,rowEnd:(e.maxY-5)/10}:null}size(){return this._getReadTree().all().length}isEmpty(){return this._getReadTree().isEmpty()}search(e,t=!1,n){const r=this._getReadTree();if(r.isEmpty())return P.EmptyArray;let o;if(!t){if(o=this._lastMiss,o.colStart!==Number.MAX_SAFE_INTEGER&&q.isRangeWithinRange(e,o))return P.EmptyArray;if(this._lastSingle&&q.isRangeWithinRange(e,o))return this._lastSingleResult}const i=r.searchRange(e,t,n);return t||(i.length===0?(o.colStart=e.colStart,o.rowStart=e.rowStart,o.colEnd=e.colEnd,o.rowEnd=e.rowEnd):i.length===1?(this._lastSingle=i[0],this._lastSingleResult=i):(this._lastMiss.colStart=Number.MAX_SAFE_INTEGER,this._lastSingle=null,this._lastSingleResult=null)),i}has(e){const t=this._getReadTree();return t.collides(t.toBBox(e))}all(e){return this._getReadTree().all(e)}shift(e){const t=e.range,n=e.direction,r=e.cloneIfUpdate??!1,o=e.coordValidator??null,i=e.onShift??null,l=n===Lt.Left||n===Lt.Right,a=l?ct.Column:ct.Row,c=n===Lt.Up||n===Lt.Left?-1:1,u=(l?t.colEnd-t.colStart+1:t.rowEnd-t.rowStart+1)*c,d=[],h=[];let f=null;const g=this.getBoundingCoords();if(!g)return this;const m=n===Lt.Up||n===Lt.Left?Lt.Right:Lt.Left,p=new Map,S=new Map,w=this._options?.updateEntryOptions,b=w?.isMergeOnShift??!1,C=w?.isSplitOnExpand??!1,_=w?.isTrailingEdge??!1,y=n===Lt.Left||n===Lt.Up,v=w?.getSplit??ta,x=w?.getShifted,E=w?.onShifted,R=w?.onRemoved,I=w?.onMerged,A=w?.onUpdated,T=E?[]:null,O=R?[]:null,N=A?[]:null;this.visitRanges({colStart:t.colStart-(l?1:0),rowStart:t.rowStart-(l?0:1),colEnd:l?g.colEnd:t.colEnd,rowEnd:l?t.rowEnd:g.rowEnd},k=>{if((l?k.colEnd<t.colStart:k.rowEnd<t.rowStart)&&!_)return;const L=V1(t,k,l?rs.Column:rs.Row),W=k.group;if(y&&!W&&t.colStart<=k.colStart&&t.rowStart<=k.rowStart&&t.colEnd>=k.colEnd&&t.rowEnd>=k.rowEnd){const G=rf(k,null,{after:null,before:k,intersect:t,isSplit:L,orientation:a,amount:u},x,v,i,!1);if(G===void 0)return;if(G===null)return f=q.unionRanges(f,k),O&&O.push(k),void d.push(k)}let $={...k};n===Lt.Right?(t.colStart<=$.colStart&&($.colStart+=u),$.colEnd+=u):n===Lt.Left?t.colStart<$.colStart?($.colStart=Math.max($.colStart+u,t.colStart),$.colEnd=Math.max($.colEnd+u,$.colStart-1)):$.colEnd+=Math.max(u,t.colStart-$.colEnd-1):n===Lt.Down?(t.rowStart<=$.rowStart&&($.rowStart+=u),$.rowEnd+=u):n===Lt.Up&&(t.rowStart<$.rowStart?($.rowStart=Math.max($.rowStart+u,t.rowStart),$.rowEnd=Math.max($.rowEnd+u,t.rowStart-1)):$.rowEnd+=Math.max(u,t.rowStart-$.rowEnd-1)),($.colEnd<$.colStart||$.rowEnd<$.rowStart)&&($=null);const J=rf(k,$,{after:$,before:k,intersect:t,isSplit:L,orientation:a,amount:u},x,v,i,C&&u>0);if(J===void 0)return;const te=J===null?[$]:J,Q=te.length;if(te[0]!==k||Q!==1){if(o)for(let ee=0;ee<Q;ee++){const ne=te[ee];ne&&o(ne)}let G;W?(p.set(W.uuid,W),G=[],S.set(k.uuid,G)):d.push(k);for(let ee=0;ee<Q;ee++){const ne=te[ee];f=q.unionRanges(f,ne),W?G.push(ne):(h.push(ne),T&&T.push(ne),N&&N.push(k))}}},m);let D=null;D=r&&(d.length>0||h.length>0||S.size>0)?this.clone():this,D._updateNodes(h,d),S.size>0&&D._updateGroupedEntries(p,S);let F=P.EmptyArray;if(b&&g&&f){let k=!0;if(u>0&&(k=l?t.rowStart>g.rowStart||t.rowEnd<g.rowEnd:t.colStart>g.colStart||t.colEnd<g.colEnd),k){const L=tf(f,q.unionRanges(g,f),l?0:1,l?1:0);I&&(F=D._mergeNodes(L,!1))}}return A&&N.length>0&&A(N),E&&T.length>0&&E(T),I&&F.length>0&&I(F),R&&O.length>0&&R(O),D}insertNonOverlapping(e,t){const n=t?.onIntersect??((b,C)=>({...b,value:C.value})),r=this.search(e),o=new Map,i=new Map,l=this._options?.updateEntryOptions,a=l?.onUpdated,c=l?.onRemoved,u=l?.onMerged,d=l?.getSplit,h=l?.getIntersect,f=l?.getUpdate;let g=null,m=null,p=null,S=(function(b,C,_){const y=_?.getIntersect??H1,v=_?.getUpdate??$1;if(b.length===0){if(y){const L=y({...C,value:null},C);C=L&&L.value!==null?{...L}:null}if(v){const L=v(C);L!==void 0&&(C=L)}return C?[C]:P.EmptyArray}const x=_?.getSplit??P1,E=(L,W,$=!0)=>{const J=W.search(L),te=J.length;for(let Q=0;Q<te;Q++){const G=J[Q];if(q.isEqualRanges(G,L))continue;W?.remove(G);const ee=Cs(G,L,x,$);for(let ne=0;ne<ee.length;ne++){const re=ee[ne];W.insert(re),E(re,W,!1)}}},R=new yt;R.load(b),E(C,R);const I=new yt;I.load([C]);const A=R.search(C);for(let L=0;L<A.length;L++)E(A[L],I);const T=(L,W,$)=>{let J=W.search(L);console.assert(J.length<=1,"intersecting incorrect ranges");const te=J[0]??{...L,value:null};if(q.isEqualRanges(te,L)){let Q=y(te,L);W.remove(te),$.insert(Q)}else{W.remove(te);const Q=Cs(te,L,x),G=Q.length;for(let ee=0;ee<G;ee++){const ne=Q[ee];if(q.isEqualRanges(ne,L)){const re=y(ne,L);$.insert(re)}else W.insert(ne)}}},O=new yt,N=I.all(),D=N.length;for(let L=0;L<D;L++)T(N[L],R,O);const F=(L,W)=>{const $=L.all(),J=$.length;for(let te=0;te<J;te++){let Q=$[te];if(v){const G=v(Q);G!==void 0&&(Q=G)}Q!==null&&Q.value!==null&&W.push(Q)}},k=R.all();return F(O,k),k})(r,e,{getSplit:(b,C,_,y)=>{let v;return d?(v=d(b,C,_,y),v):(v=ta(b,C,_,y),v)},getIntersect:(b,C)=>{h&&(C=h(b,C));const _=n(b,C);return _===void 0||(_===null||_.value===null)&&b.value?.onRemove?.(b),_},getUpdate:b=>{const C=b?.group;if(C){o.set(C.uuid,C);let y=i.get(b.lastId??b.uuid);y||(y=[],i.set(b.lastId??b.uuid,y)),y.push(b.value===null?null:b)}let _=b;if(f&&(_=f(b)),_&&_.value!==null)a&&(g||(g=[]),g.push(_));else if(c&&!p){p=[];let y=_&&_.value===null?_:{...b,value:null};p.push(y)}return _}});const w=this.getBoundingCoords();if(o.size>0){const b=[],C=S.length;for(let _=0;_<C;_++){let y=S[_];y.group||b.push(y)}S=b}if(this._updateNodes(S,r,t?.onUpdates),o.size>0&&this._updateGroupedEntries(o,i),w&&!l?.noMerge&&!t?.noMerge){const b=tf(e,q.unionRanges(w,e)),C=this.search(b);if(C.length>1){const _=l?.getMerged??nf;let y=C;y=Sr(y,ct.Column,1,_),y=Sr(y,ct.Row,1,_),C.length!==y.length&&(u&&y.length>0&&(m=y),this._updateNodes(y,C,t?.onUpdates))}}return g&&a(g),m&&u(m),p&&c(p),this}insertGroup(e,t){t=t??P.uuidV4();const n=[],r=e.length;for(let o=0;o<r;o++){const i={...e[o],group:{entries:n,uuid:t,offset:o},uuid:P.uuidV4()};n.push(i),e[o]=i}return this.load(e),this._options?.updateEntryOptions?.onGroupUpdate?.(e,t),this}createCopiedEntries(e,t,n,r,o){return W1(this,e,t,n,r,o,this._options?.updateEntryOptions?.getSplit??ta)}_updateGroupedEntries(e,t){const n=[],r=[],o=new Map,i=e.values();let l=i.next();for(;!l.done;){const a=l.value,c=a.entries,u=a.uuid,d=[];for(let h=0;h<c.length;h++){let f=c[h];n.push(f);let g=t.get(f.uuid);g===void 0&&(g=[{...f}]);for(let m=0;m<g.length;m++){let p=g[m];p!==null&&(p={...p,group:{offset:d.length,entries:d,uuid:u}},d.push(p),r.push(p))}}d.sort((h,f)=>h.group.offset-f.group.offset),o.set(u,d),l=i.next()}if(this._updateNodes(r,n),o){const a=this._options?.updateEntryOptions?.onGroupUpdate;if(a){const c=o.entries();let u=c.next();for(;!u.done;){const d=u.value[0];a(u.value[1],d),u=c.next()}}}}_copy(e,t){let n=e.rTree.all();const r=new ef(this._options?.maxNodeEntries);return t&&(n=n.concat(t)),n.length>0&&r.load(n),{refCount:1,rTree:r}}_updateNodes(e,t,n){if(!(e&&e.length!==0||t&&t.length!==0))return;const r=this._getWritableTree();if(t){const o=t.length;for(let i=0;i<o;i++)r.remove(t[i])}e.length>0&&r.load(e),n?.(e,t,this),this._options?.updateEntryOptions?.onUpdates?.(e,t,this)}_mergeNodes(e,t){const n=this.search(e,t);let r=P.EmptyArray;if(n.length>1){const o=this._options?.updateEntryOptions.getMerged??nf;let i=n;i.length>1&&(i=Sr(i,ct.Column,1,o)),i.length>1&&(i=Sr(i,ct.Row,1,o)),n.length!==i.length&&(r=i,this._updateNodes(i,n))}return r}_getReadTree(){return this._shared?.rTree??this._rTree}_ensureWritable(e){const t=this._shared;if(!t)return;if(t.refCount--,t.refCount===0)return this._shared=null,void(e&&this._rTree.load(e));const n=this._copy(t,e);this._shared=null,this._rTree=n.rTree}_getWritableTree(e){return this._lastMiss.colStart=Number.MAX_SAFE_INTEGER,this._lastSingle=null,this._lastSingleResult=null,this._shared?(this._ensureWritable(e),this._rTree):(e&&this._rTree.load(e),this._rTree)}remove(e,t){return e&&this._getWritableTree().remove(e,t??q.isEqualRanges),this}insert(e){return e&&this._getWritableTree().insert(e),this}load(e){return e&&e.length>0&&this._getWritableTree(e),this}clear(){return this.isEmpty()||this._getWritableTree().clear(),this}clone(e=null){if(e!==null&&this._cloneKey===e)return this;let t=this._shared;t||(t={rTree:this._rTree,refCount:1},this._shared=t),t.refCount++;const n=new yt(this._options);return n._shared=t,n._cloneKey=e,n}fromJSON(e){return this._getWritableTree().fromJSON(e),this}}const tf=(s,e=s,t=1,n=1)=>({...s,colStart:Math.max(s.colStart-t,e.colStart),rowStart:Math.max(s.rowStart-n,e.rowStart),colEnd:Math.min(s.colEnd+t,e.colEnd),rowEnd:Math.min(s.rowEnd+n,e.rowEnd)});function P1(s,e,t,n){return[{...e[0],value:s.value},{...e[0],value:s.value}]}function H1(s,e){return{...s}}function Cs(s,e,t=null,n=!0){if(q.isEqualRanges(s,e))return[{...s}];const r=q.intersectRanges(s,e,j1);if(!r)return null;const o=[],i=s.uuid;let l=s;if(l.rowStart<r.rowStart){const a={...l,colStart:l.colStart,rowStart:l.rowStart,colEnd:l.colEnd,rowEnd:r.rowStart-1};i&&(n&&(a.lastId=i),a.uuid=P.uuidV4());const c={...l,colStart:l.colStart,rowStart:r.rowStart,colEnd:l.colEnd,rowEnd:l.rowEnd};i&&(n&&(c.lastId=i),c.uuid=P.uuidV4());const u=c.rowStart-a.rowStart;jn[0]=a,jn[1]=c;const d=t(l,jn,ct.Row,u);d!==void 0&&(o.push(d[0]),l=d[1])}if(l.rowEnd>r.rowEnd){const a={...l,colStart:l.colStart,rowStart:l.rowStart,colEnd:l.colEnd,rowEnd:r.rowEnd};i&&(n&&(a.lastId=i),a.uuid=P.uuidV4());const c={...l,colStart:l.colStart,rowStart:r.rowEnd+1,colEnd:l.colEnd,rowEnd:l.rowEnd};i&&(n&&(c.lastId=i),c.uuid=P.uuidV4());const u=c.rowStart-a.rowStart;jn[0]=a,jn[1]=c;const d=t(l,jn,ct.Row,u);d!==void 0&&(o.push(d[1]),l=d[0])}if(l.colStart<r.colStart){const a={...l,colStart:l.colStart,rowStart:l.rowStart,colEnd:r.colStart-1,rowEnd:l.rowEnd};i&&(n&&(a.lastId=i),a.uuid=P.uuidV4());const c={...l,colStart:r.colStart,rowStart:l.rowStart,colEnd:l.colEnd,rowEnd:l.rowEnd};i&&(n&&(c.lastId=i),c.uuid=P.uuidV4());const u=c.colStart-a.colStart;jn[0]=a,jn[1]=c;const d=t(l,jn,ct.Column,u);d!==void 0&&(o.push(d[0]),l=d[1])}if(l.colEnd>r.colEnd){const a={...l,colStart:l.colStart,rowStart:l.rowStart,colEnd:r.colEnd,rowEnd:l.rowEnd};i&&(n&&(a.lastId=i),a.uuid=P.uuidV4());const c={...l,colStart:r.colEnd+1,rowStart:l.rowStart,colEnd:l.colEnd,rowEnd:l.rowEnd};i&&(n&&(c.lastId=i),c.uuid=P.uuidV4());const u=c.colStart-a.colStart;jn[0]=a,jn[1]=c;const d=t(l,jn,ct.Column,u);d!==void 0&&(o.push(d[1]),l=d[0])}return l===s&&(l={...s}),o.push(l),o}function $1(s){return s.value===null?null:s}function Sr(s,e=ct.Column,t=2,n,r){let o=[...s];if(t<=0||s.length<=1)return o;let i=e===ct.Column,l=0,a=!1;do{const c=o.sort(q.createRangeComparator(i?ct.Row:ct.Column));o=[],a=!1,o.push(c[0]);for(let u=1;u<c.length;u++){const d=c[u],h=o[o.length-1];let f=!1;if(f=i?h&&h.rowStart===d.rowStart&&h.rowEnd===d.rowEnd&&h.colEnd+1===d.colStart:h&&h.colStart===d.colStart&&h.colEnd===d.colEnd&&h.rowEnd+1===d.rowStart,f){let g={...h,colEnd:i?d.colEnd:h.colEnd,rowEnd:i?h.rowEnd:d.rowEnd};if(n){const m=r??[null,null];m[0]=h,m[1]=d,g=n(m,g,e)}if(g){o[o.length-1]=g,a=!0;continue}}o.push(d)}l++,i=!i}while(l<t&&a&&o.length>1);return o}const cd=(s,e=2,t=ct.Row,n,r,o)=>{if(s.length<=1)return[...s];let i=[];const l=t===ct.Column,a=new Oi.IteratorInstance(s,{orientation:l?ct.Row:ct.Column});let c=a.next();for(;!c.done;){const u=c.value;c=a.next();const d=u.range;if(e>0){const h=i[i.length-1];let f=!1;if(f=l?h&&h.rowStart===d.rowStart&&h.rowEnd===d.rowEnd&&h.colEnd+1===d.colStart:h&&h.colStart===d.colStart&&h.colEnd===d.colEnd&&h.rowEnd+1===d.rowStart,f){let g={...h,colEnd:l?d.colEnd:h.colEnd,rowEnd:l?h.rowEnd:d.rowEnd};if(g){i[i.length-1]=g;continue}}}i.push(d)}return e>1&&(i=Sr(i,l?ct.Row:ct.Column,e,n,o)),i};function ta(s,e,t,n){const r=s.value;if(r?.getSplit){const o=r.getSplit(e,t,n);if(o===void 0)return;e[0].value=o[0],e[1].value=o[1]}return e}function nf(s,e,t){const n=s[0].value,r=s[1].value;if(n?.getMerged&&r){const o=n.getMerged(s[1].value,q.sanitizeRange(e),t);if(o===void 0)return;e.value=o}return e}const V1=(s,e,t=rs.Both)=>{const n=i=>i?s.rowStart>e.rowStart&&s.rowStart<=e.rowEnd||s.rowEnd<e.rowEnd&&s.rowEnd>=e.rowStart:s.colStart>e.colStart&&s.colStart<=e.colEnd||s.colEnd<e.colEnd&&s.colEnd>=e.colStart;let r=t===rs.Column,o=t===rs.Row;return t===rs.Both&&(r=o=!0),!(!r||!n(!0))||!(!o||!n(!1))};function rf(s,e,t,n,r,o,i){const l=t.orientation===ct.Column,a=t.intersect,c=(u,d)=>{let h=u.value,f=null,g=d.after;if(i){let m=null,p=0,S=0;if(l&&a.colStart>u.colStart?(m={...u,colEnd:a.colStart-1},S=d.amount):!l&&a.rowStart>u.rowStart&&(m={...u,rowEnd:a.rowStart-1},p=d.amount),m){const w=Cs(s,m,r);if(w.length>1)for(let b=0;b<w.length;b++){let C=w[b];q.isEqualRanges(C,m)?(f=f??[],f.push(C)):(g=C,h=C.value,d={...d,after:{...C,colStart:C.colStart+S,rowStart:C.rowStart+p,colEnd:C.colEnd+S,rowEnd:C.rowEnd+p,uuid:P.uuidV4()},before:C,intersect:m,isSplit:!0})}}}if(n?g=n(d.before,d.after,d):h&&h.getShifted?g=h.getShifted(d):d.after&&(g={...d.after,value:u.value}),g!==void 0)return o&&(g!==d.after&&(d={...d,after:g}),o(d)),g=(m=>{if(!m){const p=s.value;return p.onRemove&&p.onRemove(q.sanitizeRange(t.before)),null}return m})(g),g&&(f=f??[],f.push(g)),f};if(t.isSplit){let u;u=l?{...s,rowStart:Math.max(a.rowStart,t.before.rowStart),rowEnd:Math.min(a.rowEnd,t.before.rowEnd)}:{...s,colStart:Math.max(a.colStart,t.before.colStart),colEnd:Math.min(a.colEnd,t.before.colEnd)};const d=Cs(s,u,r),h=[];for(let f=0;f<d.length;f++){const g=d[f];if(q.isEqualRanges(g,u)){let m=null;e&&(m=l?{colStart:e.colStart,rowStart:u.rowStart,colEnd:e.colEnd,rowEnd:u.rowEnd,value:g.value}:{colStart:u.colStart,rowStart:e.rowStart,colEnd:u.colEnd,rowEnd:e.rowEnd,value:g.value});const p=c(g,{...t,before:g,after:m});if(p)for(let S=0;S<p.length;S++)h.push(p[S])}else h.push(g)}return h}return c(s,t)}const W1=(s,e,t,n,r,o,i)=>{const l=t.colEnd-t.colStart+1,a=t.rowEnd-t.rowStart+1,c=t.colStart-e.colStart,u=t.rowStart-e.rowStart,d=n?.transpose??!1;let h=1,f=1;d?(h=e.rowEnd-e.rowStart+1,f=e.colEnd-e.colStart+1):(h=e.colEnd-e.colStart+1,f=e.rowEnd-e.rowStart+1);const g=Math.ceil(l/h),m=Math.ceil(a/f),p=r??[],S=o??P.EmptyArray,w=t.colEnd,b=t.rowEnd;return s.visitRanges(e,C=>{let _=C.value;if(!_.copyTo)return;let y=C;if(!q.isRangeWithinRange(y,e)){const N=Cs(y,e,i);y=N[N.length-1]}_=y.value;let v=y.colEnd-y.colStart+1,x=y.rowEnd-y.rowStart+1,E=c+y.colStart,R=u+y.rowStart;if(d){E=y.rowStart-e.rowStart+t.colStart,R=y.colStart-e.colStart+t.rowStart;const N=v;v=x,x=N}let I=g,A=m;const T=l<=I*v,O=a<=A*x;if(T||O){const N=_?.canTile?.({colStart:E,rowStart:R,colEnd:Math.min(E+(T?l:v)-1,w),rowEnd:Math.min(R+(O?a:x)-1,b)},n);!T||N!==!0&&N!==ct.Column||(v=l,I=1),!O||N!==!0&&N!==ct.Row||(x=a,A=1)}for(let N=0;N<I;N++){const D=E+N*h;for(let F=0;F<A;F++){const k=R+F*f,L=Math.min(D+v-1,w),W=Math.min(k+x-1,b),$={colStart:D,rowStart:k,colEnd:L,rowEnd:W};if(D>L||k>W)continue;const J=_.copyTo($,n);J&&p.push({...$,value:J})}}},Lt.Right),{inserts:p,removes:S}},jn=[null,null],j1={colStart:0,rowStart:0,colEnd:0,rowEnd:0},zn=(s=Number.MIN_SAFE_INTEGER,e=Number.MIN_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,r,o,i)=>{if(o&&(s!==Number.MIN_SAFE_INTEGER&&s<o.colStart||e!==Number.MIN_SAFE_INTEGER&&e<o.rowStart||t!==Number.MAX_SAFE_INTEGER&&t>o.colEnd||n!==Number.MAX_SAFE_INTEGER&&n>o.rowEnd))throw new Tt;return i&&(s=Math.max(i.colStart,s),e=Math.max(i.rowStart,e),t=Math.min(i.colEnd,t),n=Math.min(i.rowEnd,n),t<s||n<e)?null:(Gs.majorStart=r?s:e,Gs.majorEnd=r?t:n,Gs.minorStart=r?e:s,Gs.minorEnd=r?n:t,Gs)},Di=(s,e,t)=>{const n={colStart:0,rowStart:0,colEnd:0,rowEnd:0};return n.colStart=e?s.majorStart:s.minorStart,n.rowStart=e?s.minorStart:s.majorStart,n.colEnd=e?s.majorEnd:s.minorEnd,n.rowEnd=e?s.minorEnd:s.majorEnd,n},Gs={majorStart:0,majorEnd:0,minorStart:0,minorEnd:0},of=(s,e)=>s[0]-e[0];class q0{constructor(e,t){this._isColumn=!0,this._isReverse=!1,this._skipMajors=!1,this._majorMin=Number.MAX_SAFE_INTEGER,this._majorMax=Number.MIN_SAFE_INTEGER,this._minorMin=Number.MAX_SAFE_INTEGER,this._minorMax=Number.MIN_SAFE_INTEGER,this._majorIndex=Number.MIN_SAFE_INTEGER,this._minorIndex=Number.MIN_SAFE_INTEGER,this._delegateMajorIndex=Number.MIN_SAFE_INTEGER,this._delegateMinorIndex=Number.MIN_SAFE_INTEGER,this._delegate=e;const n=(t.orientation??ct.Column)===ct.Column;this._isColumn=n,this._isReverse=t.reverse??!1,this._skipMajors=t.skipMajors??!1;const r=t.bounds,o=r.colStart,i=r.rowStart,l=r.colEnd,a=r.rowEnd;this._majorMin=n?o:i,this._majorMax=n?l:a,this._minorMin=n?i:o,this._minorMax=n?a:l,this._processMajorSkip=n?t.processColumnSkip:t.processRowSkip,this._processMinorSkip=n?t.processRowSkip:t.processColumnSkip;const c=e.next();this._delegateResult=c,this._initialize()}_initialize(){const e=this._isColumn,t=this._isReverse,n=t?-1:1;let r=t?this._majorMax:this._majorMin,o=(t?this._minorMax:this._minorMin)-n;const i=this._processMinorSkip;i&&(o=i(o,t));const l=this._processMajorSkip;l&&(r=l(r,t)),this._majorIndex=r,this._minorIndex=o;const a=this._delegateResult;if(a.done)this._delegateMajorIndex=this._majorMax,this._delegateMinorIndex=this._minorMax+n;else{const c=a.value[0];this._delegateMajorIndex=e?c.colIndex:c.rowIndex,this._delegateMinorIndex=e?c.rowIndex:c.colIndex}}next(e){e!==void 0&&(this._delegateResult=this._delegate.next(e),this._initialize());const t=this._isReverse,n=this._isColumn,r=this._majorMin,o=this._majorMax;let i=this._majorIndex,l=this._minorIndex;if(i>o||i<r)return xt;let a=this._delegateMajorIndex,c=this._delegateMinorIndex,u=this._delegateResult.done;if(i===a&&l===c){const f=this._delegate.next();if(this._delegateResult=f,u=f.done,u)a=t?r:o,a=t?this._minorMin:this._minorMax;else{const g=f.value[0];a=n?g.colIndex:g.rowIndex,c=n?g.rowIndex:g.colIndex}this._delegateMajorIndex=a,this._delegateMinorIndex=c}const d=t?-1:1;if(this._minorIndex=l+=d,i===a&&l===c&&!u)return this._delegateResult;const h=this._processMinorSkip;if(h&&(l=h(l,t)),l>this._minorMax||l<this._minorMin){i+=d;const f=this._processMajorSkip;f&&(i=f(i,t)),this._skipMajors&&(!t&&i<a||t&&i>a)&&(i=a),this._majorIndex=i,l=t?this._minorMax:this._minorMin}return this._minorIndex=l,i===a&&l===c&&!u?this._delegateResult:i>o||i<r?xt:{done:!1,value:[{colIndex:n?i:l,rowIndex:n?l:i}]}}return(e){return null}throw(e){return null}[Symbol.iterator](){return this}}let ud=class{constructor(e){this._isColumn=!0,this._majorSize=Number.MAX_SAFE_INTEGER,this._minorSize=Number.MAX_SAFE_INTEGER,this._majorMin=Number.MAX_SAFE_INTEGER,this._majorMax=Number.MIN_SAFE_INTEGER,this._minorMin=Number.MAX_SAFE_INTEGER,this._minorMax=Number.MIN_SAFE_INTEGER,this._majorIndex=Number.MAX_SAFE_INTEGER,this._minorIndex=Number.MAX_SAFE_INTEGER,this._minorOffset=0,this._minorRepeat=0,this._majorOffset=-1,this._majorRepeat=1,this._pattern=[];const t=e.delegate;this._delegate=t;const n=(e.orientation??ct.Column)===ct.Column;this._isColumn=n;const r=e.dims,o=e.bounds,i=o.colStart,l=o.rowStart,a=o.colEnd,c=o.rowEnd;if(this._majorSize=1+(n?a-i:c-l),this._minorSize=1+(n?c-l:a-i),this._majorMin=n?i:l,this._minorMin=n?l:i,this._majorMax=(n?i+r.major:l+r.major)-1,this._minorMax=(n?l+r.minor:i+r.minor)-1,this._majorSize>this._majorMax+1||this._minorSize>this._minorMax+1)throw new Error("The dimensions must be larger than the bounds.");const u=t.next();this._nextDelegateResult=u,this._initialize()}_initialize(){const e=this._isColumn,t=this._nextDelegateResult;if(t.done)this._nextResult=xt;else{const n=t.value[0],r=e?n.colIndex:n.rowIndex,o=e?n.rowIndex:n.colIndex,i=[[o,t.value[1]]];this._minorSpan=i,this._majorIndex=r,this._minorIndex=o,this._pattern.push([r,i]),this._nextResult=t}}next(e){if(e!==void 0)throw new Ip;const t=this._nextResult,n=this._isColumn;let r=this._majorIndex,o=this._nextDelegateResult;if(!o.done){const c=o.value[0];if((n?c.colIndex:c.rowIndex)===r&&(o=this._delegate.next(),this._nextDelegateResult=o,!o.done)){const u=o.value,d=u[0],h=n?d.colIndex:d.rowIndex,f=n?d.rowIndex:d.colIndex;if(h===r)return this._minorSpan.push([f,u[1]]),this._minorOffset=this._minorSpan.length-1,this._minorIndex=f,this._nextResult=o,t}}const i=this._minorMax;let l=this._minorIndex;if(l<i){let c=this._minorOffset;c++;const u=this._minorSpan;c>=u.length&&(c=0,this._minorRepeat++);const d=u[c],h=this._minorMin;if(l=h+(d[0]-h+this._minorSize*this._minorRepeat),this._minorIndex=l,this._minorOffset=c,l<=i){const f=[{colIndex:n?r:l,rowIndex:n?l:r},d[1]];return this._nextResult={done:!1,value:f},t}}if(!o.done){const c=o.value,u=c[0],d=n?u.colIndex:u.rowIndex,h=n?u.rowIndex:u.colIndex,f=[[h,c[1]]];return this._pattern.push([d,f]),this._majorIndex=d,this._minorSpan=f,this._minorOffset=0,this._minorIndex=h,this._minorRepeat=0,this._nextResult=o,t}const a=this._majorMax;if(r<a){let c=this._majorOffset;c++;const u=this._pattern;c>=u.length&&(c=0,this._majorRepeat++);const d=u[c],h=d[1],f=h[0],g=this._majorMin;if(r=g+(d[0]-g+this._majorSize*this._majorRepeat),this._majorIndex=r,this._majorOffset=c,r<=a){this._minorSpan=h,this._minorOffset=0,l=f[0],this._minorIndex=l,this._minorRepeat=0;const m=[{colIndex:n?r:l,rowIndex:n?l:r},f[1]];return this._nextResult={done:!1,value:m},t}}return t.done||(this._nextResult=xt),t}return(e){return null}throw(e){return null}[Symbol.iterator](){return this}};class sf{constructor(e,t,n){this._comparator=e?.comparator??q.createCellComparator(e.orientation??ct.Column,e.reverse??!1),this._iterator1=t,this._iterator2=n;const r=t.next();this._nextResult1=r;const o=n.next();this._nextResult2=o,e?.reuseResult&&(e.reuseResult===!0?this._reuseResult={done:!1,value:[void 0,void 0,void 0,void 0]}:this._reuseResult=e.reuseResult)}next(e){let t=this._nextResult1,n=this._nextResult2;if(t.done&&n.done)return t;if(t.done){const l=n;this._nextResult2=this._iterator2.next();const a=this._reuseResult??{done:!1,value:[void 0,void 0,void 0,void 0]};a.done=!1;const c=a.value,u=l.value;return c[2]=u[0],c[3]=u[1],c[0]=void 0,c[1]=void 0,a}if(n.done){const l=t;this._nextResult1=this._iterator1.next();const a=this._reuseResult??{done:!1,value:[void 0,void 0,void 0,void 0]};a.done=!1;const c=a.value,u=l.value;return c[0]=u[0],c[1]=u[1],c[2]=void 0,c[3]=void 0,a}let r=(0,this._comparator)(t.value[0],n.value[0]);if(r<0){const l=t;this._nextResult1=this._iterator1.next();const a=this._reuseResult??{done:!1,value:[void 0,void 0,void 0,void 0]};a.done=!1;const c=a.value,u=l.value;return c[0]=u[0],c[1]=u[1],c[2]=void 0,c[3]=void 0,a}if(r>0){const l=n;this._nextResult2=this._iterator2.next();const a=this._reuseResult??{done:!1,value:[void 0,void 0,void 0,void 0]};a.done=!1;const c=a.value,u=l.value;return c[2]=u[0],c[3]=u[1],c[0]=void 0,c[1]=void 0,a}this._nextResult1=this._iterator1.next(),this._nextResult2=this._iterator2.next();const o=this._reuseResult??{done:!1,value:[void 0,void 0,void 0,void 0]};o.done=!1;const i=o.value;return i[0]=t.value[0],i[1]=t.value[1],i[2]=n.value[0],i[3]=n.value[1],o}return(e){return null}throw(e){return null}[Symbol.iterator](){return this}}const lf="Must be an array of arrays.",na=(s,e,t)=>{const n=e.majorStart,r=e.minorStart,o=e.majorEnd,i=[],l=e.minorEnd-r+1,a=typeof s=="function";for(let c=n;c<=o;c++){const u=new Array(l);if(a)if(t){let h=r;for(let f=0;f<l;f++)u[f]=s(h++,c)}else{let h=r;for(let f=0;f<l;f++)u[f]=s(c,h++)}else u.fill(s,0,l);const d=[[r,u]];i.push([c,d])}return{tuples:i,bounds:e}},Ia=(s,e=!1,t=null,n=!1)=>{let r=0,o=0,i=Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER;if(t&&(r=t.majorStart??0,o=t.minorStart??0,i=(t.majorEnd??Number.MAX_SAFE_INTEGER)-r+1,l=(t.minorEnd??Number.MAX_SAFE_INTEGER)-o+1),e){const c=r;r=o,o=c;const u=i;i=l,l=u}if(!Array.isArray(s))throw new Error(lf);if(s.length>i)throw new Tt;const a=e?new Mt.TransposedBuilder:new Mt.Builder;for(let c=0;c<s.length;c++){let u=s[c];if(u!=null&&u.length!==0){if(!Array.isArray(u))throw new Error(lf);if(u.length>l)throw new Tt;if(n){let d=-1;for(let h=0;h<u.length;h++)u[h]==null?d!==-1&&(a.addValues(c+r,o+d,u.slice(d,h)),d=-1):d===-1&&(d=h);d!==-1&&a.addValues(c+r,o+d,u.slice(d))}else a.addValues(c+r,o,u)}}return a.build()},G1=(s,e,t)=>{if(s===e)return e},U1=(s,e,t)=>{if(s[0].value===s[1].value)return e},q1=[null,null],oo=(s=!0,e=G1)=>{const t=[];let n,r,o=Number.MIN_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER;return{append:(l,a,c)=>{let u=!0;if(c!==void 0){const f=r===void 0?c:e(r,c,s);f===void 0?u=!1:c=f}if(u&&a===i+1&&l===o)return s?n.rowEnd=a:n.colEnd=a,i=a,void(r=c);n&&t.push(n);const d=s?l:a,h=s?a:l;n={colStart:d,rowStart:h,colEnd:d,rowEnd:h,value:c},o=l,i=a,r=c},done:(l=!1)=>(n&&(t.push(n),n=null),l?Sr(t,s?ct.Column:ct.Row,2,U1,q1):t)}};let Io=class dd{constructor(e){this._major=null,this._dataCoords=null,this._count=0,this._isColumn=!0,this._lastMajor=Number.MIN_SAFE_INTEGER,this._lastMinorSpan=null,this._maxCoords=null,this._isShared=!1,this._options={orientation:ct.Row,...e},this._isColumn=(e?.orientation??ct.Column)===ct.Column,e?.maxCoords&&(this._maxCoords=Object.freeze({colStart:Math.max(0,e.maxCoords.colStart??0),rowStart:Math.max(0,e.maxCoords.rowStart??0),colEnd:Math.min(Number.MAX_SAFE_INTEGER,e.maxCoords.colEnd??Number.MAX_SAFE_INTEGER),rowEnd:Math.min(Number.MAX_SAFE_INTEGER,e.maxCoords.rowEnd??Number.MAX_SAFE_INTEGER)})),this._createRun=e?.createRun??(t=>new Qn(t)),this._optionsMinor={},this._major=new xi({nodeSize:J1})}getRuns(e){const t=this._isColumn,n=this._maxCoords,r=this.getCoords();if(!r)return Qt;const o=e?.bounds;let i,l;if(o){const p=zn(o?.colStart??Number.MIN_SAFE_INTEGER,o?.rowStart??Number.MIN_SAFE_INTEGER,o?.colEnd??Number.MAX_SAFE_INTEGER,o?.rowEnd??Number.MAX_SAFE_INTEGER,t,n,r);if(!p)return Qt;i={bounds:{min:p.majorStart,max:p.majorEnd}},l={bounds:{min:p.minorStart,max:p.minorEnd}}}const a=this._major.entries(i);let c=a.next();if(c.done)return Qt;let u=c.value[0],d=c.value[1],h=d.runs(l),f=h.next();if(f.done)return Qt;let g=f.value[0].min,m=f.value[1];return{[Symbol.iterator](){return this},next(){if(c.done)return xt;const p={done:!1,value:[u,g,m]};for(f=h.next();f.done&&!c.done;)c=a.next(),c.done||(u=c.value[0],d=c.value[1],h=d.runs(l),f=h.next());return f.done||(g=f.value[0].min,m=f.value[1]),p}}}getOrientation(){return this._isColumn?ct.Column:ct.Row}entries(e){const t=this._isColumn;let n=t,r=!0;const o=this._maxCoords,i=this.getCoords(),l=zn(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,t,o,i);if(!l)return Qt;let a,c,u,d=l.majorStart,h=l.majorEnd,f=l.minorStart,g=l.minorEnd,m=!1;if(e){e?.orientation&&(n=e?.orientation===ct.Column,r=t===n);const _=e?.bounds;if(_){const y=zn(_.colStart,_.rowStart,_.colEnd,_.rowEnd,t,o,i);if(!y)return Qt;d=y.majorStart,h=y.majorEnd,f=y.minorStart,g=y.minorEnd}m=e.reverse??!1,u=(y=>typeof y!="boolean"?y:y===!0?{done:!1,value:[{colIndex:-1,rowIndex:-1},null]}:void 0)(e.reuseResult),a=t?e.processColumnSkip:e.processRowSkip,a&&(m?h=a(h,m):d=a(d,m)),c=t?e.processRowSkip:e.processColumnSkip,c&&(m?g=c(h,m):f=c(f,m))}if(!i)return Qt;r||d!==h||(r=!0),Ht.bounds.min=d,Ht.bounds.max=h,Ht.reverse=m,Ht.processSkip=a,Ht.reuseResult=mi;let p=this._major.entries(Ht),S=af();const w=_=>{if(!_.nextActive)return;const y=E=>{const R=_.nextMinorIndex,I=_.nextMinorValue,A=_.nextActive;return E?(_.nextMinorIndex=E[0],_.nextMinorValue=E[1],_.nextActive=!0):(_.nextActive=!1,_.nextMinorIndex=m?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,_.nextMinorValue=null),_.value=I,_.minorIndex=R,_.active=A,Gr[0]=_.majorIndex,Gr[1]=R,Gr[2]=I,Gr},v=_.minorIterator;if(!v)return y();const x=v.next();return x.done&&(_.minorIterator=null),y(x.value)},b=_=>{if(p)for(;;){const y=p.next();if(y.done)return void(p=void 0);const v=y.value,x=v[1];x||console.warn("issue",x),_.majorIndex=v[0],_.active=!0,_.nextActive=!1,Gn.bounds.min=f,Gn.bounds.max=g,Gn.reverse=m,Gn.processSkip=c,Gn.reuseResult=J0;const E=x.entries(Gn),R=E.next();if(!R.done){const I=R.value;return _.nextMinorIndex=I[0],_.nextMinorValue=I[1],_.minorIterator=E,_.nextActive=!0,w(_)}}};let C=null;if(r)C=()=>{let _;return _=w(S),_||(_=b(S),_||void 0)};else{const _=m?g:f,y=m?f:g;let v,x=_,E=y,R=!0;const I=()=>{if(S.nextMajorCursor)return S=S.nextMajorCursor,S;S=v,(x<f||x>g||x===E)&&(S=null),x=E,E=y};C=()=>{for(;S;){let A=null;if(R){let T=v?af():S;if(A=b(T),A){v?(T.prevMajorCursor=S,S.nextMajorCursor=T,S=T):v=S,E=m?Math.max(E,S.nextMinorIndex):Math.min(E,S.nextMinorIndex);const O=S.minorIndex;O!==_&&(E=m?Math.max(E,O):Math.min(E,O),A=null)}else R=!1,I()}else{const T=S.minorIndex,O=S.nextMinorIndex;T===x?(Gr[0]=S.majorIndex,Gr[1]=T,Gr[2]=S.value,A=Gr):!m&&T>x||m&&T<x?E=m?Math.max(E,T):Math.min(E,T):!m&&O>x||m&&O<x?E=m?Math.max(E,O):Math.min(E,O):A=w(S),S.active&&(E=m?Math.max(E,S.nextMinorIndex):Math.min(E,S.nextMinorIndex)),y===x||S.active||(S.prevMajorCursor?S.prevMajorCursor.nextMajorCursor=S.nextMajorCursor:v=S.nextMajorCursor,S.nextMajorCursor&&(S.nextMajorCursor.prevMajorCursor=S.prevMajorCursor)),I()}if(A)return A}}}return{next(_){if(_)throw new Ip("Iterator with next argument is not supported.");const y=C();return y?((v,x,E,R,I)=>{const A=I??{done:!1,value:[{colIndex:-1,rowIndex:-1},null]},T=A.value,O=T[0];return O.colIndex=R?v:x,O.rowIndex=R?x:v,T[1]=E,A})(y[0],y[1],y[2],t,u):xt},[Symbol.iterator](){return this},return:_=>null,throw:_=>null}}values(e){const t=this.entries(e);let n;return e?.reuseResult&&(n=e.reuseResult===!0?{done:!1,value:null}:e.reuseResult),{next(r){const o=t.next(r);return o.done?xt:n?(n.value=o.value[1],n):{done:!1,value:o.value[1]}},[Symbol.iterator](){return this},return:r=>null,throw:r=>null}}keys(e){const t=this.entries(e);let n;return e?.reuseResult&&(n=e.reuseResult===!0?{done:!1,value:null}:e.reuseResult),{next(r){const o=t.next(r);return o.done?xt:n?(n.value=o.value[0],n):{done:!1,value:o.value[0]}},[Symbol.iterator](){return this},return:r=>null,throw:r=>null}}_updateMajorSpan(e,t=!1){if(!e||e.length===0)return;t&&e.sort((a,c)=>a[0]-c[0]);const n=this._major,r=e[0];let o=r[0],i=o,l=[r[1]];for(let a=1;a<e.length;a++){const c=e[a],u=c[0],d=c[1];u===i+1?l.push(d):(n.setRunAt(o,new Qn(l)),o=u,l=[d]),i=u}l.length>0&&n.setRunAt(o,new Qn(l))}setValues(e){if(!e)throw new lr;if(e.length===0)return this;const t=(e=e.sort(of))[0][0],n=e[e.length-1][0];let r=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER;const i=this._isColumn,l=this._maxCoords;if(l){const _=i?l.colStart:l.rowStart,y=i?l.colEnd:l.rowEnd;if(t<_||n>y)throw new Tt;r=i?l.rowStart:l.colStart,o=i?l.rowEnd:l.colEnd}if(!e||e.length===0)return this;let a=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,u=0,d=t-1;const h=[],f=(_,y,v)=>{if(d===v)throw new Mt.OutOfOrderError(`Duplicate major Indices: {${v}}.`);d=v,y=y.sort(of),_=_.clone();let x=Number.MIN_SAFE_INTEGER;const E=y.length;for(let R=0;R<E;R++){const I=y[R],A=I[0],T=I[1],O=A+T.length-1;if(x>=A)throw new Mt.OutOfOrderError(`Overlapping minor Indices: {${v}, ${A}}.`);if(A<r||O>o)throw new Tt;if(T&&T.length>0){const N=_.getCount();_.setRunAt(A,g(T));const D=_.getCount();u+=D-N,a=Math.min(a,_.getCoords().min),c=Math.max(c,_.getCoords().max)}x=O}p++,h.push([v,_])},g=this._createRun,m=this._optionsMinor;let p=0;const S=()=>{const _=e[p],y=_[0],v=_[1],x=new xi(m);f(x,v,y)},w=this._major;Ht.bounds.min=t,Ht.bounds.max=n,Ht.reverse=!1,Ht.processSkip=null,Ht.reuseResult=mi;const b=w.entries(Ht);let C=b.next();for(;!C.done;){const _=C.value,y=_[0];let v=e[p],x=v[0];if(x>y)C=b.next();else{for(;x<y;)S(),v=e[p],x=v[0];if(x===y){const E=v[1],R=_[1];f(R,E,y)}C=b.next()}}for(;e[p];)S();return this._updateMajorSpan(h),this._updateCountAndCoords(u,t,a,n,c),this}_updateCountAndCoords(e,t,n,r,o,i=!1){const l=this._count+e;if(this._count=l,this._lastMajor=Number.MIN_SAFE_INTEGER,!this._dataCoords)return;const a=this._isColumn;let c=a?t:n,u=a?n:t,d=a?r:o,h=a?o:r;if(l===0)this._dataCoords=null;else{const f=this._dataCoords;f&&(c=(i?Math.max:Math.min)(c,f.colStart),u=(i?Math.max:Math.min)(u,f.rowStart),d=(i?Math.min:Math.max)(d,f.colEnd),h=(i?Math.min:Math.max)(h,f.rowEnd));const g={colStart:c,rowStart:u,colEnd:d,rowEnd:h};this._dataCoords=g}}clear(){this._major.clear(),this._dataCoords=null,this._count=0}delete(e){const t=this._count;if(!e)return this.clear(),t>0;const n=this._isColumn,r=this._maxCoords,o=this.getCoords(),i=zn(e.colStart,e.rowStart,e.colEnd,e.rowEnd,n,r,o);if(!i||t===0)return!1;if(q.isRangeWithinRange(o,e))return this.clear(),t>0;const l=i.majorStart,a=i.majorEnd,c=i.minorStart,u=i.minorEnd;let d=n?o.colStart:o.rowStart,h=n?o.colEnd:o.rowEnd;const f=n?o.rowStart:o.colStart,g=n?o.rowEnd:o.colEnd;let m=!1,p=0;const S=this._major;if(c<=f&&u>=g){Ht.bounds.min=l,Ht.bounds.max=a;const x=S.entries(Ht);let E=x.next();for(;!E.done;)p-=E.value[1].getCount(),E=x.next();return S.delete(l,a-l+1),this._count+=p,this._dataCoords=null,p!==0}const w=[],b=this._isShared,C=[];Ht.bounds.min=l,Ht.bounds.max=a,Gn.reverse=!1,Gn.processSkip=null,Gn.reuseResult=mi;const _=S.entries(Ht);let y=_.next();for(;!y.done;){const x=y.value,E=x[0];let R=x[1];const I=R.getCoords(),A=I.min,T=I.max;if(c<=A&&u>=A||c<=T&&c<=T)if((A===f&&c<=f||T===g&&u>=g)&&(m=!0),A>=c&&T<=u)w.push(E),p-=R.getCount();else{const O=R.getCount();b&&(R=R.clone(),C.push([E,R])),R.delete(c,u-c+1),p+=R.getCount()-O}y=_.next()}this._updateMajorSpan(C);const v=w.length;if(v>0){const x=Og(w,!0);for(let R=0;R<x.length;R++){const I=x[R];S.delete(I.min,I.max-I.min+1)}const E=S.getCoords();if(!E)return this.clear(),!0;d=E.min,h=E.max}return m?(this._count+=p,this._dataCoords=null,!0):v===0?(this._count+=p,p!==0):(this._updateCountAndCoords(p,d,f,h,g,!0),p!==0)}shift(e,t){if(!e||!t)throw new lr;const n=this._isColumn,r=this._maxCoords,o=t===Lt.Right||t===Lt.Down,i=t===Lt.Left||t===Lt.Right,l=zn(e.colStart,e.rowStart,e.colEnd,e.rowEnd,n,r,e);if(!l)return!1;const a=l.majorStart,c=l.majorEnd,u=l.minorStart,d=l.minorEnd,h=this.getCoords();if(!h)return!1;const f=n?h.colStart:h.rowStart,g=n?h.colEnd:h.rowEnd,m=n?h.rowStart:h.colStart,p=n?h.rowEnd:h.colEnd,S=u<=m&&d>=p,w=n===i;if((w&&S||!w&&a<=f&&c>=g)&&!zn(h.colStart,h.rowStart,h.colEnd+(o&&i?e.colEnd-e.colStart+1:0),h.rowEnd+(o&&!i?e.rowEnd-e.rowStart+1:0),n,r)||w&&a>g||!w&&u>p)return!1;let b=w?c-a+1:d-u+1;if(!o&&(b*=-1,q.isRangeWithinRange(h,e)))return this.clear(),!0;let C=0;const _=this._major,y=[];if(Ht.bounds.min=a,Ht.bounds.max=w?Number.MAX_SAFE_INTEGER:c,Gn.reverse=!o,Gn.processSkip=null,Gn.reuseResult=mi,w&&S){if(!o){Ht.bounds.max=c;const $=_.entries(Ht);let J=$.next();for(;!J.done;)C-=J.value[1].getCount(),J=$.next()}_.shift(a,b);const W=_.getCoords();return this._dataCoords=null,this._updateCountAndCoords(C,W.min,m,W.max,p),!0}let v=n?h.colStart:h.rowStart,x=n?h.colEnd:h.rowEnd,E=n?h.rowStart:h.colStart,R=n?h.rowEnd:h.colEnd;o||(E=Number.MAX_SAFE_INTEGER,R=Number.MIN_SAFE_INTEGER);let I=Number.MAX_SAFE_INTEGER;r&&(I=i?r.colEnd:r.rowEnd);const A=new Set,T=w?new Map:null,O=[],N=_.entries(Ht),D={bounds:{min:u,max:d}};let F=N.next();for(;!F.done;){const W=F.value,$=W[0],J=W[1].clone(),te=J.getCoords(),Q=te.min,G=te.max;if(w&&T.set($,J),u<=G){const ee=J.getCount();w?($>=a-b&&C1(J.runs(D),(re,U)=>{const ue=U.min,oe=U.max;let Z=re;ue-1<=d&&oe>d&&(Z=Z.slice(0,d+1-ue)),ue<u&&oe+1>=u&&(Z=Z.slice(u-ue)),O.push({majorIndex:$+b,minorIndex:Math.max(ue,u),run:Z})}),J.delete(u,d-u+1)):J.shift(u,b);const ne=J.getCount();if(ne===0)A.add($),E=Math.min(E,G),R=Math.max(R,Q);else{const re=J.getCoords();if(E=Math.min(E,re.min),R=Math.max(R,re.max),R>I)throw new Tt}C+=ne-ee,y.push([$,J])}F=N.next()}const k=this._optionsMinor;let L=!1;for(let W=0;W<O.length;W++){const $=O[W],J=$.majorIndex,te=$.run;let Q=T.get(J);Q||(Q=new xi(k),T.set(J,Q),y.push([J,Q]),L=!0),Q.setRunAt($.minorIndex,te),C+=te.length,v=Math.min(v,J),x=Math.max(x,J),A&&A.delete(J)}if(this._updateMajorSpan(y,L),A&&A.size>0){const W=Array.from(A.values()),$=Og(W);for(let te=0;te<$.length;te++){const Q=$[te];_.delete(Q.min,Q.max-Q.min+1)}const J=_.getCoords();if(!J)return this.clear(),!0;v=J.min,x=J.max}if(R!==p||E!==m)return this._count+=C,this._dataCoords=null,!0;{const W=this._count+C;this._count=W,this._dataCoords=W===0?null:Object.freeze({colStart:n?v:E,rowStart:n?E:v,colEnd:n?x:R,rowEnd:n?R:x})}return C!==0||!q.isEqualRanges(h,this.getCoords())}getCount(){return this._count}getValueAt(e,t){const n=this._isColumn,r=n?t:e,o=n?e:t,i=this._lastMajor;let l;if(i===r&&i!==Number.MIN_SAFE_INTEGER?l=this._lastMinorSpan:(l=this._major.at(r),this._lastMajor=r,this._lastMinorSpan=l),!!l)return l.at(o)}setValueAt(e,t,n){const r=this._isColumn,o=[r?t:e,[[r?e:t,[n]]]];this.setValues([o])}copyTo(e,t,n){if(this.getCount()===0)return;const r=this.getOrientation(),o=e.getOrientation(),i=this.getRuns({bounds:n});let l=i.next();const a=q.cellToRange(t);a.colEnd=n.colEnd-n.colStart+t.colIndex,a.rowEnd=n.rowEnd-n.rowStart+t.rowIndex;const c=this._isColumn,u=this._maxCoords,d=this.getCoords();let h,f=zn(n.colStart??Number.MIN_SAFE_INTEGER,n.rowStart??Number.MIN_SAFE_INTEGER,n.colEnd??Number.MAX_SAFE_INTEGER,n.rowEnd??Number.MAX_SAFE_INTEGER,c,u,d);f={...f};const g=o!==ct.Row,m=e.getMaxCoords();h=zn(a?.colStart??Number.MIN_SAFE_INTEGER,a?.rowStart??Number.MIN_SAFE_INTEGER,a?.colEnd??Number.MAX_SAFE_INTEGER,a?.rowEnd??Number.MAX_SAFE_INTEGER,g,m),h={...h};const p=h.majorStart-f.majorStart,S=h.minorStart-f.minorStart,w=r===o?new Mt.Builder:new Mt.TransposedBuilder;for(;!l.done;){const C=l.value[0];let _=l.value[1],y=l.value[2];_+y.length>f.minorEnd&&(y=y.slice(0,f.minorEnd-_+1)),_<f.minorStart&&(y=y.slice(f.minorStart-_),_=f.minorStart),w.addValues(C+p,_+S,y),l=i.next()}const b=w.build();e.delete(a),b&&e.setValues(b.tuples)}getCoords(){if(this._dataCoords)return this._dataCoords;if(this._major.getCount()===0)return null;let e=Number.MAX_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;const o=this._major.entries();let i=o.next();for(;!i.done;){const c=i.value,u=c[0];e=Math.min(u,e),t=Math.max(u,t);const d=c[1].getCoords();n=Math.min(d.min,n),r=Math.max(d.max,r),i=o.next()}const l=this._isColumn,a=Object.freeze({colStart:l?e:n,rowStart:l?n:e,colEnd:l?t:r,rowEnd:l?r:t});return this._dataCoords=a,a}clone(e){this._isShared=!0;const t=new dd(this._options);return t._isShared=!0,t._major=this._major.clone(),t._dataCoords=this._dataCoords,t._count=this._count,t}cloneEmpty(e){return new dd(this._options)}getMaxCoords(){return this._maxCoords||null}get[Symbol.toStringTag](){let e="";const t=this.getCoords();if(t){const n=t.colEnd-t.colStart+1,r=t.rowEnd-t.rowStart+1;e=`${this.getCount()}-${this._isColumn?n:r}x${this._isColumn?r:n}`}return`[SparseGrid:${e}]`}};Io||(Io={});const J1=12;Object.seal({done:!1,value:null});const Gr=[-1,-1,null],J0=Object.seal({done:!1,value:[-1,null]}),mi=Object.seal({done:!1,value:[-1,null]}),Gn={bounds:{min:-1,max:-1},reverse:!1,processSkip:null,reuseResult:J0},Ht={bounds:{min:-1,max:-1},reverse:!1,processSkip:null,reuseResult:mi},af=()=>({majorIndex:-1,minorIndex:-1,value:null,active:!1,nextMinorIndex:-1,nextActive:!1,nextMinorValue:null,minorIterator:null,nextMajorCursor:null,prevMajorCursor:null});let K1=class hd{constructor(e){if(this._l=0,this._at=null,this._dt=cf.Undefined,this._a32=null,this._a64=null,this._cv=null,this._vt=null,this._vi32=null,this._vi64=null,this._vf32=null,this._vf64=null,!e)throw new Error("options is required");const t=e.length;if(this._l=t,this._dt=e.type,this._cv=e.getCoercedValue??null,t>0){e.types&&(this._at=e.types,this._vt=new Uint8Array(this._at));const n=e.values32??null;n&&(this._a32=n,this._vi32=new Int32Array(n),this._vf32=new Float32Array(n));const r=e.values64??null;if(r&&(this._a64=r,this._vf64=new Float64Array(r),this._vi64=new BigInt64Array(r)),!n&&!r)throw new Error("values32 or values64 is required")}}getConstructorOptions(){return{length:this._l,type:this._dt,types:this._at,values32:this._a32,values64:this._a64,getCoercedValue:this._cv}}at(e){if(e>>>0>=this._l)return;const t=this._vt,n=t&&t[e]||this._dt;let r,o=!1;switch(this._vi32?r=this._vi32[e]:(o=!0,r=Number(this._vi64[e])),n){case ra:return o?Number(r):r;case Ei:return o?this._vf64[e]:this._vf32[e];case oa:return!!r;case sa:case ia:return this._cv(n,o?Number(r):r);case pi:return this._vi64[o?e:r];case Si:return this._vf64[o?e:r];case Z0:return Number.NaN;case Q0:return Number.MAX_SAFE_INTEGER;case Y0:return Number.MIN_SAFE_INTEGER;case K0:return 1/0;case X0:return-1/0;case eS:return null;case rh:case la:return}return this._cv(n,o?Number(r):r)}toArray(e){const t=[],n=Math.max(e,this._l);for(let r=0;r<n;r++)t.push(this.at(r));return t}get length(){return this._l}get[Symbol.toStringTag](){return"[MixTypedArrayList]"}toString(){const e=this._a32,t=this._a64;let n="";return e&&!t?n="32":t&&!e&&(n="64"),`{${n}${this._at?"":":SINGLE_TYPE"}}:${this._l}}`}static _createArrayBuffer(e){try{return new SharedArrayBuffer(e)}catch{}return new ArrayBuffer(e)}static fromArray(e,t,n,r,o=X1){const i=e.length;if(i===0)return new hd({type:cf.Undefined,length:i,getCoercedValue:n});let l=this._createArrayBuffer(i*Int8Array.BYTES_PER_ELEMENT),a=new Uint8Array(l),c=0,u=!1,d=uf(e[0],r);for(let y=0;y<i;y++){const v=e[y],x=uf(v,r);x!==Si&&x!==pi||c++,d!==x&&(a[y]=x,u=!0)}u||(a=null,l=null);let h,f,g,m,p,S,w,b,C=!1;c/i>o&&(C=!0,c=i),c!==0&&(g=this._createArrayBuffer(c*BigInt64Array.BYTES_PER_ELEMENT),m=new BigInt64Array(g),p=new Float64Array(g)),C?(h=m,f=p):(S=this._createArrayBuffer(i*Int32Array.BYTES_PER_ELEMENT),w=new Int32Array(S),b=new Float32Array(S),h=w,f=b);let _=d;if(C)for(let y=0;y<i;y++){const v=e[y];switch(a&&(_=a[y]||d),_){case ra:h[y]=BigInt(v);break;case oa:h[y]=BigInt(v?1:0);break;case Ei:f[y]=v;break;case pi:h[y]=v;break;case Si:f[y]=v;break;case sa:case ia:h[y]=BigInt(t?.(_,v)??0);break;default:_>127&&_<255&&(h[y]=BigInt(t?.(_,v)??0))}}else{let y=0;for(let v=0;v<i;v++){const x=e[v];switch(a&&(_=a[v]||d),_){case ra:h[v]=x;break;case oa:h[v]=x?1:0;break;case Ei:f[v]=x;break;case pi:w[v]=y,m[y]=x,y++;break;case Si:w[v]=y,p[y]=x,y++;break;case sa:case ia:h[v]=t?.(_,x)??0;break;default:_>127&&_<255&&(h[v]=t?.(_,x)??0)}}}return new hd({length:i,types:u?l:null,type:d,values32:S,values64:g,getCoercedValue:n})}};const X1=.1,ra=1,Ei=2,oa=3,pi=4,Si=5,sa=6,ia=7,K0=8,X0=9,Z0=10,Q0=11,Y0=12,eS=13,rh=14,la=127,cf={Undefined:rh},uf=(s,e)=>{switch(typeof s){case"number":const t=s;return Number.isNaN(t)?Z0:t===1/0?K0:t===-1/0?X0:Object.is(t,-0)?Ei:t===Number.MAX_SAFE_INTEGER?Q0:t===Number.MIN_SAFE_INTEGER?Y0:Number.isInteger(t)&&t<=2147483647&&t>=-2147483648?ra:Math.fround(t)===t?Ei:Si;case"string":return sa;case"boolean":return oa;case"object":if(s===null)return eS;if(s instanceof Error)return ia;if(!e)return la;const n=e(s);if(n<128||n>255)throw new Error("Custom type must be between 128 and 255");return n;case"bigint":return pi;case"undefined":return rh;case"symbol":case"function":return la}return la},wi=s=>{if(!s||s.length<=1)return!1;if(s.length===2)return q.isRangesIntersect(s[0],s[1]);const e=new yt;e.load(s);const t=s.length;for(let n=0;n<t;n++)if(e.search(s[n]).length>1)return!0;return!1},gd=(s,e,t)=>{const n=[];if(q.isRangesIntersect(s,e)){const r=P.subtractRect({top:s.rowStart,left:s.colStart,bottom:s.rowEnd+1,right:s.colEnd+1},{top:e.rowStart,left:e.colStart,bottom:e.rowEnd+1,right:e.colEnd+1},t===B.Orientation.Column),o=r.length;for(let i=0;i<o;i++){const l={colStart:r[i].left,rowStart:r[i].top,colEnd:r[i].right-1,rowEnd:r[i].bottom-1};n.push(l)}}else n.push(s);return n},df=(s,e,t)=>{if(!e||!s?.[0])return;const n=s.length;for(let r=0;r<n;r++){const o=s[r];q.intersectRanges(o,e)&&t(o,!q.isRangeWithinRange(o,e),r)}},hf=(s,e)=>{const t=s.colStart,n=s.rowStart,r=e.colStart,o=e.rowStart;return(i,l)=>{const a=i.colIndex-t,c=l.colIndex-r;return a===c?i.rowIndex-n-(l.rowIndex-o):a-c}},gf=(s,e)=>{const t=s.colStart,n=s.rowStart,r=e.colStart,o=e.rowStart;return(i,l)=>{const a=i.rowIndex-n,c=l.rowIndex-o;return a===c?i.colIndex-t-(l.colIndex-r):a-c}},fd=(s,e,t=!1,n=!1)=>{e||(e=s);let r=e.colEnd-e.colStart+1,o=e.rowEnd-e.rowStart+1;if(n){const c=r;r=o,o=c}const i={colStart:s.colStart,rowStart:s.rowStart,colEnd:s.colStart+r-1,rowEnd:s.rowStart+o-1};if(t){let c=s.colStart,u=s.rowStart;return q.isSingleCell(s)?(c+=r-1,u+=o-1):(c+=s.colEnd-s.colStart,u+=s.rowEnd-s.rowStart),i.colEnd=n?u:c,i.rowEnd=n?c:u,i}const l=s.colEnd-s.colStart+1;if(l%r!==0)return i;const a=s.rowEnd-s.rowStart+1;return a%o!==0||(i.colEnd=s.colStart+l-1,i.rowEnd=s.rowStart+a-1),i};class ru{constructor(e,t){this._l=0,e&&t>0&&(this._u=e,this._l=t)}at(e){if(e>this._l||e<0||!this._u)return;const t=Math.floor(e%this._u.length);return this._u.at(t)}toArray(e){const t=[],n=this._u,r=n.length;for(let o=0;o<e;o++){const i=Math.floor(o%r);t.push(n.at(i))}return t}get length(){return this._l}get[Symbol.toStringTag](){return"[RepeatingList]"}get isIList(){return!0}}class Sn{constructor(e,t,n=null,r=!1){this._isLiteral=!1,this._values=e,this._coords=t,this._type=n,this._isLiteral=r}getValueAt(e,t,n){const r=this._coords;if(!r)return;let o=this._values.getValueAt(e+r.rowStart,t+r.colStart)??null;o===void 0&&(o=null);const i=n?.type,l=i!==void 0?i:this._type;return l&&(o=sr(o,yn(o,!0),l)),o}_applyBuilder(e,t,n=!1){if(!t)return e;const r=t.build();return r&&(n&&(e=e.clone()),e.setValues(r.tuples)),e}_cloneFromBuilder(e,t,n,r){if(!e)return this;const o=e.build();if(!o)return this;let i=this._values;const l=i.getOrientation(),a=(t?.orientation??l)===B.Orientation.Column,c=Di(o.bounds,a),u=this._coords??q.EmptyRange,d=Math.max(c.colEnd-c.colStart+1,n??u.colEnd-u.colStart+1),h=Math.max(c.rowEnd-c.rowStart+1,r??u.rowEnd-u.rowStart+1),f=u.colStart,g=u.rowStart,m=f+d-1,p=g+h-1;return i=i.clone(),i.setValues(o.tuples),new Sn(i,{colStart:f,rowStart:g,colEnd:m,rowEnd:p},this._type,this._isLiteral)}forEach(e,t){if(!e)return;const n=this.entries(t);let r=n.next();for(;!r.done;){const o=r.value,i=e(o.value,o.coords,this);if(i)return i.break;r=n.next()}}reduce(e,t,n){if(!e)return t;const r=this.entries(n);let o=r.next(),i=t;for(;!o.done;){const l=o.value;i=e(i,l.value,l.coords,this),o=r.next()}return i}some(e,t){if(!e)return!1;const n=this.entries(t);let r=n.next();for(;!r.done;){const o=r.value;if(e(o.value,o.coords,this))return!0;r=n.next()}return!1}every(e,t){if(!e)return!0;const n=this.entries(t);let r=n.next();for(;!r.done;){const o=r.value;if(!e(o.value,o.coords,this))return!1;r=n.next()}return!0}replace(e,t){let n;if(n=e?.isIRange?e:tb(e,this._values,this._coords,this._type),this.size===0)return n;if(n.size===0)return this;const r=this._values.clone(),o=n._values,i=n._coords??q.EmptyRange,l=this._coords??q.EmptyRange,a=l.colStart,c=l.rowStart,u=a+(t.colIndex??0),d=c+(t.rowIndex??0);o.copyTo(r,{colIndex:u,rowIndex:d},i);const h=Math.max(this.getWidth(),n.getWidth()+(t?.colIndex??0)),f=Math.max(this.getHeight(),n.getHeight()+(t?.rowIndex??0));return new Sn(r,{colStart:a,rowStart:c,colEnd:a+h-1,rowEnd:c+ +f-1},this._type)}slice(e){if(!e)return this;const t=this._coords??q.EmptyRange,n=(e.colStart??0)+t.colStart,r=(e.rowStart??0)+t.rowStart,o={colStart:n,rowStart:r,colEnd:(e.colEnd??t.colEnd-n)+t.colStart,rowEnd:(e.rowEnd??t.rowEnd-r)+t.rowStart},i=q.intersectRanges(t,o);return new Sn(this._values,i,this._type)}resize(e,t,n=null){if(e<0||t<0)throw new Error(`Invalid resize dimensions: ${e} x ${t}`);const r=this._coords??q.EmptyRange,o=r.colEnd-r.colStart+1,i=r.rowEnd-r.rowStart+1;if(e===o&&t===i)return this;const l={colStart:r.colStart,rowStart:r.rowStart,colEnd:r.colStart+e-1,rowEnd:r.rowStart+t-1};let a=this._values;return(e>o||t>i)&&(a=a.clone(),e>o&&(cn.colStart=r.colEnd+1,cn.rowStart=r.rowStart,cn.colEnd=r.colEnd,cn.rowEnd=r.rowEnd,this._fill(a,r,n)),t>i&&(cn.colStart=r.colStart,cn.rowStart=r.rowEnd+1,cn.colEnd=r.colEnd,cn.rowEnd=r.rowEnd,this._fill(a,r,n))),new Sn(a,l,this._type)}_mergeIterators(e,t,n){const r=this._coords??q.EmptyRange,o=e._coords??q.EmptyRange,i=this._values.getOrientation(),l=n?.orientation??i,a=l!==B.Orientation.Row,c=this._entries(n),u=this._entries(n),d=r.colStart,h=r.rowStart,f=d-o.colStart,g=h-o.rowStart,m=l===i?new Mt.Builder:new Mt.TransposedBuilder,p=new sf({...n,bounds:r,comparator:(a?hf:gf)(r,o)},c,u);let S=p.next();for(;!S.done;){const w=S.value;let b=w[1],C=w[3];const _=w[0],y=w[2],v=_?_.colIndex:y.colIndex+f,x=_?_.rowIndex:y.rowIndex+g,E=t(b,C,{colIndex:v-d,rowIndex:x-h},this),R=a?v:x,I=a?x:v;m.addValue(R,I,E),S=p.next()}return m}intersect(e,t,n){if(!e)throw new Error("Invalid range to intersect");const r=e,o=this._coords??null,i=r._coords??null;if(!q.intersectRanges(o,i))return new Sn(this._values,null,this._type);const l=this._mergeIterators(r,t,n);return this._cloneFromBuilder(l,n)}startIncrementalUpdates(e){const t=e?.orientation??B.Orientation.Column,n=this._values.getOrientation(),r=(e?.orientation??n)!==B.Orientation.Row,o=t===n?new Mt.Builder:new Mt.TransposedBuilder,i=this,l=this._coords??q.EmptyRange,a=l.colStart,c=l.rowStart,u=r?a:c,d=r?c:a,h={pushAt(f,g,m){const p=r?g:f,S=r?f:g;return o.addValue(p+u,S+d,m),h},pushMultipleAt(f,g,m){const p=r?g:f,S=r?f:g;return o.addValues(p+u,S+d,m),h},apply(){const f=o.build();return f?(f.bounds.majorStart=u,f.bounds.minorStart=d,i._cloneFromBuilder(o,e)):null}};return h}map(e,t){const n=this._values;if(!this._coords||n.getCount()===0)return this;const r=n.getOrientation(),o=t?.orientation??r;let i;const l=this.entries(t);let a=l.next();a.done||(i=this._createTupleBuilder(o));const c=o===B.Orientation.Column;for(;!a.done;){const u=a.value,d=u.coords,h=e(u.value,d,this),f=c?d.colIndex:d.rowIndex,g=c?d.rowIndex:d.colIndex;i.addValue(f,g,h),a=l.next()}return this._cloneFromBuilder(i,t)}filter(e,t){const n=this._values;if(!this._coords||n.getCount()===0)return this;const r=n.getOrientation(),o=t?.orientation??r,i=this._createTupleBuilder(o),l=this.entries(t);let a=l.next();const c=o===B.Orientation.Column;for(;!a.done;){const u=a.value,d=u.coords,h=u.value;if(e(h,d,this)){const f=c?d.colIndex:d.rowIndex,g=c?d.rowIndex:d.colIndex;i.addValue(f,g,h)}a=l.next()}return this._cloneFromBuilder(i,t)}broadcast(e,t,n){let r=this._coords;if(e==null)return this;let o=n?.type,i=n?.otherType??o;const l=o?sr(null,Le.Null,o):null,a=i?sr(null,Le.Null,i):null;let c;if(e.isIRange)c=e;else{const L=this._values.clone();L.setValueAt(0,0,e),c=new Sn(L,q.EmptyRange,yn(e,!0))}const u=c,d=this.getWidth(),h=this.getHeight(),f=u.getWidth(),g=u.getHeight();let m=Math.min(d,f),p=Math.min(h,g),S=Math.max(d,f),w=Math.max(h,g);const b=n?.mismatchFill;let C=!1;if(d!==f)if(d===1)m=f;else if(f===1)m=d;else{if(!b)throw new Error(`Incompatible shapes for broadcast: width dimensions ${d} and ${f} must be equal or one must be 1`);C=!0}if(h!==g)if(h===1)p=g;else if(g===1)p=h;else{if(!b)throw new Error(`Incompatible shapes for broadcast: height dimensions ${h} and ${g} must be equal or one must be 1`);C=!0}const _=this._values.getOrientation(),y=_,v=y===B.Orientation.Column;r=r??q.EmptyRange;let x,E,R=u._coords??q.EmptyRange;if(C&&(r={colStart:r.colStart,rowStart:r.rowStart,colEnd:r.colStart+m-1,rowEnd:r.rowStart+m-1},R={colStart:R.colStart,rowStart:R.rowStart,colEnd:R.colStart+m-1,rowEnd:R.rowStart+m-1}),d===1&&d<f||h===1&&h<g){const L={...r};d===1&&(L.colEnd=L.colStart),h===1&&(L.rowEnd=L.rowStart),x=new ud({delegate:this._entries({...n,orientation:y,bounds:L,reuseResult:!1}),bounds:L,orientation:y,dims:{major:v?m:p,minor:v?p:m}})}else x=this._entries({...n,orientation:y,bounds:r,reuseResult:!1});if(f===1&&f<d||g===1&&g<h){const L={...R};f===1&&(L.colEnd=L.colStart),g===1&&(L.rowEnd=L.rowStart),E=new ud({delegate:u._entries({...n,type:i??null,orientation:y,bounds:L,reuseResult:!1}),bounds:L,orientation:y,dims:{major:v?m:p,minor:v?p:m}})}else E=u._entries({...n,type:i??null,orientation:y,bounds:R,reuseResult:!1});const I=r.colStart,A=r.rowStart,T=I-R.colStart,O=A-R.rowStart,N=y===_?new Mt.Builder:new Mt.TransposedBuilder,D=new sf({...n,bounds:r,comparator:(v?hf:gf)(r,R)},x,E);let F,k=D.next();for(;!k.done;){const L=k.value;let W=L[1],$=L[3];const J=L[0],te=L[2],Q=J?J.colIndex:te.colIndex+T,G=J?J.rowIndex:te.rowIndex+O;let ee,ne;W instanceof $e.Value?ee=W:$ instanceof $e.Value&&(ee=$),ne=ee||t(W??l,$??a,{colIndex:Q-I,rowIndex:G-A},this);const re=v?Q:G,U=v?G:Q;N.addValue(re,U,ne),k=D.next()}if(b&&S>m||w>p){const L=this._values.clone();if(this._applyBuilder(L,N),S>m){const W=zn(I+m,A,I+S-1,A+w-1,v),$=na(b,W,v);L.setValues($.tuples)}if(w>p){const W=zn(I,A+p,I+S-1,A+w-1,v),$=na(b,W,v);L.setValues($.tuples)}F=new Sn(L,{colStart:I,rowStart:A,colEnd:I+S-1,rowEnd:A+w-1},this._type)}else F=this._cloneFromBuilder(N,n,S,w);return F}_fill(e,t,n){if(n===null)return void e.delete(t);const r=e.getOrientation()===B.Orientation.Column,o=zn(t.colStart,t.rowStart,t.colEnd,t.rowEnd,r),i=na(n,o,r);e.setValues(i.tuples)}_validateCoords(e){}fill(e,t){let n=this._coords;if(!n&&!t)return this;n=n??q.EmptyRange,t&&(cn.colStart=(t.colStart??0)+n.colStart,cn.rowStart=(t.rowStart??0)+n.rowStart,cn.colEnd=(t.colEnd??n.colEnd-n.colStart)+n.colStart,cn.rowEnd=(t.rowEnd??n.rowEnd-n.rowStart)+n.rowStart),this._validateCoords(cn);const r=this._values.clone();return this._fill(r,cn,e),(cn.rowEnd>n.rowEnd||cn.colEnd>n.colEnd)&&(n={colStart:n.colStart,rowStart:n.rowStart,colEnd:Math.max(n.colEnd,cn.colEnd),rowEnd:Math.max(n.rowEnd,cn.rowEnd)}),new Sn(r,n,this._type)}empty(){const e=this._values.cloneEmpty();return new Sn(e,null,this._type)}flatten(e){const t=[],n=this.values(e);let r=n.next();for(;!r.done;)t.push(r.value),r=n.next();return t}fillEmpty(e,t=1,n=1){const r=this._coords;if(!r)return this;const o=this._values;if(t<1&&n<1)throw new Error("Must be at least size of 1");const i=o.getOrientation(),l=i,a=l===B.Orientation.Column,c=Math.max(this.getWidth(),t),u=Math.max(this.getHeight(),n),d=a?r.colStart:r.rowStart,h=a?r.rowStart:r.colStart,f=a?r.colStart+c-1:r.rowStart+u-1,g=a?r.rowStart+u-1:r.colStart+c-1,m=o.getRuns({bounds:{colStart:r.colStart,rowStart:r.rowStart,colEnd:a?f:g,rowEnd:a?g:f},overflowRun:!0});let p=m.next(),S=d,w=h;const b=l===i?new Mt.Builder:new Mt.TransposedBuilder;for(;!p.done;){const C=p.value,_=C[0];for(;S<_;){const R=new ru([e],g+1-w);b.addValues(S,w,R),S++,w=h}const y=C[1],v=Math.max(y,h),x=C[2],E=Math.min(y+x.length-1,g);if(w<v){const R=new ru([e],y-w);b.addValues(S,w,R)}w=E+1,E>=g?(S=_+1,w=h):S=_,p=m.next()}for(;S<=f;){const C=new ru([e],g+1-w);b.addValues(S,w,C),S++,w=h}return this._cloneFromBuilder(b,void 0,c,u)}transpose(){if(this.size<=1)return this;const e=this._values.getOrientation(),t=this._coords,n=this.getWidth(),r=this.getHeight(),o=this._entries({orientation:e===B.Orientation.Column?B.Orientation.Row:B.Orientation.Column,bounds:t,reuseResult:!0}),i=e===B.Orientation.Column,l=new Mt.Builder,a=i?t.colStart:t.rowStart,c=i?t.rowStart:t.colStart;let u=o.next();for(;!u.done;){const d=u.value,h=d[0],f=i?h.colIndex:h.rowIndex-a,g=(i?h.rowIndex:h.colIndex-c)+a,m=f+c,p=d[1];l.addValue(g,m,p),u=o.next()}return this._cloneFromBuilder(l,void 0,r,n)}values(e){const t=this.entries(e);return{[Symbol.iterator](){return this},next(){const n=t.next();return n.done?xt:{done:!1,value:n.value.value}}}}_createTupleBuilder(e){const t=this._coords,n=this._values.getOrientation(),r=e??n,o=r!==B.Orientation.Row,i=o?t.colStart:t.rowStart,l=o?t.rowStart:t.colStart;return r===n?new Mt.Builder(null,i,l):new Mt.TransposedBuilder(null,i,l)}entries(e){const t=this._coords;if(!t)return Qt;const n=e?.bounds;if(e={...e,bounds:t},n){const i=(n.colStart??0)-t.colStart,l=(n.rowStart??0)-t.rowStart,a=Math.max(i+t.colStart,t.colStart),c=Math.max(l+t.rowStart,t.rowStart),u=Math.min((n.colEnd??Number.MAX_SAFE_INTEGER)-i,t.colEnd-t.colStart)+1,d=Math.min((n.rowEnd??Number.MAX_SAFE_INTEGER)-l,t.rowEnd-t.rowStart)+1;e.bounds={colStart:a,rowStart:c,colEnd:a+u-1,rowEnd:c+d-1}}const r=this._entries(e),o={[Symbol.iterator]:()=>o,next(){for(;;){let i=r.next();if(i.done)return xt;const l=i.value,a=l[0];return{done:!1,value:{coords:{colIndex:a.colIndex-t.colStart,rowIndex:a.rowIndex-t.rowStart},value:l[1]}}}}};return o}_entries(e){if(!this._coords)return Qt;let t=this._values.entries(e);const n=e?.type??this._type;let r=null;if(e?.includeEmpty&&(t=new q0(t,e),n&&(r=sr(null,Le.Null,n))),n){const o=t,i=e.coerce??!1,l=e.includeBoolean??!1,a=e.includeMistyped??!1;t={[Symbol.iterator]:()=>t,next(){for(;;){let c=o.next();if(c.done)return xt;const u=c.value,d=u[1];let h=d;if(h==null)h=r;else if(n&&(i||!a)){let f=yn(h,!0),g=f!==n;if(g&&(i&&(h=sr(h,f,n,l),g=h?.isFormulaError),g&&!a))continue}return h===d?c:{done:!1,value:[u[0],h]}}}}}return t}getValues(e){if(!this._coords)return[[]];const t={...e,includeEmpty:!0,reverse:!1,bounds:{colStart:0,rowStart:0,colEnd:this.getWidth()-1,rowEnd:this.getHeight()-1}};let n=!1;t.orientation=e?.orientation??B.Orientation.Row,e&&(e.maxHeight&&(t.bounds.rowEnd=0+e.maxHeight-1),e.maxWidth&&(t.bounds.colEnd=0+e.maxWidth-1),e.trailingEmpties&&(n=e.trailingEmpties),t.orientation=e?.orientation??B.Orientation.Row);const r=[];if(!n){t.includeEmpty=!1,t.reverse=!0;const d=this.entries(t).next();if(d.done)return Z1;const h=d.value.coords;t.bounds.colEnd=h.colIndex,t.bounds.rowEnd=h.rowIndex,t.includeEmpty=!0,t.reverse=!1}const o=this.entries(t),i=t.orientation!==B.Orientation.Row,l=e?.onValue;let a,c=-1,u=[];for(a=o.next();!a.done;){const d=a.value,h=d.coords,f=i?h.colIndex:h.rowIndex;f!==c&&(u=[],r.push(u),c=f);let g=d.value;if(l){const m=l(g,h.rowIndex,h.colIndex,this);m!==void 0&&(g=m)}u.push(g),a=o.next()}return r}toType(e){return new Sn(this._values,this._coords,e,this._isLiteral)}getWidth(){const e=this._coords;return e?e.colEnd-e.colStart+1:0}getHeight(){const e=this._coords;return e?e.rowEnd-e.rowStart+1:0}get size(){const e=this._coords;return e?(e.colEnd-e.colStart+1)*(e.rowEnd-e.rowStart+1):0}isLiteral(){return this._isLiteral}getScalarType(){return this._type}[Symbol.iterator](){const e=this.entries();return{next(){const t=e.next();return t.done?xt:{done:!1,value:t.value.value}},[Symbol.iterator](){return this}}}get[Symbol.toStringTag](){return"[Range]"}toString(){const e=this._coords,t=e?`${e.colEnd-e.colStart+1}x${e.rowEnd-e.rowStart+1}`:$e.Ref.toString();let n="{";const r=this.entries({includeEmpty:!0,orientation:B.Orientation.Row});let o=r.next(),i=0,l=o.value?.coords.rowIndex??0;for(;!o.done&&i<10;){const a=o.value;a.coords.rowIndex>l?(n+=";",l=a.coords.rowIndex):i>0&&(n+=","),i++;let c=a.value;typeof c=="string"?c=`"${c}"`:typeof c=="boolean"&&(c=c?"TRUE":"FALSE"),n+=c,o=r.next()}return o.done?n+="}":n+="...",`[${t}:${n}]`}get isIRange(){return!0}}const cn={colStart:Number.MIN_SAFE_INTEGER,rowStart:Number.MIN_SAFE_INTEGER,colEnd:Number.MAX_SAFE_INTEGER,rowEnd:Number.MAX_SAFE_INTEGER},Z1=Object.freeze([Object.freeze([null])]),ji=Object.freeze({colStart:0,rowStart:0,colEnd:Math.pow(2,14)-1,rowEnd:Math.pow(2,20)-1}),Q1=Object.freeze({colIndex:0,rowIndex:0}),md=()=>ji,yn=(s,e=!1)=>typeof s=="number"?isNaN(s)||s===1/0||s===-1/0?Le.Error:Le.Number:typeof s=="string"?Le.String:typeof s=="boolean"?Le.Boolean:s?.isFormulaError?Le.Error:s===null?Le.Null:P.isObject(s)&&s.hasOwnProperty("type")&&typeof s.type=="string"?Le.RichData:e&&As(s)?"Date":s===void 0?(console.warn("undefined"),Le.Null):null,ff=new Map([[Le.Null,"any"],[Le.Number,"number"],[Le.String,"string"],[Le.Boolean,"boolean"],[Le.Error,"FormulaError"],[Le.RichData,"richData"],["*","Scalar"]]),Y1=new Map([["p","IReferenceRange"],["r","IRange"]]),eb={orientation:B.Orientation.Row},sr=(s,e,t=Le.Number,n=!1,r=!1)=>{if(e===t||!t)return e===Le.Number&&(s=Xa(s,null,"number")),s;if(t===Le.Number){switch(e){case Le.Null:return 0;case Le.String:let o=0;try{const i=kS(s);o=i&&typeof i.value=="number"?i.value:Number.NaN}catch{}return!Number.isFinite(o)||Math.abs(o)>999e305?$e.BuiltIn.Value:o;case Le.Boolean:return n?s?1:0:$e.BuiltIn.Value;case"Date":return $i(s,r)??$e.BuiltIn.Value;case Le.Error:return s}return s.toString()}if(t===Le.String){switch(e){case Le.Null:return"";case Le.Number:return s.toString();case Le.Boolean:return s?"TRUE":"FALSE";case Le.Error:return s}return s}if(t===Le.Boolean){switch(e){case Le.Null:return 0;case Le.Number:return!!s;case Le.String:let o=s.trim().toUpperCase();return o==="TRUE"||o!=="FALSE"&&$e.BuiltIn.Value;case Le.Error:return s}return $e.BuiltIn.Value}if(t==="Date"){switch(e){case Le.Number:return Ms(s,r)??$e.BuiltIn.Value;case Le.String:try{const o=Kd(s,r);if(o)return o.asJSDate??$e.BuiltIn.Value}catch{}return s;case Le.Error:return s}return $e.BuiltIn.Value}return $e.BuiltIn.Value},mf=s=>{let e=s;for(;Array.isArray(e);){if(e.length>1)return!1;e=e[0]}return!e||!e.isIRange||e.size===1},tS=(s,e,t,n,r,o=!1)=>{if(Array.isArray(t)){const i=t.length;for(let l=0;l<i;l++){let a=t[l];if(Array.isArray(a)){const c=tS(s,e,a,n,r,o);if(o)continue;if(c instanceof $e.Value)return c}else{if(n){if(a=sr(a,yn(a,!0),n,o),o)continue;if(a instanceof $e.Value)return a}e.push(a)}}return}if(t&&t.colStart!==void 0){let i=s.getReference?.(t);n&&(i=i.toType(n)),t=i}if(t?.isIRange)return((i,l)=>{let a=i.next();for(;!a.done;){let c=a.value;if(c instanceof $e.Value)return c;l.push(c),a=i.next()}})(t.values({type:n,coerce:!0,includeMistyped:!o,...eb}),e);if(n){if(t=sr(t,yn(t,!0),n,r!==null),o)return;if(t instanceof $e.Value)return t}e.push(t)},Us=(s,e,t,n,r,o)=>{if(r==="r"){let l=t;return l&&l.isIReferenceRange?(n&&(l=l.toType(n)),void e.push(t)):new $e.Value("Cannot convert a literal to a reference.")}let i=t?.isIRange?t:null;if(r!=="l"){if(i){const l=i.getValues({type:n});return void e.push(l)}{Array.isArray(t)||(t=[t]);const l=t.length,a=new Array(l);for(let c=0;c<l;c++){let u=t[c];Array.isArray(u)||(u=[u]);const d=u.length,h=new Array(d);for(let f=0;f<d;f++){let g=u[f];if(n&&(g=sr(g,yn(g,!0),n)),g instanceof $e.Value)return g;h[f]=g}a[c]=h}e.push(a)}}else{if(i)n&&i.getScalarType()!==n&&(i=i.toType(n));else try{if(!o&&(t=Xa(t),n&&(t=sr(t,yn(t,!0),n,!0),t?.isFormulaError&&n!==Le.Error)))return e.push(t),t;i=s.getRange(t),n&&(i=i.toType(n))}catch(l){return l}e.push(i)}},Xa=(s,e,t=typeof s)=>{if(t==="number")return isNaN(s)?$e.BuiltIn.Num:isFinite(s)?s+=0:$e.BuiltIn.Div0;if(s==null)return null;if(!e)return s;if(Array.isArray(s))try{s=e.getRange(s)}catch{return $e.BuiltIn.Value}return e.isValidDate(s)?(e.formatResults("Short Date"),e.toOADate(s)):s},tb=(s,e,t,n)=>{let r;r=Array.isArray(s)?Array.isArray(s[0])?s:[s]:[[s]],e||(e=new Io({orientation:B.Orientation.Column}));const o=e.getOrientation()===B.Orientation.Column,i=Ia(r,o,zn(t?.colStart??0,t?.rowStart??0,void 0,void 0,o),!0),l=Di(i.bounds,o);return e.setValues(i.tuples),new Sn(e,l,n,!t)},nb=new RegExp(/^([$]?[a-zA-Z]*[$]?[0-9]*)[:]?([$]?[a-zA-Z]*[$]?[0-9]*)?$/),rb=new RegExp(/^(R(?:\[?[-+]?\d+\]?|\d+)?C(?:\[?[-+]?\d+\]?|\d+)?)(:(R(?:\[?[-+]?\d+\]?|\d+)?C(?:\[?[-+]?\d+\]?|\d+)?))?$/,"i"),ob=new RegExp(/^(R?)(\[?[-+]?\d+\]?|\d+)?(C?)(\[?[-+]?\d+\]?|\d+)?$/,"i"),sb=new RegExp("(?:'[^']+'|[A-Za-z0-9_\\-.]+?!)?(\\$?[A-Za-z]+\\$?\\d+(?::\\$?[A-Za-z]+\\$?\\d+)?|\\$?[A-Za-z]+:\\$?[A-Za-z]+|\\$?\\d+:\\$?\\d+)","g"),ib=/\s+/g,lb=/"(?:[^"]|"")*"|\[[^[\]]+\]/g,ou=/[\uE000-\uF8FF]/g,tn="#REF!",nS=Math.pow(2,14),ab=Math.pow(2,20);let pf,Sf;const yr=s=>(pf===s||(Sf=""+(s+1),pf=s),Sf);let wf,su;const ar=s=>{if(wf===s)return su;if(wf=s,s<0)throw new Error("invalid column "+s);let e="";for(++s;s;s=Math.floor((s-1)/26))e=String.fromCharCode((s-1)%26+65)+e;return su=e,su},cb=/[^a-zA-Z0-9]/,Gi=s=>s?ar(s.colIndex)+yr(s.rowIndex):null,co=s=>{if(!s)return tn;const e=ar(s.colIndex),t=yr(s.rowIndex);return(s.$colIndex?"$"+e:e)+(s.$rowIndex?"$"+t:t)},oh=(s,e)=>{let t=s??e;var n;return t&&(t=Xd(t),t=t.replace(/'/g,"''"),n=t,cb.test(n)&&(t=_0(t))),t},rS=(s,e)=>s?s+(s.endsWith("!")?"":"!")+e:tn,Pr=(s,e,t=Gi)=>{if(!s)return null;const n=s.colStart,r=s.rowStart,o=s.colEnd,i=s.rowEnd;if(n===o&&r===i)return t({colIndex:n,rowIndex:r});s={...e,...s};const l=n===Number.MIN_SAFE_INTEGER||e&&n<=e.colStart&&o>=e.colEnd,a=r===Number.MIN_SAFE_INTEGER||e&&r<=e.rowStart&&i>=e.rowEnd;let c=null;c=a?ar(n):l?yr(r):t({colIndex:n,rowIndex:r});let u=null;return u=a?ar(o):l?yr(i):t({colIndex:o,rowIndex:i}),c+":"+u},iu=(s,e,t=co)=>{if(!s)return tn;const n=s.colIndex,r=s.rowIndex,o=n===Number.MIN_SAFE_INTEGER;let i=null;if(r===Number.MIN_SAFE_INTEGER?(i=ar(n),s.$colIndex&&(i="$"+i)):o?(i=yr(r),s.$rowIndex&&(i="$"+i)):i=t(s),s.sheetName||e){const l=oh(s.sheetName,e);i=rS(l,i)}return i},wr=(s,e,t=co)=>{if(!s)return tn;const n=s.rowStart!==void 0&&s.rowStart===s.rowEnd;if(s.colStart!==void 0&&s.colStart===s.colEnd&&n)return t({colIndex:s.colStart,rowIndex:s.rowStart,$colIndex:s.$colStart,$rowIndex:s.$rowStart});s={...e,...s};const r=e&&s.rowStart<=e.rowStart&&s.rowEnd>=e.rowEnd,o=e&&s.colStart<=e.colStart&&s.colEnd>=e.colEnd;let i=null;r?(i=ar(s.colStart),i=s.$colStart?"$"+i:i):o?(i=yr(s.rowStart),i=s.$rowStart?"$"+i:i):i=t({colIndex:s.colStart,rowIndex:s.rowStart,$colIndex:s.$colStart,$rowIndex:s.$rowStart});let l=null;return r?(l=ar(s.colEnd),l=s.$colEnd?"$"+l:l):o?(l=yr(s.rowEnd),l=s.$rowEnd?"$"+l:l):l=t({colIndex:s.colEnd,rowIndex:s.rowEnd,$colIndex:s.$colEnd,$rowIndex:s.$rowEnd}),i+":"+l},Za=(s,e,t=co)=>{const n=wr(s,e,t),r=oh(s?.sheetName,e?.sheetName);return rS(r,n)},oS=(s,e=!1)=>{if(!s)return null;let t=0,n=0,r=!1,o=!1;const i=s.length;for(let a=0;a<i;++a){const c=s.charCodeAt(a);if(c>=48&&c<=57){if(n=10*n+(c-48),t===0&&!e)return}else if(c>=65&&c<=90){if(t=26*t+(c-64),n!==0)return}else if(c>=97&&c<=122){if(t=26*t+(c-96),n!==0)return}else{if(c!==36)return;if(t!==0||r){if(n!==0||o)return;o=!0}else r=!0}}const l={};return e||n!==0&&t!==0?(t>0&&(l.colIndex=t-1,r&&(l.$colIndex=r)),n>0&&(l.rowIndex=n-1,(o||e&&r)&&(l.$rowIndex=o||e&&r)),l):null},Jn=(s,e=ji,t=!1)=>{if(!s)return null;let n=s.toUpperCase();const r=lS(n,t);let o=null,i=null;if(r?.[1]){const a=!!r[2],c=t?aa:oS;o=c(r[1],a),i=c(r[2]??r[1],a)}if(!o&&!i||o&&i&&(o.rowIndex===void 0&&i.rowIndex!==void 0||o.rowIndex!==void 0&&i.rowIndex===void 0||o.colIndex===void 0&&i.colIndex!==void 0||o.colIndex!==void 0&&i.colIndex===void 0))return null;const l={};return o&&(o.colIndex!==void 0&&(l.colStart=o.colIndex),o.rowIndex!==void 0&&(l.rowStart=o.rowIndex),o.$colIndex!==void 0&&(l.$colStart=o.$colIndex),o.$rowIndex!==void 0&&(l.$rowStart=o.$rowIndex),l?.colStart!==void 0&&l?.colStart>e?.colEnd)?null:(i&&(i.colIndex!==void 0&&(l.colEnd=i.colIndex),i.rowIndex!==void 0&&(l.rowEnd=i.rowIndex),i.$colIndex!==void 0&&(l.$colEnd=i.$colIndex),i.$rowIndex!==void 0&&(l.$rowEnd=i.$rowIndex)),{...e,...l})},Ui=(s,e,t=!1)=>{const n=(o=>{const i=o.lastIndexOf("!");if(i===-1)return null;let l=o.slice(0,i);return l=Xd(l),l=l.replace(/''/g,"'"),[l,o.slice(i+1)]})(s);let r;if(n){if(r=Jn(n[1],e,t),!r)return null;r.sheetName=n[0]}else r=Jn(s,e,t);return r||null},sh=(s,e,t=wr,n=co)=>{if(!s||s.length===0)return null;const r=[],o=s.length;for(let i=0;i<o;i++){const l=s[i];let a=null;l?l.rowIndex!==void 0||l.colIndex!==void 0?a=n(l):l.rowStart!==void 0||l.colStart!==void 0?a=t(l,e,n):typeof l=="string"&&(a=l):a=tn,a&&r.push(a)}return r},sS=(s,e,t=Za,n=co)=>{const r=sh(s,e,t,n);return r?r.join(","):tn},iS=(s,e,t,n=Ui,r,o=!1)=>{if(e!==null){if(typeof e=="string"){const i=n(e,t,o);if(!i){const l=r?.(e);if(l){const a=l.length;for(let c=0;c<a;c++){const u=l[c];iS(s,u,t,n,r,o)}}return}e=i}else e.isICellRange?e=e.getCoords():e.isICell&&(e=q.cellToRange(e.getCoords()));if(e!==null){if(e.rowStart!==void 0||e.colStart!==void 0||e.colEnd!==void 0||e.rowEnd!==void 0){const i=e;s.push({...t,...i})}else if(e.rowIndex!==void 0||e.colIndex!==void 0){const i=e,l={...t,...i,colStart:i.colIndex,rowStart:i.rowIndex,colEnd:i.colIndex,rowEnd:i.rowIndex};l.sheetName===null&&t.sheetName&&(l.sheetName=t.sheetName),delete l.colIndex,delete l.rowIndex,s.push(l)}}else s.push(null)}else s.push(null)},Qa=(s,e,t=Ui,n,r=!1)=>{if(!s)return[e];let o;o=typeof s=="string"?y0(s):s.isICellRanges?s.getCoords():Array.isArray(s)?s:[s];const i=[],l=o.length;for(let a=0;a<l;a++){const c=o[a];iS(i,c,e,t,n,r)}return i},is=(s,e)=>{let t=0,n=0;const r=s.length;for(let o=0;o<r;++o){const i=s.charCodeAt(o);if(i>=48&&i<=57){if(t=10*t+(i-48),n===0)return}else if(i>=65&&i<=90){if(n=26*n+(i-64),t!==0)return}else if(!(i>=97&&i<=122)||(n=26*n+(i-96),t!==0))return}return e?(e.colIndex=n-1,e.rowIndex=t-1,e):{colIndex:n-1,rowIndex:t-1}},aa=(s,e=!1,t)=>{t?(t.colIndex=Number.MIN_SAFE_INTEGER,t.rowIndex=Number.MIN_SAFE_INTEGER,t.$colIndex=!1,t.$rowIndex=!1):t={colIndex:Number.MIN_SAFE_INTEGER,rowIndex:Number.MIN_SAFE_INTEGER,$colIndex:!1,$rowIndex:!1};const n=ob.exec(s);if(!n)return null;const r=n[1],o=n[3];if(!(e||r&&o))return null;if(r){const i=n[2];i?i&&(i.startsWith("[")?(t.rowIndex=parseInt(i.slice(1,-1)),t.$rowIndex=!1):(t.rowIndex=parseInt(i)-1,t.$rowIndex=!0)):(t.rowIndex=0,t.$rowIndex=!1)}if(o){const i=n[4];i?i.startsWith("[")?(t.colIndex=parseInt(i.slice(1,-1)),t.$colIndex=!1):(t.colIndex=parseInt(i)-1,t.$colIndex=!0):(t.colIndex=0,t.$colIndex=!1)}return t},pd=(s,e)=>{let t=0,n=0,r=!1,o=!1;const i=s.length;for(let l=0;l<i;++l){const a=s.charCodeAt(l);a>=48&&a<=57?t=10*t+(a-48):a>=65&&a<=90?n=26*n+(a-64):a>=97&&a<=122?n=26*n+(a-96):a===36&&(l===0?r=!0:o=!0)}return n--,t--,e.colIndex=n,e.rowIndex=t,t===-1?(e.$colIndex=r,e.$rowIndex=!1,e):n===-1?(e.$colIndex=!1,e.$rowIndex=r,e):(e.$colIndex=r,e.$rowIndex=o,e)},ub=s=>{let e=0;const t=s.length;for(let n=0;n<t;++n){const r=s.charCodeAt(n);if(r>=65&&r<=90)e=26*e+(r-64);else{if(!(r>=97&&r<=122))return e-1;e=26*e+(r-96)}}return e-1},Ln=(s,e)=>{let t=e;t?(t.rowStart=0,t.colStart=0,t.rowEnd=0,t.colEnd=0):t={rowStart:0,colStart:0,rowEnd:0,colEnd:0};let n=0,r=0,o=0,i=s.length;for(n=0;r<i&&(o=s.charCodeAt(r),o>96&&o<123&&(o-=32),!(o<65||o>91));++r)n=26*n+(o-64);for(t.colStart=--n,n=0;r<i;++r){let l=s.charCodeAt(r)-48;if(l<0||l>9)break;n=10*n+l}if(t.rowStart=--n,r===i||s.charCodeAt(++r)===58)return t.colEnd=t.colStart,t.rowEnd=t.rowStart,t;for(n=0;r!==i&&(o=s.charCodeAt(r),o>96&&o<123&&(o-=32),!(o<65||o>91));++r)n=26*n+(o-64);for(t.colEnd=--n,n=0;r!==i;++r){let l=s.charCodeAt(r)-48;if(l<0||l>9)break;n=10*n+l}return t.rowEnd=--n,t},lS=(s,e=!1)=>{const t=s.match(e?rb:nb);return s.endsWith(":")?null:t},Sd={rowIndex:-1,colIndex:-1,$colIndex:!1,$rowIndex:!1},lu=(s,e,t,n=nS)=>{let r=s.lastIndexOf("!"),o="";r!==-1&&(o=s.slice(0,r)+"!",s=s.slice(r+1));let i=null;const l=()=>{let c="";const u=i.rowIndex;if(u!==-1)if(i.$rowIndex)c+=`R${u+1}`;else{const f=u-e;c+=f===0?"R":`R[${f}]`}let d="";const h=i.colIndex;if(h!==-1)if(i.$colIndex)d+=`C${h+1}`;else{const f=h-t;d+=f===0?"C":`C[${f}]`}o+=c+d};r=s.lastIndexOf(":");const a=r!==-1;if(a){const c=s.slice(0,r);s=s.slice(r+1),i=pd(c,Sd),i.colIndex!==-1&&i.rowIndex!==-1&&(l(),o+=":")}return i=pd(s,Sd),!a&&i.colIndex>n?s:(l(),o)},fs=[],db=s=>(fs.push(s),String.fromCharCode(57344+fs.length-1)),hb=s=>{const e=s.charCodeAt(0)-57344;return fs[e]},gb=(s,e,t)=>{let n="";const r=s.length;for(let o=0;o<r;o++){const i=s[o];n+=typeof i=="string"?i:aS(i,e,t)}return n},ca=(s,e)=>{let t="";const n=s.rowIndex;n!==Number.MIN_SAFE_INTEGER&&(s.$rowIndex?t+=`R${n+1}`:t+=n===0?"R":`R[${n+1}]`);let r="";const o=s.colIndex;return o!==Number.MIN_SAFE_INTEGER&&(s.$colIndex?r+=`C${o+1}`:r+=o===0?"C":`C[${o+1}]`),s.sheetName&&(t=oh(s.sheetName,e)+"!"+t),t+r},aS=(s,e,t)=>{let n="";const r=s.colIndex;r!==Number.MIN_SAFE_INTEGER&&(s.$colIndex?n+="$"+ar(r):n+=ar(r+t));const o=s.rowIndex;return o!==Number.MIN_SAFE_INTEGER&&(s.$rowIndex?n+="$"+yr(o):n+=yr(o+e)),n},_2=(s,e,t,n)=>{let r=s.colStart,o=s.rowStart,i=s.colEnd,l=s.rowEnd;const a=s.$colStart??!1,c=s.$rowStart??!1,u=s.$colEnd??!1,d=s.$rowEnd??!1;if(a||r===Number.MIN_SAFE_INTEGER||(r+=t),c||o===Number.MIN_SAFE_INTEGER||(o+=e),u||i===Number.MAX_SAFE_INTEGER||(i+=t),d||l===Number.MAX_SAFE_INTEGER||(l+=e),r>i){const f=r;r=i,i=f}if(o>l){const f=o;o=l,l=f}let h;return n?(h=n,h.colStart=r,h.rowStart=o,h.colEnd=i,h.rowEnd=l,h.$colStart=a,h.$rowStart=c,h.$colEnd=u,h.$rowEnd=d):h={colStart:r,rowStart:o,colEnd:i,rowEnd:l,$colStart:a,$rowStart:c,$colEnd:u,$rowEnd:d},s.sheetName&&(h.sheetName=s.sheetName),h},fb=(s,e,t,n)=>{fs.length=0;let r=0,o=s.replace(lb,db),i=0,l=o.replace(sb,(a,c,u)=>{const d=lu(a,e,t);if(n){if(u>i){const f=o.slice(i,u).replace(ou,(g,m)=>fs[r++]);n.push(f)}const h=a.lastIndexOf(":");if(h!==-1){const f=a.slice(0,h),g=a.slice(h+1),m=lu(f,e,t),p=lu(g,e,t);n.push(aa(m,!0)??m),n.push(":"),n.push(aa(p,!0)??p)}else n.push(aa(d,!0)??d)}return i=u+a.length,d});if(n&&i<o.length){const a=o.slice(i);n.push(a.replace(ou,(c,u)=>fs[r++]))}return l=l.toUpperCase().replace(ib,""),l.replace(ou,hb)},xo="Must specify an address.",cS="Only a single range is allowed for this operation. Use 'getRanges' instead.",_f="Only a single cell is allowed.",uS="Invalid range. The Range must be specified as '{ TOP_LEFT:BOTTOM_RIGHT }'.",ms=s=>`Invalid address. Can not parse ${typeof s=="string"?`'${s}' `:""}as an address or named item.`,gt=()=>{throw new Error("Invalid range.")};let ua=class wd{constructor(e,t,n=!1){this._c=e,this._cycleId=t,this._e=n}getCycleId(){return this._cycleId}getError(){return this._e}getCoords(){return this._c}setError(e,t){const n=this._c;return{...n,value:new wd(n,t,e)}}getShifted(e){const t=e.after;if(!t)return null;const n=q.sanitizeRange(t);return{...n,value:new wd(n,this._cycleId,this._e)}}getMerged(e,t,n){}getSplit(e,t){}},vs=class _i{constructor(e,t){this._c=e,this._o=t}getCoords(){return this._c}getOrientation(){return this._o}getShifted(e){return e.after?{...e.after,value:new _i(e.after,this._o)}:null}getMerged(e,t,n){const r=this._o;return new _i(t,r)}getSplit(e,t){const n=this._o;return[new _i(e[0],n),new _i(e[1],n)]}getState(){return this._c}};const yf=(s,e)=>{if(!s||s.length===0)return P.EmptyArray;const t=[],n=e?B.Orientation.Column:B.Orientation.Row;for(let r=0;r<s.length;r++){const o=s[r],i=o[0],l=o[1];for(let a=0;a<l.length;a++){const c=l[a],u=c[0],d=c[1].length-1,h={colStart:e?i:u,rowStart:e?u:i,colEnd:e?i:u+d,rowEnd:e?u+d:i,value:new vs({colStart:e?i:u,rowStart:e?u:i,colEnd:e?i:u+d,rowEnd:e?u+d:i},n)};t.push(h)}}return t},_d=0,bf=1;class kr{constructor(e,t,n){this.ref=e,this.formula=t;const r=e.colStart,o=e.rowStart;if(n){const i=n,l=i.length;for(let a=0;a<l;a++){const c=[...i[a]];i[a]=c;const u=c.length;for(let d=0;d<u;d++){const h={...c[d]};c[d]=h,h.colIndex=d+r,h.rowIndex=a+o,h.block=this}}this.calcs=i}else{const i=t.getDirectPrecedentsAt(o,r),l=i?.length??0,a=new Array(e.rowEnd-o+1),c=e.colEnd-r+1,u=a.length;for(let d=0;d<u;d++){const h=new Array(c),f=h.length;for(let g=0;g<f;g++)h[g]={block:this,colIndex:g+r,rowIndex:d+o,cycleId:0,markId:0,inDegree:0,dependents:P.EmptyArray,inputs:l===0?P.EmptyArray:new Array(l),precedents:l===0?P.EmptyArray:new Array(l),dynamic:null,cachedValue:void 0,removed:!1,pending:!1,pendingPrecedents:!1,pendingPromise:null,pendingResolved:!1,state:_d,error:void 0};a[d]=h}this.calcs=a}}toJSON(){const e=this.ref;return[Pr(e),this.formula.getTextAt(e.rowStart,e.colStart)]}getCoords(){return this.ref}getShifted(e){if(!e.after)return null;const t=q.sanitizeRange(e.after),n=[...this.calcs],r=new kr(t,this.formula,n);return{...e.after,value:r}}setReferenceAt(e,t){const n=this.formula.setReferenceAt(e,t),r=[...this.calcs];return new kr(this.ref,n,r)}getMerged(e,t,n){const r=this.formula,o=e.formula;if(!r.isEquals(o))return;const i=this.calcs,l=e.calcs;let a;if(n===B.Orientation.Row)a=[...i,...l];else{const c=i.length;a=new Array(c);for(let u=0;u<c;u++)a[u]=[...i[u],...l[u]]}return new kr(t,r,a)}getSplit(e,t,n){const r=this.formula,o=t===B.Orientation.Column;let i,l;const a=this.calcs;if(o){const c=a.length;i=new Array(c),l=new Array(c);for(let u=0;u<c;u++){const d=a[u];i[u]=d.slice(0,n),l[u]=d.slice(n)}}else i=a.slice(0,n),l=a.slice(n);return[new kr(e[0],r,i),new kr(e[1],r,l)]}copyTo(e,t){const n=this.formula;return new kr(e,n)}canTile(e,t){return!0}onRemove(e){const t=e.value.calcs,n=t.length;for(let r=0;r<n;r++){const o=t[r],i=o.length;for(let l=0;l<i;l++){const a=o[l];a.pendingPromise&&(a.pendingPromise.cancelled=!0),a.removed=!0}}}}const mb=Object.freeze({break:!0});var je;(je||(je={})).Type={Style:"style",Continuous:"continuous",Table:"table",Merge:"merge",Hyperlink:"hyperlink",Comments:"comments",Unlock:"unlock",Contentful:"contentful",Conditional:"conditional",Formula:"formula",Spill:"spill",Pending:"pending",CalcError:"calcError",Validation:"dataValidation"};const pb=Object.freeze({[je.Type.Style]:!1,[je.Type.Table]:!1,[je.Type.Merge]:!1,[je.Type.Hyperlink]:!1,[je.Type.Comments]:!1,[je.Type.Unlock]:!1,[je.Type.Formula]:!1,[je.Type.Spill]:!1,[je.Type.Pending]:!1,[je.Type.CalcError]:!1,[je.Type.Contentful]:!1,[je.Type.Conditional]:!1,[je.Type.Continuous]:!1}),dS=Object.freeze({[je.Type.Style]:!1,[je.Type.Table]:!1,[je.Type.Merge]:!1,[je.Type.Hyperlink]:!1,[je.Type.Comments]:!1,[je.Type.Unlock]:!1,[je.Type.Formula]:!1,[je.Type.Spill]:!1,[je.Type.Pending]:!1,[je.Type.CalcError]:!1,[je.Type.Conditional]:!1,[je.Type.Continuous]:!1}),Sb=Object.freeze({[je.Type.Style]:!1,[je.Type.Table]:!0,[je.Type.Merge]:!1,[je.Type.Hyperlink]:!1,[je.Type.Comments]:!1,[je.Type.Unlock]:!1,[je.Type.Formula]:!1});Object.freeze({[je.Type.Style]:!1,[je.Type.Table]:!1,[je.Type.Hyperlink]:!1,[je.Type.Comments]:!1,[je.Type.Unlock]:!1,[je.Type.Contentful]:!1,[je.Type.Formula]:!1});const wb=Object.freeze({[je.Type.Style]:!1,[je.Type.Hyperlink]:!1,[je.Type.Continuous]:!1,[je.Type.Contentful]:!1}),Sl="This sheet is protected. To make a change, unprotect the sheet. You might be requested to enter a password.",_b=(s="update")=>`Unable to ${s}, this sheet is protected. To make a change, unprotect the sheet. You might be requested to enter a password.`,Aa="The range is outside of the bounds of the sheet.",Cf="Listener can not be null",vf="We can't insert items. The sheet is protected.",xf=s=>`We can't create a ${s} that overlaps with another table or merge.`,Ef="Overlapping ranges can not be merged.",au="We can't insert cells because this would push values off the end of the worksheet. These cells may appear empty but they have some formatting or formulas. Delete enough rows or columns and try again.",Rf="Unable to partially fill over merged cells.",If="Unable to sort merged cells unless they are all the same size.",Nn="Sheet has been closed. No further operations are allowed.",ps="IteratorContext can only be used during visit.",Af="When using addresses directly from the sheet do not include the sheet name.",hS=s=>`Unable to return more than ${s} values. To access values in a more scalable solution use 'ICellRange.forEach' or an iterator.`,Mf="'setValue' expects a single value; when working with an array use 'setValue'.",Tf="Multiple selection ranges can not be copied.",kf="Unable to determine source.",Ff="When pasting before or after the cut area both areas must align.",yb=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Nf=new Set,yd=typeof process=="object"&&process?process:{},gS=(s,e,t,n)=>{typeof yd.emitWarning=="function"?yd.emitWarning(s,e,t,n):console.error(`[${t}] ${e}: ${s}`)};let Ma=globalThis.AbortController,Of=globalThis.AbortSignal;if(Ma===void 0){Of=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(t,n){this._onabort.push(n)}},Ma=class{constructor(){e()}signal=new Of;abort(t){if(!this.signal.aborted){this.signal.reason=t,this.signal.aborted=!0;for(const n of this.signal._onabort)n(t);this.signal.onabort?.(t)}}};let s=yd.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const e=()=>{s&&(s=!1,gS("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const Xr=s=>s&&s===Math.floor(s)&&s>0&&isFinite(s),fS=s=>Xr(s)?s<=Math.pow(2,8)?Uint8Array:s<=Math.pow(2,16)?Uint16Array:s<=Math.pow(2,32)?Uint32Array:s<=Number.MAX_SAFE_INTEGER?da:null:null;let da=class extends Array{constructor(e){super(e),this.fill(0)}},bb=class yi{heap;length;static#a=!1;static create(e){const t=fS(e);if(!t)return[];yi.#a=!0;const n=new yi(e,t);return yi.#a=!1,n}constructor(e,t){if(!yi.#a)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}},Cb=class mS{#a;#d;#m;#A;#p;#F;#N;#S;get perf(){return this.#S}ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#o;#w;#r;#n;#e;#c;#h;#l;#s;#_;#i;#y;#b;#g;#C;#I;#u;#O;static unsafeExposeInternals(e){return{starts:e.#b,ttls:e.#g,sizes:e.#y,keyMap:e.#r,keyList:e.#n,valList:e.#e,next:e.#c,prev:e.#h,get head(){return e.#l},get tail(){return e.#s},free:e.#_,isBackgroundFetch:t=>e.#t(t),backgroundFetch:(t,n,r,o)=>e.#B(t,n,r,o),moveToTail:t=>e.#k(t),indexes:t=>e.#v(t),rindexes:t=>e.#x(t),isStale:t=>e.#f(t)}}get max(){return this.#a}get maxSize(){return this.#d}get calculatedSize(){return this.#w}get size(){return this.#o}get fetchMethod(){return this.#F}get memoMethod(){return this.#N}get dispose(){return this.#m}get onInsert(){return this.#A}get disposeAfter(){return this.#p}constructor(e){const{max:t=0,ttl:n,ttlResolution:r=1,ttlAutopurge:o,updateAgeOnGet:i,updateAgeOnHas:l,allowStale:a,dispose:c,onInsert:u,disposeAfter:d,noDisposeOnSet:h,noUpdateTTL:f,maxSize:g=0,maxEntrySize:m=0,sizeCalculation:p,fetchMethod:S,memoMethod:w,noDeleteOnFetchRejection:b,noDeleteOnStaleGet:C,allowStaleOnFetchRejection:_,allowStaleOnFetchAbort:y,ignoreFetchAbort:v,perf:x}=e;if(x!==void 0&&typeof x?.now!="function")throw new TypeError("perf option must have a now() method if specified");if(this.#S=x??yb,t!==0&&!Xr(t))throw new TypeError("max option must be a nonnegative integer");const E=t?fS(t):Array;if(!E)throw new Error("invalid max value: "+t);if(this.#a=t,this.#d=g,this.maxEntrySize=m||this.#d,this.sizeCalculation=p,this.sizeCalculation){if(!this.#d&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(w!==void 0&&typeof w!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#N=w,S!==void 0&&typeof S!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#F=S,this.#I=!!S,this.#r=new Map,this.#n=new Array(t).fill(void 0),this.#e=new Array(t).fill(void 0),this.#c=new E(t),this.#h=new E(t),this.#l=0,this.#s=0,this.#_=bb.create(t),this.#o=0,this.#w=0,typeof c=="function"&&(this.#m=c),typeof u=="function"&&(this.#A=u),typeof d=="function"?(this.#p=d,this.#i=[]):(this.#p=void 0,this.#i=void 0),this.#C=!!this.#m,this.#O=!!this.#A,this.#u=!!this.#p,this.noDisposeOnSet=!!h,this.noUpdateTTL=!!f,this.noDeleteOnFetchRejection=!!b,this.allowStaleOnFetchRejection=!!_,this.allowStaleOnFetchAbort=!!y,this.ignoreFetchAbort=!!v,this.maxEntrySize!==0){if(this.#d!==0&&!Xr(this.#d))throw new TypeError("maxSize must be a positive integer if specified");if(!Xr(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#j()}if(this.allowStale=!!a,this.noDeleteOnStaleGet=!!C,this.updateAgeOnGet=!!i,this.updateAgeOnHas=!!l,this.ttlResolution=Xr(r)||r===0?r:1,this.ttlAutopurge=!!o,this.ttl=n||0,this.ttl){if(!Xr(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#z()}if(this.#a===0&&this.ttl===0&&this.#d===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#a&&!this.#d){const R="LRU_CACHE_UNBOUNDED";(I=>!Nf.has(I))(R)&&(Nf.add(R),gS("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",R,mS))}}getRemainingTTL(e){return this.#r.has(e)?1/0:0}#z(){const e=new da(this.#a),t=new da(this.#a);this.#g=e,this.#b=t,this.#P=(o,i,l=this.#S.now())=>{if(t[o]=i!==0?l:0,e[o]=i,i!==0&&this.ttlAutopurge){const a=setTimeout(()=>{this.#f(o)&&this.#E(this.#n[o],"expire")},i+1);a.unref&&a.unref()}},this.#M=o=>{t[o]=e[o]!==0?this.#S.now():0},this.#R=(o,i)=>{if(e[i]){const l=e[i],a=t[i];if(!l||!a)return;o.ttl=l,o.start=a,o.now=n||r();const c=o.now-a;o.remainingTTL=l-c}};let n=0;const r=()=>{const o=this.#S.now();if(this.ttlResolution>0){n=o;const i=setTimeout(()=>n=0,this.ttlResolution);i.unref&&i.unref()}return o};this.getRemainingTTL=o=>{const i=this.#r.get(o);if(i===void 0)return 0;const l=e[i],a=t[i];return!l||!a?1/0:l-((n||r())-a)},this.#f=o=>{const i=t[o],l=e[o];return!!l&&!!i&&(n||r())-i>l}}#M=()=>{};#R=()=>{};#P=()=>{};#f=()=>!1;#j(){const e=new da(this.#a);this.#w=0,this.#y=e,this.#T=t=>{this.#w-=e[t],e[t]=0},this.#H=(t,n,r,o)=>{if(this.#t(n))return 0;if(!Xr(r)){if(!o)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if(typeof o!="function")throw new TypeError("sizeCalculation must be a function");if(r=o(n,t),!Xr(r))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return r},this.#D=(t,n,r)=>{if(e[t]=n,this.#d){const o=this.#d-e[t];for(;this.#w>o;)this.#L(!0)}this.#w+=e[t],r&&(r.entrySize=n,r.totalCalculatedSize=this.#w)}}#T=e=>{};#D=(e,t,n)=>{};#H=(e,t,n,r)=>{if(n||r)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#v({allowStale:e=this.allowStale}={}){if(this.#o)for(let t=this.#s;this.#$(t)&&(!e&&this.#f(t)||(yield t),t!==this.#l);)t=this.#h[t]}*#x({allowStale:e=this.allowStale}={}){if(this.#o)for(let t=this.#l;this.#$(t)&&(!e&&this.#f(t)||(yield t),t!==this.#s);)t=this.#c[t]}#$(e){return e!==void 0&&this.#r.get(this.#n[e])===e}*entries(){for(const e of this.#v())this.#e[e]===void 0||this.#n[e]===void 0||this.#t(this.#e[e])||(yield[this.#n[e],this.#e[e]])}*rentries(){for(const e of this.#x())this.#e[e]===void 0||this.#n[e]===void 0||this.#t(this.#e[e])||(yield[this.#n[e],this.#e[e]])}*keys(){for(const e of this.#v()){const t=this.#n[e];t===void 0||this.#t(this.#e[e])||(yield t)}}*rkeys(){for(const e of this.#x()){const t=this.#n[e];t===void 0||this.#t(this.#e[e])||(yield t)}}*values(){for(const e of this.#v())this.#e[e]===void 0||this.#t(this.#e[e])||(yield this.#e[e])}*rvalues(){for(const e of this.#x())this.#e[e]===void 0||this.#t(this.#e[e])||(yield this.#e[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(const n of this.#v()){const r=this.#e[n],o=this.#t(r)?r.__staleWhileFetching:r;if(o!==void 0&&e(o,this.#n[n],this))return this.get(this.#n[n],t)}}forEach(e,t=this){for(const n of this.#v()){const r=this.#e[n],o=this.#t(r)?r.__staleWhileFetching:r;o!==void 0&&e.call(t,o,this.#n[n],this)}}rforEach(e,t=this){for(const n of this.#x()){const r=this.#e[n],o=this.#t(r)?r.__staleWhileFetching:r;o!==void 0&&e.call(t,o,this.#n[n],this)}}purgeStale(){let e=!1;for(const t of this.#x({allowStale:!0}))this.#f(t)&&(this.#E(this.#n[t],"expire"),e=!0);return e}info(e){const t=this.#r.get(e);if(t===void 0)return;const n=this.#e[t],r=this.#t(n)?n.__staleWhileFetching:n;if(r===void 0)return;const o={value:r};if(this.#g&&this.#b){const i=this.#g[t],l=this.#b[t];if(i&&l){const a=i-(this.#S.now()-l);o.ttl=a,o.start=Date.now()}}return this.#y&&(o.size=this.#y[t]),o}dump(){const e=[];for(const t of this.#v({allowStale:!0})){const n=this.#n[t],r=this.#e[t],o=this.#t(r)?r.__staleWhileFetching:r;if(o===void 0||n===void 0)continue;const i={value:o};if(this.#g&&this.#b){i.ttl=this.#g[t];const l=this.#S.now()-this.#b[t];i.start=Math.floor(Date.now()-l)}this.#y&&(i.size=this.#y[t]),e.unshift([n,i])}return e}load(e){this.clear();for(const[t,n]of e){if(n.start){const r=Date.now()-n.start;n.start=this.#S.now()-r}this.set(t,n.value,n)}}set(e,t,n={}){if(t===void 0)return this.delete(e),this;const{ttl:r=this.ttl,start:o,noDisposeOnSet:i=this.noDisposeOnSet,sizeCalculation:l=this.sizeCalculation,status:a}=n;let{noUpdateTTL:c=this.noUpdateTTL}=n;const u=this.#H(e,t,n.size||0,l);if(this.maxEntrySize&&u>this.maxEntrySize)return a&&(a.set="miss",a.maxEntrySizeExceeded=!0),this.#E(e,"set"),this;let d=this.#o===0?void 0:this.#r.get(e);if(d===void 0)d=this.#o===0?this.#s:this.#_.length!==0?this.#_.pop():this.#o===this.#a?this.#L(!1):this.#o,this.#n[d]=e,this.#e[d]=t,this.#r.set(e,d),this.#c[this.#s]=d,this.#h[d]=this.#s,this.#s=d,this.#o++,this.#D(d,u,a),a&&(a.set="add"),c=!1,this.#O&&this.#A?.(t,e,"add");else{this.#k(d);const h=this.#e[d];if(t!==h){if(this.#I&&this.#t(h)){h.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:f}=h;f===void 0||i||(this.#C&&this.#m?.(f,e,"set"),this.#u&&this.#i?.push([f,e,"set"]))}else i||(this.#C&&this.#m?.(h,e,"set"),this.#u&&this.#i?.push([h,e,"set"]));if(this.#T(d),this.#D(d,u,a),this.#e[d]=t,a){a.set="replace";const f=h&&this.#t(h)?h.__staleWhileFetching:h;f!==void 0&&(a.oldValue=f)}}else a&&(a.set="update");this.#O&&this.onInsert?.(t,e,t===h?"update":"replace")}if(r===0||this.#g||this.#z(),this.#g&&(c||this.#P(d,r,o),a&&this.#R(a,d)),!i&&this.#u&&this.#i){const h=this.#i;let f;for(;f=h?.shift();)this.#p?.(...f)}return this}pop(){try{for(;this.#o;){const e=this.#e[this.#l];if(this.#L(!0),this.#t(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(this.#u&&this.#i){const e=this.#i;let t;for(;t=e?.shift();)this.#p?.(...t)}}}#L(e){const t=this.#l,n=this.#n[t],r=this.#e[t];return this.#I&&this.#t(r)?r.__abortController.abort(new Error("evicted")):(this.#C||this.#u)&&(this.#C&&this.#m?.(r,n,"evict"),this.#u&&this.#i?.push([r,n,"evict"])),this.#T(t),e&&(this.#n[t]=void 0,this.#e[t]=void 0,this.#_.push(t)),this.#o===1?(this.#l=this.#s=0,this.#_.length=0):this.#l=this.#c[t],this.#r.delete(n),this.#o--,t}has(e,t={}){const{updateAgeOnHas:n=this.updateAgeOnHas,status:r}=t,o=this.#r.get(e);if(o!==void 0){const i=this.#e[o];if(this.#t(i)&&i.__staleWhileFetching===void 0)return!1;if(!this.#f(o))return n&&this.#M(o),r&&(r.has="hit",this.#R(r,o)),!0;r&&(r.has="stale",this.#R(r,o))}else r&&(r.has="miss");return!1}peek(e,t={}){const{allowStale:n=this.allowStale}=t,r=this.#r.get(e);if(r===void 0||!n&&this.#f(r))return;const o=this.#e[r];return this.#t(o)?o.__staleWhileFetching:o}#B(e,t,n,r){const o=t===void 0?void 0:this.#e[t];if(this.#t(o))return o;const i=new Ma,{signal:l}=n;l?.addEventListener("abort",()=>i.abort(l.reason),{signal:i.signal});const a={signal:i.signal,options:n,context:r},c=(f,g=!1)=>{const{aborted:m}=i.signal,p=n.ignoreFetchAbort&&f!==void 0;if(n.status&&(m&&!g?(n.status.fetchAborted=!0,n.status.fetchError=i.signal.reason,p&&(n.status.fetchAbortIgnored=!0)):n.status.fetchResolved=!0),m&&!p&&!g)return u(i.signal.reason);const S=d,w=this.#e[t];return(w===d||p&&g&&w===void 0)&&(f===void 0?S.__staleWhileFetching!==void 0?this.#e[t]=S.__staleWhileFetching:this.#E(e,"fetch"):(n.status&&(n.status.fetchUpdated=!0),this.set(e,f,a.options))),f},u=f=>{const{aborted:g}=i.signal,m=g&&n.allowStaleOnFetchAbort,p=m||n.allowStaleOnFetchRejection,S=p||n.noDeleteOnFetchRejection,w=d;if(this.#e[t]===d&&(!S||w.__staleWhileFetching===void 0?this.#E(e,"fetch"):m||(this.#e[t]=w.__staleWhileFetching)),p)return n.status&&w.__staleWhileFetching!==void 0&&(n.status.returnedStale=!0),w.__staleWhileFetching;if(w.__returned===w)throw f};n.status&&(n.status.fetchDispatched=!0);const d=new Promise((f,g)=>{const m=this.#F?.(e,o,a);m&&m instanceof Promise&&m.then(p=>f(p===void 0?void 0:p),g),i.signal.addEventListener("abort",()=>{n.ignoreFetchAbort&&!n.allowStaleOnFetchAbort||(f(void 0),n.allowStaleOnFetchAbort&&(f=p=>c(p,!0)))})}).then(c,f=>(n.status&&(n.status.fetchRejected=!0,n.status.fetchError=f),u(f))),h=Object.assign(d,{__abortController:i,__staleWhileFetching:o,__returned:void 0});return t===void 0?(this.set(e,h,{...a.options,status:void 0}),t=this.#r.get(e)):this.#e[t]=h,h}#t(e){if(!this.#I)return!1;const t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof Ma}async fetch(e,t={}){const{allowStale:n=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,ttl:i=this.ttl,noDisposeOnSet:l=this.noDisposeOnSet,size:a=0,sizeCalculation:c=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL,noDeleteOnFetchRejection:d=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:h=this.allowStaleOnFetchRejection,ignoreFetchAbort:f=this.ignoreFetchAbort,allowStaleOnFetchAbort:g=this.allowStaleOnFetchAbort,context:m,forceRefresh:p=!1,status:S,signal:w}=t;if(!this.#I)return S&&(S.fetch="get"),this.get(e,{allowStale:n,updateAgeOnGet:r,noDeleteOnStaleGet:o,status:S});const b={allowStale:n,updateAgeOnGet:r,noDeleteOnStaleGet:o,ttl:i,noDisposeOnSet:l,size:a,sizeCalculation:c,noUpdateTTL:u,noDeleteOnFetchRejection:d,allowStaleOnFetchRejection:h,allowStaleOnFetchAbort:g,ignoreFetchAbort:f,status:S,signal:w};let C=this.#r.get(e);if(C===void 0){S&&(S.fetch="miss");const _=this.#B(e,C,b,m);return _.__returned=_}{const _=this.#e[C];if(this.#t(_)){const E=n&&_.__staleWhileFetching!==void 0;return S&&(S.fetch="inflight",E&&(S.returnedStale=!0)),E?_.__staleWhileFetching:_.__returned=_}const y=this.#f(C);if(!p&&!y)return S&&(S.fetch="hit"),this.#k(C),r&&this.#M(C),S&&this.#R(S,C),_;const v=this.#B(e,C,b,m),x=v.__staleWhileFetching!==void 0&&n;return S&&(S.fetch=y?"stale":"refresh",x&&y&&(S.returnedStale=!0)),x?v.__staleWhileFetching:v.__returned=v}}async forceFetch(e,t={}){const n=await this.fetch(e,t);if(n===void 0)throw new Error("fetch() returned undefined");return n}memo(e,t={}){const n=this.#N;if(!n)throw new Error("no memoMethod provided to constructor");const{context:r,forceRefresh:o,...i}=t,l=this.get(e,i);if(!o&&l!==void 0)return l;const a=n(e,l,{options:i,context:r});return this.set(e,a,i),a}get(e,t={}){const{allowStale:n=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,status:i}=t,l=this.#r.get(e);if(l!==void 0){const a=this.#e[l],c=this.#t(a);return i&&this.#R(i,l),this.#f(l)?(i&&(i.get="stale"),c?(i&&n&&a.__staleWhileFetching!==void 0&&(i.returnedStale=!0),n?a.__staleWhileFetching:void 0):(o||this.#E(e,"expire"),i&&n&&(i.returnedStale=!0),n?a:void 0)):(i&&(i.get="hit"),c?a.__staleWhileFetching:(this.#k(l),r&&this.#M(l),a))}i&&(i.get="miss")}#V(e,t){this.#h[t]=e,this.#c[e]=t}#k(e){e!==this.#s&&(e===this.#l?this.#l=this.#c[e]:this.#V(this.#h[e],this.#c[e]),this.#V(this.#s,e),this.#s=e)}delete(e){return this.#E(e,"delete")}#E(e,t){let n=!1;if(this.#o!==0){const r=this.#r.get(e);if(r!==void 0)if(n=!0,this.#o===1)this.#W(t);else{this.#T(r);const o=this.#e[r];if(this.#t(o)?o.__abortController.abort(new Error("deleted")):(this.#C||this.#u)&&(this.#C&&this.#m?.(o,e,t),this.#u&&this.#i?.push([o,e,t])),this.#r.delete(e),this.#n[r]=void 0,this.#e[r]=void 0,r===this.#s)this.#s=this.#h[r];else if(r===this.#l)this.#l=this.#c[r];else{const i=this.#h[r];this.#c[i]=this.#c[r];const l=this.#c[r];this.#h[l]=this.#h[r]}this.#o--,this.#_.push(r)}}if(this.#u&&this.#i?.length){const r=this.#i;let o;for(;o=r?.shift();)this.#p?.(...o)}return n}clear(){return this.#W("delete")}#W(e){for(const t of this.#x({allowStale:!0})){const n=this.#e[t];if(this.#t(n))n.__abortController.abort(new Error("deleted"));else{const r=this.#n[t];this.#C&&this.#m?.(n,r,e),this.#u&&this.#i?.push([n,r,e])}}if(this.#r.clear(),this.#e.fill(void 0),this.#n.fill(void 0),this.#g&&this.#b&&(this.#g.fill(0),this.#b.fill(0)),this.#y&&this.#y.fill(0),this.#l=0,this.#s=0,this.#_.length=0,this.#w=0,this.#o=0,this.#u&&this.#i){const t=this.#i;let n;for(;n=t?.shift();)this.#p?.(...n)}}};var ut,Df;(Df=ut||(ut={})).CalcStatus={Ready:"ready",Stale:"stale",Pending:"pending",Streaming:"streaming"},Df.Content={Values:"values",Formats:"formats",Formulas:"formula",Hyperlinks:"hyperlinks",Tables:"tables",Notes:"notes",Comments:"comments",Warnings:"warnings",Errors:"errors",Merges:"merges"};class vb{constructor(e,t,n){if(!n)throw new lr;if(typeof n=="string"&&(n={address:n}),typeof n.address!="string")throw new Error("Invalid hyperlink");this._t=e,this._r=t,this._p=n}open(e,t){return this._r(this.getAddress(),null,e??this.getTarget(),t)}getTarget(){return this._p.target||(this._p.address.startsWith("#")?"_self":"_blank")}getDisplayText(){return this._t()??this.getAddress()}getAddress(){return this._p.address??""}getTooltip(){return this._p.tooltip??null}get isIHyperlink(){return!0}}function Lf(s){return!/^(-?\d|--)/.test(s)}function Bf(s){const e=[];let t="",n="",r=7;for(let o,i=0;o=s.charAt(i);i++)if(/[a-zA-Z\d\xa0-\uffff_-]/.test(o)&&r===7)t+=o;else if(o==="\\"&&r===7)r=6;else if(o===" "&&r===7){if(t!==""){if(!Lf(t))return null;e.push(t),t=""}}else if(r===6)/[0-9a-f]/i.test(o)?(n+=o,r=8):(t+=o,r=7);else{if(r!==8)return null;/[0-9a-f]/i.test(o)&&n.length<6?n+=o:(t+=String.fromCodePoint(parseInt(n,16)),t+=o,n="",r=7)}if(t!==""){if(!Lf(t))return null;e.push(t)}return e.join(" ")}function zf(s,e){let t=e,n="";const r={"font-family":[]};for(let o,i=0;o=s.charAt(i);i+=1)if(t!==4||o!=='"'&&o!=="'")if(t===3&&o===",")t=4,n="";else if(t===4&&o===","){const l=Bf(n);l&&r["font-family"].push(l),n=""}else if(t===5&&o===" ")/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:deg|grad|rad|turn)$/.test(n)?(r["font-style"]+=" "+n,n=""):i-=1,t=1;else if(t!==1||o!==" "&&o!=="/")t===2&&o===" "?(/^(?:\+|-)?([0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)?$/.test(n)&&(r["line-height"]=n),t=4,n=""):n+=o;else{if(/^(?:(?:xx|x)-large|(?:xx|s)-small|small|large|medium)$/.test(n)||/^(?:larg|small)er$/.test(n)||/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)$/.test(n))t=o==="/"?2:4,r["font-size"]=n;else if(/^italic$/.test(n))r["font-style"]=n;else if(/^oblique$/.test(n))r["font-style"]=n,t=5;else if(/^small-caps$/.test(n))r["font-variant"]=n;else if(/^(?:bold(?:er)?|lighter|normal)$/.test(n))r["font-weight"]=n;else if(/^[+-]?(?:[0-9]*\.)?[0-9]+(?:e[+-]?(?:0|[1-9][0-9]*))?$/.test(n)){const l=parseFloat(n);l>=1&&l<=1e3&&(r["font-weight"]=n)}else/^(?:(?:ultra|extra|semi)-)?(?:condensed|expanded)$/.test(n)&&(r["font-stretch"]=n);n=""}else{let l=i+1;do if(l=s.indexOf(o,l)+1,!l)return null;while(s.charAt(l-2)==="\\");r["font-family"].push(s.slice(i+1,l-1).replace(/\\('|")/g,"$1")),i=l-1,t=3,n=""}if(t===3&&!/^\s*$/.test(n))return null;if(t===4){const o=Bf(n);o&&r["font-family"].push(o)}return r}const ha=s=>{if(typeof s!="string")return null;let e=(function(o){const i=zf(o,4);return i!==null?i["font-family"]:null})(s);Array.isArray(e)&&e.length===0&&(e=null),e=e?{"font-family":e}:(function(o){const i=zf(o,1);return i!==null&&i["font-size"]&&i["font-family"].length?i:null})(s);let t=null,n=null,r=null;if(e){let o=e["font-family"];const i=o.shift();i&&(t=i),o.length>0&&(n=o),e["font-size"]!==void 0&&(r=e["font-size"])}return{family:t,fallbacks:n,size:r}},_r=(s,e=!1)=>s?.toHex(e)?.toString(!1).toLowerCase()??null,Pf=s=>s==null?null:P.roundAccurately(s,2)+"pt",pS=(s,e)=>{let t="";const n=s&&s!==Be.UnderlineStyle.None;return e&&(t+="line-through"),n&&e&&(t+=" "),n&&(t+="underline",s!==!0&&s!==Be.UnderlineStyle.Single&&s!==Be.UnderlineStyle.SingleAccounting||(t+=" solid"),s!==Be.UnderlineStyle.Double&&s!==Be.UnderlineStyle.DoubleAccounting||(t+=" double")),t},xb=Object.freeze({underline:Be.UnderlineStyle.None,strike:!1}),SS=s=>s?(s=s.toLowerCase())==="single"?Be.UnderlineStyle.Single:s==="double"?Be.UnderlineStyle.Double:s==="single-accounting"||s==="singleaccounting"?Be.UnderlineStyle.SingleAccounting:s==="double-accounting"||s==="doubleaccounting"?Be.UnderlineStyle.DoubleAccounting:Be.UnderlineStyle.None:Be.UnderlineStyle.None,Hf=s=>s?s.toLowerCase():null,$f=s=>s?s===ce.Overflow.Visible||s===ce.Overflow.Clip||s===ce.Overflow.Shrink?"nowrap":s===ce.Overflow.Wrap?"normal":void 0:null,Ta=(s,e)=>{let t="";if(s&&(s.includes(" ")&&(s='"'+s+'"'),t=s),e)for(let n=0;n<e.length;n++)t.length>0&&(t+=", "),t+=e[n];return t},Vf=s=>{let e="",t=!1,n="";for(let r=0;r<s.length;r++){const o=s.charAt(r);t&&o!=="]"&&o!=='"'?e+=o:o==='"'?(e+="\\0022",t=!t):["[","]",",","#",".","@","/",":",";","-"," "].includes(o)?(e+="\\"+o,o==="["?t=!0:o==="]"&&(t=!1)):["(",")"].includes(o)?e+=n==="_"?"\\"+o:"\\\\\\"+o:["$"].includes(o)?e+="\\0022"+o+"\\0022":e+=o,n=o}return'"'+e+'"'},Eb="Thin",Rb="Hairline",Ib="Extra Light",Ab="Ultra Light",Mb="Light",Wf="Normal",Tb="Regular",kb="Medium",Fb="Semi Bold",Nb="Demi Bold",Ob="Bold",Db="Extra Bold",Lb="Ultra Bold",Bb="Black",zb="Heavy",Pb="Extra Black",Hb="Ultra Black",$b="lighter",Vb="normal",Wb="bold",jb="bolder",$t=new Map;$t.set(P.textToKey(Eb),100),$t.set(P.textToKey(Rb),100),$t.set(P.textToKey(Ib),200),$t.set(P.textToKey(Ab),200),$t.set(P.textToKey(Mb),300),$t.set(P.textToKey(Wf),400),$t.set(P.textToKey(Tb),400),$t.set(P.textToKey(kb),500),$t.set(P.textToKey(Fb),600),$t.set(P.textToKey(Nb),600),$t.set(P.textToKey(Wf),400),$t.set(P.textToKey(Ob),700),$t.set(P.textToKey(Db),800),$t.set(P.textToKey(Lb),800),$t.set(P.textToKey(Bb),900),$t.set(P.textToKey(zb),900),$t.set(P.textToKey(Pb),950),$t.set(P.textToKey(Hb),950),$t.set(P.textToKey($b),100),$t.set(P.textToKey(Vb),400),$t.set(P.textToKey(Wb),700),$t.set(P.textToKey(jb),700);const Gb="xx-small",Ub="x-small",qb="small",Jb="medium",Kb="large",Xb="x-large",Zb="xx-large",Qb="xxx-large",Yb="smaller",eC="larger",tC="math",nC=new RegExp("^[0-9]*[.]?[0-9]+$","g"),Un=new Map;Un.set(P.textToKey(Gb),s=>.4*s),Un.set(P.textToKey(Ub),s=>.5*s),Un.set(P.textToKey(qb),s=>.6*s),Un.set(P.textToKey(Jb),s=>s),Un.set(P.textToKey(Kb),s=>1.1*s),Un.set(P.textToKey(Xb),s=>1.25*s),Un.set(P.textToKey(Zb),s=>1.5*s),Un.set(P.textToKey(Qb),s=>2*s),Un.set(P.textToKey(Yb),s=>.9*s),Un.set(P.textToKey(eC),s=>1.1*s),Un.set(P.textToKey(tC),s=>s);const Ss=(s,e=11,t="pt")=>{if(!s)return null;let n=e;s=s.trim().toLowerCase();const r=t==="pt"?Be.getDeviceScale():1,o=t==="pt"?1:Be.getDeviceScale();if(nC.test(s)){const i=parseFloat(s);isNaN(i)||(s=i+t)}if(s.endsWith("pt"))n=parseFloat(s.substring(0,s.length-2).trim())*o;else if(s.endsWith("px"))n=parseFloat(s.substring(0,s.length-2).trim())/r;else if(s.endsWith("em"))n=parseFloat(s.substring(0,s.length-2).trim())*e;else if(s.endsWith("rem"))n=parseFloat(s.substring(0,s.length-3).trim())*e;else if(s.endsWith("%"))n=parseFloat(s.substring(0,s.length-1).trim())/100*e;else if(typeof s=="string"){const i=P.textToKey(s),l=Un.get(i);if(l)return l(e)}return isNaN(n)?null:n},Jt=new Map;Jt.set(He.BuiltInSheetPattern.None,{description:"None",cssKey:"none"}),Jt.set(He.BuiltInSheetPattern.Solid,{description:"Solid",cssKey:"solid"}),Jt.set(He.BuiltInSheetPattern.DarkGray,{description:"75% gray",cssKey:"gray-75"}),Jt.set(He.BuiltInSheetPattern.MediumGray,{description:"50% gray",cssKey:"gray-50"}),Jt.set(He.BuiltInSheetPattern.LightGray,{description:"25% gray",cssKey:"gray-25"}),Jt.set(He.BuiltInSheetPattern.Gray125,{description:"12.5% Gray",cssKey:"gray-125"}),Jt.set(He.BuiltInSheetPattern.Gray0625,{description:"6.25% Gray",cssKey:"gray-0625"}),Jt.set(He.BuiltInSheetPattern.DarkHorizontal,{description:"Horizontal Strip",cssKey:"horz-stripe"}),Jt.set(He.BuiltInSheetPattern.DarkVertical,{description:"Vertical Strip",cssKey:"vert-stripe"}),Jt.set(He.BuiltInSheetPattern.DarkDown,{description:"Reverse Diagonal Stripe",cssKey:"reverse-diag-stripe"}),Jt.set(He.BuiltInSheetPattern.DarkUp,{description:"Diagonal Strip",cssKey:"diag-stripe"}),Jt.set(He.BuiltInSheetPattern.DarkGrid,{description:"Diagonal Crosshatch",cssKey:"diag-cross"}),Jt.set(He.BuiltInSheetPattern.DarkTrellis,{description:"Thick Diagonal Crosshatch",cssKey:"thick-diag-cross"}),Jt.set(He.BuiltInSheetPattern.LightHorizontal,{description:"Thin Horizontal Stripe",cssKey:"thin-horz-stripe"}),Jt.set(He.BuiltInSheetPattern.LightVertical,{description:"Thin Vertical Stripe",cssKey:"thin-vert-stripe"}),Jt.set(He.BuiltInSheetPattern.LightDown,{description:"Thin Reverse Diagonal Stripe",cssKey:"thin-reverse-diag-stripe"}),Jt.set(He.BuiltInSheetPattern.LightUp,{description:"Thin Diagonal Stripe",cssKey:"thin-diag-stripe"}),Jt.set(He.BuiltInSheetPattern.LightGrid,{description:"Thin Horizontal Cross",cssKey:"thin-horz-cross"}),Jt.set(He.BuiltInSheetPattern.LightTrellis,{description:"Thin Diagonal Cross",cssKey:"thin-diag-cross"});let ga="";const wS=new Map;Jt.forEach((s,e)=>{ga.length>0&&(ga+="|"),ga+="\\b"+s.cssKey+"\\b",wS.set(s.cssKey,e)});const rC=new RegExp(`(\\s*(?:${ga}))`,"g"),oC=s=>{if(!s)return null;let e=s.toLowerCase();e=e.replace(/;/,"");let t=e.match(rC);if(!t)return null;let n=null;t&&t.length>0&&(n=(o=>{if(!o)return null;let i=e.indexOf(o);return e=e.substring(0,i)+e.substring(i+o.length,e.length),o.trim()})(t[0])),e=e.trim();const r=e?e.trim():null;return!n&&!r?null:{patternType:wS.get(n??"solid"),foreground:r??null}},_S=(s,e=!1,t=null)=>{if(!s||!s.getStops()||s.getStops().length<1)return null;if(s.getStops().length===1)return _r(s.getStops()[0].getColor(),e);let n="";for(let o=0;o<s.getStops().length;o++){const i=s.getStops()[o];n+=_r(i.getColor(),e)+" "+100*(i.getOffset()??o*(s.getStops().length-1))+"%",o<s.getStops().length-1&&(n+=", ")}let r=s.getAngle()??0;if(s.getGradientType()===He.GradientType.Path){const o=_r(s.getStops()[0]?.getColor(),e),i=_r((s.getStops()[1]??s.getStops()[0])?.getColor(),e),l=s.getFillTo()??{left:0,top:0,right:0,bottom:0},a=-1;let c=`${100-a}% ${100-a}%`;if(r=315,l.left===1&&l.right===1&&l.right===1&&l.bottom===1)r=135,c=`${a}% ${a}%`;else if(l.top!==0&&l.bottom!==0&&l.left===0&&l.right===0)r=225,c=`${100-a}% ${a}%`;else if(l.left===1&&l.right!==0&&l.top===0&&l.bottom===0)r=45,c=`${a}% ${100-a}%`;else if(l.left!==0&&l.right!==0&&l.top!==0&&l.bottom!==0)return`radial-gradient(${n})`;const u=70;return`conic-gradient(from ${r}deg at ${c}, ${o} 0deg, ${i} ${u/2}deg,${i} ${360-u/2}deg, ${o} 360deg)`}return`linear-gradient(${r}deg, ${n})`},vn=new Map;vn.set(Ce.StrokeStyle.None,{size:null,cssKey:"none"}),vn.set(Ce.StrokeStyle.DashDot,{size:.5,cssKey:"dot-dash"}),vn.set(Ce.StrokeStyle.DashDotDot,{size:.5,cssKey:"dot-dot-dash"}),vn.set(Ce.StrokeStyle.Dashed,{size:.5,cssKey:"dashed"}),vn.set(Ce.StrokeStyle.MediumDashed,{size:1,cssKey:"dashed"}),vn.set(Ce.StrokeStyle.Dotted,{size:.5,cssKey:"dotted"}),vn.set(Ce.StrokeStyle.MediumDashDot,{size:1,cssKey:"dot-dash"}),vn.set(Ce.StrokeStyle.MediumDashDotDot,{size:1,cssKey:"dot-dot-dash"}),vn.set(Ce.StrokeStyle.Hair,{size:.5,cssKey:"hairline"}),vn.set(Ce.StrokeStyle.Thin,{size:.5,cssKey:"solid"}),vn.set(Ce.StrokeStyle.Thick,{size:1.5,cssKey:"solid"}),vn.set(Ce.StrokeStyle.Medium,{size:1,cssKey:"solid"}),vn.set(Ce.StrokeStyle.Double,{size:2,cssKey:"double"}),vn.set(Ce.StrokeStyle.SlantDashDot,{size:1,cssKey:"dot-dash-slanted"});const wo=s=>{if(!s)return"none";const e=vn.get(s.getStyle());if(!e)return null;if(e.cssKey==="none")return e.cssKey;let t=((n,r=!1)=>n?.toRGBA(r).toString(!1)??null)(s?.getColor());return t=t?" "+t:"",`${e.size!==null?`${e.size}pt `:""}${e.cssKey}${t}`};let Ya=[];const jf=new Set,bd=new Map,Ri=(s,e)=>{let t=s.size!==null?`${s.size.toString()} ${s.cssKey}`:s.cssKey;bd.set(t,e),jf.has(s.cssKey)||(Ya.push(s.cssKey),jf.add(s.cssKey))};vn.forEach(Ri);const cu=Object.keys(Ce.StrokeStyle);for(let s=0;s<cu.length;s++)Ri({size:null,cssKey:cu[s].toLowerCase()},Ce.StrokeStyle[cu[s]]);Ri({size:null,cssKey:"double"},Ce.StrokeStyle.Double),Ri({size:null,cssKey:"solid"},Ce.StrokeStyle.Medium),Ri({size:null,cssKey:"hidden"},Ce.StrokeStyle.None),Ya.sort((s,e)=>e.length-s.length);let fa="";const sC=Ya.length;for(let s=0;s<sC;s++)fa.length>0&&(fa+="|"),fa+="\\b"+Ya[s]+"\\b";const iC=new RegExp(`(\\s*(?:${fa}))`,"g"),lC=new RegExp("(\\s*[0-9]*[.]?[0-9]+(?:pt|px){0,1})","g"),yS=(s,e)=>{if(!s)return null;let t=s.toLowerCase(),n=t.match(iC);if(!n){const u=e?.(t);return u?{color:u,style:Ce.StrokeStyle.Medium}:null}const r=u=>{if(!u)return null;let d=t.indexOf(u);return t=t.substring(0,d)+t.substring(d+u.length,t.length).trim(),u.trim()};let o=null;if(n&&n.length>0&&(o=r(n[0])),!o)return null;let i=null;if(n=t.match(lC),n&&n.length>0){let u=r(n[0]);i=parseFloat(u.substring(0,u.length-2))}t=t.trim();const l=t?t.trim():null;let a=i===null?o:`${i.toString()} ${o}`,c=bd.get(a);return c||(c=bd.get(o)),c?{color:l,style:c}:null},aC="start",cC="end",uC="left",dC="right",hC="center",gC="justify",fC="justify-all",mC="baseline",pC="top",SC="middle",wC="bottom",_C="sub",yC="text-top",bC="justify",CC="distributed",Zr=new Map;Zr.set(P.textToKey(aC),ce.HorizontalAlignment.Left),Zr.set(P.textToKey(uC),ce.HorizontalAlignment.Left),Zr.set(P.textToKey(cC),ce.HorizontalAlignment.Right),Zr.set(P.textToKey(dC),ce.HorizontalAlignment.Right),Zr.set(P.textToKey(hC),ce.HorizontalAlignment.Center),Zr.set(P.textToKey(gC),ce.HorizontalAlignment.Justify),Zr.set(P.textToKey(fC),ce.HorizontalAlignment.Justify);const Ir=new Map;Ir.set(P.textToKey(mC),ce.VerticalAlignment.Bottom),Ir.set(P.textToKey(pC),ce.VerticalAlignment.Top),Ir.set(P.textToKey(SC),ce.VerticalAlignment.Center),Ir.set(P.textToKey(wC),ce.VerticalAlignment.Bottom),Ir.set(P.textToKey(_C),ce.VerticalAlignment.Bottom),Ir.set(P.textToKey(yC),ce.VerticalAlignment.Top),Ir.set(P.textToKey(bC),ce.VerticalAlignment.Justify),Ir.set(P.textToKey(CC),ce.VerticalAlignment.Distributed);const Cd=s=>{if(s instanceof Gt)return{color:s.toString()};if(typeof s=="string")try{return{color:s==="none"||s==="transparent"?null:s}}catch(e){throw e}return s},Li={shorthand:(s,e)=>{if(!s||s==="none"||s==="transparent")return null;try{return e.parseColor(s).toString()}catch(t){console.warn("error",t)}return s},merge:(s,e,t)=>s},Ur={shorthand:(s,e)=>{if(s.isIStroke)return s.getProperties();if(typeof s=="string"&&(s=yS(s,n=>{try{return e.parseColor(n).toString()}catch{}return null})),!s)return null;const t={};return s.style&&(t.style=s.style),s.color&&(t.color=s.color),t},properties:{color:Li}},vC={shorthand:(s,e)=>{if(s.isIBorder)return s.getProperties();if(typeof s=="string"){const t=yS(s,n=>{try{return e.parseColor(n).toString()}catch{}return null});return{left:t,right:t,top:t,bottom:t,horizontal:null,vertical:null,diagonalUp:null,diagonalDown:null}}return s},properties:{top:Ur,left:Ur,right:Ur,bottom:Ur,horizontal:Ur,vertical:Ur,diagonalUp:Ur,diagonalDown:Ur}},xC={shorthand:(s,e)=>{if(typeof s=="string"){let t=Ut.Styles.lookupDefault(s);return t!==void 0?t:s}return typeof s=="number"?eh(s):null}},EC={shorthand:(s,e)=>{if(s.isIStyledFont)return s.toJSON();if(typeof s=="string"){const t=ha(s);if(t){const n={};if(t.family&&(n.family=t.family),t.fallbacks&&(n.fallbacks=t.fallbacks),t.size&&(n.size=Ss(t.size)),Object.keys(t).length>0)return n}}return s},properties:{family:{shorthand:(s,e)=>ha(s)?.family??null},fallbacks:{shorthand:(s,e)=>{if(typeof s!="string")return s;let t=ha(s);if(!t)return null;let n=[t.family];return t.fallbacks&&(n=n.concat(t.fallbacks)),n}},size:{shorthand:(s,e)=>{let t=s;return typeof s=="string"&&(t=Ss(s,e.getNormal().getFont().getSize())),isNaN(t)||typeof t!="number"?null:(t=Math.max(1,Math.min(P.roundAccurately(t,1),409)),t)}},weight:{shorthand:(s,e)=>{if(typeof s!="string")return s;const t=(n=>{let r=400;if(r=typeof n=="number"?n:parseFloat(n),!isNaN(r))return r;if(typeof n=="string"){const o=P.textToKey(n),i=$t.get(o);if(i)return i}return r})(s);return isNaN(t)||typeof t!="number"?null:t}},underline:{shorthand:(s,e)=>s?s===!0?Be.UnderlineStyle.Single:SS(s):Be.UnderlineStyle.None}}},RC={properties:{indent:{shorthand:(s,e)=>{let t=s;return typeof s=="string"&&(t=parseFloat(s)),isNaN(t)||typeof t!="number"?null:t}},rotation:{shorthand:(s,e)=>{let t=s;return typeof s=="string"&&(t=parseFloat(s)),isNaN(t)||typeof t!="number"?null:(t%=360,t<0&&(t+=360),t)}}}},bS={shorthand:(s,e)=>s==="none"||s==="transparent"||typeof s=="object"&&Object.keys(s).length===0?{type:He.Type.None}:(s.getType?.(),He.Type.None,s)},CS={shorthand:s=>(typeof(s=Cd(s))=="object"&&s.color&&(s.type=He.Type.Solid),s),merge:(s,e)=>s.color?s:(e?.toJSON&&(e=e.toJSON()),e?.type===He.Type.Solid?{...e}:e?.type===He.Type.Gradient?{type:He.Type.Solid,color:e?.stops?.[0]?.color??V.Scheme.Bg1}:e?.type===He.Type.Pattern?{type:He.Type.Solid,color:e?.foreground??V.Scheme.Bg1}:s?{...s}:null),properties:{color:Li}},IC={shorthand:s=>(typeof s=="string"&&(s=s.split(",").map(e=>e.trim())),Array.isArray(s)&&(s=s.map((e,t)=>{if(!e)return;let n=e;return typeof e=="string"&&(n=Cd(e)),e.isIColor&&(n={color:e.toString()}),n})),s),arrayType:{shorthand:s=>s=Cd(s),properties:{color:Li}}},vS={shorthand:s=>(typeof s=="object"&&s.stops&&(s.type=He.Type.Gradient),s),merge:(s,e,t)=>s.stops?s:(e?.toJSON&&(e=e.toJSON()),e?.type===He.Type.Gradient?{...e}:e?.type===He.Type.Solid?{type:He.Type.Gradient,stops:[{offset:0,color:e?.color??V.Scheme.Accent1},{offset:1,color:V.Scheme.Bg1}]}:e?.type===He.Type.Pattern?{type:He.Type.Gradient,stops:[{offset:0,color:e?.foreground??V.Scheme.Bg1},{offset:1,color:e?.background??V.Scheme.Accent1}]}:s?{...s}:null),properties:{stops:IC}},xS={shorthand:(s,e)=>{if(typeof s=="object"){const t=s;(t.foreground||t.background||t.patternType)&&(t.type=He.Type.Pattern,t.patternType=t.patternType??He.BuiltInSheetPattern.Solid)}return s},merge:(s,e,t)=>{if(s.background&&s.foreground)return s;e?.toJSON&&(e=e.toJSON());const n=He.BuiltInSheetPattern.MediumGray;if(e?.type===He.Type.Pattern){const r={type:He.Type.Pattern,patternType:s.patternType??e.patternType};return s.foreground||s.background?(s.foreground&&(r.foreground=s.foreground),s.background&&(r.background=s.background)):(e.foreground&&(r.foreground=e.foreground),e.background&&(r.background=e.background)),r}return e?.type===He.Type.Solid?{patternType:n,foreground:e?.color??V.Named.WindowText,background:V.Scheme.Bg1,...s}:e?.type===He.Type.Gradient?{patternType:n,foreground:e?.stops?.[0]?.color??V.Named.WindowText,background:e?.stops?.[1]?.color??V.Scheme.Bg1,...s}:s?{type:He.Type.Pattern,patternType:He.BuiltInSheetPattern.Solid,foreground:V.Named.WindowText,background:V.Scheme.Bg1,...s}:null},properties:{foreground:Li,background:Li}},Gf=[bS,CS,vS,xS],ih=[];for(let s=0;s<Gf.length;s++){const e=Gf[s]?.shorthand;ih.push(e)}const AC=ih.length,Wt={properties:{font:EC,fill:{shorthand:(s,e)=>{s.isIFill&&(s=s.toJSON());for(let t=0;t<AC;t++){let n=ih[t](s,e);if(n?.type)return n}return s},getSubType:s=>s.type===He.Type.None?bS:s.type===He.Type.Solid?CS:s.type===He.Type.Gradient?vS:s.type===He.Type.Pattern?xS:null},alignment:RC,border:vC,numberFormat:xC}},MC={properties:{style:Wt}},TC=Object.freeze({displayText:"",conditionalColor:null,repeatChars:P.EmptyArray,spacingChars:P.EmptyArray,repeatPlaceholder:null,formattedRuns:Object.freeze({runs:P.EmptyArray,length:0,width:0,lastRepeatIndex:-1}),canWrap:!1,asDate:null,isDateFormat:!1,isTimeFormat:!1,isDate1904:!1}),ES=(s,e,t,n,r,o=!1)=>{if(s==null)return TC;let i="",l=null,a=null,c=null;if(t===Le.Error)i=s.getLabel();else if(t===Le.RichData)i="(Rich Object)";else if(t===Le.Boolean)i=s?"TRUE":"FALSE";else if(n)try{i=Jd(n,s,{date1904:o,spacingCharacter:"",digitCharacter:"",onRepeatChar:(v,x)=>{a||(a=[]),a.push({offset:v,char:x})},onSpacingChar:(v,x)=>{c||(c=[]),c.push({offset:v,char:x})},onDigitChar:v=>{c||(c=[]),c.push({offset:v,char:"0"})}})}catch{}const u=Vi(n),d=Ja(n),h=u||d?Ms(s,o):null;(u||d)&&parseFloat(s)<0&&(l="#",i=l.repeat(5));let f=null;const g=e.getAlignment(),m=g.getHorizontal(),p=g.getVertical(),S=g.getOverflow(),w=!(t!==Le.String||m===ce.HorizontalAlignment.Fill||a!==null&&a.length!==0||S!==ce.Overflow.Wrap&&m!==ce.HorizontalAlignment.Justify&&m!==ce.HorizontalAlignment.Distributed&&p!==ce.VerticalAlignment.Justify&&p!==ce.VerticalAlignment.Distributed);let b=i;w||t!==Le.String||(b=b.replaceAll(/\n/g,""));const C=c?.length>0||a?.length>0;if(S!==ce.Overflow.Wrap||C){const v=e.getFont();let x=v.getSize();v.isSuperSub()&&(x*=v.getSuperSubScale());let E=[];for(let D=0;D<c?.length;D++){const F=c[D],k=e.measureText(F.char,x).width;E.push({...F,type:"spacing",width:k})}if(a?.length>0){const D=a[a.length-1],F=e.measureText(D.char,x).width;E.push({...D,type:"repeat",width:F})}E=E.sort((D,F)=>D.offset-F.offset);let R=[],I=0,A=0,T=-1,O=-1;const N=D=>{const F={type:"text",width:e.measureText(D,x).width,text:D};R.push(F),A+=F.width,I+=D.length};for(let D=0;D<E.length;D++){const F=E[D];if(O!==F.offset){const L=b.substring(I,F.offset);L&&N(L)}const k={type:F.type,width:F.width,text:F.char};F.type!=="repeat"?A+=k.width:T=R.length,R.push(k),O=F.offset}if(I<b.length){let D=b.substring(I,b.length);D&&N(D)}f={runs:Object.freeze(R),length:I,width:A,lastRepeatIndex:T}}const _=Ty(n,s),y={displayText:i??"",conditionalColor:_?r(_):null,repeatChars:a??P.EmptyArray,spacingChars:c??P.EmptyArray,repeatPlaceholder:l,formattedRuns:f,canWrap:w,asDate:h,isDateFormat:u,isTimeFormat:d,isDate1904:o};return Object.freeze(y)},kC=Object.freeze({fallbacks:P.EmptyArray,weight:400,style:Be.Style.Normal,fill:V.Scheme.Tx1,letterSpacing:null,underline:Be.UnderlineStyle.None,strike:!1,scheme:Be.Scheme.Minor,verticalAlign:Be.VerticalAlignment.Baseline,shadow:!1,outline:!1,extend:!1}),qr=Object.freeze({style:Ce.StrokeStyle.None}),FC=Object.freeze({[Ce.Edge.Top]:qr,[Ce.Edge.Left]:qr,[Ce.Edge.Bottom]:qr,[Ce.Edge.Right]:qr,[Ce.Edge.Horizontal]:qr,[Ce.Edge.Vertical]:qr,[Ce.Edge.DiagonalUp]:qr,[Ce.Edge.DiagonalDown]:qr}),NC=Object.freeze({horizontal:ce.HorizontalAlignment.General,vertical:ce.VerticalAlignment.Bottom,indent:0,relativeIndent:0,overflow:ce.Overflow.Visible,rotation:0,stacked:!1,quotePrefix:!1,justifyLastLine:!1,readingOrder:ce.ReadingDirection.Auto,readingDirection:ce.ReadingDirection.Auto}),OC=Object.freeze({locked:!1,formulaHidden:!1}),RS=Object.freeze({fill:Object.freeze({type:He.Type.None}),numberFormat:"General",alignment:NC,font:kC,border:FC,protection:OC,quotePrefix:!1,namedStyle:null}),DC=(()=>{const s=[{named:Qe.BuiltInName.Normal},{named:Qe.BuiltInName.RowLevel},{named:Qe.BuiltInName.ColLevel},{named:Qe.BuiltInName.Comma,numberFormat:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)'},{named:Qe.BuiltInName.Currency,numberFormat:'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)'},{named:Qe.BuiltInName.Percent,numberFormat:"0%"},{named:Qe.BuiltInName.Comma0,numberFormat:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)'},{named:Qe.BuiltInName.Currency0,numberFormat:'_($* #,##0_);_($* (#,##0);_($* "-"_);_(@_)'},{named:Qe.BuiltInName.Hyperlink,font:{fill:V.Scheme.Hlink,underline:Be.UnderlineStyle.Single}},{named:Qe.BuiltInName.FollowedHyperlink,font:{fill:V.Scheme.FolHlink,underline:Be.UnderlineStyle.Single}},{named:Qe.BuiltInName.Note,fill:"FFFFFFCC",font:{style:Be.Style.Normal,fill:V.Scheme.Tx1},border:{left:{style:Ce.StrokeStyle.Thin,color:"FFB2B2B2"},top:{style:Ce.StrokeStyle.Thin,color:"FFB2B2B2"},right:{style:Ce.StrokeStyle.Thin,color:"FFB2B2B2"},bottom:{style:Ce.StrokeStyle.Thin,color:"FFB2B2B2"}}},{named:Qe.BuiltInName.WarningText,font:{fill:"FFFF0000"}},{named:Qe.BuiltInName.Unknown12},{named:Qe.BuiltInName.Unknown13},{named:Qe.BuiltInName.Unknown14},{named:Qe.BuiltInName.Title,font:{size:18,fill:V.Scheme.Tx2}},{named:Qe.BuiltInName.Heading1,font:{size:15,weight:"bold",fill:V.Scheme.Tx2},border:{bottom:{style:Ce.StrokeStyle.Thick,color:V.Scheme.Accent1}}},{named:Qe.BuiltInName.Heading2,font:{size:13,weight:"bold",fill:V.Scheme.Tx2},border:{bottom:{style:Ce.StrokeStyle.Thick,color:"accent1 lumMod 40, lumOff 60"}}},{named:Qe.BuiltInName.Heading3,font:{weight:"bold",fill:V.Scheme.Tx2},border:{bottom:{style:Ce.StrokeStyle.Medium,color:"accent1 lumMod 40, lumOff 60"}}},{named:Qe.BuiltInName.Heading4,font:{weight:"bold",fill:V.Scheme.Tx2}},{named:Qe.BuiltInName.Input,fill:"FFFFCC99",font:{fill:"FF3F3F76"},border:{left:{style:Ce.StrokeStyle.Thin,color:"FF7F7F7F"},top:{style:Ce.StrokeStyle.Thin,color:"FF7F7F7F"},right:{style:Ce.StrokeStyle.Thin,color:"FF7F7F7F"},bottom:{style:Ce.StrokeStyle.Thin,color:"FF7F7F7F"}}},{named:Qe.BuiltInName.Output,fill:"FFF2F2F2",font:{fill:"FF3F3F3F"},border:{left:{style:Ce.StrokeStyle.Thin,color:"FF3F3F3F"},top:{style:Ce.StrokeStyle.Thin,color:"FF3F3F3F"},right:{style:Ce.StrokeStyle.Thin,color:"FF3F3F3F"},bottom:{style:Ce.StrokeStyle.Thin,color:"FF3F3F3F"}}},{named:Qe.BuiltInName.Calculation,fill:"FFF2F2F2",font:{fill:"FFFA7D00"},border:{left:{style:Ce.StrokeStyle.Thin,color:"FF7F7F7F"},top:{style:Ce.StrokeStyle.Thin,color:"FF7F7F7F"},right:{style:Ce.StrokeStyle.Thin,color:"FF7F7F7F"},bottom:{style:Ce.StrokeStyle.Thin,color:"FF7F7F7F"}}},{named:Qe.BuiltInName.CheckCell,fill:"FFA5A5A5",font:{fill:V.Scheme.Bg1},border:{left:{style:Ce.StrokeStyle.Double,color:"FF3F3F3F"},top:{style:Ce.StrokeStyle.Double,color:"FF3F3F3F"},right:{style:Ce.StrokeStyle.Double,color:"FF3F3F3F"},bottom:{style:Ce.StrokeStyle.Double,color:"FF3F3F3F"}}},{named:Qe.BuiltInName.LinkedCell,font:{fill:"FFFA7D00"},border:{bottom:{style:Ce.StrokeStyle.Double,color:"FFFF8001"}}},{named:Qe.BuiltInName.Total,font:{weight:"bold",fill:V.Scheme.Tx1},border:{top:{style:Ce.StrokeStyle.Thin,color:V.Scheme.Accent1},bottom:{style:Ce.StrokeStyle.Double,color:V.Scheme.Accent1}}},{named:Qe.BuiltInName.Good,fill:"FFC6EFCE",font:{fill:"FF006100"}},{named:Qe.BuiltInName.Bad,fill:"FFFFC7CE",font:{fill:"FF9C0006"}},{named:Qe.BuiltInName.Neutral,fill:"FFFFEB9C",font:{fill:"FF9C5700"}},{named:Qe.BuiltInName.Accent1},{named:Qe.BuiltInName.Accent1_20},{named:Qe.BuiltInName.Accent1_40},{named:Qe.BuiltInName.Accent1_60},{named:Qe.BuiltInName.Accent2},{named:Qe.BuiltInName.Accent2_20},{named:Qe.BuiltInName.Accent2_40},{named:Qe.BuiltInName.Accent2_60},{named:Qe.BuiltInName.Accent3},{named:Qe.BuiltInName.Accent3_20},{named:Qe.BuiltInName.Accent3_40},{named:Qe.BuiltInName.Accent3_60},{named:Qe.BuiltInName.Accent4},{named:Qe.BuiltInName.Accent4_20},{named:Qe.BuiltInName.Accent4_40},{named:Qe.BuiltInName.Accent4_60},{named:Qe.BuiltInName.Accent5},{named:Qe.BuiltInName.Accent5_20},{named:Qe.BuiltInName.Accent5_40},{named:Qe.BuiltInName.Accent5_60},{named:Qe.BuiltInName.Accent6},{named:Qe.BuiltInName.Accent6_20},{named:Qe.BuiltInName.Accent6_40},{named:Qe.BuiltInName.Accent6_60},{named:Qe.BuiltInName.ExplanatoryText,font:{style:Be.Style.Italic,fill:"FF7F7F7F"}}];for(let e=29;e<=52;e++){const t=(e-29)%4,n=Math.floor((e-29)/4);let r="";t===1?r=" lumMod 20, lumOff 80":t===2?r=" lumMod 40, lumOff 60":t===3&&(r=" lumMod 60, lumOff 40"),s[e].fill=`accent${n+1}${r}`,s[e].font={fill:t===0?V.Scheme.Bg1:V.Scheme.Tx1}}return P.deepFreeze(s)})(),LC=new class{_svgImage(s,e,t,n=8){return{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='${n}' height='${n}' viewBox='0 0 ${n} ${n}' shape-rendering='crispEdges' %3E%3Cpath d='${t}' stroke='${s}' %3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"repeat",backgroundSize:`${n}px ${n}px`,backgroundPositionX:"0px",backgroundPositionY:"0px",backgroundPosition:""+-n,backgroundColor:e}}toCSS(s,e,t){return s&&s!==He.BuiltInSheetPattern.None?s===He.BuiltInSheetPattern.Solid?{background:t}:s===He.BuiltInSheetPattern.Gray0625?this._svgImage(e,t,"M 0.5 0.5 L 0.5 1.5 M 0.5 4.5 L 0.5 5.5 M 4.5 2.5 L 4.5 3.5 M 4.5 6.5 L 4.5 7.5",8):s===He.BuiltInSheetPattern.LightGray?this._svgImage(e,t,"M 0.5 0.5 L 0.5 1.5 M 0.5 2.5 L 0.5 3.5 M 2.5 -0.5 L 2.5 0.5 M 2.5 1.5 L 2.5 2.5 M 2.5 3.5 L 2.5 4.5",4):s===He.BuiltInSheetPattern.MediumGray?this._svgImage(e,t,"M 0.5 0.5 L 0.5 1.5 M 1.5 1.5 L 1.5 2.5 M 1.5 -0.5 L 1.5 0.5 M -0.5 -0.5 L -0.5 0.5",2):s===He.BuiltInSheetPattern.DarkGray?this._svgImage(e,t,"M 0 0 L 0 4  M 1 1 L 1 2 M 1 3 L 1 4  M 2 0 L 2 4  M 3 0.5 L 3 1.5 M 3 2.5 L 3 3.5 M 4 0 L 4 4",4):s===He.BuiltInSheetPattern.LightHorizontal?this._svgImage(e,t,"M 0 2 L 4 2",4):s===He.BuiltInSheetPattern.DarkHorizontal?this._svgImage(e,t,"M 0 2 L 4 2 M 0 3 L 4 3",4):s===He.BuiltInSheetPattern.LightVertical?this._svgImage(e,t,"M 2 0 L 2 4",4):s===He.BuiltInSheetPattern.DarkVertical?this._svgImage(e,t,"M 2 0 L 2 4 M 3 0 L 3 4",4):s===He.BuiltInSheetPattern.LightUp?this._svgImage(e,t,"M 0.5 0.5 L 0.5 1.5 M 1.5 3.5 L 1.5 4.5 M 1.5 -0.5 L 1.5 0.5 M 2.5 2.5 L 2.5 3.5 M 3.5 1.5 L 3.5 2.5",4):s===He.BuiltInSheetPattern.DarkUp?this._svgImage(e,t,"M 0.5 -0.5 L 0.5 1.5 M 0.5 3.5 L 0.5 4.5  M 1.5 2.5 L 1.5 4.5  M 2.5 1.5 L 2.5 3.5  M 3.5 0.5 L 3.5 2.5 M 1.5 -0.5 L 1.5 0.5",4):s===He.BuiltInSheetPattern.LightDown?this._svgImage(e,t,"M 0.5 0 L 0.5 1 M 1.5 1 L 1.5 2 M 2.5 2 L 2.5 3 M 3.5 3 L 3.5 4",4):s===He.BuiltInSheetPattern.DarkDown?this._svgImage(e,t,"M 0.5 -0.5 L 0.5 2 M 1.5 1 L 1.5 3 M 2.5 2 L 2.5 4 M 3.5 3 L 3.5 5 M 3.5 -0.5 L 3.5 1.0",4):s===He.BuiltInSheetPattern.LightGrid?this._svgImage(e,t,"M 1.5 -0.5 L 1.5 4.5 M -0.5 1.5 L 4.5 1.5",4):s===He.BuiltInSheetPattern.DarkGrid?this._svgImage(e,t,"M 0.5 -0.5 L 0.5 1.5 M 1.5 -0.5 L 1.5 1.5 M 2.5 1.5 L 2.5 3.5 M 3.5 1.5 L 3.5 3.5 M 0.5 3.5 L 0.5 4.5 M 1.5 3.5 L 1.5 4.5",4):s===He.BuiltInSheetPattern.LightTrellis?this._svgImage(e,t,"M 0.5 0.5 L 0.5 1.5 M 1.5 3.5 L 1.5 4.5 M 1.5 -0.5 L 1.5 0.5 M 2.5 2.5 L 2.5 3.5 M 3.5 1.5 L 3.5 2.5 M 1.5 1.5 L 1.5 2.5 M 3.5 3.5 L 3.5 4.5 M 3.5 -0.5 L 3.5 0.5",4):s===He.BuiltInSheetPattern.DarkTrellis?this._svgImage(e,t,"M 0 0 L 4 0 M 0 1 L 2 1   M 0 2 L 4 2  M 2 3 L 4 3    M 0 4 L 4 4",4):(He.BuiltInSheetPattern.Custom,this._svgImage(e,t,"M 0.5 0.5 L 0.5 1.5 M 0.5 4.5 L 0.5 5.5 M 2.5 2.5 L 2.5 3.5 M 2.5 6.5 L 2.5 7.5 M 4.5 0.5 L 4.5 1.5 M 4.5 4.5 L 4.5 5.5 M 6.5 2.5 L 6.5 3.5 M 6.5 6.5 L 6.5 7.5",8)):{background:"none"}}},ec=(s,e,t)=>{if(e===void 0)return;if(e===null)return null;if(e.isIStyle)return e._p.getProperties();let n=null;return typeof e=="function"?n=e(typeof t=="function"?t():t):n=e,n};class BC{constructor(e){this._p=Object.freeze(Array.isArray(e)?e:[e??null])}value(e){const t=this._p;for(let n=t.length-1;n>=0;n--){const r=t[n];if(!r)continue;const o=r[e];if(o!==void 0)return o}}values(e){const t=this._p,n=t.length;let r;for(let o=0;o<n;o++){const i=t[o];if(!i)continue;const l=i[e];l!==void 0&&(r===void 0&&(r=[]),r.push(l))}return r}getProperties(){const e=this._p;return e?e[e.length-1]:null}toJSON(){const e=this._p,t=e.length;let n={};for(let r=0;r<t;r++){const o=e[r];n=P.deepMerge(n,o)}return n}}class Hr{constructor(e,t){this._o=e,this._c=e.styles,this._p=Object.freeze(t)}_setValue(e,t){const n={[e]:t};this._o.updater(n)}_value(e){const t=this._p;for(let n=t.length-1;n>=0;n--){const r=t[n];if(!r)continue;const o=r[e];if(o!==void 0)return o}}_values(e){const t=this._p,n=t.length;let r;for(let o=0;o<n;o++){const i=t[o];if(!i)continue;const l=i[e];l!==void 0&&(r===void 0&&(r=[]),r.push(l))}return r}getProperties(){const e=this._p;return e?e[e.length-1]:null}toJSON(){return null}}class Zo extends Hr{constructor(e,t,n){super(t,n),this._edge=e}getStyle(){return this._value("style")}setStyle(e,t){const n=this._edge,r=n.charAt(0).toUpperCase()+n.slice(1);return this._o.updater({border:{[n]:{style:e}}},{description:`Set ${r} Border Style`,...t}).getBorder()["get"+r]()}getColor(){const e=this._value("color");return e?this._c.parseColor(e):null}setColor(e,t){const n=this._edge,r=n.charAt(0).toUpperCase()+n.slice(1);return this._o.updater({border:{[n]:{color:e}}},{description:`Set ${r} Border Color`,...t}).getBorder()["get"+r]()}isNone(){return this.getStyle()===Ce.StrokeStyle.None}toCSS(){const e=wo(this);switch(this._edge){case Ce.Edge.Left:return{borderLeft:e};case Ce.Edge.Right:return{borderRight:e};case Ce.Edge.Top:return{borderTop:e};case Ce.Edge.Bottom:return{borderBottom:e};case Ce.Edge.DiagonalUp:case Ce.Edge.DiagonalDown:return{borderDiagonalUp:e}}}get[Symbol.toStringTag](){return"[CellBorderStroke]"}toString(){return"[CellBorderStroke]"}get isIStroke(){return!0}}class zC extends Hr{getLeft(){return new Zo(Ce.Edge.Left,this._o,this._values(Ce.Edge.Left))}setLeft(e,t){return this._o.updater({border:{left:e}},{description:"Set Left Border",...t}).getBorder()}getRight(){return new Zo(Ce.Edge.Right,this._o,this._values(Ce.Edge.Right))}setRight(e,t){return this._o.updater({border:{right:e}},{description:"Set Right Border",...t}).getBorder()}getTop(){return new Zo(Ce.Edge.Top,this._o,this._values(Ce.Edge.Top))}setTop(e,t){return this._o.updater({border:{top:e}},{description:"Set Top Border",...t}).getBorder()}getBottom(){return new Zo(Ce.Edge.Bottom,this._o,this._values(Ce.Edge.Bottom))}setBottom(e,t){return this._o.updater({border:{bottom:e}},{description:"Set Bottom Border",...t}).getBorder()}getDiagonalUp(){return new Zo(Ce.Edge.DiagonalUp,this._o,this._values(Ce.Edge.DiagonalUp))}setDiagonalUp(e,t){return this._o.updater({border:{diagonalUp:e}},{description:"Set Diagonal Up Border",...t}).getBorder()}getDiagonalDown(){return new Zo(Ce.Edge.DiagonalDown,this._o,this._values(Ce.Edge.DiagonalDown))}setDiagonalDown(e,t){return this._o.updater({border:{diagonalDown:e}},{description:"Set Diagonal Down Border",...t}).getBorder()}isEmpty(){return!1}get[Symbol.toStringTag](){return"[CellBorder]"}toString(){return"[CellBorder]"}get isIBorder(){return!0}}class PC extends Hr{getHorizontal(){return this._value("horizontal")}setHorizontal(e,t){return this._o.updater({alignment:{horizontal:e}},{description:"Set Horizontal Alignment",...t}).getAlignment()}getVertical(){return this._value("vertical")}setVertical(e,t){return this._o.updater({alignment:{vertical:e}},{description:"Set Vertical Alignment",...t}).getAlignment()}getIndent(){return this._value("indent")}setIndent(e,t){return this._o.updater({alignment:{indent:e}},{description:"Set Indent",...t}).getAlignment()}getRelativeIndent(){return this._value("relativeIndent")}setRelativeIndent(e,t){return this._o.updater({alignment:{relativeIndent:e}},{description:"Set Relative Indent",...t}).getAlignment()}getOverflow(){return this._value("overflow")}setOverflow(e,t){return this._o.updater({alignment:{overflow:e}},{description:"Set Overflow",...t}).getAlignment()}getRotation(){return this._value("rotation")}setRotation(e,t){return this._o.updater({alignment:{rotation:e}},{description:"Set Rotation",...t}).getAlignment()}getStacked(){return this._value("stacked")}setStacked(e,t){return this._o.updater({alignment:{stacked:e}},{description:"Set Stacked",...t}).getAlignment()}getJustifyLastLine(){return this._value("justifyLastLine")}setJustifyLastLine(e,t){return this._o.updater({alignment:{justifyLastLine:e}},{description:"Set Justify Last Line",...t}).getAlignment()}getReadingDirection(){return this._value("readingDirection")}setReadingDirection(e,t){return this._o.updater({alignment:{readingDirection:e}},{description:"Set Reading Direction",...t}).getAlignment()}get[Symbol.toStringTag](){return"[CellAlignment]"}toString(){return"[CellAlignment]"}get isITextBoxAlignment(){return!0}}class HC extends Hr{isEqualMeasure(e){return!!e&&this.getFamily()===e.getFamily()&&!!P.isEqualArrays(this.getFallbacks(),e.getFallbacks())&&this.getSize()===e.getSize()&&this.getWeight()===e.getWeight()&&this.getStyle()===e.getStyle()&&this.getStrike()===e.getStrike()&&this.getScheme()===e.getScheme()&&this.getShadow()===e.getShadow()&&this.getOutline()===e.getOutline()&&this.getLetterSpacing()===e.getLetterSpacing()&&this.getVerticalAlignment()===e.getVerticalAlignment()}toCSS(e,t=1,n=!1){const r={fontFamily:Ta(this.getFamily(),this.getFallbacks()),letterSpacing:`${this.getLetterSpacing()}px`,fontWeight:this.getWeight(),fontStyle:this.getStyle(),textDecoration:pS(this.getUnderline(),this.getStrike()),color:this.getFill().toCSS(e),fontSize:`${P.roundAccurately(this.getSize()*Be.getDeviceScale()*t,2)}px`,textRendering:"geometricPrecision"};if(n){const o=this._c.getNormal().getFont().toCSS(e,t,!1),i=r.textDecoration,l=r.fontWeight;P.removeEqualValues(r,o),i&&(r.textDecoration=i),l&&(r.fontWeight=l)}return r}isSuperSub(){const e=this.getVerticalAlignment();return e===Be.VerticalAlignment.Sub||e===Be.VerticalAlignment.Super}isSuperScript(){const e=this.getVerticalAlignment();return e===Be.VerticalAlignment.Sub||e===Be.VerticalAlignment.Super}getSuperSubScale(){return this.getFamily(),this.getSize(),this.getVerticalAlignment(),.6}getSuperSubShift(){return this.getFamily(),e=this.getSize(),(t=this.getVerticalAlignment())===Be.VerticalAlignment.Super?-e/3:t===Be.VerticalAlignment.Sub?e/5:0;var e,t}getFamily(){return this._value("family")??this._c.getTheme().getFontScheme().getMinorFont()}setFamily(e,t){return this._o.updater({font:{family:e}},{description:"Set Font Family",...t}).getFont()}getFallbacks(){let e=this._value("fallbacks")??this._c.getTheme().getFontScheme().getMinorFallbacks()??P.EmptyArray;return this.getFamily()==="Aptos Narrow"&&(e=["Calibri",...e]),e}setFallbacks(e,t){return this._o.updater({font:{fallbacks:e}},{description:"Set Font Fallbacks",...t}).getFont()}getSize(){return this._value("size")??this._c.getDefaultFontSize()??11}setSize(e,t){return this._o.updater({font:{size:e}},{description:"Set Font Size",...t}).getFont()}getWeight(){return this._value("weight")}setWeight(e,t){return this._o.updater({font:{weight:e}},{description:"Set Font Weight",...t}).getFont()}getStyle(){return this._value("style")}setStyle(e,t){return this._o.updater({font:{style:e}},{description:"Set Font Style",...t}).getFont()}getFill(){const e=this._value("fill");return this._c.parseColor(e??V.Scheme.Bg1)}setFill(e,t){return this._o.updater({font:{fill:e}},{description:"Set Font Fill",...t}).getFont()}getLetterSpacing(){return this._value("letterSpacing")??this.getSize()/-25}setLetterSpacing(e,t){return this._o.updater({font:{letterSpacing:e}},{description:"Set Font Letter Spacing",...t}).getFont()}getUnderline(){return this._value("underline")}setUnderline(e,t){return this._o.updater({font:{underline:e}},{description:"Set Font Underline",...t}).getFont()}getStrike(){return this._value("strike")}setStrike(e,t){return this._o.updater({font:{strike:e}},{description:"Set Font Strike",...t}).getFont()}getScheme(){return this._value("scheme")}setScheme(e,t){return this._o.updater({font:{scheme:e}},{description:"Set Font Scheme",...t}).getFont()}getVerticalAlignment(){return this._value("verticalAlign")}setVerticalAlignment(e,t){return this._o.updater({font:{verticalAlign:e}},{description:"Set Font Vertical Alignment",...t}).getFont()}getShadow(){return this._value("shadow")}setShadow(e,t){return this._o.updater({font:{shadow:e}},{description:"Set Font Shadow",...t}).getFont()}getOutline(){return this._value("outline")}setOutline(e,t){return this._o.updater({font:{outline:e}},{description:"Set Font Outline",...t}).getFont()}getExtend(){return this._value("extend")}setExtend(e,t){return this._o.updater({font:{extend:e}},{description:"Set Font Extend",...t}).getFont()}get[Symbol.toStringTag](){return"[StyledFont]"}toString(){return"[StyledFont]"}get isIStyledFont(){return!0}}const $C=Object.freeze({background:"none"});class Uf extends Hr{getType(){return He.Type.None}toCSS(e){return $C}toJSON(){return{type:He.Type.None}}get[Symbol.toStringTag](){return"[NoneFill]"}toString(){return"[NoneFill]"}get isIFill(){return!0}}class VC extends Hr{getType(){return He.Type.Solid}getColor(){return this._c.parseColor(this._value("color")??V.Scheme.Bg1)}setColor(e,t){return this._o.updater({fill:{color:e}},{description:"Set Fill Color",...t}).getFill()}toCSS(e){return{background:this.getColor().toCSS(e)}}toJSON(){return{type:He.Type.Solid,color:this.getColor()?.toString()??null}}get[Symbol.toStringTag](){return"[SolidFill]"}toString(){return"[SolidFill]"}get isIFill(){return!0}}class WC extends Hr{constructor(e,t,n,r){super(n,r),this._i=e,this._l=t}getOffset(){return this._value("offset")??this._i/this._l*100}getColor(){return this._c.parseColor(this._value("color")??V.Scheme.Bg1)}}class jC extends Hr{getType(){return He.Type.Gradient}getStops(){const e=this._value("stops")??P.EmptyArray,t=e.length,n=t===0?P.EmptyArray:new Array(t);for(let r=0;r<t;r++){const o=e[r];n[r]=new WC(r,t,this._o,[o])}return n}setStops(e,t){return this._o.updater({fill:{stops:e}},{description:"Set Stops",...t}).getFill()}getGradientType(){return this._value("gradientType")??He.GradientType.Linear}setGradientType(e,t){return this._o.updater({fill:{gradientType:e}},{description:"Set Gradient Type",...t}).getFill()}getAngle(){return this._value("angle")??0}setAngle(e,t){return this._o.updater({fill:{angle:e}},{description:"Set Angle",...t}).getFill()}getFillTo(){return this._value("fillTo")??null}setFillTo(e,t){return this._o.updater({fill:{fillTo:e}},{description:"Set Fill To",...t}).getFill()}toCSS(e,t){const n=_S(this,e,t);return n?{background:n}:null}toJSON(){const e={type:He.Type.Gradient},t=this._value("stops")??P.EmptyArray,n=t.length;if(n>0){const r=new Array(n);for(let o=0;o<n;o++){const i=t[o],l={color:i.color.toString()},a=i.offset;a!==void 0&&(l.offset=a),r[o]=l}e.stops=r}return this.getAngle()!==0&&(e.angle=this.getAngle()),this.getGradientType()!==He.GradientType.Linear&&(e.gradientType=this.getGradientType()),this.getFillTo()&&(e.fillTo=this.getFillTo()),e}get[Symbol.toStringTag](){return"[GradientFill]"}toString(){return"[GradientFill]"}get isIFill(){return!0}}class GC extends Hr{getType(){return He.Type.Pattern}getBackground(){const e=this._value("background")??V.Named.Window;return this._c.parseColor(e)}setBackground(e,t){return this._o.updater({fill:{background:e}},{description:"Set Background Color",...t}).getFill()}getForeground(){return this._c.parseColor(this._value("foreground")??V.Scheme.Tx1)}setForeground(e,t){return this._o.updater({fill:{foreground:e}},{description:"Set Foreground Color",...t}).getFill()}getPatternType(){return this._value("patternType")??He.BuiltInSheetPattern.None}setPatternType(e,t){return this._o.updater({fill:{patternType:e}},{description:"Set Pattern Type",...t}).getFill()}toCSS(e){const t=this.getBackground().toCSS(e),n=this.getForeground().toCSS(e);return this.getPatternType()===He.BuiltInSheetPattern.None?{background:"none"}:this.getPatternType()===He.BuiltInSheetPattern.Solid?{background:this.getForeground().toCSS(e)}:LC.toCSS(this.getPatternType(),n,t)}toJSON(){const e={type:He.Type.Pattern};this.getPatternType()!==He.BuiltInSheetPattern.None&&(e.patternType=this.getPatternType());const t=this.getForeground();t&&(e.foreground=t.toString());const n=this.getBackground();return n&&(e.background=n.toString()),e}get[Symbol.toStringTag](){return"[PatternFill]"}toString(){return"[PatternFill]"}get isIFill(){return!0}}class IS{constructor(e){this._o=e,this._p=new BC(e.properties),this._hasVisibleStyling=!this.getFill()||this.getFill().getType()!==He.Type.None||!this.getBorder().isEmpty()}toJSON(){const e=this._p.toJSON(),t=e.namedStyle??Qe.BuiltInName.Normal;return delete e.namedStyle,e.named=t,e}hasVisibleStyling(){return this._hasVisibleStyling}isNormal(){return!1}createTemporaryStyle(e){const t=this._o,n=t.styles,r=ec(0,e,this),o=t.range,i=t.direct.cloneWithUpdate(r);return xs(n,i,o)}measureText(e,t=this.getFont().getSize(),n,r){const o=this.getFont();n||(n=o.getFamily());let i=o.getFallbacks();n==="Aptos Narrow"&&(i=["Calibri",...i]);const l=Ta(n,i);return Be.getSharedMeasurer()(e,t*Be.getDeviceScale(),l,{isBold:o.getWeight()>400,isItalic:o.getStyle().includes("italic"),letterSpacing:o.getLetterSpacing(),...r})}createTemporaryTextFrame(e,t=!1){return Ka(e,this.getFont(),this.getAlignment(),t)}update(e,t){return this._o.updater(e,t)}getBestFit(){if(this._bestFit!==void 0)return this._bestFit;const e=this.getInsets(),t=this.measureText("My");return this._bestFit={width:null,height:t.lineHeight+e.top+e.bottom},this._bestFit}getInsets(){if(this._insets!==void 0)return this._insets;const e=(this.getFont().getSize(),1),t=(n=this.getFont().getSize(),Math.max(2,Math.round(n<225?n/5:n/3.5)));var n;const r={top:e,left:t,bottom:e,right:t},o=this._p,i=o?.value("insets");return i&&(i.top!==void 0&&(r.top+=i.top),i.left!==void 0&&(r.left+=i.left),i.bottom!==void 0&&(r.bottom+=i.bottom),i.right!==void 0&&(r.right+=i.right)),this._insets=Object.freeze(r),this._insets}getBorder(){return new zC(this._o,this._p.values("border"))}setBorder(e,t){return this._o.updater({border:e},{description:"Set Border",...t})}getFont(){return new HC(this._o,this._p.values("font"))}setFont(e,t){return this._o.updater({font:e},{description:"Set Font",...t})}getFill(){const e=this._p;let t=e.values("fill"),n=e.value("fill");return n.type===He.Type.None?new Uf(this._o,t):n.type===He.Type.Solid||!n.type&&n.color?new VC(this._o,t):n.type===He.Type.Gradient?new jC(this._o,t):n.type===He.Type.Pattern?new GC(this._o,t):new Uf(this._o,t)}setFill(e,t){return this._o.updater({fill:e},{description:"Set Fill",...t})}getAlignment(){return new PC(this._o,this._p.values("alignment"))}setAlignment(e,t){return this._o.updater({alignment:e},{description:"Set Alignment",...t})}getNumberFormat(){const e=this._p.value("numberFormat");return typeof e=="number"?eh(e):e}setNumberFormat(e,t){return this._o.updater({numberFormat:e},{description:"Set Number Format",...t})}getQuotePrefix(){return this._p.value("quotePrefix")}setQuotePrefix(e,t){return this._o.updater({quotePrefix:e},{description:"Set Quote Prefix",...t})}getNamed(){const e=this._p.value("named")??Qe.BuiltInName.Normal;return this._o.styles.getNamed(e)}setNamed(e,t){return this._o.updater({named:e},{description:"Set Named Style",...t})}get[Symbol.toStringTag](){return"[SheetCellStyle]"}toString(){return null}get isIStyle(){return!0}}const xs=(s,e,t,n=qC)=>{const r=t?.rowStart??q.EmptyCell.rowIndex,o=t?.colStart??q.EmptyCell.colIndex,i=[RS],l=s.getNormalRanged(),a=l.getPropertiesAt(r,o,null);a&&i.push(a);const c=(d,h)=>n(d,h,t);if(!e)return new UC({styles:s,range:t,properties:i,layerTypes:null,direct:l,updater:c});const u=e.getPropertiesAt(r,o,null);return u&&i.push(u),new IS({styles:s,range:t,properties:i,direct:e,updater:c})};class UC extends IS{isNormal(){return!0}}const qC=s=>{throw new Error("Style is read-only and cannot be updated")},fo=(s,e)=>{if(s&&!e||e&&!s)return!1;if(s===e)return!0;if(s.style!==e.style)return!1;if(s.color===e.color)return!0;let t=s.color;(s&&s.color).isIColor&&(t=s.color.toString());let n=e.color;return(e&&e.color).isIColor&&(n=e.color.toString()),t===n};class Yt{constructor(e,t,n,r,o){this._c=e,this._r=t,this._p=n??null,this._t=r??null,this._o=o??B.Orientations.Both,this._e=this._p===null||Object.keys(this._p).length===1&&this._p.named===Qe.BuiltInName.Normal}isEmpty(){return this._e}getProperties(){return this._p}getCoords(){return this._r}cloneWithUpdate(e){if(e===void 0)return this;const t=this._c,n=this._r,r=this._p,o=Vt.resolveTypedUpdates(e,Wt,t,r);return new Yt(t,n,o,this._t,this._o)}copyTo(e,t){const n=this._c,r=this._r,o=e.rowStart-r.rowStart,i=e.colStart-r.colStart;let l=null;return q.isEqualRanges(r,this._t)||(l=q.translateRange(r,o,i)),new Yt(n,e,this._p,l,this._o)}canTile(e,t){return!this._p.border}_createShifted(e){return new Yt(this._c,e,this._p,this._t,this._o)}getShifted(e){return e.after?{...e.after,value:this._createShifted(q.sanitizeRange(e.after))}:null}getSplit(e,t){const n=this._c,r=this._p,o=this._r;let i=r;const l=e[0];let a=r;const c=e[1],u=r?r.border:null;if(u){const f=t===B.Orientation.Column;if(f?u.left!==void 0||u.right!==void 0||u.vertical!==void 0:u.top!==void 0||u.bottom!==void 0||u.horizontal!==void 0){i={...i};const g=this._splitBorderRange(u,o,l,f);g?i.border=g:g===null&&delete i.border,a={...a};const m=this._splitBorderRange(u,o,c,f);m?a.border=m:m===null&&delete a.border}}const d=this._t,h=this._o;return[new Yt(n,e[0],i,d,h),new Yt(n,e[1],a,d,h)]}getMerged(e,t,n){const r=n===B.Orientation.Column,o=this._p,i=e._p;if(o&&!i||i&&!o||!o&&!i)return;let l=Object.keys(o),a=Object.keys(i);const c=l.length;if(c!==a.length)return;for(let f=0;f<c;f++){const g=l[f];if(g==="border")continue;const m=o[g],p=i[g];if(!P.deepEqual(m,p))return}const u=o.border,d=i.border;if(u&&!d||d&&!u)return;const h=this._c;if(u||d){const f=r?Ce.Edge.Top:Ce.Edge.Left,g=r?Ce.Edge.Bottom:Ce.Edge.Right;if(!fo(u[f],d[f])||!fo(u[g],d[g]))return;const m=this._r,p=e._r,S=1+(r?m.rowEnd-m.rowStart:m.colEnd-m.colStart),w=1+(r?m.colEnd-m.colStart:m.rowEnd-m.rowStart),b=1+(r?p.colEnd-p.colStart:p.rowEnd-p.rowStart),C=r?Ce.Edge.Horizontal:Ce.Edge.Vertical;if(S>1&&!fo(u[C],d[C]))return;const _=r?Ce.Edge.Right:Ce.Edge.Bottom,y=r?Ce.Edge.Left:Ce.Edge.Top;if(!fo(u[_],d[y]))return;const v=r?Ce.Edge.Vertical:Ce.Edge.Horizontal,x=u[_];if(w>1&&!fo(x,u[v]))return;const E=b===1?d[y]:d[v];if(b>1&&!fo(E,d[v])||!fo(x,E))return;const R={border:{[f]:u[f],[g]:u[g],[C]:u[C],[v]:x,[y]:u[y],[_]:d[_]}},I=Vt.resolveTypedUpdates(R,Wt,h,o);return new Yt(h,t,I,this._t,this._o)}return new Yt(h,t,this._p,this._t,this._o)}hasTrailingEdge(){return!0}isMergeOnShift(){return!0}_splitBorderRange(e,t,n,r){const o=r?Ce.Edge.Left:Ce.Edge.Top,i=r?Ce.Edge.Right:Ce.Edge.Bottom,l=r?Ce.Edge.Vertical:Ce.Edge.Horizontal,a=r?t.colStart:t.rowStart,c=r?t.colEnd:t.rowEnd,u=r?n.colStart:n.rowStart,d=r?n.colEnd:n.rowEnd;let h={...e};return delete h[o],delete h[i],delete h[l],a===u?e[o]&&(h[o]=e[o]):e[l]&&(h[o]=e[l]),c===d?e[i]&&(h[i]=e[i]):e[l]&&(h[i]=e[l]),d-u>0&&e[l]&&(h[l]=e[l]),Object.keys(h).length===0?null:h}_localizeBorderRange(e,t,n){if(!e)return;let r=null;const o=t.rowStart,i=t.rowEnd,l=n.rowStart,a=n.rowEnd;e.top&&l===o&&(r=r??{},r.top=e.top),e.bottom&&a===i&&(r=r??{},r.bottom=e.bottom),e.horizontal&&(a-l>0&&(r=r??{},r.horizontal=e.horizontal),l>o&&(r=r??{},r.top=e.horizontal),a<i&&(r=r??{},r.bottom=e.horizontal));const c=t.colStart,u=t.colEnd,d=n.colStart,h=n.colEnd;return e.left&&d===c&&(r=r??{},r.left=e.left),e.right&&h===u&&(r=r??{},r.right=e.right),e.vertical&&(h-d>0&&(r=r??{},r.vertical=e.vertical),d>c&&(r=r??{},r.left=e.vertical),h<u&&(r=r??{},r.right=e.vertical)),r}_localizeBorder(e,t,n,r){if(!e)return;let o=null;const i=t.rowStart,l=t.rowEnd;e.top&&n===i&&(o=o??{},o.top=e.top),e.bottom&&n===l&&(o=o??{},o.bottom=e.bottom),e.horizontal&&(n>i&&(o=o??{},o.top=e.horizontal),n<l&&(o=o??{},o.bottom=e.horizontal));const a=t.colStart,c=t.colEnd;return e.left&&r===a&&(o=o??{},o.left=e.left),e.right&&r===c&&(o=o??{},o.right=e.right),e.vertical&&(r>a&&(o=o??{},o.left=e.vertical),r<c&&(o=o??{},o.right=e.vertical)),o}getPropertiesAt(e,t,n){const r=this._p;let o=r;const i=this._t;if(i){const a=this._r,c=i.colEnd-i.colStart+1,u=i.rowEnd-i.rowStart+1;t=a.colStart+(t-a.colStart+(i.colStart-a.colStart))%c,e=a.rowStart+(e-a.rowStart+(i.rowStart-a.rowStart))%u}const l=o?.border;if(l){const a=i??this._r,c=this._localizeBorder(l,a,e,t);c!==void 0&&(o===r&&(o={...o}),c===null?delete o.border:o.border=c)}return o}toJSON(){return P.toSafeJSON(this._p)}}const JC=Object.freeze({value:null,style:null,hyperlink:null,formula:null,type:Le.Null,stringToParse:null}),qf=Object.seal({value:void 0,style:void 0,hyperlink:void 0,formula:void 0,type:void 0,stringToParse:void 0}),KC=Object.seal({value:void 0,style:void 0,hyperlink:void 0,formula:void 0}),XC=Object.freeze({width:1,height:1}),ZC=new Cb({max:1e3}),QC=new class{isEditAllowed(){return!0}isFormulaHidden(){return!1}get isICellProtection(){return!0}},vd=(s,e,t=null,n=null,r=!1)=>{if(s===void 0)return;if(s===null)return JC;if(s&&s.isICell){const S=s,w=qf;return w.value=S.getValue(),S.getStyle().isNormal()?w.style=null:w.style=S.getStyle()._p.getProperties(),w.formula=S.getFormulaText(),w.hyperlink=S.getHyperlink(),w.type=S.getType(),w}let o;s.value!==void 0||s.style!==void 0||s.hyperlink!==void 0?o=s:(o=KC,o.value=s,o.style=void 0,o.hyperlink=void 0);const i=qf;i.type=void 0,i.value=void 0,i.style=void 0,i.formula=void 0,i.hyperlink=void 0,i.stringToParse=void 0;let l,a=o.value,c=!1;if(o.value!==void 0&&(l=yn(a),l||(c=As(a),c&&(l=Le.Number)),!l))throw new Error("Invalid cell type. See documentation for information on valid built in cell types and creating custom cell types.");let u,d,h=null,f=null,g;if(l===Le.String){if(g=o.value,t){let S=n?.get(g);if(!S){const w=g.length,b=g.charAt(0);b==="="&&w>1?(d=g.substring(1),a=null):(S=kS(g,t),!S||typeof S.value!="string"||b!=="+"&&b!=="-"||(d="="+g,a=null),S!==void 0&&n&&n.set(g,S))}S&&(S.value!==void 0&&(a=S.value,l=yn(a)),S.style!==void 0&&(h=S.style),S.hyperlink!==void 0&&(u=S.hyperlink)),!r&&t.parse&&(f=g)}}else if(c){const S=t?.date1904??e.date1904;a=$i(o.value,S),h=w=>{if(!Vi(w.getNumberFormat()))return{numberFormat:"Short Date"}}}else a=o.value;let m=o.style;if(m&&m.isIStyle&&(m=m._p.getProperties()),u=o.hyperlink??u,h)if(m){const S=m;m=w=>{let b=w.createTemporaryStyle(h);return b=b.createTemporaryStyle(S),b=b._p.getProperties(),b}}else m=h;let p=!1;return a!==void 0&&(a===null?(i.value=null,i.type=Le.Null):(i.value=a,i.type=l),p=!0),m!==void 0&&(i.style=m,p=!0),u!==void 0&&(i.hyperlink=u,p=!0),d!==void 0&&(i.formula=d,p=!0),r||(i.stringToParse=f,p=!0),p?(i.type=l,i):void 0},AS=(s,e,t,n)=>ES(t,e,s,e.getNumberFormat(),r=>n.styles.parseColor(r),n.date1904),MS=(s,e,t,n,r=!1)=>{if(s===Le.Null)return null;let o="";if(r)o=""+t;else{const i=AS(s,e,t,n);if(i.formattedRuns){const l=i.formattedRuns.runs;for(let a=0;a<l.length;a++)o+=l[a].text}else o=i.displayText}return Ka(o,e.getFont(),e.getAlignment(),s===Le.String,r)},lh=(s,e)=>{const t=e.getInsets();if(s===Le.Null)return t;let n=t;const r=tc(s,e),o=e.getAlignment().getIndent();if(o&&(r===ce.HorizontalAlignment.Left||r===ce.HorizontalAlignment.Right)){n={...t};const i=e.measureText(" ".repeat(1*o)),l=Math.min(3,Math.max(1,(26-e.getFont().getSize())/2));let a=i.width*l;r===ce.HorizontalAlignment.Left?n.left+=a:r===ce.HorizontalAlignment.Right&&(n.right+=a)}return Object.freeze(n)},tc=(s,e)=>{const t=e.getAlignment(),n=t.getRotation(),r=t.getHorizontal();return n!==0&&r===ce.HorizontalAlignment.General?n>0&&n<90||n>180&&n<=270?ce.HorizontalAlignment.Right:ce.HorizontalAlignment.Left:r===ce.HorizontalAlignment.General?s===Le.Null?ce.HorizontalAlignment.Left:s===Le.Boolean||s===Le.Error?ce.HorizontalAlignment.Center:e.getNumberFormat()==="@"?ce.HorizontalAlignment.Left:s===Le.Number?ce.HorizontalAlignment.Right:ce.HorizontalAlignment.Left:r},TS=(s,e,t,n,r,o,i,l,a)=>{if(t===Le.Null||r==="")return null;const c=e;if(!((L,W,$=!1,J=!1)=>{if(L===Le.Null)return!1;const te=W.getAlignment(),Q=te.getHorizontal();if(Q===ce.HorizontalAlignment.CenterContinuous||Q===ce.HorizontalAlignment.Fill)return!0;if(Q===ce.HorizontalAlignment.Distributed||L!==Le.String||te.getOverflow()!==ce.Overflow.Visible||Q===ce.HorizontalAlignment.Right&&$||Q===ce.HorizontalAlignment.Center&&$&&J||J&&(Q===ce.HorizontalAlignment.General||Q===ce.HorizontalAlignment.Left))return!1;const G=te.getVertical();return G!==ce.VerticalAlignment.Justify&&G!==ce.VerticalAlignment.Distributed})(t,n,o!==null&&o.colIndex+1===c,i!==null&&i.colIndex-1===c))return null;const u=ev(t,n,r,a),d=n.getAlignment(),h=d.getHorizontal(),f=d.getOverflow()===ce.Overflow.Wrap||t===Le.String&&(h===ce.HorizontalAlignment.Justify||h===ce.HorizontalAlignment.Distributed||d.getVertical()===ce.VerticalAlignment.Justify||d.getVertical()===ce.VerticalAlignment.Distributed),g=h===ce.HorizontalAlignment.Fill,m=h===ce.HorizontalAlignment.CenterContinuous||g;if(!u&&!m)return null;const p=(L=>L===ce.HorizontalAlignment.Center||L===ce.HorizontalAlignment.CenterContinuous?Et.Center:L===ce.HorizontalAlignment.Right?Et.Right:Et.Left)(tc(t,n));let S=0,w=0,b=0,C=0,_=1;if(m&&r!==null&&l){uu.colIndex=e,uu.rowIndex=s;const L=l.colEnd;_=Math.min(a.nextContentful(uu,L),L)-e+1}const y=a.colHeaders,v=y.findOffset.bind(y),x=y.findIndex.bind(y);let E=v(c);const R=E;let I=v(c+_),A=I-E,T=c,O=c;const N={x:0,y:0,width:A,height:u?.height??0},D=c-c+_;let F=u?u.width-A:0,k=N;return A>0&&F>0&&!f&&(p===Et.Center&&(F/=2),p!==Et.Left&&p!==Et.Center||(O=x(I+F),i!==null&&(O=Math.min(O,i.colIndex-1)),I=v(O),C=F,w=O-c),p!==Et.Right&&p!==Et.Center||(T=x(E-F),o!==null&&(T=Math.max(T,o.colIndex+1)),E=v(T),b=F,S=c-T),N.x=R-E,k.x=N.x),_>1&&(w=p===Et.Center?Math.max(D-1,w):_-1,I=v(c+1),N.width=I-E,k={...N},k.width=A),{anchorBounds:N,leftIndex:S,rightIndex:w,leftOffset:b,rightOffset:C,colSpan:D,colBounds:k}};class YC{constructor(e,t){this._styles=e,this._ri=t;const n=t?.table;n&&(this._table=n.getStyle().getRanged(n));const r=t?.conditionals;if(r){const o=r.length,i=new Array(o);for(let l=0;l<o;l++){const a=r[l];i[l]=a}this._conditionals=i}}getCoords(){return q.EmptyRange}getPropertiesAt(e,t,n){let r=null,o=this._ri.directStyle?.getPropertiesAt(e,t,n)??null;const i=this._styles;if(o&&o.named){const d=o.named;if(d!==Qe.BuiltInName.Normal){const h=this._styles.getNamed(d);h?r=h.getRanged().getPropertiesAt(e,t,n):console.warn(`A named styled was referenced but not found: '${d}'.`)}}let l=null;const a=this._table?.getPropertiesAt(e,t,n);a&&(l=l?Vt.resolveTypedUpdates(a,Wt,i,l):a);let c=null;r&&(c=c?Vt.resolveTypedUpdates(r,Wt,i,c):r),o&&(c=c?Vt.resolveTypedUpdates(o,Wt,i,c):o),c&&(c=i.normalize(c,Qe.BuiltInName.Normal),l=l&&c?Vt.resolveTypedUpdates(c,Wt,i,l):c??l);const u=this._conditionals;if(u){const d=u.length;for(let h=0;h<d;h++){const f=u[h].getPropertiesAt(e,t,n);f&&(l=l?Vt.resolveTypedUpdates(f,Wt,i,l):f)}}return l}cloneWithUpdate(e){return(this._ri.directStyle??this._styles.getNormalRanged()).cloneWithUpdate(e)}}const ls=(s,e,t,n)=>{const r=n.styles;return xs(r,t?new YC(r,t):null,e,n.styleUpdater)},Qr=(s,e,t,n,r,o,i,l=null,a=ZC)=>{if(t===null)return e?e.getBestFit():null;const c=s===Le.String,u=e.getFont(),d=u.getWeight(),h=u.getSize(),f=u.getFamily(),g=e.getAlignment(),m=g.getOverflow(),p=g.getRotation(),S=g.getVertical(),w=e.getNumberFormat(),b=c&&m===ce.Overflow.Visible,C=c&&(m===ce.Overflow.Wrap||S===ce.VerticalAlignment.Justify||S===ce.VerticalAlignment.Distributed),_=(l??"")+"\0"+h+f+d+w+p+b+C+o+i+(l?"":t),y=a.get(_);if(y)return y;let v=null,x=null;const E=lh(s,e),R=E.top+E.bottom+ +sv(e);let I=!1,A=!1;i&&(A=!0,(p!==0||C)&&(A=!1));const T=A?void 0:MS(s,e,t,n),O=E.left+E.right+2;if(T){if(s===Le.Number&&w==="General"&&o){let F=t,k=P.splitNumber(F),L="";L=Math.abs(F)>=Math.pow(10,12)||Math.abs(F)<=Math.pow(10,-12)?`0.${"0".repeat(Math.max(2,Math.min(k.ipLength,5)))}E+00`:Math.abs(k.ipLength)===0?"0.0":Math.abs(k.fpLength)>0?"0".repeat(k.ipLength)+".0":"0".repeat(k.ipLength),F<0&&(L="-"+L),L="0".repeat(L.length);const W=e.measureText(L);v=W.width,x=W.lineHeight}else{let F=null;C&&(F={width:Math.max(1,r-O)});const k=T.layout(F);v=k.bounds.width,x=k.bounds.height}if(v!==null&&(v+=O),x!==null&&(x+=R),I=s===Le.String,p){I&&m===ce.Overflow.Wrap&&(I=!1);const F=((k,L)=>{const{x:W,y:$,width:J,height:te}=k,Q=L*Math.PI/180,G=Math.sin(Q),ee=Math.cos(Q),ne=J/2,re=te/2,U=dl(-ne,-re,G,ee),ue=dl(ne,-re,G,ee),oe=dl(-ne,re,G,ee),Z=dl(ne,re,G,ee);let Y=Math.min(U.x,ue.x,oe.x,Z.x)+ne,we=Math.max(U.x,ue.x,oe.x,Z.x)+ne,ge=Math.min(U.y,ue.y,oe.y,Z.y)+re;return{x:W+Y,y:$+ge,width:we-Y,height:Math.max(U.y,ue.y,oe.y,Z.y)+re-ge}})({x:0,y:0,width:v,height:x},p);v=F.width,x=F.height}}else x=e.getBestFit().height;o&&I&&(v=0);const N={width:v,height:x},D=Object.freeze(N);return a.set(_,D),D},ev=(s,e,t,n)=>{const r=lh(s,e),o=tc(s,e);let i=r.left+r.right;o===ce.HorizontalAlignment.Left?i=r.right:o===ce.HorizontalAlignment.Right?i=r.left:o===ce.HorizontalAlignment.Center&&(i=r.left+r.right);const l=Qr(s,e,t,n,Number.MAX_SAFE_INTEGER,!1,!1);return{width:Math.ceil(l.width-i),height:Math.ceil(l.height)}};let ka=class ma{constructor(e,t,n=Le.Null,r=null,o=null,i=null,l=null){this._options=e,this._coords=t??null,this._t=n,this._ri=o,this._v=r,this._p=i,this._n=l}getRange(){const e=this._coords;return this._options.getRange(e?q.cellToRange(e):null)}isEqual(e){if(!e)return!1;if(this===e)return!0;const t=e;return!!t.isICell&&this._v===t._v&&!!q.isEqualCells(this._coords,e.getCoords())&&this._options.sheet===t._options?.sheet}getCoords(){return this._coords}getA1(){const e=this._coords;return e?wr(this._options.resolveRange(e).getCoords()):tn}getSheet(){return this._options.sheet}select(e){return this._options.opener("#"+Gi(this._coords),e)}getColumnFilter(){if(!this._ri)return null;let e=null;if(this._ri.table){const t=this._ri.table.getHeaderRange().getCoords();if(t&&q.isCellWithinRange(this._coords,t)){const n=this._coords.colIndex-t.colStart;e=this._ri.table.getColumnFilter(n)??null}}return e}getProtection(){return QC}getTextOverflow(){const e=this._to;if(e!==void 0)return e;const t=this._ri;if(t&&t.merge)return this._to=null,null;const n=this._t;let r=null;if(n===Le.String||t&&t.continuous){const o=this.getStyle(),i=this._coords;r=TS(i.rowIndex,i.colIndex,n,o,this._v,this._p,this._n,t?.continuous?.getCoords()??null,this._options)}return r===null||r.leftIndex===0&&r.rightIndex===0&&r.colSpan<=1?(this._to=null,null):(this._to=r,this._to)}getRenderHorizontalAlignment(){return tc(this._t,this.getStyle())}isEmpty(){return this._v===null&&!this._ri}getExtrusions(){const e=this._ri;if(!e&&this._to===null)return null;if(e){const r=e.merge;if(r!==void 0)return r.getCoords()}const t=this.getTextOverflow();if(!t)return null;const n=this._coords;return{colStart:n.colIndex-t.leftIndex,rowStart:n.rowIndex,colEnd:n.colIndex+t.rightIndex,rowEnd:n.rowIndex}}isEditAllowed(){const e=this._options;return e?!e.getProtection().isLocked()||!!this._ri&&this.getProtection().isEditAllowed():!0}isFormulaHidden(){return!!this._options.getProtection().isLocked()&&!!this._ri&&this.getProtection().isFormulaHidden()}isContentful(){return this._v!==null}getBestFit(e,t=!1){return e===void 0&&(e=this._options.sheet.getColumnHeaders().getSpanSize(this._coords.colIndex)??64),Qr(this._t,this.getStyle(),this._v,this._options,e,t,!1)}getInsets(){return this._v===null?this.getStyle().getInsets():lh(this._t,this.getStyle())}getTextFrame(e){let t,n;if(e&&(n=this.getFormulaText()),t=n??this._v,t===null)return null;const r=this.getStyle();return n?((o,i)=>i===Le.Null?null:Ka(i,o.getFont(),o.getAlignment(),!1,!0))(r,t,this._options):MS(this._t,r,t,this._options,e)}getValue(){return this._v}getFormula(){let e=this._ri?.formula;if(!e)return null;const t=this._coords;return t?(Array.isArray(e)&&(e=e[0]),new nv(this._options,e,t)):null}getFormulaText(){let e=this._ri?.formula;if(!e)return null;const t=this._coords;return t?(Array.isArray(e)&&(e=e[0]),"="+e.getFormulaTextAt(t.rowIndex,t.colIndex)):null}getCalcStatus(){const e=this._ri;return e&&e.pending?ut.CalcStatus.Pending:ut.CalcStatus.Ready}getType(){return this._t}getStyle(e=!1){if(!e&&this._styleConditional)return this._styleConditional;if(e&&this._styleSpecific)return this._styleSpecific;const t=ls(0,q.cellToRange(this._coords),this._ri,this._options);return e?this._styleSpecific=t:this._styleConditional=t,t}createTemporaryCell(e){const t=this._options;if(e===null)return new ma(t,this._coords,null);const n=vd(e,this._options);let r=this._ri;if(n.style!==void 0){const l=this._coords??q.EmptyCell,a=q.cellToRange(l),c=()=>ls(0,a,this._ri,this._options),u=ec(this._options.styles,n.style,c),d=(this._ri?.directStyle??new Yt(t.styles,a)).cloneWithUpdate(u);r={...r,directStyle:d}}let o=this._t,i=this._v;return n&&n.value!==void 0&&(i=n.value,o=n.type),i===this._v&&o===this._t&&r===this._ri?this:i!==null||r?new ma(this._options,this._coords,o,i,r):new ma(this._options,this._coords)}_isDate1904(){return this._options.date1904}getNumberFormat(e){if(e!==void 0){const t=this._v;return ES(t,this.getStyle(),this._t,e,n=>this._options.styles.parseColor(n),this._isDate1904())}return AS(this._t,this.getStyle(),this._v,this._options)}toDate(){return this._t!==Le.Number?null:this._ri?this.getNumberFormat().asDate:null}toText(){return this.getNumberFormat().displayText}toTextUnformatted(e){if(e){const n=this.getFormulaText();if(n)return n}let t=this._v;return this.isSpillOverflow()&&(t=null),((n,r,o,i)=>{if(r===Le.Null||n==null)return"";if(r===Le.Number){const l=n,a=Vi(o),c=Ja(o);if(a||c){const u=parseFloat(n),d=u%1!=0,h=u>=1;if(u<0)return P.castToString(n);if(!a||c||d)if(!c||a||h){const f=ui("Short Date",l,i),g=ui("Long Time",l,i);if(f&&g)return f.fmt+" "+g.fmt}else{const f=ui("Long Time",l,i);if(f)return f.fmt}else{const f=ui("Short Date",l,i);if(f)return f.fmt}}}if(r===Le.Number&&o.endsWith("%")){let l=P.roundAccurately(100*parseFloat(n));if(!isNaN(l))return l+"%"}return r===Le.Boolean?n?"TRUE":"FALSE":r===Le.Error?n?.getLabel?.()??$e.Label.Unknown:r===Le.RichData?"(Rich Object)":P.castToString(n)})(t,this._t,this.getStyle().getNumberFormat(),{date1904:this._isDate1904()})}getComments(){const e=this._ri?.comments;return e?Object.freeze(e):null}getHyperlink(){const e=this._ri?.hyperlink;return e?new vb(this.toText.bind(this),this._options.opener,e):null}getErrors(){const e=this._ri;return e&&e.calcError?[e.calcError]:P.EmptyArray}getWarnings(){return P.EmptyArray}getSpans(){const e=this._ri?.merge;if(!e)return XC;const t=e.getCoords();return Object.freeze({width:t.colEnd-t.colStart+1,height:t.rowEnd-t.rowStart+1})}isTopLeft(){const e=this._ri?.merge;if(!e)return!0;const t=e.getCoords();return this._coords&&this._coords.colIndex===t.colStart&&this._coords.rowIndex===t.rowStart}getSpill(){let e=this._ri?.spills;if(!e||!this._coords)return null;Array.isArray(e)||(wl[0]=e,e=wl);let t=null;for(let n=0;!t&&n<e.length;n++){const r=e[n];r.getError()||(t=r)}return t||(t=e[0]),this._options.getRange(t.getCoords())}isSpillOverflow(){let e=this._ri?.spills;if(!e)return!1;if(!this._coords)return null;Array.isArray(e)||(wl[0]=e,e=wl);for(let t=0;t<e.length;t++){const n=e[t].getCoords();if(this._coords.colIndex===n.colStart&&this._coords.rowIndex===n.rowStart)return!1}return!0}get[Symbol.toStringTag](){return"[Cell]"}toString(){let e="{blank}";return this._v!==null&&(e=this.toTextUnformatted(),this.getType()===Le.String&&(e=`'${e}'`)),`${this.getA1()} => ${e}`}get isICell(){return!0}},tv=class extends ka{constructor(s){super(s,null,null,null)}isEmpty(){return!0}isContentful(){return!1}toString(){return"{EMPTY CELL}"}};class nv{constructor(e,t,n){this._options=e,this._entry=t,this._coords=n}getTokens(e){const t=this._coords;return t?this._entry.getTokensAt(t.rowIndex,t.colIndex,e):P.EmptyArray}evaluate(e){const t=this._coords;return t?this._options.calcGraph().evaluateAt(t.rowIndex,t.colIndex,e):P.EmptyArray}toText(e){const t=this._coords;return t?"="+this._entry.getFormulaTextAt(t.rowIndex,t.colIndex,e):null}getDirectPrecedents(){const e=this._coords;return e?this._options.calcGraph().getDirectPrecedentsAt(e.rowIndex,e.colIndex):P.EmptyArray}getReferences(){const e=this._coords;return e?this._entry.getReferencesAt(e.rowIndex,e.colIndex):P.EmptyArray}setReferenceAt(e,t){const n=this._coords;return n?(this._options.calcGraph().setReferenceAt(n.rowIndex,n.colIndex,e,t),this):P.EmptyArray}get[Symbol.toStringTag](){return"[Formula]"}toString(){return this.toText()}}const wl=[null],uu={colIndex:-1,rowIndex:-1};let du;const Fa=(s,e,t,n=!1)=>{const r=t===B.Orientation.Row,o=s.length,i=new Array(o);for(let l=0;l<o;l++){const a=s[l];if(r){const c=a.colEnd-a.colStart+1;i[l]={...a,colStart:n?a.colEnd+1:a.colStart,rowStart:e.rowStart,colEnd:n?a.colEnd+c:a.colEnd,rowEnd:e.rowEnd}}else{const c=a.rowEnd-a.rowStart+1;i[l]={...a,colStart:e.colStart,rowStart:n?a.rowEnd+1:a.rowStart,colEnd:e.colEnd,rowEnd:n?a.rowEnd+c:a.rowEnd}}}return i},xd=(s,e,t)=>{const n=e,r=s.length,o=n.rowStart,i=n.rowEnd;for(let l=0;l<r;l++){const a=s[l];if((a.rowStart<=o&&a.rowEnd>=i)!==t)return!t}return t},Ed=(s,e,t)=>{const n=e,r=s.length,o=n.colStart,i=n.colEnd;for(let l=0;l<r;l++){const a=s[l];if((a.colStart<=o&&a.colEnd>=i)!==t)return!t}return t},rv=(s,e)=>{if(e){if(s.colStart<=e.colStart&&s.colEnd>=e.colEnd)return B.Orientation.Row;if(s.rowStart<=e.rowStart&&s.rowEnd>=e.rowEnd)return B.Orientation.Column}return s?(t=>t.rowEnd-t.rowStart>t.colEnd-t.colStart?B.Orientation.Column:B.Orientation.Row)(s):B.Orientation.Row},_l=()=>!1,hu=()=>!0,yl=()=>null,gu=()=>Qt,Rr=()=>0,Jf=new class extends ka{constructor(){super(null,null)}createTemporaryCell(){return this}getType(){return Le.Error}getWarnings(){return[tn]}getStyle(s=!1){return du||(du=new qi().getNormal(),du)}toString(){return`${this._coords?Gi(this._coords):tn} => ${this._v??"{blank}"}`}},hr=()=>so,so={forEach:()=>{},[Symbol.iterator]:gu,entries:gu,values:gu,select:gt,find:gt,calculate:gt,getCell:()=>Jf,getValue:yl,setValue:gt,setFormula:gt,setValues:gt,updateCells:gt,getCells:()=>[[Jf]],getStyle:gt,getValues:()=>[[null]],toText:()=>"",getBounds:yl,getIntersect:hr,getUnion:hr,getDifferences:gt,getResizeBy:hr,getResizeTo:hr,getOffsetBy:hr,getOffsetTo:hr,getFixed:hr,getUsedRange:hr,getEntireRows:hr,getEntireColumns:hr,getSurrounding:gt,getExtended:gt,isEntireRows:_l,isEntireColumns:_l,isEntireRange:_l,getWidth:Rr,getHeight:Rr,size:0,sort:gt,clear:gt,setHyperlink:gt,setComments:gt,merge:gt,unmerge:gt,getMerges:gt,insert:gt,insertFrom:gt,delete:gt,getDefaultShiftOrientation:gt,getDefaultSortCriteria:gt,autoFill:gt,autoFit:gt,getSnapshot:gt,copyFrom:gt,doBatch:gt,startIncrementalUpdates:gt,getRowHeaders:gt,getColumnHeaders:gt,getCounts:gt,getCount:Rr,isContentful:_l,addListener:gt,getColumnStart:Rr,getRowStart:Rr,getColumnEnd:Rr,getRowEnd:Rr,getRowCount:Rr,getColumnCount:Rr,getVisible:gt,getCoords:yl,isEmpty:hu,toString:()=>tn,getA1:()=>tn,isInvalid:hu,getSheet:yl,isReadOnly:hu,isICellRange:!0};function Nr(s,e=null,t=null,n=tn){return s||t?Object.freeze({...so,getSheet:()=>s,bounds:()=>t,getA1:()=>n,toString:()=>t?Pr(t,e):n}):so}const ov=/^[\\+-]?[0-9]*\.?[0-9]*$/,kS=(s,e,t)=>{if(s===void 0)throw new Error("A value is required to create a cell from a text.");const n=t??{value:null};if((s=P.castToString(s)).trim()==="")return n;if(s.toUpperCase()==="TRUE"||s.toUpperCase()==="FALSE")return n.value=s.toUpperCase()==="TRUE",n;if(s.startsWith("'")&&!e?.ignoreQuotePrefix)return n.style={quotePrefix:!0},n.value=s.substring(1,s.length),n;n.value=s;const r=",",o="$",i=".";let l=s.trim(),a=1,c=!1;l=(p=>{const S=new RegExp("([(]{1}([^(|^)]+)[)]{1})").exec(p);if(S?.[2]){const w=p.substring(0,S.index)+S[2].trim()+p.substring(S.index+("("+S[2]+")").length-1,p.length-1);return w.indexOf("(")>-1||w.indexOf(")")>-1?p:(c=!0,a=-1,w)}return p})(l);let u=0;l=(p=>{const S=new RegExp("[0-9]+([eE][-+]?[0-9]+)?$").exec(p);if(S?.[1]){const w=p.substring(0,p.length-S[1].length);let b=1,C=S[1].substring(1,S[1].length);if(C.startsWith("-")?(C=C.substring(1,C.length),b=-1):C.startsWith("+")&&(C=C.substring(1,C.length)),!isNaN(C))return u=C*b,w}return p})(l);let d=!1;if(l=(p=>{const S=new RegExp(`^(\\${o}[\\ ]*\\-|\\${o}[\\ ]*\\+|\\-[\\ ]*\\${o}|\\+[\\ ]*\\${o}|\\-|\\+)?`).exec(p);if(S?.[1]){const w=S?.[1].indexOf(o)>-1,b=S?.[1].indexOf("-")>-1,C=S?.[1].indexOf("+")>-1,_=(w?o:"")+p.substring(S.index+S[1].length,p.length).trim(),y=_.indexOf("-")>-1,v=_.indexOf("+")>-1;return y||v?p:(d=b||C,b&&(a=-1),_)}return p})(l),d&&(c||l.length===0))return n;let h=!1;if(l=(p=>{if(new RegExp(`^(?:\\${o}[\\ ]*)?((\\d{1,3}(${r}\\d{3})*)|(\\d*))(\\${i}|\\${i}\\d*)?(?:[\\ ]*\\%)?$`).test(l)){const S=p.replace(new RegExp(`${r}`,"g"),"");return h=S.length<p.length,S}return p})(l),l.match(ov)&&!isNaN(l)){if(n.value=l*a,u!==0)n.value=n.value*Math.pow(10,u),n.style={numberFormat:`0${i+"0".repeat(2)}E+00`};else if(h){let p=ea(l);n.style=p>0?{numberFormat:`#${r}##0${i+"0".repeat(2)}`}:{numberFormat:`#${r}##0`}}return n}if(l.trimEnd().endsWith("%")&&l.trimEnd().length>1){let p=l.substring(0,l.length-1);if(!isNaN(p)){n.value=p*a/100;const S=ea(p);n.style=w=>{if(!w.getNumberFormat().includes("%"))return{numberFormat:S>0?`0${i+"0".repeat(2)}%`:"0%"}}}return n}if(l.startsWith(o)&&s.trim().length>1){let p=l.replace(o,"");if(!isNaN(p)){let S=ea(p);n.value=p*a,n.style=w=>{if(w.getNumberFormat().includes(o))return;let b;return b=S>0?`${o}#${r}##0${i+"0".repeat(2)}_);[Red](${o}#${r}##0${i+"0".repeat(2)})`:`${o}#${r}##0_);[Red](${o}#${r}##0)`,{numberFormat:b}}}return n}let f=null,g=null;try{g=d0(s,e?.date1904,!0);let p=s;g&&(p=g.leadingText),p.trim().length>0&&(f=Kd(p,e?.date1904)),!f&&g?.leadingText.trim().length>0&&(g=null)}catch{}if(f||g){n.style=S=>{let w=S.getNumberFormat();const b=Vi(w);if(f&&b)return;const C=Ja(w);if(!g||!C){if(f&&g&&!b&&!C?w="m/d/yyyy h:mm":f&&!b?w=f.numberFormat:g&&!C&&(w=g.numberFormat),g&&g.parsed.oaDateTime>1&&(w="General"),f&&!b&&!g){const _=Ut.Parser.formatValue(f.numberFormat,f.asOADate,{date1904:e?.date1904}),y=Intl.DateTimeFormat().resolvedOptions().locale??"en-US";_===new Intl.DateTimeFormat(y).format(f.asJSDate)?w="Short Date":_===new Intl.DateTimeFormat(y,{dateStyle:"full"}).format(f.asJSDate)?w="Long Date":_===new Intl.DateTimeFormat(y,{timeStyle:"medium"}).format(f.asJSDate)&&(w="Long Time")}return{numberFormat:w}}};let p=0;return f&&(p+=f.asOADate),g&&(p+=g.parsed.oaDateTime),n.value=p,n}const m=$e.getBuiltInByLabel(s);return m?(n.value=m,n):(n.value=s,b0(s)?n.hyperlink=s:C0(s)&&(n.hyperlink=s,n.hyperlink.toLowerCase().startsWith("mailto:")||(n.hyperlink=`mailto:${n.hyperlink}`)),s.includes(`
`)&&(n.style={...n?.style,alignment:{overflow:ce.Overflow.Wrap}}),n)},sv=s=>{const e=s.getFont().getUnderline()===Be.UnderlineStyle.SingleAccounting,t=s.getFont().getUnderline()===Be.UnderlineStyle.DoubleAccounting;let n=0;return(e||t)&&(n=s.measureText("").underlineThickness+1,t?n*=2:n+=1),n},fu=s=>{const e=[];return s.getUsedRange().forEachSpan((t,n)=>{const r=n.getCoords();t===0&&e.push(r)},{includeStyles:!1}),Tr(Ro(e))},Kf=s=>{if(!s)return null;let e=null;const t=s.length;for(let n=0;n<t;n++){const r=s[n].value;if(!r)continue;e||(e={...e});const o=Object.keys(r),i=o.length;for(let l=0;l<i;l++){const a=o[l],c=e[a];if(c)if(Array.isArray(c)){const u=r[a];if(Array.isArray(u)){const d=u.length;for(let h=0;h<d;h++)c.push(u[h])}else c.push(u)}else e[a]=[c,r[a]];else e[a]=r[a]}}return e},mu=(s,e,t,n)=>{const r=n?.asJSDate;let o;t?o=dS:(r||n?.includeMergeOverflow)&&(o={},r&&(o[je.Type.Style]=!1,o[je.Type.Table]=!1),n.includeMergeOverflow&&(o[je.Type.Merge]=!1));const i=n?.orientation??B.Orientation.Row,l=n?.maxSize??1e4,a=s({includeEmpty:!0,orientation:i,reverse:n?.reverse,ignoreHidden:n?.ignoreHidden,includeMergeOverflow:n?.includeMergeOverflow,includeRangeTypes:o,bounds:e,ignoreCellDetails:!r}),c=i!==B.Orientation.Row,u=[];let d,h=-1,f=null,g=0;for(d=a.next();!d.done;){if(g>l)throw new Error(hS(l));const m=d.value,p=m.context.getCoords(),S=c?p.colIndex:p.rowIndex;S!==h&&(f=[],u.push(f),h=S);let w=m.value;if(t)w=m.context.getCell();else if(r&&w!==null&&typeof w=="number"){const b=m.context.getCell().toDate();b&&(w=b)}f.push(w),d=a.next(),g++}return u},bi=(s,e)=>s===e||!(!s||!e)&&s.rowStart===e.rowStart&&s.rowEnd===e.rowEnd&&s.colStart===e.colStart&&s.colEnd===e.colEnd&&s.$rowStart===e.$rowStart&&s.$rowEnd===e.$rowEnd&&s.$colStart===e.$colStart&&s.$colEnd===e.$colEnd,FS=(s,e)=>{if(!s)return;const t={...s};return e?typeof e=="boolean"?(t.$colStart=e,t.$rowStart=e,t.$colEnd=e,t.$rowEnd=e,t):(typeof e.colStart=="boolean"&&(t.$colStart=e.colStart),typeof e.rowStart=="boolean"&&(t.$rowStart=e.rowStart),typeof e.colEnd=="boolean"&&(t.$colEnd=e.colEnd),typeof e.rowEnd=="boolean"&&(t.$rowEnd=e.rowEnd),t):t};class pu{constructor(e,t,n){const r=this;this.setState=o=>{const i=o[0];let l=o[1],a=o[2];if(t&&t.includeMergeOverflow&&a&&a.merge){const u=t.bounds,d=a.merge.getCoords();let h=!1;const f=d.colStart,g=d.rowStart,m=u.colStart,p=u.rowStart,S=i.colIndex,w=i.rowIndex;!h&&f<m&&g>=p&&S===m&&w===g&&(h=!0),!h&&g<p&&f>=m&&w===p&&S===f&&(h=!0),!h&&g<p&&f<m&&w===p&&S===m&&(h=!0),h&&(l=a.merge.tvTl())}a&&Object.keys(a).length===0&&(a=null);let c=l;return l===void 0?(this._t=null,this._v=null,c=null):(this._t=yn(c),this._v=c),this._r=a,this._p=o[3],this._n=o[4],this._c=i,c},this.clear=()=>{r._c=null},this.context={getCoords(){const o=r._c;if(!o)throw new Error(ps);return o},getCell(){const o=r._c;if(!o)throw new Error(ps);if(this.ignoreCellDetails)throw new Error("IteratorContext can only return a cell if the forEach ignoreCellDetails has not been set to false.");const i=r._r,l=r._t,a=r._v;return a!==null||i?new ka(n,o,l,a,i,r._p,r._n):new ka(n,o)},getType:()=>r._t,getA1(o){if(!r.context)throw new Error(ps);let i=r._c;return o&&(i={...r._c,...o}),n.resolveRange(i).toString()},toJSDate(o){if(r._t!==Le.Number)return null;let i=o;if(i===void 0)i=r._v;else if(typeof i!="number")throw new Error("The arguments are not valid.");return Ms(i,n.date1904)}}}}const Br=(s,e)=>{if(s||e)return s&&e?{...s,...e}:s||e},Xf=(s,e,t,n=B.Orientation.Row)=>{const r=s.getRange(e,{ignoreHidden:n}),o=r.forEach((w,b)=>({break:b.getCoords()}),{ignoreCellDetails:!0,orientation:n});if(!o)return;const i=n===B.Orientation.Row,l=new Map;let a;const c=new Map;let u=null;const d=i?o.rowIndex:o.colIndex;r.forEach((w,b)=>{const C=b.getCoords(),_=i?C.colIndex:C.rowIndex;if((i?C.rowIndex:C.colIndex)===d)l.set(_,w),a=b.getType();else{const y=b.getType();a!==y&&(u=!0)}if(u)return mb},{orientation:n===B.Orientation.Row?B.Orientation.Column:B.Orientation.Row,ignoreCellDetails:!0,includeEmpty:!0,address:{colStart:e.colStart,rowStart:e.rowStart,colEnd:i?e.colEnd:e.colStart+1,rowEnd:i?e.rowStart+1:e.rowEnd}}),u&&l.forEach((w,b)=>{c.set(b,w+"")});const h={colStart:o.colIndex,rowStart:o.rowIndex,colEnd:e.colEnd,rowEnd:e.rowEnd};if(h.colStart>h.colEnd||h.rowStart>h.rowEnd||q.isSingleCell(h))return null;const f=Math.min(Math.max(t?.colIndex??0,h.colStart),h.colEnd),g=Math.min(Math.max(t?.rowIndex??0,h.rowStart),h.rowEnd),m=n!==B.Orientation.Row,p={...hs.DefaultRangeOptions,hasHeader:u,orientation:n,offset:m?g-h.rowStart:f-h.colStart};let S=h;return u&&(S={colStart:m?h.colStart+1:h.colStart,rowStart:m?h.rowStart:h.rowStart+1,colEnd:h.colEnd,rowEnd:h.rowEnd}),{coords:h,options:p,headers:c,sortCoords:S}},Zf=(s,e,t=null)=>gs.fromArray(s,(n,r)=>{const o=n?.[1];if(o==null)return null;let i=n[0]??null;switch(o){case Le.String:i=e.getById(i);break;case Le.Error:i=$e.getBuiltInById(i);case Le.RichData:}return i},(n,r)=>{const o=yn(n);let i=n;switch(o){case Le.String:i=e.add(i);break;case Le.Error:i=i.getCode();case Le.RichData:}return[i,o]},t),Qf=(s,e)=>{const t=[],n=e?B.Orientation.Column:B.Orientation.Row,r=s.length;for(let o=0;o<r;o++){const i=s[o],l=i[0],a=i[1],c=a.length;for(let u=0;u<c;u++){const d=a[u],h=d[0],f=d[1].length-1,g={colStart:e?l:h,rowStart:e?h:l,colEnd:e?l:h+f,rowEnd:e?h+f:l,value:new vs({colStart:e?l:h,rowStart:e?h:l,colEnd:e?l:h+f,rowEnd:e?h+f:l},n)};t.push(g)}}return t},Yf=(s,e,t)=>{if(!s||s.length===0)return null;const n=s.length;let r,o=-1;const i=[],l=e===B.Orientation.Column,a=l?t.rowStart:t.colStart,c=l?t.rowEnd:t.colEnd,u=l?B.Orientations.Column:B.Orientations.Row;for(let d=0;d<n;d++){const h=s[d],f=h.s;if(f===void 0){o=-1;continue}const g=h.min,m=h.max;f!==o||r.colEnd+1!==g?(r={colStart:l?g:a,rowStart:l?a:g,colEnd:l?m:c,rowEnd:l?c:m,value:{orientations:u,index:f}},o=f,i.push(r)):r.colEnd=m}return i.length===0?null:i},em="Item has been closed. No further operations are allowed.";let nc=class{constructor(e){if(this._emitter=null,this._closed=!1,!e)throw new Error("Anchored.ConstructorOptions is required");if(this._options={...e},!this._options.initialAnchor)throw new Error("Initial anchor is required");const t=this;this._transactions=this._options.transactions??new Hn({transient:!0}),this._emitter=new gn(this,this._transactions),this._updateState({anchor:this._options.initialAnchor},{description:e?.createDescription??"Create Anchored Item"}),this._options.setContainerShiftCallback?.(n=>t._processContainerShift(n)),this._options.setContainerLayoutCallback?.(()=>{t._processContainerLayout()}),this._options.setContainerDeleteCallback?.(()=>{t._processContainerDelete()}),this._options.setContainerProtectionCallback?.(()=>{t._processContainerProtection()}),this._transactionsRemoveListener=this._transactions.addStateListener(this,{onBeforeCommitStart(n,r,o){t._processBeforeCommitStart(n,r,o)},onAfterStateChange(n,r,o){t._processStateChange(n,r,o),t._processAnchorCoords(),t._emitter.notify("onAnchorCoordsChange")},onRestoreOrRevert(n,r,o){t._processRestoreOrRevert(n,r,o)}})}_getEmitter(){return this._emitter}delete(e){this._options.deleteFromContainer?.(e)}getAnchorCoords(){return this._getState()?.anchor??null}getAnchorType(){return this._getState()?.anchorType??Xt.Type.TwoCell}isProtected(){return this._options.isProtected?.()??!1}beginCommit(e){return this._beginCommit(e)}_getState(){if(this._closed)throw new Error(em);return this._transactions.getState(this)}_beginCommit(e){return this._transactions.beginCommit(typeof e=="string"?{description:e}:e)}_getTransactions(){return this._transactions}_updateState(e,t,n){if(this._closed)throw new Error(em);if(!e)return;const r=this._beginCommit(t?.description);try{r.updateState(this,e);let o=!1;if(n)for(let i=0;i<n.length;i++){const l=n[i];o=o||l==="onAnyChange",this._emitter.notify(l)}!o&&n&&n.length>0&&this._emitter.notify("onAnyChange"),r.commit()}catch(o){throw r.rollback(),o}return this}_processContainerShift(e){let t=null;const n={anchor:e.after};return e.after||(n.isDeleted=!0,t=["onDelete"]),this._updateState(n,{description:"Update Anchor"},t),e.after}_processBeforeCommitStart(e,t,n){}_processStateChange(e,t,n){}_processRestoreOrRevert(e,t,n){this._emitter.notify("onInvalidated")}_processAnchorCoords(){}_processContainerLayout(){}_getDescription(){return null}_delete(){const e=this._getDescription(),t="Delete",n=e?`${t} ${e}`:t,r=this._beginCommit(n);try{this._processDelete(),r.commit()}catch(o){throw r.rollback(),o}}_processContainerDelete(){this._processDelete()}_processDelete(){}_processContainerProtection(){this._emitter.notify("onProtectedChange")}addListeners(e,t){return this._emitter.addListeners(e,t)}isClosed(){return this._closed}_processClose(){this._closed=!0,this._emitter.notify("onClose"),this._transactionsRemoveListener?.()}close(){this._closed||this._processClose()}get isIAnchored(){return!0}};var ws,mo;(mo=ws||(ws={})).fastStringToCol=ub,mo.fastStringToCell=is,mo.fastStringToRange=Ln,mo.rangeToString=Pr,mo.cellToString=co,mo.normalizeA1ToR1C1=fb,mo.resolveRelativeToA1=gb;const iv=(s,e)=>s.offset-e.offset,tm=s=>{if(!s||s.size===0)return[];let e=[];return s.forEach((t,n)=>{t&&Object.keys(t).length!==0&&e.push({...t,offset:n})}),e.sort(iv)};class lv extends nc{constructor(e){super({...e,createDescription:"Insert AutoSort"}),this._apply=e.apply,this._processUpdate=e.processUpdate,this._fromJSON(e.json)}getRange(){return this._getState().anchor}getFieldAt(e){const t=this._getState().byOffset.get(e)??null;return t?Object.keys(t).length===0||Object.keys(t).length===1&&t.hasOwnProperty("offset")?null:{collatorOptions:null,...t}:null}insertSort(){return null}getSort(){return null}apply(e){const t=this._getState().byOffset,n=new Map(t);for(let r=0;r<e.length;r++){const o={...e[r]},i=o.offset;delete o.offset,n.set(i,o)}return this._updateState({byOffset:n},{description:"Set Sort Criteria"}),this.reapply()}setFieldAt(e,t){const n=this._getState().byOffset,r=new Map(n);return t&&Object.keys(t).length>0?r.set(e,t):r.delete(e),this._updateState({byOffset:r},{description:"Sort"}),this.reapply()}_processStateChange(e,t,n){super._processStateChange(e,t,n),this._processUpdate?.()}reapply(){const e=this._getState(),t=tm(e.byOffset);return this._apply?.(t),this}clear(){return this._updateState({byOffset:new Map},{description:"Clear Sort"}),this.reapply()}_fromJSON(e){const t=e??{},n={byOffset:new Map};if(t.fields)for(let r=0;r<t.fields.length;r++){let o=t.fields[r];const i=o.offset;o={...t.fields[r]},delete o.offset,n.byOffset.set(i,o)}this._updateState(n,{description:"Load"})}toJSON(){const e={},t=this._getState();t.anchor&&(e.ref=ws.rangeToString(t.anchor,this._options.maxRangeCoords));const n=tm(t.byOffset);return n.length>0&&(e.fields=n),Object.keys(e).length===0?null:e}}const av=(s,e)=>s.offset-e.offset,Su=s=>{if(!s||s.size===0)return[];let e=[];return s.forEach((t,n)=>{t&&Object.keys(t).length!==0&&e.push({...t,offset:n})}),e.sort(av)},nm=(s,e=new Map)=>{if(!s||s.length===0)return e;for(let t=0;t<s.length;t++){const n={...s[t]},r=n.offset;delete n.offset,e.set(r,n)}return e},wu=s=>{let e=0;const t=s.entries();let n=null;do n=t.next(),n.value?.[1]&&n.value[1].hiddenButton&&e++;while(!n.done);return e};class NS extends nc{constructor(e){super({...e,createDescription:"Insert AutoFilter"}),this._apply=e.apply,this._processUpdate=e.processUpdate,e.setFilterCoordsCallback?.(t=>{this._getState().anchor}),this._fromJSON(e.json)}getCoords(){return this._getState().anchor}getFieldAt(e){const t=this._getState().byOffset.get(e)??null;return t?Object.keys(t).length===0||Object.keys(t).length===1&&t.hasOwnProperty("offset")?null:{hiddenButton:!1,criteria:P.EmptyArray,...t}:null}insertSort(){return null}getSort(){return null}apply(e){const t=this._getState().byOffset,n=new Map(t);return nm(e,n),this._updateState({byOffset:n,hiddenCount:wu(n)},{description:"Set Filter Criteria"}),this.reapply()}setFieldAt(e,t){const n=this._getState(),r=n.anchor.colEnd-n.anchor.colStart+1;if(e<0||e>r-1)throw new Error(`Invalid range: '${e}'`);const o=n.byOffset,i=new Map(o);t&&Object.keys(t).length>0?i.set(e,t):i.delete(e);const l=o.get(e)?.hiddenButton===!0?1:0,a=t?.hiddenButton===!0?1:0;return this._updateState({byOffset:i,hiddenCount:Math.min(r,Math.max(0,n.hiddenCount+a-l))},{description:"Set Filter Criteria"}),this.reapply()}getShowFilterButton(){const e=this._getState(),t=e.anchor,n=t.colEnd-t.colStart+1;return e.hiddenCount<n}setShowFilterButton(e){const t=this.getAnchorCoords(),n=t.colEnd-t.colStart+1;let r=Array(n);const o=this._getState().byOffset,i=Su(o);for(let a=0;i&&a<i.length;a++){const c={...i[a]};r[c.offset]=c,e?delete c.hiddenButton:c.hiddenButton=!0}if(!e)for(let a=0;a<r.length;a++)r[a]||(r[a]={hiddenButton:!0});const l=new Map;for(let a=0;a<r.length;a++){const c=r[a];l.set(a,c)}return this._updateState({byOffset:l,hiddenCount:e?l.size:0},{description:(e?"Hide":"Show")+" Filter Buttons"}),this._processUpdate?.(),this}_processStateChange(e,t,n){super._processStateChange(e,t,n),this._processUpdate?.()}_processContainerShift(e){if(e.after&&e.orientation===B.Orientation.Column){let t=e.intersect.colStart-e.before.colStart,n=e.amount;t<=0&&(n-=t,t=0);const r=this._getState().byOffset,o=new Map(r);if(r.forEach((i,l)=>{i&&Object.keys(i).length!==0&&(l>=t&&o.delete(l),l>t&&o.set(l+n,i))}),n>0&&this._getState().hiddenCount>0)for(let i=t;i<t+n;i++)o.set(i,{hiddenButton:!0});this._updateState({byOffset:o,hiddenCount:wu(o),sort:null},{description:"Update Fields"})}return super._processContainerShift(e)}reapply(){const e=this._getState(),t=Su(e.byOffset);return this._apply?.(t),this}clear(){return this._updateState({byOffset:new Map,hiddenCount:0,sort:null},{description:"Set Filter Criteria"}),this.reapply()}_fromJSON(e){const t=e??{},n={byOffset:new Map,hiddenCount:0};t.fields&&(nm(t.fields,n.byOffset),n.hiddenCount=wu(n.byOffset)),t.sort,this._updateState(n,{description:"Load"})}toJSON(){const e={},t=this._getState();t.anchor&&(e.ref=Pr(t.anchor,this._options.maxRangeCoords));const n=Su(t.byOffset);return n.length>0&&(e.fields=n),t.sort,Object.keys(e).length===0?null:e}}const Rd="A table must have a least one row for the data.",rm="Table1",bl=Object.freeze({showRowStripes:!0,showColumnStripes:!1,showFirstColumn:!1,showLastColumn:!1}),om=(s,e,t)=>{if(s.length!==e.length)return console.warn("make columns the same length"),!1;const n=new Set;for(let a=0;a<e.length;a++){const c=e[a]?.name;c&&n.add(c.toLocaleLowerCase())}for(let a=0;t&&a<t.length;a++){const c=t[a]?.name;c&&n.add(c.toLocaleLowerCase())}const r=(a,c="")=>{if(!a)return!1;const u=a.toLocaleLowerCase();return u===c||!n.has(u)};let o=1;const i=(a,c,u,d,h=1e3)=>{if(d(a,u=(u??"").trim().toLocaleLowerCase()))return a;for(;o<h;)try{const f=c+ ++o;if(d(f,u))return f}catch{}throw new Error(`Unable to find valid name for '${c}'.`)};let l=0;for(let a=0;a<s.length;a++){const c=s[a]?.name;if(c&&c===e[a]?.name)continue;const u=i(c,s[a]?.name||"Column",e[a]?.name,r);n.add(u.toLocaleLowerCase()),e[a]?.name!==u&&(s[a].name=u,l++)}return l>0};class cv{constructor(e,t,n,r){this._name=e,this._filter=t,this._sort=n,this._offset=r}getName(){return this._name}getField(){return this._filter?this._filter.getFieldAt(this._offset)??null:null}setField(e){return this._filter?(this._filter.setFieldAt(this._offset,e),this):this}getSortField(){return this._sort?this._sort.getFieldAt(this._offset):null}setSortField(e){return this._sort?(this._sort.setFieldAt(this._offset,e),this):this}reapply(){return this._filter?.reapply(),this}clear(){return this._filter?.setFieldAt(this._offset,null),this._sort?.setFieldAt(this._offset,null),this}hasHiddenButton(){return this._filter?.getFieldAt(this._offset)?.hiddenButton??!1}}class uv extends j0{constructor(e,t,n,r){super({...r,type:"namedTable"}),this._names=e,this._sheet=t,this._table=n;const o=this;this._table.addListeners({onDelete:()=>{o._options.deleteFromContainer?o._options.deleteFromContainer?.():o._delete()},onAnyChange:()=>{o._emitter.notify("onAnyChange")},onAnchorCoordsChange:()=>{o._emitter.notify("onAnyChange")}},{transactional:!0})}async select(e){return await this._table.select(e),this}getRanges(){return this._names.getRanges(this._table.getUsedRange())}getScope(){return null}getType(){return"table"}getName(){return this._table.getName()}getValue(){return this._table}}class dv extends nc{constructor(e){if(super({...e,createDescription:"Insert Table"}),this._isUpdatingHeader=!1,this._colHeadersSizeUnlistener=null,this._rowHeadersSizeUnlistener=null,this._visibleRange=null,this._isHeaderVisible=!0,this._isTotalVisible=!0,this._isFirstColumnVisible=!0,this._isLastColumnVisible=!0,this._range=null,!e.json)throw new Error("json is required");if(!e.json.ref)throw new Error("json.ref is required");const t=this;this._styles=e.styles??e.sheet?.getStyles()??new qi,this._names=e.names,this._sheet=e.sheet,this._processTableUpdate=e.processTableUpdate,this._setNameOnContainer=e.setNameOnContainer,this._options={...e},this._styleCache=null,this._stylePropsCache=null,this._stylesRemoveListener=this._styles.addListeners({onTableStylesChange(){t._styleCache=null,t._stylePropsCache=null,t._getEmitter().notify("onStyleChange"),t._getEmitter().notify("onAnyChange")}});const n={...e?.json};if(e.sheet){const r=e.sheet;if(this._autoExpandRemoveListener=r.getEntireRange().addListener(l=>{if(l.trigger!=="setCells"||l.isUndo)return;const a=t.getAnchorCoords();if(!a)return;const c=l.getFrom().getCoords()[0];let u=null;if(c.rowStart>=a.rowStart&&c.rowEnd<=a.rowEnd&&c.colStart>=a.colStart&&c.colStart<=a.colEnd+1&&c.colEnd>a.colEnd){const d={...c,colStart:a.colEnd+1};if(r.getRange(d).isContentful()){const h={...d,rowStart:a.rowStart,rowEnd:d.rowStart-1};if(h.rowEnd-h.rowStart<0||!r.getRange(h).isContentful()){const f={...d,rowStart:d.rowEnd+1,rowEnd:a.rowEnd};(f.rowEnd-f.rowStart<0||!r.getRange(f).isContentful())&&(u={...a,colEnd:c.colEnd})}}}else if(!t.getShowTotals()&&c.colStart>=a.colStart&&c.colEnd<=a.colEnd&&c.rowStart>=a.rowStart&&c.rowStart<=a.rowEnd+1&&c.rowEnd>a.rowEnd){const d={...c,rowStart:a.rowEnd+1};if(r.getRange(d).isContentful()){const h={...d,colStart:a.colStart,colEnd:d.colStart-1};if(h.colEnd-h.colStart<0||!r.getRange(h).isContentful()){const f={...d,colStart:d.colEnd+1,colEnd:a.colEnd};(f.colEnd-f.colStart<0||!r.getRange(f).isContentful())&&(u={...a,rowEnd:c.rowEnd})}}}if(u&&r.getRange(u).getMerges().length>0&&(u=null),u&&r.getTables().getItems({address:u}).length!==1&&(u=null),u){const d=t._beginCommit("Table Auto Expansion");try{t.resize(u),d.commit({viewAfter:null})}catch(h){d.rollback(),console.warn("Unable to AutoExpand"),console.warn(h)}}},{transactional:!1,ignoreShifts:!0}),this._headerValueListener=()=>{if(this._isUpdatingHeader)return;const l=this._columnsFromSheet();l&&this._updateColumns(l.columns,!1,l.forceUpdate,null)},e.readSheetHeader){const l=this._columnsFromSheet();n.columns=l.columns}const o=()=>{const l=this.getAnchorCoords();let a=0,c=0;if(l&&(a=r.getColumnHeaders().findVisibleIndex(l.colEnd).min,c=r.getRowHeaders().findVisibleIndex(l.rowEnd).min),l&&(a<l.colEnd||c<l.rowEnd)){const u=r.getColumnHeaders(),d=r.getRowHeaders(),h=u.findVisibleIndex(l.colStart).max,f=d.findVisibleIndex(l.rowStart).max;this._visibleRange={colStart:h,colEnd:a,rowStart:f,rowEnd:c},this._isHeaderVisible=!d.at(l.rowStart).isHidden(),this._isTotalVisible=!d.at(l.rowEnd).isHidden(),this._isFirstColumnVisible=!u.at(l.colStart).isHidden(),this._isLastColumnVisible=!u.at(l.colEnd).isHidden()}else this._visibleRange=null,this._isHeaderVisible=!0,this._isTotalVisible=!0,this._isFirstColumnVisible=!0,this._isLastColumnVisible=!0},i={onSizesChange:()=>{o()}};this._colHeadersSizeUnlistener=r.getColumnHeaders().addListeners(i),this._rowHeadersSizeUnlistener=r.getRowHeaders().addListeners(i),o()}this._fromJSON(n),this._names&&(this._namedItem=this._createNamed(),this._namedItem&&this._names.add(this._namedItem))}getSnapshot(e){const t=this.toJSON(),n=this.getAnchorCoords(),r=this.getName(),o={...t};delete o.ref;const i=this,l=Object.freeze({...e});let a=!1;return{async copyTo(c,u){const d=c.tables,h=c.range;({...l,...u}).isCut&&!a&&(i.delete(),a=!0);const f={colStart:h.colStart,rowStart:h.rowStart,colEnd:n.colEnd-n.colStart+h.colStart,rowEnd:n.rowEnd-n.rowStart+h.rowStart};return d.add(f,{json:o,isLoad:!0,hasHeader:!0,styleName:o.styleOptions?.name??null}),f},getCoords:()=>n,getSource:()=>i,getName:()=>r,getMarkOptions:()=>l,isISnapshot:!0}}getAnchorType(){return Xt.Type.TwoCell}getStyle(){if(this._styleCache)return this._styleCache;const e=this._getState();return e?(this._styleCache=this._styles.getTableStyle(e.styleOptions.name)??this._styles.getDefaultTableStyle(),this._styleCache):this._styles.getTableStyle(null)}addRows(e,t=1){const n={...this._getState().anchor};return n.rowEnd+=t,this._modifyTable({anchor:n},"Add Table Row"+(t>1?"s":"")),this}deleteRowsAt(e,t=1){let n={...this._getState().anchor};return n.rowEnd-=t,n.rowEnd<n.rowStart&&(n=null),this._modifyTable({anchor:n},"Delete Table Row"+(t>1?"s":"")),this}addColumn(e,t){const n=this._getState(),r={...n.anchor};r.colEnd+=1;const o=[],i={name:`${t??n.columns[e-1]?.name??`Column${e+1}`}3`};o.push(i);const l=[...n.columns.slice(0,e),...o,...n.columns.slice(e)];return this._modifyTable({anchor:r,columns:l},"Add Table Column"),i}getColumns(){return this._getState()?.columns}convertToRange(e=Number.MAX_SAFE_INTEGER){let t=this._beginCommit("Convert to Range");try{if(this._sheet){const n=this.getAnchorCoords(),r=(n.colEnd-n.colStart+1)*(n.rowEnd-n.rowStart+1);if(r>e)throw new Error(`There are ${r} and there is a limit of ${e}.`);const o=this._sheet.getRange(n),i=o.startIncrementalUpdates({orientation:B.Orientation.Column});o.forEach((l,a)=>{const c=a.getCoords(),u=a.getCell();i.pushAt(c.rowIndex,c.colIndex,{style:u.getStyle(!1)})},{includeEmpty:!0,orientation:B.Orientation.Column}),i.apply()}this.delete()}catch{t.rollback(),t=null}return t&&t.commit(),this._sheet.getRange(this._getState()?.anchor)}resize(e,t="Resize Table"){let n=this._sheet.getRange(e).getCoords();const r=this._getState().anchor;if(r.rowStart!==n.rowStart||n.colEnd<r.colStart||n.colStart>r.colEnd)throw new Error("The top of the table must not change and the new table location must overlap with the original table.");const o=this._beginCommit(t);try{n=this._options.setContainerCoords(e),q.isEqualRanges(n,r)||this._modifyTable({anchor:n}),o.commit()}catch(i){throw console.warn(i),o.rollback(),i}return this._sheet.getRange(n)}getName(){return this._getState()?.name}setName(e){const t=this._beginCommit(`Set Table Name '${e}'`);try{this._modifyTable({name:e}),t.commit()}catch(n){throw t.rollback(),n}return this}getDescription(){return this._getState()?.description}setDescription(e){return this._modifyTable({description:e})}select(e){return this.getUsedRange().select(e)}getRange(){return this._range?this._range:this._getState()?this._range=this._sheet.getRange(this._getState().anchor):so}_processRestoreOrRevert(e,t,n){this._styleCache=null,super._processRestoreOrRevert(e,t,n)}_processAnchorCoords(){this._range=null,super._processAnchorCoords()}getUsedRange(){const e=this._getUsedCoords();return e?this._sheet.getRange(e):so}_getUsedCoords(){const e=this._getState(),t=e.headerRowCount,n=e.totalsRowCount,r=e.anchor;if(!r)return null;const o={...r,rowStart:r.rowStart+t,rowEnd:r.rowEnd-n};return o.rowEnd<o.rowStart||o.colEnd<o.colStart?null:o}getHeaderRange(){const e=this._getHeaderCoords();return e?this._sheet.getRange(e):so}_getHeaderCoords(){const e=this._getState(),t=e.headerRowCount;if(t<1)return null;const n=e.anchor;return n?{...n,rowEnd:n.rowStart+t-1}:null}getTotalRange(){const e=this._getTotalCoords();return e?this._sheet.getRange(e):so}_getTotalCoords(){const e=this._getState(),t=e.totalsRowCount;if(t<1)return null;const n=e.anchor;return n?{...n,rowStart:n.rowEnd-t+1}:null}getStyleOptions(){return this.isClosed()?bl:this._getState()?.styleOptions}updateStyleOptions(e,t="Update Style Info"){const n=this.getStyleOptions(),r=e?{...n,...e}:bl;return this._modifyTable({styleOptions:r},t),this._styleCache=null,this._getEmitter().notify("onStyleChange"),this}getStyleAt(e){let t=this._stylePropsCache;return t||(t=this.getStyle().getRanged(this),this._stylePropsCache=t),xs(this._styles,t,q.cellToRange(e))}getShowTotals(){return this._getState()?.totalsRowCount>0}setShowTotals(e){return this._modifyTable({totalsRowCount:e?1:0},"Toggle Show Totals")}getShowHeaders(){return this._getState()?.headerRowCount>0}setShowHeaders(e){return this._modifyTable({headerRowCount:e?1:0},"Toggle Show Headers")}getShowFilterButton(){const e=this.getFilter();return!!e&&e.getShowFilterButton()}setShowFilterButton(e){const t=this.getFilter();return t?(t.setShowFilterButton(e),this):this}_applyFilterAndSort(){console.log("apply Filter",this.getFilter(),this.getSort()),this._processTableUpdate?.(),this._getEmitter().notify("onAnyChange")}_processUpdate(){this._processTableUpdate?.(),this._getEmitter().notify("onAnyChange")}_createFilter(e){const t=this;return new NS({initialAnchor:this._getUsedCoords(),maxRangeCoords:this._options.maxRangeCoords,json:e,transactions:this._getTransactions(),setContainerShiftCallback(n){t._filterShiftCallback=n},setFilterCoordsCallback(n){t._filterCoordsCallback=n},deleteFromContainer:n=>{this._updateState({filter:null},{description:n?.description??"Delete Filter"}),t._processUpdate?.()},apply:n=>{t._applyFilterAndSort()},processUpdate:()=>{t._processUpdate?.()},isProtected:()=>t.isProtected()})}insertFilter(){let e=this.getFilter();return e||(e=this._createFilter(),this._updateState({filter:e},{description:"Insert Filter"}),e)}getFilter(){return this._getState()?.filter??null}_createSort(e){const t=this;return new lv({initialAnchor:this._getUsedCoords(),maxRangeCoords:this._options.maxRangeCoords,json:e,transactions:this._getTransactions(),deleteFromContainer:n=>{this._updateState({sort:null},{description:n?.description??"Delete Sort"}),t._processUpdate?.()},apply:n=>{t._applyFilterAndSort()},processUpdate:()=>{t._processUpdate?.()},isProtected:()=>t.isProtected()})}insertSort(){let e=this.getSort();return e||(e=this._createSort(),this._updateState({sort:e},{description:"Insert Sort"}),e)}getSort(){return this._getState()?.sort??null}getColumnFilter(e){const t=this.getFilter();if(!t)return null;const n=this.getSort();let r=null;return r=this._getState()?.columns[e],r===null?null:new cv(r.name,t,n,e)}getVisibleRefRangeCoords(){return this._visibleRange?this._visibleRange:this.getAnchorCoords()}getVisibleCellCoords(e){return e&&this._visibleRange?{colIndex:Math.min(this._visibleRange.colEnd,Math.max(this._visibleRange.colStart,this._sheet.getColumnHeaders().findVisibleIndex(e.colIndex).min)),rowIndex:Math.min(this._visibleRange.rowEnd,Math.max(this._visibleRange.rowStart,this._sheet.getRowHeaders().findVisibleIndex(e.rowIndex).min))}:e}isHeaderVisible(){return this._isHeaderVisible}isTotalVisible(){return this._isTotalVisible}isFirstColumnVisible(){return this._isFirstColumnVisible}isLastColumnVisible(){return this._isLastColumnVisible}_columnsFromSheet(){const e=this._getHeaderCoords();if(!e||!this._sheet){const n=this.getAnchorCoords();return{columns:n?Array(n.colEnd-n.colStart+1).fill(null):[],forceUpdate:!0}}const t={columns:[],forceUpdate:!1};return this._sheet.getRange({...e,rowEnd:e.rowStart}).forEach((n,r)=>{const o=r.getCell();t.columns.push({name:o.toText()}),t.forceUpdate=t.forceUpdate||o.getType()!==Le.String},{includeEmpty:!0}),t}_updateColumns(e,t,n=!1,r){if(this._isUpdatingHeader)return;const o=this._getHeaderCoords(),i=this._getUsedCoords(),l=[];if(i){const h=i.colEnd-i.colStart+1;for(let f=0;f<h;f++){const g=e[f];l.push({...g})}}let a=!1;const c=this._getState().columns;if(a=t?((h,f)=>{const g=new Set,m=w=>!!w&&!g.has(w.toLocaleLowerCase()),p=(w,b,C,_)=>_(w)?w:b+(C+1);let S=0;for(let w=0;w<h.length;w++){const b=p(h[w]?.name||f[w]?.name,h[w]?.name||"Column",S,m);g.add(b.toLocaleLowerCase()),h[w]?.name!==b&&(h[w].name=b,S++)}return S>0})(l,c):om(l,c,r),!(n||c.length!==l.length||a))return;const u="Update Columns";this._isUpdatingHeader=!0;let d=this._beginCommit(u);try{if(this._updateState({columns:l},{description:u}),this._sheet&&o){const h=this._sheet.getEntireRange().startIncrementalUpdates({orientation:B.Orientation.Row});for(let f=0;f<l.length;f++){const g=l[f].name;h.pushAt(o.rowStart,o.colStart+f,g)}h.apply({textParser:!1})}}catch{d.rollback()}return d&&d.commit(),this._isUpdatingHeader=!1,l}_processDelete(){this._getState().headerRemoveListener?.(),this._updateState({headerRemoveListener:null}),super._processDelete()}_processFilterUpdate(){const e=this._getUsedCoords();console.log("process on Filter and Sort dataRange",e)}_processContainerShift(e){if(e.isSplit)throw new Error("We can not partially insert or remove cells as this would split a table.");const t=this._getState();if(e.after&&e.after.rowStart+t.headerRowCount>=e.after.rowEnd+1)throw new Error(Rd);const n=e.orientation===B.Orientation.Column;if(e.amount<0&&e.after&&!n){const o=this._getHeaderCoords();if(o&&e.intersect.rowStart<=o.rowEnd&&e.intersect.rowEnd>=o.rowStart)throw new Error("We can not remove rows that contain table headers. Remove the table header.")}const r=super._processContainerShift(e);if(n){let o=e.amount,i=e.intersect.colStart-e.before.colStart;if(i<=0&&o>0)return;i<0&&(o-=i,i=0);const l=this._getState()?.columns;let a=[...l],c=[],u=[];if(o>0){a.splice(i,0,...Array(o).fill(null)),c=[...a];const d=new Set;for(let p=0;p<l.length;p++)d.add(l[p]?.name?.toLowerCase().trim());const h=l[i-1],f=h?.name?.match(/\d+$/);let g=null,m=0;f&&(g=f.input.substring(0,f.index),m=parseInt(f[0]));for(let p=0;p<o;p++){let S={...h};c[i+p]=S;const w=g+(m+p+1);w&&!d.has(w.toLowerCase().trim())&&(S.name=w)}om(c,a,null)}else c=a,u=c.splice(i,-o);this._updateState({columns:c},{description:"Process Columns"}),this._updateColumns(c,!1,!0,u)}else e.after||this._updateState({columns:[]},{description:"Process Columns"});return e.after||this._delete(),this._filterShiftCallback&&this._filterShiftCallback({...e,after:this._getUsedCoords()}),r}_modifyTable(e,t="Modify Table"){if(this.isClosed())throw new Error("Table has been closed. No further operations are allowed.");const n=this._getState(),r=n.anchor,o=n.headerRowCount,i=this._getHeaderCoords();let l=this._beginCommit(t);try{if(this._updateState(e),e.name!==void 0){if(!e.name)throw new Error("Table must have a name.");this._setNameOnContainer?.(e.name)}let a=e.anchor??null;if((e.anchor!==void 0||e.headerRowCount!==void 0||e.totalsRowCount!==void 0)&&e.headerRowCount!==void 0&&o!==e.headerRowCount)if(e.headerRowCount>o){const c=r.rowStart-(e.headerRowCount-o);this._sheet&&(c<this._options.maxRangeCoords.rowStart||this._sheet.getRange({...r,rowStart:c,rowEnd:r.rowStart-1}).isContentful())?(this._sheet.getRange({...r,rowStart:r.rowStart+e.headerRowCount,rowEnd:r.rowStart+e.headerRowCount}).insert(B.Orientation.Row),a={...r,rowEnd:r.rowEnd+(e.headerRowCount-o)}):a={...r,rowStart:r.rowStart+(o-e.headerRowCount)}}else i&&this._sheet&&this._sheet.doBatch(()=>{this._sheet.getRange(i).clear()},{}),a={...r,rowStart:r.rowStart+(o-(e.headerRowCount??o))};if(a){let c=n.columns;const u=e.headerRowCount!==void 0&&e.headerRowCount!==n.headerRowCount||e.totalsRowCount!==void 0&&e.totalsRowCount!==n.totalsRowCount,d=a.colStart!==r.colStart||a.colEnd!==r.colEnd;let h=[];if(d){const f=[...n.columns];a.colEnd>r.colEnd?f.splice(r.colEnd+1,0,...Array(a.colEnd-r.colEnd).fill(null)):a.colEnd<r.colEnd&&(h=f.splice(a.colEnd-1,r.colEnd-a.colEnd)),a.colStart<r.colStart?f.splice(0,0,...Array(r.colStart-a.colStart).fill(null)):a.colStart>r.colStart&&(h=h.concat(f.splice(0,a.colStart-r.colStart))),c=f}if(this._options.setContainerCoords?.(a),this._updateState({anchor:a,columns:c},{description:t}),!this._getUsedCoords())throw new Error(Rd);if(d||u){const f=u?{columns:c,forceUpdate:!0}:this._columnsFromSheet();f&&(this._updateColumns(f.columns,!1,f.forceUpdate,h),this._processHeaderListener())}this._filterCoordsCallback?.(a)}e.styleOptions!==void 0&&(this._styleCache=null),this._getEmitter().notify("onAnyChange"),l.commit()}catch(a){throw l.rollback(),a}return this}addListeners(e,t){return this._emitter.addListeners(e,t)}_processStateChange(e,t,n){super._processStateChange(e,t,n),this._styleCache=null,this._stylePropsCache=null,this._processTableUpdate?.(),this._getEmitter().notify("onAnyChange")}_processHeaderListener(){if(this._getState().headerRemoveListener?.(),this._sheet){let e=this._getHeaderCoords();if(!e){const n=this._getUsedCoords();e={...n,rowEnd:n.rowStart}}const t=this._sheet.getRange(e).addListener(this._headerValueListener,{transactional:!0});this._updateState({headerRemoveListener:t})}}get[Symbol.toStringTag](){return"[Table]"}toString(){return this.getName()??""}toJSON(){const e={},t=this._getState();if(!t)return null;if(t.name&&(e.name=t.name),t.anchor&&(e.ref=Pr(t.anchor,this._options.maxRangeCoords)),t.description&&(e.description=t.description),t.headerRowCount!==1&&(e.headerRowCount=t.headerRowCount),t.totalsRowCount!==0&&(e.totalsRowCount=t.totalsRowCount),t.columns&&(e.columns=[...t.columns]),t.styleOptions){const n=P.diffValues(t.styleOptions,{...bl,name:null});n&&(e.styleOptions=n)}if(t.filter){const n=t.filter.toJSON();n&&(e.filter=n,delete e.filter.ref)}return e}_createNamed(){return this._sheet?.getName()&&this._names?new uv(this._names,this._sheet,this,{transactions:this._getTransactions(),json:{name:this.getName()}}):null}_fromJSON(e){const t=e??{},n={headerRowCount:1,totalsRowCount:0};var r;if(t.name&&(n.name=t.name),t.ref&&(t.ref=(r=t.ref)&&typeof r=="string"?Jn(r):r),this._names){const l=this._names.findValidName(n.name??rm);n.name!==l&&(n.name=l)}n.name||(n.name=rm),t.description&&(n.description=t.description),t.headerRowCount!==void 0&&(n.headerRowCount=t.headerRowCount),t.totalsRowCount!==void 0&&(n.totalsRowCount=t.totalsRowCount),n.columns=t.columns??P.EmptyArray,n.styleOptions={...bl,...t.styleOptions};const o="Insert Table";this._updateState(n,{description:o});const i=this._columnsFromSheet();i&&(n.columns=this._updateColumns(i.columns,!0,i.forceUpdate,null),delete n.columns),t.sort&&(n.sort=this._createSort(t.sort)),t.filter&&(n.filter=this._createFilter(t.filter)),this._modifyTable(n,o),this._processHeaderListener()}close(){super.close(),this.isClosed()||(this._autoExpandRemoveListener?.(),this._getState()?.headerRemoveListener?.(),this._updateState({headerRemoveListener:null},{description:"Close Table"}),this._stylesRemoveListener?.(),this._colHeadersSizeUnlistener?.(),this._rowHeadersSizeUnlistener?.())}get isITable(){return!0}}let On=null;const qs="TableStyleMedium2",nr=(s,e,t)=>{if(!s.border)return s;let n=((o,i,l)=>{if(!o)return o;let a=null;return(o.top||o.horizontal)&&(i.rowIndex!==l.rowStart||i.colIndex<l.colStart||i.colIndex>l.colEnd)&&(a=a??{...o},delete a.top,o.horizontal&&(a.top=o.horizontal)),(o.bottom||o.horizontal)&&(i.rowIndex!==l.rowEnd||i.colIndex<l.colStart||i.colIndex>l.colEnd)&&(a=a??{...o},delete a.bottom,o.horizontal&&(a.bottom=o.horizontal)),(o.left||o.vertical)&&(i.colIndex!==l.colStart||i.rowIndex<l.rowStart||i.rowIndex>l.rowEnd)&&(a=a??{...o},delete a.left,o.vertical&&(a.left=o.vertical)),(o.right||o.vertical)&&(i.colIndex!==l.colEnd||i.rowIndex<l.rowStart||i.rowIndex>l.rowEnd)&&(a=a??{...o},delete a.right,o.vertical&&(a.right=o.vertical)),o.horizontal&&(a=a??{...o},delete a.horizontal),o.vertical&&(a=a??{...o},delete a.vertical),a??o})(s.border,e,t),r=s;return n!==s.border&&(r={...s},Object.keys(n).length>0?r.border=n:delete r.border),r};class hv{constructor(e,t,n){this._table=e,this._styles=t,this._properties=n}_resolveProperties(e){const t={name:e.name},n=this._styles,r=Object.values(bo.ElementType),o=r.length;for(let i=0;i<o;i++){const l=r[i],a=e[l];if(!a||!P.isObject(a))continue;const c=Vt.resolveTypedUpdates(Object.freeze(a),Wt,n);t[l]=c}return Object.freeze(t)}getCoords(){return this._table.getAnchorCoords()}getPropertiesAt(e,t){const n=this._table,r=this._styles,o=this._properties;_u.rowIndex=e,_u.colIndex=t;const i=n.getVisibleCellCoords(_u),l=n.getVisibleRefRangeCoords();if(!l)return null;const a=Math.max(0,l.colEnd-l.colStart)+1,c=Math.max(0,l.rowEnd-l.rowStart)+1,u=Math.max(0,i.rowIndex-l.rowStart),d=Math.max(0,i.colIndex-l.colStart),h={rowIndex:u,colIndex:d},f=n.getStyleOptions();let g={},m=!1,p=0;n.isHeaderVisible()&&(p=n.getShowHeaders()?1:0,m=p>u);let S=!1,w=0;n.isTotalVisible()&&(w=n.getShowTotals()?1:0,S=c-w<=u);let b=d===a-1&&f.showLastColumn;n.isLastColumnVisible()||(b=!1);let C=d===0&&f.showFirstColumn;n.isFirstColumnVisible()||(C=!1);const _=!m&&!S;if(o.wholeTable&&(g=o.wholeTable,g.border&&(g=nr(g,h,{rowStart:0,rowEnd:c-1,colStart:0,colEnd:a-1}))),_&&f.showColumnStripes){const y=o.firstColumnStripe?.size??1,v=o.secondColumnStripe?.size??1;let x=d%(y+v);const E=x<y;E||(x-=y);let R=E?o.firstColumnStripe:o.secondColumnStripe;if(R){let I=R,A=R.border;if(A){const T={rowIndex:u,colIndex:x},O={rowStart:p,rowEnd:c-w-1,colStart:0,colEnd:Math.min(a-d,E?y:v)};I=nr(I,T,O),E&&x===0&&d>0&&A?.left&&o.secondColumnStripe?.border.right&&(A={...I.border},I.border=A,A.left=null),E&&x===y-1&&d<a-1&&A?.right&&o.secondColumnStripe?.border.left&&(A={...I.border},I.border=A,A.right=null)}g=Vt.resolveTypedUpdates(I,Wt,r,g)}}if(_&&f.showRowStripes){const y=p,v=c-w-1,x=o.firstRowStripe?.size??1,E=o.secondRowStripe?.size??1;let R=(u-y)%(x+E);const I=R<x;I||(R-=x);let A=I?o.firstRowStripe:o.secondRowStripe;if(A){let T=A,O=A.border;if(O){const N={colIndex:d,rowIndex:R},D={colStart:0,colEnd:a-1,rowStart:0,rowEnd:Math.min(c-u,I?x:E)};T=nr(T,N,D),I&&R===0&&u>=y&&A.border?.top&&o.secondRowStripe?.border.bottom&&(O={...T.border},T.border=O,O.top=null);const F=A.border?.bottom;(F&&I&&R===x-1&&u<v&&o.secondRowStripe?.border.top||F&&u===v)&&(O={...T.border},T.border=O,O.bottom=null)}g=Vt.resolveTypedUpdates(T,Wt,r,g)}}if(b&&o.lastColumn){let y=o.lastColumn;y.border&&(y=nr(y,h,{rowStart:0,rowEnd:c-1,colStart:a-1,colEnd:a-1})),g=Vt.resolveTypedUpdates(y,Wt,r,g)}if(C&&o.firstColumn){let y=o.firstColumn;y.border&&(y=nr(y,h,{rowStart:0,rowEnd:c-1,colStart:0,colEnd:0})),g=Vt.resolveTypedUpdates(y,Wt,r,g)}if(m&&o.headerRow){let y=o.headerRow;y.border&&(y=nr(y,h,{rowStart:0,rowEnd:p-1,colStart:0,colEnd:a-1})),g=Vt.resolveTypedUpdates(y,Wt,r,g)}if(S&&o.totalRow){let y=o.totalRow;y.border&&(y=nr(y,h,{rowStart:c-w,rowEnd:c-1,colStart:0,colEnd:a-1})),g=Vt.resolveTypedUpdates(y,Wt,r,g)}if(m&&C&&o.firstHeaderCell){let y=o.firstHeaderCell;y.border&&(y=nr(y,h,{rowStart:0,rowEnd:p-1,colStart:0,colEnd:0})),g=Vt.resolveTypedUpdates(y,Wt,r,g)}if(m&&b&&o.lastHeaderCell){let y=o.lastHeaderCell;y.border&&(y=nr(y,h,{rowStart:0,rowEnd:p-1,colStart:a-1,colEnd:a-1})),g=Vt.resolveTypedUpdates(y,Wt,r,g)}if(S&&C&&o.firstTotalCell){let y=o.firstTotalCell;y.border&&(y=nr(y,h,{rowStart:c-w,rowEnd:c-1,colStart:0,colEnd:0})),g=Vt.resolveTypedUpdates(y,Wt,r,g)}if(S&&b&&o.lastTotalCell){let y=o.lastTotalCell;y.border&&(y=nr(y,h,{rowStart:c-w,rowEnd:c-1,colStart:a-1,colEnd:a-1})),g=Vt.resolveTypedUpdates(y,Wt,r,g)}return m&&o.headerRow&&n.getColumnFilter(d)&&!n.getColumnFilter(d).hasHiddenButton()&&(g.insets={right:15}),g}}class sm{constructor(e,t,n,r){this._styles=e,this._isBuiltIn=n,this._doDelete=r,this._properties=P.deepFreeze(this._resolveProperties(t)),this.isShownInTableStyles()}_resolveProperties(e){const t={name:e.name};e.table!==void 0&&(t.table=e.table),e.pivot!==void 0&&(t.pivot=e.pivot);const n=this._styles,r=Object.values(bo.ElementType),o=r.length;for(let i=0;i<o;i++){const l=r[i],a=e[l];if(!a||!P.isObject(a))continue;const c=Vt.resolveTypedUpdates(Object.freeze(a),Wt,n);t[l]=c}return Object.freeze(t)}delete(){if(!this._doDelete)throw new Error("Not able to delete builtin style.");this._doDelete(this._properties.name)}getRanged(e){return new hv(e,this._styles,this._properties)}getProperties(){return this._properties}getName(){return this._properties.name}isShownInTableStyles(){return this._properties.table!==!1}isShownInPivotStyles(){return this._properties.pivot??!1}isBuiltIn(){return this._isBuiltIn}toJSON(){const e=P.cloneObject(this._properties);return e.name=this._properties.name,e}get isITableStyle(){return!0}}const _u={rowIndex:0,colIndex:0};class gv extends Yt{constructor(e,t){super(e,q.EmptyRange,t)}isEmpty(){return this._p===null}getCoords(){return this._r}cloneWithUpdate(e){if(e===void 0)return this;const t=this._c,n=this._r,r=Vt.resolveTypedUpdates(e,Wt,t,this._p);return new Yt(t,n,r)}_createShifted(e){return new Yt(this._c,e,this._p)}getShifted(e){return e.after?{...e.after,value:this._createShifted(q.sanitizeRange(e.after))}:null}getSplit(e,t){const n=this._c,r=this._p;return[new Yt(n,e[0],r),new Yt(n,e[1],r)]}getMerged(e,t,n){const r=this._p,o=e._p;if(r&&!o||o&&!r||!r&&!o)return;let i=Object.keys(r),l=Object.keys(o);if(r.named===Qe.BuiltInName.Normal&&(i=i.filter(c=>c.toLowerCase()!==Qe.BuiltInName.Normal)),o.named===Qe.BuiltInName.Normal&&(l=l.filter(c=>c.toLowerCase()!==Qe.BuiltInName.Normal)),i.length!==l.length)return;for(let c=0;c<i.length;c++){const u=i[c],d=r[u],h=o[u];if(!P.deepEqual(d,h))return}const a=this._c;return new Yt(a,t,this._p)}getPropertiesAt(e,t){return this._p}toJSON(){return P.toSafeJSON(this._p)}}class im{constructor(e,t,n,r=null){this._name=t.name,this._properties=t,this._rangeStyle=new gv(e,t.style),this._doDelete=n,this._builtInID=r}getRanged(){return this._rangeStyle}getName(){return this._name}isHidden(){return this._properties.hidden??!1}getILevel(){return this._properties.iLevel??null}getBuiltInID(){return this._builtInID}delete(){this._doDelete?.(this)}toJSON(){return this._properties?P.toSafeJSON(this._properties):null}get isINamed(){return!0}}let fv=class{constructor(s,e,t,n,r){this._state=s,this._normalJSON=e??{},this._toJSONInternal=t,this._fromJSONInternal=n,this._onLastEnd=r,this._state.openScopes.add(this),this._isClosed=!1,this._state.byJSONs.set(Ec(this._normalJSON),0),this._state.byIds.set(0,this._normalJSON)}endPersist(){if(!this._state.openScopes.delete(this))throw new Error("PersistScope is closed.");this._isClosed=!0,this._state.openScopes.size===0&&this._onLastEnd()}getElementID(s){if(this._isClosed)throw new Error("PersistScope is closed.");const e=Ec(s=s??{});let t=this._state.byJSONs.get(e);return t!==void 0||(t=this._state.byJSONs.size,this._state.byJSONs.set(e,t),this._state.byIds.set(t,s)),t}getElementJSON(s){if(this._isClosed)throw new Error("PersistScope is closed.");return this._state.byIds.get(s)??null}fromJSON(s){if(this._isClosed)throw new Error("PersistScope is closed.");const e=JSON.parse(JSON.stringify(s||{}));this._fromJSONInternal(e);const t=e.direct,n=t?t.length:0;for(let r=0;r<n;r++){const o=r,i=t[r],l=Ec(i);this._state.byIds.set(o,i),this._state.byJSONs.set(l,o)}}toJSON(){if(this._isClosed)throw new Error("PersistScope is closed.");const s=[];return this._state.byIds.forEach((e,t)=>{s[t]=e}),s.length===1&&s.splice(0,1),this._toJSONInternal(s)}},qi=class{constructor(e=null,t=null,n=11){this._emitter=null,this._normalRanged=null,this._theme=e??new th().getDefaultTheme(),this._defaultFontSize=n;const r=this;this._emitter=new gn(this),this._schemeLookup=o=>r._theme.schemeLookup()(o),this._indexedColors=this._fromJSONIndexedColors(t),this._indexedLookup=o=>{const i=this._indexedColors[o];return i?i.toRGBA():xa(o)},this._initializeBuiltIns(),this._customCellStyles=new Map,this._customTableStyles=new Map,this._indexedColors=[],this._mruColors=[],this._persistCache=null}_initializeNamedStyles(e,t){const n=e?e.length:0;for(let r=0;r<n;r++){const o=e[r],i={...o},l=o.named;delete i.named;const a=Vt.resolveTypedUpdates(i,Wt,this),c=new im(this,{name:l,style:a},this._hideOrRemoveNamed.bind(this),r);l===Qe.BuiltInName.Normal&&(this._normalRanged=c.getRanged(),this._normalStyle=xs(this,null)),t.set(l.toLowerCase(),c)}}_initializeTableStyles(){const e=(()=>{if(On)return On;On=new Map;const n=(d,h)=>{if(h===0)return"TableStyleNone";let f="Custom";return d==="l"?f="Light":d==="m"?f="Medium":d==="d"&&(f="Dark"),`TableStyle${f}${h}`},r=(d,h=0)=>h===0?d:h>0?`${d} lumMod ${100-h}, lumOff ${h}`:h<0?`${d} lumMod ${100+h}`:void 0,o=d=>({type:He.Type.Pattern,patternType:He.BuiltInSheetPattern.Solid,foreground:d,background:d}),i=(d,h=!1)=>{const f={fill:d};return h&&(f.weight=700),f},l=(d,h=Ce.StrokeStyle.Thin)=>({style:h,color:d}),a=(d,h)=>{for(let f=0;f<7;f++)d.push(h(`accent${f+1}`))};let c=0,u=[];u.push(["dk1",r("bg1",-15),"dk1"]),a(u,d=>[r(d,-25),r(d,80),d]),c=1;for(let d=0;d<7;d++){const h=n("l",d+c),f=u[d][0],g=u[d][1]??f,m=u[d][2]??f;On.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),border:{top:l(m),bottom:l(m)}},headerRow:{font:i(f,!0),border:{bottom:l(m)}},totalRow:{font:i(f,!0),border:{top:l(m)}},firstColumn:{font:i(f,!0)},lastColumn:{font:i(f,!0)},firstRowStripe:{fill:o(g)},firstColumnStripe:{fill:o(g)}}))}c+=7,u=[],u.push(["dk1","dk1","lt1"]),a(u,d=>["dk1",d,"lt1"]);for(let d=0;d<7;d++){const h=n("l",d+c),f=u[d][0],g=u[d][1],m=u[d][2];On.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),border:{left:l(g),right:l(g),top:l(g),bottom:l(g)}},headerRow:{font:i(m,!0),fill:o(g)},totalRow:{font:i(f,!0),border:{top:l(g,Ce.StrokeStyle.Double)}},firstColumn:{font:i(f,!0)},lastColumn:{font:i(f,!0)},firstRowStripe:{border:{top:l(g)}},secondRowStripe:{border:{top:l(g)}},firstColumnStripe:{border:{left:l(g)}},secondColumnStripe:{border:{left:l(g)}}}))}c+=7,u=[],u.push(["dk1",r("bg1",-15)]),a(u,d=>[d,r(d,80)]);for(let d=0;d<7;d++){const h=n("l",d+c),f="dk1",g=u[d][0],m=u[d][1];On.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),border:{left:l(g),right:l(g),top:l(g),bottom:l(g),horizontal:l(g),vertical:l(g)}},headerRow:{font:i(f,!0)},totalRow:{font:i(f,!0),border:{top:l(g,Ce.StrokeStyle.Double)}},firstColumn:{font:i(f,!0)},lastColumn:{font:i(f,!0)},firstRowStripe:{fill:o(m)},firstColumnStripe:{fill:o(m)}}))}c=1,u=[],u.push(["dk1","dk1",r("bg1",-15)]),a(u,d=>[d,r(d,40),r(d,80)]);for(let d=0;d<7;d++){const h=n("m",d+c),f="dk1",g="lt1",m=u[d][0],p=u[d][1],S=u[d][2];On.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),border:{left:l(p),right:l(p),top:l(p),bottom:l(p),horizontal:l(p)}},headerRow:{font:i(g,!0),fill:o(m)},totalRow:{font:i(f,!0),border:{top:l(m,Ce.StrokeStyle.Double)}},firstColumn:{font:i(f,!0)},lastColumn:{font:i(f,!0)},firstRowStripe:{fill:o(S)},firstColumnStripe:{fill:o(S)}}))}c+=7,u=[],u.push(["dk1",r("bg1",-15),r("bg1",-35)]),a(u,d=>[d,r(d,80),r(d,60)]);for(let d=0;d<7;d++){const h=n("m",d+c),f="dk1",g="lt1",m=u[d][0],p=u[d][1],S=u[d][2];On.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),fill:o(p),border:{horizontal:l(g),vertical:l(g)}},headerRow:{font:i(g,!0),fill:o(m),border:{bottom:l(g,Ce.StrokeStyle.Thick)}},totalRow:{font:i(g,!0),fill:o(m),border:{top:l(g,Ce.StrokeStyle.Thick)}},firstColumn:{font:i(g,!0),fill:o(m)},lastColumn:{font:i(g,!0),fill:o(m)},firstRowStripe:{fill:o(S)},firstColumnStripe:{fill:o(S)}}))}c+=7,u=[],u.push(["dk1",r("bg1",-15),r("bg1",-35)]),a(u,d=>[d,r(d,80),r(d,60)]);for(let d=0;d<7;d++){const h=n("m",d+c),f="dk1",g="lt1",m=u[d][0],p=r("bg1",-15);On.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),border:{top:l(f,Ce.StrokeStyle.Medium),bottom:l(f,Ce.StrokeStyle.Medium),left:d===0?l(f,Ce.StrokeStyle.Thin):void 0,right:d===0?l(f,Ce.StrokeStyle.Thin):void 0,horizontal:d===0?l(f,Ce.StrokeStyle.Thin):void 0,vertical:d===0?l(f,Ce.StrokeStyle.Thin):void 0}},headerRow:{font:i(g,!0),fill:o(m),border:{bottom:l(f,Ce.StrokeStyle.Medium)}},totalRow:{border:{top:l(f,Ce.StrokeStyle.Double)}},firstColumn:{font:i(g,!0),fill:o(m)},lastColumn:{font:i(g,!0),fill:o(m)},firstRowStripe:{fill:o(p)},firstColumnStripe:{fill:o(p)}}))}c+=7,u=[],u.push(["dk1",r("bg1",-15),r("bg1",-35),"dk1"]),a(u,d=>[d,r(d,80),r(d,60),r(d,40)]);for(let d=0;d<7;d++){const h=n("m",d+c),f="dk1",g=u[d][0],m=u[d][1],p=u[d][2],S=u[d][3];On.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),fill:o(m),border:{top:l(S),right:l(S),left:l(S),bottom:l(S),vertical:l(S),horizontal:l(S)}},headerRow:{font:i(f),fill:o(m)},totalRow:{font:i(f),border:{top:l(g,Ce.StrokeStyle.Medium)}},firstColumn:{font:i(f,!0)},lastColumn:{font:i(f,!0)},firstRowStripe:{fill:o(p)},firstColumnStripe:{fill:o(p)}}))}c=1,u=[],u.push(["dk1",r("dk1",15),r("dk1",25),r("dk1",50)]),a(u,d=>["dk1",r(d,-50),r(d,-25),d]);for(let d=0;d<7;d++){const h=n("d",d+c),f="lt1",g=u[d][0],m=u[d][1],p=u[d][2],S=u[d][3];On.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),fill:o(S)},headerRow:{font:i(f,!0),fill:o(g),border:{bottom:l(f,Ce.StrokeStyle.Medium)}},totalRow:{font:i(f,!0),fill:o(m),border:{top:l(f,Ce.StrokeStyle.Medium)}},firstColumn:{font:i(f,!0),fill:o(p),border:{right:l(f,Ce.StrokeStyle.Medium)}},lastColumn:{font:i(f,!0),fill:o(p),border:{left:l(f,Ce.StrokeStyle.Medium)}},firstRowStripe:{fill:o(p)},firstColumnStripe:{fill:o(p)}}))}c+=7,u=[],u.push([r("bg1",-15),"dk1",r("bg1",-35)]),u.push([r("accent1",80),"accent2",r("accent1",60)]),u.push([r("accent3",80),"accent4",r("accent3",60)]),u.push([r("accent5",80),"accent6",r("accent5",60)]);for(let d=0;d<4;d++){const h=n("d",d+c),f="dk1",g="lt1",m=u[d][0],p=u[d][1],S=u[d][2];On.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),fill:o(m)},headerRow:{font:i(g,!0),fill:o(p)},totalRow:{font:i(f,!0),border:{top:l(f,Ce.StrokeStyle.Double)}},firstColumn:{font:i(f,!0)},lastColumn:{font:i(f,!0)},firstRowStripe:{fill:o(S)},firstColumnStripe:{fill:o(S)}}))}return On})(),t=new Map;return e.forEach((n,r)=>{const o=n.name.toLowerCase(),i=new sm(this,n,!0);t.set(o,i)}),t}_initializeBuiltIns(){const e=new Map;this._builtInsCellStyles=e,this._initializeNamedStyles(DC,e),this._builtInsTableStyles=this._initializeTableStyles(),this._emptyTableStyle=new bo.Empty(this._normalStyle)}getNormal(){return this._normalStyle}getNormalRanged(){return this._normalRanged}setTheme(e){this._theme=e,this._emitter.notify("onThemeChange"),this._emitter.notify("onAnyChange")}getTheme(){return this._theme}setDefaultFontSize(e){this._defaultFontSize=e,this._emitter.notify("onDefaultFontChange"),this._emitter.notify("onAnyChange")}getDefaultFontSize(){return this._defaultFontSize}beginPersist(){return this._persistCache||(this._persistCache={byIds:new Map,byJSONs:new Map,openScopes:new Set}),new fv(this._persistCache,{},this._toJSONInternal.bind(this),this._fromJSONInternal.bind(this),()=>{this._persistCache=null})}getNamed(e){if(!e)return null;e=e.toLowerCase();let t=null;return this._customCellStyles&&(t=this._customCellStyles.get(e)),t||(t=this._builtInsCellStyles.get(e)),t??null}getCustomNamed(){const e=Array.from(this._customCellStyles.values());return e.sort((t,n)=>t.getName().localeCompare(n.getName())),e}setNamed(e,t=!1){if(!e||!e.name||!e.style)throw new lr;this.validateStyleName(e.name,!1);const n=this._setCustomCellStyleInternal(e,t);return this._emitter.notify("onNamedStylesChange"),this._emitter.notify("onAnyChange"),n}_setCustomCellStyleInternal(e,t=!1,n=0){const r=e.name.toLowerCase(),o=this._builtInsCellStyles.get(r),i=o?.getBuiltInID()??null;let l=null;t&&(l=(this._customCellStyles.get(r)??o)?._properties??null);const a=ec(0,e.style,this.getNormal());e={...e,style:a};const c=Vt.resolveTypedUpdates(e,MC,this,l),u=new im(this,c,this._hideOrRemoveNamed.bind(this),i);return c.name===Qe.BuiltInName.Normal&&(this._normalRanged=u.getRanged(),this._normalStyle=xs(this,null)),this._customCellStyles.set(r,u),u}_setCustomTableStyleInternal(e,t){const n=e.toLowerCase();let r=this._customTableStyles.get(n)??this._builtInsTableStyles.get(n);r&&(e=r.getName());const o=new sm(this,{...t,name:e},!1,this._deleteCustomTableStyle.bind(this));return this._customTableStyles.set(n,o),o}_hideOrRemoveNamed(e){let t=null;if(t=typeof e=="string"?e:e?.getName?.(),!t||(t=t.toLowerCase(),t===Qe.BuiltInName.Normal.toLowerCase()))return!1;const n=this._builtInsCellStyles.get(t);let r=!1;if(n&&!n.isHidden()){const o=n.toJSON();this.setNamed({...o,hidden:!0}),r=!0}else t=t.toLowerCase(),r=this._customCellStyles.delete(t);return r&&(this._emitter.notify("onNamedStylesChange"),this._emitter.notify("onAnyChange")),r}getTableStyle(e){if(!e)return this._emptyTableStyle;let t=this._customTableStyles.get(e.toLowerCase());return t||(t=this._builtInsTableStyles.get(e.toLowerCase())),t??null}getCustomTableStyles(){const e=Array.from(this._customTableStyles.values());return e.sort((t,n)=>t.getName().localeCompare(n.getName())),e}setDefaultTableStyle(e){const t=e?.toLowerCase();return this._defaultTableStyle=this._customTableStyles.get(t)??this._builtInsTableStyles.get(t)??this._builtInsTableStyles.get(qs.toLowerCase()),this._emitter.notify("onTableStylesChange"),this._emitter.notify("onAnyChange"),e===this._defaultTableStyle.getName()}getDefaultTableStyle(){return this._defaultTableStyle||(this._defaultTableStyle=this._builtInsTableStyles.get(qs.toLowerCase())),this._defaultTableStyle}_deleteCustomTableStyle(e){const t=this._customTableStyles.get(e?.toLowerCase());return!!t&&(this._customTableStyles.delete(e.toLowerCase()),this._defaultTableStyle?.getName()===t.getName()&&(this._defaultTableStyle=this._builtInsTableStyles.get(qs.toLowerCase())),this._emitter.notify("onTableStylesChange"),this._emitter.notify("onAnyChange"),!0)}setCustomTableStyle(e,t){const n=this._setCustomTableStyleInternal(e,t);return this._emitter.notify("onTableStylesChange"),this._emitter.notify("onAnyChange"),n}validateStyleName(e,t=!1){if(!e||e.trim().length===0)throw new Error("Style name cannot be empty.");if(t&&this.getNamed(e)!==null)throw new Error("Style name is already taken.")}normalize(e,t){if(!e)return null;const n=Vt.resolveTypedUpdates(e,Wt,this);if(!n)return null;const r=RS;let o=null;const i=t??n.named??Qe.BuiltInName.Normal;if(o=i===Qe.BuiltInName.Normal?this._normalRanged.getPropertiesAt(0,0,null):this.getNamed(i)?.getRanged().getPropertiesAt(0,0,null),o){const a={...o};P.removeEqualValues(n,a)}const l=this.getTheme().getFontScheme();return P.removeEqualValues(n,{font:{size:this.getDefaultFontSize(),family:l.getMinorFont(),fallbacks:l.getMinorFallbacks()}}),P.removeEqualValues(n,r),n}schemeLookup(){return this._schemeLookup}indexedLookup(){return this._indexedLookup}parseColor(e){return Gt.parse(e,this._schemeLookup,this._indexedLookup)}recentColors(){return this._mruColors}addRecentColor(e){if(!e)return;const t=this._mruColors,n=[],r=e.toString(),o=t.length;for(let i=0;i<o&&i<10;i++){const l=t[i];l.toString()!==r&&n.push(l)}return n.unshift(e),this._mruColors=Object.freeze(n),this._mruColors}clearRecentColors(){this._mruColors=P.EmptyArray}getIndexedColors(){return this._indexedColors}setCustomIndexedColors(e){this._indexedColors=e?.length>0?[...e]:null}getCustomIndexedColors(){const e=this._indexedColors,t=Math.max(e?.length,66),n=[];for(let r=0;r<t;r++){const o=e[r];o!==null&&n.push(o??new Gt(xa(r)?.toString()))}return n}addListeners(e,t){return this._emitter.addListeners(e,t)}_toJSONInternal(e){const t={};e.length>0&&(t.direct=e);const n=this.getCustomNamed(),r=n.length,o=new Array(r);for(let g=0;g<r;g++){const m=n[g].toJSON();o[g]=m}o.length>0&&(t.named=o);const i={};this._defaultTableStyle&&this._defaultTableStyle.getName()!==qs&&(i.defaultTableStyle=this._defaultTableStyle.getName());const l={},a=this.getCustomTableStyles(),c=a.length;for(let g=0;g<c;g++){const m=a[g],p=m.toJSON();delete p.name,p&&Object.keys(p).length>0&&(l[m.getName()]=p)}Object.keys(l).length>0&&(i.styles=l),Object.keys(i).length>0&&(t.tables=i);const u=this._indexedColors,d=u.length??0;if(d>0){const g=new Array(d);for(let m=0;m<d;m++)g[m]=u[m].toString();t.indexedColors=g}const h=this._mruColors,f=h.length;if(f>0){const g=new Array(f);for(let m=0;m<f;m++)g[m]=h[m].toString();t.mruColors=g}return Object.keys(t).length===0?null:t}_fromJSONIndexedColors(e){if(!e||e.length===0)return P.EmptyArray;const t=e.length,n=new Array(t);if(t>0)for(let r=0;r<t;r++){const o=e[r];try{n[r]=this.parseColor(o)}catch{console.warn("Unable to parse color: "+o)}}return n}_fromJSONInternal(e){this._indexedColors=this._fromJSONIndexedColors(e.indexedColors);const t=e.named;for(let l=0;t&&l<t.length;l++)this._setCustomCellStyleInternal(e.named[l]);let n=qs;if(this._defaultTableStyle=null,e.tables){e.tables.defaultTableStyle&&(n=e.tables.defaultTableStyle);const l=e.tables.styles,a=l?Object.keys(l):null,c=a?a.length:0;for(let u=0;u<c;u++){const d=a[u],h=l[d];this._setCustomTableStyleInternal(d,h)}}this._defaultTableStyle=this.getTableStyle(n);const r=e.mruColors,o=r?r.length:0,i=new Array(o);if(o>0)for(let l=0;l<o;l++){const a=r[l];try{i[l]=this.parseColor(a)}catch{console.warn("Unable to parse color: "+a)}}this._mruColors=i}};const yu="BinaryResource must have only one initial data value.",bu="Resource is closed.";class Cu{constructor(e){if(this._listeners=new Set,this._type=e.type,this._name=e?.name,e.base64){const t=e.base64;this._asArrayBufferResolve=async()=>{const n=await Promise.resolve(t);return Promise.resolve(li.base64ToArrayBuffer(n))}}if(e.fetch){if(this._asArrayBufferResolve)throw new Error(yu);const t=e.fetch;this._asArrayBufferResolve=async()=>{let n,r=null;r=typeof t=="string"?t:e.input;const o=await fetch(r,n),i=o.headers.get("Content-Type");return!this._type&&i&&(this._type=i),o.arrayBuffer()}}if(e.buffer){if(this._asArrayBufferResolve)throw new Error(yu);this._asArrayBufferResolve=async()=>{let t=null;return t=typeof e.buffer=="function"?await e.buffer():e.buffer,Promise.resolve(t)}}if(e.file){if(this._asArrayBufferResolve)throw new Error(yu);this._asArrayBufferResolve=async()=>await(await Promise.resolve(e.file)).arrayBuffer()}if(!this._asArrayBufferResolve)throw new Error("BinaryResource must have an initial data value.");this._refs=new Set,this._isClosed=!1}getName(){return this._name}async toJSONAsync(){const e=await this.toBuffer(),t={base64:li.arrayBufferToBase64(e)};return this._type!==li.DEFAULT_MIME_TYPE&&(t.type=this._type),this._name&&(t.name=this._name),t}async toBuffer(){if(this._asArrayBuffer)return this._asArrayBuffer;try{this._asArrayBuffer=this._asArrayBufferResolve()}catch(e){throw e}return this._asArrayBuffer}async getType(){return this._type?this._type:(await this.toBuffer(),this._type??li.DEFAULT_MIME_TYPE)}addReference(e){if(this._isClosed)throw new Error(bu);this._refs.add(e)}deleteReference(e){if(this._isClosed)throw new Error(bu);if(this._refs.size===0||!this._refs.has(e))return;this._refs.delete(e);const t=this;if(this._refs.size===0){const n=this._listeners;n.forEach(r=>{r.onUnload?.(t),n.delete(r)}),this._asArrayBuffer=null,this._isClosed=!0}}addUnloadListener(e){if(this._isClosed)throw new Error(bu);this._listeners.add(e)}get isIResource(){return!0}isClosed(){return this._isClosed}}let mv=class{constructor(s,e,t){this._state=s,this._fromJSON=e,this._onLastEnd=t,this._state.openScopes.add(this),this._isClosed=!1}endPersist(){if(!this._state.openScopes.delete(this))throw new Error("PersistScope is closed.");this._isClosed=!0,this._state.openScopes.size===0&&this._onLastEnd()}toResourceId(s){if(this._isClosed)throw new Error("PersistScope is closed.");let e=this._state.byRefs.get(s);return e!==void 0||(e=this._state.byRefs.size,this._state.byRefs.set(s,e),this._state.byIds.set(e,s)),e}fromResourceId(s){return this._state.byIds.get(s)??null}fromJSON(s){if(this._isClosed)throw new Error("PersistScope is closed.");if(!s||s.length===0)return;const e=this._state.byRefs.size;for(let t=0;t<s.length;t++){const n=s[t],r=this._fromJSON(n);this._state.byRefs.set(r,e+t),this._state.byIds.set(e+t,r)}}toJSONAsync(){if(this._isClosed)throw new Error("PersistScope is closed.");const s=[];return this._state.byRefs.forEach((e,t)=>{s[e]=Promise.resolve(t.toJSONAsync())}),Promise.all(s)}};class OS{constructor(){this._resources=new Set}add(e){if(typeof e=="string"){let r=!1;this._resources.forEach(o=>{o.getName()===e&&(r=!0,e=o)}),r||(e=new Cu({name:e,fetch:e,type:null}))}let t=null;t=e instanceof Cu?e:new Cu({...e});const n=this;return this._resources.has(t)||(t.addUnloadListener({onUnload:r=>{n._resources.delete(t)}}),this._resources.add(t)),t}getItems(e){return Array.from(this._resources)}getCount(){return this._resources.size}beginPersist(){this._persistOpen||(this._persistOpen={byRefs:new Map,byIds:new Map,openScopes:new Set});const e={},t=new Set,n=this;return new mv(this._persistOpen,r=>{const o=n.add({base64:r.base64,name:r.name,type:r.type});return o.addReference(e),t.add(o),o},()=>{t.forEach(r=>{r.deleteReference(e)}),n._persistOpen=null})}}class pv{constructor(e,t,n){this._state=e,this._fromJSON=t,this._onLastEnd=n,this._state.openScopes.add(this),this._isClosed=!1}endPersist(){if(!this._state.openScopes.delete(this))throw new Error("PersistScope is closed.");this._isClosed=!0,this._state.openScopes.size===0&&this._onLastEnd()}add(e){if(this._isClosed)throw new Error("PersistScope is closed.");let t=this._state.byRefs.get(e);return t!==void 0||(t=this._state.byRefs.size,this._state.byRefs.set(e,t),this._state.byIds.set(t,e)),t}at(e){return this._state.byIds.get(e)??null}fromJSON(e){if(this._isClosed)throw new Error("PersistScope is closed.");e&&e.length!==0&&this._fromJSON(e)}toJSONAsync(){if(this._isClosed)throw new Error("PersistScope is closed.");const e=[];return this._state.byRefs.forEach((t,n)=>{e[t]=Promise.resolve(n.toJSONAsync?n.toJSONAsync():n)}),Promise.all(e)}}let ah=class{constructor(){this._nextId=0,this._lastReadId=-1,this._lastReadValue=null,this._stringsByText=new Map,this._stringsById=new Map}addMultiple(e,t=!1){const n=this._stringsByText,r=this._stringsById,o=e.length;let i=this._nextId;for(let l=0;l<o;l++){const a=e[l];n.get(a)!==void 0&&t||(n.set(a,i),r.set(i,a),i++)}this._lastReadId=-1,this._nextId=i}add(e){const t=this._stringsByText,n=t.get(e);if(n!==void 0)return n;const r=this._nextId++;return t.set(e,r),this._stringsById.set(r,e),this._lastReadId=-1,r}getItems(e){if(e?.id!==void 0){const t=this.getById(e.id);return t?[t]:[]}return Array.from(this._stringsById.values())}getById(e){if(this._lastReadId===e)return this._lastReadValue;const t=this._stringsById.get(e)??null;return this._lastReadId=e,this._lastReadValue=t,t}getCount(){return this._stringsById.size}beginPersist(){this._persistOpen||(this._persistOpen={byRefs:new Map,byIds:new Map,openScopes:new Set});const e=this;return new pv(this._persistOpen,t=>(Array.isArray(t)?e.addMultiple(t):e.add(t),t),()=>{e._persistOpen=null})}};var Kt;class Sv extends Fo{constructor(e){super(e),e.json&&(this._resource=e.fromResourceId(e.json.resId))}getType(){return"picture"}toJSON(e){const t={},n=e?.(this._resource);n!==null&&(t.resId=n);const r=this._getState();return r&&r.effects&&(t.effects=r.effects),t}getTypeDescription(){return"Picture"}async _asDataUrl(){if(this._dataUrl)return this._dataUrl;const e=await this.getDetails(),t=await $l.getImageDataUrl(e.asUrl());return this._dataUrl=t.dataUrl,this._dataUrl}toHtml(){return null}async toImage(){const e=(await this._asDataUrl()).substring($l.DATA_URL_PNG_PREFIX.length),t=li.base64ToArrayBuffer(e);return new Blob([t],{type:Ap.png})}async getDetails(){return this._details||(this._details=new Promise(async(e,t)=>{try{const n=await this._resource.toBuffer(),r=await this._resource.getType(),o=await $l.loadImageDetails(n,r);e({getNaturalSize:()=>o.naturalSize,asUrl:()=>o.asUrl,asSVGText:()=>o.asSVGText})}catch(n){t(n)}})),this._details}_fromDrawingJSON(e,t){this._resource?.deleteReference(this),this._resource=t?.(e.resId),this._resource.addReference(this)}_toDrawingJSON(e){const t={},n=e?.(this._resource);return n!==null&&(t.resId=n),t}_processDelete(){super._processDelete()}}(Kt||(Kt={})).Status={Ready:"ready",Error:"error",Starting:"starting",Stopping:"stopping",Off:"off"};let Id=class DS extends Sn{constructor(e,t=null,n,r,o){if(super(e,n,t),this._sheetName=r||null,this._getEntireCoords=o??md,this._coords=wv(n,this._getEntireCoords()),!n)throw new Error("ReferenceRange requires a coords");this._validateCoords(n)}toType(e){return new DS(this._values,e,this._coords,this._sheetName,this._getEntireCoords)}getCoords(){return this._coords}get isIReferenceRange(){return!0}isLiteral(){return!1}_validateCoords(e){const t=this._getEntireCoords?.();if(t&&(e.rowStart<t.rowStart&&e.rowStart!==Number.MIN_SAFE_INTEGER||e.rowEnd>t.rowEnd&&e.rowEnd!==Number.MAX_SAFE_INTEGER||e.colStart<t.colStart&&e.colStart!==Number.MIN_SAFE_INTEGER||e.colEnd>t.colEnd&&e.colEnd!==Number.MAX_SAFE_INTEGER))throw new Tt}get[Symbol.toStringTag](){return"[ReferenceRange]"}toString(){return`${Pr(this._coords,this._getEntireCoords?.())}`}};const wv=(s,e)=>{let t=s.rowStart,n=s.rowEnd,r=s.colStart,o=s.colEnd,i=!1;return r===Number.MIN_SAFE_INTEGER&&(r=e.colStart,i=!0),t===Number.MIN_SAFE_INTEGER&&(t=e.rowStart,i=!0),n===Number.MAX_SAFE_INTEGER&&(n=e.rowEnd,i=!0),o===Number.MAX_SAFE_INTEGER&&(o=e.colEnd,i=!0),i?{rowStart:t,rowEnd:n,colStart:r,colEnd:o}:s},lm=(s,e)=>s.value?.once===e.value?.once,_v=(s,e)=>s.colStart===e.colStart&&s.rowStart===e.rowStart,LS=(s,e,t)=>!!t&&s===t.rowStart&&e===t.colStart,yv=(s,e=0,t=0)=>{const n=s._values,r=s._coords,o=n.getRuns({bounds:r}),i=n.getOrientation()!==B.Orientation.Row,l=i?r.colStart:r.rowStart,a=i?r.rowStart:r.colStart,c=new Mt.Builder(null,e,t);let u=o.next();for(;!u.done;){const d=u.value;c.addValues(d[0]-l,d[1]-a,d[2]),u=o.next()}return c.build()},pa=(s,e,t,n,r,o,i,l,a,c,u,d,h=!1)=>{let f,g,m=null,p=r.size();d===void 0&&(d=o.getOrientation()===B.Orientation.Column);const S=e?e.length:0,w=t?t.length:0;let b;const C=S+w;for(let y=0;y<C&&p>0;y++){const v=y<S?e[y]:t[y-S],x=r.search(v),E=x.length;for(let R=0;R<E;R++){const I=x[R];if(!LS(I.rowStart,I.colStart,v)){if(I.value.getError())continue;b||(b=[]),b.push(I)}r.remove(I,_v);const A=I.value;A.getCycleId()!==s&&a?.insert(I),A.getError()||(o.delete(I),n.insertNonOverlapping({colStart:I.colStart,rowStart:I.rowStart,colEnd:I.colEnd,rowEnd:I.rowEnd,value:null},{onIntersect:(T,O)=>{if(T.value!==null)return i?.push(T),m=q.unionRanges(m,T),l?.insertNonOverlapping(T),m=q.unionRanges(m,T),O}})),p--}}for(let y=0;y<S;y++){const v=e[y],x={colStart:v.colStart,rowStart:v.rowStart,colEnd:v.colEnd,rowEnd:v.rowEnd,value:null};n.insertNonOverlapping(x,{onIntersect:(E,R)=>{if(E.value===null)return;const I=q.sanitizeRange(R);return h&&l?.insertNonOverlapping(I),c?.insertNonOverlapping({...R,value:!1}),i?.push(I),m=q.unionRanges(m,I),R}}),u?.insertNonOverlapping(x,{onIntersect:(E,R)=>{if(E.value!==null)return i?.push(R),m=q.unionRanges(m,R),R},onUpdates:(E,R,I)=>{g||(g=[]);const A=E.length;for(let O=0;O<A;O++){const N=E[O];g.push(N)}f||(f=[]);const T=R.length;for(let O=0;O<T;O++){const N=R[O],D=q.sanitizeRange(N);f.push(D)}}})}const _=d?B.Orientation.Column:B.Orientation.Row;if(b){const y=b.length,v=new Array(y);for(let x=0;x<y;x++){const E=b[x],R=E.value.setError(!0,s);a?.insert(R),v[x]=R,m=q.unionRanges(m,E);const I={colStart:E.colStart,rowStart:E.rowStart,colEnd:E.colStart,rowEnd:E.rowStart};n.insertNonOverlapping({colStart:E.colStart,rowStart:E.rowStart,colEnd:E.colStart,rowEnd:E.rowStart,value:new vs(E,_)}),i?.push(I)}r.load(v)}for(let y=0;y<w;y++){const v=q.sanitizeRange(t[y]);n.insertNonOverlapping({colStart:v.colStart,rowStart:v.rowStart,colEnd:v.colEnd,rowEnd:v.rowEnd,value:new vs(v,_)}),h&&l?.insertNonOverlapping(v),i?.push(v),m=q.unionRanges(m,v)}return m},Ad=(s,e,t)=>{if(!e)return s;const n=e.block;if(!n)return s;const r=s??[],o=e.colIndex,i=e.rowIndex;let l,a,c,u;t?(l=t.colStart,a=t.rowStart,c=t.colEnd,u=t.rowEnd):(l=o,a=i,c=o,u=i);const d={colStart:l,rowStart:a,colEnd:c,rowEnd:u,value:{blockEntry:{colStart:l,rowStart:a,colEnd:c,rowEnd:u,value:n},width:1,height:1,index:-1,$absWidth:!1,$absHeight:!1,once:e}};let h=e.dynamic;return h||(h=[],e.dynamic=h),h.push(d),r.push(d),r};class ch{constructor(e){this._fullCalcRequired=!1,this._iterationId=0,this._uuid=P.uuidV4(),this._cycleId=1,this._pendingInvalidations=new Set,this._emitter=null,this._isProcessingJSON=!1,this._collectDirties=(o,i=!1,l,a)=>{const c=this._formulaSpatial,u=this._precedentSpatial;let d=xv,h=0;if(i){const f=c.all();for(let g=0;g<f.length;g++){const m=f[g].value.calcs,p=m.length;for(let S=0;S<p;S++){const w=m[S],b=w.length;for(let C=0;C<b;C++){const _=w[C];_.markId!==o&&(d[h++]=_,_.markId=o,_.pending=!1,_.pendingResolved=!1,_.pendingPromise&&(_.pendingPromise.cancelled=!0))}}}}else{const f=l.length;for(let g=0;g<f;g++){const m=l[g];dm.length=0;const p=dm;u.search(m,!1,p),c.search(m,!1,p);const S=p.length;if(S===0)continue;const w=m.colStart,b=m.rowStart,C=m.colEnd-w,_=m.rowEnd-b;for(let y=0;y<S;y++){const v=p[y],x=v.value,E=x.blockEntry?.value??x,R=E.ref,I=R.colEnd-R.colStart,A=R.rowEnd-R.rowStart,T=v.colEnd-v.colStart-I,O=v.rowEnd-v.rowStart-A,N=x.once;if(N)N.markId<=o&&(N.removed?(u.remove(v,lm),N.removed=!1):d[h++]=N,N.markId=o);else{let D=0,F=0,k=I,L=A;if(!x.$absHeight){const $=b-v.rowStart;F=Math.min(Math.max($-O,0),A),L=Math.min(_+b,A)}if(!x.$absWidth){const $=w-v.colStart;D=Math.min(Math.max($-T,0),I),k=Math.min(C+$,I)}const W=E.calcs;for(let $=F;$<=L;$++){const J=W[$];for(let te=D;te<=k;te++){const Q=J[te];Q.markId!==o&&(d[h++]=Q,Q.markId=o,Q.pendingPromise&&(Q.pendingPromise.cancelled=!0))}}}}}a&&a.forEach(g=>{if(Array.isArray(g)){const m=g.length;for(let p=0;p<m;p++){const S=g[p],w=S.length;for(let b=0;b<w;b++){const C=S[b];C.markId===o||C.removed||(d[h++]=C,C.markId=o,C.pendingPromise&&(C.pendingPromise.cancelled=!0))}}}else g.markId===o||g.removed||(d[h++]=g,g.markId=o,g.pendingPromise&&(g.pendingPromise.cancelled=!0))})}return d.length=h,d};const t=(e={strings:new ah,...e}).getEntireCoords??md;if(this._getEntireCoords=t,this._options=e,this._strings=e.strings,this._onCalculated=e?.onCalculated??(()=>{}),this._cycleId=1,this._values=new Io({orientation:B.Orientation.Column}),this._getFormulaParser=e.getFormulaParser,!this._getFormulaParser)throw new Error("Formula parser is not defined");this._latest={graph:this},this._iterationId=0;const n=this;this._formulaSpatial=new yt({updateEntryOptions:{isMergeOnShift:!0,isSplitOnExpand:!0,onUpdates:(o,i,l)=>{const a=l._cloneKey??n;if(a._isProcessingJSON)return;let c=a._notifyFormulaInsertEntries,u=a._notifyFormulaRemoveEntries;const d=a._precedentSpatial,h=i?i.length:0;if(h>0){let g=u?u.length:0;u?u.length=g+h:(u=new Array(h),a._notifyFormulaRemoveEntries=u);for(let m=0;m<h;m++){const p=i[m],S=p.value,w=S.ref;u[g+m]=w;const b=w.rowStart,C=w.colStart,_=S.formula.getDirectPrecedentsAt(b,C);if(!_)continue;const y=_.length;for(let v=0;v<y;v++){const x=_[v];if(x===null||x instanceof $e.Known)continue;const E=d.search(x),R=E.length;for(let I=0;I<R;I++){const A=E[I];A.value.blockEntry.value===p.value&&d.remove(A)}}}}const f=o?o.length:0;if(f>0){const g=[];for(let m=0;m<f;m++){const p=o[m],S=p.colEnd-p.colStart,w=p.rowEnd-p.rowStart,b=p.value,C=b.formula,_=b.ref,y=_.rowStart,v=_.colStart,x=[],E=C.getDirectPrecedentsAt(y,v,!0,Cl,vl),R=E.length;for(let I=0;I<R;I++){const A=E[I];if(A instanceof $e.Known)continue;const T=Cl[I],O=vl[I],N={colStart:A.colStart,rowStart:A.rowStart,colEnd:A.colEnd+(O?0:S),rowEnd:A.rowEnd+(T?0:w),value:{blockEntry:p,width:S+1,height:w+1,index:I,$absWidth:O,$absHeight:T,once:null}};x.push(A),g.push(N)}c||(c=[],a._notifyFormulaInsertEntries=c),c.push({colStart:p.colStart,rowStart:p.rowStart,colEnd:p.colEnd,rowEnd:p.rowEnd,value:{tokens:C.getTokens(),references:C.getReferences(),precedents:x}})}d.load(g)}}}}),this._contentfulSpatial=new yt({updateEntryOptions:{isSplitOnExpand:!0,isMergeOnShift:!0}});const r={updateEntryOptions:{isSplitOnExpand:!0,isMergeOnShift:!1}};this._precedentSpatial=new yt(r),this._volatile=new Set,this._spillSpatial=new yt(r),this._errorSpatial=new yt(r),this._pendingSpatial=new yt(r),this._invalidations=new yt,this._notifyValues=new yt,this._notifySpills=new yt,this._notifyFormats=new yt,this._notifyPending=new yt,this._calculation=e.calculation,this._clearScope()}addListeners(e,t){return this._emitter||(this._emitter=new gn(this)),this._emitter.addListeners(e,t)}shift(e){const t=e.cloneIfUpdate??!0?this.clone(this):this,n={...e};delete n.cloneIfUpdate,delete n.onShift,t._values.shift(n.range,n.direction);const r=t._contentfulSpatial;t._contentfulSpatial=r.shift(n);const o=t._spillSpatial;t._spillSpatial=o.shift(n);const i=t._formulaSpatial;if(i.isEmpty())return t;const l=e.range,a=e.direction,c=a===B.Direction.Left||a===B.Direction.Right;a!==B.Direction.Up&&B.Direction.Left,c?(l.colEnd,l.colStart):(l.rowEnd,l.rowStart),t._notifyFormulaInsertEntries,t._notifyFormulaRemoveEntries;const u=t._getEntireCoords(),d=new Map;this._precedentSpatial.visitRanges({...l,colEnd:c?u.colEnd:l.colEnd,rowEnd:c?l.rowEnd:u.rowEnd},S=>{let w=S.value;if(S.value.once)return;let b=w.blockEntry,C=d.get(b);C||(C={rows:[],cols:[],index:[]},d.set(b,C)),C.index.push(w.index)});const h=[],f=[],g=d.entries();let m=g.next();const p=(S,w,b,C)=>{let _=S.value;const y=_.formula.getReferences(),v=w.length;for(let x=0;x<v;x++){const E=y[x];E!==null&&(E instanceof $e.Known||typeof E!="string"&&E[x])}return S.value=_,S};for(;!m.done;){const[S,w]=m.value,b=S.value,C=w.rows.sort(),_=C.length,y=w.cols.sort().length,v=w.index.sort();if(f.push(S),_===0&&y===0){const E={...S};p(E,v),h.push(E),m=g.next();continue}let x=0;for(let E=0;E<_;E++){const R=C[E];if(R===x)continue;Au[0]={colStart:b.ref.colStart,rowStart:x,colEnd:b.ref.colEnd,rowEnd:R-1,value:b},Au[1]={colStart:b.ref.colStart,rowStart:R,colEnd:b.ref.colStart,rowEnd:b.ref.rowEnd,value:b};const I=Iv(b,Au,B.Orientation.Row,R);let A=I[0];p(A,v),h.push(A),A=I[1],p(A,v),h.push(A),x=R}m=g.next()}return i._updateNodes(h,f),t._fullCalcRequired=!0,this._invalidate(h),t}clone(e){if(e!==void 0&&this._cloneKey===e)return this;const t=new ch(this._options);t._cloneKey=e,t._uuid=this._uuid,this._calculation._getAllGraphs().set(this._uuid,this._latest.graph),t._values=this._values.clone(t),t._contentfulSpatial=this._contentfulSpatial.clone(t),t._formulaSpatial=this._formulaSpatial.clone(t),t._precedentSpatial=this._precedentSpatial.clone(t),t._volatile=new Set(this._volatile),t._spillSpatial=this._spillSpatial.clone(t),t._errorSpatial=this._errorSpatial.clone(t),t._pendingSpatial=this._pendingSpatial.clone(t),t._invalidations=this._invalidations.clone(t),t._notifyValues=this._notifyValues.clone(t),t._notifySpills=this._notifySpills.clone(t),t._notifyFormats=this._notifyFormats.clone(t),t._notifyPending=this._notifyPending.clone(t);const n=this._notifyFormulaInsertEntries;n&&(t._notifyFormulaInsertEntries=[...n]);const r=this._notifyFormulaRemoveEntries;r&&(t._notifyFormulaRemoveEntries=[...r]);const o=this._pendingActions;return o&&(t._pendingActions=[...o]),t._cycleId=this._cycleId,t._emitter=this._emitter,t._fullCalcRequired=this._fullCalcRequired,this._latest.graph=t,t._iterationId=this._iterationId+1,t}invalidate(e){const t=this._invalidations;if(Array.isArray(e)){const n=e.length;for(let r=0;r<n;r++){let o=e[r];typeof o=="string"&&(o=Ln(o)),t.insertNonOverlapping(o)}}else{let n=e;typeof n=="string"&&(n=Ln(n)),t.insertNonOverlapping(n)}}setFormulaAt(e,t){let n,r=null;return typeof e=="string"?n=Ln(e,Nt):(Nt.colStart=e.colIndex,Nt.rowStart=e.rowIndex,Nt.colEnd=e.colIndex,Nt.rowEnd=e.rowIndex,n=Nt),t?r=this._setInputs(null,[{colStart:n.colStart,rowStart:n.rowStart,colEnd:n.colEnd,rowEnd:n.rowEnd,value:t}]):this.delete(n),r}getFormulaAt(e,t){let n;typeof e=="string"&&(n=Ln(e,Nt));const r=this._formulaSpatial.search(n);if(r.length===0)return null;const o=r[0].value;return o.formula?o.formula.getTextAt(n.rowStart,n.colStart,t):void 0}_formulaAt(e,t){Ys.colStart=t,Ys.rowStart=e,Ys.colEnd=t,Ys.rowEnd=e;const n=this._formulaSpatial.search(Ys);if(n.length===0)throw new Error(`No formula found at ${Gi({rowIndex:e,colIndex:t})}`);return n[0]}getDirectPrecedentsAt(e,t,n){return this._formulaAt(e,t).value.formula.getDirectPrecedentsAt(e,t,n)}getReferencesAt(e,t){return this._formulaAt(e,t).value.formula.getReferences()}setReferenceAt(e,t,n,r){const o=this._formulaAt(e,t).value.formula.setReferenceAt(n,r).getTextAt(e,t);return this.setFormulaAt({rowIndex:e,colIndex:t},o),this}evaluateAt(e,t,n){const r=this._formulaAt(e,t),o=r.value,i=o.ref,l=i.colStart-t,a=i.rowStart-e,c=this._calculation._getContext(),u=this._calculation._getScope();return u.sheetName=this._options.getSheetName?.(),u.rowIndex=e,u.colIndex=t,u.node=o.calcs[a][l],r.value.formula.evaluate(c,n)}setInputAt(e,t){let n=null;const r=typeof e=="string"?is(e,Cv):e;if(t!==null){const o=new Mt.Builder,i=this._values.getOrientation()===B.Orientation.Column,l=i?r.colIndex:r.rowIndex,a=i?r.rowIndex:r.colIndex;o.addValue(l,a,t),n=this.setInputs(o.build(),null)}else this.delete(q.cellToRange(r,Nt));return n}setInputs(e,t){return this._setInputs(e,t)}delete(e){return typeof e=="string"&&(e=Jn(e)),this._setInputs(null,[{...e,value:null}],e).removes}_createCopySpillEntries(e,t,n,r,o){const i=r??[],l=o??[],a=t.colStart,c=t.rowStart,u=t.colEnd,d=t.rowEnd,h=n.colStart,f=n.rowStart,g=e.search(t),m=g.length;for(let p=0;p<m;p++){const S=g[p];l&&l.push(S);const w=S.rowStart,b=S.colStart;if(w<c||w>d||b<a||b>u||S.value.getError())continue;const C=h+(S.colEnd-b),_=f+(S.rowEnd-w),y={colStart:h,rowStart:f,colEnd:C,rowEnd:_};i.push({colStart:h,rowStart:f,colEnd:C,rowEnd:_,value:new ua(y,0,!1)})}return{removes:l,inserts:i}}_copyCalcs(e,t,n){const r=e._formulaSpatial;if(r.isEmpty())return;const o=this._getEntireCoords(),i=o.colStart,l=o.rowStart,a=o.colEnd,c=o.rowEnd,u=r.createCopiedEntries(t,n),d=u.inserts;let h=d.length,f=0;const g=e._spillSpatial;let m=[];for(;f<h;){let p=d[f],S=p.value,w=S.ref,b=w.colStart,C=w.rowStart,_=w.colEnd,y=w.rowEnd;this._createCopySpillEntries(g,t,w,m,null);let v=S.formula.getReferences();const x=v.length;for(let E=0;E<x;E++){const R=v[E];if(!R||R.isFormulaError||typeof R=="string")continue;const I=R,A=I.colStart,T=I.rowStart,O=I.colEnd,N=I.rowEnd;let D=I.$colStart?A:A+b,F=I.$rowStart?T:T+C,k=I.$colEnd?O:O+_,L=I.$rowEnd?N:N+y;if(A===Number.MIN_SAFE_INTEGER&&(D=i,k=a),T===Number.MIN_SAFE_INTEGER&&(F=l,L=c),D<i||k>a||F<l||L>c){const W=i-D,$=l-F,J=a-k,te=c-L;Qs.colStart=Math.max(b,b+W),Qs.rowStart=Math.max(C,C+$),Qs.colEnd=Math.min(_,_+J),Qs.rowEnd=Math.min(y,y+te);const Q=Cs(p,Qs,ta);if(Q){const G=Q.length;p=Q[G-1],S=p.value,w=S.ref,b=w.colStart,C=w.rowStart,_=w.colEnd,y=w.rowEnd;for(let ee=0;ee<G-1;ee++){const ne=Q[ee];d.push(ne),h++}}else S=S.setReferenceAt(E,null),p.value=S,v=S.formula.getReferences()}}d[f++]=p}this._formulaSpatial._updateNodes(d,u.removes),r._mergeNodes({colStart:n.colStart-1,rowStart:n.rowStart-1,colEnd:n.colEnd+1,rowEnd:n.rowEnd+1}),m&&this._spillSpatial._updateNodes(m,[]),this._fullCalcRequired=!0,this._invalidate(d),this._invalidate(u.removes)}_moveCalcs(e,t,n){const r=e._formulaSpatial.createCopiedEntries(t,n);console.log("_moveCalcs",r,"from:",t,"to:",n);const o=this._formulaSpatial,i=(f,g,m,p)=>{let S=f.value;const w=S.formula.getReferences(),b=w.length,C=g.colStart-m.colStart,_=g.rowStart-m.rowStart,y=S.ref,v=m.colStart-y.colStart,x=m.colEnd-y.colEnd,E=m.rowStart-y.rowStart,R=m.rowEnd-y.rowEnd;for(let I=0;I<b;I++){const A=w[I];if(!A||A.isFormulaError||typeof A=="string")continue;const T=A,O=T.colStart,N=T.rowStart,D=T.colEnd,F=T.rowEnd;let k=C,L=_;const W=v<=O&&x>=D||O==Number.MIN_SAFE_INTEGER,$=E<=N&&R>=F||N==Number.MIN_SAFE_INTEGER;let J=!$;T.$colStart||k===0||O===Number.MIN_SAFE_INTEGER?J=!1:J||(J=O<v||O>x,J||!T.$colEnd||T.$colStart||(J=!0));let te=!W;T.$rowStart||L===0||N===Number.MIN_SAFE_INTEGER?te=!1:te||(te=N<E||N>R,J||!T.$rowEnd||T.$rowStart||(te=!0));let Q=!$;T.$colEnd||k===0||N===Number.MIN_SAFE_INTEGER?Q=!1:Q||(Q=D<v||D>x,J||!T.$colStart||T.$colEnd||(Q=!0));let G=!W;if(T.$rowEnd||L===0||N===Number.MIN_SAFE_INTEGER?G=!1:G||(G=F<E||F>R,G||!T.$rowEnd||T.$rowStart||(G=!0)),!(J||Q||te||G))continue;const ee={...T};J&&(ee.colStart+=k),te&&(ee.rowStart+=L),Q&&(ee.colEnd+=k),G&&(ee.rowEnd+=L),S=S.setReferenceAt(I,ee)}return f.value=S,f},l=e._spillSpatial;let a=[],c=[];const u=r.inserts,d=u.length;for(let f=0;f<d;f++){const g=u[f];this._createCopySpillEntries(l,t,g,a,c),u[f]=i(g,t,n)}o._updateNodes(r.inserts,[]),e._formulaSpatial._updateNodes([],r.removes);const h=[];a.length>0&&(this._spillSpatial._updateNodes(a,[]),e._spillSpatial._updateNodes([],c),pa(this._cycleId,c,P.EmptyArray,e._contentfulSpatial,l,e._values,h,e._notifyValues,e._notifySpills,e._notifyPending,e._errorSpatial,e._values.getOrientation()!==B.Orientation.Row,!1)),this._fullCalcRequired=!0,this._invalidate(r.inserts),e._invalidate(h),e._invalidate(r.removes)}getSnapshot(e){const t=this,n=Object.freeze({...e});let r=n.range;return typeof r=="string"&&(r=Ln(r)),{async copyTo(o,i){const l=o.calcGraph;let a=o.range;typeof a=="string"&&(a=Ln(a));const c=fd(a,r,i?.fitDestination,i?.transpose);return{...n,...i}.isCut?l._moveCalcs(t,r,c):l._copyCalcs(t,r,c),a},getCoords:()=>r,getSource:()=>t,getName:()=>"Calculation",getMarkOptions:()=>n,isISnapshot:!0}}autoFill(e,t){return typeof e=="string"&&(e=Ln(e)),typeof t=="string"&&(t=Ln(t)),this._copyCalcs(this,e,t),this}_scheduleRecalculation(e){const t=this._pendingInvalidations;if(e)if(Array.isArray(e)){const r=e.length;for(let o=0;o<r;o++)t.add(e[o])}else t.add(e);const n=this;P.debounce(()=>{const r=n._latest.graph,o=r._volatile,i=r._cycleId;t.forEach(l=>{l.cycleId>i||o.add(l)}),t.clear(),r.calculate()},100)()}_notifyCalculated(e){const t=this,n=t._notifyValues,r=n.all();return new Promise(o=>{P.nextTick(()=>{const i=t._cycleId;let l,a=t._fullCalcRequired;a||(typeof e=="boolean"?a=e:e&&(l=e,a=l.full??!1));const c={};let u=null;const d=r.length;if(d>0){n.clear();let b=r,C=null;for(let I=0;I<d;I++){const A=r[I],T=A.colStart,O=A.colEnd;if(T!==O){C||(C=[]);for(let N=T+1;N<=O;N++)C.push({colStart:N,rowStart:A.rowStart,colEnd:N,rowEnd:A.rowEnd});A.colEnd=T}}C&&(b=r.concat(C)),b.sort(q.columnFirstRangeComparator);const _=new Mt.Builder(I=>new Qn(I));let y;const v=t._values,x=v.getOrientation()===B.Orientation.Column,E=b.length;for(let I=0;I<E;I++){const A=b[I];u=q.unionRanges(u,A,Nt);const T=v.getRuns({bounds:A});let O=T.next();const N=A.colStart,D=A.rowStart,F=A.colEnd,k=A.rowEnd,L=x?D:N,W=x?F:k,$=x?k:F;let J=x?N:D,te=L;for(;!O.done;){const Q=O.value,G=Q[0];for(;J<G;)y||(y=[]),y.push({colStart:x?J:te,rowStart:x?te:J,colEnd:x?J:$,rowEnd:x?$:J}),J++,te=L;const ee=Q[1],ne=Q[2],re=Math.max(ee,L),U=Math.min(ee+ne.length-1,$);_.addValues(G,re,ne),te<re&&(y||(y=[]),y.push({colStart:x?G:te,rowStart:x?te:G,colEnd:x?G:re-1,rowEnd:x?re-1:G})),te=U+1,U>=$?(J=G+1,te=L):J=G,O=T.next()}for(;J<=W;)te<=$&&(y||(y=[]),y.push({colStart:x?J:te,rowStart:x?te:J,colEnd:x?J:$,rowEnd:x?$:J})),J++,te=L}const R=_.build();R&&(c.valueInserts=R),y&&(c.valueRemoves=y)}const h=t._notifyPending,f=h.all();if(f.length>0){h.clear();const b=t._pendingSpatial;let C;const _=f.length;for(let y=0;y<_;y++){const v=f[y];b.insertNonOverlapping(v,{onIntersect:(x,E)=>(C||(C=[]),C.push({...E}),u=q.unionRanges(u,E),E.value===!1&&(E.value=null),E)})}C&&C.length>0&&(c.pendingUpdates=C,u=q.unionRangesArrays(C,u,Nt))}const g=t._notifySpills,m=g.all();if(m.length>0){g.clear();const b=t._spillSpatial;let C,_,y;const v=m.length;for(let x=0;x<v;x++){const E=m[x],R=E.value;if(R.getCycleId()!==i)C||(C=[]),C.push({colStart:E.colStart,rowStart:E.rowStart,colEnd:E.colEnd,rowEnd:E.rowEnd});else{const I=b.search(E),A=I.length;for(let T=0;T<A;T++){let O=I[T];if(LS(E.rowStart,E.colStart,O)&&R.getCycleId()===i){_||(_=[],y=new Set);const N=ar(O.colStart)+yr(O.rowStart);if(y.has(N))continue;y.add(N),_.push({colStart:E.colStart,rowStart:E.rowStart,colEnd:E.colEnd,rowEnd:E.rowEnd,value:O.value.getError()})}}}}_&&(c.spillInserts=_,u=q.unionRangesArrays(_,u,Nt)),C&&(c.spillRemoves=C,u=q.unionRangesArrays(C,u,Nt))}const p=t._notifyFormats.all();p.length>0&&(c.formatInserts=p,u=q.unionRangesArrays(p,u,Nt),t._notifyFormats.clear());const S=t._notifyFormulaInsertEntries;if(S){const b=t._formulaSpatial;for(let C=S.length-1;C>=0;C--){const _=S[C];b.search(_).length===0?S.splice(C,1):u=q.unionRanges(u,_,Nt)}c.formulaInserts=S,t._notifyFormulaInsertEntries=void 0}const w=t._notifyFormulaRemoveEntries;w&&(c.formulaRemoves=w,u=q.unionRangesArrays(w,u,Nt),t._notifyFormulaRemoveEntries=void 0),u&&(c.bounds=q.sanitizeRange(u)),Object.keys(c).length===0?c.cycleId=i-1:(c.cycleId=i,t._cycleId++),a&&(c.isFull=!0),t._fullCalcRequired=!1,t._options.onCalculated?.(c),this._calculation._getCalcingGraphs().delete(t._uuid),o(c)})})}_setInputs(e,t,n){const r=this._formulaSpatial;let o=!r.isEmpty();const i=t?t.length:0,l=this._calculation;if((i>0||o)&&l.getStatus()===Kt.Status.Starting)return this._addToPending(()=>{const R=this._setInputs(e,t,n),I={formulaInserts:R.inserts??P.EmptyArray,formulaRemoves:R.removes??P.EmptyArray,cycleId:this._cycleId,bounds:q.unionRanges(q.unionRangesArrays(R.inserts),q.unionRangesArrays(R.removes))};return Promise.resolve(I)}),Rv;const a=this._values.getOrientation()!==B.Orientation.Row,c=this._spillSpatial,u=this._errorSpatial,d=this._contentfulSpatial,h=[];let f,g,m=o?[]:null,p=this._values;if(e&&e.tuples){if(f=e.tuples,m){let R=e.bounds;if(o)if(R){const T=Di(R,a);h.push(T)}else{const T={colStart:Number.MIN_SAFE_INTEGER,rowStart:Number.MIN_SAFE_INTEGER,colEnd:Number.MAX_SAFE_INTEGER,rowEnd:Number.MAX_SAFE_INTEGER};h.push(T)}const I={majorStart:0,minorStart:0,majorEnd:0,minorEnd:0},A=f.length;for(let T=0;T<A;T++){const O=f[T],N=O[0];I.majorStart=N,I.majorEnd=N;const D=O[1],F=D.length;for(let k=0;k<F;k++){const L=D[k];I.minorStart=L[0];const W=L[1];I.minorEnd=I.minorStart+W.length-1;const $=Di(I,a);m&&r.search($).length>0&&m.push($)}}}g=yf(e.tuples,a)}(n||f)&&(pa(this._cycleId,n?[n]:P.EmptyArray,g,d,c,p,h,this._notifyValues,this._notifySpills,this._notifyPending,u,a,!1),n&&p.delete(n),f&&p.setValues(f));const S=l._getContext(),w=l._getScope();let b,C;const _=this._getFormulaParser(),y=(R,I)=>{const A=R.rowStart,T=R.colStart,O={...R,value:null};if(r.insertNonOverlapping(O,{noMerge:!0,onIntersect:(N,D)=>N.value===null?null:(C||(C=[]),C.push(N),D)}),I!==null){w.rowIndex=A,w.colIndex=T,w.sheetName=this._options.getSheetName?.();const N=_.parse(S,I),D=new kr(R,N),F={...R,value:D};b||(b=[]),b.push(F)}},v=m?m.length:0;for(let R=0;R<v;R++)y(m[R],null);for(let R=0;R<i;R++){const I=t[R],A=I.value;y(q.sanitizeRange(I),A)}const x=C?C.length:0,E=this._precedentSpatial;for(let R=0;R<x;R++){const I=C[R].value.calcs;if(I){const A=I.length;for(let T=0;T<A;T++){const O=I[T],N=O.length;for(let D=0;D<N;D++){const F=O[D],k=F.dynamic;if(k){const L=k.length;for(let W=0;W<L;W++){const $=k[W];E.remove($)}F.dynamic=null}}}}}return(b||C)&&(r._updateNodes(b,P.EmptyArray),pa(this._cycleId,C,b,d,c,p,h,this._notifyValues,this._notifySpills,this._notifyPending,u,a,!0)),(o||b||C)&&this._invalidate(h),{inserts:this._notifyFormulaInsertEntries??P.EmptyArray,removes:this._notifyFormulaRemoveEntries??P.EmptyArray}}_invalidate(e){if(!e||e.length==0)return;const t=this._invalidations,n=Sr(e,B.Orientation.Column,2);for(let r=0;r<n.length;r++)t.insertNonOverlapping(n[r]);this._calculation._getCalcingGraphs().set(this._uuid,this._latest.graph),this._emitter?.notify("onInvalidate")}_markAndPlan(e,t,n){let r;Xs=0,Iu=0,Rl=0,Zs=0;const o=this._precedentSpatial,i=this._formulaSpatial;Eu=0,El=0;const l=this._cycleId,a=t.length;for(let h=0;h<a;h++){const f=t[h];f.markId!==n&&(f.markId=n,f.cycleId=l,f.inDegree=0,vu[Xs++]=f,xu[El++]=f)}const c=(h,f,g)=>{(e||h.state===_d)&&(r||(r=[]),r.push(f),e||g(h))},u=h=>{h.markId!==n&&(h.markId=n,h.cycleId=l,h.inDegree=0,vu[Xs++]=h,xu[El++]=h)};for(;Eu<El;){const h=xu[Eu++],f=h.colIndex,g=h.rowIndex;Nt.colStart=f,Nt.rowStart=g,Nt.colEnd=f,Nt.rowEnd=g;const m=o.search(Nt),p=m.length;if(p===0)h.dependents=P.EmptyArray;else for(let S=0;S<p;S++){const w=m[S],b=w.value.once;b?c(b,w,u):cm(w,g,f,u)}}for(let h=0;h<Xs;h++){const f=vu[h],g=f.block,m=f.rowIndex,p=f.colIndex,S=g.formula.getDirectPrecedentsAt(m,p);let w=0;const b=f.precedents;for(let C=0;C<S.length;C++){const _=S[C];if(_.isFormulaError){b[C]=_;continue}{const A=_;A.calc=void 0,b[C]=A}const y=_.colStart,v=_.rowStart,x=_.colEnd,E=_.rowEnd,R=i.search(_),I=R.length;for(let A=0;A<I;A++){const T=R[A],O=T.colStart,N=T.rowStart,D=T.colEnd,F=T.rowEnd,k=Math.max(O,y),L=Math.max(N,v),W=Math.min(D,x),$=Math.min(F,E),J=T.value.calcs;for(let te=L;te<=$;te++){const Q=J[te-N];for(let G=k;G<=W;G++){const ee=Q[G-O];ee.markId===n&&(_.calc=ee,w++)}}}}f.inDegree=w,f.inDegree===0&&(Ru[Rl++]=f)}const d=h=>{h.markId===n&&(h.inDegree--,h.inDegree===0&&(Ru[Rl++]=h))};for(;Iu<Rl;){const h=Ru[Iu++];um[Zs++]=h;const f=h.colIndex,g=h.rowIndex;Nt.colStart=f,Nt.rowStart=g,Nt.colEnd=f,Nt.rowEnd=g;const m=o.search(Nt),p=m.length;for(let S=0;S<p;S++){const w=m[S],b=w.value.once;b?c(b,w,d):cm(w,g,f,d)}}return Zs<Xs?{completed:!1,onces:r}:{completed:!0,onces:r}}_evaluate(e){const t=this._calculation._getContext(),n=this._calculation._getScope();n.sheetName=this._options.getSheetName?.();let r=Ev;r.length=0;let o=0,i=!0;const l=this._cycleId,a=this._invalidations,c=this._contentfulSpatial,u=this._notifyValues,d=this._notifySpills,h=this._precedentSpatial,f=this._spillSpatial,g=this._values,m=g.getOrientation(),p=m===B.Orientation.Column;let S;n.spillSpatial=this._spillSpatial,n.values=g;const w=t.getEntireCoords.bind(t);let b;for(let C=0;C<Zs;C++){const _=um[C];if(_.state===bf&&l===_.cycleId){_.state=_d;continue}if(_.dynamic){for(let Z=0;Z<_.dynamic.length;Z++){const Y=_.dynamic[Z];h.remove(Y)}_.dynamic=null}const y=_.block,v=_.colIndex,x=_.rowIndex;let E=e?void 0:_.cachedValue,R=_.error;!R&&E&&E.isFormulaError&&(R=E);let I=!1;const A=_.precedents;if(A){const Z=A.length,Y=_.inputs;for(let we=0;we<Z;we++){const ge=A[we],de=ge.calc;if(de&&de.pending){I=!0;continue}if(ge.isFormulaError){Y[we]=ge;continue}const be=ge.colStart,he=ge.rowStart,fe=ge.colEnd;ge.rowEnd!==he||be!==fe?(o>0&&(r.length=o,am(r,g,u,p),o=0),Y[we]=new Id(g,null,{...ge},null,w)):Y[we]=de===void 0?ge:de.cachedValue}_.pendingPrecedents=I}const T=p?v:x,O=p?x:v;n.node=_,n.colIndex=v,n.rowIndex=x;const N=y.formula;let D,F;const k=_.pending;let L=k;if((I||_.pendingPromise)&&(L=!0,D=_.cachedValue??null,_.pendingPromise&&(_.pendingResolved?(_.pendingPromise=null,_.pendingResolved=!1,L=!1):(_.pendingPromise.cancelled=!0,D=void 0))),D===void 0&&(n.formula=N,n.colIndex=v,n.rowIndex=x,D=N.evaluate(t,void 0,_.inputs),n.formula=null,F=D&&D.then?D:null,L=!!F),L!==k&&(_.pending=L,S||(S=oo(p)),S.append(T,O,L)),F&&(D=_.cachedValue??null,!F.__originator)){F.__originator=l;const Z=_;xl.add(Z),Z.pendingPromise=F,Z.pendingResolved=!1,F.then(Y=>{if(xl.delete(Z),F.cancelled)return;Z.pendingPromise=F,Z.pendingResolved=!0;let we=Xa(Y,t);we===null&&(we=0),Z.cachedValue=we,this._scheduleRecalculation(Z)},Y=>{})}let W=1,$=1;const J=E instanceof Sn;let te;const Q=E instanceof $e.Spill;if(J||Q){Js.colStart=v,Js.rowStart=x,Js.colEnd=v,Js.rowEnd=x;const Z=f.search(Js);for(let Y=0;!te&&Y<Z.length;Y++){const we=Z[Y];we.colStart===v&&we.rowStart===x&&(te=we)}if(te){if(J){const we=E;W=we.getWidth(),$=we.getHeight()}const Y={colStart:v,rowStart:x,colEnd:v+W-1,rowEnd:x+$-1};f.remove(te),te&&te.value.getError()||(c.insertNonOverlapping({...Y,value:null}),g.delete(Y),u.insertNonOverlapping(Y))}}let G=1,ee=1;const ne=D,re=ne?.isIRange;let U,ue=D instanceof $e.Spill;if(re&&ne.size>1){G=ne.getWidth(),ee=ne.getHeight();const Z={colStart:v,rowStart:x,colEnd:v+G-1,rowEnd:x+ee-1},Y=t.getEntireCoords(),we=!q.isRangeWithinRange(Z,Y);if(we&&(Z.colEnd=Math.min(Z.colEnd,Y.colEnd),Z.rowEnd=Math.min(Z.rowEnd,Y.rowEnd)),ue=we,!ue){const be=c.search(Z);if(ue=be.length>1,!ue&&be.length===1){const he=be[0],fe=q.intersectRanges(Z,he,Nt);(fe&&(fe.rowEnd!==fe.rowStart||fe.colStart!==fe.colEnd)||fe.colStart!==v||fe.rowStart!==x)&&(ue=!0)}}let ge,de;if(ue)D=$e.BuiltIn.Spill,G=1,ee=1,ge=[[T,[[O,[D]]]]],g.setValues(ge),de={colStart:v,rowStart:x,colEnd:v,rowEnd:x};else{const be=yv(ne,T,O);be&&(ge=be.tuples),ge&&g.setValues(ge),de=Z}U={...Z,value:new ua(Z,l,ue)},f.insert(U),b=Ad(b,_,Z),u.insertNonOverlapping(de),a.insertNonOverlapping(de),c.insertNonOverlapping({...de,value:new vs(de,m)})}(!q.isEqualRanges(te,U)||ue||Q)&&(te&&d.insert(te),U&&d.insert(U)),G===W&&ee===$||(_.state=bf,a.insertNonOverlapping({colStart:v,rowStart:x,colEnd:v+Math.max(G,W)-1,rowEnd:x+Math.max(ee,$)-1}),i=!1);let oe=D&&D.isFormulaError?D:null;N.getError()&&(oe=N.getError()),(oe||R&&!e)&&(oe&&!oe.equals(R)||R&&R.equals(oe)),_.cachedValue=D,r[o++]=_}if(n.node=null,n.colIndex=Number.MAX_SAFE_INTEGER,n.rowIndex=Number.MAX_SAFE_INTEGER,S){const C=S.done(!0);this._notifyPending.load(C)}return o>0&&(r.length=o,am(r,g,u,p),o=0),{completed:i,dynamic:b,count:Zs}}async calculate(e){const t=this._calculation.getStatus();if(t===Kt.Status.Starting)return void this._addToPending(()=>this.calculate(e));if(t!==Kt.Status.Ready)return;let n=this._fullCalcRequired;n||(typeof e=="boolean"?n=e:e&&(n=e.full??!1));const r=this._invalidations;if(this._formulaSpatial.isEmpty()){if(r.clear(),xl.size>0){const u=++Ks;xl.forEach(d=>{d.markId=u})}return this._notifyCalculated(e)}let o=n;const i=this._volatile;let l=++Ks,a=this._collectDirties(l,o,r.all(),i);if(r.clear(),i.clear(),!o&&a.length===0)return this._notifyCalculated(e);o&&this._clearCalcs();const c=this._resetScope();for(;a.length>0;){l=++Ks;const u=this._markAndPlan(o,a,l).onces;if(u){const h=this._precedentSpatial,f=u.length;for(let g=0;g<f;g++)h.remove(u[g],lm)}a.length=0;const d=this._evaluate(o);if(d.dynamic&&this._precedentSpatial.load(d.dynamic),c.dynamicPrecedentsInserts&&(this._precedentSpatial.load(c.dynamicPrecedentsInserts),c.dynamicPrecedentsInserts=[]),c.conflatingFormats){const h=c.conflatingFormats.done(!0),f=this._notifyFormats;for(let g=0;g<h.length;g++){const m=h[g];f.insertNonOverlapping(m)}c.conflatingFormats=null}d.completed||(o=!1,l=++Ks,a=this._collectDirties(l,o,r.all(),i),r.clear())}return this._clearScope(),this._notifyCalculated(e)}_clearScope(){const e=this._calculation._getScope();e&&(e.rowIndex=0,e.colIndex=0,e.node=null,e.values=this._values,e.formulaSpatial=this._formulaSpatial,e.volatile=this._volatile,e.conflatingFormats=null,e.dynamicPrecedentsInserts=null,e.formula=null,e.getEntireCoords=md)}_resetScope(){const e=this._calculation._getScope();if(e)return e.rowIndex=0,e.colIndex=0,e.node=null,e.values=this._values,e.formulaSpatial=this._formulaSpatial,e.volatile=this._volatile,e.conflatingFormats=null,e.dynamicPrecedentsInserts=null,e.formula=null,e.getEntireCoords=this._getEntireCoords,e}_clearCalcs(){const e=this._values,t=this._spillSpatial,n=this._contentfulSpatial,r=t.all();for(let o=0;o<r.length;o++){const i=r[o];i.value.getError()||(e.delete(i),n.insertNonOverlapping({...i,value:null}))}t.clear(),this._errorSpatial.clear(),this._pendingSpatial.clear(),this._volatile.clear(),this._clearNotifications()}_clearNotifications(){this._invalidations.clear(),this._notifyValues.clear(),this._notifySpills.clear(),this._notifyFormats.clear(),this._notifyPending.clear()}_clearAll(){this._cycleId!==1&&this._cycleId++,Ks++,this._formulaSpatial.clear(),this._contentfulSpatial.clear(),this._pendingInvalidations.clear(),this._values.clear(),this._precedentSpatial.clear(),this._volatile.clear(),this._spillSpatial.clear(),this._errorSpatial.clear(),this._pendingSpatial.clear(),this._clearNotifications(),this._notifyFormulaInsertEntries=void 0,this._notifyFormulaRemoveEntries=void 0}_addToPending(e){this._calculation._getCalcingGraphs().set(this._uuid,this._latest.graph);let t=this._pendingActions;if(!t){this._pendingActions=t=[];const n=this;n._calculation.addListeners({onReady:()=>{(async()=>{const r=n._pendingActions,o=r.length;for(let i=0;i<o;i++){const l=r[i],a=await l.bind(n)();n._options.onCalculated?.(a)}this._pendingActions=null})()},onError:()=>{}},Av)}t.push(e)}fromJSON(e){const t=this._calculation.getStatus();if(t===Kt.Status.Starting)return void this._addToPending(()=>Promise.resolve(this.fromJSON(e)));if(t!==Kt.Status.Ready)return;this._clearAll();const n={cycleId:0,isFull:!0};if(!e)return n;this._isProcessingJSON=!0;try{if(e.data){const i=e.data;this._values.setValues(i);const l=this._values.getOrientation()===B.Orientation.Column,a=yf(i,l);this._contentfulSpatial.load(a)}const r=this._formulaSpatial,o=e.formulas;if(o){const i=e.dynamic,l=new Set;if(i){const S=i.length;for(let w=0;w<S;w++){const b=i[w],C=b[0].split(":")[0];l.add(C)}}const a=o.length,c=new Array(a),u=[],d=[],h=this._calculation._getContext(),f=this._calculation._getScope();f.colIndex=0,f.rowIndex=0;const g=this._getFormulaParser();for(let S=0;S<a;S++){const w=o[S],b=w[0],C=Ln(b),_=w[1],y=C.rowStart,v=C.colStart;f.colIndex=v,f.rowIndex=y;let x=g.parse(h,_);const E=x.getDirectPrecedentsAt(y,v,!0,Cl,vl),R=E.length;R===1&&(x=x.wrapImplicit(y,v,l));const I={...C},A=new kr(I,x);C.value=A,c[S]=C;const T=C.rowEnd,O=C.colEnd-v,N=T-y,D=[];for(let F=0;F<R;F++){const k=E[F];if(k instanceof $e.Known)continue;const L=Cl[F],W=vl[F],$={colStart:k.colStart,rowStart:k.rowStart,colEnd:k.colEnd+(W?0:O),rowEnd:k.rowEnd+(L?0:N),value:{blockEntry:C,width:O+1,height:N+1,index:F,$absWidth:W,$absHeight:L,once:null}};D.push(k),d.push($)}u.push({colStart:I.colStart,rowStart:I.rowStart,colEnd:I.colEnd,rowEnd:I.rowEnd,value:{tokens:x.getTokens(),references:x.getReferences(),precedents:D}})}if(r.load(c),this._precedentSpatial.load(d),u.length>0&&(n.formulaInserts=u),i){const S=[],w=[];let b;const C=this._values,_=i.length;for(let y=0;y<_;y++){const v=i[y],x=v[0],E=Ln(x),R=v[1],I={...E},A=I.colStart,T=I.rowStart,O=I.colEnd,N=I.rowEnd;Qo.colStart=A,Qo.rowStart=T,Qo.colEnd=A,Qo.rowEnd=T;const D=r.search(Qo);if(D.length!==1)continue;const F=D[0].value,k=F.ref,L=F.calcs,W=T-k.rowStart,$=A-k.colStart,J=L[W][$];if(R)J.cachedValue=$e.BuiltIn.Spill;else{const Q=new Sn(C,I);J.cachedValue=Q}E.value=new ua(I,0,R),w.push(E);const te={colStart:A,rowStart:T,colEnd:O,rowEnd:N,value:R};q.isSingleCell(te)||S.push(te),Ad(b,J,I)}this._spillSpatial.load(w),this._precedentSpatial.load(b),S.length>0&&(n.spillInserts=S)}const m=e.volatile,p=m?m.length:0;if(p>0){const S=this._volatile,w=b=>{S.add(b)};for(let b=0;b<p;b++){const C=m[b],_=Ln(C,Qo),y=r.search(_),v=y.length;for(let x=0;x<v;x++){const E=y[x];bv(E,_,w)}}}}}catch(r){throw r}finally{this._isProcessingJSON=!1}return n}async toJSON(e=!1){const t=this._formulaSpatial.all(),n=t.length;if(n===0)return null;const r={};if(n>0){const a=new Array(n);for(let c=0;c<n;c++){const u=t[c];a[c]=u.value.toJSON()}r.formulas=a}const o=this._spillSpatial.all(),i=o.length;if(i>0){const a=this._getEntireCoords(),c=new Array(i);for(let u=0;u<i;u++){const d=o[u],h=Pr(d,a);c[u]=[h,d.value.getError()]}r.dynamic=c}const l=this._volatile;if(l.size>0){const a=l.values();let c=a.next();const u=this._values.getOrientation()===B.Orientation.Column,d=oo(!0);for(;!c.done;){const m=c.value;if(Array.isArray(m))for(let p=0;p<m.length;p++){const S=m[p];for(let w=0;w<S.length;w++){const b=S[w],C=b.colIndex,_=b.rowIndex,y=u?C:_,v=u?_:C;d.append(y,v)}}else{const p=m.colIndex,S=m.rowIndex,w=u?p:S,b=u?S:p;d.append(w,b)}c=a.next()}const h=d.done(!0),f=h.length,g=new Array(f);for(let m=0;m<f;m++){const p=h[m],S=Pr(p,this._getEntireCoords());g[m]=S}r.volatile=g}return r}}const am=(s,e,t,n)=>{const r=new Mt.Builder(vv),o=oo(n);s.sort(n?q.columnFirstCellComparator:q.rowFirstCellComparator);const i=s.length;for(let c=0;c<i;c++){const u=s[c],d=u.colIndex,h=u.rowIndex;if(!u.cachedValue?.isIRange){const f=n?d:h,g=n?h:d;let m=u.cachedValue;r.addValue(f,g,m),o.append(f,g)}}const l=r.build();l&&l.tuples&&e.setValues(l.tuples);const a=o.done(!0);for(let c=0;c<a.length;c++){const u=a[c];t.insertNonOverlapping(u)}},bv=(s,e,t)=>{const n=s.colStart,r=s.rowStart,o=s.colEnd,i=s.rowEnd,l=e.colStart,a=e.rowStart,c=e.colEnd,u=e.rowEnd,d=Math.max(n,l),h=Math.max(r,a),f=Math.min(o,c),g=Math.min(i,u),m=s.value.calcs;for(let p=h;p<=g;p++){const S=p-r,w=m[S];for(let b=d;b<=f;b++){const C=b-n;t(w[C],S,C)}}},cm=(s,e,t,n)=>{const r=s.value,o=r.$absHeight,i=r.$absWidth,l=r.width,a=r.height,c=r.blockEntry.value.calcs,u=t-s.colStart,d=e-s.rowStart,h=Math.min(Math.max(u,0),l-1),f=Math.min(Math.max(d,0),a-1);if(o||i)if(i){const g=c[f];for(let m=0;m<l;m++)n(g[m])}else if(o)for(let g=0;g<a;g++)n(c[g][h]);else for(let g=0;g<a;g++){const m=c[g];for(let p=0;p<l;p++)n(m[p])}else n(c[f][h])},Cv={rowIndex:0,colIndex:0},Nt={rowStart:0,colStart:0,rowEnd:0,colEnd:0},Cl=[],vl=[],Qo={rowStart:0,colStart:0,rowEnd:0,colEnd:0},Js={rowStart:0,colStart:0,rowEnd:0,colEnd:0};new $e.Calc("Cyclical dependency");const vv=s=>new Qn(s);let Ks=0;const No=1e4,xv=new Array(No),Ev=new Array(No),xl=new Set,vu=new Array(No);let Xs=0;const xu=new Array(No);let Eu=0,El=0;const Ru=new Array(No);let Iu=0,Rl=0;const um=new Array(No);let Zs=0;const dm=new Array(No),Qs={colStart:0,rowStart:0,colEnd:0,rowEnd:0},Ys={colStart:0,rowStart:0,colEnd:0,rowEnd:0},Au=[null,null],Rv=Object.freeze({inserts:P.EmptyArray,removes:P.EmptyArray});function Iv(s,e,t,n){const r=s;if(r?.getSplit){const o=r.getSplit(e,t,n);if(o===void 0)return;e[0].value=o[0],e[1].value=o[1]}return e}const Av=Object.freeze({once:!0});class Mv{constructor(e,t=!0){this._options={...Fv,...e},this._getFunction=this._options.getFunction,this._isColumn=t}_setInstanceScope(e){this._instanceScope=e}async _initialize(){const e=await qa._validate(!0),t=kv();this._calcScope=t,this._runtime=new Tv(this._options,e);const{initializeBuiltIns:n}=await ao(async()=>{const{initializeBuiltIns:o}=await import("./lRUYQdaIClvoTNGo-DCB-8J2N.js");return{initializeBuiltIns:o}},__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url),r=this;return this._builtInFunctions=Object.freeze(n(()=>r)),{builtInFunctions:this._builtInFunctions,calcScope:this._calcScope}}getBuiltInFunctions(){return this._builtInFunctions}getFunction(e){return this._builtInFunctions.get(e)??this._getFunction?.(e)}getNumberFormat(e,t){return Ut.Parser.formatValue(e,t,{date1904:this._options.isDate1904?.()??!1})}getEntireCoords(){return this._calcScope.getEntireCoords()}getFormulaAt(e,t){const n=this._calcScope.formulaSpatial;if(!n)return null;ei.colStart=t,ei.rowStart=e,ei.colEnd=t,ei.rowEnd=e;const r=n.search(ei);return r.length===0?null:r[0].value.formula.getTextAt(e,t)??null}markVolatile(){const e=this._calcScope,t=e.volatile;t&&t.add(e.node)}formatResults(e){const t=this._calcScope,n=this._isColumn,r=n?t.colIndex:t.rowIndex,o=n?t.rowIndex:t.colIndex;t.conflatingFormats||(t.conflatingFormats=oo(n)),t.conflatingFormats.append(r,o,e)}getSheetIndex(e){const t=this._calcScope;return e===void 0&&(e=t.sheetName),this._options.getSheetIndex?.(e)??-1}getSheetCount(){return this._options.getSheetCount?.()??1}isValidDate(e){return As(e)}fromOADate(e){return Ms(e,this._options.isDate1904?.()??!1)}toOADate(e){return $i(e,this._options.isDate1904?.()??!1)}_fromTuples(e,t=null,n=!1){if(!e)return null;const r=Di(e.bounds,!0),o=this._calcScope,i=this._isColumn?B.Orientation.Column:B.Orientation.Row,l=new Io({orientation:i,maxCoords:o.getEntireCoords()});return l.setValues(e.tuples),new Sn(l,r,t,n)}getValueAt(e,t){return this._calcScope.values.getValueAt(e,t)??null}getSpillAt(e,t){const n=this._calcScope.spillSpatial;if(!n)return null;ti.rowStart=e,ti.colStart=t,ti.rowEnd=e,ti.colEnd=t;const r=n.search(ti);if(r.length===0)return null;for(let o=0;o<r.length;o++){const i=r[o];if(i.rowStart===e&&i.colStart===t)return this.getReference(q.sanitizeRange(i))}return null}getRange(e,t){if(e?.isIRange)return e;let n;const r=Array.isArray(e);if(t=t??r,r)if(Array.isArray(e[0]))n=e;else{if(e[0]?.isIRange)throw $e.BuiltIn.Value;n=[e]}else n=[[e]];const o=this._isColumn,i=o?B.Orientation.Column:B.Orientation.Row,l=this._fromTuples(Ia(n,o,zn(0,0,void 0,void 0,o),!0),void 0,t);if(l)return l;const a=new Io({orientation:i,maxCoords:this._calcScope.getEntireCoords()});return new Sn(a,q.EmptyRange,void 0,t)}getPosition(){const e=this._calcScope;return{colIndex:e.colIndex,rowIndex:e.rowIndex}}getReference(e,t){if(!e)throw $e.BuiltIn.Ref;const n=this._calcScope,r=n.getEntireCoords;if(typeof e=="string"){if(t)throw $e.BuiltIn.Ref;try{const c=Qa(e,r(),Ui,()=>{throw $e.BuiltIn.Ref},t);if(c.length>1)throw $e.BuiltIn.Ref;e=c[0]}catch{throw $e.BuiltIn.Ref}}if(!e)throw $e.BuiltIn.Ref;const o=n.values;let i;const l=n.node;let a;if(l){const c=l.precedents;a=Nv(c,e)}if(a){const c=a.calc;i=c&&c.isIReferenceRange?c.cachedValue:new Id(o,void 0,e,null,r)}else n.dynamicPrecedentsInserts=Ad(n.dynamicPrecedentsInserts,l,e),i=new Id(o,void 0,e,null,r);return i}getAddress(e,t=!1){e||(e=this.getPosition());const n=this.getEntireCoords().sheetName;return e.colIndex!==void 0?((r,o,i=!1)=>i?ca(r,o):iu(r,o))(e,n,t):((r,o,i=!1)=>(i?ca({colIndex:r.colStart,rowIndex:r.rowStart,$colIndex:r.$colStart,$rowIndex:r.$rowStart,sheetName:r.sheetName},o):iu({colIndex:r.colStart,rowIndex:r.rowStart,$colIndex:r.$colStart,$rowIndex:r.$rowStart,sheetName:r.sheetName},o))+":"+(i?ca({colIndex:r.colEnd,rowIndex:r.rowEnd,$colIndex:r.$colEnd,$rowIndex:r.$rowEnd},null):iu({colIndex:r.colEnd,rowIndex:r.rowEnd,$colIndex:r.$colEnd,$rowIndex:r.$rowEnd},null)))(e,n,t)}parseAsDateTime(e,t=!1){return(function(n,r=!1,o=!1){let i=n,l=d0(n,r,!0);l&&(i=l.leadingText);let a=null;if(i.trim().length>0&&(a=Kd(i,r),!a&&o))return null;!a&&l?.leadingText.trim().length>0&&(l=null);let c=0;return a&&(c+=a.asOADate),l&&(c+=l.parsed.oaDateTime),c})(e,this._options.isDate1904?.()??!1,t)}getRuntime(){return this._runtime}get[Symbol.toStringTag](){return"[CalculationContext]"}toString(){let e="";const t=this._instanceScope;let n;return t&&(n=t.toString?.()),n&&n&&(e=`${e}:[${n}]`),e}}class Tv{constructor(e,t){this._options=e,this._license=t}getCurrencySymbol(){return"$"}getNumberDecimalSeparator(){return"."}getNumberGroupSeparator(){return","}isDate1904(){return this._options.isDate1904?.()??!1}getDescription(){return"Calculation Runtime"}getLocation(){return P.isNode()?process.cwd():window.location?.href??"/"}getVersion(){try{const e="0.7.26";if(e.indexOf(".env.")===-1)return`${e}`}catch{return"local"}}getOS(){return P.getOS()}getUser(){return this._license?.getLicensee?.()??null}}const kv=()=>({rowIndex:0,colIndex:0,sheetName:null,node:null,values:null,formulaSpatial:null,spillSpatial:null,volatile:null,conflatingFormats:null,dynamicPrecedentsInserts:null,formula:null,getEntireCoords:()=>ji}),Fv={getSheetIndex:s=>-1,getSheetCount:()=>1,getSheetName:()=>null,getEntireCoords:()=>ji,getNamed:(s,e)=>null,getFunction:s=>null,isDate1904:()=>!1},Nv=(s,e)=>{if(!s)return;const t=s.length;if(t===0)return;const n=e.colStart,r=e.rowStart,o=e.colEnd,i=e.rowEnd;for(let l=0;l<t;l++){const a=s[l],c=a;if(c!==void 0&&a.colStart===n&&a.rowStart===r&&a.colEnd===o&&a.rowEnd===i)return c}return null},ei={rowStart:0,colStart:0,rowEnd:0,colEnd:0},ti={rowStart:0,colStart:0,rowEnd:0,colEnd:0};class Ov{_setScope(e){this._scope=e}_getScope(e=!1){const t=this._scope;if(!t&&!e)throw new Error("FunctionContext can only be used in a function.");return t}getNumberFormat(e,t){return this._getScope().getNumberFormat(e,t)}getEntireCoords(){return this._getScope().getEntireCoords()??ji}isValidDate(e){return this._getScope().isValidDate(e)}parseAsDateTime(e,t){return this._getScope().parseAsDateTime(e,t)}fromOADate(e){return this._getScope().fromOADate(e)}toOADate(e){return this._getScope().toOADate(e)}getRange(e){return this._getScope().getRange(e)}getValueAt(e,t){return this._getScope().getValueAt(e,t)}getPosition(){return this._getScope().getPosition?.()??Q1}getReference(e,t){return this._getScope().getReference(e,t)}getFormulaAt(e,t){return this._getScope().getFormulaAt?.(e,t)??null}getSpillAt(e,t){return this._getScope().getSpillAt?.(e,t)??null}getSheetIndex(e){return this._getScope().getSheetIndex?.(e)??-1}getSheetCount(){return this._getScope().getSheetCount?.()??1}markVolatile(){this._getScope().markVolatile?.()}formatResults(e){this._getScope().formatResults?.(e)}getFunction(e){return this._getScope().getFunction?.(e)??null}getAddress(e,t){return this._getScope().getAddress(e,t)}getRuntime(){return this._getScope().getRuntime()}get[Symbol.toStringTag](){return"[FormulaContext]"}toString(){const e=this._getScope();if(e){const t=e.toString?.();if(t)return t}return e?"":"{NO SCOPE}"}}const Dv=new Ov,Na="__SHEETXL";let Co;const hm={FormulaContext:Co,ScalarType:Le,IRange:B,FormulaError:$e,Observable:c_};let Sa;function uh(s){Co||(Co=Dv,hm.FormulaContext=Co),Sa=globalThis[Na],globalThis[Na]=hm,Co._setScope(s)}function Oa(){Sa?(globalThis[Na]=Sa,Sa=void 0):delete globalThis[Na],Co&&Co._setScope(null)}var Or;(Or||(Or={})).Context={Workbook:"workbook",Sheet:"sheet",Ranges:"ranges",Range:"range",Calculation:"calculation"};let Da=class{constructor(e,t,n,r=null,o=!1){this._ct=Or.Context.Calculation,this._builtIn=!1,this._broadcast=!1,this._pj=null,this._json=e,this._n=e.name,this._d=new Pv(e),this._ct=e.context??Or.Context.Calculation;const i=e.parameters;let l;this._pj=i,t||(console.log(`TypeFunction '${e.name}' was not provided a function implementation.`),t=()=>{}),this._fn=t.bind(this),this._cf=n??Bv,this._builtIn=o,l=r?typeof r=="function"?r:()=>Promise.resolve(r):Lv(e),this._descFn=l;const a=i?.length??0;let c=a===1||a===2;c&&(i[0].arrayDepth>0||i[0].range)&&(c=!1),c&&a===2&&(i[1].arrayDepth>0||i[1].range)&&(c=!1),this._broadcast=c}execute(...e){const t=this._pj,n=[],r=this._cf?.();uh(r);let o=!1,i=null;const l=t?.length??0;let a,c=this._broadcast;if(c){const u=mf(e[0]);if(l===1&&u)c=!1;else if(l===2){const d=mf(e[1]);u&&d&&(c=!1)}}try{for(let d=0;!o&&d<l;d++){const h=t[d];let f=h.scalar??null;f!==Le.Null&&f!=="*"||(f=null);let g=h.range??null;const m=h.rest??!1,p=h.optional??!1;let S=e[d];if(p&&S===null&&(S=void 0),S===void 0){if(p){n.push(void 0);continue}if(!p&&!m)throw d<=e.length?fm.ARGS_TOO_FEW([h.name],this._n):fm.PARAM_MISSING(h.name,this._n);if(d>=e.length){o=!0;continue}}const w=h.arrayDepth??0;let b=(h.range?2:0)+w;const C=h.rest??!1;if(C)for(;d<e.length&&!i;)S!==void 0&&(i=Md(r,n,S,f,g,w,C,b)),S=e[++d];else c&&(g="l",b=2),i=Md(r,n,S,f,g,w,C,b),o=!!i}if(i)throw i;for(;n.length>0&&n[n.length-1]===void 0;)n.length--;const u=this._fn;if(c){if(n.length===1){const d=n[0];let h=t[0].scalar;h!==Le.Null&&h!=="*"||(h=null),a=d.map(f=>{if(f instanceof $e.Known)return f;let g=f;try{g=u(g),(Array.isArray(g)||g?.isIRange)&&(g=$e.BuiltIn.Value)}catch(m){g=m}return g},{type:h})}if(n.length===2){const d=n[0];let h=t[0].scalar;h!==Le.Null&&h!=="*"||(h=null);const f=n[1];let g=t[1].scalar;g!==Le.Null&&g!=="*"||(g=null),a=d.broadcast(f,(m,p)=>{if(m instanceof $e.Known)return m;if(p instanceof $e.Known)return p;let S;try{S=u(m,p),(Array.isArray(S)||S?.isIRange)&&(S=$e.BuiltIn.Value)}catch(w){S=w}return S},{type:h,otherType:g})}}else a=u(...n);a=Xa(a,r)}catch(u){throw u}finally{Oa()}return a}getName(){return this._n}getDeclaration(){return this._d}async getDescriptor(e){if(this._desc)return this._desc;const t=await Promise.resolve(this._descFn(e));return this._desc=new Hv(this,t),this._desc}isBuiltIn(){return this._builtIn}getContext(){const e=this._ct;if(e==="sheet"||e==="workbook"||e==="ranges"||e==="range"){const t=this._json;return t&&t.behavior&&t.behavior.default?"autoRun":"macro"}return"formula"}get[Symbol.toStringTag](){return"[TypedFunction]"}toString(){let e="";const t=this._pj;return t.length>0&&(e=t.map(n=>{let r=n.name;return n.rest&&(r="..."+r),n.optional&&(r+="?"),r+=": "+((o,i)=>{if(i){const l=Y1.get(i)??"InvalidRange";return o?`${l}<${ff.get(o)??"InvalidScalar"}>`:l}return ff.get(o)??"InvalidScalar"})(n.scalar,n.range),r+="[]".repeat(n.arrayDepth),r}).join(", ")),`${this.getName()}(${e})`}get isIFunction(){return!0}get isITypedFunction(){return!0}};const Lv=s=>async e=>{const t={};for(let n=0;n<s.parameters.length;n++)t[s.parameters[n].name]=P.camelToPrettyCase(s.parameters[n].description);return{summary:P.camelToPrettyCase(s.name),parameters:t,category:"User Defined"}},Bv=()=>null;class BS{constructor(e){this._s=e.scalar,this._r=e.range??null,this._d=e.arrayDepth??0}getScalarType(){return this._s}getRangeType(){return this._r}getArrayDepth(){return this._d}}class zv extends BS{constructor(e){super(e),this._n=e.name,this._o=e.optional??!1,this._rest=e.rest??!1,this._e=e.enums?Object.freeze(e.enums):P.EmptyArray}getName(){return this._n}isOptional(){return this._o}isRest(){return this._rest}getEnums(){return this._e}}class gm extends BS{constructor(e){super(e),this._a=e.async??!1,this._stream=e.stream??!1}isAsync(){return this._a}isStreaming(){return this._stream}}class Pv{constructor(e){if(this._n=e.name,e.parameters){const t=e.parameters.length,n=new Array(t);for(let r=0;r<t;r++)n[r]=new zv(e.parameters[r]);this._p=Object.freeze(n)}else this._p=P.EmptyArray;e.returnType?this._r=new gm(e.returnType):this._r=new gm({scalar:null,arrayDepth:0,range:null})}getName(){return this._n}getParameters(){return this._p}getReturnType(){return this._r}}class Hv{constructor(e,t){if(this._n=t.name,this._fn=e,this._s=t.summary??P.camelToPrettyCase(t.name),this._c=t.category??"Uncategorized",this._h=t.hidden??!1,t.links&&t.links.length>0){const n=t.links.length,r=new Array(n);for(let o=0;o<n;o++)r[o]=Object.freeze([t.links[o][0],t.links[o][1]]);this._l=Object.freeze(r)}else this._l=P.EmptyArray;if(t.parameters){for(const n in t.parameters)if(Object.prototype.hasOwnProperty.call(t.parameters,n)){const r=t.parameters[n].description,o=t.parameters[n].example,i=t.parameters[n].defaultValue,l={};r&&(l.description=r),o&&(l.example=o),i!==void 0&&(l.defaultValue=i),Object.freeze(l)}}}getName(){return this._n}getSummary(){return this._s}getCategory(){return this._c}isHidden(){return this._h}getLinks(){return this._l}getParameters(){return this._p}get[Symbol.toStringTag](){return"[Descriptor]"}toString(){const e=this._fn;return`${this.getSummary()}: ${e}`}}const Md=(s,e,t,n,r,o,i,l)=>{if(t&&t.colStart!==void 0)if(r)t=s.getReference?.(t);else{const a=t.colStart,c=t.rowStart,u=t.colEnd;t=t.rowEnd!==c||a!==u?s.getReference?.(t):s.getValueAt(c,a)}if(l===0){let a=((c,u=null,d=!1)=>{let h=c;for(;Array.isArray(h);){if(h.length>1)return d?$e.BuiltIn.Value:h;h=h[0]}if(h?.isIRange){if(h.size!==1)return d?$e.BuiltIn.Value:h;h=h.getValueAt(0,0)}return u&&(h=sr(h,yn(h,!0),u)),h})(t,n,!0);return a instanceof $e.Known?a:void e.push(a)}if(l===2)return Us(s,e,t,n,r,Array.isArray(t));if(l===1||l===3){let a;const c=i?e:[];if(r){const u=Array.isArray(t);if(u){const d=t.length;for(let h=0;!a&&h<d;h++)a=Us(s,c,t[h],n,r,u)}else a=Us(s,c,t,n,r,u)}else if(l===3){let u=(d=>{let h=d,f=0;for(;Array.isArray(h);)f++,h=h[0];return h.isIRange&&(f+=2),f})(t);for(let d=u;d<2;d++)t=[t],u++;if(u===3){const d=t.length;for(let h=0;!a&&h<d;h++)a=Us(s,c,t[h],n,r,!0)}else a=Us(s,c,t,n,r,!0)}else a=tS(s,c,t,n,r,r!==null);return a?.isFormulaError?a:void(i||e.push(c))}{if(!Array.isArray(t)){if(n&&(t=sr(t,yn(t,!0),n,!1),t?.isFormulaError))return e.push(t),t;t=[t]}const a=t.length;for(let c=0;c<a;c++){const u=[],d=Md(s,u,t[c],n,r,o,i,l-1);if(d?.isFormulaError)return d;u.length>0&&e.push(u)}}},fm={PARAM_MISSING:(s,e)=>new $e.NA(`Parameter ${s} is missing${e?` for ${e}`:""}.`),ARGS_TOO_FEW:(s,e)=>new $e.Parse(`Argument type ${s.join(", ")} is missing${e?` for ${e}`:""}.`)};class zS{constructor(e){this._emitter=null,this._readonly=null,this._closed=!1,this._options={...e};const t=this;this._transactions=this._options.transactions??new Hn({transient:!0}),this._transactionsRemoveListener=this._transactions.addStateListener(this,{onAfterStateChange(n,r,o){t._emitter.notify("onCollectionChange")}}),this._emitter=new gn(this,this._transactions),this._readonly=e?.readonlyFunctions,this._initState()}getItems(e){const t=this._getState();if(!t)return P.EmptyArray;const n=Array.from(t.itemsByKey.values()),r=this._readonly;return r&&n.push(...Array.from(r.values())),n}getByName(e){if(!e)return null;const t=this._getState();if(!t)return null;if(!t)return P.EmptyArray;const n=e.toUpperCase(),r=this._readonly;if(!r||!r.size)return null;let o=r.get(n);return o||(o=t.itemsByKey.get(n),o||null)}async search(e){const t=this._getState();if(!t)return P.EmptyArray;const n=e?.name?e.name.toUpperCase():null,r=e?.type?e.type:null;let o;const i=e?.category?e.category.toUpperCase():null,l=e?.text?e.text.toUpperCase():null,a=!!i||!!l;let c;const u=async(h,f)=>{if(n&&f!==n||r&&h.getContext()!==r)return!1;if(a){c||(c=[]);const g=h.getDescriptor();c.push(g);const m=await g;if(l&&!m.getSummary().toUpperCase().includes(l)||i&&m.getCategory().toUpperCase()!==i)return!1}o||(o=[]),o.push(h)},d=this._readonly;return d&&d.forEach(u),t.itemsByKey.forEach(u),c&&await Promise.all(c),o??P.EmptyArray}getCount(){const e=this._getState();if(!e)return 0;let t=e.itemsByKey.size;return this._readonly&&(t+=this._readonly.size),t}validateName(e){return this._validateName(e)}_validateName(e,t=!1){if(this._closed)throw new Error(Xn)}add(e){if(this._closed)throw new Error(Xn);if(!e)throw new Error("Item must be specified.");let t;if(e.isIFunction){const o=e,i=e._json;t=new Da(i,o._fn,()=>this._options.context,o._desc)}else{const o=e;t=new Da(o.declaration,o.execute,()=>this._options.context,o.descriptor)}const n=this._getState(),r=t.getName().toUpperCase();return n.itemsByKey.set(r,t),t}beginCommit(e){return this._beginCommit(e)}_getState(){if(this._closed)throw new Error(Xn);return this._transactions.getState(this)}_beginCommit(e){return this._transactions.beginCommit(typeof e=="string"?{description:e}:e)}_updateState(e,t="Update",n){if(!e)return;const r=this._beginCommit(t);try{r.updateState(this,e),r.commit(n)}catch(o){throw r.rollback(),o}}_initState(){this._updateState(e=>({...e,itemsByKey:new Map}),"Initialize",{forceAmend:!0})}addListeners(e,t){return this._emitter.addListeners(e,t)}isClosed(){return this._closed}close(){this._closed||(this._emitter.notify("onClose"),this._closed=!0,this._transactionsRemoveListener?.())}get isFunctionCollection(){return!0}}class PS extends Fo{constructor(e){super(e),this._graphsCalcing=new Map,this._graphsAll=new Map,this._status=Kt.Status.Off,this._statusTransition=null,this._emitter=new gn(this)}_getContext(){return this._context}_getScope(){return this._scope}_getCalcingGraphs(){return this._graphsCalcing}_getAllGraphs(){return this._graphsAll}start(){return this._statusTransition||(this._statusTransition=(async()=>{if(this._status===Kt.Status.Off)try{this._status=Kt.Status.Starting,this._emitter.notify("onStatusChange"),this._emitter.notify("onStarting");const e=this,t=this._options,n=a=>e.getFunctions().getByName(a)??t?.getFunction?.(a),r=new Mv({...t,getFunction:n});this._context=r;const o=await r._initialize(),i=o.builtInFunctions;this._functions=new zS({transactions:this._transactions,context:r,readonlyFunctions:i});const l=await ao(()=>import("./xXGFfp-8v8jL5akS-Civr6X0s.js"),__vite__mapDeps([8,2,1,3,4,5,6,7]),import.meta.url);this._formulaParser=new l.FormulaParser,this._scope=o.calcScope,this._status=Kt.Status.Ready,this._emitter.notify("onStatusChange"),this._emitter.notify("onReady")}catch(e){throw this._status=Kt.Status.Off,this._emitter.notify("onError",e),this._emitter.notify("onStatusChange"),e}finally{this._statusTransition=null}})()),this._statusTransition}_createGraph(e){const t=this._options;return new ch({...t,...e,getFormulaParser:()=>this._formulaParser,calculation:this})}async stop(){this._status===Kt.Status.Ready&&(this._status=Kt.Status.Stopping,this._emitter.notify("onStatusChange"),this._emitter.notify("onStopping"),this._status=Kt.Status.Off,this._emitter.notify("onStatusChange"),this._emitter.notify("onStop"))}getStatus(){return this._status}async ready(e){this._status===Kt.Status.Starting&&await this._statusTransition;const t=e?.full??!1?this._getAllGraphs():this._getCalcingGraphs();if(t.size===0)return mm;const n=t.values(),r=[];for(const o of n)r.push(o.calculate(e));return await Promise.all(r),mm}getFunctions(){return this._checkReady(),this._functions}getRuntime(){return this._checkReady(),this._runtime}_checkReady(){if(this._status!==Kt.Status.Ready)throw new Error(this._statusMessage())}_statusMessage(){switch(this._status){case Kt.Status.Off:return"Calculation is off";case Kt.Status.Starting:return"Calculation is starting";case Kt.Status.Ready:return"Calculation is ready";default:return"Unknown calculation status"}}get[Symbol.toStringTag](){return"[Calculation]"}toString(){return"Calculation"}}const mm=Promise.resolve(),La=Object.freeze(Object.defineProperty({__proto__:null,nowWithPrecision:(s=6e4)=>new Date(Math.floor(Date.now()/s)*s)},Symbol.toStringTag,{value:"Module"}));var pm,Il,Td,Al,dn;(Il=pm||(pm={})).NumberFilterOperatorType={Equal:"equal",GreaterThan:"greaterThan",GreaterThanOrEqual:"greaterThanOrEqual",LessThan:"lessThan",LessThanOrEqual:"lessThanOrEqual",NotEqual:"notEqual"},Il.Type={Color:"color",Custom:"custom",Dynamic:"dynamic",Items:"items",Icon:"icon",Top10:"top10"},Il.DynamicType={AboveAverage:"aboveAverage",BelowAverage:"belowAverage",LastMonth:"lastMonth",LastQuarter:"lastQuarter",LastWeek:"lastWeek",LastYear:"lastYear",M1:"M1",M2:"M2",M3:"M3",M4:"M4",M5:"M5",M6:"M6",M7:"M7",M8:"M8",M9:"M9",M10:"M10",M11:"M11",M12:"M12",NextMonth:"nextMonth",NextQuarter:"nextQuarter",NextWeek:"nextWeek",Null:"null",Q1:"Q1",Q2:"Q2",Q3:"Q3",Q4:"Q4",ThisMonth:"thisMonth",ThisQuarter:"thisQuarter",ThisWeek:"thisWeek",Today:"today",Tomorrow:"tomorrow",YearToDate:"yearToDate",Yesterday:"yesterday"},Il.DateItemGroupingType={Day:"day",Hour:"hour",Minute:"minute",Month:"month",Second:"Second",Year:"year"},(Al=Td||(Td={})).Type={AboveAverage:"aboveAverage",BeginsWith:"beginsWith",CellIs:"cellIs",ColorScale:"colorScale",ContainsBlanks:"containsBlanks",ContainsErrors:"containsErrors",ContainsText:"containsText",DataBar:"dataBar",DuplicateValues:"duplicateValues",EndsWith:"endsWith",Expression:"expression",IconSet:"iconSet",NotContainsBlanks:"notContainsBlanks",NotContainsErrors:"notContainsErrors",NotContainsText:"notContainsText",TimePeriod:"timePeriod",Top10:"top10",UniqueValues:"uniqueValues"},Al.OperatorType={BeginsWith:"beginsWith",Between:"between",ContainsText:"containsText",EndsWith:"endsWith",Equal:"equal",GreaterThan:"greaterThan",GreaterThanOrEqual:"greaterThanOrEqual",LessThan:"lessThan",LessThanOrEqual:"lessThanOrEqual",NotBetween:"notBetween",NotContains:"notContains",NotEqual:"notEqual"},Al.TimePeriod={Last7Days:"last7Days",LastMonth:"lastMonth",LastWeek:"lastWeek",NextMonth:"nextMonth",NextWeek:"nextWeek",ThisMonth:"thisMonth",ThisWeek:"thisWeek",Today:"today",Tomorrow:"tomorrow",Yesterday:"yesterday"},Al.ConditionalBoundsType={Formula:"formula",Max:"max",Min:"min",Num:"num",Percent:"percent",Percentile:"percentile"},(dn||(dn={})).HeaderTextStyle={A1:"a1",Zero:"zero",One:"one"};class $v{constructor(e,t,n,r){this._mergedReading=[],this._colsReading=[],this._rowsReading=[],this._styles=e,this._topLeft=r??{rowIndex:0,colIndex:0},this._sheet=new Dd({styles:this._styles,date1904:t,container:{getName:()=>n,getIndex:()=>1}}),this._cellUpdater=this._sheet.getEntireRange().startIncrementalUpdates()}applyCSSStyle(e,t){let n=!1;e.style||(e.style={},n=!0);let r=e.style,o={...t};if(t.msoIgnore){const d=t.msoIgnore.split(",");let h=Object.keys(o);for(let f=0;f<h.length;f++){const g=h[f];d.includes(g)&&delete o[g]}}const i=ha(o.fontFamily);r.font={},i&&(r.font.family=i.family,r.font.fallbacks=i.fallbacks,r.font.size=i.size),r.font.size=o.fontSize,r.font.weight=o.fontWeight,r.font.style=o.fontStyle,r.font.fill=o.color;const l=(d=>{if(!d)return xb;let h=Be.UnderlineStyle.None,f=!1;return(d=d.toLowerCase()).includes("underline")&&(h=Be.UnderlineStyle.Single),(d.includes("line-through")||d.includes("linethrough"))&&(f=!0),{underline:h,strike:f}})(o.textDecoration);r.font.underline=l.underline,r.font.strike=l.strike,o.textUnderlineStyle&&(r.font.underline=SS(o.textUnderlineStyle)),r.alignment={},o?.textAlign&&(r.alignment.horizontal=(d=>{const h=P.textToKey(d);return Zr.get(h)||null})(o.textAlign)),o?.textAlign&&!r.alignment.horizontal&&o?.textAlign!=="general"&&(o.textAlign==="center-across"?r.alignment.horizontal=ce.HorizontalAlignment.CenterContinuous:o.textAlign==="fill"?r.alignment.horizontal=ce.HorizontalAlignment.Fill:o.textAlign==="121"||o.textAlign==="010"?(r.alignment.horizontal=ce.HorizontalAlignment.Distributed,r.alignment.justifyLastLine=o.textAlign==="121"):console.warn("unknown text-align",o.textAlign)),o.verticalAlign&&(o.verticalAlign.toLowerCase()==="super"?r.font.verticalAlign=Be.VerticalAlignment.Super:o.verticalAlign.toLowerCase()==="sup"?r.font.verticalAlign=Be.VerticalAlignment.Sub:r.alignment.vertical=(d=>{const h=P.textToKey(d);return Ir.get(h)||null})(o.verticalAlign),r.alignment.vertical||(o.verticalAlign==="121"?r.alignment.vertical=ce.VerticalAlignment.Distributed:console.warn("unknown vertical-align",o.verticalAlign))),o.msoCharIndentCount&&(r.alignment.indent=o.msoCharIndentCount),o.whiteSpace&&(r.alignment.overflow=o.whiteSpace==="no-wrap"||o.whiteSpace==="nowrap"?ce.Overflow.Visible:ce.Overflow.Wrap),o.msoTextControl==="shrinktofit"&&(r.alignment.overflow=ce.Overflow.Shrink);let a=null;if(o.background?a=o.background:o.backgroundColor&&(a=o.backgroundColor),a&&(r.fill={color:a}),o.msoPattern){let d=oC(o.msoPattern);d&&(d.patternType===He.BuiltInSheetPattern.Solid?r.fill={color:d.foreground}:d.patternType!==He.BuiltInSheetPattern.None&&(a&&(d.background=a),r.fill=d))}o.msoRotate!==void 0&&(r.alignment.rotation=(d=>{let h=parseFloat(d);return isNaN(h)||(h%=360,h>0?h=360-h:h<0&&(h*=-1)),h})(o.msoRotate));const c=(d,h)=>{d&&(r.border||(r.border={}),r.border[d]=h)};o.border&&o.border!=="none"&&(c("top",o.border),c("left",o.border),c("right",o.border),c("bottom",o.border)),o.borderTop&&c("top",o.borderTop),o.borderLeft&&c("left",o.borderLeft),o.borderRight&&c("right",o.borderRight),o.borderBottom&&c("bottom",o.borderBottom),o.msoDiagonalUp&&c("diagonalUp",o.msoDiagonalUp),o.msoDiagonalDown&&c("diagonalDown",o.msoDiagonalDown);let u=r.numberFormat;o.msoNumberFormat&&(u=(d=>{let h=d.replace(/(\\[0-9]{4})/g,f=>String.fromCharCode(parseInt(f.replace(/\\/g,""),16)));return h=h.replace(/(\\.{1})/g,f=>f.substring(f.length-1,f.length)),h.includes("\\")&&(h=h.replace(/(\\.{1})/g,f=>f.substring(f.length-1,f.length))),h=h.replace(/^"(.*)"$/,"$1"),h})(o.msoNumberFormat),u.includes("\\")?u=null:u==="Fixed"?u=Ut.Styles.lookupStyle(r.numberFormat).formatType===Ut.Type.Number?null:Ut.Type.Number:u==="Percent"&&(u=Ut.Styles.lookupStyle(r.numberFormat).formatType===Ut.Type.Percentage?null:Ut.Type.Percentage)),u&&(r.numberFormat=u),e.style=this._styles.normalize(r),n&&Object.keys(e.style).length===0&&delete e.style}onCell(e,t,n,r,o){const i=r(o);let l={value:t!==void 0?t:n??""};if(typeof l.value=="string"&&l.value.length===0&&(l.value=void 0),i&&this.applyCSSStyle(l,i),o?.tagName.toUpperCase()==="TD"){let a=l.style,c=a?.font??{};(o.querySelectorAll("s").length>0||o.querySelectorAll("strike").length>0)&&(c.strike=!0),o.querySelectorAll("sub").length>0&&(c.verticalAlign=Be.VerticalAlignment.Sub),o.querySelectorAll("sup").length>0&&(c.verticalAlign=Be.VerticalAlignment.Super),(o.querySelectorAll("b").length>0||o.querySelectorAll("strong").length>0)&&(c.weight=700),o.querySelectorAll("i").length>0&&(c.style=Be.Style.Italic),o.querySelectorAll("u").length>0&&(c.underline=Be.UnderlineStyle.Single),Object.keys(c).length>0&&(a||(a={},l.style=a),a.font||(a.font=c));const u=o.querySelectorAll("a");if(u.length>0){const d=u[0].getAttribute("href");d&&(l.hyperlink=d)}}if(!q.isSingleCell(e)){const a={rowStart:this._topLeft.rowIndex+e.rowStart,colStart:this._topLeft.colIndex+e.colStart,rowEnd:this._topLeft.rowIndex+e.rowEnd,colEnd:this._topLeft.colIndex+e.colEnd};this._mergedReading.push(a)}if((l.value!==void 0||l.style||!(Object.keys(l).length<=1))&&(this._cellUpdater.pushAt(this._topLeft.rowIndex+e.rowStart,this._topLeft.colIndex+e.colStart,l),!q.isSingleCell(e)&&i.msoIgnore)){if(i.msoIgnore.includes("colspan")){const a={};i&&this.applyCSSStyle(a,i);const c=e.colEnd-e.colStart;for(let u=1;u<=c;u++)this._cellUpdater.pushAt(this._topLeft.rowIndex+e.rowStart,this._topLeft.colIndex+e.colStart+u,a);e={...e,colEnd:e.colStart}}i.msoIgnore.includes("rowspan")&&(e={...e,rowEnd:e.rowStart})}}onNoTable(e,t,n){this.onCell({rowStart:this._topLeft.rowIndex,colStart:this._topLeft.colIndex,rowEnd:this._topLeft.rowIndex,colEnd:this._topLeft.colIndex},e,null,t,n)}onRowStart(e,t,n,r){const o=n(r);if(o.msoHeightSource!=="userset")return;let i=r.getAttribute("height")??o.height,l=null;if(i&&(l=Ss(i,this._styles.getNormal().getFont().getSize(),"px")),l===null)for(let a=0;a<r.cells.length;a++){const c=r.cells[a],u=c.getAttribute("height")??n(c).height;let d=Ss(u,this._styles.getNormal().getFont().getSize(),"px");d!==null&&(l=Math.max(d,l??0))}l!==null&&this._rowsReading.push({address:{min:this._topLeft.rowIndex+e,max:this._topLeft.rowIndex+e+t-1},update:{size:l*Be.getDeviceScale()}})}onColumn(e,t,n,r){const o=n(r);if(o.msoWidthSource!=="userset")return;let i=r.getAttribute("width")??o.width,l=null;i&&(l=Ss(i,this._styles.getNormal().getFont().getSize(),"px")),l!==null&&this._colsReading.push({address:{min:this._topLeft.colIndex+e,max:this._topLeft.colIndex+e+t-1},update:{size:l*Be.getDeviceScale()}})}onDone(){this._colsReading.length>0&&this._sheet.getColumnHeaders().updateHeaderPairs(this._colsReading),this._rowsReading.length>0&&this._sheet.getRowHeaders().updateHeaderPairs(this._rowsReading),this._sheet.doBatch(()=>{this._cellUpdater.apply()}),this._mergedReading.length>0&&this._sheet.getRanges(this._mergedReading).merge()}sheet(){return this._sheet}}let Sm=!1;class Vv{constructor(e,t){this._mapStylesByName=new Map,this._arrStyleNames=[],this._mapStylesByName=e,this._arrStyleNames=t}setNode(e){this._node=e}addStyle(e,t){t!=null&&(this._node?.styles||(this._node.styles=new Map),this._node.styles.set(e,t))}addAttribute(e,t){t!=null&&(this._node?.attributes||(this._node.attributes=new Map),this._node.attributes.set(e,t),e.toLowerCase()==="rowspan"&&parseInt(t)>1&&(this._node.rowspan=parseInt(t)),e.toLowerCase()==="colspan"&&parseInt(t)>1&&(this._node.colspan=parseInt(t)))}addSharedStyle(e,t){let n=this._mapStylesByName.get(e);n?n={...t}:(this._arrStyleNames.push(e),n=t),this._mapStylesByName.set(e,n)}setPlainText(e){this._node.plainText=e}setHTMLText(e){this._node.htmlText=e.replace(/(?:\r\n|\r|\n)/g,"<br>")}}const wm=s=>{const e={};if(!s)return e;s.endsWith(";")||(s+=";");const t=new RegExp(';(?=([^"]*"[^"]*")*[^"]*$)',"gsm");let n,r=0;for(;(n=t.exec(s))!==null;){try{let o=s.substring(r,n.index).trim();const i=new RegExp(':(?=([^"]*"[^"]*")*[^"]*$)',"gsm");let l,a,c;for(;(c=i.exec(o))!==null;)l=unescape(o.substring(0,c.index)).trim(),a=unescape(o.substring(c.index+1,o.length)).trim();a!==null&&a!=="null"&&(l&&(l=g0(l)),e[l]=a)}catch(o){console.warn(o)}r=n.index+1}return e},Ml=(s,e)=>{const t=[];if(!s)return t;const n=s.children;for(let r=0;r<n.length;r++){const o=n.item(r);if(o.nodeType===1){const i=o.tagName.toUpperCase();e.includes(i)&&t.push(o)}}return t},Wv=(s,e,t)=>{try{let n=null,r=null;const o=a=>((c,u)=>{if(!c)return{};let d={},h=u.get(c.localName);h&&(d=Object.assign(d,h));const f=c.getAttribute("class");if(f){const m=u.get("."+f);m&&(d=Object.assign(d,m))}const g=c.getAttribute("style");if(g){const m=wm(g);m&&(d=Object.assign(d,m))}return c.getAttribute("align")&&!d.textAlign&&(d.textAlign=c.getAttribute("align")),d})(a,r);if(s)try{n=[];const a="P, H1, H2, H3, H4, H5, H6, PRE",c=s.querySelector("parsererror");if(c)return console.warn("error",c),!1;const u=s.querySelectorAll("html"),d=u[u.length-1];r=(p=>{const S=p.querySelectorAll("style"),w=new Map;if(S.length<=0)return w;for(let b=0;b<S.length;b++){const C=S[b].childNodes;for(let _=0;_<C.length;_++)if(C[_].nodeType===Node.TEXT_NODE){const y=new RegExp("<!--(.*)-->","gs");let v=C[_].textContent;const x=y.exec(C[_].textContent);if(x&&x.length>1&&(v=x[1]),v=v.replace(/^\s/,""),v?.startsWith("table")){const E=new RegExp("{(.*?)}","gs");let R,I=0;for(;(R=E.exec(v))!==null;)try{const A=v.substring(I,R.index),T=wm(R[1]);w.set(A.trim(),T),I=R.index+R[0].length}catch(A){console.warn(A)}return w}}}return w})(d);const h=d.querySelectorAll("body"),f=h[h.length-1];let g=f.querySelectorAll("table")[0],m=!1;if(!g){let p=f.querySelectorAll("span");g=p[0],m=p.length>1}if(g||(g=Ml(f,a)[0]),g||(g=Ml(s,a)[0]),g?.nodeName.toUpperCase()==="TABLE"){t.onStart?.(r);const p=g;t.onTableStart?.(o,p);const S=Ml(p,"COLGROUP");for(let C=0;S&&C<S.length;C++){const _=Ml(S[C],"COL");let y=0;for(let v=0;v<_.length;v++){const x=_[v],E=parseFloat(x.getAttribute("span")),R=isNaN(E)?1:E;t.onColumn?.(y,R,o,x),y+=R}}const w=p.rows;let b=0;for(let C=0;C<w.length;C++){const _=w[C],y=parseFloat(_.getAttribute("span")),v=isNaN(y)?1:y;t.onRowStart?.(b,v,o,_);const x=[];n.push(x);const E=_.cells;for(let R=0;R<E.length;R++){let I=E[R],A=!1;for(let T=0;!A&&T<I.childNodes.length;T++)if(I.childNodes[T].nodeType===8){const O=I.childNodes[T].textContent;if(O!=="[if gte vml 1]"&&O!=="[if !vml]"&&O==="[endif]"){const N=I.childNodes[T+1];N?.querySelectorAll&&N.querySelectorAll("table, td").length===2&&(I=N?.querySelectorAll("table, td")[1],A=!0)}}x.push({htmlValue:I.textContent?.replace(/^"|"$/gi,""),element:I})}b+=v,t.onRowDow?.(b,v,o,_)}t.onTableDone?.(o,p)}else{if(g?.nodeName.toUpperCase()==="SPAN"){const p=e?e[0]?.[0]:null,S=m&&p?p:g.textContent.replace(/^"|"$/gi,"");return t.onStart?.(r),t.onCell({colStart:0,colEnd:0,rowStart:0,rowEnd:0},e?e[0]?.[0]:null,S,w=>{const b=o(w);return delete b.backgroundColor,b},g),t.onDone?.(),!0}if(g?.textContent){const p=g.textContent.replace(/^"|"$/gi,"");return t.onStart?.(r),t.onNoTable?.(p,o,g),t.onDone?.(),!0}}}catch(a){console.warn(a),n=null}!n||n.length!==0&&(n.length!==1||n[0]!==null&&n[0].length!==0)||(n=null);const i=e&&(e.length===0||e.length===1&&(e[0]===null||e[0].length===0));n&&i&&(e=null);const l=a=>{const c=new Set;let u=1,d=1;for(let h=0;h<Math.max(e?e.length:0,n?n.length:0);h++){let f=0,g=0,m=n&&n[h]?n[h].length:e[h]?e[h].length:0;for(;g<m;){const p=h+"-"+f;if(!c.has(p)){u=Math.max(u,f+1),d=Math.max(d,h+1);let S=null;const w=n?n[h]?.[g]?.element:void 0;if(w&&(w.getAttribute("rowspan")||w.getAttribute("colspan"))){const b=parseInt(w.getAttribute("colspan"))||1,C=parseInt(w.getAttribute("rowspan"))||1;u=Math.max(u,f+b),d=Math.max(d,h+C),S={rowStart:h,colStart:f,rowEnd:h+Math.max(0,C-1),colEnd:f+Math.max(0,b-1)};for(let _=h;_<h+C;_++)for(let y=f;y<f+b;y++)_===h&&y===f||c.add(_+"-"+y)}else S={rowStart:h,colStart:f,rowEnd:h,colEnd:f};a(S,e?e[h]?.[f]:void 0,n?n[h]?.[g]?.htmlValue:null,o,w||null),g++}f++}}};if(n&&e){let a=0,c=0;l(u=>{a=Math.max(a,u.colEnd+1),c=Math.max(c,u.rowEnd+1)}),e&&n&&(e.length!==c||e[0].length!==a)&&(console.warn("mismatched mimeTypes",e,n),e=null)}return l(t.onCell.bind(t)),t.onDone?.(),!i||n!==null}catch(n){throw console.warn(n),n}};class jv{constructor(e){if(!e)throw new lr("snapshot is required.");this._snapshot=e}getItemType(){return"range"}getItem(){return this._snapshot}editMode(){return this._snapshot?.getMarkOptions().editMode??null}isCut(){return this._snapshot?.getMarkOptions().isCut??!1}getName(){return this._snapshot.getName()}toText(){return this._snapshot.toText()}toHtml(){return this._snapshot.toHtml()}toImage(){return this._snapshot.toImage()}get isClipboardItem(){return!0}}class Gv{constructor(e,t,n,r){if(this._parsed=void 0,!e)throw new lr("nativeItems are required.");this._native=e,this._markOptions=Object.freeze(t??{}),this._styles=n,this._isDate1904=r}getItemType(){return"range"}isCut(){return!1}toText(){return this._native?.text}toHtml(){return this._native?.html?.documentElement.outerHTML||null}toImage(){return this._native?.image}getItem(){const e=this._parsed;if(e===void 0)throw new Error("Must call 'parse()' before getItem().");if(e===null)return null;if(this._snapshot)return this._snapshot;const t=this;return this._snapshot={copyTo:(n,r)=>e.copyTo(n,{...t._markOptions,...r}),getMarkOptions:()=>t._markOptions,getName:()=>e?.getName()??"Clipboard Data",getCoords:()=>e?.getCoords?.()??null,toText:()=>t.toText(),toHtml:()=>t.toHtml(),toImage:()=>t.toImage(),getSource:()=>e?.getSource?.()??null,isISnapshot:!0},this._snapshot}async parse(){let e,t=this._native?.text,n=this._native.html;if(n===null&&t&&t.includes("<table"))try{const r=new DOMParser().parseFromString(t,Ap.html),o=r.querySelector("parsererror");if(o)throw new Pe("Unable to parse: "+o);n=r,t=null}catch{console.warn("Discovered text as html table but could could not parse.")}try{const r=new $v(this._styles,this._isDate1904,n?"HTML":"Text"),o=await Promise.resolve(t?((l,a="	")=>new Promise((c,u)=>{ao(()=>import("./CvVXzwNYb-2OZMBj-CnpeITyJ.js"),__vite__mapDeps([9,1,2,3,4,5,6,7]),import.meta.url).then(d=>d.p).then(d=>{try{const h=d.parse(l,{delimiter:a}).data;h.length>1&&(h[h.length-1].length===0||h[h.length-1].length===1&&h[h.length-1][0].length===0)&&h.pop(),c(h)}catch(h){console.warn(h),u(h)}},d=>{u(d)})}))(t):[[]]);let i;if(Wv(n,o,r)?(e=r.sheet(),i=e.getUsedRange()):n=null,i)return this._parsed={async copyTo(l,a){return(await l.copyFrom(i,a))?.getCoords()??null},getCoords:()=>i.getCoords(),getSource:()=>e,getName:()=>e.getName()},!0}catch(r){throw r}if(!t&&!n&&this._native.image){const r=this;return this._parsed={async copyTo(o,i){const l=o.getSheet(),a=await l.getMovables().addImage({buffer:r._native.image.arrayBuffer()},{type:"picture",description:"Copy Image from Clipboard"});return l.getView().selectMovables([a]),null},getName:()=>"Image"},!0}return!1}get isClipboardItem(){return!0}}var ht;(ht||(ht={})).Visibility={Visible:"visible",Hidden:"hidden",VeryHidden:"veryHidden"};var lo;let Uv=(lo=class extends nc{constructor(e){if(super(e),!e.content)throw new Error("Content type is required");this._content=e.content,this._uuid=P.uuidV4(),this._optionsMovable=e;const t=this;this._optionsMovable.setContainerZIndexCallback?.(()=>{t._processZIndex()}),this._optionsMovable.setContainerSelectionCallback?.((r,o)=>{t._processContainerSelect(r,o)}),e.json&&this._fromJSON(e.json);const n=this._content.addListeners({onDelete:()=>{t._options.deleteFromContainer&&t._options.deleteFromContainer?.()}},{transactional:!0});this._updateState({contentListenerRemove:n},null,[])}getUUID(){return this._uuid}getContent(){return this._content}_processStateChange(e,t,n){super._processStateChange(e,t,n),this._getEmitter().notify("onBoundsChange"),this._getEmitter().notify("onAnyChange")}_processZIndex(){this._getEmitter().notify("onAnyChange")}_processContainerSelect(e,t){this._getEmitter().notify("onSelectionChange")}isSelected(){return this._optionsMovable.isSelected?.()??!1}async scrollIntoView(e){return this._optionsMovable.scrollIntoView?.(e)??!1}async select(e){if(await this._optionsMovable.select?.(e)===!1)return!1;if(e?.autoFocus!==!1){const t=await this._getEmitter().notify("onRequestFocus",{async:!0});if(!t)return!1;for(let n=0;n<t.length;n++)if(t[n]===!1)return!1}return!0}unselect(){const e=this._optionsMovable.isSelected?.()??!1;return this._optionsMovable.unselect?.(),e}_clone(){const e=this.isSelected(),t=this.getZIndex(),n=this._optionsMovable.getMaxBounds,r=this._options.maxRangeCoords,o=this.getContent(),i={beginPersistResource:this._optionsMovable.beginPersistResource,getBoundsAtCoords:this._optionsMovable.getBoundsAtCoords,getCoordsAtBounds:this._optionsMovable.getCoordsAtBounds,isSelected:()=>e,getZIndex:()=>t,getMaxBounds:n,maxRangeCoords:r,transactions:new Hn({transient:!0}),json:this.toJSON(),initialAnchor:this.getAnchorCoords(),content:o},l=new lo(i),a=this._getState();return l._updateState({...a}),l}getSnapshot(e,t){const n=this._optionsMovable.getCoordsAtBounds(e),r=this._getState().offsets;let o=this.getAnchorCoords();if((r.br.x>0||r.br.y>0)&&(o={...o},o.colEnd-=r.br.x>0?1:0,o.rowEnd-=r.br.y>0?1:0),!q.isRangeWithinRange(o,n))return null;const i=this,l=i._clone(),a=Object.freeze({...t});let c=!1;return{async copyTo(u,d){const h={...a,...d};return await l._doCopy(u,h),h.isCut&&!c&&(i.delete(),c=!0),u.bounds},getCoords:()=>l.getBounds(),getSource:()=>l,getName:()=>l.getName(),getMarkOptions:()=>a,toText:()=>l._toText(),toHtml:()=>l._toHtml(),toImage:()=>l._toImage(),isISnapshot:!0}}async _doCopy(e,t){const n=this._optionsMovable.beginPersistResource(),r=this.toJSON(n.toResourceId.bind(n));r.content.json.name=`${this.getName()} (Copy)`;const o=r.content.json;delete r.content;const i=e.movables;if(!i)throw new Error("Movables is required");const l=e.bounds??this.getBounds();try{await i.add({...r,...t,fromResourceId:n.fromResourceId.bind(n),bounds:l,type:this.getContent().getType(),json:o,description:"Copy Movable"})}finally{n.endPersist()}}_toText(){return this.getContent().toText?.()}_toHtml(){return this.getContent().toHtml?.()}_toImage(){return this.getContent().toImage?.()}setName(e){return this._updateState({name:e},{description:"Set Movable Name"},["onNameChange"]),this}getName(){return this.isClosed()?null:this._getState()?.name}setDescription(e){return this._updateState({description:e},{description:"Set Movable Description"}),this}getDescription(){return this.isClosed()?null:this._getState()?.description}setHidden(e=!1){return this._updateState({hidden:e},{description:"Set Movable Visibility"}),this}isHidden(){return this._getState()?.hidden??!1}setLockAspectRatio(e){return this._updateState({lockAspectRatio:e},{description:"Set Lock Aspect Ratio"}),this}isLockAspectRatio(){return this._getState()?.lockAspectRatio??this._optionsMovable.defaultLockAspectRatio??!1}setRotation(e=0){return this._updateState({rotation:e},{description:"Set Movable Rotation"}),this}getRotation(){return this._getState()?.rotation??0}moveToBack(){return this._optionsMovable.moveToBackOnContainer?.(),this}moveBackward(){return this._optionsMovable.moveBackwardOnContainer?.(),this}moveToFront(){return this._optionsMovable.moveToFrontOnContainer?.(),this}moveForward(){return this._optionsMovable.moveForwardOnContainer?.(),this}getZIndex(){return this._optionsMovable.getZIndex?.()??0}setBounds(e,t){if(!e)return this;let n={...this.getBounds(),...e};if(this._optionsMovable.getMaxBounds&&(n={x:Math.max(n.x,this._optionsMovable.getMaxBounds().x),y:Math.max(n.y,this._optionsMovable.getMaxBounds().y),width:Math.min(n.width,this._optionsMovable.getMaxBounds().width),height:Math.min(n.height,this._optionsMovable.getMaxBounds().height)}),n.width<0||n.height<0)throw new Tt;const r=this._updateMovableLocation({bounds:n,anchorType:Xt.Type.Absolute}),o=this._beginCommit(t?.description??"Set Movable Bounds");return this._updateState({offsets:r.offsets,anchor:r.anchor},{description:"Update Movable Bounds"}),this._options.setContainerCoords(r.anchor),this._invalidateBounds(),o.commit(),this}_updateMovableLocation(e){let t=e.offsets??{tl:{x:0,y:0},br:{x:0,y:0}},n=e.anchor??this.getAnchorCoords(),r=e.anchorType??this.getAnchorType();const o=e.bounds??this.getBounds();if(o){if(r===Xt.Type.Absolute){n=this._optionsMovable.getCoordsAtBounds(o);const i=this._optionsMovable.getBoundsAtCoords(n);t={...t,tl:{x:o.x-i.x,y:o.y-i.y}}}if(r===Xt.Type.Absolute||r===Xt.Type.OneCell){const i=this._optionsMovable.getBoundsAtCoords({rowStart:n.rowStart,colStart:n.colStart,colEnd:n.colStart,rowEnd:n.rowStart}),l=this._optionsMovable.getCoordsAtBounds({x:i.x,y:i.y,width:o.width+Math.min(i.width,t.tl.x),height:o.height+Math.min(i.height,t.tl.y)});n={...n,colEnd:l.colEnd,rowEnd:l.rowEnd};const a=this._optionsMovable.getBoundsAtCoords({colStart:n.colEnd,rowStart:n.rowEnd,colEnd:n.colEnd,rowEnd:n.rowEnd}),c=o.width-(a.x-i.x-Math.min(t?.tl.x??0,i.width)),u=o.height-(a.y-i.y-Math.min(t?.tl.y??0,i.height));t={...t,br:{x:c,y:u}}}return t!==e.offsets&&(t.br.y<=0&&(t.br={...t.br,y:0},n.rowEnd--),t.br.x<=0&&(t.br={...t.br,x:0},n.colEnd--)),{anchor:n,offsets:t}}}_calcAbsoluteBounds(e,t={tl:{x:0,y:0},br:{x:0,y:0}}){if(!e)return null;const n=this._optionsMovable.getBoundsAtCoords({rowStart:e.rowStart,colStart:e.colStart,colEnd:e.colStart,rowEnd:e.rowStart});let r=t.br.x?0:1,o=t.br.y?0:1;const i=this._optionsMovable.getBoundsAtCoords({colStart:e.colEnd+r,rowStart:e.rowEnd+o,colEnd:e.colEnd+r,rowEnd:e.rowEnd+o}),l=Math.min(n.x+(t?.tl.x??0),n.x+n.width),a=Math.min(n.y+(t?.tl.y??0),n.y+n.height);return{x:l,y:a,width:Math.min(i.x+(t?.br.x??0),i.x+i.width)-l,height:Math.min(i.y+(t?.br.y??0),i.y+i.height)-a}}getBounds(){return this._getState()?.bounds}setAnchorType(e){return P.validEnumValue(Xt.Type,e),this._updateState({anchorType:e},{description:"Set Movable Resize Behavior"},["onAnchorTypeChange"]),this}_processContainerShift(e){const t=this.getAnchorType(),n=this._getState()?.offsets;let r=n,o=!1;const i=e.before,l=e.orientation===B.Orientation.Column,a=e.intersect,c=e.amount;let u=e.after;if(t!==Xt.Type.Absolute){let f=l?a.colStart:a.rowStart,g=l?i.colStart:i.rowStart;t===Xt.Type.TwoCell&&(g=l?i.colEnd:i.rowEnd),o=f<=g}if(o&&(t!==Xt.Type.OneCell||u)||(u=i),o&&u&&c<0&&(l?(a.colStart<=i.colStart&&a.colEnd>=i.colStart&&(r={...r,tl:{...r.tl,x:0}}),r.br.x>0&&a.colStart<=i.colEnd&&a.colEnd>=i.colEnd&&(r={...r,br:{...r.br,x:0}},u={...u,colEnd:u.colEnd+1})):(a.rowStart<=i.rowStart&&a.rowEnd>=i.rowStart&&(r={...r,tl:{...r.tl,y:0}}),r.br.y>0&&a.rowStart<=i.rowEnd&&a.rowEnd>=i.rowEnd&&(r={...r,br:{...r.br,y:0}},u={...u,rowEnd:u.rowEnd+1}))),u!==null){const{offsets:f,anchor:g}=this._updateMovableLocation({anchor:u,offsets:r});r=f,u=g}let d=null;const h=this._beginCommit("Shifting Movable Bounds");try{if(n!==r||!q.isEqualRanges(i,u)){const f={offsets:r,anchor:u};this._updateState(f)}this._invalidateBounds(),d=super._processContainerShift({...e,after:u}),h.commit()}catch(f){throw h.rollback(),f}return d}_invalidateBounds(){const e=this.getAnchorCoords();if(e===null)return null;const t=this._getState()?.offsets,n=this._calcAbsoluteBounds(e,t);this._updateState({bounds:n},null,["onBoundsChange"])}_processContainerDelete(){super._processContainerDelete(),this._getState().contentListenerRemove?.(),this.getContent().delete()}_processContainerLayout(){const e=this.getAnchorCoords(),t=this._getState()?.offsets,{offsets:n,anchor:r}=this._updateMovableLocation({anchor:e,offsets:t}),o=this._beginCommit("Updating Movable Bounds");try{if(t!==n||e!==r){const i={offsets:n,anchor:r};this._updateState(i)}this._invalidateBounds(),super._processContainerLayout(),o.commit()}catch(i){throw o.rollback(),i}}_processAnchorCoords(){super._processAnchorCoords()}_fromJSON(e){const t={tl:{x:0,y:0},br:{x:0,y:0}},n={...q.EmptyRange};e.anchor&&(t.tl.x=e.anchor.tl?.x??0,t.tl.y=e.anchor.tl?.y??0,t.br.x=e.anchor.br?.x??0,t.br.y=e.anchor.br?.y??0,n.colStart=e.anchor.tl?.c??0,n.rowStart=e.anchor.tl?.r??0,n.colEnd=Math.max(n.colStart,(e.anchor.br?.c??0)+(t.br.x>0?0:-1)),n.rowEnd=Math.max(n.rowStart,(e.anchor.br?.r??0)+(t.br.y>0?0:-1)));const r=this._beginCommit("Load Movable"),o=e.content.json,i={offsets:t,name:o.name??null,description:o.name??null,hidden:o.hidden??!1,rotation:o.rotation??0,lockAspectRatio:o.lockAspect??null};e.anchorType&&(i.anchorType=e.anchorType),i.name||(i.name=`${this._content.getTypeDescription()} ${++lo.instanceCounter}`),i.bounds=this._calcAbsoluteBounds(n,t),this._updateState(i,{description:"Load Movable"}),this._optionsMovable.setContainerCoords?.(n),r.commit()}toJSON(e){const t=this._getState(),n=t.anchor,r=t.offsets,o={tl:{c:n.colStart,r:n.rowStart},br:{c:n.colEnd+(r.br.x?0:1),r:n.rowEnd+(r.br.y?0:1)}};r&&(r.tl?.x&&(o.tl.x=P.roundAccurately(r.tl.x,1)),r.tl?.y&&(o.tl.y=P.roundAccurately(r.tl.y,1)),r.br?.x&&(o.br.x=P.roundAccurately(r.br.x,1)),r.br?.y&&(o.br.y=P.roundAccurately(r.br.y,1)));const i=this._content.toJSON(e)??{},l={anchor:o,content:{type:this._content.getType(),json:i}},a=t.anchorType;return a&&a!==Xt.Type.TwoCell&&(l.anchorType=this.getAnchorType()),t.hidden&&(l.hidden=t.hidden),t.name&&(l.name=t.name),t.description&&(l.name=t.description),t.rotation!==void 0&&t.rotation!==0&&(l.rotation=t.rotation),P.isDefined(t.lockAspectRatio)&&t.lockAspectRatio!==this._optionsMovable.defaultLockAspectRatio&&(l.lockAspect=t.lockAspectRatio),l}get isIMovable(){return!0}},lo.instanceCounter=0,lo);class qv{constructor(e,t,n,r,o,i){this._add=e,this._getItems=t,this._getCount=n,this._updateSelected=r,this._addListeners=o,this._addImage=i}async add(e){return this._add(e)}getItems(e){return this._getItems(e)}getCount(){return this._getCount()}updateSelected(e,t){return this._updateSelected(e,t)}addListeners(e,t){return this._addListeners(e,t)}addImage(e,t){return this._addImage(e,t)}}const Mu={transactional:!0,ignoreDataChanges:!0};class _m extends j0{constructor(e){super({...e,type:"namedReference"});const t=this;this._listener=r=>{const o=this._getState().ranges;let i=r.getSource(),l=!1;const a={ranges:i};if(r.trigger==="moveCells"){const h=t._getState(),f=r.getTo(),g=r.getFrom(),m=[],p=o.getCount(),S=g.getCount();for(let C=0;C<p;C++){const _=o.at(C);if(m.push(_.getCoords()),!_.isInvalid()){for(let y=0;y<S;y++){const v=g.at(y).getCoords(),x=_.getCoords();if(!q.isRangeWithinRange(x,v))continue;const E=f.getCoords(),R=E.colStart-v.colStart+x.colStart,I=E.rowStart-v.rowStart+x.rowStart,A={...x,colStart:R,rowStart:I,colEnd:R+(x.colEnd-x.colStart),rowEnd:I+(x.rowEnd-x.rowStart)};(f.size!==1||q.isRangeWithinRange(A,E))&&(m[C]=f.getSheet().getRange(A).getCoords(),l=!0)}if(!l)return}}const w=this._options.addressToRanges(m);let b;h.removeListener?.(),w.isInvalid()||(b=w.addListener(t._listener,Mu)),a.ranges=w,a.removeListener=b}this._updateState(a,null,["onRangesChange"]);const c=i.getCoords();let u=!c||c.length===0;const d=c.length;for(let h=0;!u&&h<d;h++)if(!c[h]){u=!0;break}u&&t.delete()};const n=e.value;if(n&&!n.isInvalid()){const r=n.addListener(this._listener,Mu);this._updateState({ranges:n,removeListener:r},null)}}setReference(e){const t=this._options.addressToRanges(e);if(t&&!t.isInvalid()){this._getState().removeListener?.();const n=t.addListener(this._listener,Mu);this._updateState({ranges:t,removeListener:n},null)}return null}async select(e){return await this._getState().ranges.select(e),this}getRanges(){return this._getState().ranges}setHidden(e=!1,t){return this._updateState({hidden:e},{description:"Set Hidden",...t},[]),this}setScope(e,t){return this._updateState({scope:e},{description:"Set Scope",...t},[]),this}getType(){return"reference"}getValue(){return this._getState().ranges}toJSON(){const e=super._toJSON();return e.ref=this._getState().ranges.toString(),e}_getDescription(){return`Named '${this.getName()}'`}_processDelete(){const e=this._getState();e&&e.removeListener?.(),super._processDelete()}get[Symbol.toStringTag](){return"[NamedReference]"}toString(){return this._getDescription()}}const ym="Item must be specified.",bm="Name must be a non-empty string",Cm=(s,e=null)=>`Named item '${s}' already exists${e?`in scope ${e}`:""}.`,vm=s=>{const e=[];for(let t=0;t<s.getCount();t++){let n=null;try{n=s.at(t),n.isICellRange&&(n=n.getFixed(!0))}catch(r){cs.warn("Invalid range",r)}e.push(n?n.toString().toLowerCase():tn)}return e.sort(),e.join(",")},Jv=/^[^a-zA-Z_\\]+$/,Kv=/^[^a-zA-Z0-9_.]+$/;class HS{constructor(e){this._emitter=null,this._closed=!1,this._lastLookup=P.EmptyArray,this._lastLookupAddress=null,this._lastLookupScope=null,this._lastLookupType=null,this._allowExtrudes=!1,this._options={...e};const t=this;this._transactions=this._options.transactions??new Hn({transient:!0}),this._transactionsRemoveListener=this._transactions.addStateListener(this,{onAfterStateChange(n,r,o){r?.initial||t._emitter.notify("onCollectionChange")}}),this._emitter=new gn(this,this._transactions),this._initState(),this._fromJSON(this._options?.json)}getItems(e){if(this.isClosed())return P.EmptyArray;const t=this._getState();if(!t)return P.EmptyArray;const n=t.itemsSpatial;if(n.isEmpty())return P.EmptyArray;if(e&&e.address===this._lastLookupAddress&&e.scope===this._lastLookupScope&&e.type===this._lastLookupType&&e.allowExtrudes===this._allowExtrudes)return this._lastLookup;this._lastLookupAddress=e?.address??void 0,this._lastLookupScope=e?.scope??void 0,this._lastLookupType=e?.type??void 0,this._allowExtrudes=e?.allowExtrudes??void 0;let r=null;if(e?.address){const u=this._options.addressToRanges(e?.address);if(!u)return cs.debug("Invalid range",{details:e?.address}),this._lastLookup=null,null;r=u.getCoords()}let o=null;if(r){o=[];for(let u=0;u<r.length;u++){const d=n.search(r[u]),h=d.length;for(let f=0;f<h;f++)o.push(d[f])}}else o=n.all();if(!o||o.length===0)return this._lastLookup=P.EmptyArray,P.EmptyArray;const i=new Set,l=new Set;o.forEach(u=>{const d=u.value;if(!e?.type||d.getType()===e.type){if(r&&!e?.allowExtrudes){const h=d.getRanges?.();if(!h||h.getCount()===0)return;for(let f=0;f<r.length;f++)if(!q.isRangeWithinRange(u,r[f]))return}!e?.scope||d.getScope()!==e.scope&&e.scope!=="all"?d.getScope()||l.add(d):i.add(d)}});const a=new Map;l.forEach(u=>{a.set(u.getName(),u)}),i.forEach(u=>{a.set(u.getName(),u)});let c=[];return a.forEach(u=>{c.push(u)}),c=c.sort((u,d)=>{let h=u.getType().localeCompare(d.getType());return h!==0?h:u.getName().localeCompare(d.getName())}),this._lastLookup=c,c}lookupByRanges(e){const t=this._options.addressToRanges(e);if(!t||t.getCount()===0)return null;const n=this._getState();if(!n||n.itemsByKey.size===0)return null;const r=vm(t),o=n.itemsByFullRange.get(r);if(!o)return null;const i=[];return o.forEach(l=>{const a=n.itemsByKey.get(l);a&&i.push(a.item)}),i.length>0?i:null}getByName(e,t=!1){if(!e)return null;const n=this._getState();if(!n||n.itemsByKey.size===0||typeof e!="string")return null;const r=e.toLowerCase(),o=this._options.getCurrentScope();if(!t&&o){const i=r+":"+o.toLowerCase(),l=n.itemsByKey.get(i);if(l)return l.item}return n.itemsByKey.get(r)?.item??null}getCount(){const e=this._getState();return e?e.itemsByKey.size:0}getRanges(e){const t=this._options.addressToRanges(e),n=[];for(let r=0;r<t.getCount();r++){const o=t.at(r).getFixed(!0).getCoords();n.push(o)}return this._options.addressToRanges(n)}findValidName(e,t=null,n=!1){if(!e)throw new Error("A template string must be specified.");const r=this,o=i=>{try{return r._validateName(i,t,n),!0}catch{}return!1};return o(e)?e:h0(e,o)}validateName(e,t=null,n=!1){return this._validateName(e,t,n)}_validateName(e,t,n=!1){if(this._closed)throw new Error(Xn);if(!e||e.length===0)throw new Error(bm);if(e.length>255)throw new Error("Name must not exceed 255 characters.");if(e.indexOf(" ")!==-1)throw new Error("Name must not contain any spaces.");const r=e.trim().toLowerCase(),o=r.substring(1,e.length-1);if(new RegExp(Jv).test(r[0]))throw new Error("First letter must be either a letter, an underscore, or a backslash.");if(new RegExp(Kv).test(o))throw new Error("Name must be either letters, numbers, periods or underscores.");if(r.length===1&&(r[0]==="r"||r[0]==="c"))throw new Error("Name can not be 'r' or 'c'.");if(((a,c=ab,u=nS,d=!1)=>{let h=lS(a,d);if(!h||h[2]||!h[1])return!1;const f=pd(a,Sd);if(!f)return!1;const g=f.rowIndex;if(g<0||g>c)return!1;const m=f.colIndex;return!(m<0||m>=u)})(e))throw new Error("Name can not be an address.");let i=e.toLowerCase()?.trim();t&&(i=i+":"+t.toLowerCase());const l=this._getState()?.itemsByKey.get(i);if(l){const a=l.item.getRanges();if(!n||a||a.getCount()>0)throw new Error(Cm(e,t))}}addReference(e,t,n=!1){const r=this._options.addressToRanges(t),o=this.getByName(e);let i=null;const l=this._beginCommit(`${o&&n?"Update":"Insert"} Named '${e}'`);try{if(o){if(!n)throw new Error(Cm(e));this._delete(o,{description:`Delete Named '${o.getName()}'`})}i=new _m({value:r,addressToRanges:this._options.addressToRanges,json:{name:e,ref:r.toString()},transactions:this._transactions}),this.add(i),l.commit()}catch(a){throw l.rollback(),a}return i}add(e){if(this._closed)throw new Error(Xn);if(!e)throw new Error(ym);if(!e.getName||typeof e=="string")throw new Error("Add must take a 'INamed' object. To add a string use 'addReference'.");if(this._validateName(e.getName(),e.getScope(),!1),this._options.isReadOnly?.())throw new Error("Names are read-only.");const t=this._beginCommit(`Insert Named Item '${e.getName()}'`),n=this._add([e]);if(n===null)return t.rollback(),null;const r=n.itemsByKey.get(e.getName().toLowerCase());return this._updateState(o=>({...o,...n})),t.commit(),r?.item??null}_toKey(e){let t=e.getName().toLowerCase();return t.startsWith("_xlnm.")&&(t=t.substring(6)),e.getScope()?t+":"+e.getScope().toLowerCase():t}_delete(e,t){if(!e)throw new Error(ym);if(this._closed)throw new Error(Xn);const n=this._beginCommit(t?.description??`Delete Named Item '${e.getName()}'`);let r=null;try{const o=this._getState()?.itemsByKey,i=this._toKey(e);if(r=o.get(i),!r)throw new Error(`Item '${e.getName()}' does not exist.`);const l=this._cloneState();this._index(i,null,l),this._updateState(a=>({...a,...l})),n.commit()}catch(o){throw n.rollback(),o}return this._emitter.notify("onCollectionChange"),r.item}_cloneState(){const e=this._getState();return{itemsBySource:new Map(e.itemsBySource),itemsByKey:new Map(e.itemsByKey),itemsSpatial:e.itemsSpatial.clone(),itemsByFullRange:new Map(e.itemsByFullRange),itemsByPartialRange:new Map(e.itemsByPartialRange)}}_index(e,t,n){const r=n.itemsByKey.get(e);if(r){const i=r.asPartialRanges;if(i)for(let a=0;a<i.length;a++){const c=n.itemsByPartialRange.get(i[a]);if(c)if(c.size===1)n.itemsByPartialRange.delete(i[a]);else{const u=new Set(c);u.delete(e),n.itemsByPartialRange.set(i[a],u)}}const l=r.asFullRange;if(l){const a=n.itemsByFullRange.get(l);if(a)if(a.size===1)n.itemsByFullRange.delete(l);else{const c=new Set(a);c.delete(e),n.itemsByFullRange.set(l,c)}}if(r.nodes)for(let a=0;a<r.nodes.length;a++)n.itemsSpatial.remove(r.nodes[a]);r.unwatch?.(),n.itemsByKey.delete(e),n.itemsBySource.delete(r.item)}let o=null;if(t){let i=[],l=null,a=null;o=t.getRanges?.();const c=this._toKey(t);if(o){const{asFullRange:f,asPartialRanges:g,asRanges:m}=(p=>{const S=p.getCoords(),w=vm(p),b=w.split(",");return{asFullRange:w,asPartialRanges:b,asRanges:S}})(o);if(l=f,a=g,m){for(let p=0;p<g.length;p++){let S=n.itemsByPartialRange.get(g[p]);const w=S?new Set(S):new Set;w.add(c),n.itemsByPartialRange.set(g[p],w),i.push({...m[p],value:t})}if(n.itemsSpatial.load(i),f){let p=n.itemsByFullRange.get(f);const S=p?new Set(p):new Set;S.add(c),n.itemsByFullRange.set(f,S)}}}const u=this,d=t.addListeners({onDelete:f=>{u._delete(f)},onAnyChange:f=>{const g=u._beginCommit(`Update Named '${f.getName()}'`);try{const m=u._cloneState(),p=m.itemsBySource.get(f).globalKey;u._index(p,f,m),u._updateState(S=>({...S,...m})),g.commit()}catch(m){throw g.rollback(),m}}},{transactional:!0}),h={item:t,asFullRange:l,asPartialRanges:a,unwatch:d,nodes:i,globalKey:c};n.itemsByKey.set(c,h),n.itemsBySource.set(t,h)}}_add(e){if(this._closed)throw new Error(Xn);const t=this._getState();if(!e)return t;const n=this._cloneState(),r=e.length;for(let o=0;o<r;o++){const i=e[o];if(!i.getName())throw new Error(bm);const l=this._toKey(i);try{this._index(l,i,n)}catch(a){cs.warn(`Unable to add named item '${l}'.`,{details:a?.message})}}return n}beginCommit(e){return this._beginCommit(e)}_getState(){if(this._closed)throw new Error(Xn);return this._transactions.getState(this)}_beginCommit(e){return this._transactions.beginCommit(typeof e=="string"?{description:e}:e)}_updateState(e,t="Update"){if(!e)return;this._lastLookup=P.EmptyArray,this._lastLookupAddress=null,this._lastLookupType=null,this._lastLookupScope=null;const n=this._beginCommit(t);try{n.updateState(this,e),n.commit()}catch(r){throw n.rollback(),r}}fromJSON(e){if(this._closed)throw new Error(Xn);this._fromJSON(e)}_initState(){this._updateState(e=>({...e,items:new Set,itemsByKey:new Map,itemsSpatial:new yt,itemsByFullRange:new Map,itemsByPartialRange:new Map}))}_fromJSON(e){const t=this._beginCommit("Load Names");try{if(e){const n=[],r=e.length;for(let i=0;i<r;i++){const l=e[i];try{const a=this._options.addressToRanges(l.ref),c=new _m({value:a,addressToRanges:this._options.addressToRanges,deleteFromContainer:u=>{this._delete(c,u)},json:l,transactions:this._transactions});n.push(c)}catch(a){cs.warn(`Unable to load named item '${l.name}'.`,{details:a?.message})}}const o=this._add(n);this._updateState(i=>({...i,...o}))}t.commit({viewAfter:{initial:!0}})}catch(n){throw t.rollback(),n}}toJSON(){const e=this._getState();if(!e||e.itemsByKey.size===0)return null;const t=[],n=Array.from(e.itemsByKey.keys()).sort(),r=n.length;for(let o=0;o<r;o++){const i=e.itemsByKey.get(n[o]).item,l=i.toJSON?.();l&&t.push(l)}return t.length===0?null:t}addListeners(e,t){return this._emitter.addListeners(e,t)}isClosed(){return this._closed}close(){this._closed||(this._emitter.notify("onClose"),this._closed=!0,this._transactionsRemoveListener?.())}get isNamedCollection(){return!0}}class Xv extends Fo{constructor(e){super(e),e.json&&this._updateState({data:e.json})}getType(){return"chart"}getDescription(){return`Chart: ${this._getState()?.data?.types?.[0]?.type??"unknown"}`}toJSON(e){const t=this._getState();let n=null;return t&&t.data&&(n=t.data),n}getTypeDescription(){return"Chart"}}class Zv extends Fo{constructor(e){super(e),e.json&&this._updateState({data:e.json})}getType(){return"shape"}getDescription(){return`Shape: ${this._getState()?.data}`}toJSON(e){const t=this._getState();let n=null;return t&&t.data&&(n=t.data),n}getTypeDescription(){return"Shape"}get[Symbol.toStringTag](){return"[Shape]"}toString(){return this.getTypeDescription()}}class Qv extends Fo{constructor(e){super(e),e.json&&this._updateState({data:e.json})}getType(){return"custom"}getDescription(){return`CustomElement: ${this._getState()?.data}`}toJSON(e){const t=this._getState();let n=null;return t&&t.data&&(n=t.data),n}getTypeDescription(){return"CustomElement"}}const xm=(s,e,t=!0,n=!0)=>{let r=0,o=0;if(!t&&!n)return{x:r,y:o};let i=!1,l=0;do{const a={x:e.x+r,y:e.y+o,width:0,height:0},c=s.getItems({bounds:a});if(i=!1,c.length>0){for(let u=0;!i&&u<c.length;u++){const d=c[u].getBounds();d.x===a.x&&d.y===a.y&&(i=!0)}i&&(r+=t?16:0,o+=n?16:0)}}while(i&&++l<100);return{x:r,y:o}};class Yv{constructor(e,t,n){this._add=e,this._get=t,this._getByName=n}add(e,t){if(!e)throw new Error(Rd);return this._add(e,t)}getItems(e){if(e&&e.name&&Object.keys(e).length===0)return[this._getByName(e.name)];let t;e?.address&&(t=e.address);const n=this._get(t,e?.ignoreHidden,e?.fullyContained);if(e?.name){const r=e.name.toLocaleLowerCase();for(let o=0;o<n.length;o++)if(n[o].getName().toLocaleLowerCase()===r)return[n[o]]}return n}getByName(e){if(typeof e!="string")throw new Error("Get by name must take a valid name.");return this._getByName(e)}getCount(){return this._get(null,!1,!1).length}}const xn=(s,e,t)=>{if(!s)return e;let n=e;const r=t===B.Direction.Right||t===B.Direction.Down;for(;;){const o=s(n,!r);if(o===0)return n;r?n+=o:n-=o}},ex=Object.freeze({colIndex:0,rowIndex:0}),kd=Object.freeze([]),Ba=Object.freeze({cell:q.EmptyCell,ranges:kd,rangeIndex:-1}),$S=(s,e,t)=>{if(!s)return Ba;let n=e.cell;const r=t.colStart,o=t.rowStart,i=t.colEnd,l=t.rowEnd;q.isEqualCells(n,s?.cell)||(n=Object.freeze({colIndex:Math.max(r,Math.min(s?.cell?.colIndex??e.cell?.colIndex??0,i)),rowIndex:Math.max(o,Math.min(s?.cell?.rowIndex??e?.cell?.rowIndex??0,l))}));const a=s?.ranges?[...s.ranges]:[];let c=!1;const u=a.length;let d=u===0;for(let g=0;g<u;g++){const m=a[g];a[g]=Object.freeze({colStart:Math.max(r,Math.min(m.colStart,i)),rowStart:Math.max(o,Math.min(m.rowStart,l)),colEnd:Math.max(r,Math.min(m.colEnd,i)),rowEnd:Math.max(o,Math.min(m.rowEnd,l))}),d=d||q.isCellWithinRange(n,m),c=c||Object.keys(m).length>4}let h=e?.ranges??[];!c&&q.isEqualRangesArrays(h,a)||(h=a);let f=s?.rangeIndex??e?.rangeIndex??Ba.rangeIndex;if(f=Math.max(-1,Math.min(f,h.length-1)),!d){const g=h[f];let m=n.rowIndex;m<g.rowStart?m=g.rowStart:m>g.rowEnd&&(m=g.rowEnd);let p=n.rowIndex;p<g.colStart?p=g.colStart:p>g.colEnd&&(p=g.colEnd),n=Object.freeze({colIndex:p,rowIndex:m})}return Object.freeze({cell:n,ranges:h,rangeIndex:f})},VS=(s,e=B.Direction.Right,t,n,r,o=null)=>{if(o&&q.isEqualSelectionCoords(o,s))return s;const i=s.ranges[s.rangeIndex];if(!q.isRangesIntersect({rowStart:s.cell.rowIndex,colStart:s.cell.colIndex,rowEnd:s.cell.rowIndex,colEnd:s.cell.colIndex},i))return s;let l={...s.cell},a=s.rangeIndex;switch(e){case B.Direction.Right:l.colIndex=xn(r,l.colIndex+1,e);break;case B.Direction.Left:l.colIndex=xn(r,l.colIndex-1,e);break;case B.Direction.Down:l.rowIndex=xn(n,l.rowIndex+1,e);break;case B.Direction.Up:l.rowIndex=xn(n,l.rowIndex-1,e)}const c=h=>{if(h){a=s.rangeIndex>=s.ranges.length-1?0:s.rangeIndex+1;const f=s.ranges[a];l={colIndex:f.colStart,rowIndex:f.rowStart}}else{a=s.rangeIndex<=0?s.ranges.length-1:s.rangeIndex-1;const f=s.ranges[a];l={colIndex:f.colEnd,rowIndex:f.rowEnd}}};if(e===B.Direction.Right&&l.colIndex>i.colEnd&&l.rowIndex===i.rowEnd)c(!0);else if(e===B.Direction.Left&&l.colIndex<i.colStart&&l.rowIndex===i.rowStart)c(!1);else if(e===B.Direction.Down&&l.colIndex===i.colEnd&&l.rowIndex>i.rowEnd)c(!0);else if(e===B.Direction.Up&&l.colIndex===i.colStart&&l.rowIndex<i.rowStart)c(!1);else{let h=l.rowIndex,f=l.colIndex;switch(e){case B.Direction.Right:f>i.colEnd&&(h=xn(n,h+1,e),f=i.colStart,h>i.rowEnd&&(h=i.rowStart));break;case B.Direction.Left:f<i.colStart&&(h=xn(n,h-1,e),f=i.colEnd,h<i.rowStart&&(h=i.rowEnd));break;case B.Direction.Down:h>i.rowEnd&&(f=xn(r,f+1,e),h=i.rowStart,f>i.colEnd&&(f=i.colStart));break;case B.Direction.Up:h<i.rowStart&&(f=xn(r,f-1,e),h=i.rowEnd,f<i.colStart&&(f=i.colEnd))}l={rowIndex:h,colIndex:f}}let u=t(l);if(!q.isRangeWithinRange(u,i)){const h=q.intersectRanges(u,i);h&&(u=h)}let d={rowStart:xn(n,u.rowStart,B.Direction.Down),colStart:xn(r,u.colStart,B.Direction.Right),rowEnd:xn(n,u.rowEnd,B.Direction.Up),colEnd:xn(r,u.colEnd,B.Direction.Left)};if(d.rowStart!==l.rowIndex||d.colStart!==l.colIndex){switch(e){case B.Direction.Right:s.ranges[a].colStart===d.colStart&&s.ranges[a].colEnd===d.colEnd&&(l.rowIndex=d.rowEnd),l.colIndex=d.colEnd;break;case B.Direction.Left:s.ranges[a].colStart===d.colStart&&s.ranges[a].colEnd===d.colEnd&&(l.rowIndex=d.rowStart),l.rowIndex===d.rowStart?l.colIndex=d.colStart+1:l.colIndex=d.colStart;break;case B.Direction.Down:s.ranges[a].rowStart===d.rowStart&&s.ranges[a].rowEnd===d.rowEnd&&(l.colIndex=d.colEnd),l.rowIndex=d.rowEnd;break;case B.Direction.Up:s.ranges[a].rowStart===d.rowStart&&s.ranges[a].rowEnd===d.rowEnd&&(l.colIndex=d.colStart),l.colIndex===d.colStart?l.rowIndex=d.rowStart+1:l.rowIndex=d.rowStart}return o&&console.warn("call recursive > 1"),VS({cell:l,ranges:s.ranges,rangeIndex:a},e,t,n,r,o??s)}return{ranges:s.ranges,cell:l,rangeIndex:a}},Rt=(s,e,t=-1)=>{if(!s||s.length===0)return null;const n=s[0],r=s.length===1&&n.rowStart===n.rowEnd&&n.colStart===n.colEnd,o=t===-1?s.length-1:Math.min(Math.max(0,t),s.length-1);if(!e){const i=s[o];e={rowIndex:i.rowStart,colIndex:i.colStart}}return{cell:e,ranges:r?P.EmptyArray:[...s],rangeIndex:r?-1:o}};class tx{constructor(e){this._adjusting=null,this._emitter=null,this._coords=Ba,this._sheet=e.sheet,this._emitter=new gn(this);const t=e.sheet;this._adjusting=null,this._hiddenRowsAt=(n,r)=>t.getRowHeaders().hiddenHeadersAt(n,r),this._hiddenColumnsAt=(n,r)=>t.getColumnHeaders().hiddenHeadersAt(n,r),this._getCellCoordsAsRangeCoords=n=>{const r=q.cellToRange(n);if(t.isClosed())return r;const o=t.getRange(r,{ignoreHidden:!0}).getMerges();return o.length===0?r:o[0]},this._canSelectionSpanMergedCells=n=>{const r=t.getRange(n);return r.isEntireColumns()||r.isEntireRows()},this._getMergedRanges=n=>t.getRange(n,{ignoreHidden:!0}).getMerges(),this._isContentfulCell=()=>!1,this._contentfulCellFinder=(n,r,o,i,l,a)=>{const c=t.getSelectedRange().getExtended(i,n).getCoords();switch(i){case B.Direction.Up:return c.rowStart;case B.Direction.Down:return c.rowEnd;case B.Direction.Left:return c.colStart;case B.Direction.Right:return c.colEnd}},this._scrollCellCoordsIntoView=(n,r)=>t.scrollTo(n,r?{scroll:r}:void 0),this._selectionPolicy=e.selectionPolicy??"multiple",this._newSelectionMode=e.newSelectionMode??"clear"}navigate(e,t=!1,n=!1,r=0){const o=this._coords;if(!o.cell)return this;let i=o.cell,l=o.cell;if(t&&o.ranges.length>0){const w=o.ranges[o.rangeIndex],b=o.cell;switch(e){case B.Direction.Up:l={rowIndex:b.rowIndex===w.rowStart?w.rowEnd:w.rowStart,colIndex:w.colEnd},i={rowIndex:b.rowIndex===w.rowStart?w.rowStart:w.rowEnd,colIndex:w.colStart};break;case B.Direction.Down:l={rowIndex:b.rowIndex===w.rowEnd?w.rowStart:w.rowEnd,colIndex:w.colEnd},i={rowIndex:b.rowIndex===w.rowEnd?w.rowEnd:w.rowStart,colIndex:w.colStart};break;case B.Direction.Left:l={rowIndex:w.rowEnd,colIndex:b.colIndex===w.colStart?w.colEnd:w.colStart},i={rowIndex:w.rowStart,colIndex:b.colIndex===w.colStart?w.colStart:w.colEnd};break;case B.Direction.Right:l={rowIndex:w.rowEnd,colIndex:b.colIndex===w.colEnd?w.colStart:w.colEnd},i={rowIndex:w.rowStart,colIndex:b.colIndex===w.colEnd?w.colEnd:w.colStart}}}const a=this._getCellCoordsAsRangeCoords(l);let{rowStart:c,colStart:u}=a;const d=this._magicCell;if(d)switch(e){case B.Direction.Up:case B.Direction.Down:d.colIndex>=a.colStart&&d.colIndex<=a.colEnd&&(u=d.colIndex);break;case B.Direction.Left:case B.Direction.Right:d.rowIndex>=a.rowStart&&d.rowIndex<=a.rowEnd&&(c=d.rowIndex)}if(!r){const w=this._getMaxRange();switch(e){case B.Direction.Up:c=xn(this._hiddenRowsAt,Math.max(a.rowStart-1,w.rowStart??0),e);break;case B.Direction.Down:c=xn(this._hiddenRowsAt,Math.min(a.rowEnd+1,w.rowEnd??Number.MAX_SAFE_INTEGER),e);break;case B.Direction.Left:u=xn(this._hiddenColumnsAt,Math.max(a.colStart-1,w.colStart??0),e);break;case B.Direction.Right:u=xn(this._hiddenColumnsAt,Math.min(a.colEnd+1,w.colEnd??Number.MAX_SAFE_INTEGER),e)}if(n){const b=this._getMaxRange();let C=0;switch(e){case B.Direction.Up:C=b.rowStart??0,c=this._contentfulCellFinder({...l,colIndex:this._coords.cell.colIndex},this._isContentfulCell,this._hiddenRowsAt,e,!1,Math.max(C,this._hiddenRowsAt(C,!1)));break;case B.Direction.Down:C=b.rowEnd??Number.MAX_SAFE_INTEGER,c=this._contentfulCellFinder({...l,colIndex:this._coords.cell.colIndex},this._isContentfulCell,this._hiddenRowsAt,e,!1,Math.min(C,C-this._hiddenRowsAt(C,!0)));break;case B.Direction.Left:C=b.colStart??0,u=this._contentfulCellFinder({...l,rowIndex:this._coords.cell.rowIndex},this._isContentfulCell,this._hiddenColumnsAt,e,!1,Math.max(C,this._hiddenColumnsAt(C,!1)));break;case B.Direction.Right:C=b.colEnd??Number.MAX_SAFE_INTEGER,u=this._contentfulCellFinder({...l,rowIndex:this._coords.cell.rowIndex},this._isContentfulCell,this._hiddenColumnsAt,e,!1,Math.min(C,C-this._hiddenColumnsAt(C,!0)))}}}let h=null;r&&(h={});const f={rowIndex:c,colIndex:u},g=this._getCellCoordsAsRangeCoords(f),m={rowIndex:g.rowStart,colIndex:g.colStart};t||(this._magicCell=f);const p=this._firstActiveCoords,S=q.isEqualCells(p,m)&&q.isEqualCells(p,i);if(t&&!S?this.modify(m,i):this.clearAndModify(m),h)this._scrollCellCoordsIntoView(h);else{if(t&&p){const w=this._getMaxRange();if(e===B.Direction.Right&&p.colIndex===w.colEnd||e===B.Direction.Left&&p.colIndex===w.colStart||e===B.Direction.Up&&p.rowIndex===w.rowEnd||e===B.Direction.Down&&p.rowIndex===w.rowStart)return this}e===B.Direction.Left||e===B.Direction.Right?this._scrollCellCoordsIntoView({colStart:f.colIndex}):e!==B.Direction.Up&&e!==B.Direction.Down||this._scrollCellCoordsIntoView({rowStart:f.rowIndex})}return this}getCoords(){return this._coords}getRangesCoords(e){return(t=>{if(!t)return null;const n=[];if(t.ranges&&t.ranges.length>0){const r=Math.max(0,Math.min(t.rangeIndex??0,t.ranges.length));for(let o=r;o<t.ranges.length;o++)n.push(t.ranges[o]);for(let o=0;o<r;o++)n.push(t.ranges[o])}else t.cell&&n.push(q.cellToRange(t.cell));return n})(e??this._coords)}updateCoords(e){const t=this._coords;if(q.isEqualSelectionCoords(t,e))return;const n=$S(e,this._coords,this._getMaxRange());return this._coords=n,this._emitter.notify("onChange"),this}isEntire(){const e=this._coords;if(e.ranges.length===0)return!1;const t=this._getMaxRange(),n=e.ranges,r=n.length;for(let o=0;o<r;o++){const i=n[o];if(!q.isRangeWithinRange(t,i))return!1}return!0}traverse(e=B.Orientation.Row,t=!1){let n=B.Direction.Right;n=e===B.Orientation.Row?t?B.Direction.Left:B.Direction.Right:t?B.Direction.Up:B.Direction.Down;const r=this._coords;if(r.ranges.length===0)return this.navigate(n);const o=this._getCellCoordsAsRangeCoords(r.cell);if(q.isEqualRangesArrays([o],r.ranges))return this.navigate(n);const i=VS(r,n,this._getCellCoordsAsRangeCoords.bind(this),this._hiddenRowsAt.bind(this),this._hiddenColumnsAt.bind(this));this.updateCoords(i)}clear(){this._setSelectionRanges(kd)}modify(e,t,n){if(this._selectionPolicy==="single")return;const r=this._coords,o=this._rangesFromCellOptional(r,e,t??r.cell);if(!o)return;const i=r.rangeIndex;this._setSelectionRanges(l=>l.length?l.map((a,c)=>i===c?o:a):[o]),n&&o&&this._setSelectionCell({colIndex:o.colStart,rowIndex:o.rowStart})}append(e,t=e,n){if(this._selectionPolicy!=="multiple"||!e||this._isCellOutOfBounds(e)||this._isCellOutOfBounds(t))return;const r=this._coords,o=this._cellToRangeActual(e,t);if(!o)return;const i=r.ranges.length>0?[...r.ranges]:[this._cellToRangeActual(r.cell,r.cell)];i.push(o);const l={ranges:i,cell:{rowIndex:o.rowStart,colIndex:o.colStart,...n},rangeIndex:i.length-1};q.isEqualSelectionCoords(l,r)||this.updateCoords(l)}clearAndModify(e,t,n){const r=this._coords;e={...r.cell,...e},t=t??e;const o=this._rangesFromCellOptional(r,e,t);if(!o)return;const i={rowIndex:o.rowStart,colIndex:o.colStart},l={...i,...n},a=this._newSelectionMode;a==="clear"?(this._firstActiveCoords=l,this.clear()):a==="modify"?this.modify(i):this.append(i),this._setSelectionCell(l)}setAdjusting(e){this._adjusting=e,this._emitter.notify("onAdjustingChange")}getAdjusting(){return this._adjusting}addListeners(e,t){return this._emitter.addListeners(e,t)}_setSelectionRanges(e){const t=this._coords;let n=typeof e=="function"?e(t.ranges):e??kd;if(q.isEqualRangesArrays(n,t.ranges))return;let r=Math.max(n.length?0:-1,Math.min(t.rangeIndex,n.length-1)),o=t.cell;r===-1||q.isCellWithinRange(o,n[r])||(o={rowIndex:n[r].rowStart,colIndex:n[r].colStart}),n.length===1&&q.isSingleCell(n[0])&&q.isCellWithinRange(o,n[0])&&(n=[],r=-1);const i={cell:o,ranges:n,rangeIndex:r};q.isEqualSelectionCoords(i,t)||this.updateCoords(i)}_setSelectionCell(e){const t=this._coords,n=e??ex,r=this._getCellCoordsAsRangeCoords(n);if(!q.isSingleCell(r)&&t.ranges.length===0)return this.updateCoords({ranges:[r],rangeIndex:0,cell:n});if(q.isEqualCells(n,t.cell))return;let o=t.ranges,i=t.rangeIndex;t.ranges.length===1&&(q.isSingleCell(t.ranges[0])&&q.isCellWithinRange(n,t.ranges[0])||!q.isCellWithinRange(n,t.ranges[0]))&&(o=[],i=-1);const l={ranges:o,rangeIndex:i,cell:n};return q.isEqualSelectionCoords(l,t)?void 0:this.updateCoords(l)}_isCellOutOfBounds(e){const t=this._getMaxRange();return e.rowIndex<t.rowStart||e.colIndex<t.colStart||e.colIndex>t.colEnd||e.rowIndex>t.rowEnd}_cellToRangeActual(e,t){const n={rowStart:Math.min(e.rowIndex,t.rowIndex),colStart:Math.min(e.colIndex,t.colIndex),rowEnd:Math.max(e.rowIndex,t.rowIndex),colEnd:Math.max(e.colIndex,t.colIndex)};if(this._canSelectionSpanMergedCells(n))return n;const r=this._getCellCoordsAsRangeCoords(e),o=this._getCellCoordsAsRangeCoords(t),i={rowStart:Math.min(r.rowStart,o.rowStart),colStart:Math.min(r.colStart,o.colStart),rowEnd:Math.max(r.rowEnd,o.rowEnd),colEnd:Math.max(r.colEnd,o.colEnd)},l=this._getMergedRanges(i);return q.extendRangeToUnionRanges(i,l)}_rangesFromCellOptional(e,t,n){const r=e.ranges.length>0?e.ranges[e.rangeIndex]:{rowStart:e.cell.rowIndex,colStart:e.cell.colIndex,rowEnd:e.cell.rowIndex,colEnd:e.cell.colIndex},o={rowStart:Math.min(t.rowIndex??r.rowStart,n.rowIndex??r.rowStart),colStart:Math.min(t.colIndex??r.colStart,n.colIndex??r.colStart),rowEnd:Math.max(t.rowIndex??r.rowEnd,n.rowIndex??r.rowEnd),colEnd:Math.max(t.colIndex??r.colEnd,n.colIndex??r.colEnd)},i={rowIndex:o.rowStart,colIndex:o.colStart},l={rowIndex:o.rowEnd,colIndex:o.colEnd};if(!(this._isCellOutOfBounds(i)||this._isCellOutOfBounds(l)))return this._cellToRangeActual(i,l)}_getMaxRange(){return this._sheet.getEntireRange().getCoords()}get[Symbol.toStringTag](){return"[RangeShape]"}toString(){let e="";return e+=`selection:[${this._sheet.getRange(this._coords.cell).toString()}`,this._coords.ranges&&this._coords.ranges.length>0&&(e+=`, ${this._sheet.getRanges(this._coords.ranges).toString()}`),this._coords.rangeIndex!==void 0&&this._coords.rangeIndex!==-1&&(e+=`, ${this._coords.rangeIndex}`),e+="]",e}}let nx=class Fd{constructor(e,t){this._c=e,this._m=t}getModel(){return this._m}getCoords(){return this._c}getPropertiesAt(e,t,n){return this._m.getPropertiesAt(e,t,n)}getSplit(e){const t=this._m;return[new Fd(e[0],t),new Fd(e[1],t)]}};class rx extends Fo{constructor(e){if(super({...e}),this._coordsCache=null,!e.json)throw new Error("json is required");this._sheet=e.sheet,this._styles=e.sheet?.getStyles()??new qi,this._options={...e},e.setOnContainerCoordsChange(this._processCoordsChange.bind(this)),e.setCreateSpatial(this._createSpatial.bind(this)),this._getContainerRanges=e.getContainerRanges,this._setContainerRanges=e.setContainerRanges;const t=this;this._options.transactions.addStateListener(this,{onRestoreOrRevert(){t._coordsCache=null},onBeforeCommitEnd(){t._coordsCache=null}}),this._fromJSON({...e.json})}getRanges(){return this._getContainerRanges()}setRanges(e,t){const n=this.getRanges(),r=this._setContainerRanges(e,t);return this._processCoordsChange({before:n?.getCoords()??null,after:r?.getCoords()??null}),this}setType(e,t){return this._updateState({type:e},{description:"Set Conditional Format Type",...t}),this}getType(){return this._getState().type}setPriority(e,t){return this._updateState({priority:e},{description:"Set Priority",...t}),this}getPriority(){return this._getState().priority}setStopIfTrue(e,t){return this._updateState({stopIfTrue:e},{description:`Set Stop ${e??!1}`,...t}),this}getStopIfTrue(){return this._getState().stopIfTrue??!1}getScalar(){return this._getState().value??null}getColorScale(){return this._getState().colorScale??null}getContainsText(){return this._getState().text}getCustom(){return this._getState().formulas}getDataBar(){return this._getState().dataBar??null}getIconSet(){return this._getState().iconSet}getPresetCriteria(){return this._getState().style}getTopBottom(){return this._getState()}getSnapshot(e){this.toJSON();const t=null,n=this,r=Object.freeze({...e});let o=!1;return{async copyTo(i,l){i.conditionals;const a=i.range;({...r,...l}).isCut&&!o&&(n.delete(),o=!0);const c={colStart:a.colStart,rowStart:a.rowStart,colEnd:t.colEnd-t.colStart+a.colStart,rowEnd:t.rowEnd-t.rowStart+a.rowStart};return console.log("implement copyTo"),c},getCoords:()=>t,getSource:()=>n,getName:()=>"Conditional Format",getMarkOptions:()=>r,isISnapshot:!0}}_processRestoreOrRevert(e,t,n){super._processRestoreOrRevert(e,t,n)}_createSpatial(e){return new nx(e,this)}_processCoordsChange(e){this._coordsCache=null,e.after?this._emitter.notify("onAnyChange"):this._delete()}update(e,t){if(this.isClosed())throw new Error("Table has been closed. No further operations are allowed.");const n=this._getState(),r=this._beginCommit(t?.description??"Update Conditional Format");try{const o={...n,...e};this._updateState(o,t),this._getEmitter().notify("onAnyChange"),r.commit()}catch(o){throw r.rollback(),o}return this}_processDelete(){this._getState(),super._processDelete()}_processStateChange(e,t,n){super._processStateChange(e,t,n),this._getEmitter().notify("onAnyChange")}toJSON(){const e={},t=this._getState();if(t===null)return null;const n=this.getRanges()?.toString();return n?(e.ref=n,e.type=t.type,t.priority!==0&&(e.priority=t.priority),t.stopIfTrue&&(e.stopIfTrue=t.stopIfTrue),t.style&&(e.style=t.style),t.colorScale&&(e.colorScale=t.colorScale),t.dataBar&&(e.dataBar=t.dataBar),t.iconSet&&(e.iconSet=t.iconSet),t.aboveAverage&&(e.aboveAverage=t.aboveAverage),t.equalAverage&&(e.equalAverage=t.equalAverage),t.stdDev!==0&&(e.stdDev=t.stdDev),t.bottom&&(e.bottom=t.bottom),t.percent&&(e.percent=t.percent),t.rank!==0&&(e.rank=t.rank),t.operator&&(e.operator=t.operator),t.formulas&&(e.formulas=t.formulas),t.text&&(e.text=t.text),t.timePeriod&&(e.timePeriod=t.timePeriod),e):null}_fromJSON(e){const t={};t.type=e.type??Td.Type.CellIs,t.priority=e.priority??0,t.stopIfTrue=e.stopIfTrue??!1,t.style=e.style??null,t.colorScale=e.colorScale??null,t.dataBar=e.dataBar??null,t.iconSet=e.iconSet??null,t.aboveAverage=e.aboveAverage??!1,t.equalAverage=e.equalAverage??!1,t.stdDev=e.stdDev??0,t.bottom=e.bottom??!1,t.percent=e.percent??!1,t.rank=e.rank??0,t.operator=e.operator??null,t.formulas=e.formulas??null,t.text=e.text??null,t.timePeriod=e.timePeriod??null,this._updateState(t,{description:"Initialize Conditional Format"})}close(){super.close(),this.isClosed()||(this._updateState({},{description:"Close Conditional"}),this._stylesRemoveListener?.())}getCoords(){return this.getRanges().getCoords()[0]}getPropertiesAt(e,t,n){return null}get isIConditionalFormat(){return!0}}class ox{constructor(e,t){this._add=e,this._get=t}add(e,t){if(!e)throw new Error(xo);return this._add(e,t)}getItems(e){let t;return e?.address&&(t=e.address),this._get(t,e?.ignoreHidden,e?.fullyContained)}getCount(){return this._get(null,!1,!1).length}}const Em=(s,e)=>{if(e){if(e.getType()===He.Type.Solid)s.background=_r(e.getColor())||"none",s["mso-pattern"]="black none";else if(e.getType()===He.Type.Pattern){const t=e;s.background=_r(t.getBackground())||"none";const n=_r(t.getForeground())||"";if(t.getPatternType()===He.BuiltInSheetPattern.Solid)s["mso-pattern"]=`${s.background} none`,s.background=n;else{const r=(o=>Jt.get(o)?.cssKey??"solid")(t.getPatternType());s["mso-pattern"]=n+(r?" ":"")+r}}else if(e.getType()===He.Type.Gradient){const t=e;s.background=_r(t.getStops()?.[0]?.getColor())||"auto",s.msoGradient=_S(t)||"auto"}}};class sx{constructor(e,t){if(this._visitedStyles=new Map,this._lastStyleClassId=63,this._wroteTD=!1,!e)throw new Error("Can not create with a null sheet.");this._sheet=e,this._includeSizeInCell=t??!1,this._normalStyle=e.getStyles().getNormal()}_createCSSStyle(e){const t=this._normalStyle,n={},r=(h,f)=>h===f||!(h&&!f)&&!(!h&&f)&&f.isEqual?.(h),o=e.getFont(),i=t.getFont();var l;r(o.getFill(),i.getFill())||(n.color=_r(o.getFill())),r(o.getSize(),i.getSize())||(n["font-size"]=Pf(o.getSize())),r(o.getWeight(),i.getWeight())||(n["font-weight"]=o.getWeight()),r(o.getStyle(),i.getStyle())||(n["font-style"]=o.getStyle()),r(o.getUnderline(),i.getUnderline())||(n["text-decoration"]="underline",n["text-underline-style"]=(l=o.getUnderline())===Be.UnderlineStyle.Single?"single":l===Be.UnderlineStyle.Double?"double":l===Be.UnderlineStyle.SingleAccounting?"single-accounting":l===Be.UnderlineStyle.DoubleAccounting?"double-accounting":"none"),r(o.getFamily(),i.getFamily())&&r(o.getFallbacks(),i.getFallbacks())||(n["font-family"]=Ta(o.getFamily(),o.getFallbacks())),r(e.getNumberFormat(),t.getNumberFormat())||(n["mso-number-format"]=Vf(e.getNumberFormat()));const a=e.getAlignment(),c=t.getAlignment();if(!r(a.getHorizontal(),c.getHorizontal())){const h=a.getHorizontal();h===ce.HorizontalAlignment.CenterContinuous?n["text-align"]="center-across":h===ce.HorizontalAlignment.Fill?n["text-align"]="fill":h===ce.HorizontalAlignment.Distributed?n["text-align"]=a.getJustifyLastLine()?"121":"010":n["text-align"]=ce.toCSSHorizontalTextAlign(h)}if(!r(a.getVertical(),c.getVertical())){const h=a.getVertical();h===ce.VerticalAlignment.Distributed?n["vertical-align"]="121":n["vertical-align"]=Hf(h)}if(!r(a.getOverflow(),c.getOverflow())){const h=a.getOverflow();n["white-space"]=$f(h),h===ce.Overflow.Shrink&&(n["mso-text-control"]="shrinktofit")}var u;r(a.getRotation(),c.getRotation())||(n["mso-rotate"]=(u=a.getRotation(),(u%=360)<0&&(u+=360),u>180?u=360-u:u>1&&(u*=-1),u)),r(a.getIndent(),c.getIndent())||(n["mso-char-indent-count"]=a.getIndent()),r(e.getFill(),i.getFill())||Em(n,e.getFill());const d=e.getBorder();return d.getTop().isNone()||(n["border-top"]=wo(d.getTop())),d.getLeft().isNone()||(n["border-left"]=wo(d.getLeft())),d.getRight().isNone()||(n["border-right"]=wo(d.getRight())),d.getBottom().isNone()||(n["border-bottom"]=wo(d.getBottom())),d.getDiagonalUp().isNone()||(n["border-mso-diagonal-up"]=wo(d.getDiagonalUp())),d.getDiagonalDown().isNone()||(n["border-mso-diagonal-down"]=wo(d.getDiagonalDown())),Object.keys(n).length===0?null:n}_createCSSNormalStyle(){const e=this._normalStyle,t={"padding-top":"1px","padding-left":"1px","padding-right":"1px","mso-ignore":"padding"},n=e.getFont(),r=e.getAlignment();return t.color=_r(n.getFill()),Em(t,e.getFill()),t["font-size"]=Pf(n.getSize()),t["font-weight"]=n.getWeight(),t["font-style"]=n.getStyle(),t["text-decoration"]=pS(n.getUnderline(),n.getStrike()),t["font-family"]=Ta(n.getFamily(),n.getFallbacks()),t["mso-font-charset"]="0",t["mso-background-source"]="auto",t["mso-number-format"]=Vf(e.getNumberFormat()),t["text-align"]=ce.toCSSHorizontalTextAlign(r.getHorizontal()),t["vertical-align"]=Hf(r.getVertical()),t.border="none",t["mso-pattern"]="auto",t["white-space"]=$f(r.getOverflow()),r.getOverflow()===ce.Overflow.Shrink&&(t["mso-text-control"]="shrinktofit"),t["mso-rotate"]="0",r.getIndent()>0&&(t["mso-char-indent-count"]=r.getIndent()),t["mso-protection"]="locked visible",t}onCell(e,t,n){let r;const o=e.getSpans();if(o.width>1||o.height>1){if(!e.isTopLeft())return!1;o.height>1&&n.addAttribute("rowspan",o.height),o.width>1&&n.addAttribute("colspan",o.width)}let i=e.toTextUnformatted();e.getNumberFormat().repeatPlaceholder&&(i=e.getNumberFormat().repeatPlaceholder.repeat(5)),n.setPlainText(i||"");const l=e.getStyle(),a=l.getFont();if(a.getVerticalAlignment()===Be.VerticalAlignment.Super&&(i=`<sup>${i}</sup>`),a.getVerticalAlignment()===Be.VerticalAlignment.Sub&&(i=`<sub>${i}</sub>`),a.getStrike()&&(i=`<s>${i}</s>`),e.getHyperlink()&&(i=`<a href="${e.getHyperlink().getAddress()}">${i}</a>`),n.setHTMLText(i||"&nbsp"),!this._wroteTD){const u=this._createCSSNormalStyle();n.addSharedStyle("td",u),this._wroteTD=!0}let c=this._visitedStyles.get(l);if(!c){const u=this._createCSSStyle(l);u&&(c="xl"+ ++this._lastStyleClassId,this._visitedStyles.set(l,c),n.addSharedStyle("."+c,u))}if(c&&n.addAttribute("class",c),this._includeSizeInCell){const u=this._sheet.getColumnHeaders().at(t.colIndex).getSize();n.addAttribute("width",u),n.addStyle("width",P.roundAccurately(u/Be.getDeviceScale(),2)+"pt");const d=this._sheet.getRowHeaders().at(t.rowIndex).getSize();n.addAttribute("height",d),n.addStyle("height",P.roundAccurately(d/Be.getDeviceScale(),2)+"pt")}return r}onRow(e,t,n,r){const o=e.getSize();r.addAttribute("height",o),r.addStyle("height",P.roundAccurately(o/Be.getDeviceScale(),2)+"pt"),e.isCustomSize()&&r.addStyle("mso-height-source","userset")}onColumn(e,t,n,r){const o=e.getSize();r.addAttribute("width",o),r.addStyle("width",P.roundAccurately(o/Be.getDeviceScale(),2)+"pt"),e.isCustomSize()&&r.addStyle("mso-width-source","userset"),n>1&&r.addAttribute("colspan",n)}}const Rm=(s,e,t)=>{const n=s.getOrientation()===B.Orientation.Column,r=(n?"Column":"Row")+" Copy",o=s.getSnapshot(t);return{...o,getName:()=>r,getCoords:()=>e,copyTo:async(i,l)=>{const a=n?i.getColumnHeaders():i.getRowHeaders(),c={...t,...l};if(c.includeHeaders===!0){const u=await o.copyTo(a,c);return n?{colStart:u.min,rowStart:e.rowStart,colEnd:u.max,rowEnd:e.rowEnd}:{colStart:e.colStart,rowStart:u.min,colEnd:e.colEnd,rowEnd:u.max}}},getMarkOptions:()=>t}},ix=(s,e,t,n,r,o)=>{const i=t[0];let l,a;const c=()=>{if(a!==void 0)return;const[u,d]=((h,f)=>{const g=f.getRowHeaders(),m=f.getColumnHeaders(),p=f.getUsedRange()?.getCoords(),S=g.getUsedRange()?.getCoords(),w=m.getUsedRange()?.getCoords(),b={...q.EmptyRange,...p,colEnd:Math.max(p?.colEnd??0,w?.max??0),rowEnd:Math.max(p?.rowEnd??0,S?.max??0)},C=new Map,_=[];h.onStart?.();const y={rows:[],cols:[]},v=new Vv(C,_);v.setNode(y),h.onTable?.(v,b);let x=0;m.forEachSpan((k,L)=>{const W=L.getCoords();x=x+W.max-W.min+1;const $={};v.setNode($),h.onColumn?.(L.getCellHeader(),W.min,W.max-W.min+1,v),y.cols.push($)},{address:b,includeEmpty:!0,includeStyles:!0});let E=0;const R=[];if(g.forEachSpan((k,L)=>{const W=L.getCoords();E=E+W.max-W.min+1,R.push({min:W.min,max:W.max,value:L.getCellHeader()})},{address:b,includeEmpty:!0,includeStyles:!0,ignoreHidden:!1}),x*E>5e4){if(!Sm)throw Sm=!0,new Uw("Unable to write more than 50000 cells to system clipboard. Items can still be pasted within the application to but if you want to copy to another application select a smaller set of data.");return[null,null]}let I=0,A=-1,T=null;f.forEach((k,L)=>{const W=L.getCoords(),$=L.getCell();if(W.rowIndex!==A){W.rowIndex>R[I].max&&++I;const te=R[I];T={cells:[]},v.setNode(T),h.onRow?.(te.value,W.rowIndex,1,v),y.rows.push(T),A=W.rowIndex}const J={};v.setNode(J),h.onCell($,W,v)!==!1&&T.cells.push(J)},{address:b,includeEmpty:!0,ignoreHidden:!1}),h.onDone?.(),y.rows.length===0&&y.rows.push({cells:[]});const O=[];for(let k=0;k<_.length;k++){const L=_[k],W=C.get(L);O.push(L);let $="";const J=Object.keys(W);for(let te=0;te<J.length;te++){$+="        ",te===0&&($+="{");const Q=J[te];$+=`${Q}:${W[Q]};`,te===J.length-1?$+="}":$+=`
`}O.push($)}const N=[`<div clipboard-uuid=xxx>
<html
  xmlns:v="urn:schemas-microsoft-com:vml"
  xmlns:o="urn:schemas-microsoft-com:office:office"
  xmlns:x="urn:schemas-microsoft-com:office:excel"
  xmlns="http://www.w3.org/TR/REC-html40"
>`];N.push(`<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=ProgId content=Excel.Sheet>
<meta name=Generator content="Microsoft Excel 15">`),N.push(`<style>
table
        {mso-displayed-decimal-separator:"\\.";
        mso-displayed-thousand-separator:"\\,";}
@page
        {margin:.75in .25in .75in .25in;
        mso-header-margin:.3in;
        mso-footer-margin:.3in;
        mso-horizontal-page-align:center;}
tr
        {mso-height-source:auto;}
col
        {mso-width-source:auto;}
br
        {mso-data-placement:same-cell;}`),O.length>0&&N.push(O.join(`
`)),N.push("</style>"),N.push("</head>"),N.push("<body>"),N.push("<table>"),N.push("<!--StartFragment-->");const D=k=>{let L=($=>{let J="";return $&&$.attributes&&$.attributes.length!==0&&$.attributes.forEach((te,Q)=>{J.length>0&&(J+=" "),J+=`${Q}=${te}`}),J})(k);L.length>0&&(L=" "+L);let W=($=>{let J="";return $&&$.styles&&$.styles.length!==0&&($.styles.forEach((te,Q)=>{J.length>0&&(J+=";"),J+=Q+":"+te}),J.length>0&&(J=`style='${J}'`)),J})(k);return W.length>0&&(W=" "+W),`${L}${W}`},F=[];return y.cols?.forEach(k=>{N.push(`  <col${D(k)}>`)}),y.rows.forEach(k=>{N.push(`  <tr${D(k)}>`);const L=[];k.cells.forEach(W=>{N.push(`    <td${D(W)}>${W.htmlText??W.plainText??""}</td>`);const $=`${P.castToString(W.plainText??"")?.replace(/"/g,'""')}`;L.push($)}),F.push(L.join("	")),N.push("  </tr>")}),N.push("<!--EndFragment-->"),N.push("</table>"),N.push("</body>"),N.push("</html>"),N.push("</div>"),[N.join(`
`),F.join(`
`).concat(`
`)]})(new sx(e),e.getRange(i));l=u??null,a=d??null};return{copyTo(u,d){const h={...r,...d};return d.isCut,o(u,h)},getMarkOptions:()=>r,getSource:()=>s,getName:()=>n,getCoords:()=>i,toText:()=>(c(),a),toHtml:()=>(c(),l),toImage:()=>null,isISnapshot:!0}},wa=(s,e)=>Math.round(s*e),Im=(s,e,t)=>{const n=[],r=[];if(!s||s.length===0)return{sizes:n,hidden:r};if(!e||!t)return console.warn("_HeaderUtils:default size and scaleFactor should be available"),{sizes:n,hidden:r};let o=0,i=0,l=0,a=null,c=-2;const u=s.length;for(let d=0;d<u;d++){const h=s[d],f=h.min,g=h.max;o=n.length===0?0:n[n.length-1].runningOffsetMax,n.length>0&&n[n.length-1].spanSize>0&&o++,i<h.min&&n.push({indexMin:i,indexMax:f-1,runningOffsetMin:o,runningOffsetMax:Math.round(o+(f-i)*e*t)-1,runningHiddenRuns:l,spanSize:Math.round(e*t)});const m=n.length,p=n[m-1];o=m===0?0:p.runningOffsetMax,m>0&&p.spanSize>0&&o++;let S=0;h.value.h||(S=wa(h.value?.sz??e,t));const w=S===0?0:-1;S===0&&(l+=g-f+1,c+1===f?a.max=g:(a={min:f,max:g,value:!0},r.push(a)),c=g),m>0&&p.spanSize===S&&p.indexMax+1===f?(p.indexMax=g,p.runningHiddenRuns=l,p.runningOffsetMax=p.runningOffsetMin+(g+1-p.indexMin)*S+w):n.push({indexMin:f,indexMax:g,runningOffsetMin:o,runningOffsetMax:Math.round(o+(g+1-f)*S)+w,runningHiddenRuns:l,spanSize:S}),i=g+1}return{sizes:n,hidden:r}};function Tu(s,e,t){t!==void 0&&(t!==null?s[e]=t:delete s[e])}const Am=(s,e,t)=>{if(s==null)return null;let n={};if(typeof s=="number")n.colStart=s,n.colEnd=s,n.rowStart=s,n.rowEnd=s;else if(typeof s=="string"){if(e){if(s.match(/[0-9]+/))throw new Error("Invalid range address for header orientation")}else if(s.match(/[a-zA-Z]+/))throw new Error("Invalid range address for header orientation");let o=Jn(s,t);if(!o){const i=oS(s.toUpperCase(),!0);i?.colIndex!==void 0&&(n.colStart=i.colIndex,n.colEnd=i.colIndex),i?.rowIndex!==void 0&&(n.rowStart=i.rowIndex,n.rowEnd=i.rowIndex)}n={...n,...o}}const r={min:void 0,max:void 0};return e?(r.min=s.min??s.colStart??n.colStart,r.max=s.max??s.colEnd??n.colEnd):(r.min=s.min??s.rowStart??n.rowStart,r.max=s.max??s.rowEnd??n.rowEnd),r.min===void 0||r.max===void 0?null:r},ku=()=>{},Fu=()=>0,lx=()=>!1,Mm=(s,e=!1)=>{if(!s||s.length===0)return P.EmptyArray;const t=[];let n=null;const r=s.slice().sort((i,l)=>i.min-l.min),o=r.length;for(let i=0;i<o;i++){const l=r[i];n&&l.min<=n.max+1?e?n.max=Math.max(n.max,l.max):(n={min:n.max+1,max:l.max},t.push(n)):(n={min:l.min,max:l.max},t.push(n))}return t},WS=(s,e,t,n)=>{if(n!==void 0){if(n===null)return null;if(n?.isICellHeader)return n._headerState;if(n){const r=n,o={...t};let i,l=r.hidden,a=r.size;if(r.size!==void 0){if(typeof a=="function"){const c=t?.sz===void 0?s.getDefaultSize():t?.sz*s.getScaleFactor();a=a?.(c)}if(typeof a=="string"&&(a=Ss(a,e.getNormal().getFont().getSize(),"px")),typeof a=="number"){const c=s.getMinSize(),u=s.getMaxSize();a=Math.max(c,Math.min(P.roundAccurately(a,c),u)),r.relativeSize!==!0&&(a/=s.getScaleFactor()),isNaN(a)&&(console.warn("headerSize can not be NaN"),a=void 0),a===0&&(l=!0,a=void 0),i=!r.autoSize}else a===null?(a=null,i=!r.autoSize):a!==void 0&&(console.warn("headerSize can not be type",a),a=void 0)}return Tu(o,"sz",a),Tu(o,"h",l),Tu(o,"csz",i),Object.keys(o).length===0?null:o}}};class dh{constructor(e,t,n){this._sheetHeader=e;const r=this._sheetHeader.getSheet().getStyles();this._styles=r,this._headerState=t,this._template=n}getSize(){const e=this._headerState?.sz;return Math.round(e===void 0?this._sheetHeader.getDefaultSize():e*this._sheetHeader.getScaleFactor())}getDisplayText(){return""+this.asCell().getValue()}getOrientation(){return this._sheetHeader.getOrientation()}isHidden(){return this._headerState?.h??!1}isCustomSize(){return this._headerState?.cs??!1}getSheetHeader(){return this._sheetHeader}getStyle(){return this._headerState?.s??this._styles.getNormal()}asCell(){return this._cellTemplate||(this._cellTemplate=this._sheetHeader.getSheet().createTemporaryCell({style:this.getStyle(),...this._template})),this._cellTemplate}getSizeRelative(){return this.getSize()/this._sheetHeader.getScaleFactor()}createTemporaryCellHeader(e){const t=WS(this._sheetHeader,this._sheetHeader.getSheet().getStyles(),this._headerState,e);return new dh(this._sheetHeader,t,this._template)}isEqual(e){if(!e)return!1;if(e===this)return;const t=e;if(!t.isICellHeader)return!1;const n=this._headerState,r=t._headerState;return n===r||!(n&&!r||r&&!n)&&this.getSize()===t.getSize()&&this.isCustomSize()===t.isCustomSize()&&this.isHidden()===t.isHidden()&&this.getStyle()===t.getStyle()}isEmpty(){const e=this._headerState;return!e||e.sz===void 0&&e.csz===void 0&&!e.cs&&e.h===void 0&&!(!e.s||e.s!==this._styles.getNormal()||e.cs)}get[Symbol.toStringTag](){return"[SheetCellHeader]"}toString(){return`[SheetCellHeader: ${this.getDisplayText()}]`}get isICellHeader(){return!0}}const Tl="The columns are protected. To make a change, unprotect the sheet. You might be requested to enter a password.",kl="The rows are protected. To make a change, unprotect the sheet. You might be requested to enter a password.",to="Rows",no="Columns";class ax{constructor(e,t){this._header=e,this._coords=t}_forEachSpan(e,t,n,r){const o=this._header,i=this._coords,l=o._options;r||(r=l.createCellHeader);let a=i;if(t?.address){const u=o._parseHeaderRangeAddress(t?.address);if(u&&(a=Dg(i,u),!a))return}const c=o._scanHeaders(e,n,r,l,a,t);if(c&&c.break)return c.break}forEachSpan(e,t){return this._forEachSpan(e,t,this._header._headers)}forEachVisibleSpan(e,t){const n=this._coords,r=n?.min??null,o=n?.max??null;let i;if(i=t?.includeHidden?e(r,o):L0(this._header._indexedHidden,l=>{if(l.value)return;const a=e(l.min,l.max);return a&&a.break?a:void 0},r,o),i&&i.break)return i.break}forEach(e,t){let n=Number.MAX_SAFE_INTEGER,r=null;const o={getIndex:()=>n,getCellHeader:()=>r.getCellHeader(),getA1:i=>r.getA1(i),getCoords:()=>r.getCoords()};return this._forEachSpan((i,l)=>{r=l;const a=this._coords,c=a.max;for(let u=a.min;u<c;u++)n=u,e(i,o)},t,this._header._headers,()=>this.at(void 0))}updateHeaders(e,t){const n=this._header;return n._updateHeaderPairs([{address:this._coords,update:e}],{description:t?.description??`Update ${n._isColumn?no:to} ${toString()}`,...t}),this}getCoords(){return{...this._coords}}setHidden(e){return this._header._setHidden(this._coords,e),this}getUsedRange(e){const t=this._header,n=t._headerRunCoords;return!n||n.min<0||n.max>t._maxDataIndex?null:Dg(n,this._coords)?t.getRange(n,e):null}getCount(){const e=this._coords;return e.max-e.min+1}getHeaderCount(){const e=this._coords;return e.max-e.min+1}getVisibleCount(){const e=this._coords;return this._header.getVisibleCount(e.min,e.max)}isEntireHeaders(){const e=this._header._maxRunCoords,t=this._coords;return!(t.min>e.min||t.max<e.max)}getSnapshot(e){return this._header._getSnapshot(this._coords,e)}clear(){return this._header._clear(this._coords),this}setSize(e,t){return this._header._setSize(this._coords,e,t),this}at(e){return this._header.at(this._coords.min+e)}getOrientation(){return this._header.getOrientation()}doBatch(e,t){return this._header.doBatch(n=>e(n),t)}getSheetHeader(){return this._header}getA1(){const e=this._coords,t=this._header,n=t._isColumn?{colStart:e.min,colEnd:e.max}:{rowStart:e.min,rowEnd:e.max};return wr(n,t._maxRangeCoords)??tn}get[Symbol.toStringTag](){return"[SheetCellHeaderRange]"}toString(){return this.getA1()}get isICellHeaderRange(){return!0}}class cx{constructor(e,t){this._header=e,this._coords=t}updateHeaders(e,t){const n=this._header;return n.updateHeaderPairs([{address:this._coords,update:e}],{description:t?.description??`Update ${n._isColumn?no:to} ${toString()}`,...t}),this}getCoords(){return{...this._coords}}setHidden(e){return this._header._setHidden(this._coords,e),this}getCount(){return this._coords.length}getHeaderCount(){const e=Mm(this._coords,!0);let t=0;const n=e.length;for(let r=0;r<n;r++){const o=e[r];t+=o.max-o.min+1}return t}getVisibleCount(){const e=Mm(this._coords,!0);let t=0;const n=this._header,r=e.length;for(let o=0;o<r;o++){const i=e[o];t+=n.getVisibleCount(i.min,i.max)}return t}isEntireHeaders(){const e=this._header._maxRunCoords,t=this._coords,n=e.min,r=e.max,o=t.length;for(let i=0;i<o;i++){const l=t[i];if(n<l.min||r>l.max)return!1}return!0}isEntireHeadersAny(){const e=this._header._maxRunCoords,t=this._coords,n=e.min,r=e.max,o=t.length;for(let i=0;i<o;i++){const l=t[i];if(l.min<=n&&l.max>=r)return!0}return!1}clear(){return this._header._clear(this._coords),this}setSize(e,t){return this._header._setSize(this._coords,e,t),this}at(e){const t=this._coords;return e<0||e>=t.length?null:this._header.getRange(t[e])}getOrientation(){return this._header.getOrientation()}doBatch(e,t){return this._header.doBatch(n=>e(n),t)}getSheetHeader(){return this._header}getA1(){const e=this._coords,t=this._header;return((n,r,o=wr)=>{if(!n)return tn;const i=n.length,l=new Array(i);for(let a=0;a<i;a++)l[a]=o(n[a],r);return l.join(",")})(((n,r,o)=>{if(!n||n.length===0)return P.EmptyArray;const i=n.length;let l=new Array(i);const a=o?r.rowStart:r.colStart,c=o?r.rowEnd:r.colEnd;for(let u=0;u<i;u++){const d=n[u];l[u]={colStart:o?d.min:a,rowStart:o?a:d.min,colEnd:o?d.max:c,rowEnd:o?c:d.max}}return l})(e,t._maxRangeCoords,t._isColumn),t._maxRangeCoords)??tn}get[Symbol.toStringTag](){return"[SheetCellHeaderRanges]"}toString(){return this.getA1()}get isICellHeaderRanges(){return!0}}class Tm{constructor(e){if(this._emitter=null,this._closed=!1,this._scaleFactor=1,this._defaultSize=-1,this._defaultCustomSize=-1,this._defaultPxSize=1,this._isColumn=!0,this._indexedSizes=[],this._indexedHidden=[],this._headerRunCoords=null,this._hasCustomFormats=!1,this._hasStyles=!1,this._hasHidden=!1,this._lastHeaderRead=null,this._readCache=null,this._lastVisibleRunsRead=null,this._lastVisibleRunCoords=null,this._options={isProtected:()=>!1,getUpdateId:()=>null,scaleFactor:()=>1,defaultSize:()=>100,minSize:()=>0,maxSize:()=>500,maxSheetCoords:()=>null,orientation:B.Orientation.Column,createCellHeader:(r,o,i)=>new dh(r,o,i),...e},!this._options.sheet)throw new Error("An ISheet must be provided");if(this._emptyHeader=this._options.createCellHeader(this,null,null),this._scaleFactor=this._options.scaleFactor(),this._defaultSize=this._options.defaultSize(),this._defaultSize<=0)throw new Error("defaultSize must be greater than 0");this._defaultPxSize=wa(this._defaultSize,this._scaleFactor);const t=this._options.orientation===B.Orientation.Column;this._isColumn=t,this._cacheMaxIndex();const n=this;this._options.setContainerShiftedCallback&&this._options.setContainerShiftedCallback((r,o)=>{o<0?n._deleteHeaders(r,-o):n._insertHeaders(r,o)}),this._options.sheet&&(this._sheetRemoveListener=this._options.sheet.addListeners({onProtectionChange(){},onSelectionChange(r){n._selection=r.getSelection().getCoords(),n._selectionRuns=null},onStyleChange:()=>{},onViewChange(){const r={runs:n._headers};n._invalidSizes(),n._cacheMaxIndex(),n._emitter.notify("onSizesChange",{params:r})}},{transactional:!1}),n._selection=n._options.sheet.getSelection().getCoords()),this._transactions=this._options.transactions??new Hn({transient:!0}),this._emitter=new gn(n,this._transactions),this._transactionsRemoveListener=this._transactions.addStateListener(this,{onAfterStateChange(r){n._lastHeaders!==r.headers&&n._onHeaderChange()}}),this.fromJSON(this._options?.json)}addListeners(e,t){return this._emitter.addListeners(e,t)}_cacheMaxIndex(){const e=this._options.maxSheetCoords()??{colStart:0,rowStart:0,colEnd:Number.MAX_SAFE_INTEGER,rowEnd:Number.MAX_SAFE_INTEGER};this._maxSheetCoords=e;const t=this._isColumn,n=t?e.colEnd:e.rowEnd;this._maxDataIndex=n,this._maxRunCoords={min:0,max:n},this._maxDataRange=this.getRange(this._maxRunCoords),this._maxRangeCoords={colStart:0,rowStart:0,colEnd:t?n:0,rowEnd:t?0:n}}_invalidSizes(e=!1){const t=this._defaultCustomSize===-1?this._options.defaultSize():this._defaultCustomSize,n=this._options.scaleFactor();if(e||t!==this._defaultSize||n!==this._scaleFactor){this._defaultSize=t,this._scaleFactor=n,this._defaultPxSize=wa(t,n);const r=Im(this._headers,t,n);this._indexedSizes=r.sizes,this._indexedHidden=r.hidden,this._lastVisibleRunsRead=null,this._lastVisibleRunCoords=null}}_onHeaderChange(){this._lastHeaders=null;const e=this._headers,t=this._getState();this._defaultCustomSize=t.defaultCustomSize;const n=this._defaultCustomSize===-1?this._options.defaultSize():this._defaultCustomSize;this._defaultSize=n;const r=this._scaleFactor;this._defaultPxSize=wa(n,r);const o=Im(e,n,r);this._indexedSizes=o.sizes,this._indexedHidden=o.hidden,this._lastHeaderRead=null,this._readCache=O0(this._lastHeaders),this._lastVisibleRunsRead=null,this._lastVisibleRunCoords=null;const i=this._options.sheet.getStyles().getNormal();let l=!1,a=!1,c=!1,u=-1;for(let f=e.length-1;f>=0;f--){const g=e[f],m=g.value,p=m.s,S=m.csz||m.sz!==n;u!==-1||!S&&p===i||(u=g.max),l=l||m.cs,a=a||m.s!==i,c=c||m.h||m.sz===0}u=Math.min(u??0,this._maxDataIndex);const d=Math.min(e[0]?.min??u,u);this._headerRunCoords=Object.freeze({min:d,max:u}),this._hasCustomFormats=l,this._hasStyles=a,this._hasHidden=c;const h=t.runs;this._emitter.notify("onSizesChange",{params:h})}getSheet(){return this._options.sheet}getOrientation(){return this._isColumn?B.Orientation.Column:B.Orientation.Row}getTextAt(e){return this._options.getTextAt?.(e)??e+""}_scanHeaders(e,t,n,r,o,i){const l=o?.min??null,a=o?.max??null,c=i?.includeEmpty??!1,u=i?.includeStyles??!1,d=i?.ignoreHidden??!1,h=i?.includeSizes??!1,f=this,g=this._options.sheet.getStyles().getNormal(),m=this._defaultSize,p=this._scaleFactor,S=this._emptyHeader;let w;const b={getCoords(){if(!w)throw new Error(ps);return{min:w.min,max:w.max}},getIndex:()=>w.min,getCellHeader(){if(!w)throw new Error(ps);return w.value?n(f,w.value):S},getA1(_){if(!w)throw new Error(ps);return this._parseHeaderRangeAddress({min:l+_,end:l+_})??w}},C=L0(t,_=>{const y=_.value;if(!c&&!y)return;let v=c;if(h&&!v&&y&&(y.csz||y.sz!==m)&&(v=!0),u&&!v&&y&&(y.s&&y.s!==g||y.cs)&&(v=!0),y&&y.h===!0&&(v=!d),!v)return;let x=m;_.value&&(x=_.value.h?0:_.value?.sz??m),x*=p,w=_;const E=e(x,b);return E&&E.break?E:void 0},l,a);return w=null,C}getRange(e,t){if(!e)throw new Error(xo);const n=this._parseHeaderRangeAddress(e);return n.min<0||n.max>this._maxDataIndex?(function(r){return Object.freeze({getCoords:()=>null,getOrientation:()=>r.getOrientation(),toString:()=>tn,getA1:()=>tn,getCount:Fu,getHeaderCount:Fu,getVisibleCount:Fu,isEntireHeaders:lx,forEach:ku,forEachSpan:ku,forEachVisibleSpan:ku,getUsedRange:gt,getSnapshot:gt,updateHeaders:gt,clear:gt,setHidden:gt,setSize:gt,at:gt,doBatch:gt,getSheetHeader:()=>r,isICellHeaderRange:!0})})(this):new ax(this,n)}getRanges(e,t){if(!e)throw new Error(xo);const n=((r,o,i)=>{if(typeof r=="string"){const c=Qa(r,i),u=c?c.length:0,d=new Array(u);for(let h=0;h<u;h++){const f=c[h];d[h]={min:o?f.colStart:f.rowStart,max:o?f.colEnd:f.rowEnd}}return r=d,d}Array.isArray(r)||(r=[r]);const l=r.length,a=new Array(l);for(let c=0;c<l;c++)a[c]=Am(r[c],o,i);return a})(e,this._isColumn,this._maxRangeCoords);return new cx(this,n)}getSelectedRange(e){const t=this._options.sheet.getSelection().getRangesCoords()[0];return this.getRange(t,e)}getSelectedRanges(e){return this.getRanges(this._options.sheet.getSelection().getRangesCoords(),e)}getUsedRange(e){return this.getRange(this._headerRunCoords,e)}getEntireRange(e){return e?this.getRange(this._maxRangeCoords,e):this._maxDataRange}at(e){if(e<0||e>this._maxDataIndex)return this._emptyHeader;if(this._lastHeaderRead?.offset===e)return this._lastHeaderRead.header;const t=D0(e,this._readCache);if(!t)return this._emptyHeader;const n=this._options.getTextAt?.(e)??e+"",r=this._options.createCellHeader(this,t,{value:n});return this._lastHeaderRead={offset:e,header:r},r}updateHeaderPairs(e,t){if(this.isProtected())throw new Error(this._isColumn?Tl:kl);return this._updatePairsInternal(e,t)}_parseHeaderRangeAddress(e){if(e==null)throw new Error("Must specify a range.");const t=Am(e,this._isColumn,this._maxRangeCoords);if(!t)throw new Error("Invalid header range.");return t}_update(e,t,n){if(!e||(Array.isArray(e)||(e=[e]),e.length===0))return;const r=[],o=e.length;for(let i=0;i<o;i++){const l=this._parseHeaderRangeAddress(e[i]);this.getRange(l).forEachSpan((a,c)=>{const u=c.getCoords();r.push({address:u,update:t})},{includeEmpty:!0})}return this.updateHeaderPairs(r,n),this}_setSize(e,t=null,n){(n?.relativeSize??!1)||typeof t!="number"||(t+="px");const r={size:t,autoSize:n?.autoSize??!1},o=`Resize ${this._isColumn?no:to}`;return this._update(e,r,{description:o,...n}),this}_setHidden(e,t=null){const n={hidden:t},r=`${t?"Unhide":"Hide"} ${this._isColumn?no:to}`;return this._update(e,n,{description:r}),this}_clear(e,t){const n="Clear "+(this._isColumn?"Column Headers":"Row Headers");this.updateHeaderPairs([{address:e,update:null}],{description:n,...t})}_getSnapshot(e,t){if(e.min<0)return P.EmptyArray;t=Object.freeze({...t});const n=this,r=this._getState(),o=(this._isColumn?"Column":"Row")+" Headers";return{copyTo(i,l){const a={...t,...l},c=i.getCoords(),u=c.min-e.min,d=[];if(n._scanHeaders((h,f)=>{const g=f.getCoords();d.push({address:{min:g.min+u,max:g.max+u},update:f.getCellHeader()})},r.headers,n._options.createCellHeader,null,e,{includeSizes:!0,includeStyles:!0}),!a.fitDestination){let h=e.max-e.min+1,f=c.max-c.min+1,g=P.roundAccurately(f/h);if(g>1&&f%h===0){const m=d.length;for(let p=0;p<g;p++)for(let S=0;S<m;S++){const w=d[S],b=w.address,C=(p+1)*h;d.push({address:{min:b.min+C,max:b.max+C},update:w.update})}}}if(i.doBatch(()=>{i.clear(),i.getSheetHeader()._updatePairsInternal(d)},o),a.isCut){const h=n._maxRunCoords;e.min<=h.min&&e.max>=h.max&&n._clear(e)}return c},getCoords:()=>e,toText:()=>null,toHtml:()=>null,toImage:()=>null,getSource:()=>n,getName:()=>o,isISnapshot:!0}}isProtected(){return this._options?.isProtected()??!1}getScaleFactor(){return this._options.scaleFactor()??1}get _headers(){return this._lastHeaders===null&&(this._lastHeaders=this._getState()?.headers),this._lastHeaders}_updatePairsInternal(e,t){if(!e||e.length===0)return null;const n=t?.skipCustomSize??!1,r=this._isColumn,o=this.getSheet().getStyles(),i=this._beginCommit({description:t?.description??`Update ${r?no:to}`});let l=[...this._getState().headers],a=!1,c=!1;const u=r?Ce.Edge.Top:Ce.Edge.Left;Ce.oppositeEdge(u);const d=r?Ce.Edge.Right:Ce.Edge.Bottom;Ce.oppositeEdge(d);const h=this,f=(C,_)=>{if(this.isProtected())throw new Error(this._isColumn?Tl:kl);c=c||_===null,!c&&_&&(c=!!_.isICellHeader||_?.size!==void 0||_?.hidden!==void 0),a=a||_===null||_?.style!==void 0||_?.isICellHeader;const y={onUpdate:(v,x)=>n&&v&&v.csz?v:WS(h,o,v,x),onSplit:v=>[v.value,v.value],onMerge:(v,x,E,R)=>{if(!(v&&!x||!v&&x||!v&&!x)&&v.sz===x.sz&&v.csz===x.csz&&v.h===x.h&&v.cs===x.cs)return v},isCull:(v,x,E)=>v===void 0};l=Tr(Fg(l,{min:C.min,max:C.max,value:_},y))},g=e.length,m=new Array(g);for(let C=0;C<g;C++){const _=e[C],y=this._parseHeaderRangeAddress(_.address);if(y.min<0||y.max>this._maxDataIndex)throw new Tt(Aa);f(y,_.update),m[C]=y}let p=!1,S=l.length;if(S>0&&l[0].min===0&&l[S-1].max===this._maxDataIndex){let C=l[0],_=!1,y=-1;for(let E=0;!_&&E<S;E++){const R=l[E],I=R.min;if(y+1!==I){_=!0;continue}const A=R.max;y=A,C.max-C.min<A-I&&(C=R)}_||(this._defaultCustomSize=C.value?.sz??-1,p=!0);const v=this._defaultCustomSize===-1?this._options.defaultSize():this._defaultCustomSize,x=[];for(let E=0;E<S;E++){const R=l[E],I=R.value;if(I===null)continue;const A=Object.keys(I).length;A!==0&&(A!==1||I.sz===void 0||I.sz!==null&&I.sz!==v)&&x.push(R)}l=x,S=l.length}const w=[],b=this._defaultSize;for(let C=0;C<S;C++){const _=l[C],y=_.value;if(y===null)continue;let v=!1;y.sz!==void 0&&y.sz!==b&&(v=!0),y.csz&&(v=!0),y.h&&(v=!0),y.cs&&(v=!0),v&&w.push(_)}return l=w,S=l.length,p&&h._invalidSizes(!0),this._updateState({headers:l,defaultCustomSize:this._defaultCustomSize,runs:m}),i.commit(),m}hasCustomFormats(){return this._hasCustomFormats}hasCustomStyles(){return this._hasStyles}hasHidden(){return this._hasHidden}getDefaultSize(){return this._defaultPxSize}getMaxSize(){return Math.ceil(this._options.maxSize()*this._options.scaleFactor())}getMinSize(){return Math.floor(this._options.minSize()*this._options.scaleFactor())}findOffset(e){return((t,n,r)=>{if(n<0)return 0;if(!t||t.length===0)return n*r;const o=t[t.length-1];if(n>o.indexMax)return o.runningOffsetMax+Math.round((n-o.indexMax-1)*r+(o.spanSize!==0?1:0));const i=t[t.length===1?0:P.findEqualOrGreater(t,n,a=>a.indexMax)],l=n-i.indexMin;return i.runningOffsetMin+l*i.spanSize})(this._indexedSizes,e,this._defaultPxSize)}findIndex(e){return Math.min(Math.max(0,((t,n,r)=>{if(!t||t.length===0)return Math.floor(n/r);const o=t[t.length-1];if(n>o.runningOffsetMax)return o.indexMax+Math.ceil((n-o.runningOffsetMax)/r);const i=t[t.length===1?0:P.findEqualOrGreater(t,n,a=>a.runningOffsetMax)];if(i.spanSize===0)return Math.max(0,i.indexMin-1);const l=n-i.runningOffsetMin;return i.indexMin+Math.floor(l/i.spanSize)})(this._indexedSizes,e,this._defaultPxSize)),this._maxDataIndex)}findVisibleIndex(e){return this._lastVisibleRunsRead===e||(this._lastVisibleRunCoords=((t,n,r=Number.MAX_SAFE_INTEGER)=>{if(!t||t.length===0)return{min:n,max:n};let o=t.length-1,i=t[o];if(n>i.indexMax){const a=n-i.runningHiddenRuns;return{min:a,max:a}}o=t.length===1?0:P.findEqualOrGreater(t,n,a=>a.indexMax),i=t[o];const l=i.spanSize===0?Math.max(-1,i.indexMin-1-(t[o-1]?.runningHiddenRuns??1)):n-i.runningHiddenRuns;return{min:l,max:l+Math.min(r+1,i.spanSize===0?1:0)}})(this._indexedSizes,e,this._maxDataIndex),this._lastVisibleRunsRead=e),this._lastVisibleRunCoords}getSpanSize(e,t=e+1){return this.findOffset(t)-this.findOffset(e)}getVisibleCount(e,t){if(e>t)throw new Error("Invalid arguments.");if(e<0||t>this._maxDataIndex)throw new Tt;return this._hasHidden?((n,r,o)=>{let i=o-r+1;if(n.length===0)return i;let l=n.length-1,a=n[l];if(r>a.indexMax)return i;l=n.length===1?0:P.findEqualOrGreater(n,r,d=>d.indexMax),a=n[l];let c=a.runningHiddenRuns;if(a.spanSize===0&&r<=a.indexMax){const d=a.indexMax-a.indexMin+1;i-=Math.min(d,a.indexMax-r+1)}o>a.indexMax&&l<n.length&&(l=P.findEqualOrGreater(n,o,d=>d.indexMax),a=n[Math.min(l,n.length-1)]);let u=a.runningHiddenRuns;if(a.spanSize===0&&a.indexMin<=o){const d=a.indexMax-a.indexMin+1;i-=Math.min(d,o-a.indexMin+1),u-=d}return i-=u-c,i})(this._indexedSizes,e,t):t-e+1}isSelectedAll(e){const t=this.getSelectedRuns();if(t.length===0)return!1;const n=t[P.findEqualOrGreater(t,e,r=>r.max)];return!(!n||e<n.min||e>n.max)&&n.value.isSelectedAll}isSelected(e){const t=this.getSelectedRuns();if(t.length===0)return!1;const n=t[P.findEqualOrGreater(t,e,r=>r.max)];return!(!n||e<n.min||e>n.max)}getSelectedRuns(){let e=this._selectionRuns;return e||(this._selection&&(e=((t,n,r)=>{let o=[];n?.ranges&&n.ranges.length>0?o=n.ranges:n?.cell&&(o=[q.cellToRange(n?.cell)]);let i=[];const l=t.getOrientation()===B.Orientation.Column,a=o.length;for(let c=0;o&&c<a;c++){const u=o[c],d=l?u.colStart:u.rowStart,h=l?u.colEnd:u.rowEnd,f=l?u.rowStart:u.colStart,g=l?u.rowEnd:u.colEnd,m=l?r.rowStart:r.colStart,p=l?r.rowEnd:r.colEnd,S=f<=m&&g>=p;i=Tr(Fg(i,{min:d,max:h,value:{isSelectedAll:!1}},{onUpdate:(w,b)=>{const C=rd(w,b);return C.isSelectedAll=w?.isSelectedAll||S,C}}))}return i})(this,this._selection,this._maxSheetCoords)),e||(e=P.EmptyArray)),this._selectionRuns=e,this._selectionRuns}hiddenHeadersAt(e,t=!1){if(this._indexedSizes.length===0)return 0;let n=this._indexedSizes.length===1?0:P.findEqualOrGreater(this._indexedSizes,e,o=>o.indexMax),r=this._indexedSizes[n];return!r||r.spanSize!==0||r.indexMin>e||r.indexMax<e?0:t?e-r.indexMin+1:r.indexMax-e+1}_insertHeaders(e,t){if(this.isProtected())throw new Error(this._isColumn?Tl:kl);if(t<=0)return;const n=this._beginCommit({description:`Insert ${this._isColumn?no:to}`}),r=this._getState();let o=[...r.headers];o=Tr(((l,a,c=1)=>{const u=P.findEqualOrGreater(l,a,g=>g.max),d=l.slice(0,u),h=[],f=[];if(!l[u])return{preceding:d,modified:f,trailing:h};l[u].min>=a?h.push({...l[u],min:l[u].min+c,max:l[u].max+c}):f.push({...l[u],min:l[u].min,max:l[u].max+c});for(let g=u+1;g<l.length;g++)h.push({...l[g],min:l[g].min+c,max:l[g].max+c});return{preceding:d,modified:f,trailing:h}})(o,e,t));const i=[{min:e,max:e+t}];this._updateState({headers:o,runs:Tr(Ro([...r?.runs??[],...i]))}),n.commit()}_deleteHeaders(e,t){if(this.isProtected())throw new Error(this._isColumn?Tl:kl);const n=this._beginCommit({description:`Delete ${this._isColumn?no:to}`}),r=this._getState();let o=[...r.headers];o=Tr(r1(o,e,t));const i=[{min:e,max:e+t}];this._updateState({headers:o,runs:Tr(Ro([...r?.runs??[],...i]))}),n.commit()}beginCommit(e){return this._beginCommit(typeof e=="string"?{description:e}:e)}doBatch(e,t){return this._transactions.doBatch(e,typeof t=="string"?{description:t}:{description:"Update Header",...t})}isClosed(){return this._closed}close(){this._sheetRemoveListener?.(),this._emitter.close(),this._transactionsRemoveListener?.(),this._closed=!0}_getState(){return this._transactions.getState(this)}_beginCommit(e){return this._transactions.beginCommit(e)}_updateState(e){const t=this._transactions.beginCommit();try{t.updateState(this,e),this._onHeaderChange(),t.commit()}catch(n){throw t.rollback(),n}}fromJSON(e){const t=e||{};this._defaultCustomSize=t.defaultSize??-1,this._defaultCustomSize<=0&&(this._defaultCustomSize=-1),this._invalidSizes();const n=this._options.sheet.getStyles().beginPersist();try{const r=[],o=t.headers?t.headers.length:0,i=this._maxDataIndex;for(let l=0;l<o;l++){let a=t.headers[l];if(a.min>=i)continue;let c={min:a.min,max:Math.min(a.max,i)};const u={};a.sz!==void 0&&a.sz!==-1&&(u.sz=a.sz),a.h!==void 0&&(u.h=a.h),a.csz!==void 0&&(u.csz=a.csz),Object.keys(u).length===0&&(u.cs=!0),c.value=u,r.push(c)}this._updateState({headers:r,defaultCustomSize:this._defaultCustomSize})}finally{n.endPersist()}}toJSON(){if(this._headers.length===0&&this._defaultCustomSize===-1)return null;const e={headers:[]};if(this._defaultCustomSize!==-1&&(e.defaultSize=P.roundAccurately(this._defaultCustomSize,8)),this._headers.length===0)return e;const t=this._defaultCustomSize,n=this.getSheet().getStyles().beginPersist(),r=this._headers.length;for(let o=0;o<r;o++){const i=this._headers[o],l=i.value;if(!l)continue;const a={min:i.min,max:i.max};l.sz!==void 0&&l.sz!==t&&(a.sz=P.roundAccurately(l.sz,8),l.csz!==void 0&&(a.csz=l.csz)),l.h===!0&&(a.h=l.h),Object.keys(a).length>2&&e.headers.push(a)}return n.endPersist(),e}get[Symbol.toStringTag](){return"[SheetHeader]"}toString(){return"[SheetHeader]"}}class km{constructor(e,t){this._c=e,this._tvTl=t}tvTl(){return this._tvTl(this._c)}getCoords(){return this._c}}const ux=s=>{let e="";const t=ca,n=s.length;for(let r=0;r<n;r++){const o=s[r];o.type==="cell"?e+=t(o.value):e+=o.value}return e},dx=(s,e=0,t=0)=>{let n="";const r=aS,o=s.length;for(let i=0;i<o;i++){const l=s[i];l.type==="cell"?n+=r(l.value,e,t):n+=l.value}return n};class hx{constructor(e,t,n){this._c=e,this._tokens=t,this._references=n||P.EmptyArray}getFormulaTextAt(e,t,n=!1){return n?ux(this._tokens):dx(this._tokens,e,t)}getTokensAt(e,t,n){let r=this._tokens;return n!==void 0&&(r=((o,i)=>{const l=o.length,a=[];if(i===void 0)return P.EmptyArray;let c=-1,u=!1;for(let d=0;!u&&d<l;d++){const h=o[d],f=h.evalIndex??Number.MAX_SAFE_INTEGER;if(c===-1){if(f!==i)continue;c=d}f>i?u=!0:a.push(h)}u=!1;for(let d=c-1;!u&&d>=0;d--){const h=o[d];(h.evalIndex??Number.MAX_SAFE_INTEGER)>i?u=!0:a.unshift(h)}return a.length>1&&a[0].type==="whitespace"&&a.shift(),a.length>1&&a[a.length-1].type==="whitespace"&&a.pop(),a})(r,n)),r=((o,i=0,l=0)=>{const a=o.length,c=new Array(a);for(let u=0;u<a;u++){const d=o[u];if(d.type!=="cell"){c[u]=d;continue}const h={...d},f={...h.value};h.value=f,c[u]=h,f.colIndex===Number.MIN_SAFE_INTEGER||f.$colIndex||(f.colIndex+=l),f.rowIndex===Number.MIN_SAFE_INTEGER||f.$rowIndex||(f.rowIndex+=i)}return c})(r,e,t),r}getReferencesAt(e,t){return((n,r=0,o=0)=>{const i=n.length,l=new Array(i);for(let a=0;a<i;a++){const c=n[a];if(typeof c=="string"||c instanceof $e.Known){l[a]=c;continue}const u={...c};l[a]=u,u.colStart===Number.MIN_SAFE_INTEGER||u.$colStart||(u.colStart+=o),u.rowStart===Number.MIN_SAFE_INTEGER||u.$rowStart||(u.rowStart+=r),u.colEnd===Number.MIN_SAFE_INTEGER||u.$colEnd||(u.colEnd+=o),u.rowEnd===Number.MIN_SAFE_INTEGER||u.$rowEnd||(u.rowEnd+=r)}return l})(this._references,e,t)}toJSON(){const e=this._c;return[Pr(e),this.getFormulaTextAt(e.rowStart,e.colStart)]}getCoords(){return this._c}}let gx=class Nd{constructor(e,t,n){this.groupId=e,this.uuid=t,this.noShift=n}onRemove(e){}getShifted(e){if(!e.after)return null;const t=this.noShift;return t?void 0:{...e.after,value:new Nd(this.groupId,this.uuid,t)}}getSplit(e,t){}copyTo(e,t){return new Nd(this.groupId,this.uuid,this.noShift)}canTile(e,t){return!1}},fx=class Od{constructor(e,t,n,r,o,i,l,a,c,u){this.uuid=e,this.spatialsIds=t,this.isRanges=r,this.coords=n,this.sheet=o,this.generation=i,this.handler=l,this.handlerW=a,this.removeListener=c,this.options=u}delete(){this.removeListener()}createRangeEvent(e,t){const n=this;let r;const o=()=>{if(r)return r;const l=n.sheet,a=n.isRanges,c=n.coords;return t||!c||c.length===0?Nr(l,l.getEntireRange().getCoords(),null,t):a?(r=l.getRanges(n.coords),r):(r=l.getRange(n.coords[0]),r)},i=e.trigger;return{getSource:o,getFrom:()=>null,getTo:()=>null,trigger:i,isTransactional:e.isTransactional??!0,toString:()=>`SheetRangeEvent: ('${i}', ${o().toString()})`,timeStamp:e.timeStamp??Date.now()}}notify(e,t){const n=this.createRangeEvent(e,t),r=this.handler??this.handlerW.deref();try{r?.(n)}catch(o){console.warn(o)}this.options?.once&&this.removeListener()}processRemove(e){const t=this.spatialsIds,n=t.indexOf(e.value.uuid);console.assert(n!==-1,"invalid uuid");const r=this.coords,o=r.slice(0,n).concat(r.slice(n+1)),i=t.slice(0,n).concat(t.slice(n+1));return new Od(this.uuid,i,o,this.isRanges,this.sheet,this.generation,this.handler,this.handlerW,this.removeListener,this.options)}processShift(e){const t=this.spatialsIds.indexOf(e.value.uuid);console.assert(t!==-1,"invalid uuid");const n=[...this.coords];return n[t]={...n[t],...q.sanitizeRange(e)},new Od(this.uuid,this.spatialsIds,n,this.isRanges,this.sheet,this.generation,this.handler,this.handlerW,this.removeListener,this.options)}processSplit(e){}processMerge(e){}};const jS=Object.freeze({coords:q.EmptyCell,topLeft:zr.EmptyTopLeft}),mx=Object.freeze({cell:q.EmptyCell,ranges:P.EmptyArray,rangeIndex:0}),Nu=Object.freeze({selection:mx,topLeft:zr.EmptyTopLeft,freezePanes:jS,showRowHeaders:!0,showColumnHeaders:!0,showRowGridlines:!0,showColumnGridlines:!0,rowHeaderStyle:dn.HeaderTextStyle.One,columnHeaderStyle:dn.HeaderTextStyle.A1,showFormulas:!1,showZeros:!0,zoomScale:100,gridLineColor:null});let Ou=class{constructor(e){if(this._emitter=null,!e?.sheet)throw new Error("SheetView requires a sheet.");const t=new gn(this);this._emitter=t,this._sheet=e.sheet,this.clear(!1),e.json&&this._fromJSON(e.json)}addListeners(e,t){return this._emitter.addListeners(e,t)}setTopLeft(e){const t=this._state,n=t.topLeft;return t.topLeft=Object.freeze({left:e?.left??n.left,top:e?.top??n.top}),this._emitter.notify("onTopLeftChange"),this}getTopLeft(){return this._state.topLeft}getFreezePanes(){return this._state.freezePanes}setFreezePanes(e){return this._state.freezePanes=this._mergeFreezePanes(e),this._emitter.notify("onFreezeSplitChange"),this}_mergeFreezePanes(e){return e?{...this._state.freezePanes,coords:{colIndex:e?.coords?.colIndex??this._state.freezePanes.coords.colIndex,rowIndex:e?.coords?.rowIndex??this._state.freezePanes.coords.rowIndex},topLeft:{left:e?.topLeft?.left??this._state.topLeft.left,top:e?.topLeft?.top??this._state.topLeft.top}}:jS}isShowRowHeaders(){return this._state.showRowHeaders}setShowRowHeaders(e){return this._state.showRowHeaders=e,this._notifyAll(),this}isShowColumnHeaders(){return this._state.showColumnHeaders}setShowColumnHeaders(e){return this._state.showColumnHeaders=e,this._notifyAll(),this}isShowRowGridlines(){return this._state.showRowGridlines}setShowRowGridlines(e){return this._state.showRowGridlines=e,this._notifyAll(),this}isShowColumnGridlines(){return this._state.showColumnGridlines}setShowColumnGridlines(e){return this._state.showColumnGridlines=e,this._notifyAll(),this}getRowHeaderStyle(){return this._state.rowHeaderStyle}setRowHeaderStyle(e){return this._state.rowHeaderStyle=e,this._notifyAll(),this}getColumnHeaderStyle(){return this._state.columnHeaderStyle}setColumnHeaderStyle(e){return this._state.columnHeaderStyle=e,this._notifyAll(),this}getZoomScale(){return this._state.zoomScale}setZoomScale(e){return this._state.zoomScale=e,this._notifyAll(),this}isShowFormulas(){return this._state.showFormulas}setShowFormulas(e){return this._state.showFormulas=e,this._notifyAll(),this}isShowZeros(){return this._state.showZeros}setShowZeros(e){return this._state.showZeros=e,this._notifyAll(),this}getGridLineColor(){return this._state.gridLineColor}setGridLineColor(e){return this._state.gridLineColor=e,this._notifyAll(),this}setRangeSelection(e){return this._state.selection=e,this._emitter.notify("onRangeSelectionChange"),this}getRangeSelection(){return this._state.selection}getMovableSelection(){return this._movableSelection}setMovableSelection(e){const t=this._movableSelection;return this._movableSelection=Object.freeze(e??[]),P.isEqualArrays(t,this._movableSelection)||this._emitter.notify("onMovableSelectionChange"),this}selectMovables(e,t=!1){const n=new Set(this._sheet.getMovables().getItems());let r=null,o=!1;if(t){r=[...this._movableSelection];for(let i=e.length-1;i>=0;i--){const l=e[i];let a=r.indexOf(l);if(a!==i){if(o=!0,!n.has(l))throw new Error(`Movable ${l.getName()} not found in sheet.`);a!==-1&&r.splice(a,1),r.unshift(l)}}}else o=!P.isEqualArrays(e,this._movableSelection),r=[...e];o&&(this._movableSelection=r,this._emitter.notify("onRangeSelectionChange"),this._emitter.notify("onMovableSelectionChange"))}unselectMovables(e){const t=this._movableSelection,n=[];for(let r=0;r<t.length;r++){const o=t[r];e.indexOf(o)===-1&&n.push(o)}return t.length!==n.length&&(this._movableSelection=n,this._emitter.notify("onRangeSelectionChange"),this._emitter.notify("onMovableSelectionChange")),this}_notifyAll(){const e=this._emitter;e.notify("onRangeSelectionChange"),e.notify("onTopLeftChange"),e.notify("onFreezeSplitChange"),e.notify("onAnyChange")}toJSON(){const e={},t=Object.keys(this._state);for(let r=0;r<t.length;r++){const o=this._state[t[r]];o!=null&&o!==Nu[t[r]]&&(e[t[r]]=o)}delete e.movableSelection,delete e.gridLineColor,this._state.gridLineColor instanceof Gt&&(e.gridLineColor=this._state.gridLineColor.toString()),delete e.topLeft,!this._state.topLeft||this._state.topLeft.left===0&&this._state.topLeft.top===0||(e.topLeft={left:this._state.topLeft.left??0,top:this._state.topLeft.top??0}),delete e.selection;const n=this._state.selection;if(n){let r={};!n.cell||n.cell.colIndex===0&&n.cell.rowIndex===0||(r.cell=Gi(n.cell)),n.ranges&&n.ranges.length>0&&(r.ranges=sh(n.ranges),n.rangeIndex!==void 0&&n.rangeIndex!==-1&&n.rangeIndex!==0&&(r.rangeIndex=n.rangeIndex)),Object.keys(r).length>0&&(e.selection=r)}if(delete e.freezePanes,this._state.freezePanes&&(this._state.freezePanes.coords.colIndex!==0||this._state.freezePanes.coords.rowIndex!==0)){const r={};this._state.freezePanes.coords.colIndex!==0&&(r.c=this._state.freezePanes.coords.colIndex),this._state.freezePanes.coords.rowIndex!==0&&(r.r=this._state.freezePanes.coords.rowIndex),this._state.freezePanes.topLeft.left!==0&&(r.x=this._state.freezePanes.topLeft.left),this._state.freezePanes.topLeft.top!==0&&(r.y=this._state.freezePanes.topLeft.top),e.freezePanes=r}return Object.keys(e).length===0?null:e}_fromJSON(e){let t=JSON.parse(JSON.stringify(e||{}));t?.zoomScale&&(t.zoomScale=P.roundAccurately(parseFloat(e.zoomScale),2));const n=r=>{const o=this._sheet.getRange(r).getBounds(),i=(t.zoomScale??100)/100;return{x:o.x*i,y:o.y*i,width:o.width*i,height:o.height*i}};if(typeof t?.gridLineColor=="string"&&(this._sheet?.getStyles()?t.gridLineColor=this._sheet.getStyles().parseColor(e.gridLineColor):console.warn("Style was created with no styles so gridLineColor can't be parsed.")),t.topLeft)if(typeof t.topLeft=="string"){const r=n(is(t.topLeft));t.topLeft={left:r.x,top:r.y}}else t.topLeft=Object.freeze({left:t.topLeft?.left??t?.x??0,top:t.topLeft?.top??t?.y??0});if(t.selection){let r=is(t.selection.cell??"A1");if(t.selection.cell=r,t.selection.ranges){let o=Math.max(0,Math.min(t.selection.rangeIndex??t.selection.ranges?.length-1,t.selection.ranges?.length-1));t.selection.rangeIndex=o;let i=!1;for(let l=0;l<t.selection.ranges.length;l++){const a=Ln(t.selection.ranges[l]);t.selection.ranges[l]=a,l===o&&r&&!q.isCellWithinRange(r,a)&&(i=!0)}if(i)for(let l=0;i&&l<t.selection.ranges.length;l++)q.isCellWithinRange(r,t.selection.ranges[l])&&(i=!1,t.selection.rangeIndex=l);i&&(t.selection.ranges.push(q.cellToRange(r)),t.selection.rangeIndex=t.selection.ranges.length-1)}else delete t.selection.rangeIndex}if(t.freezePanes){const r=t.freezePanes;if(typeof r.coords=="string"&&(r.coords=is(r.coords)),typeof r.topLeft=="string"){const o=is(r.topLeft),i=n({colIndex:o.colIndex+1,rowIndex:o.rowIndex+1}),l=n({colIndex:(r?.coords?.colIndex??-1)+1,rowIndex:(r?.coords?.rowIndex??-1)+1});r.topLeft={left:0,top:0},t.topLeft||(t.topLeft={top:0,left:0}),o.colIndex>0&&(r.topLeft.left=t.topLeft?.left??0,t.topLeft.left=i.x-l.x+r.topLeft.left),o.rowIndex>0&&(r.topLeft.top=t.topLeft?.top??0,t.topLeft.top=i.y-l.y+r.topLeft.top)}t.freezePanes={coords:{colIndex:r?.coords?.colIndex??t.freezePanes?.c??0,rowIndex:r?.coords?.rowIndex??t.freezePanes?.r??0},topLeft:{left:r?.topLeft?.left??t.freezePanes?.x??0,top:r?.topLeft?.top??t.freezePanes?.y??0}}}this.update(t)}clear(e=!0){return this._state={...Nu},this._movableSelection=Object.freeze([]),e&&this._notifyAll(),this}update(e){return this._state={...Nu,...this._state,...e},this._state.freezePanes=this._mergeFreezePanes(this._state.freezePanes),this._state.zoomScale=Math.min(400,Math.max(10,this._state.zoomScale)),this._notifyAll(),this}get isISheetView(){return!0}};async function Fm(){const{getCrypto:s}=await ao(async()=>{const{getCrypto:e}=await import("./Due-pSw1d9_zz_19-CP_8uZ89.js");return{getCrypto:e}},[],import.meta.url);return s()}const Nm=async(s,e,...t)=>{const n=px(...t);return s.subtle.digest(e,n)},px=(...s)=>{const e=s.reduce((r,o)=>r+o.byteLength,0),t=new Uint8Array(e);let n=0;return s.forEach(r=>{t.set(new Uint8Array(r),n),n+=r.byteLength}),t.buffer},Om=s=>{const e=new Uint8Array(s);let t="";for(let n=0;n<e.byteLength;n++)t+=String.fromCharCode(e[n]);return btoa(t)},mr=class mr{static async generateSaltAndHash(e,t=mr.DefaultAlgo,n=mr.DefaultSpinCount){if(!e)return null;const r=(await Fm()).getRandomValues(new Uint8Array(16)),o=Om(r.buffer);return{salt:o,hash:await mr._convertPasswordToHash(e,o,t,n)}}static async verifyPassword(e,t,n=mr.DefaultAlgo,r=mr.DefaultSpinCount){if(!e||!t)throw new lr;return((o,i)=>{const l=o.length,a=i.length;let c=l===a?0:1;for(let u=0;u<Math.max(l,a);u++)c|=o.charCodeAt(u%l)^i.charCodeAt(u%a);return c===0})(await mr._convertPasswordToHash(e,t.salt,n,r),t.hash)}static async _convertPasswordToHash(e,t,n,r){const o=await Fm();n=n.toUpperCase();const i=(c=>{const u=new ArrayBuffer(2*c.length),d=new DataView(u);for(let h=0;h<c.length;h++)d.setUint16(2*h,c.charCodeAt(h),!0);return new Uint8Array(u)})(e),l=(c=>{const u=atob(c),d=new Uint8Array(u.length);for(let h=0;h<u.length;h++)d[h]=u.charCodeAt(h);return d.buffer})(t);let a=await Nm(o,n,l,i.buffer);for(let c=0;c<r;c++){const u=new Uint32Array([c]).buffer;a=await Nm(o,n,a,u)}return Om(a)}};mr.DefaultAlgo="SHA-512",mr.DefaultSpinCount=1e5;let za=mr;class GS{constructor(e,t=!1){this._emitter=null,this._emitter=new gn(this),this.fromJSON(e),this._isReadOnly=t}async lock(e,t,n,r){if(this._isReadOnly)return this;if(this.isLocked()&&!this._isPaused)throw new Error("Cannot lock an already locked object. Use unlock first.");try{this._validatePassword()}catch{throw new Error("A password is already set. Unlock first to change.")}let o;if(t){const i=await za.generateSaltAndHash(t,n,r);o={salt:i.salt,hash:i.hash},n&&(o.algorithm=n),r&&(o.spinCount=r)}else o=null;return e=e??{},this._updateProperties(e),this._properties=e,this._password=o,this._emitter.notify("onLockChange"),this._emitter.notify("onChange"),this}async unlock(e){if(this._isReadOnly)throw new Error("Cannot unlock a readonly workbook.");return await this._validatePassword(e),this._clearProperties(),this._password=null,this._identities=null,this._password=null,this._emitter.notify("onLockChange"),this._emitter.notify("onChange"),this}checkPassword(e){return this._validatePassword(e)}hasPassword(){return this._password!==null}async pause(e){return this._emitter.notify("onLockChange"),this._emitter.notify("onChange"),await this._validatePassword(e),this._password&&(this._isPaused=!0),this}resume(){return this._isPaused=!1,this}isPaused(){return this._isPaused}isLocked(){return this._properties!==null&&!this._isPaused}isReadOnly(){return this._isReadOnly}async _validatePassword(e){const t=this._password;if(!(e&&e.length!==0||t&&t.hash))return!0;if(!e)throw new Error("Password is required.");if(!await za.verifyPassword(e,{salt:t.salt,hash:t.hash},t.algorithm,t.spinCount))throw new Error("Invalid password.");return!0}getProperties(){return this._properties}_isPropertyAllowed(e){if(this._isReadOnly)return!1;if(!this.isLocked())return!0;const t=this._properties[e];return typeof t=="boolean"&&t}_updateProperties(e){this._properties={...e,...this._properties??{}}}_clearProperties(){this._properties=null}addListeners(e,t){return this._emitter.addListeners(e,t)}fromJSON(e){this._password=null,this._identities=null,this._isPaused=!1,this._properties=null,this._fromJSON(e??null),e&&(e.password&&(this._password=e.password),e.identities&&(this._identities=e.identities))}_fromJSON(e){}_toJSON(e){return e}toJSON(){if(!this._properties)return null;let e={};return e=this._toJSON(e)??{},this._password&&(e.password=this._password),this._identities&&(e.identities=this._identities),e}}const Sx=Object.freeze({selectLockedCells:!0,selectUnlockedCells:!0,autoFilter:!1,deleteColumns:!1,deleteRows:!1,formatCells:!1,formatColumns:!1,formatRows:!1,insertColumns:!1,insertHyperlinks:!1,insertRows:!1,objects:!1,pivotTables:!1,scenarios:!1,sheet:!1,sort:!1,verifier:null});class Dm extends GS{isAutoFilterAllowed(){return this._isPropertyAllowed("autoFilter")}isDeleteColumnsAllowed(){return this._isPropertyAllowed("deleteColumns")}isDeleteRowsAllowed(){return this._isPropertyAllowed("deleteRows")}isFormatCellsAllowed(){return this._isPropertyAllowed("formatCells")}isFormatColumnsAllowed(){return this._isPropertyAllowed("formatColumns")}isFormatRowsAllowed(){return this._isPropertyAllowed("formatRows")}isInsertColumnsAllowed(){return this._isPropertyAllowed("insertColumns")}isInsertHyperlinksAllowed(){return this._isPropertyAllowed("insertHyperlinks")}isInsertRowsAllowed(){return this._isPropertyAllowed("insertRows")}isObjectsAllowed(){return this._isPropertyAllowed("objects")}isPivotTablesAllowed(){return this._isPropertyAllowed("pivotTables")}isScenariosAllowed(){return this._isPropertyAllowed("scenarios")}isSortAllowed(){return this._isPropertyAllowed("sort")}isSelectLockedCellsAllowed(){return!1}isSelectUnlockedCellsAllowed(){return!1}_updateProperties(e){super._updateProperties(e),this._properties=e}_clearProperties(){super._clearProperties(),this._properties=null}_fromJSON(e){super._fromJSON(e),this._properties=e}_toJSON(e){let t=this._properties;if(t){e={...e,...t};const n=Object.keys(t);for(let r=0;r<n.length;r++){const o=t[n[r]];o!=null&&o!==Sx[n[r]]&&(e[n[r]]=o)}}return super._toJSON(e)}get[Symbol.toStringTag](){return"[SheetProtection]"}toString(){return null}}let hh=class US{constructor(e,t,n){this._coords=Object.freeze(e),this._sheet=t,this._readOnly=n?.readOnly??null}_createRanges(e,t){let n=this._options;return t&&(n={...this._options,getOptions:Br(this._options?.getOptions,t)}),new US(e,this._sheet,n)}_createRange(e,t){let n=this._options;return t&&(n={...this._options,getOptions:Br(this._options?.getOptions,t)}),new gh(e,this._sheet,n)}_validateWrite(){const e=this._readOnly;if(e)throw new Error(e)}getCoords(){return this._coords}[Symbol.iterator](){const e=this.entries({ignoreCellDetails:!0});return{next(){const t=e.next();return t.done?xt:{done:!1,value:t.value.value}},[Symbol.iterator](){return this}}}entries(e){const t=this.getCoords(),n=e?.reverse??!1;let r=n?t.length-1:0;const o=this;let i=o._createRange(t[r]),l=i.entries(e),a=l.next();return{next(){let c=a;do{if(a.done){if(r=n?r-1:r+1,r>=t.length||r<0)return a=xt,c;i=o._createRange(t[r]),l=i.entries(e)}a=l.next()}while(a.done);return c},[Symbol.iterator](){return this}}}async select(e){const t=await this._sheet._autoSelect(e??!0,Rt(this.getCoords()));return this._createRanges(t)}calculate(){const e=this.getCoords();return this._sheet._calculate(e),this}addListener2(e,t){return this._sheet._addRangesListeners2(this.getCoords(),e,t,!0)}addListener(e,t){return this._sheet._addRangesListeners(this.getCoords(),e,t)}find(e){return this._sheet._find(this.getCoords(),e)}getFlattened(e){const t=this.getCoords();if(t.length===1)return this._createRanges(t,e);const n=e?.orientations??B.Orientations.Both,r=n===B.Orientations.Both,o=r?Number.MAX_SAFE_INTEGER:1,i=n===B.Orientations.Row?B.Orientation.Column:B.Orientation.Row;let l=cd(t,o,i);if(r){const a=cd(t,o,B.Orientation.Column);a.length<l.length&&(l=a)}return this._createRanges(l,e)}getVisible(e){const t=this._sheet._getVisible(this.getCoords(),e);return t&&t.length!==0?this._createRanges(t,e):null}getFixed(e){const t=[],n=this.getCoords();for(let r=0;r<n.length;r++)t.push(FS(n[r],e));return this._createRanges(t,e)}autoFit(e){return this._validateWrite(),this._sheet._autoFit(this.getCoords(),e),this}clear(e,t){return this._validateWrite(),this._sheet._clear(this.getCoords(),e,t),this}getStyle(){return this._sheet._getStyle(this.getCoords())}merge(e){return this._validateWrite(),this._sheet._merge(this.getCoords(),e),this}unmerge(e){return this._validateWrite(),this._sheet._unmerge(this.getCoords(),e),this}getMerges(){return this._sheet._getMerges(this.getCoords(),this._options?.ignoreHidden??!1)}insert(e){return this._validateWrite(),this._sheet._insertCells(this.getCoords(),e),this}delete(e){return this._validateWrite(),this._sheet._deleteCells(this.getCoords(),e),this}async insertFrom(e,t){this._validateWrite();const n=await this._sheet._insertFrom(this.getCoords(),e,t);return n?this._createRanges([n]):null}async copyFrom(e,t){const n=await this._sheet._copyFrom(this.getCoords()[0],e,t);return n?this._createRanges([n]):null}isInvalidAny(){const e=this.getCoords();if(!e||e.length===0)return!0;for(let t=0;t<e.length;t++)if(e[t]===null)return!0;return!1}getSnapshot(e){return this._sheet._getSnapshot(this.getCoords(),e)}getEntireRows(e,t){return this._createRanges(Fa(this.getCoords(),this._sheet._entireCoords,B.Orientation.Column,e),t)}getEntireColumns(e,t){return this._createRanges(Fa(this.getCoords(),this._sheet._entireCoords,B.Orientation.Row,e),t)}getRowHeaders(e){const t=this.getCoords();return this._sheet._rowHeaders.getRanges(t,e)}getColumnHeaders(e){const t=this.getCoords();return this._sheet._colHeaders.getRanges(t,e)}getDefaultShiftOrientation(){return this._sheet._getDefaultShiftOrientation(this.getCoords()[0])}getCount(){return this.getCoords()?.length??0}getCounts(e){return this._sheet._contentCounts(this.getCoords(),e,this._options?.ignoreHidden??!1)}isContentful(){return this._sheet._isContentful(this.getCoords(),this._options?.ignoreHidden??!1)}getRowCount(){return this._sheet.getRowHeaders().getRanges(this.getCoords()).getHeaderCount()}getColumnCount(){return this._sheet.getColumnHeaders().getRanges(this.getCoords()).getHeaderCount()}isEntireRowsAny(){return this._sheet.getRowHeaders().getRanges(this.getCoords()).isEntireHeadersAny()}isEntireColumnsAny(){return this._sheet.getColumnHeaders().getRanges(this.getCoords()).isEntireHeadersAny()}isEntireRows(){return this._sheet.getRowHeaders().getRanges(this.getCoords()).isEntireHeaders()}isEntireColumns(){return this._sheet.getColumnHeaders().getRanges(this.getCoords()).isEntireHeaders()}isOverlapping(){return wi(this.getCoords())}at(e){const t=this.getCoords();if(e<0||e>t.length-1)throw new Tt;return this._createRange(t[e])}isReadOnly(){return this._readOnly!==null}isInvalid(){return!1}getA1(){return sS(this.getCoords(),this._sheet._entireCoords,wr,co)}getSheet(){return this._sheet}doBatch(e,t){return this._sheet.doBatch(n=>e(n),typeof t=="string"?t:{description:"Ranges Update",...t})}get[Symbol.toStringTag](){return"[SheetRanges]"}toString(){return this.getA1()}get isICellRanges(){return!0}},gh=class qS{constructor(e,t,n){this._coords=Object.freeze(e),this._sheet=t,this._readOnly=n?.readOnly??null}getCoords(){return this._coords}_createRange(e,t){const n=this._sheet;if(!e)return Nr(n,n._entireCoords);if(n._validateCoords(e),n._closed)return Nr(null,n._entireCoords,e);let r=this._options;return t&&(r={...this._options,getOptions:Br(this._options?.getOptions,t)}),new qS(e,this._sheet,r)}_createRanges(e,t){let n=this._options;return t&&(n={...this._options,getOptions:Br(this._options?.getOptions,t)}),new hh(e,this._sheet,n)}_deriveRanges(e,t){const n=this.getCoords();let r=n;return t&&(r=t(n),!r)?null:this._createRanges(r,e)}_deriveRange(e,t,n){if(!e)return this;let r=this._sheet._rangeToCoords(e);if(!r)return this;const o=this.getCoords();if(bi(r,o))return this;if(n){const a=n(r,o);if(!a)return null;r={...o,...a}}var i,l;return i=r,(l=o)&&(l.$colStart===void 0?delete i.$colStart:i.$colStart=l.$colStart,l.$rowStart===void 0?delete i.$rowStart:i.$rowStart=l.$rowStart,l.$colEnd===void 0?delete i.$colEnd:i.$colEnd=l.$colEnd,l.$rowEnd===void 0?delete i.$rowEnd:i.$rowEnd=l.$rowEnd),this._createRange(r,Br(this._options?.getOptions,t))}_validateMaxSize(e=5e4){const t=this.getCoords(),n=this._sheet,r=n._colHeaders.getVisibleCount(t.colStart,t.colEnd);if(n._rowHeaders.getVisibleCount(t.rowStart,t.rowEnd)*r>e)throw new Pe(hS(e))}entries(e){const t=this.getCoords();let n=t;const r=this._sheet;if(e?.address){const i=r._rangeToCoords(e?.address);if(!i)throw new Pe(ms(e?.address));if(n=q.intersectRanges(i,t),!n)return Qt}n.colEnd<n.colStart&&(n.colStart=t.colStart,n.colEnd=t.colEnd),n.rowEnd<n.rowStart&&(n.rowStart=t.rowStart,n.rowEnd=t.rowEnd);const o=this._options?.ignoreHidden??!1;return r._cellIterator({ignoreHidden:o,...e,includeRangeTypes:!e?.ignoreCellDetails,bounds:n})}[Symbol.iterator](){return this.values()}values(e){const t=this.entries({...e,ignoreCellDetails:!0});return{next(){const n=t.next();return n.done?xt:{done:!1,value:n.value.value}},[Symbol.iterator](){return this}}}forEach(e,t){if(!e)return;const n=this.entries(t);let r=n.next();for(;!r.done;){const o=r.value,i=e(o.value,o.context);if(i)return i.break;r=n.next()}}_validateWrite(){const e=this._readOnly;if(e)throw new Pe(e)}updateCells(e,t,n){this._validateWrite();const r=this.getCoords();n||(n=r);const o=this._sheet,i=o._isDataColumn,l={majorStart:i?r.colStart:r.rowStart,majorEnd:i?r.colEnd:r.rowEnd,minorStart:i?r.rowStart:r.colStart,minorEnd:i?r.rowEnd:r.colEnd},a=(t?.orientation??B.Orientation.Row)===B.Orientation.Column!==i,c=Ia(Array.isArray(e)?e:[[e]],a,l);return o._updateTuples(c,{description:t?.description??`Set ${q.isSingleCell(n)?"Cell":"Range"} ${wr(n,o._entireCoords)}`,...t},null,{isCell:!0}),this}setValues(e,t){if(!Array.isArray(e))throw new Pe("'setValues' expects a 2d array; when working with a single value use 'setValue'.");return this._setValueOrValues(e,t)}setValue(e,t){if(Array.isArray(e))throw new Pe(Mf);return this._setValueOrValues(e,t)}setFormula(e,t){if(Array.isArray(e))throw new Pe(Mf);return this._setValueOrValues(e,t)}_setValueOrValues(e,t){this._validateWrite();let n=this.getCoords(),r=this;const o=this._sheet,i=o._isDataColumn,l=(t?.orientation??B.Orientation.Row)===B.Orientation.Column,a=Array.isArray(e);if(t?.skipBoundsCheck&&a){const h=e;let f=Math.max(0,h.length-1),g=0;for(let w=0;w<h.length;w++)g=Math.max(g,h[w].length-1);const m=l?n.colStart:n.rowStart,p=l?n.rowStart:n.colStart,S={...n,colEnd:l?m+f:p+g,rowEnd:l?p+g:m+f};q.isEqualRanges(S,n)||(n=S,r=this._deriveRange(S,t)??this)}const c={majorStart:i?n.colStart:n.rowStart,majorEnd:i?n.colEnd:n.rowEnd,minorStart:i?n.rowStart:n.colStart,minorEnd:i?n.rowEnd:n.colEnd},u=l!==i;let d=null;return d=a?Ia(Array.isArray(e)?e:[[e]],u,c):na(e,c,i),o._updateTuples(d,{description:t?.description??`Set ${q.isSingleCell(n)?"Value":"Values"} ${wr(n,o._entireCoords)}`,...t}),r}getValues(e){this._validateMaxSize(e?.maxSize);const t=this.getCoords(),n=this._sheet;return mu(n._cellIterator.bind(this._sheet),t,!1,e)}toText(e){this._validateMaxSize(e?.maxSize);const t=this.getCoords();return((n,r,o)=>{const i={[je.Type.Style]:!1,[je.Type.Table]:!1},l=o?.orientation??B.Orientation.Row,a=o?.maxSize??1e4,c=n({includeEmpty:!0,orientation:l,reverse:o?.reverse,ignoreHidden:o?.ignoreHidden,includeMergeOverflow:o?.includeMergeOverflow,includeRangeTypes:i,bounds:r}),u=l!==B.Orientation.Row,d=o?.ignoreFormatting??!1;let h,f=-1,g=0,m=0;h=c.next();let p="";for(;!h.done;){if(g>a||p.length>32767e3)return p+"...";const S=h.value,w=S.context.getCoords(),b=u?w.colIndex:w.rowIndex;b!==f&&(f!==-1&&(p+=`
`),f=b,m=0);const C=S.context.getCell();let _=d?C.toTextUnformatted():C.toText();C.getType()===Le.String&&(w0(_)||(_=`"${_}"`)),m>0&&(p+=","),p+=_,h=c.next(),m++,g++}return p})(this._sheet._cellIterator.bind(this._sheet),t,e)}getValue(e){const t=this.getCoords();return this._sheet._getScalar(t.rowStart,t.colStart,e?.asJSDate)}calculate(e){return this._sheet._calculate([this.getCoords()],{full:e}),this}getCells(e){this._validateMaxSize(e?.maxSize);const t=this.getCoords(),n=this._sheet;return mu(n._cellIterator.bind(this._sheet),t,!0,e)}getCell(e){const t=this.getCoords();let n=t.colStart,r=t.rowStart;const o=this._sheet;if(e){const l=o._cellToCoords(e);if(!q.isCellWithinRange(l,t))throw new Pe("The cell is outside of the bounds of the range.");n=l.colIndex,r=l.rowIndex}const i=mu(o._cellIterator.bind(this._sheet),{colStart:n,rowStart:r,colEnd:n,rowEnd:r},!0,null);return i.length===0?o._emptyCell:i[0][0]}async select(e){const t=this._sheet,n=await t._autoSelect(e??!0,Rt([this.getCoords()]));return this._createRange(n[0])}find(e){return this._sheet._find([this.getCoords()],e)}getFixed(e){return this._createRange(FS(this.getCoords(),e))}getSurrounding(e){const t=this._sheet;return this._createRange(t._surroundingRegion(this.getCoords(),e))}getExtended(e,t){let n=null;const r=this.getCoords();switch(e){case B.Direction.Up:n={colIndex:r.colStart,rowIndex:r.rowStart};break;case B.Direction.Down:n={colIndex:r.colStart,rowIndex:r.rowEnd};break;case B.Direction.Left:n={colIndex:r.colStart,rowIndex:r.rowStart};break;case B.Direction.Right:n={colIndex:r.colEnd,rowIndex:r.rowStart}}const o=this._sheet,i=t?o._cellToCoords(t):n;if(!q.isCellWithinRange(i,r))throw new Pe("Invalid cell.");let l=o._extendRange(e,i);return l=q.unionRanges(r,l),this._createRange(l)}getEntireRows(e,t){const n=this._sheet;return this._createRange(Fa([this.getCoords()],n._entireCoords,B.Orientation.Column,e)[0],t)}getEntireColumns(e,t){const n=this._sheet;return this._createRange(Fa([this.getCoords()],n._entireCoords,B.Orientation.Row,e)[0],t)}getRowHeaders(e){const t=this.getCoords();return this._sheet._rowHeaders.getRange(t,e)}getColumnHeaders(e){const t=this.getCoords();return this._sheet._colHeaders.getRange(t,e)}getDifferences(e,t){return this._deriveRanges(t,n=>{const r=this._sheet,o=r._rangeToCoords(e),i=gd(n,o,B.Orientation.Row);return r._getVisible(i,t)})}getIntersect(e,t){return this._deriveRange(e,t,(n,r)=>q.intersectRanges(n,r))}getUnion(e,t){return this._deriveRange(e,t,(n,r)=>q.unionRanges(n,r))}getResizeTo(e,t,n){if(t=t??0,(e=e??0)<0||t<0)throw new Pe("Invalid range. The Range must be at a size of at least 1x1'.");const r=this.getCoords();return this._deriveRange({colStart:r.colStart,rowStart:r.rowStart,colEnd:t+r.colStart-1,rowEnd:e+r.rowStart-1},n)}getResizeBy(e,t,n){e=e??0,t=t??0;const r=this.getCoords();return this._deriveRange({colStart:r.colStart,rowStart:r.rowStart,colEnd:r.colEnd+t,rowEnd:r.rowEnd+e},n)}getOffsetTo(e,t,n){const r=this.getCoords(),o=t,i=e,l={colStart:o,rowStart:i,colEnd:r.colEnd-r.colStart+o,rowEnd:r.rowEnd-r.rowStart+i};return this._deriveRange(l,n)}getOffsetBy(e,t,n){const r=this.getCoords(),o=r.colStart+e,i=r.rowStart+t,l={colStart:o,rowStart:i,colEnd:r.colEnd-r.colStart+o,rowEnd:r.rowEnd-r.rowStart+i};return this._deriveRange(l,n)}getUsedRange(e){const t=this._sheet._getUsedCoords(e);if(!t)return null;const n=q.intersectRanges(t,this.getCoords());return n?this._deriveRange(n,e):null}isEmpty(){const e=this._sheet._getUsedCoords();return e?!q.intersectRanges(e,this.getCoords()):!0}getColumnStart(){return this.getCoords().colStart}getRowStart(){return this.getCoords().rowStart}getColumnEnd(){return this.getCoords().colEnd}getRowEnd(){return this.getCoords().rowEnd}getColumnCount(){const e=this.getCoords();return e.colEnd-e.colStart+1}getRowCount(){const e=this.getCoords();return e.rowEnd-e.rowStart+1}getVisible(e){return this._deriveRanges(e,t=>this._sheet._getVisible([t],e))}isContentful(e){return this._sheet._isContentful([this.getCoords()],e,this._options?.ignoreHidden??!1)}getCounts(e){return this._sheet._contentCounts([this.getCoords()],e,this._options?.ignoreHidden??!1)}getCount(e){return this._sheet._getCount([this.getCoords()],e,this._options?.ignoreHidden??!1)}isEntireRows(){const e=this._sheet;return xd([this.getCoords()],e._entireCoords,!0)}isEntireColumns(){const e=this._sheet;return Ed([this.getCoords()],e._entireCoords,!0)}isEntireRange(){const e=this.getCoords(),t=this._sheet;return Ed([e],t._entireCoords,!0)&&xd([e],t._entireCoords,!0)}getWidth(){const e=this._coords;return e.colEnd-e.colStart+1}getHeight(){const e=this._coords;return e.rowEnd-e.rowStart+1}get size(){const e=this._coords;return e.colEnd-e.colStart+1*(e.rowEnd-e.rowStart+1)}getBounds(){return this._sheet._getBoundsAtCoords(this.getCoords())}isInvalid(){return!1}getDefaultShiftOrientation(){return this._sheet._getDefaultShiftOrientation(this.getCoords())}getDefaultSortCriteria(e,t){return this._sheet._getDefaultSortCriteria(this.getCoords(),e,t)}getMerges(){return this._sheet._getMerges([this.getCoords()],this._options?.ignoreHidden??!1)}getSnapshot(e){return this._sheet._getSnapshot([this.getCoords()],e)}isReadOnly(){return this._readOnly!==null}addListener2(e,t){return this._sheet._addRangesListeners2([this.getCoords()],e,t,!1)}addListener(e,t){return this._sheet._addRangesListeners([this.getCoords()],e,t)}getSheet(){return this._sheet}autoFill(e,t){this._validateWrite();const n=this._sheet,r=n._rangeToCoords(e,()=>[],!0);return n._autoFill(this.getCoords(),r,t)?this._createRange(r):this}autoFit(e){return this._validateWrite(),this._sheet._autoFit([this.getCoords()],e),this}clear(e,t){return this._validateWrite(),this._sheet._clear([this.getCoords()],e,t),this}setHyperlink(e,t){return this._validateWrite(),this._sheet._setHyperlinks([this.getCoords()],e,t),this}setComments(e,t){return this._validateWrite(),this._sheet._setComments([this.getCoords()],e,t),this}getStyle(){return this._sheet._getStyle([this.getCoords()])}merge(e){return this._validateWrite(),this._sheet._merge([this.getCoords()],e),this}unmerge(e){return this._validateWrite(),this._sheet._unmerge([this.getCoords()],e),this}insert(e){return this._validateWrite(),this._sheet._insertCells([this.getCoords()],e),this}async insertFrom(e,t){this._validateWrite();const n=this._sheet,r=await n._insertFrom([this.getCoords()],e,t);return r?this._createRange(r):null}async copyFrom(e,t){this._validateWrite();const n=this._sheet,r=await n._copyFrom(this.getCoords(),e,t);return r?this._createRange(r):null}delete(e){return this._validateWrite(),this._sheet._deleteCells([this.getCoords()],e),this}sort(e){this._validateWrite();const t=this.getCoords(),n=this._sheet._sort(t,e);return q.isEqualRanges(n,t)?this:this._createRange(n)}doBatch(e,t){return this._sheet.doBatch(n=>e(n),typeof t=="string"?t:{description:"Range Update",...t})}startIncrementalUpdates(e){return this._sheet._createIncrementalUpdater(e,this)}getA1(){const e=this._sheet;return wr(this.getCoords(),e._entireCoords)}get[Symbol.toStringTag](){return"[SheetRange]"}toString(){const e=this._sheet;return wr(this.getCoords(),e._entireCoords)}get isICellRange(){return!0}};const Fl={width:Math.pow(2,14),height:Math.pow(2,20)},Lm=s=>`${s}`,Bm=s=>ar(s),zm=s=>`${s+1}`;let wx=0;const Pm=()=>[];let _x=0,Dd=class JS{constructor(e){this._lastTransactionUUID=null,this._emitter=null,this._initializing=!0,this._emitterMovables=null,this._rangesListenerSorted=null,this._lastCellDecoded={address:null,coords:null},this._lastCellSelected={coords:null,cell:null},this._lastCellRead={coords:null,cell:null},this._lastValueRead={range:null,isDateOrTime:null},this._lastGetRangeRead={},this._lastUsedCoordsRead={coords:null,range:null},this._lastActiveRead={selection:null,range:null,ranges:null},this._lastRangeRead={address:null,range:null,ranges:null},this._isDataColumn=!0,this._isDate1904=!1,this._colHeaders=null,this._colHeadersShiftCallback=null,this._colHeadersListener=null,this._colHeadersRemoveListener=null,this._rowHeaders=null,this._rowHeadersShiftCallback=null,this._rowHeadersListener=null,this._rowHeadersRemoveListener=null,this._closed=!1;const t=Object.freeze({...e});qa._validate(!0),this._transactions=t.transactions??new Hn,this._ownTransactions=!t.transactions;const n=this._beginCommit({description:"New Sheet"}),r=this;try{this._entireCoords=Object.freeze({colStart:0,rowStart:0,colEnd:(t.maxColumns??Fl.width)-1,rowEnd:(t.maxRows??Fl.height)-1}),this._strings=t.strings??new ah,this._ownStrings=!t.strings;const o=t.styles??new qi;this._styles=o,this._ownStyles=!t.styles,this._names=t.names??new HS({addressToRanges:l=>r.getRanges(l),getCurrentScope:()=>r.getName(),isReadOnly:()=>r._options.readonly??!1,transactions:r._transactions}),this._ownNames=!t.names,this._namesRemoveListener=this._names.addListeners({onCollectionChange:l=>{r._calculateFull()}},{transactional:!1}),this._calculation=t.calculation??new PS({getNamed:(l,a)=>{Hm.address=l,Hm.scope=a;const c=this._names.getItems({address:l,scope:a});return c&&c.length!==0?c[0].getRanges().getCoords():null},getSheetIndex:l=>l===void 0||l===r.getName()?1:0,getSheetCount:()=>1,isDate1904:()=>r.isDate1904(),strings:r._strings,transactions:r._transactions}),this._ownsCalculation=!t.calculation,this._workbook=t.workbook??null,this._normalStyleRanged=o.getNamed(Qe.BuiltInName.Normal).getRanged(),this._resources=t.resources??new OS,this._ownResources=!t.resources;const i=async()=>{this._ownsCalculation&&await this._calculation.start(),this._starting=null};this._starting=i(),t.container?.setNameChangeCallback&&t.container.setNameChangeCallback(()=>{r._emitter.notify("onNameChange");const l=this._getState().rangesListenerMap,a=new Map;l.forEach((u,d)=>{a.set(d,{beforeState:u,afterState:u})});const c=this._beginCommit({description:"Set Name"});c.updateState(r,{}),c.commit({viewAfter:{ranges:[r._entireCoords],listeners:a},forceAmend:!0}),r._calculateFull()}),t.container?.setVisibilityCallback&&t.container.setVisibilityCallback(()=>{r._emitter.notify("onVisibilityChange")}),t.container?.setIndexCallback&&t.container.setIndexCallback(()=>{r._calculateFull()}),this._movables=new qv(this._addMovable.bind(this),this._searchMovables.bind(this),()=>{const l=r._getState();return l?l.movableMapModel?.size??0:0},this._updateSelectedMovables.bind(this),(l,a)=>this._emitterMovables.addListeners(l,a),this._addImage.bind(this)),this._emitterMovables=new gn(this._movables,this._transactions),this._tables=new Yv(this._addTable.bind(this),(l,a,c)=>{const u=l?this._rangeToCoords(l):this._entireCoords;return r._getRangedEntries("tableSpatial",[u],{ignoreHidden:a,fullyContained:c,onEntry:d=>d.model})},l=>{const a=r._getState();return a?a.tableMapName.get(l.toLocaleLowerCase()):null}),this._conditionals=new ox(this._addConditional.bind(this),(l,a,c)=>{const u=l?this._rangeToCoords(l):this._entireCoords,d=new Set;return r._getRangedEntries("conditionalSpatial",[u],{ignoreHidden:a,fullyContained:c,onEntry:h=>{d.add(h.getModel())}}),Array.from(d)}),this._isDate1904=t.date1904??!1,this._options=t,this._emitter=new gn(this,this._transactions),this._entireRange=this.getRange(this._entireCoords),this._initState(),t?.container?.beforeFromJSON?.(this),t.json&&this._fromJSON(t.json),t.readonly,n.commit({forceAmend:this._ownTransactions,viewAfter:{initial:!0,skipProtectionCheck:!0}})}catch(o){throw n.rollback(),o}this._initializing=!1}_createRange(e,t,n=null){if(!e)return Nr(this,this._entireCoords);if(this._validateCoords(e),this._closed)return Nr(null,this._entireCoords,e);n===null&&this._options.readonly&&(n="Readonly sheet");let r=null;return(t||n)&&(r={getOptions:t,readOnly:n}),new gh((o=>{if(!o)return null;const i={colStart:o.colIndex??o.colStart??0,rowStart:o.rowIndex??o.rowStart??0,colEnd:o.colIndex??o.colEnd??0,rowEnd:o.rowIndex??o.rowEnd??0};return(o.$colStart||o.$colIndex)&&(i.$colStart=!0),(o.$colEnd||o.$colIndex)&&(i.$colEnd=!0),(o.$rowStart||o.$rowIndex)&&(i.$rowStart=!0),(o.$rowEnd||o.$rowIndex)&&(i.$rowEnd=!0),i})(e),this,r)}_createRanges(e,t,n=null){let r=null;return n===null&&this._options.readonly&&(n="Readonly sheet"),(t||n)&&(r={getOptions:t,readOnly:n}),new hh(e,this,r)}getRange(e,t){let n=!t&&e&&(e.rowStart!==void 0||typeof e=="string");if(n){if(typeof e=="string"){if(this._lastRangeRead.address===e)return this._lastRangeRead.range}else if(e.rowStart!==void 0&&bi(e,this._lastRangeRead.address))return this._lastRangeRead.range}try{const r=this._rangesToCoords(e);if(r.length>1)throw new Pe(cS);const o=this._createRange(r[0],t);return n&&(this._lastRangeRead.address={...e},this._lastRangeRead.range=o),o}catch(r){throw r instanceof Tt?new Tt(r.message):new Pe(r.message??ms(e))}}getCell(e){const t=this.getRange(e);if(t.size!==1)throw new Pe(_f);return t.getCell()}getRanges(e,t){if(!e)throw new Pe(xo);const n=this._rangesToCoords(e);if(n.length===0)throw this._createRangeError(e);return this._createRanges(n,t)}getSelectedRange(e){const t=this.getSelection(),n=t.getCoords();if(!e&&this._lastActiveRead.selection===n&&this._lastActiveRead.range)return this._lastActiveRead.range;const r=t.getRangesCoords(),o=this.getRange(r[0]);return e||(this._lastActiveRead.selection=n,this._lastActiveRead.range=o,this._lastActiveRead.ranges=this.getRanges(r)),o}getSelectedRanges(e){const t=this.getSelection(),n=t.getCoords();if(!e&&this._lastActiveRead.selection===n&&this._lastActiveRead.ranges)return this._lastActiveRead.ranges;const r=t.getRangesCoords(),o=this.getRanges(r,e);return e||(this._lastActiveRead.selection=n,this._lastActiveRead.ranges=o,this._lastActiveRead.range=this.getRange(r[0])),o}getEntireRange(e){return e?this.getRange(this._entireCoords,e):this._entireRange}getUsedRange(e){const t=this._getUsedCoords(),n=t?this.getRange(t,e):null;return e||(this._lastUsedCoordsRead.coords=t,this._lastUsedCoordsRead.range=n),n}_cellToCoords(e){if(this._lastCellDecoded.address===e)return this._lastCellDecoded.coords;const t=this._rangeToCoords(e);if(!t||!q.isSingleCell(t))throw new Pe(_f);const n={colIndex:t.colStart,rowIndex:t.rowStart};return this._lastCellDecoded.address=e,this._lastCellDecoded.coords=n,n}_validateCoords(e,t=Aa){if(!q.isRangeWithinRange(e,this._entireCoords))throw new Tt(t);const n=e.colStart,r=e.rowStart,o=e.colEnd,i=e.rowEnd;if(i<r||o<n)throw new Pe(uS);if(!(Number.isInteger(n)&&Number.isFinite(n)&&Number.isInteger(r)&&Number.isFinite(r)&&Number.isInteger(o)&&Number.isFinite(o)&&Number.isInteger(i)&&Number.isFinite(i)))throw new Pe("Invalid range. All points must be valid integers.")}_createRangeError(e){return new Pe(e?xo:ms(e))}_protectionCheck(e=null,t=null,n=null){if(e&&this._closed)return;if(!this._initializing&&this._options.readonly)throw new Pe(((i="update")=>`Unable to ${i}, this sheet is readonly.`)(n));t&&!Array.isArray(t)&&(t=[t]);const r=e(t),o=this.getProtection();if(o?.getProperties()){if(r.length===0)throw new Pe(Sl);if(r){const i=r.length;for(let l=0;l<i;l++)if(o[r[l]]!==!0)throw new Pe(_b())}}}_rangesToCoords(e,t=null,n=!0,r=!1){if(t&&this._closed)return P.EmptyArray;if(e==null)return P.EmptyArray;const o=this,i=Qa(e,this._entireCoords,r?Jn:Ui,a=>{if(n&&typeof a=="string"){const c=o.getNames()?.getByName(a);if(c)return c.getRanges().getCoords();const u=this._options.resolveRange?.(a);if(u&&u.getSheet()===o)return console.warn(Af),[u.getCoords()];throw new Pe(`Invalid sheet reference '${a}'.`)}}),l=i.length;for(let a=0;a<l;a++){const c=i[a];if(c){if(r){const u=c.sheetName;if(u&&u!==this.getName())throw new Pe(Af)}this._validateCoords(c)}}if(!t)return i;if(i.length===0)throw this._createRangeError(e);return this._protectionCheck(t,i),i}_rangeToCoords(e,t=null,n=!0){if(!e)throw new Pe(xo);const r=t?i=>t(i):void 0,o=this._rangesToCoords(e,r,n);if(o.length===0)throw new Pe(ms(e));return o[0]}_collectRanges(e,t=[],n=!0,r=this._getState(),o=!1){if(!n||typeof n=="object"&&Object.keys(n).length===0)return;const i=a=>n===!0||n[a]!==void 0,l=(a,c,u)=>{if(n!==!0&&n[a]===void 0)return;const d=c.search(e,!1),h=d.length;if(h===0)return;const f=n[a];for(let g=0;g<h;g++){const m=d[g];if(f&&!q.isRangeWithinRange(e,m))continue;const p=q.intersectRanges(e,m);let S=m.value;S===void 0&&(S=!0),t.push({...p,value:{[u]:S}})}};if(i(je.Type.Merge)&&r.mergeSpatial){const a=r.mergeSpatial.search(e),c=a.length;for(let u=0;u<c;u++){const d=a[u],h=o?d:q.intersectRanges(e,d);t.push({...h,value:{merge:d.value}})}}if(l(je.Type.Unlock,r.unlockSpatial,"unlock"),l(je.Type.Contentful,r.contentfulSpatial,"contentful"),l(je.Type.Continuous,r.continuousFillSpatial,"continuous"),l(je.Type.Hyperlink,r.hyperlinkSpatial,"hyperlink"),l(je.Type.Comments,r.commentsSpatial,"comments"),l(je.Type.Style,r.directStyleSpatial,"directStyle"),l(je.Type.Formula,r.formulaSpatial,"formula"),l(je.Type.Pending,r.pendingSpatial,"pending"),l(je.Type.CalcError,r.calcErrorsSpatial,"calcError"),l(je.Type.Spill,r.spillSpatial,"spills"),i(je.Type.Conditional)&&r.conditionalSpatial){const a=r.conditionalSpatial.search(e),c=n[je.Type.Conditional],u=a.length;for(let d=0;d<u;d++){const h=a[d],f=q.intersectRanges(e,h);c&&!f||t.push({...f,value:{conditionals:[h.value]}})}}if(i(je.Type.Table)&&r.tableSpatial){const a=r.tableSpatial.search(e),c=n[je.Type.Table],u=a.length;for(let d=0;d<u;d++){const h=a[d];if(c&&!q.isRangeWithinRange(e,h))continue;const f=q.intersectRanges(e,h);t.push({...f,value:{table:h.value.model}})}}}_cellIterator(e){const t=this._cellOptions,n=this._strings,r=this._cellStateIterator(e);return{next(o){const i=r.next(o);if(i.done)return xt;const l=i.value,a=new pu(n,e,t),c=a.context;return{done:!1,value:{value:a.setState(l),context:c}}},[Symbol.iterator](){return this}}}_rangeStateIterator(e){const t=this._getState();if(!t||!e||!e.includeRangeTypes)return Qt;const n=e?.bounds??this._getUsedCoords()??this._entireCoords;let r=null;e.includeRangeTypes===!0?r=pb:P.isObject(e.includeRangeTypes)&&(r=e.includeRangeTypes);const o=e?.ignoreHidden,i=o===!0||o===B.Orientation.Row,l=o===!0||o===B.Orientation.Column,a=e?.includeMergeOverflow??!1,c=[],u=this,d={includeHidden:!l},h={min:n.colStart,max:n.colEnd},f={includeHidden:!i},g={min:n.rowStart,max:n.rowEnd};this._rowHeaders.getRange(g).forEachVisibleSpan((b,C)=>{this._colHeaders.getRange(h).forEachVisibleSpan((_,y)=>{u._collectRanges({rowStart:b,rowEnd:C,colStart:_,colEnd:y},c,r,t)},d)},f);const m=new Oi.IteratorInstance(c,e),p=e?.reverse??!1,S=e?.byCell;let w;return{next:b=>{if(w=m.next(b),w.done)return xt;const C=w.value,_=Kf(C.overlaps);let y,v=C.range;if(a){const R=_?.merge;if(R){const I=R.getCoords(),A=n.colStart,T=n.rowStart,O=I.colStart,N=I.rowStart;O<A&&T<N&&(y={colIndex:O,rowIndex:N})}}y||(y={colIndex:v.colStart,rowIndex:v.rowStart});const x={colIndex:v.colEnd,rowIndex:v.rowEnd};let E=null;return S&&(E={...C.cell}),{done:!1,value:{start:p?x:y,end:p?y:x,cell:E,intersection:_}}}}}_overflowAndStops(e,t){const n=this._getState();if(!n||!e)return null;let r=this._entireCoords;t&&(r={colStart:Math.max(r.colStart-t,r.colStart),rowStart:r.rowStart,colEnd:Math.min(r.colEnd+t,r.colEnd),rowEnd:r.rowEnd});const o={rowStart:e.rowStart,colStart:r.colStart,rowEnd:e.rowEnd,colEnd:r.colEnd},i={bounds:o,includeRangeTypes:wb,orientation:B.Orientation.Row,ignoreHidden:!0,byCell:!1},l=e.colStart,a=e.colEnd;let c,u,d=-1;const h=(w,b)=>{let C=w.next();for(;!C.done;){const _=C.value,y=_.intersection,v=y.contentful;if(v){const x=_.start.rowIndex;if(!u||x!==d){const E=_.end.rowIndex,R=v.getCoords(),I=b?R.colEnd:R.colStart;let A=null;b&&(A=y.continuous),c||(c=[]);for(let T=x;T<=E;T++)c.push({rowIndex:T,colIndex:I,continuous:A,intersection:y,scalar:null,leftIndex:0,rightIndex:0,overflow:null,style:null})}d=x,u=_}C=w.next()}};l>r.colStart&&(o.colStart=r.colStart,o.colEnd=e.colStart-1,h(this._rangeStateIterator(i),!0)),d=-1,u=void 0,a<r.colEnd&&(o.colStart=e.colEnd+1,o.colEnd=r.colEnd,h(this._rangeStateIterator(i),!1));const f=n.cellValuesGrid;if(!c)return null;c.sort(q.columnFirstCellComparator);const g=c.length,m=this._cellOptions;let p,S;for(let w=0;w<g;w++){const b=c[w],C=b.rowIndex,_=b.colIndex,y=f.getValueAt(C,_);b.scalar=y;const v=b.continuous;if(typeof y=="string"||v){oi.colStart=_,oi.rowStart=C,oi.colEnd=_,oi.rowEnd=C;const x=ls(0,oi,b.intersection,m);b.style=x;const E=TS(C,_,Le.String,x,y,null,null,v?.getCoords(),m);if(E){const R=E.leftIndex,I=E.rightIndex;b.leftIndex=R,b.rightIndex=I,(I>0&&_<l||R>0&&_>a)&&(b.overflow=E)}}b.overflow?(p||(p=[]),p.push(b)):(S||(S=[]),S.push(b))}return{overflows:p,stops:S}}_cellStateIterator(e){const t=this._getState();if(!t)return Qt;const n=e?.bounds,r=n??this._entireCoords,o=e?.orientation??B.Orientation.Row,i=e?.reverse??!1,l=e?.includeEmpty,a={bounds:r,orientation:o,reverse:i};let c;l&&(c={bounds:r,orientation:o,reverse:i});const u=e?.ignoreHidden;if(u===!0||u===B.Orientation.Row){const L=fu(this._rowHeaders);a.processRowSkip=Ws(L),l&&(c.processRowSkip=Ws(L))}if(u===!0||u===B.Orientation.Column){const L=fu(this._colHeaders);a.processColumnSkip=Ws(L),l&&(c.processRowSkip=Ws(L))}const d=l||!e?.ignoreEmptyIntersections;let h=e.includeRangeTypes;h===!0&&(h=dS);const f=e?.includeMergeOverflow??!1,g=h?this._rangeStateIterator({bounds:r,orientation:o,reverse:i,includeRangeTypes:h,includeMergeOverflow:f,ignoreHidden:e.ignoreHidden,byCell:!0}):Qt;let m,p;if(f&&n){const L=this._overflowAndStops(n);L&&(m=L.overflows,m?.sort(q.createCellComparator(o,i)),p=L.stops,p?.sort(q.createCellComparator(o,i)))}const S=m?m.length:0,w=p?p.length:0;let b=0,C=0;const _=t?.cellValuesGrid??null;let y=_?_.entries(a):Qt,v=y.next(),x=null,E=null,R=null;v.done||(x=v.value[0],E=v.value[1]);let I=m?.[b++],A=g.next(),T=null;const O=o!==B.Orientation.Row;let N;const D=q.createCellComparator(o,i);let F;if(!A.done){const L=A.value;T=L.intersection,F=L.start}N=L=>{let W=null,$=null,J=null,te=!1,Q=!1,G=null,ee=null,ne=!1;if(I&&(x?D(I,x)<0&&(ne=!0):F?D(I,F)<0&&(ne=!0):b<=S&&(ne=!0)),ne)W={colIndex:I.colIndex,rowIndex:I.rowIndex},$=I.scalar,J=I.intersection,I=m[b++];else if(x&&F){const Z=D(x,F);Z<0?(W=x,$=E,te=!0):Z>0?(W=F,J=T,Q=!0):(W=x,$=E,J=T,te=!0,Q=!0)}else if(x)W=x,$=E,te=!0;else{if(!F||!d)return xt;W=F,J=T,Q=!0}if(te&&(v=y.next(),v.done?x=null:(x=v.value[0],E=v.value[1])),Q){const Z=d?void 0:x;if(A=g.next(Z),A.done)F=null,T=null;else{const Y=A.value;T=Y.intersection,F=Y.cell}}let re=!1;const U=W.rowIndex,ue=W.colIndex;O||(re=U===R?.rowIndex);let oe=!1;if(O||(oe=U===x?.rowIndex),re)G=R;else if(f){let Z=!1;for(;!Z&&C<w;){const Y=p[C],we=Y.rowIndex;we<U?C++:(Z=!0,we===U&&Y.colIndex<ue&&(C++,G={colIndex:Y.colIndex,rowIndex:Y.rowIndex}))}}if(oe)ee=x;else if(f){let Z=!1;for(;!Z&&C<w;){const Y=p[C],we=Y.rowIndex;we<U?C++:(Z=!0,we===U&&Y.colIndex>ue&&(C++,ee={colIndex:Y.colIndex,rowIndex:Y.rowIndex}))}}return(te||ne)&&(R=W),{done:!1,value:[W,$,J,G,ee]}};let k={next:N,return:L=>null,throw:L=>null};return l&&(k=new q0(k,a)),k}_indexMerges(e,t=null){if(!(e&&e.length!==0||t&&t.length!==0))return;const n=this._getState();if(!n)return;const r=this._beginCommit({description:"indexMerges"}),o=n.mergeSpatial.clone();if(t){const i=t.length;for(let l=0;l<i;l++)o.remove(t[l])}if(e){const i=c=>this._getState().cellValuesGrid.getValueAt(c.rowStart,c.colStart),l=[],a=e.length;for(let c=0;c<a;c++){const u=e[c];l.push({...u,value:new km(u,i)})}o.load(l)}this._updateState({mergeSpatial:o}),r.commit()}_updateStyles(e,t,n,r=!1){const o=n?.description??"Update Style";this._protectionCheck(()=>["formatCells"],e,o);const i=this._beginCommit({description:o}),l=Rt(e);try{const a=this._getState();if(!a)return P.EmptyArray;const c=a.directStyleSpatial,u=i.getId(),d=c.clone(u);let h=a.continuousFillSpatial;const f=this._styles,g=e.length;for(let m=0;m<g;m++){const p=(x,E)=>{let R=null;const I=ec(0,E,()=>{if(R)return R;const A=x.getCoords();return R=xs(f,x,A),R});return x.cloneWithUpdate(I)},S=!h.isEmpty();let w=null;const b=e[m],C=b.value,_=C!==void 0?C:t,y=p(new Yt(f,b),_),v=(x,E)=>{if(r&&x.value&&x.value.getProperties()?.numberFormat)return x;const R=q.sanitizeRange(x);let I,A=null,T=x.value;if(T||(T=new Yt(f,R)),typeof _=="function")A=p(T,_);else{let O=E.value._p??null;A=T.cloneWithUpdate(O)}if(A.isEmpty()&&(A=null),A){const O=A._p?.alignment?.horizontal;!O||O!==ce.HorizontalAlignment.CenterContinuous&&O!==ce.HorizontalAlignment.Fill||(I=p(new Yt(f,b),{alignment:{horizontal:O}}))}return(I||S)&&(w||(w=[]),w.push({...x,value:I??null})),{...E,value:A}};if(d.insertNonOverlapping({...b,value:y},{onIntersect:v}),w){h===a.continuousFillSpatial&&(h=h.clone());const x=w.length;for(let E=0;E<x;E++){const R=w[E];h.insertNonOverlapping(R)}}}if(this._lastUsedCoordsRead.coords=null,this._updateState({directStyleSpatial:d,continuousFillSpatial:h}),n?.autoFit){const m=typeof n.autoFit=="boolean"?Du:n.autoFit;this._autoFit(e,m)}this._emitter.notify("onStyleChange"),r?i.commit({forceAmend:!0}):this._commitAndAutoSelect(i,l,n?.autoSelect,{viewAfter:{ranges:e}})}catch(a){throw i.rollback(),a}}_createIncrementalUpdater(e,t=null,n){const r=e?.orientation??B.Orientation.Row,o=e?.allowUnorderedWrites??!1,i=r===B.Orientation.Column,l=this._isDataColumn,a=i!==l,c=this;let u,d,h,f=a?new Mt.TransposedBuilder:new Mt.Builder,g=null;if(t){const b=t.getCoords(),C=b.colStart,_=b.rowStart,y=b.colEnd,v=b.rowEnd;g=(x,E)=>{if(x<_||x>v||E<C||E>y)throw new Tt}}i?(d=(b,C,_)=>(g?.(b,C),f.addValue(C,b,_),u),h=(b,C,_)=>(g?.(b,C+(_?.length??0)),f.addValues(C,b,_),u)):(d=(b,C,_)=>(g?.(b,C),f.addValue(b,C,_),u),h=(b,C,_)=>(g?.(b+(_?.length??0),C),f.addValues(b,C,_),u));const m=b=>{const C=f.build();return C&&c._updateTuples(C,b,null,n),t},p=o!==!1?q.createCellComparator(e?.orientation):null,S=P.isObject(o)?o:void 0;let w=null;return u=Object.freeze({push:(b,C)=>{const _=c._cellToCoords(b);return p&&(w&&p(_,w)<=0&&(m(S),f=a?new Mt.TransposedBuilder:new Mt.Builder),w=_),d(i?_.colIndex:_.rowIndex,i?_.rowIndex:_.colIndex,C)},pushAt:d,pushMultipleAt:h,apply:m}),u}_updateTuples(e,t,n=void 0,r=null){if(!e)return;const o=r?.isCell??!1,i=r?.isHyperlink??!1,l=e.tuples,a=e.bounds,c=this._beginCommit({description:t?.description??"Update Cells"});let u=null;const d=this._isDataColumn,h=d?B.Orientation.Column:B.Orientation.Row,f=this.getProtection().isLocked(),g=this.getProtection().isFormatCellsAllowed(),m=this._strings,p=a.majorStart,S=a.majorEnd,w=a.minorStart,b=a.minorEnd,C={colStart:d?p:w,rowStart:d?w:p,colEnd:d?S:b,rowEnd:d?b:S},_=this;(n=n??((he,fe)=>{_._validateCoords(he,fe??Aa)}))(C);const y={[je.Type.Style]:!1,[je.Type.Table]:!1};let v=!1;f&&this._hasRangedEntries("unlockSpatial",C)&&(y[je.Type.Unlock]=!1,v=!0),this._hasRangedEntries("mergeSpatial",C)&&(y[je.Type.Merge]=!1,v=!0);const x=this._rangeStateIterator({bounds:C,orientation:h,includeRangeTypes:y});let E=x.next(),R=-1,I=-1,A=-1,T=-1,O=null;if(!E.done){const he=E.value,fe=he.start,z=he.end;R=d?fe.colIndex:fe.rowIndex,I=d?z.colIndex:z.rowIndex,A=d?fe.rowIndex:fe.colIndex,T=d?z.rowIndex:z.colIndex,O=he.intersection}let N=(he,fe)=>{do{if(!O||he<=A&&fe<A)return null;if(he>=R&&fe>=A&&he<=I&&fe<=T)return O;if(E=x.next(),E.done)O=null,N=null,v=!1;else{const z=E.value;R=d?z.start.colIndex:z.start.rowIndex,I=d?z.end.colIndex:z.end.rowIndex,A=d?z.start.rowIndex:z.start.colIndex,T=d?z.end.rowIndex:z.end.colIndex,O=z.intersection}}while(O);return O};const D=c.getState(this),F=D.cellValuesGrid.clone(),k=D.calcGraph.clone(),L=D.formulaSpatial.clone(),W=D.spillSpatial.clone(),$=D.pendingSpatial.clone(),J=D.calcErrorsSpatial.clone(),te=D.contentfulSpatial.clone(),Q=oo(d),G=oo(d,(he,fe)=>{if(he===fe)return fe}),ee=oo(d,(he,fe)=>{if(he===fe)return fe}),ne=oo(d,(he,fe)=>{if(he===fe)return fe}),re=[];let U=null,ue=null;if(t?.textParser!==!1){const he=t&&t.textParser!==!0?t.textParser:{};ue={ignoreQuotePrefix:!1,date1904:this._isDate1904,dateNF:!1,parse:null,...he},U=new pu(m,null,this._cellOptions)}const oe=[],Z=this._cellOptions,Y=new Map,we=Zf,ge=(he,fe,z)=>{const Fe=N?.(fe,z);if(Fe?.merge){const ie=Fe.merge.getCoords(),Se=d?ie.colStart:ie.rowStart,j=d?ie.rowStart:ie.colStart;if(Se!==fe||j!==z)return}if(o&&he&&he.isICell){const ie=he;if(ie.isTopLeft()){const Se=ie.getSpans();re.push({colStart:d?fe:z,rowStart:d?z:fe,colEnd:(d?fe:z)+Se.width-1,rowEnd:(d?z:fe)+Se.height-1})}}let De=vd(he,Z,ue,Y);if(De===void 0)return;const Ge=De.value;if(De.stringToParse){ri[0].colIndex=d?fe:z,ri[0].rowIndex=d?z:fe,ri[1]=Ge,ri[2]=Fe,U.setState(ri);const ie=ue?.parse(De.stringToParse,U.context),Se=vd(ie,Z,ue,Y,!0);if(U.clear(),Se===null)return Se;Se!==void 0&&(De={...Se})}if(f){if(f&&(he===null||De.value!==void 0))throw new Pe(Sl);if(!g&&De.style!==void 0)throw new Pe(Sl)}if(!i){const ie=De.style;ie===void 0||ie===null&&!o||G.append(fe,z,ie);const Se=De.hyperlink;Se===void 0||Se===null&&!o||ee.append(fe,z,Se)}const H=De.formula;return H===void 0||H===null&&!o||ne.append(fe,z,H),Ge};let de=-1,be=-1;try{const he=l.length;for(let se=0;se<he;se++){const ye=l[se],xe=ye[0];if(de>=xe)throw new Mt.OutOfOrderError(`Duplicate or out of order major indices: {${xe}}.`);if(de=xe,be=Number.MIN_SAFE_INTEGER,xe<p||xe>S)throw new Tt("Provided major bounds is invalid");const Ee=ye[1],K=[],le=Ee.length;for(let X=0;X<le;X++){const ae=Ee[X],Ie=ae[1],ve=Ie.length;let ze=ae[0],_e=ze;if(be>_e)throw new Mt.OutOfOrderError(`Duplicate or out of order minor indices: {${_e}}.`);if(_e<w||_e+ve>b+1)throw new Tt("Provided minor bounds is invalid");let Ne=[];for(let me=0;me<ve;me++){const Re=Ie[me];let Me=null;if(v||typeof Re!="number"?(v||Re!==null||o)&&(Me=ge(Re,xe,_e)):Me=Re,Me==null){if(Me===null&&Q.append(xe,_e),Ne.length>0){const qe=we(Ne,m);K.push([ze,qe]),Ne=[]}ze=_e+1}else Ne.push(Me);_e++}if(be=_e,Ne.length>0){const me=we(Ne,m);K.push([ze,me]),Ne=null}}K.length>0&&oe.push([xe,K])}const fe=Q.done(),z=fe.length;for(let se=0;se<z;se++){const ye=fe[se];F.delete(fe[se]),te.insertNonOverlapping({...ye,value:null});const xe=k.delete(ye);this._updateFormulaSpatial(L,null,xe)}let Fe;oe.length>0&&(F.setValues(oe),Fe={tuples:oe,bounds:a});let De,Ge=ne.done();if(Ge.length>1&&(Ge=Sr(Ge,B.Orientation.Column,1)),Fe||Ge.length>0){const se=k.setInputs(Fe,Ge);De=this._updateFormulaSpatial(L,se.inserts,se.removes,D.directStyleSpatial)}const H=Qf(oe,d),ie=H.length;for(let se=0;se<ie;se++)te.insertNonOverlapping(H[se]);const Se=G.done();Se.length>0&&this._updateStyles(Se),re.length>0&&this._merge(re);const j=ee.done();if(j.length>0&&this._setHyperlinks(j),this._updateState({cellValuesGrid:F,contentfulSpatial:te,calcGraph:k,formulaSpatial:L,spillSpatial:W,pendingSpatial:$,calcErrorsSpatial:J}),De&&De.length>0&&this._updateStyles(De,void 0,{},!0),t?.autoFit){const se=typeof t.autoFit=="boolean"?Du:t.autoFit;this._autoFit([C],se)}u={ranges:[C]},this._addEvent("data",C),this._commitAndAutoSelect(c,u,t?.autoSelect,{viewAfter:{formulas:[C],ranges:[C]}})}catch(he){throw c.rollback(),he}}_sort(e,t){typeof t=="boolean"&&(t={reverse:t});const n=t?.description??"Sort "+(t?.reverse?"Descending":"Ascending");this._protectionCheck(()=>["sort"],e,n);let r=1,o=1,i=!1;const l=this._getMerges([e]);if(l.length>0){i=!0;let G=l[0];if(r=G.colEnd-G.colStart+1,o=G.rowEnd-G.rowStart+1,(e.colEnd-e.colStart+1)%r!=0||(e.rowEnd-e.rowStart+1)%o!=0)throw new Pe(If);const ee=l.length;for(let ne=1;ne<ee;ne++){const re=l[ne];if(re.colEnd-re.colStart+1!==r||re.rowEnd-re.rowStart+1!==o)throw new Pe(If)}}const a=t?.orientation??B.Orientation.Row,c=a===B.Orientation.Row;let u=t?.offset??0,d=e;t?.hasHeader&&(d={...d},c?d.rowStart+=o:d.colStart+=r,u=Math.max(u-1,0));const h={offset:u,reverse:t?.reverse??hs.DefaultRangeOptions.reverse,collatorOptions:t?.collatorOptions??hs.DefaultRangeOptions.collatorOptions},f=c?d.colStart:d.rowStart,g=c?d.colEnd-d.colStart:d.rowEnd-d.rowStart,m=[],p=t?.fields;if(p){const G=p.length??0;for(let ee=0;ee<G;ee++){let ne=p[ee];typeof ne=="number"&&(ne={offset:ne}),m.push(ne)}}else m.push(h);const S=m.length;for(let G=0;G<S;G++){const ee=m[G]={...h,...m[G]};if(ee.offset<0||ee.offset>g)throw new Tt("The sort offset is outside of the bounds of the sort.");ee.offset+=f}const w=[];let b=null,C=null,_=null,y=Number.MIN_SAFE_INTEGER;m.sort((G,ee)=>G.offset-ee.offset);let v=null;const x=t?.includeHidden??!1;if(!x){const G=fu(c?this._rowHeaders:this._colHeaders);v=Ws(G)}const E=this._cellIterator({bounds:d,orientation:a,ignoreHidden:!x&&a,includeRangeTypes:{[je.Type.Style]:!1,[je.Type.Merge]:!1}}),R=c?o:r;let I=(c?d.rowStart:d.colStart)-R,A=E.next();for(;!A.done;){const G=A.value.context,ee=G.getCell();if(i&&!ee.isTopLeft()){A=E.next();continue}const ne=G.getCoords(),re=c?ne.rowIndex:ne.colIndex,U=c?ne.colIndex:ne.rowIndex;if(I!==re){for(I+=R,v&&(I=v(I));I<re;)w.push(null),I+=R;C=[],_=[],b={minorIndex:re,values:C,sortValues:_},w.push(b),I=re,y=m[0].offset}for(;U>y;){const ue=m[_.length];y=ue?ue.offset:Number.MAX_SAFE_INTEGER,U>y&&_.push(null)}U===y&&_.push(ee),C.push(ee),A=E.next()}if(!b||w.length===0)return;const T=new Map,O=new Map,N=t?.collators??hs.DefaultCollators,D=N.length;for(let G=0;G<D;G++)T.set(N[G].type,N[G].compare),O.set(N[G].type,G);let F=null,k=null,L=null;w.sort((G,ee)=>{const ne=m.length;for(let re=0;re<ne;re++){const U=m[re],ue=G?G.sortValues[re]:null,oe=ee?ee.sortValues[re]:null,Z=ue?ue.getValue():null,Y=oe?oe.getValue():null,we=Z===null,ge=Y===null;if(Z===Y)continue;if(we&&ge)return 0;if(!we&&ge)return-1;if(we&&!ge)return 1;const de=ue.getType(),be=oe.getType();let he=0;if(de!==be){let fe=O.get(de);he=O.get(be)-fe}else{let fe=k;if(F!==de){fe=T.get(de),k=fe,F=de;let z=O.get(be);L={...N[z].defaultOptions,...U.collatorOptions}}he=fe(Z,Y,L)}return U.reverse&&(he*=-1),he}return 0});const W=this._beginCommit({description:n});let $=[d];x||($=this._getVisible($,{orientations:c?B.Orientations.Row:B.Orientations.Column})),this._clear($,void 0,void 0,!0);const J=this._createIncrementalUpdater({orientation:a});let te=c?d.rowStart:d.colStart;const Q=w.length;for(let G=0;G<Q;G++){const ee=w[G];if(v&&(te=v(te)),ee){const ne=ee.values,re=ne.length;for(let U=0;U<re;U++){const ue=ne[U],oe=c?te:ue.getCoords().rowIndex,Z=c?ue.getCoords().colIndex:te;J.pushAt(oe,Z,ue)}}te+=R}return J.apply(),W.commit(),d}_autoFill(e,t,n){const{direction:r,amount:o}=((m,p)=>{let S=B.Direction.Down,w=0;const b={...m};if(p.colStart<m.colStart?(S=B.Direction.Left,w=m.colStart-p.colStart,b.colStart=p.colStart):p.colEnd>m.colEnd?(S=B.Direction.Right,w=p.colEnd-m.colEnd,b.colEnd=p.colEnd):p.rowStart<m.rowStart?(S=B.Direction.Up,w=m.rowStart-p.rowStart,b.rowStart=p.rowStart):p.rowEnd>m.rowEnd&&(S=B.Direction.Down,w=p.rowEnd-m.rowEnd,b.rowEnd=p.rowEnd),!q.isEqualRanges(b,p))throw new Error("Autofill destination must be the same as the range for 3 of the 4 edges.");return{direction:S,amount:w}})(e,t);if(o<=0)return!1;const i=r===B.Direction.Up||r===B.Direction.Down,l=this.getSelection().getCoords(),a=[],c=n?.previewOnly,u=n?.contentsOnly,d=n?.filler??Fi.Types.Series,h={...n?.fillerOptions};let f=null,g=null;try{const m={...e};let p={...e};const S=[e],w=this._getMerges(S);if(w.length>0&&!q.isRangeWithinRange(q.unionRangesArrays(w),e))throw new Pe(Rf);const b={...p};let C=1;if(r===B.Direction.Left)m.colStart=p.colStart=e.colStart-o,m.colEnd=e.colStart-1,C=w.length===0?C:e.colEnd+1-e.colStart,b.rowStart=b.rowEnd;else if(r===B.Direction.Right)m.colEnd=p.colEnd=e.colEnd+o,m.colStart=e.colEnd+1,C=w.length===0?C:e.colEnd+1-e.colStart,b.rowStart=b.rowEnd;else if(r===B.Direction.Up)m.rowStart=p.rowStart=e.rowStart-o,m.rowEnd=e.rowStart-1,C=w.length===0?C:e.rowEnd+1-e.rowStart,b.colStart=b.colEnd;else{if(r!==B.Direction.Down)throw new Pe(Gw.MESSAGE_ERROR_INVALID_ARG(r));m.rowEnd=p.rowEnd=e.rowEnd+o,m.rowStart=e.rowEnd+1,C=w.length===0?C:e.rowEnd+1-e.rowStart,b.colStart=b.colEnd}if(o%C!==0)throw new Pe((ge=>`When filling with merged cells the amount to fill must be a multiple of the input range [${ge}].`)(C));const _=i?"rowIndex":"colIndex",y=i?"colIndex":"rowIndex",v=i?e.rowEnd+1-e.rowStart:e.colEnd+1-e.colStart,x=i?e.rowStart:e.colStart,E=i?e.rowEnd:e.colEnd,R=i?t.rowStart:t.colStart,I=i?t.rowEnd:t.colEnd,A=i?r===B.Direction.Down:r===B.Direction.Right;A||(h.reverse=!0);const T=A?E+1:R,O=(A?I:x-1)-T+1,N=i?e.colEnd:e.rowEnd;a.push(q.unionRanges(m,e));const D=[];let F=null;c||(f=this._beginCommit({description:"Auto Fill",operation:{name:"autoFill",params:[e,t,n]}}));const k=this._cellIterator({bounds:c?b:e,reverse:!A,orientation:i?B.Orientation.Column:B.Orientation.Row,includeRangeTypes:{[je.Type.Style]:!1}});let L=k.next();for(;!L.done;){const ge=L.value.context,de=ge.getCell(),be=ge.getCoords();F?.oppositeIndex!==be[y]&&(F={oppositeIndex:be[y],lastIndex:A?x-1:E+1,values:[]},D.push(F));const he=be[_];if(A)for(let z=F.lastIndex+1;z<he;z++)F.values.push(null);else for(let z=F.lastIndex-1;z>he;z--)F.values.push(null);F.lastIndex=he;const fe=de.toDate();if(fe)F.values.push(fe);else{let z=de.getValue();F.values.push(z)}L=k.next()}const W=D.length;for(let ge=0;ge<W;ge++){const de=D[ge].values;for(let be=de.length;be<v;be++)de.push(null)}const $=(ge,de)=>{if(ge.canFill(de[0],[])){const be=ge.createFillAt(de,h);if(be)return be}return Fi.Types.Copy.createFillAt(de)},J=this;if(c){const ge=D[D.length-1];if(D[D.length-1]?.oppositeIndex!==N)return null;const de=$(d,ge.values);return c(be=>{const he=J._rangeToCoords(be);let fe;r===B.Direction.Down||r===B.Direction.Right?fe={rowIndex:he.rowEnd,colIndex:he.colEnd}:r===B.Direction.Left?fe={rowIndex:he.rowEnd,colIndex:he.colStart}:r===B.Direction.Up&&(fe={rowIndex:he.rowStart,colIndex:he.colEnd});const z=i?fe.rowIndex:fe.colIndex,Fe={value:de(A?z-x:x-z+v-1)};let De=null;return De=u?this.createTemporaryCell(Fe,fe):this.createTemporaryCell(null,fe).createTemporaryCell(Fe),De}),!1}const te=this._createIncrementalUpdater({orientation:i?B.Orientation.Column:B.Orientation.Row}),Q=D.length;D.sort((ge,de)=>ge.oppositeIndex-de.oppositeIndex);for(let ge=0;ge<Q;ge++){const de=ge,be=$(d,D[de].values),he=D[de].oppositeIndex,fe=A?v:v+O-1,z=this.isDate1904();for(let Fe=0;Fe<O;Fe++){let De=be(fe+(A?Fe:-Fe));As(De)&&(De=$i(De,z));const Ge=T+Fe;i?te.pushAt(Ge,he,De):te.pushAt(he,Ge,De)}}this._clear([m],n?.contentsOnly?ut.Content.Formats:void 0),te.apply();const G=this._getMerges([p]),ee=q.unionRangesArrays(G);if(G.length>0&&!q.isRangeWithinRange(ee,p))throw new Pe(Rf);if(G.length>0){const ge=[],de=o/C;if(i){const be=e.rowEnd-e.rowStart+1,he=r===B.Direction.Up?m.rowStart:e.rowEnd+1,fe=G.length;for(let z=0;z<fe;z++){const Fe=G[z],De=Fe.rowStart-e.rowStart,Ge=Fe.rowEnd-Fe.rowStart+1;for(let H=0;H<de;H++){const ie=H*be;ge.push({colStart:Fe.colStart,rowStart:he+ie+De,colEnd:Fe.colEnd,rowEnd:he+ie+De+Ge-1})}}}else{const be=e.colEnd-e.colStart+1,he=r===B.Direction.Left?m.colStart:e.colEnd+1,fe=G.length;for(let z=0;z<fe;z++){const Fe=G[z],De=Fe.colStart-e.colStart,Ge=Fe.colEnd-Fe.colStart+1;for(let H=0;H<de;H++){const ie=H*be;ge.push({colStart:he+ie+De,rowStart:Fe.rowStart,colEnd:he+ie+De+Ge-1,rowEnd:Fe.rowEnd})}}}this._merge(ge)}const ne=this._getState(),re={},U={};U.directStyleSpatial=ne.directStyleSpatial,U.continuousFillSpatial=ne.continuousFillSpatial;let ue=e,oe=m;if(!A){let ge=(i?p.rowEnd+1-p.rowStart:p.colEnd+1-p.colStart)%v;const de=i?"rowStart":"colStart",be=i?"rowEnd":"colEnd";ge!==0&&(oe={...m,[be]:Math.min(m[be],m[de]+ge)},ue={...e,[de]:e[be]-ge+1},m[de]=m[de]+ge)}const Z=Object.keys(U),Y=Z.length;for(let ge=0;ge<Y;ge++){const de=Z[ge],be=U[de].createCopiedEntries(ue,oe),he=ne[de].clone(),fe=be.removes,z=fe.length;for(let Fe=0;Fe<z;Fe++)he.remove(fe[Fe]);he.load(be.inserts),re[de]=he}if(A){const ge=this.getTables().getItems({address:{rowIndex:e.rowEnd,colIndex:e.colEnd}});if(ge.length===1){const de=ge[0],be=de.getRange().getCoords();de.resize({colStart:be.colStart,rowStart:be.rowStart,colEnd:i?be.colEnd:m.colEnd,rowEnd:i?m.rowEnd:be.rowEnd})}}const we=ne.calcGraph.clone();we.autoFill(e,m),re.calcGraph=we,this._updateState(re),g={...l,ranges:a},f.commit({viewBefore:{view:this.getView(),selection:Rt([e]),selectOptions:n?.autoSelect},viewAfter:{view:this.getView(),selection:g,selectOptions:n?.autoSelect}}),this._autoSelect(n?.autoSelect??!1,g)}catch(m){throw f?.rollback(),m}return!0}_setHyperlinks(e,t,n){const r=n?.description??"Set Hyperlink";this._protectionCheck(()=>["insertHyperlinks","formatCells"],e,r);const o=Rt(e),i=this._beginCommit({description:r});let l=null;try{const a=this._getState();if(!a)return P.EmptyArray;const c=a.hyperlinkSpatial;let u=c,d=a.directStyleSpatial.clone();const h=e.length;for(let f=0;f<h;f++){const g=e[f];let m=null;const p=g.value,S=p!==void 0?p:t;let w;if(S!==null){if(S.isIHyperlink)w={...S._p},m=S.getDisplayText();else if(typeof S=="string")w={address:S},m=S;else if(S.address||S.displayText){const b=S,C={...b};delete C.displayText,w=C,m=b.displayText??b.address}}else w=null;if(l=q.unionRanges(l,g),c===u&&(u=c.clone()),w!==null||c.size()>0){if(m&&t){const b=this._createIncrementalUpdater({orientation:B.Orientation.Column},void 0,{isHyperlink:!0});for(let C=g.colStart;C<=g.colEnd;C++)for(let _=g.rowStart;_<=g.rowEnd;_++)b.pushAt(_,C,m);b.apply()}if(w===null)this._getRangedEntries("hyperlinkSpatial",[g],{onEntry:(b,C)=>(u.insertNonOverlapping({...C,value:w}),C.value)});else{u.insertNonOverlapping({...g,value:w});const b=this._styles,C=_=>{const y=_.value??new Yt(b,q.sanitizeRange(_));let v={...y.getPropertiesAt(0,0,null)};if(v.named){const x=b.getNamed(v.named)?.getRanged().getPropertiesAt(0,0,null);v=P.mergeContentful(x,v)}return delete v.font,v.named=Qe.BuiltInName.Hyperlink,{..._,value:y.cloneWithUpdate(v)}};d.insertNonOverlapping({...g,value:null},{onIntersect:C})}}}this._lastUsedCoordsRead.coords=null,this._updateState({hyperlinkSpatial:u,directStyleSpatial:d}),this._commitAndAutoSelect(i,o,n?.autoSelect,{viewAfter:{ranges:e}})}catch(a){throw i.rollback(),a}}_updateFormulaSpatial(e,t,n,r){if(n){const i=n.length;for(let l=0;l<i;l++){const a=n[l];e.remove(a)}}let o;if(t){const i=[],l=t.length;for(let a=0;a<l;a++){const c=t[a],u=q.sanitizeRange(c),d=new hx(u,c.value.tokens,c.value.references);if(i.push({colStart:u.colStart,rowStart:u.rowStart,colEnd:u.colEnd,rowEnd:u.rowEnd,value:d}),!r)continue;const h=c.value.precedents;let f,g,m=!1;const p=h.length;for(let S=0;!m&&S<p;S++){const w=h[S],b=w.colStart;if(w.colStart===void 0)continue;const C=w.rowStart;rr.colStart=b,rr.rowStart=C,rr.colEnd=b,rr.rowEnd=C;const _=r.search(rr)[0];if(_){const y=_.value.getPropertiesAt(C,b,null),v=y?.numberFormat;if(v)if(f){g||(g=Ut.Styles.lookupStyle(f)?.formatType);const x=Ut.Styles.lookupStyle(v)?.formatType;ky(x,g)>0?(g=x,f=v):m=!0}else f=v}}f&&(o||(o=[]),o.push({colStart:u.colStart,rowStart:u.rowStart,colEnd:u.colEnd,rowEnd:u.rowEnd,value:{numberFormat:f}}))}e.load(i)}return o}_realizeCalcedValues(e){if(!e)return;const t=this._getState();if(!t)return;const n=e.valueInserts,r=e.spillRemoves,o=e.errorRemoves,i=t.cellValuesGrid,l=this._beginCommit();e.isFull&&(t.calcErrorsSpatial.clear(),t.spillSpatial.clear(),t.pendingSpatial.clear());const a=e.valueRemoves;if(a){const g=t.contentfulSpatial,m=a.length;for(let p=0;p<m;p++){const S=a[p];i.delete(S),g.insertNonOverlapping({...S,value:null})}}if(r){const g=t.spillSpatial,m=r.length;for(let p=0;p<m;p++){const S=r[p];g.remove(S)}}if(o){const g=t.calcErrorsSpatial,m=o.length;for(let p=0;p<m;p++){const S=o[p];g.remove(S)}}this._updateFormulaSpatial(t.formulaSpatial,e.formulaInserts,e.formulaRemoves);const c=e.formatInserts;if(c){const g=c.length;for(let m=0;m<g;m++){const p=c[m],S={numberFormat:p.value};p.value=S}this._updateStyles(c,void 0,{autoFit:!0},!0)}if(n){const g=n.tuples;i.setValues(g);const m=this._isDataColumn,p=m?B.Orientation.Column:B.Orientation.Row,S=t.contentfulSpatial,w=g.length;for(let b=0;b<w;b++){const C=g[b],_=C[0],y=C[1],v=y.length;for(let x=0;x<v;x++){const E=y[x],R=E[0],I=R+E[1].length-1,A={colStart:m?_:R,rowStart:m?R:_,colEnd:m?_:I,rowEnd:m?I:_};S.insertNonOverlapping({colStart:A.colStart,rowStart:A.rowStart,colEnd:A.colEnd,rowEnd:A.rowEnd,value:new vs(A,p)})}}}const u=e.spillInserts;if(u){const g=u.length;for(let m=0;m<g;m++){const p=u[m],S=p.value;p.value=new ua(q.sanitizeRange(p),0,S)}t.spillSpatial.load(u)}const d=e.pendingUpdates;if(d){const g=t.pendingSpatial,m=d.length;for(let p=0;p<m;p++){const S=d[p];S.value===!1&&(S.value=null),g.insertNonOverlapping(S)}}const h=e.errorInserts;h&&t.calcErrorsSpatial.load(h);const f=e.formulaInserts;if(f){const g=Sr(f);this._autoFit(g,Du)}if(l.commit({forceAmend:!0,viewAfter:{calculationSideEffect:!0}}),(e.bounds||e.isFull)&&!this._initializing){const g=this._rangesListenerMap;if(g.size>0){const m={isDataChange:!0,isTransactional:!1,timeStamp:Date.now(),isUndo:!1,trigger:"calc"};this._notifyRangeListeners(this._rangeListenerSpatial,g,[e.bounds??this._entireCoords],m)}(u||r)&&this._emitter.notify("onSpillsChange")}}_calculate(e,t){const n=this._getState().calcGraph;n.invalidate(e),n.calculate(t)}_calculateFull(){this._initializing||P.debounce(()=>{this._getState()?.calcGraph.calculate({full:!0})},100)()}_setComments(e,t,n){const r=n?.description??"Set Comments",o=Rt(e),i=this._beginCommit({description:r});let l=null;try{const a=this._getState();if(!a)return P.EmptyArray;const c=a.commentsSpatial;let u=c;const d=e.length;for(let h=0;h<d;h++){const f=e[h];let g=null;if(t!==null){let m=t;if(!m)continue;g=typeof m=="string"?{content:{runs:{text:m}}}:{...m}}l=q.unionRanges(l,f),c===u&&(u=c.clone()),u.insertNonOverlapping({...f,value:g})}this._lastUsedCoordsRead.coords=null,this._updateState({commentsSpatial:u}),this._commitAndAutoSelect(i,o,n?.autoSelect,{viewAfter:{ranges:e}})}catch(a){throw i.rollback(),a}}_clear(e,t=null,n,r=!1,o=!1){let i=null,l="Clear",a=!1,c=!1,u=!1,d=!1;t===ut.Content.Formulas?(l=`${l} Formulas`,d=!0):t===ut.Content.Values?(l=`${l} Values`,d=!0):t===ut.Content.Formats?(l=`${l} Formats`,a=!0,i=["formatCells"]):t===ut.Content.Comments?(l=`${l} Comments`,u=!0):t===ut.Content.Hyperlinks?(l=`${l} Hyperlinks`,c=!0,i=["formatCells"]):(i=[],l=`${l} All`,d=!0,a=!0,c=!0,u=!0),i!==null&&this._protectionCheck(()=>i,e,n?.description??l);const h=Rt(e),f=this._beginCommit({description:n?.description??l});let g=this._getState(),m=g.cellValuesGrid,p=g.calcGraph,S=g.contentfulSpatial,w=g.formulaSpatial,b=g.spillSpatial,C=g.pendingSpatial,_=g.calcErrorsSpatial,y=g.rangesListenerSpatial2;d&&(m=m.clone(),p=p.clone(),S=S.clone(),w=w.clone(),b=b.clone(),C=C.clone(),_=_.clone());try{if(c&&this._setHyperlinks(e,null),u&&this._setComments(e,null),a&&(this._updateStyles(e,null),r||this._unmerge(e)),a||d){pa(0,e,[],S,b,m);const v=e.length;for(let x=0;x<v;x++){const E=e[x];if(d){m.delete(E);const A={...E,value:null};S.insertNonOverlapping(A);const T=p.delete(E);this._updateFormulaSpatial(w,null,T)}const R=this.getTables().getItems({address:E}),I=R.length;for(let A=0;A<I;A++){const T=R[A];q.isRangeWithinRange(T.getAnchorCoords(),E)&&(t===ut.Content.Formats?T.updateStyleOptions({name:null}):T.delete())}if(a){let A=g.conditionalSpatial;A.size()>0&&(A=A.clone(f.getId()),A.insertNonOverlapping({...E,value:null},{noMerge:!0}),g=this._updateState({conditionalSpatial:A}))}if(o){const A=y.search(E),T=A.length;for(let O=0;O<T;O++){const N=A[O];q.isRangeWithinRange(N,E)&&(y===g.rangesListenerSpatial2&&(y=y.clone()),console.log("cut and move listener"),y.remove(N))}}}}this._updateState({cellValuesGrid:m,calcGraph:p,contentfulSpatial:S,formulaSpatial:w,spillSpatial:b,pendingSpatial:C,calcErrorsSpatial:_,rangesListenerSpatial2:y}),this._commitAndAutoSelect(f,h,n?.autoSelect,{viewAfter:{ranges:e}})}catch(v){throw f.rollback(),v}}_merge(e,t=null){if(this._protectionCheck(Pm,e),e.length===1&&q.isSingleCell(e[0]))return;let n=B.Orientations.Both;t?.orientations?n=t?.orientations:t===B.Orientations.Row?n=B.Orientations.Row:t===B.Orientations.Column&&(n=B.Orientations.Column);const r=t?.discardMultipleValues??!1;let o=Rt(e);const i=this.getSelection().getCoords();let l=null;const a=this._beginCommit({description:t?.description??"Merge"});let c=e[0];try{const u=this._getMerges(e);if(wi(e)||u.length>0){const g=q.unionRangesArrays(u),m=q.unionRangesArrays(e);if(!(!g&&!m||g&&m&&q.isRangeWithinRange(g,m)))throw console.warn(Ef,e),new Pe(Ef);this._unmerge(u)}const d=this._createIncrementalUpdater({orientation:B.Orientation.Column}),h=[],f=[];try{const g=this._entireCoords,m=this._getState().contentfulSpatial,p=this._getState().directStyleSpatial;let S=!1;const w=_=>{const y={rowIndex:_.rowStart,colIndex:_.colStart};let v=null;if(S){let D=0;const F=m.search(_),k=F.length;for(let L=0;L<k;L++){const W=q.intersectRanges(F[L],_);if(W&&(D+=(W.rowEnd-W.rowStart+1)*(W.colEnd-W.colStart+1)),D>1)throw new Ih("Merging cells would cause some values to be discarded. Use 'discardMultipleValues' option if desired.","discardMultipleValues")}}v||(v=y);let x=null,E=null,R=null,I=null,A=null,T=null,O=null;un.colStart=_.colStart,un.rowStart=_.rowStart,un.colEnd=_.colStart,un.rowEnd=_.rowStart;let N=p.search(un);if(N.length>0){O=N[0].value?.getPropertiesAt(_.rowStart,_.colEnd,null);const D=O?.border;x=D?.left??null,E=D?.top??null,A=D?.right??null,T=D?.bottom??null}if(un.colStart=_.colEnd,un.colEnd=_.colEnd,N=p.search(un),N.length>0){const D=N[0],F=D.value?.getPropertiesAt(_.rowStart,_.colEnd,null)?.border;F&&F.right&&(R=F.right)}if(un.colStart=_.colStart,un.colEnd=_.colStart,un.rowStart=_.rowEnd,un.rowEnd=_.rowEnd,N=p.search(un),N.length>0){const D=N[0],F=D.value?.getPropertiesAt(_.rowEnd,_.colStart,null)?.border;F&&F.bottom&&(I=F.bottom)}if(!R||!I){un.colStart=_.colEnd,un.colEnd=_.colEnd,un.rowStart=_.rowEnd,un.rowEnd=_.rowEnd,N=p.search(un);const D=N?.[0];if(D){const F=D.value?.getPropertiesAt(_.rowEnd,_.colEnd,null)?.border;F&&(R||(R=F.right??null),I||(I=F.bottom??null))}}h.push({..._,value:null}),h.push({..._,value:{...O,border:{top:E,left:x,right:R??A,bottom:I??T,horizontal:null,vertical:null}}}),q.isEqualCells(v,y)||d.pushAt(v.rowIndex,v.colIndex,null),f.push(_),c=q.unionRanges(c,_)},b=[...e].sort(q.createRangeComparator(B.Orientation.Column)),C=b.length;for(let _=0;_<C;_++){const y=b[_];if(!q.isSingleCell(y)){if(l||!i||!q.isCellWithinRange(i.cell,y)||i.cell.rowIndex===y.rowStart&&i.cell.colIndex===y.colStart||(l={...o,cell:{rowIndex:y.rowStart,colIndex:y.colStart}}),!r&&(S=m.search(y).length>0),this._validateOrRemoveOverlaps(y,"merge"),y.colStart<g.colStart||y.rowStart<g.rowStart||y.colEnd>g.colEnd||y.rowEnd>g.rowEnd)throw new Pe("We can't merge outside of the maximum cell location.");if(n===B.Orientations.Column){const v=y.rowEnd!==g.rowEnd?y.rowEnd:Math.max(1,g.rowEnd);for(let x=y.rowStart;x<=v;x++)w({...y,rowStart:x,rowEnd:x})}else if(n===B.Orientations.Row){const v=y.colEnd!==g.colEnd?y.colEnd:Math.max(1,g.colEnd);for(let x=y.colStart;x<=v;x++)w({...y,colStart:x,colEnd:x})}else w(y)}}d.apply(),this._indexMerges(f),this._updateStyles(h),this._updateState({})}catch(g){throw g.type?new Ih(g.message??"Unable to merge",g.type):new Pe(g.message??"Unable to merge")}l&&(o=l,this.getSelection().updateCoords(l)),a.commit({viewAfter:{view:this.getView(),selection:o,merges:e,ranges:e,selectOptions:t?.autoSelect}}),this._autoSelect(t?.autoSelect??!1,o)}catch(u){throw a.rollback(),u}}_unmerge(e,t){if(this._protectionCheck(Pm,e),wi(e))throw new Pe("We can't unmerge intersecting ranges.");if(!this._getState())return null;const n=q.unionRangesArrays(e),r=Rt(e),o=this._beginCommit({description:t?.description??"Unmerge"}),i=o.getState(this).mergeSpatial,l=[];try{const a=e.length;for(let c=0;c<a;c++){const u=e[c],d=i.search(u),h=d.length;for(let f=0;f<h;f++){const g=d[f];if(!q.isSingleCell(u)&&!q.isRangeWithinRange(g,n))throw new Pe("We can't unmerge partial cells.");l.push(g)}}if(l.length===0)return o.rollback(),null;this._indexMerges(null,l),this._commitAndAutoSelect(o,r,t?.autoSelect,{viewAfter:{merges:e,ranges:e}})}catch(a){throw o.rollback(),a}}_getMerges(e,t=!1){return e.length===0?P.EmptyArray:this._getRangedEntries("mergeSpatial",e,{ignoreHidden:t,fullyContained:!1,onEntry:n=>n.getCoords()})}_clone(){const e={...this._options,container:null};this._ownStyles&&(e.styles=this._styles),this._ownStrings&&(e.strings=this._strings),this._ownResources&&(e.resources=this._resources),this._ownNames&&(e.names=this._names),this._ownsCalculation&&(e.calculation=this._calculation),e.transactions=new Hn({transient:!0});const t=new JS(e),n=this._transactions.getState(this);t._updateState(n);const r=new Ou({sheet:this,json:this.getView().toJSON()});return r.selectMovables(this.getView().getMovableSelection()),t.setView(r),t}_getSnapshot(e,t){if(e.length===0)return P.EmptyArray;const n=this._getState();if(!n)return null;t=Object.freeze({...t});const r=this._clone();r.isMarked=!0;const o=this,i=o.getView(),l="Range",a=[],c=((S,w,b,C)=>{const _=[];let y=null,v=null;const x=b&&b.length>0;if(x){const R=b.length;for(let I=0;I<R;I++){const A=b[I].getSnapshot?.(C);A&&(_.push(A),y=Xu(A.getCoords(),y))}}else if(w){const R=w.length;for(let I=0;I<R;I++){const A=w[I],T=S.getMovables().getItems({ignoreHidden:!1,fullyContained:!0,address:A}),O=T.length;for(let N=0;N<O;N++){const D=T[N].getSnapshot?.(C);D&&(_.push(D),y=Xu(S.getRange(A).getBounds(),y),v=q.unionRanges(v,A))}}}if(_.length===0)return null;const E=()=>C.description??(_?.length===1?_s(_[0]?.getName()):"Drawings");return{copyTo:async(R,I)=>{const A={...C,...I},T=R.getSheet(),O=T.getView(),N=O.getMovableSelection(),D=R.getCoords(),F=A?.isCut??!1,k=O.getMovableSelection();O.selectMovables([]);const L=T.beginCommit(A.description??`${F?"Cut":"Copy"} ${E()}`);try{let W=0,$=0;if(k.length>0&&_.length>0){let Q=Number.MAX_SAFE_INTEGER,G=Number.MAX_SAFE_INTEGER;for(let Z=0;Z<N.length;Z++){const Y=N[Z].getBounds();Q=Math.min(Y.x,Q),G=Math.min(Y.y,G)}let ee=Number.MAX_SAFE_INTEGER,ne=Number.MAX_SAFE_INTEGER;const re=_.length;for(let Z=0;Z<re;Z++){const Y=_[Z].getCoords();ee=Math.min(Y.x,ee),ne=Math.min(Y.y,ne)}W=Q-ee,$=G-ne;const U=_[0].getCoords(),ue={...U,x:U.x+W,y:U.y+$},oe=xm(T.getMovables(),ue);W+=oe.x,$+=oe.y}else if(y){const Q=T.getRange(D).getBounds();W=Q.x-y.x,$=Q.y-y.y}const J=[],te=_.length;for(let Q=0;Q<te;Q++){const G=_[Q],ee=G.getCoords(),ne={...ee,x:ee.x+W,y:ee.y+$};J.push(G.copyTo({movables:T.getMovables(),bounds:ne},{autoSelect:{addToSelection:!0},...A}))}await Promise.all(J),L?.updateState(T,Q=>Q),L.commit({viewBefore:Q=>({...Q,view:S.getView(),movableSelection:k})})}catch(W){throw L.rollback(),W}return null},getName:E,getCoords:()=>v,getMarkOptions:()=>C,toText:()=>x?_[0].toText?.()??null:null,toHtml:()=>x?_[0].toHtml?.()??null:null,toImage:()=>x?_[0].toImage?.()??null:null,getSource:()=>S,isISnapshot:!0}})(r,e,i.getMovableSelection(),t);if(c){if(i.getMovableSelection().length>0)return c;a.push(c)}if(e.length>1)throw new Pe(Tf);const u={singleMerge:null};a.push({copyTo(S,w){const b={...t,...w};let C=null;if(!b.skipBlanks){const y=S.getSheet(),v=S.getCoords(),x=v;C=y.getRange(x);let E=!1;const R=C.getMerges();if(R.length===1&&q.isEqualRanges(R[0],v))if(q.isSingleCell(e[0]))E=!0;else{const I=(_=p)?{colIndex:_.colStart,rowIndex:_.rowStart}:null;r._getMerges([q.cellToRange(I)]).length===1&&(E=!0)}return E?(u.singleMerge=v,C.clear(b.type??ut.Content.Values)):C.clear(b.type),x}var _}});const d=r._entireCoords,h=e.length;for(let S=0;S<h;S++){const w=e[S],b=n.rangeListenerSpatial.search(w,!1),C=n.rangesListenerMap;a.push({async copyTo(_,y){if(!y.isCut)return;const v=new Set,x=b.length;for(let E=0;E<x;E++){const R=b[E].value,I=R.id;if(v.has(I))continue;const A=C.get(I);if(v.add(I),A.ranges[R.offset]===null)return;const T={isTransactional:!0,isDataChange:!1,trigger:"moveCells",from:r.getRanges(e),to:_},O=r._createRangeEvent(A.ranges,T);r._notifyRangeListener2(A,O,T)}return null},getMarkOptions:()=>t,getCoords:()=>null,isISnapshot:!0})}const f={ignoreHidden:!1,fullyContained:!0,onEntry:S=>S.model};for(let S=0;S<h;S++){const w=e[S],b=r._getRangedEntries("tableSpatial",[w],f),C=b.length;for(let _=0;_<C;_++){const y=b[_],v=y.getAnchorCoords(),x=v.colStart-w.colStart,E=v.rowStart-w.rowStart,R=y.getSnapshot(t);a.push({async copyTo(I,A){const T=I.getSheet(),O=I.getCoords();if(r.getProtection().isLocked())return;const N={colStart:O.colStart+x,rowStart:O.rowStart+E,colEnd:O.colEnd+x,rowEnd:O.rowEnd+E};return R.copyTo({tables:T.getTables(),range:N},A)}})}}for(let S=0;S<h;S++){const w=e[S];a.push(Rm(o.getColumnHeaders().getRange(w),w,Object.freeze({...t,includeHeaders:w.rowStart<=d.rowStart&&w.rowEnd>=d.rowEnd})))}for(let S=0;S<h;S++){const w=e[S];a.push(Rm(o.getRowHeaders().getRange(w),w,Object.freeze({...t,includeHeaders:w.colStart<=d.colStart&&w.colEnd>=d.colEnd})))}const g=ix(o,r,e,l,t,(S,w)=>r._copyRange(o,r,e,S,w,u));a.push(g);const m=r._getState().calcGraph.getSnapshot({range:e[0]});a.push({async copyTo(S,w){const b=S.getSheet(),C=S.getCoords();if(r.getProtection().isLocked())return;const _=b._getState().calcGraph;return m.copyTo({calcGraph:_,range:C},w)}});const p=e[0];return((S,w,b,C,_,y,v=null)=>({async copyTo(x,E){let R=null;const I={..._,...E},A=b.beginCommit(I.description??y);try{const T=S.length;for(let O=0;O<T;O++){const N=await S[O].copyTo(x,I);N&&(R=q.unionRanges(R,N))}A.commit()}catch(T){throw A.rollback(),T}return R},getMarkOptions:()=>_,getName:()=>y,getSource:()=>w,getCoords:()=>C,toText(){let x=v?.toText?.()??null;const E=S.length;for(let R=0;!x&&R<E;R++)x=S?.[R].toText?.();return x??null},toHtml(){let x=v?.toHtml?.()??null;const E=S.length;for(let R=0;!x&&R<E;R++)x=S?.[R].toHtml?.();return x??null},toImage(){let x=v?.toImage?.()??null;const E=S.length;for(let R=0;!x&&R<E;R++)x=S?.[R].toImage?.();return x??null},isISnapshot:!0}))(a,o,r,p,t,l,g)}async _copyRange(e,t,n,r,o,i){if(n.length>1)throw new Pe("Only a single selection is supported when using 'Insert Copy'.");if(!n||n.length===0)throw new Pe("The source has no range.");const l=r.getSheet();let a=r.getCoords(),c={...n[0]};const u=(o={...o}).isCut;let d=!o.type||o.type===ut.Content.Formats,h=!o.type||o.type===ut.Content.Values,f=!o.type||o.type===ut.Content.Formats||o.type===ut.Content.Hyperlinks;const g=l.getEntireRange(),m=g.getCoords(),p=[],S=[],w=[];let b=[],C=[];const _=(o.fitDestination??!1)&&!q.isSingleCell(a),y=a;if(_&&(c={...c,colEnd:c.colStart+Math.min(y.colEnd-y.colStart,c.colEnd-c.colStart),rowEnd:c.rowStart+Math.min(y.rowEnd-y.rowStart,c.rowEnd-c.rowStart)}),!q.isRangeWithinRange(y,m))throw console.warn(y,m),new Pe("We can't paste outside of the sheet bounds.");let v=null;v=o.undoRange?{view:l.getView(),selection:Rt([o.undoRange.getCoords()])}:{sheet:l,selection:Rt([y])};const x=l.getTransactions().beginCommit({description:o.description??"Paste"});try{if(!this._getState())return P.EmptyArray;const E=new Set,R=o.transpose;let I=!((R||o.adjustCells)&&d)&&E.size===1;if(I){const G=E.values().next();I=q.isRangeWithinRange(c,G.value.getCoords())&&!bi(c,G.value.getCoords())}I&&(I=l.getTables().getItems({address:y}).length===0),R&&(I=!0),i.singleMerge&&(d=!1,f=!1);const A=a.colStart-c.colStart,T=a.rowStart-c.rowStart,O=o.adjustCells;let N={...Sb};if(delete N[je.Type.Style],!d){const G=this.getProtection().isLocked();N={},G&&(N[je.Type.Unlock]=!1)}const D=B.Orientation.Column;let F;if(h){F=g.startIncrementalUpdates({orientation:o.transpose?B.Orientation.Row:B.Orientation.Column});const G={orientation:D,includeRangeTypes:N,bounds:c},ee=new pu(this._strings,G,this._cellOptions),ne=(oe,Z,Y)=>{const we=oe[0],ge=ee.setState(oe),de=ee.context,be=de.getCell(),he=be.isTopLeft();let fe=T,z=A;if(R){const H=we.colIndex-c.colStart,ie=we.rowIndex-c.rowStart;fe=H+Y+a.rowStart,z=ie+Z+a.colStart}else fe=T+we.rowIndex+Z,z=A+we.colIndex+Y;let Fe=!1;const De={value:void 0,style:void 0,hyperlink:void 0};if(h&&(De.value=ge,Fe=!0),d){const H=oe[2];H&&(H.directStyle||H.table)&&(De.style=be.getStyle(!I),Fe=!0)}f&&(De.hyperlink=be.getHyperlink(),Fe=!0);let Ge=De;if(O&&he){const H=O(ge,de,{rowIndex:fe,colIndex:z},o);H!==void 0&&(Ge=H,Fe=!0)}if(Fe&&(F.pushAt(fe,z,Ge),d)){const H=be.getSpans();(H.width>1||H.height>1)&&he&&p.push({colStart:z,rowStart:fe,colEnd:z+(o.transpose?H.height:H.width)-1,rowEnd:fe+(o.transpose?H.width:H.height)-1})}},re=this._cellStateIterator(G);let U={next(){const oe=re.next();if(oe.done)return xt;const Z=oe.value[0];let Y;return oe.value&&(Y=[Z,oe.value]),{done:oe.done,value:Y}}};if(!i.singleMerge&&!q.isEqualRanges(y,c)){const oe=y.colEnd-y.colStart+1,Z=y.rowEnd-y.rowStart+1;U=new ud({delegate:U,bounds:c,orientation:D,dims:{major:o.transpose?Z:oe,minor:o.transpose?oe:Z}})}let ue=U.next();for(;!ue.done;){const oe=ue.value,Z=oe[1],Y=oe[0],we=Z[0];ne(Z,Y.rowIndex-we.rowIndex,Y.colIndex-we.colIndex),ue=U.next()}}const k=t._getState(),L={},W={transpose:R??!1};d&&(L.directStyleSpatial=k.directStyleSpatial,L.continuousFillSpatial=k.continuousFillSpatial,L.mergeSpatial=k.mergeSpatial),u&&(e._clear([c],void 0,void 0,!1,!0),b.push(c),L.rangesListenerSpatial2=k.rangesListenerSpatial2);const $=l,J=$._getState(),te=Object.keys(L),Q=te.length;for(let G=0;G<Q;G++){const ee=te[G],ne=L[ee].createCopiedEntries(c,y,W),re=J[ee].clone(),U=ne.removes,ue=U.length;for(let oe=0;oe<ue;oe++)re.remove(U[oe]);re.load(ne.inserts),J[ee]=re}$._updateState(J),b.push(y),C.push(y),S&&S.length>0&&$._colHeaders.updateHeaderPairs(S),w&&w.length>0&&$._rowHeaders.updateHeaderPairs(w),F?.apply(),p.length>0&&l.getRanges(p).merge(),x.commit({viewBefore:v,viewAfter:G=>({...G,view:l.getView(),selection:Rt(C),ranges:b})})}catch(E){throw console.warn(E),x.rollback(),new Error((R=>`Unable to paste: ${R}`)(E.message),{cause:E})}return q.unionRangesArrays(C)}_snapShotFromSource(e,t){if(e.isISnapshot)return e;const n=e;let r=null;if(n?.isICellRanges)throw new Pe(Tf);if(r=n?.isICellRange?n:this.getRange(n),r.isICellRange){const o=r;if(o.isInvalid())throw new Pe(kf);return o.getSnapshot(t)}throw new Pe(kf)}async _copyFrom(e,t,n){if(!t)throw new Pe("Both a source and a destination are required to copy.");const r=this._snapShotFromSource(t),o="Paste",i=this._beginCommit({description:n?.description??o});let l=null;try{const a=fd(e,r.getCoords(),n?.fitDestination,n?.transpose),c=this.getRange(a);l=await r.copyTo(c,n);const u=r.getName(),d=[l];n?.isCut&&d.push(r.getCoords()),i.commit({description:u?n?.description??`${o} ${u}`:o,viewAfter:{view:this.getView(),selection:Rt([l??a]),ranges:d}})}catch(a){throw i.rollback(),a}return l}_createFilter(e,t,n){const r=this;return new NS({initialAnchor:e,maxRangeCoords:this._entireCoords,json:t,transactions:this._transactions,deleteFromContainer:o=>{const i=this._beginCommit({description:o?.description??"Delete Filter"});this._updateState({filter:null}),i.commit()},apply:o=>{console.log("apply Filter",o)},processUpdate:()=>{},isProtected:()=>!r._initializing&&!r.getProtection().isAutoFilterAllowed()})}insertFilter(e){const t=this._rangeToCoords(e,()=>["autoFilter"]);let n=this.getFilter();if(n)return n;n=this._createFilter(t);const r=Rt([t]),o=this._beginCommit({description:"Insert Filter"});return this._updateState({filter:n}),o.commit({viewAfter:{ranges:[t],view:this.getView(),selection:r,selectOptions:void 0}}),n}getFilter(){return this._getState()?.filter??null}insertSort(e){return this._rangeToCoords(e,()=>["sort"]),null}getSort(){return null}_getDefaultShiftOrientation(e){return rv(e,this._entireCoords)}_getDefaultSortCriteria(e,t,n){return Xf(this,e,n?this._cellToCoords(n):null,t)}async _insertFrom(e,t,n){if(!t)throw new lr;const r=this._snapShotFromSource(t),o=r.getCoords();let i=fd(e[0],o,n?.fitDestination),l=Rt([i]),a=l;const c=n?.orientation??this._getDefaultShiftOrientation(i),u=this._beginCommit({description:n?.description??"Insert Copied Cells",autoSelect:n?.autoSelect});try{if(this._insertCells([i],c),await this._copyFrom(i,r,{...n,isCut:!1}),n.isCut){const d={...o};if(l=Rt([d]),i={...i},this===r.getSource()){if(c===B.Orientation.Row){if(i.colStart<d.colStart&&i.colEnd>=d.colStart||i.colEnd>d.colEnd&&i.colStart<=d.colEnd)throw new Pe(Ff);if(d.colStart===i.colStart&&d.colEnd===i.colEnd){const h=d.rowEnd-d.rowStart+1;i.rowStart<=d.rowStart?(d.rowStart+=h,d.rowEnd+=h):(i.rowStart-=h,i.rowEnd-=h)}}else{if(i.rowStart<d.rowStart&&i.rowEnd>=d.rowStart||i.rowEnd>d.rowEnd&&i.rowStart<=d.rowEnd)throw new Pe(Ff);if(d.rowStart===i.rowStart&&d.rowEnd===i.rowEnd){const h=d.colEnd-d.colStart+1;i.colStart<=d.colStart?(d.colStart+=h,d.colEnd+=h):(i.colStart-=h,i.colEnd-=h)}}a=Rt([i])}r.getSource().getRanges([d]).delete(c)}u.commit({viewBefore:{ranges:e,view:this.getView(),selection:l,selectOptions:n?.autoSelect},viewAfter:{ranges:e,view:this.getView(),selection:a,selectOptions:n?.autoSelect}}),this._autoSelect(n?.autoSelect??!1,a)}catch(d){throw u.rollback(),d}return i}_insertCells(e,t,n=void 0){const r=this;let o;n=n??((m,p)=>{r._validateCoords(m,p??au)}),t===B.Orientation.Column||t===B.Orientation.Row?(o=t,t={}):t&&(o=t.orientation);const i=t?.description??"Insert Cells",l=(o??this._getDefaultShiftOrientation(e[0]))===B.Orientation.Column;if(this._protectionCheck(()=>[l?"insertColumns":"insertRows"],e,i),wi(e))throw new Pe("We can't insert cells with overlapping selections.");const a=this._entireCoords;let c=a.colEnd,u=a.rowEnd;const d=Rt(e),h=this._beginCommit({description:i,operation:{name:"insertCells"}}),f=h.getState(this),g=l?B.Direction.Right:B.Direction.Down;try{let m=f.cellValuesGrid,p=f.contentfulSpatial,S=f.unlockSpatial,w=f.mergeSpatial,b=f.directStyleSpatial,C=f.continuousFillSpatial,_=f.conditionalSpatial,y=f.hyperlinkSpatial,v=f.commentsSpatial,x=f.movableSpatial,E=f.tableSpatial,R=f.calcGraph,I=f.rangesListenerSpatial2,A=f.rangeListenerSpatial,T=f.rangesListenerMap;const O=new Map,N=Kr(e.slice(),B.Direction.Left),D=N.length;for(let W=0;W<D;W++){const $=N[W];c=Math.min(c,$.colStart),u=Math.min(u,$.rowStart);const J=l?$.colEnd-$.colStart+1:$.rowEnd-$.rowStart+1,te=m.getCoords();if(te){const ne={...$,colEnd:l?Math.max($.colEnd,te?.colEnd??$.colStart)+($.colEnd-$.colStart+1):$.colStart,rowEnd:l?$.rowStart:Math.max($.rowEnd,te?.rowEnd??$.rowStart)+($.rowEnd-$.rowStart+1)},re=p.search(ne),U=re.length;for(let ue=0;ue<U;ue++){const oe=re[ue],Z={...$};l?Z.colEnd=Math.max(Z.colEnd,oe.colEnd)+J:Z.rowEnd=Math.max(Z.rowEnd,oe.rowEnd)+J,n(Z)}m=m.clone(),m.shift($,g),this._updateState({cellValuesGrid:m})}const Q=$.colStart<=a.colStart&&$.colEnd>=a.colEnd,G=$.rowStart<=a.rowStart&&$.rowEnd>=a.rowEnd,ee=(ne,re,U,ue)=>{let oe=null;U>1&&(oe=ne.at(U-1));const Z=ue-U+1;re?.(U,Z),oe&&ne.updateHeaderPairs([{address:{min:U,max:ue},update:oe}])};Q&&ee(this._rowHeaders,this._rowHeadersShiftCallback,$.rowStart,$.rowEnd),G&&ee(this._colHeaders,this._colHeadersShiftCallback,$.colStart,$.colEnd),p=p.shift({range:$,direction:g,cloneIfUpdate:p===f.contentfulSpatial,coordValidator:n}),S=S.shift({range:$,direction:g,cloneIfUpdate:S===f.unlockSpatial,coordValidator:n}),w=w.shift({range:$,direction:g,cloneIfUpdate:w===f.mergeSpatial,coordValidator:n}),b=b.shift({range:$,direction:g,cloneIfUpdate:b===f.directStyleSpatial,coordValidator:n}),C=C.shift({range:$,direction:g,cloneIfUpdate:C===f.continuousFillSpatial,coordValidator:n}),_=_.shift({range:$,direction:g,cloneIfUpdate:_===f.conditionalSpatial,coordValidator:n}),y=y.shift({range:$,direction:g,cloneIfUpdate:y===f.hyperlinkSpatial,coordValidator:n}),v=v.shift({range:$,direction:g,cloneIfUpdate:v===f.commentsSpatial,coordValidator:n}),x=x.shift({range:$,direction:g,cloneIfUpdate:x===f.movableSpatial,coordValidator:n}),E=E.shift({range:$,direction:g,cloneIfUpdate:E===f.tableSpatial,coordValidator:n}),R=R.shift({range:$,direction:g,cloneIfUpdate:R===f.calcGraph}),A=A.shift({range:$,direction:g,cloneIfUpdate:A===f.rangeListenerSpatial,onShift:ne=>{T===f.rangesListenerMap&&(T=new Map(T)),this._processListenerShift(T,O,f.rangesListenerMap,ne)}}),I=I.shift({range:$,direction:g,cloneIfUpdate:I===f.rangesListenerSpatial2,coordValidator:n})}let F=f.formulaSpatial,k=f.spillSpatial,L=f.pendingSpatial;R!==f.calcGraph&&(F=F.clone(),k=k.clone(),L=L.clone()),this._updateState({contentfulSpatial:p,unlockSpatial:S,mergeSpatial:w,directStyleSpatial:b,continuousFillSpatial:C,conditionalSpatial:_,hyperlinkSpatial:y,commentsSpatial:v,movableSpatial:x,tableSpatial:E,calcGraph:R,formulaSpatial:F,spillSpatial:k,pendingSpatial:L,rangesListenerSpatial2:I,rangeListenerSpatial:A,rangesListenerMap:T}),this._commitAndAutoSelect(h,d,t?.autoSelect,{viewAfter:{ranges:N,listeners:O}},l?B.Orientation.Column:B.Orientation.Row)}catch(m){throw h.rollback(),m instanceof Tt?new Pe(m.message??au):m}}_deleteCells(e,t){let n;t===B.Orientation.Column||t===B.Orientation.Row?(n=t,t={}):t&&(n=t.orientation);const r=(n??this._getDefaultShiftOrientation(e[0]))===B.Orientation.Column,o=t?.description??"Delete Cells";if(this._protectionCheck(()=>[r?"deleteColumns":"deleteRows"],e,o),wi(e))throw new Pe("We can't delete cells with overlapping selections.");const i=this._entireCoords;let l=i.colEnd,a=i.rowEnd;const c=r?B.Direction.Left:B.Direction.Up,u=Rt(e),d=this._beginCommit({description:o,operation:{name:"deleteCells"}}),h=d.getState(this);try{let f=h.cellValuesGrid,g=h.contentfulSpatial,m=h.mergeSpatial,p=h.unlockSpatial,S=h.directStyleSpatial,w=h.continuousFillSpatial,b=h.conditionalSpatial,C=h.hyperlinkSpatial,_=h.commentsSpatial,y=h.movableSpatial,v=h.movableMapModel,x=h.tableSpatial,E=h.tableMapModel,R=h.calcGraph,I=h.rangesListenerSpatial2,A=h.rangeListenerSpatial,T=h.rangesListenerMap;const O=new Map,N=Kr(e.slice(),B.Direction.Left),D=N.length;for(let F=0;F<D;F++){const k=N[F];l=Math.min(l,k.colStart),a=Math.min(a,k.rowStart),f.getCoords()&&(f=f.clone(),f.shift(k,c),this._updateState({cellValuesGrid:f}));const L=k.colStart<=i.colStart&&k.colEnd>=i.colEnd,W=k.rowStart<=i.rowStart&&k.rowEnd>=i.rowEnd;L&&this._rowHeadersShiftCallback(k.rowStart,-1*(k.rowEnd-k.rowStart+1)),W&&this._colHeadersShiftCallback(k.colStart,-1*(k.colEnd-k.colStart+1)),g=g.shift({range:k,direction:c,cloneIfUpdate:g===h.contentfulSpatial}),p=p.shift({range:k,direction:c,cloneIfUpdate:p===h.unlockSpatial}),m=m.shift({range:k,direction:c,cloneIfUpdate:m===h.mergeSpatial}),S=S.shift({range:k,direction:c,cloneIfUpdate:S===h.directStyleSpatial}),w=w.shift({range:k,direction:c,cloneIfUpdate:w===h.continuousFillSpatial}),b=b.shift({range:k,direction:c,cloneIfUpdate:b===h.conditionalSpatial}),C=C.shift({range:k,direction:c,cloneIfUpdate:C===h.hyperlinkSpatial}),_=_.shift({range:k,direction:c,cloneIfUpdate:_===h.commentsSpatial}),y=y.shift({range:k,direction:c,cloneIfUpdate:y===h.movableSpatial}),x=x.shift({range:k,direction:c,cloneIfUpdate:x===h.tableSpatial}),R=R.shift({range:k,direction:c,cloneIfUpdate:R===h.calcGraph}),A=A.shift({range:k,direction:c,cloneIfUpdate:A===h.rangeListenerSpatial,onShift:$=>{T===h.rangesListenerMap&&(T=new Map(T)),this._processListenerShift(T,O,h.rangesListenerMap,$)}}),I=I.shift({range:k,direction:c,cloneIfUpdate:I===h.rangesListenerSpatial2})}this._updateState({contentfulSpatial:g,unlockSpatial:p,mergeSpatial:m,directStyleSpatial:S,continuousFillSpatial:w,conditionalSpatial:b,hyperlinkSpatial:C,commentsSpatial:_,movableSpatial:y,movableMapModel:v,tableSpatial:x,tableMapModel:E,calcGraph:R,rangesListenerSpatial2:I,rangeListenerSpatial:A,rangesListenerMap:T}),this._commitAndAutoSelect(d,u,t?.autoSelect,{viewAfter:{ranges:N,listeners:O}})}catch(f){throw d.rollback(),f instanceof Tt?new Pe(f.message??au):f}}_autoFit(e,t){if(this._closed)throw new Error(Nn);t={expandOnly:!1,skipCustomSize:!1,minContent:!1,...t};const n="Autofit";let r;const o=Ed(e,this._entireCoords,!0),i=xd(e,this._entireCoords,!0);r=!o&&i?`${n} ${no}`:!i&&o?`${n} ${to}`:i&&o?`${n} All`:`${n}`;let l=t.orientations!==B.Orientations.Row;this._colHeaders.isProtected()&&(l=!1);let a=t.orientations!==B.Orientations.Column;if(this._rowHeaders.isProtected()&&(a=!1),!a&&!l)return;const c=l&&(t.expandOnly===!1||t.expandOnly===B.Orientation.Row),u=a&&(t.expandOnly===!1||t.expandOnly===B.Orientation.Column),d=t.minContent;a&&this._protectionCheck(()=>["formatRows"],e,r),l&&this._protectionCheck(()=>["formatColumns"],e,r);const h=(m,p)=>m===void 0?p:p===void 0?m:m.sizeSet-p.sizeSet,f=Rt(e),g=this._beginCommit({description:t.description??r});try{let m=Number.MAX_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER,S=!1,w="",b=-1,C=!1,_=!1,y=!1,v=Number.MAX_SAFE_INTEGER,x=Number.MIN_SAFE_INTEGER;const E=this._styles.getNormal(),R=this._cellOptions,I=t.orientations===B.Orientations.Row,A=new Map,T=cd(e,1);T.sort(q.createRangeComparator(B.Orientation.Column));const O=T.length,N={skipCustomSize:t.skipCustomSize},D=Be.getDeviceScale(),F=this._defaultRowHeight()*D,k=this._defaultColWidth(),L=($,J=1)=>{if($!==0&&!(J>1))return $=Math.max($,F),te=>u?$:Math.max(te,$??F)},W=($,J=1)=>{if($!==0&&!(J>1))return te=>c?$:Math.max(te,$??k)};for(let $=0;$<O;$++){const J=[];let te=-1,Q=!1,G=E,ee=1,ne=1,re=1;const U=T[$];let ue=U.colStart,oe=U.rowStart,Z=U.colEnd,Y=U.rowEnd;const we=this._getUsedCoords();(u||c)&&we&&(ue=u?we.colStart:U.colStart,oe=c?we.rowStart:U.rowStart,Z=u?we.colEnd:U.colEnd,Y=c?we.rowEnd:U.rowEnd);const ge={includeRangeTypes:{[je.Type.Style]:!1,[je.Type.Merge]:!1,[je.Type.Continuous]:!1,[je.Type.Contentful]:!1},ignoreHidden:!1,bounds:{colStart:ue,rowStart:oe,colEnd:Z,rowEnd:Y},orientation:B.Orientation.Column},de=a?[]:void 0,be=l?[]:void 0,he=(Ee,K,le)=>{if(Ee>K)return null;const X=[];let ae=Ee;const Ie=le?le.length:0;for(let ve=0;ve<Ie;ve++){const ze=le[ve],_e=ze.min,Ne=ze.max;if(ae>=_e){ae=Ne+1;continue}const me={address:{min:ae,max:_e-1},update:$m};X.push(me),ae=Ne+1}if(ae<=K){const ve={address:{min:ae,max:K},update:$m};X.push(ve)}return X},fe=this._rangeStateIterator(ge);let z=fe.next();for(;!z.done;){const Ee=z.value,K=Ee.intersection,le=Ee.start,X=Ee.end;ni.colStart=le.colIndex,ni.rowStart=le.rowIndex,ni.colEnd=X.colIndex,ni.rowEnd=X.rowIndex;const ae=q.intersectRanges(ni,U,yx),Ie=ls(0,ae,K,R).getBestFit();if(a){const ve=Math.max(le.rowIndex,oe),ze=Math.min(X.rowIndex,Y),_e=Ie.height,Ne={address:{min:ve,max:ze},update:{size:L(_e),autoSize:!0},sizeSet:_e===null?-1:_e};de.push(Ne)}if(l){const ve=Math.max(le.colIndex,ue),ze=Math.min(X.colIndex,Z),_e=Ie.width,Ne={address:{min:ve,max:ze},update:{size:W(_e),autoSize:!0},sizeSet:_e===null?-1:_e};be.push(Ne)}z=fe.next()}const Fe=this._cellStateIterator({...ge,includeRangeTypes:{[je.Type.Merge]:!1,[je.Type.Table]:!1,[je.Type.Style]:!1,[je.Type.Continuous]:!1},ignoreEmptyIntersections:!0});let De,Ge,H,ie=Fe.next(),Se=1,j=1;for(;!ie.done;){const Ee=ie.value,K=Ee[0],le=Ee[2];let X=E;const ae=le?.directStyle??le?.table.getStyle()??null;ae===De?X=Ge:(X=ae?ls(0,q.cellToRange(K,bx),le,R):E,Ge=X);let Ie=1,ve=1;const ze=le?.merge??null;if(ze===H)Ie=Se,ve=j;else{if(ze){const Ve=ze.getCoords();Ie=Ve.colEnd-Ve.colStart+1,ve=Ve.rowEnd-Ve.rowStart+1}else Ie=1,ve=1;Se=Ie,j=ve}const _e=K.colIndex,Ne=K.rowIndex,me=Ee[1],Re=yn(me),Me=q.isCellWithinRange(K,U),qe=le?.continuous??null;qe&&(re=qe.getCoords().colEnd-_e+1);let nt=!1,Ye=!1;if(De===ae&&Ie===ee&&ve===ne&&Re!==Le.String&&Re!==Le.Error&&Me===Q||(nt=!0,Re===Le.RichData&&(Ye=!0),Ye&&(nt=!1)),De=ae,H=ze,(te!==_e||nt)&&(te!==-1&&J.push({col:te,style:G,spanWidth:Ie,spanHeight:ve,minVal:m,maxVal:p,hasZero:S,text:w,textId:b,hasFalse:_,hasTrue:C,hasEmpty:y,minRow:v,maxRow:x,colWidth:this._colHeaders.getSpanSize(te),measureWidth:-1,measureHeight:-1,colSpan:re,isFit:Q}),te=_e,G=X,Q=Me,ee=Ie,ne=ve,m=Number.MAX_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER,S=!1,w="",b=-1,_=!1,C=!1,y=!1,v=Ne),x=Ne,!Ye)if(me===null)y=!0;else switch(Re){case Le.Number:me===0&&(S=!0),m=Math.min(m,me),p=Math.max(p,me);break;case Le.String:w=me,b=me;break;case Le.Error:w=me.toString(),b=-1;break;case Le.Boolean:me?C=!0:_=!0}ie=Fe.next()}te!==-1&&J.push({col:te,style:G,spanWidth:ee,spanHeight:ne,minVal:m,maxVal:p,hasZero:S,text:w,textId:b,hasFalse:_,hasTrue:C,hasEmpty:y,minRow:v,maxRow:x,colWidth:this._colHeaders.getSpanSize(te),colSpan:re,measureWidth:-1,measureHeight:-1,isFit:Q});let se=-1,ye=-1;const xe=J.length;for(let Ee=0;Ee<xe;Ee++){const K=J[Ee],le=I||!K.isFit,X=K.maxVal,ae=K.style,Ie=K.colSpan;let ve=K.colWidth;if(Ie>1&&(ve=this._colHeaders.getSpanSize(te,te+Ie)),se=0,ye=0,X!==Number.MIN_SAFE_INTEGER){const _e=Qr(Le.Number,ae,X,R,ve,d,le);se=_e.width,ye=_e.height;const Ne=K.minVal;if(Ne*X<0){const me=Qr(Le.Number,ae,Ne,R,ve,d,le);se=Math.max(se,me.width),ye=Math.max(ye,me.height)}if(K.hasZero&&Ne!==0&&X!==0){const me=Qr(Le.Number,ae,0,R,ve,d,le);se=Math.max(se,me.width),ye=Math.max(ye,me.height)}}const ze=K.text;if(ze.length>0){const _e=Qr(Le.String,ae,ze,R,ve,d,le,void 0,A);se=Math.max(se,_e.width),ye=Math.max(ye,_e.height)}if(K.hasTrue||K.hasFalse){const _e=Qr(Le.Boolean,ae,!K.hasFalse,R,ve,d,le);se=Math.max(se,_e.width),ye=Math.max(ye,_e.height)}if(K.hasEmpty){const _e=Qr(Le.Boolean,ae,null,R,ve,d,le);se=Math.max(se,_e.width),ye=Math.max(ye,_e.height)}K.measureWidth=se,K.measureHeight=ye}if(l){for(let le=0;le<xe;le++){let X=J[le];const ae=X.col;let Ie=J[le+1],ve=X.measureWidth??0;for(;Ie&&Ie.col===ae;)Ie.measureWidth&&(ve=Math.max(Ie.measureWidth??0,ve)),le++,X=J[le],Ie=J[le+1];ve===0&&(ve=null);const ze=W(ve,X.spanWidth);be.push({address:{min:ae,max:ae},update:{size:ze,autoSize:!0},sizeSet:ve===null?-1:ve})}be.sort(h);let Ee=this._colHeaders.updateHeaderPairs(be,N);Ee=Tr(Ro(Ng(Ee)));const K=he(U.colStart,U.colEnd,Ee);K&&this._colHeaders.updateHeaderPairs(K,N)}if(a){for(let le=0;le<xe;le++){let X=J[le],ae=X.measureHeight??0;ae===0&&(ae=null);const Ie=L(ae,X.spanHeight);de.push({address:{min:X.minRow,max:X.maxRow},update:{size:Ie,autoSize:!0},sizeSet:ae===null?-1:ae})}de.sort(h);let Ee=this._rowHeaders.updateHeaderPairs(de,N);Ee=Tr(Ro(Ng(Ee)));const K=he(U.rowStart,U.rowEnd,Ee);K&&this._rowHeaders.updateHeaderPairs(K,N)}}this._commitAndAutoSelect(g,f,t?.autoSelect,{viewAfter:{ranges:e}})}catch(m){throw g.rollback(),m}}_createRangeEvent(e,t,n){const r=this,o=()=>{const l=r._getState();return this._closed||l.deleted?Nr(null):e?Array.isArray(e)?r._createRanges(e):r._createRange(e):Nr(this,this._entireCoords)},i=t.trigger;return{getSource:o,getFrom:()=>{const l=t.from;if(l)return l;let a=n;return a||(a=o().getCoords()),Array.isArray(a)?r._createRanges(a):r._createRanges([a])},getTo:()=>t.to??null,trigger:i,isUndo:t.isUndo??!1,isDataChange:t.isDataChange??!1,isTransactional:t.isTransactional??!0,toString:()=>`SheetRangeEvent: ('${i}', ${o().toString()})`,timeStamp:t.timeStamp??Date.now()}}_notifyAddressListeners(e,t,n,r){const o=t.entries();let i=o.next();const l=r.trigger;for(;!i.done;){const a=i.value[0];let c=i[1];if(c||(c=e.get(a)),c&&!n.has(a)){let u=!1;const d=c.options;d&&(u=l==="address"?d.ignoreAddressChanges:d.ignoreDataChanges),u!==!0&&c.notify(r),n.add(a)}i=o.next()}}_notifyDataListeners(e,t,n=null,r,o){if(!e)return;const i=n.length;for(let l=0;l<i;l++){const a=n[l];if(!a)continue;const c=e.search(a),u=c.length;for(let d=0;d<u;d++){const h=c[d].value.groupId;if(!r.has(h)){const f=t.get(h);f.options?.ignoreDataChanges!==!0&&f.notify(o),r.add(h)}}}}_notifyRangeListeners(e,t,n=null,r){if(!e)return;const o=new Set;r.timeStamp||(r.timeStamp=Date.now());const i=n.length;for(let l=0;l<i;l++){const a=n[l];if(!a)continue;const c=e.search(a),u=c.length;for(let d=0;d<u;d++){const h=c[d].value.id;if(o.has(h))continue;const f=t.get(h);o.add(h);const g=f.ranges,m=g.length;for(let p=0;p<m;p++){const S=g[p],w=this._createRangeEvent(S,r,a);this._notifyRangeListener2(f,w,r)}}}}_notifyRangeListener2(e,t=null,n=null){if(e.options?.ignoreDataChanges&&n?.isDataChange)return;const r=e.handler??e.handlerW.deref();if(r)try{r?.(t)}catch(o){console.warn(o)}}_notifyUsedRangeChange(){this._lastCellRead.coords=null,this._lastUsedCoordsRead.coords=null,this._emitter.notify("onUsedRangeChange")}_notifyMergeChange(){this._emitter.notify("onMergesChange")}addListeners(e,t){let n=null;if(e.onLayoutChange){const o=e,i={onSizesChange:()=>{o.onLayoutChange(this)}};n=[],n.push(this._colHeaders.addListeners(i,t)),n.push(this._rowHeaders.addListeners(i,t))}let r=this._emitter.addListeners(e,t);if(n){const o=r;r=()=>{const i=n.length;for(let l=0;l<i;l++)n[l]();o()}}return r}_addRangesListeners(e,t,n){if(this._closed)throw new Error(Nn);if(!t)throw new Pe(Cf);n=n?{...Ol,...n}:Ol;const r=n?.transactional??!1,o=this,i=wx++%Number.MAX_SAFE_INTEGER,l=()=>{let m=null,p=null;if(r){const C=o._getState();if(!C)return;m=C.rangeListenerSpatial.clone(),p=new Map(C.rangesListenerMap)}else m=o._rangeListenerSpatial,p=o._rangesListenerMap;const S=p.get(i);if(!S)return void console.log("Listener not found");const w=S.ranges,b=w.length;for(let C=0;C<b;C++){const _=q.sanitizeRange(w[C]);_!==null&&m.remove(_,(y,v)=>{if(v.value.id===i)return!0})}if(p.delete(i),r){const C=this._beginCommit({description:"Remove Range Listener"});this._updateState({rangeListenerSpatial:m,rangesListenerMap:p}),C.commit({forceAmend:!0})}},a=[...e];let c={id:i,handler:null,handlerW:null,removeListener:l,options:n,ranges:a};n?.weakly?c.handlerW=new WeakRef(t):c.handler=t;let u=null,d=null,h=null;if(r){h=this._beginCommit({description:"Add Range Listener"});const m=this._getState();u=m.rangeListenerSpatial.clone(),d=new Map(m.rangesListenerMap)}else u=o._rangeListenerSpatial,d=o._rangesListenerMap;const f=[],g=e.length;for(let m=0;m<g;m++){const p={...e[m],value:{id:i,offset:m,options:n}};f.push(p)}return u.load(f),d.set(i,c),h&&(this._updateState({rangeListenerSpatial:u,rangesListenerMap:d}),h.commit({forceAmend:!0})),l}_addRangesListeners2(e,t,n,r){if(this._closed)throw new Error(Nn);if(!t)throw new Pe(Cf);n=n?{...Ol,...n}:Ol;const o=n?.transactional??!1,i=this,l=P.uuidV4(),a=_x++,c=()=>{let _=null,y=null;const v=i._getState();if(!v)return;_=v.rangesListenerSpatial2.clone(),y=v.rangesListenerMap2;const x=y.get(l);if(x){const R=x?.spatialsIds,I=x?.coords,A=R.length;for(let T=0;T<A;T++){const O=R[T],N=I[T];_.remove(N,(D,F)=>{if(F.value.uuid===O)return!0})}y=new Map(v.rangesListenerMap2),y.delete(l)}const E=this._beginCommit({description:"Remove Range Listener"});this._updateState({rangesListenerMap2:y}),E.commit({forceAmend:!0}),o||this._rangesListenerSorted.delete(a)};let u=null,d=this._beginCommit({description:"Add Range Listener"});const h=this._getState();u=h.rangesListenerSpatial2.clone();let f=null,g=null;n?.weakly?g=new WeakRef(t):f=t;const m=[],p=[...e];let S=[];const w=e.length;for(let _=0;_<w;_++){const y={...e[_]};p[_]=y;const v=P.uuidV4(),x=new gx(l,v,n?.ignoreAddressChanges??!1);S.push(v);const E={...q.sanitizeRange(y),value:x};m.push(E)}u.load(m),n={...n};const b=new fx(l,S,p,r,this,a,f,g,c,n),C=new Map(h.rangesListenerMap2);return C.set(l,b),this._updateState({rangesListenerSpatial2:u,rangesListenerMap2:C}),o||this._rangesListenerSorted.set(a,b),d.commit({forceAmend:!0}),c}_getUsedCoords(e){const t=this._getState();if(!t)return null;let n=t.cellValuesGrid.getCoords();return n=q.unionRanges(t.mergeSpatial.getBoundingCoords(),n),n=q.unionRanges(t.directStyleSpatial.getBoundingCoords(),n),n=q.unionRanges(t.formulaSpatial.getBoundingCoords(),n),n=q.unionRanges(t.spillSpatial.getBoundingCoords(),n),n=q.unionRanges(t.pendingSpatial.getBoundingCoords(),n),n&&(n.colStart=Math.max(n.colStart,this._entireCoords.colStart),n.rowStart=Math.max(n.rowStart,this._entireCoords.rowStart),n.colEnd=Math.min(n.colEnd,this._entireCoords.colEnd),n.rowEnd=Math.min(n.rowEnd,this._entireCoords.rowEnd)),!n||n.rowStart>n.rowEnd||n.colStart>n.colEnd?(this._lastUsedCoordsRead.coords=null,null):(this._lastUsedCoordsRead&&this._lastUsedCoordsRead.coords&&bi(this._lastUsedCoordsRead.coords,n)||(this._lastUsedCoordsRead.coords=n,this._lastUsedCoordsRead.range=null),this._lastUsedCoordsRead.coords)}_isContentful(e,t){return!!this._contentCounts(e,void 0,t)}_getCount(e,t=!1){const n=this._contentCounts(e,Cx,t);return n?n[ut.Content.Values]??0:0}_contentCounts(e,t,n){if(!t){const d=Object.keys(ut.Content),h=d.length;t=[];for(let f=0;f<h;f++){const g=d[f],m=ut.Content[g];m!==ut.Content.Formats&&m!==ut.Content.Tables&&t.push(m)}}const r={},o=t.length;let i,l,a=!1;for(let d=0;d<o;d++){const h=t[d];h===ut.Content.Values?r[je.Type.Contentful]=!1:h===ut.Content.Formulas?r[je.Type.Formula]=!1:h===ut.Content.Formats?r[je.Type.Style]=!1:h===ut.Content.Tables&&(r[je.Type.Table]=!1,a=!0)}const c=()=>{i=new Set,l={};for(let d=0;d<o;d++){const h=t[d];l[h]=0}},u=e.length;for(let d=0;d<u;d++){const h=e[d],f=this._rangeStateIterator({includeRangeTypes:r,ignoreHidden:n,bounds:h});let g=f.next();for(;!g.done;){l||c();const m=g.value,p=(m.end.colIndex-m.start.colIndex+1)*(m.end.rowIndex-m.start.rowIndex+1),S=m.intersection;if(S){S.contentful&&(l[ut.Content.Values]+=p),S.formula&&(l[ut.Content.Formulas]+=p);const w=S.table;w&&(a&&!i.has(w)&&(l[ut.Content.Tables]+=1,i.add(w)),S.contentful||(l[ut.Content.Values]+=p))}g=f.next()}}return l}getSelectedCell(){const e=this.getSelection().getCoords().cell,t=this._lastCellSelected;if(t?.cell&&q.isEqualCells(e,t.coords))return t.cell;const n=this.getRange(e).getCell();return this._lastCellSelected={coords:e,cell:n},n}find(e){return e?((e=typeof e=="string"?{text:e}:{...e}).from||(e.from=this.getSelection().getCoords().cell),this.getEntireRange().find(e)):Qt}_setMaxSize(e,t){const n=e?.width??Fl.width,r=e?.height??Fl.height,o=this._entireCoords,i=o.colEnd-o.colStart+1,l=o.rowEnd-o.rowStart+1;if(n===i&&r===l)return this;const a=this._beginCommit({description:"Set Size"});try{const c=Object.freeze({colStart:0,rowStart:0,colEnd:n-1,rowEnd:r-1});this._entireCoords=c,this._entireRange=this.getRange(c);const u=this.getSelection(),d=u.getCoords(),h=$S(d,Ba,c);u.updateCoords(h),this._emitter.notify("onViewChange",{source:this.getView()}),this._emitter.notify("onLayoutChange"),a.commit({viewBefore:{view:this.getView(),selection:d},viewAfter:{view:this.getView(),selection:h}}),this._autoSelect(t?.autoSelect,h)}catch(c){throw a.rollback(),c}return this}_find(e,t){if(this._closed)throw new Error(Nn);typeof t=="string"&&(t={text:t});const n=t?.text;if(!n)return null;const r=[...e],o=t?.orientation??B.Orientation.Row,i=t?.reverse,l=!t?.disableWrap,a=t?.from?this._cellToCoords(t?.from):null;let c=null;if(a){let v=-1;for(let O=0;v===-1&&O<r.length;O++)q.isCellWithinRange(a,r[O])&&(v=O);c=q.cellToRange(a);let x=gd(r[v],c,o);x.push(c);const E=q.createRangeComparator(o,i);x.sort(E);let R=-1;const I=x.length;for(let O=0;O<I;O++)E(x[O],c)<=0&&(R=O);r.splice(v,1,...x);const A=v+R,T=[];for(let O=0;O<=A;O++)T.push(r.shift());if(l){const O=T.length;for(let N=0;N<O;N++)r.push(T[N])}}if(r.length===0)return Qt;const u=t?.fields?.includes(ut.Content.Formulas)??!1,d=t?.fields?.includes(ut.Content.Values)??!0,h=t?.matchEntireCell??!1,f=t?.matchCase??!1,g=t?.useRegex??!1,m=((v,x,E)=>{const R=x?"":"i";return E?new RegExp(v,R):new RegExp((I=>{let A=I.replace(/[|\\{}()[\]^$+.]/g,"\\$&");return A=A.replace(/~\?/g,"\\?"),A=A.replace(/~\*/g,"\\*"),A=A.replace(/~~/g,"~"),A})(v),R)})(n,f,g),p=n.length;let S=(v,x)=>{const E=A=>{if(!A)return!1;let T=!!A.match(m);return T&&h&&A.length!==p&&(T=!1),T},R=x.getCell();let I=!1;return!I&&u?I=E(R.getFormulaText()??R.toTextUnformatted(!0)):d&&(I=E(R.getNumberFormat().displayText)),I};if(t?.matchCustom){const v=t.matchCustom,x={matchCase:f,matchEntireCell:h,useRegex:g,fields:t?.fields??[ut.Content.Formulas]};let E,R,I=S;const A=()=>I(E,R);S=(T,O)=>(E=T,R=O,v(T,A,x,O))}let w=-1,b=null,C=xt,_=!1;const y=()=>{if(C.done){if(w++,w>=r.length)return void(_=!0);b=this._cellIterator({reverse:i,orientation:o,includeRangeTypes:!1,bounds:r[w]})}if(C=b.next(),!C.done){const v=C.value;return S(v.value,v.context)}return!1};return{next:()=>{let v=null;for(;!_&&!v;)y()&&(v=C.value.context.getCell());return v?{value:v,done:!1}:xt}}}isDate1904(){return this._isDate1904}_surroundingRegion(e,t){const n=this._getState(),r=t?.contentOnly??!1,o=this._entireCoords;if(!r){const l=n.tableSpatial.search(e);if(l.length>0){const a=l[0].value.model,c=a.getUsedRange().getCoords(),u=a.getRange().getCoords();return q.isEqualRanges(c,e)?u:q.isEqualRanges(u,e)?o:c}}const i=r?e:o;return((l,a,c=2e4)=>{if(!a||a.length===0)return null;let u,d=!1;for(let C=0;C<a.length;C++){const _=a[C];u=q.unionRanges(u,_.getBoundingCoords()),d=d||_.search(l).length>0}if(!u)return null;const h={...q.EmptyRange},f=l;let g=d?{...l}:null;if(!g){const C=(y=>{let v=[];const x=a.length;for(let E=0;E<x;E++){const R=a[E].search(y),I=R.length;v=I>0?new Array(I):void 0;for(let A=0;A<I;A++){const T=R[A];v[A]=T}}return v||P.EmptyArray})({colStart:l.colEnd,rowStart:l.rowEnd,colEnd:l.colEnd+1,rowEnd:l.rowEnd+1}),_=C.length;if(_>0){g={...l};for(let y=0;y<_;y++){const v=C[y];g.colEnd=Math.max(g.colEnd,v.colStart),g.rowEnd=Math.max(g.rowEnd,v.rowStart)}}}const m={...q.EmptyRange},p=()=>{const C=a.length;for(let _=0;_<C;_++){const y=a[_].search(h),v=y.length;for(let x=0;x<v;x++){const E=y[x];g=q.unionRanges(g,E,m)}}return g};h.colStart=l.colStart,h.rowStart=l.rowStart,h.colEnd=l.colEnd,h.rowEnd=l.rowEnd,p();const S={...g},w={...q.EmptyRange};let b=0;do{if(h.colStart=w.colStart=S.colStart,h.rowStart=w.rowStart=S.rowStart,h.colEnd=w.colEnd=S.colEnd,h.rowEnd=w.rowEnd=S.rowEnd,S.colStart>u.colStart&&(h.colStart=S.colStart-1,h.colEnd=S.colStart-1,h.rowStart=S.rowStart-1,h.rowEnd=S.rowEnd+1,p()),S.rowStart>u.rowStart&&(h.rowStart=S.rowStart-1,h.rowEnd=S.rowStart-1,h.colStart=S.colStart-1,h.colEnd=S.colEnd+1,p()),S.colEnd<u.colEnd&&(h.colStart=S.colEnd+1,h.colEnd=S.colEnd+1,h.rowStart=S.rowStart-1,h.rowEnd=S.rowEnd+1,p()),S.rowEnd<u.rowEnd&&(h.rowStart=S.rowEnd+1,h.rowEnd=S.rowEnd+1,h.colStart=S.colStart-1,h.colEnd=S.colEnd+1,p()),!g)return null;if(S.colStart=g.colStart,S.rowStart=g.rowStart,S.colEnd=g.colEnd,S.rowEnd=g.rowEnd,q.isEqualRanges(S,w))return q.isEqualRanges(f,S)?null:S;if(q.isEqualRanges(S,f))return null;if(q.isEqualRanges(S,w))return S;b++}while(b<c);return null})(e,[n.contentfulSpatial,n.mergeSpatial,n.formulaSpatial,n.spillSpatial,n.pendingSpatial])||i}_extendRange(e,t){if(this._closed)throw new Error(Nn);const n=this._entireCoords,r=this,o={ignoreHidden:!0,onEntry:(u,d)=>d},i={ignoreHidden:!0,onEntry:(u,d)=>u.tvTl()===void 0?null:d};let l;const a=r._getRangedEntries("mergeSpatial",[q.cellToRange(t)],i);a.length>0&&(l=a[0]);const c=[u=>r._getRangedEntries("mergeSpatial",u,i),u=>r._getRangedEntries("contentfulSpatial",u,o)];return((u,d,h,f,g)=>{let m,p,S,w={...d},b=q.cellToRange(w),C=f(b).length>0;if(C){let v=1,x=u===B.Direction.Up||u===B.Direction.Down;h&&(v+=x?h.rowEnd-h.rowStart:h.colEnd-h.colStart),u!==B.Direction.Left&&u!==B.Direction.Up||(v=-v),x?w.rowIndex=w.rowIndex+v:w.colIndex=w.colIndex+v,b=q.cellToRange(w),C=f(b).length>0}switch(u){case B.Direction.Up:b.rowStart=Math.min(g.rowStart,b.rowStart),p=f(b).sort(q.createRangeComparator(B.Orientation.Row,!0)),m=d.rowIndex,S=C?p.length===1&&m===p[0].rowStart?g.rowStart:p[0].rowStart:p.length===0?g.rowStart:p[0].rowEnd;break;case B.Direction.Down:b.rowEnd=Math.max(g.rowEnd,b.rowEnd),p=f(b).sort(q.createRangeComparator(B.Orientation.Row,!1)),m=d.rowIndex,S=C?p.length===1&&m===p[0].rowEnd?g.rowEnd:p[0].rowEnd:p.length===0?g.rowEnd:p[0].rowStart;break;case B.Direction.Left:b.colStart=Math.min(g.colStart,b.colStart),p=f(b).sort(q.createRangeComparator(B.Orientation.Column,!0)),m=d.colIndex,S=C?p.length===1&&m===p[0].colStart?g.colStart:p[0].colStart:p.length===0?g.colStart:p[0].colEnd;break;case B.Direction.Right:b.colEnd=Math.max(g.colEnd,b.colEnd),p=f(b).sort(q.createRangeComparator(B.Orientation.Column,!1)),m=d.colIndex,S=C?p.length===1&&m===p[0].colEnd?g.colEnd:p[0].colEnd:p.length===0?g.colEnd:p[0].colStart}const _=p?p.length:0;if(_>1){let v=!1;for(let x=1;!v&&x<_;x++){const E=p[x];switch(u){case B.Direction.Up:E.rowEnd<S-1?v=!0:S=Math.min(S,E.rowStart);break;case B.Direction.Down:E.rowStart>S+1?v=!0:S=Math.max(S,E.rowEnd);break;case B.Direction.Left:E.colEnd<S-1?v=!0:S=Math.min(S,E.colStart);break;case B.Direction.Right:E.colStart>S+1?v=!0:S=Math.max(S,E.colEnd)}}}const y=q.cellToRange(d);switch(u){case B.Direction.Up:y.rowStart=S;break;case B.Direction.Down:y.rowEnd=S;break;case B.Direction.Left:y.colStart=S;break;case B.Direction.Right:y.colEnd=S}return y})(e,t,l,u=>{const d=[],h=[u],f=c.length;for(let g=0;g<f;g++){const m=(0,c[g])(h),p=m.length;for(let S=0;S<p;S++){const w=m[S];d.push(w)}}return d},n)}_defaultFontDims(){if(this._defaultFontBoundsCache)return this._defaultFontBoundsCache;const e=this._styles.getNormal();let t=0,n=0;for(let r=0;r<=9;r++){const o=e.measureText(r.toString());t=Math.ceil(Math.max(o.width,t)),n=Math.max(o.lineHeight,n)}return this._defaultFontBoundsCache={width:t,height:n},this._defaultFontBoundsCache}getColumnWidthAsFontUnit(e){const t=Math.round(this._defaultFontDims().width),n=e/(this.getView().isShowFormulas()?2:1);if(!t||!e)return 0;let r=5;return n<r+t&&(r=n*(r/(r+t))),(n-r)/t}_defaultColWidth(){if(this._defaultColWidthCache)return this._defaultColWidthCache;const e=this._defaultFontDims()?.width||7,t=8*Math.round((8*e+5)/8)/Math.round(this._defaultFontDims().width);return this._defaultColWidthCache=t}_defaultRowHeight(){if(this._defaultRowHeightCache)return this._defaultRowHeightCache;let e=this._defaultFontDims();if(!e||e.width===0)return this._defaultRowHeightCache=20/Be.getDeviceScale(),this._defaultRowHeightCache;const t=this._styles.getNormal(),n=new Map;let r=e.height+2;return this._colHeaders.getUsedRange().forEachSpan((o,i)=>{const l=i.getCellHeader();l?.getStyle()!==t&&(r=Math.max((a=>{let c=n.get(a);return c===void 0&&(c=a.measureText("M").lineHeight+2,n.set(a,c)),c})(l.getStyle()),r))}),this._defaultRowHeightCache=Math.round(r/Be.getDeviceScale()*4)/4,this._defaultRowHeightCache}getProtection(){return this._protection??null}async _selectSheet(e,t){if(await this._options.container?.requestSelect?.()===!1)return!1;if(!t)return!0;t===!0&&(t=P.EmptyObject);const n=t.orientation;n===B.Orientation.Column?e={colStart:e.colStart,rowStart:void 0,colEnd:e.colEnd,rowEnd:void 0}:n===B.Orientation.Row&&(e={colStart:void 0,rowStart:e.rowStart,colEnd:void 0,rowEnd:e.rowEnd});const r={coords:e},o=await this._emitter.notify("onRequestScrollIntoView",{params:r,async:!0});if(!o)return!1;const i=o.length;for(let l=0;l<i;l++)if(o[l]===!1)return!1;return!0}async scrollTo(e,t){const n={...t,coords:e},r=await this._emitter.notify("onRequestScrollIntoView",{params:n,async:!0});if(!r)return!1;const o=r.length;for(let i=0;i<o;i++)if(r[i]===!1)return!1}_resolveSelectOptions(e,t){return e?(e===!0&&(e={autoFocus:!0,scrollIntoView:!0}),e.scrollIntoView===!0&&(e={...e,scrollIntoView:{}}),t&&(e={...e,scrollIntoView:{orientation:t,...e?.scrollIntoView}}),e):null}async _commitAndAutoSelect(e,t,n=!1,r,o){const i=this._resolveSelectOptions(n,o);return r={...r,viewAfter:{view:this.getView(),selection:t,selectOptions:i,...r?.viewAfter}},e.commit(r),this._autoSelect(n,t,o)}async _autoSelect(e,t,n){if(!e)return;const r=this._resolveSelectOptions(e,n),o=r?.autoFocus,i=r?.scrollIntoView,l=r?.anchor,a=this.getSelection(),c=a.getCoords(),u=a.getRangesCoords(t),d=this._entireCoords,h=((w,b,C)=>{if(!w||w.length===0||!b)return P.EmptyArray;const _=[...w],y=_.length,v=C.colStart,x=C.rowStart,E=C.colEnd,R=C.rowEnd;for(let I=0;I<y;I++){const A={..._[I]};let T=A;const O=b.search(A),N=A.rowStart<=x&&A.rowEnd>=R,D=A.colStart<=v&&A.colStart>=E,F=O.length;for(let k=0;k<F;k++){const L=O[k];N||(T.colStart=Math.min(T.colStart,L.colStart),T.colEnd=Math.max(T.colEnd,L.colEnd)),D||(T.rowStart=Math.min(T.rowStart,L.rowStart),T.rowEnd=Math.max(T.rowEnd,L.rowEnd))}_[I]=T}return _})(u,this._getState().mergeSpatial,d);let f=-1,g=null;if(!l){const w=c?.cell,b=h.length;for(let C=0;f===-1&&C<b;C++){const _=h[C];q.isCellWithinRange(w,_)&&(f=C,g=w)}}const m=Rt(h,g,f);this.getSelection().updateCoords(m);const p=m.ranges?.[m.rangeIndex]??q.cellToRange(m.cell),S=await this._selectSheet(p,i);if(i!==!1&&S===!1)return h;if(o!==!1){const w=await this._emitter.notify("onRequestFocus");if(!w)return h;const b=w.length;for(let C=0;C<b;C++)if(w[C]===!1)return h}return h}getSelection(){return this._rangeSelection}getView(){return this._view}setView(e){if(this._closed)throw new Error(Nn);if(!e)throw new Pe("View can not be empty.");this._viewRemoveListener?.(),this._view=e,this._viewRemoveListener=e.addListeners(this._viewListener,{transactional:!1});const t=this.getSelection().getCoords();return this._rangeSelection.updateCoords(t),this._emitter.notify("onMovableSelectionChange"),this._emitter.notify("onTopLeftChange"),this._emitter.notify("onFreezeSplitChange"),this._emitter.notify("onViewChange",{source:e}),this}getTabColor(){return this._tabColor}setTabColor(e){if(this._closed)throw new Error(Nn);return this._tabColor=typeof e=="string"?this._styles.parseColor(e):e??null,this._emitter.notify("onTabColorChange"),this}getRowHeaders(){return this._rowHeaders}getColumnHeaders(){return this._colHeaders}async toJSON(e=!1){if(this._closed)throw new Error(Nn);await this._emitter.notify("onBeforeSave",{async:!0}),await Promise.resolve(this._starting);let t={};const n=this._getState();if(!n)return t;try{const p=this._strings.beginPersist();try{if(!e){const _=[],y=this._cellStateIterator({includeRangeTypes:!1,orientation:B.Orientation.Column});let v=y.next(),x=Number.MIN_SAFE_INTEGER,E=Number.MIN_SAFE_INTEGER,R=null,I=null,A=null,T=null;for(;!v.done;){const O=v.value[0],N=O.colIndex,D=O.rowIndex;N!==x&&(T&&_.push(T),R=[],A=[],T=[N,A],x=N,E=D-2),D>E+1&&(R=[],I=[D,R],A.push(I));const F=v.value[1],k=yn(F);let L;if(k===Le.Number||k===Le.Boolean)L=F;else if(k===Le.String)L=""+p.add(F);else if(k===Le.Error)L={t:k,v:F.getCode()};else if(k===Le.RichData){const W=F,$=W.type,J=W?.toJSON?.();$&&J&&(L={t:k,v:0})}else console.warn("error",L);R.push(L),E=D,v=y.next()}T&&_.push(T),_.length>0&&(t.data=_)}this._ownStrings&&(t.strings=await p.toJSONAsync())}catch(_){console.warn("error",_)}finally{p.endPersist()}const S=this._colHeaders.toJSON();S&&(S.headers&&S.headers.length>0&&(t.cols=S.headers),S.defaultSize!==void 0&&S.defaultSize!==-1&&(t.defaultColSize=S.defaultSize));const w=this._rowHeaders.toJSON();w&&(w.headers&&w.headers.length>0&&(t.rows=w.headers),w.defaultSize!==void 0&&w.defaultSize!==-1&&(t.defaultRowSize=w.defaultSize));const b=this.getProtection().toJSON();b&&(t.protection=b),this._view.setRangeSelection(this.getSelection().getCoords());const C=this._view.toJSON();C&&(t.view=C),this._tabColor&&(t.tabColor=this._tabColor.toString())}catch(p){console.warn(p)}const r=Kr(n.mergeSpatial.all());r.length>0&&(t.merges=sh(r));const o=Kr(n.directStyleSpatial.all());if(o.length>0){const p=this._styles.beginPersist();try{const S=[],w=o.length;for(let b=0;b<w;b++){const C=o[b],_=p.getElementID(C.value.toJSON());S.push({r:ws.rangeToString(C),v:_})}if(t.directStyles=S,this._ownStyles){const b=p.toJSON();b&&Object.keys(b).length>0&&(t.styles=b)}}catch(S){console.warn(S)}finally{p.endPersist()}}const i=Kr(n.hyperlinkSpatial.all()),l=i.length;if(l>0){const p=[];for(let S=0;S<l;S++){const w=i[S];let b=w.value;p.push({r:ws.rangeToString(w),v:b})}t.hyperlinks=p}const a=Kr(n.commentsSpatial.all()),c=a.length;if(c>0){const p=[];for(let S=0;S<c;S++){const w=a[S],b={...w.value};b.ref=ws.rangeToString(w),p.push(b)}t.comments=p}const u=this._resources.beginPersist();try{const p=this.getMovables().getItems(),S=p.length;if(S>0){const w=[];for(let b=0;b<S;b++)try{const C=p[b].toJSON(u.toResourceId.bind(u));C&&w.push(C)}catch(C){console.warn("Unable to persist movable",C)}w.length>0&&(t.movables=w)}this._ownResources&&(t.resources=await u.toJSONAsync())}catch(p){console.warn(p)}finally{u.endPersist()}const d=Kr(n.tableSpatial.all()),h=d.length;if(h>0){const p=[];for(let S=0;S<h;S++){const w=d[S].value.model.toJSON();p.push(w)}t.tables=p}const f=Array.from(n.conditionalModels.values()),g=f.length;if(g>0){const p=[];for(let S=0;S<g;S++){const w=f[S].model.toJSON();p.push(w)}t.conditionals=p}const m=await n.calcGraph.toJSON(!1);if(m){const p=m.formulas;p&&(t.formulas=p);const S=m.dynamic;S&&(t.dynamicArray=S);const w=m.volatile;w&&(t.volatile=w)}return this._emitter.notify("onSave",{params:t}),t}getStyles(){return this._styles}getResources(){return this._resources}getTransactions(){return this._transactions}getStrings(){return this._strings}_searchMovables(e){const t=e?.ignoreHidden??!1,n=e?.bounds,r=e?.fullyContained,o=this,i=e?.address?this._rangeToCoords(e?.address):this._entireCoords;return this._getRangedEntries("movableSpatial",[i],{ignoreHidden:t,fullyContained:r,onEntry:l=>{if(e?.type&&l.model.getContent().getType()!==e.type)return null;let a=null;if(t&&(l.model.isHidden()||(a=o._getBoundsAtCoords(l.model.getAnchorCoords()),a.width===0||a.height===0)))return null;if(n){a||(a=o._getBoundsAtCoords(l.model.getAnchorCoords()));const c=a,u=n;if(c.y>u.y+u.height||c.y+c.height<u.y||c.x>u.x+u.width||c.x+c.width<u.x)return null}return l.model}}).sort((l,a)=>l.getZIndex()-a.getZIndex())}_updateSelectedMovables(e,t){const n=this.getView().getMovableSelection();if(!n||n.length===0)return;let r="Movables";if(n.length===1){const i=n[0];r=_s(i.getContent().getType())??"Drawing"}const o=this._beginCommit({description:`${t} ${r}`});try{const i=n.length;for(let l=0;l<i;l++)e(n[l]);o.commit()}catch(i){throw o.rollback(),i}}async _addMovable(e){if(!this.getProtection().isObjectsAllowed())throw new Pe(vf);if(!e)throw new Pe("No movable options provided");if(this._closed)throw new Error(Nn);const t={};e?.type&&(t.content={type:e.type,json:e?.json}),e?.anchorType&&(t.anchorType=e?.anchorType),e.bounds&&(t.anchor=null);const n=this._getState().movableSpatial,r=this._beginCommit({description:e?.description??"Insert Drawing"}),o=this._createMovableEntry(t,n.size(),e.fromResourceId),i=n.clone();i.insert(o);const l=this._getState().movableMapModel,a=new Map(l),c=o.value.model;a.set(c,o),this._updateState({movableSpatial:i,movableMapModel:a}),e.bounds&&o.value.model.setBounds(e.bounds,e);let u=null,d=null;if(e?.autoSelect!==!1){u={view:this.getView(),movableSelection:this.getView().getMovableSelection()};let h=e?.autoSelect??!1;h===!0&&(h={autoFocus:!0,scrollIntoView:!0,addToSelection:!1}),h&&this.getView().selectMovables([o.value.model],h.addToSelection),d=f=>({...f,view:this.getView(),movableSelection:this.getView().getMovableSelection()})}return r.commit({viewBefore:u,viewAfter:d}),this._emitterMovables.notify("onCollectionChange"),this._emitter.notify("onMovablesChange"),o.value.model}async _addImage(e,t={type:"picture"}){if(!e)throw new Pe("An image must be provided as a string or a resource option.");if(!this.getProtection().isObjectsAllowed())throw new Pe(vf);const n=this._resources.add(e),r=await n.toBuffer(),o=await n.getType(),i=this._getBoundsAtCoords(this.getSelection().getRangesCoords()[0]),{naturalSize:l,asUrl:a}=await $l.loadImageDetails(r,o);URL.revokeObjectURL(a);const c={...i,...l,...t?.bounds};if(P.isNullOrUndefined(t?.bounds?.x)||P.isNullOrUndefined(t?.bounds?.y)){const d=xm(this.getMovables(),c,P.isNullOrUndefined(t?.bounds?.x),P.isNullOrUndefined(t?.bounds?.y));c.x+=d.x,c.y+=d.y}t?.bounds&&t?.json?.lockAspect!==!1&&(P.isNullOrUndefined(t?.bounds.width)&&P.isDefined(t?.bounds.height)&&(c.width=c.height*l.width/l.height),P.isNullOrUndefined(t?.bounds.height)&&P.isDefined(t?.bounds.width)&&(c.height=c.width*l.height/l.width));const u={...t?.json,resId:0};return await this._addMovable({anchorType:Xt.Type.OneCell,description:"Insert Image",...t,bounds:c,type:"picture",json:u,fromResourceId:d=>d!==0?(console.warn("received an unexpected resourceId",d),null):n})}getTables(){return this._tables}getConditionals(){return this._conditionals}getMovables(){return this._movables}_doPerfTest(e=1e7,t=!1){const n=Array.from({length:e},(a,c)=>c);let r,o;r=performance.now(),t&&console.profile("nativeArray");const i=[e];for(let a=0;a<e;a++)i.push(a);t&&console.profileEnd("nativeArray"),window.noLoseArray=i,o=performance.now(),console.log(`NativeArray: ${e} records in ${o-r} milliseconds`),r=performance.now(),t&&console.profile("mixedType");const l=K1.fromArray(n);t&&console.profileEnd("mixedType"),window.noLoseList=l,o=performance.now(),console.log(`MixedTypedList: ${e} records in ${o-r} milliseconds`)}_validateOrRemoveOverlaps(e,t,n=null,r=!1){const o=this;t!=="merge"&&df(this._getMerges([e]),e,(c,u)=>{if(u||!r)throw new Pe(xf(t));o._unmerge([c])});const i=[],l=this.getTables().getItems({address:e}),a=l.length;for(let c=0;c<a;c++){const u=l[c];n!==u&&i.push(u.getAnchorCoords())}df(i,e,(c,u,d)=>{if(u||!r)throw new Pe(xf(t));l[d].delete()})}_addTable(e,t){let n=this._rangeToCoords(e,()=>["objects"]);const r=this._entireCoords;let o=t?.hasHeader;if(n.rowStart===n.rowEnd){if(n.rowEnd===r.rowEnd)throw new Pe("A table must have a least two rows; one for the table header and one for data.");n.rowEnd=n.rowEnd+1}o===void 0&&(o=Xf(this,n)?.options?.hasHeader??!1);const i=Rt([n]),l={...n},a=this._beginCommit({description:"Insert Table"});let c=null;try{o||(this._isContentful([n])&&this._insertCells([{...n,rowStart:n.rowStart,rowEnd:n.rowStart}],B.Orientation.Row),n={...n,rowEnd:n.rowEnd+1});const u={...t?.json,ref:n};this._validateOrRemoveOverlaps(n,"table",null,!0),u.styleOptions=t?.json?.styleOptions??{},u.styleOptions.name===void 0&&(t?.styleName?u.styleOptions.name=t.styleName:t?.styleName===void 0&&(u.styleOptions.name=this._styles.getDefaultTableStyle().getName()));const d=t?.isLoad;d!==!0&&(u.filter===void 0&&(u.filter={}),u.sort===void 0&&(u.sort={}));const h=this._createTableEntry(u,o&&!d),f=this._getState(),g=f.tableSpatial.clone();g.insert(h);const m=f.tableMapModel,p=new Map(m),S=h.value.model;p.set(S,h);const w=f.tableMapName,b=new Map(w);b.set(S.getName().toLocaleLowerCase(),S),t?.clearFormatting&&this.getRange(n).getStyle().update(null),c=h.value.model,this._updateState({tableSpatial:g,tableMapModel:p,tableMapName:b}),this._emitter.notify("onTablesChange"),d||this._autoFit([c.getHeaderRange().getCoords()],{expandOnly:!0});const C=Rt([n]);a.commit({viewBefore:{view:this.getView(),selection:i,ranges:[l]},viewAfter:{view:this.getView(),selection:C,ranges:[n]}})}catch(u){throw a.rollback(),u}return c}_addConditional(e,t){const n=this._rangesToCoords(e,()=>["objects"]),r=t?.autoSelect?Rt(n):null,o=[...n],i=this._beginCommit({description:t?.description??"Insert Conditional"});let l=null;try{const a={...t,ref:o},c=this._getState(),u=c.conditionalSpatial.clone(),d=new Map(c.conditionalModels),h=this._createConditionalEntries(a,u,d);this._updateState({conditionalSpatial:u,conditionalModels:d}),l=h,i.commit({viewBefore:{view:this.getView(),selection:r,ranges:o},viewAfter:{view:this.getView(),selection:r,ranges:o}}),this._autoSelect(t?.autoSelect,r)}catch(a){throw i.rollback(),a}return l}createTemporaryCell(e,t=null){return e?.createTemporaryCell?e:(t?this.getRange(t).getCell():this._emptyCell).createTemporaryCell(e)}_getBoundsAtCoords(e){const t=this._rowHeaders,n=this._colHeaders,r=n.findOffset(e.colStart),o=t.findOffset(e.rowStart);return{x:r,y:o,width:n.findOffset(e.colEnd+1)-r,height:t.findOffset(e.rowEnd+1)-o}}_getCoordsAtBounds(e){const t=this._rowHeaders,n=this._colHeaders;return{colStart:n.findIndex(e.x),rowStart:t.findIndex(e.y),colEnd:n.findIndex(e.x+e.width),rowEnd:t.findIndex(e.y+e.height)}}getRangeAtBounds(e,t){if(!e)throw new lr;const n=this._getCoordsAtBounds(e);return this.getRange(n,t)}_getVisible(e,t){if(e.length===0)return e;const n=new yt;n.load(e);const r=t?.orientations??B.Orientations.Both,o=(l,a)=>{const c=n.search(l),u=c.length;for(let d=0;d<u;d++){const h=c[d],f=gd(h,l,a);n.remove(h),n.load(f)}},i=this._cellOptions.maxCoords;if(r===B.Orientations.Both||r===B.Orientations.Row){const l=this._rowHeaders,a=e.length;for(let c=0;c<a;c++){const u=e[c];l.getRange({min:u.rowStart,max:u.rowEnd}).forEachSpan((d,h)=>{if(d!==0)return;const f=h.getCoords();o({colStart:i.colStart,rowStart:f.min,colEnd:i.colEnd,rowEnd:f.max},B.Orientation.Row)})}}if(r===B.Orientations.Both||r===B.Orientations.Column){const l=this._colHeaders,a=e.length;for(let c=0;c<a;c++){const u=e[c];l.getRange({min:u.colStart,max:u.colEnd}).forEachSpan((d,h)=>{if(d!==0)return;const f=h.getCoords();o({colStart:f.min,rowStart:i.rowStart,colEnd:f.max,rowEnd:i.rowEnd},B.Orientation.Column)})}}return n.all()}_hasRangedEntries(e,t){const n=this._getState();if(!n)return P.EmptyArray;const r=n[e];if(!r)throw new Pe(`Invalid range key ${e}`);return!(!r||r.isEmpty())&&r.has(t)}_getRangedEntries(e,t,n){if(t.length===0)return P.EmptyArray;const r=n?.ignoreHidden??!1,o=n?.fullyContained??!1,i=n?.onEntry??null,l=this._getState();if(!l)return P.EmptyArray;const a=l[e];if(!a)throw new Pe(`Invalid range key ${e}`);if(!a||a.isEmpty())return P.EmptyArray;const c=new Set,u=p=>{const S=p.length;for(let w=0;w<S;w++){const b=p[w];c.add(b)}},d=t.length;for(let p=0;p<d;p++){const S=t[p];if(r){if(r===!0){const w={min:S.colStart,max:S.colEnd},b={min:S.rowStart,max:S.rowEnd};this._rowHeaders.getRange(b).forEachVisibleSpan((C,_)=>{this._colHeaders.getRange(w).forEachVisibleSpan((y,v)=>{u(a.search({colStart:y,rowStart:C,colEnd:v,rowEnd:_},o))},Nl)},Nl)}else if(r===B.Orientation.Column){const w={min:S.colStart,max:S.colEnd};this._colHeaders.getRange(w).forEachVisibleSpan((b,C)=>{u(a.search({colStart:b,rowStart:S.rowStart,colEnd:C,rowEnd:S.rowEnd},o))},Nl)}else if(r===B.Orientation.Row){const w={min:S.rowStart,max:S.rowEnd};this._rowHeaders.getRange(w).forEachVisibleSpan((b,C)=>{u(a.search({colStart:S.colStart,rowStart:b,colEnd:S.colEnd,rowEnd:C},o))},Nl)}}else u(a.search(S,o))}if(c.size===0)return P.EmptyArray;const h=Array.from(c.values()),f=n?.sort;f&&h.sort(q.createRangeComparator(f.orientation,f.reverse));let g=[];const m=h.length;for(let p=0;p<m;p++){let S;S=void 0,i&&(S=i(h[p].value,h[p])),S===void 0&&(S=h[p].value),S!==null&&g.push(S)}return g||(g=P.EmptyArray),g}_processAnchorShift(e){let t=e.after;const n=q.sanitizeRange(e.after),r=q.sanitizeRange(e.before);e.after&&this._validateCoords(n,"We can't insert cells because this would push items off the end of the worksheet.");const o=e.before.value.processShiftCallback?.({...e,after:n,before:r});return o&&(bi(o,n)||(t||(t=e.before),t={...t,...o})),t}_processListenerShift(e,t,n,r){if(r.isSplit||r.before.value.options.ignoreShifts)return[r.before];let o=null;r.after&&(o=q.intersectRanges(q.sanitizeRange(r.after),this._entireCoords),r.after,o.colStart,o.rowStart,o.colEnd,o.rowEnd);const i=r.before.value,l=i.id,a=e.get(l),c={...a},u=[...a.ranges];c.ranges=u,u[i.offset]=o?{...u[i.offset],...o}:null,e.set(l,c);const d=n.get(l);t.set(l,{beforeState:d,afterState:c})}delete(){if(this._closed)return;try{this._emitter.notify("onBeforeDelete")}catch(i){throw i instanceof Error?i:new Pe(i.message??"Unable to delete.")}const e=this._beginCommit({description:`Delete Sheet '${this.getName()}'`}),t=this._getState();let n=t.rangeListenerSpatial,r=t.rangesListenerMap;const o=new Map;n=n.shift({range:this._entireCoords,direction:B.Direction.Left,cloneIfUpdate:n===t.rangeListenerSpatial,onShift:i=>{r===t.rangesListenerMap&&(r=new Map(r)),this._processListenerShift(r,o,t.rangesListenerMap,i)}}),this._updateState({rangeListenerSpatial:n,rangesListenerMap:r,deleted:!0}),this._deleteCells([this._entireCoords]),this._emitter.notify("onDelete"),this._rangesListenerMap.forEach((i,l)=>{o.set(l,{beforeState:i,afterState:null})}),e.commit({viewAfter:i=>({...i,view:this.getView(),selection:this.getSelection().getCoords(),listeners:o})})}doBatch(e,t){const n=this;return t=typeof t=="string"?{description:t}:{description:"Update Sheet",...t},this._transactions.doBatch(e,t,(r,o)=>{if(r.getDepth()===0&&(n._lastTransactionUUID=r.getId(),t?.autoSelect)){const i=r.getView()?.selection;i&&n._autoSelect(!0,i)}})}isClosed(){return this._closed}close(){if(this._closed)return;this._protectionRemoveListener?.(),this._protection=new Dm(void 0,this._options.readonly);const e=this._getState().tableMapModel.keys();for(const t of e)t.close();this._searchMovables().forEach(t=>{t.close()}),this._emitter.notify("onClose"),this._ownResources,this._namesRemoveListener?.(),this._ownNames&&this._names.close(),this._ownsCalculation&&this._calculation.close(),this._ownStyles,this._colHeaders.close(),this._rowHeaders.close(),this._emitter.close(),this._transactionsRemoveListener?.(),this._closed=!0}beginCommit(e){if(this._closed)throw new Error(Nn);return this._beginCommit(typeof e=="string"?{description:e}:e)}_getState(){return this._closed?null:this._transactions.getState(this)}_beginCommit(e){const t=this;return this._transactions.beginCommit(e,n=>{n.getDepth()===0&&(t._lastTransactionUUID=n.getId())})}_updateState(e){if(!e)return;this._lastGetRangeRead=null;const t=this._transactions.beginCommit();let n;try{n=t.updateState(this,e),t.commit()}catch(r){throw t.rollback(),r}return n}_addEvent(e,t){const n=this.getTransactions().getPendingView();if(!n)return;let r=n.events;if(r||(r={},n.events=r),e==="address"){let o=r.address;if(o||(o=new Map,r.address=o),typeof t=="string")o.set(t,null);else{const i=t;if(i.options.ignoreAddressChanges)return;o.set(i.uuid,t)}}else if(e==="data")if(typeof t=="string"){let o=r.dataListeners;o||(o=new Map,r.dataListeners=o),o.set(t,null)}else{let o=r.data;o||(o=[],r.data=o),o.push(t)}}_getScalar(e,t,n=!1){const r=this._getState();let o;if(o===void 0&&(o=r.cellValuesGrid.getValueAt(e,t)),o===void 0)return null;let i=o;if(n&&typeof i=="number"){let l=!1;rr.colStart=t,rr.rowStart=e,rr.colEnd=t,rr.rowEnd=e;const a=this._lastValueRead,c=this._lastValueRead.range;if(c&&q.isRangeWithinRange(rr,c))l=a.isDateOrTime;else{const u=r.directStyleSpatial.search(rr)[0];if(u){const d=u.value.getPropertiesAt(e,t,i),h=d?.numberFormat;h&&(l=Vi(h)||Ja(h)),a.range=u,a.isDateOrTime=l}else a.range=null;l&&(i=Ms(i,this._isDate1904))}}return i}_getStyle(e,t){let n;if(t)n={colStart:t.cell.colIndex,rowStart:t.cell.rowIndex,colEnd:t.cell.colIndex,rowEnd:t.cell.rowIndex};else{const a=e[0];n={colStart:a.colStart,rowStart:a.rowStart,colEnd:a.colStart,rowEnd:a.rowStart}}const r=this;let o=this._cellOptions;o={...o,styleUpdater:(a,c)=>(r._updateStyles(e,a,c),r._getStyle(e,t))},Vm.length=0;const i=Vm;this._collectRanges(n,i);const l=Kf(i);return ls(0,n,l,o)}_initState(){const e=this,t=()=>{e._lastCellDecoded.address=null,e._lastCellSelected.coords=null,e._lastCellRead.coords=null,e._lastValueRead.range=null,e._lastGetRangeRead={},e._lastUsedCoordsRead.coords=null,e._lastActiveRead.selection=null,e._lastRangeRead.address=null};this._transactionsRemoveListener=this._transactions.addStateListener(this,{onBeforeCommitStart(g,m,p){if(!e._initializing&&!m?.skipProtectionCheck&&e.getProtection().isLocked())throw new Pe(Sl)},async onBeforeCommitEnd(g,m,p){if(m?.ranges){const S={isDataChange:!0,isTransactional:!0,timeStamp:p.getTimestamp(),trigger:"setCells"},w=g.rangeListenerSpatial,b=g.rangesListenerMap;e._notifyRangeListeners(w,b,m.ranges,S)}if(m?.listeners){const S={isDataChange:!1,isTransactional:!0,timeStamp:p.getTimestamp(),trigger:"shiftCells"},w=g.rangeListenerSpatial,b=g.rangesListenerMap;e._notifyRangeListeners(w,b,m.ranges,S)}},async onRestoreOrRevert(g,m,p,S){if(t(),e._calculateFull(),m&&(m.view===e.getView()&&m.selection&&e._autoSelect(m.selectOptions??!0,m.selection),m.movableSelection&&e.getView().selectMovables(m.movableSelection)),e._emitter.notify("onInvalidated"),e._emitterMovables.notify("onInvalidated"),e._notifyUsedRangeChange(),e._rangesListenerMap.size>0){const w={isDataChange:!0,isTransactional:!1,timeStamp:p.getTimestamp(),isUndo:S,trigger:"invalidate"},b=g.rangeListenerSpatial,C=g.rangesListenerMap,_=new Set;C.forEach((y,v)=>{const x=y.id;if(_.has(x))return;const E=y.ranges;E&&(_.add(x),e._notifyRangeListeners(b,C,E,w))})}},async onAfterStateChange(g,m,p,S,w){t(),m&&p.getId()!==e._lastTransactionUUID&&m.view===e.getView()&&m.selection&&(S||w)&&e._autoSelect(m.selectOptions??!0,m.selection),e._lastTransactionUUID=p.getId(),m?.merges&&e._notifyMergeChange();const b=e._rangesListenerSorted;if(b.size>0){e._notifyUsedRangeChange();const C=new Set,_=g.rangesListenerMap2,y={isTransactional:!1,timeStamp:p.getTimestamp()};if((w||S)&&(y.trigger="restore",e._notifyAddressListeners(_,_,C,y),b.size>_.size)){const x=b.values();let E=x.next(),R=!1;for(;!R&&!E.done;){const I=E.value;R=_.has(I.uuid),R||(I.notify(y,"#N/A"),E=x.next())}}const v=m?.events;v&&(v.address&&(y.trigger="address",e._notifyAddressListeners(_,v.address,C,y)),v.dataListeners&&(y.trigger="data",e._notifyAddressListeners(_,v.dataListeners,C,y)),v.data&&(y.trigger="data",e._notifyDataListeners(g.rangesListenerSpatial2,g.rangesListenerMap2,v.data,C,y)))}if(m&&!m.initial&&(!m.calculationSideEffect&&m.ranges&&g.calcGraph.calculate(),m.ranges)){e._notifyUsedRangeChange();const C=e._rangesListenerMap;if(C.size>0){const _={isDataChange:!0,isTransactional:!1,timeStamp:p.getTimestamp(),isUndo:S,trigger:"setCells"};e._notifyRangeListeners(e._rangeListenerSpatial,C,m.ranges,_)}}},onClose(){const g=e._getState();g&&g.movableSpatial.clear()}});const n=new tx({sheet:this}),r={onChange(){e._emitter.notify("onSelectionChange")}},o=n.addListeners(r,{transactional:!1});this._rangeSelection=n,this._rangeSelectionRemoveListener=o;const i=g=>{const m=e._getState();if(!m)return;const p=m.movableSpatial,S=g.length;for(let w=0;w<S;w++){const b=p.search(g[w]),C=b.length;for(let _=0;_<C;_++)b[_].value.processLayoutCallback?.()}e._emitter.notify("onLayoutChange")};this._colHeadersListener={onSizesChange:(g,m)=>{const p=[];if(m){const S=m.length;for(let w=0;m&&w<S;w++){const b={colStart:m[w].min,rowStart:e._entireCoords.rowStart,colEnd:e._entireCoords.colEnd,rowEnd:e._entireCoords.rowEnd};p.push(b)}}i(p)}},this._rowHeadersListener={onSizesChange:(g,m)=>{const p=[];if(m){const S=m.length;for(let w=0;w<S;w++){const b=m[w],C={colStart:e._entireCoords.colStart,rowStart:b.min,colEnd:e._entireCoords.colEnd,rowEnd:e._entireCoords.rowEnd};p.push(C)}}i(p)}};let l=new Set;const a={onTopLeftChange(){e._emitter.notify("onTopLeftChange")},onFreezeSplitChange(){e._emitter.notify("onFreezeSplitChange")},onRangeSelectionChange(){const g=e.getSelection().getCoords();e._rangeSelection.updateCoords(g)},onMovableSelectionChange(g){const m=g.getMovableSelection(),p=new Map,S=new Set,w=e._getState().movableMapModel,b=m.length;for(let C=0;C<b;C++){const _=m[C];l.has(_)?l.delete(_):p.set(_,C),S.add(_)}l.forEach(C=>{w.get(C)?.value.processSelectionCallback(!1,!1)}),p.forEach((C,_)=>{w.get(_)?.value.processSelectionCallback(!0,C===0)}),l=S,e._emitter.notify("onMovableSelectionChange")},onAnyChange(){e._defaultColWidthCache=0,e._defaultRowHeightCache=0,e._defaultFontBoundsCache=null,e._emitter.notify("onLayoutChange"),e._emitter.notify("onViewChange")}},c=new Ou({sheet:this});this._view=c,this._clearState(),this._viewRemoveListener=c.addListeners(a,{transactional:!1}),this._viewListener=a,this._colHeadersRemoveListener?.(),this._colHeaders=new Tm({sheet:e,orientation:B.Orientation.Column,transactions:this._transactions,isProtected:()=>!e._initializing&&!e.getProtection().isFormatColumnsAllowed(),getTextAt:g=>{const m=this.getView().getColumnHeaderStyle();return m===dn.HeaderTextStyle.A1?Bm(g):m===dn.HeaderTextStyle.Zero?Lm(g):m===dn.HeaderTextStyle.One?zm(g):void 0},defaultSize:()=>this._defaultColWidth(),scaleFactor:()=>{const g=this.getView().isShowFormulas()?2:1;return Math.round(this._defaultFontDims().width)*g},maxSize:()=>255,maxSheetCoords:()=>e._entireCoords,setContainerShiftedCallback:g=>{this._colHeadersShiftCallback=g}}),this._colHeadersRemoveListener=this._colHeaders.addListeners(this._colHeadersListener,{transactional:!0}),this._rowHeadersRemoveListener?.();const u=Be.getDeviceScale();this._rowHeaders=new Tm({sheet:e,orientation:B.Orientation.Row,transactions:this._transactions,isProtected:()=>!e._initializing&&!e.getProtection().isFormatRowsAllowed(),getTextAt:g=>{const m=this.getView().getRowHeaderStyle();return m===dn.HeaderTextStyle.One?zm(g):m===dn.HeaderTextStyle.Zero?Lm(g):m===dn.HeaderTextStyle.A1?Bm(g):void 0},defaultSize:()=>this._defaultRowHeight(),scaleFactor:()=>u,minSize:()=>0,maxSize:()=>409,maxSheetCoords:()=>e._entireCoords,setContainerShiftedCallback:g=>{this._rowHeadersShiftCallback=g}}),this._rowHeadersRemoveListener=this._rowHeaders.addListeners(this._rowHeadersListener,{transactional:!0}),this._defaultFontBoundsCache=null,this._defaultColWidthCache=0,this._defaultRowHeightCache=0;const d={colStart:0,rowStart:0,colEnd:0,rowEnd:0},h=[d],f={ignoreHidden:!0,sort:{orientation:B.Orientation.Column,reverse:!1}};this._cellOptions={resolveRange:g=>{if(g===null)return this._createRange(null,void 0,"temporary cell");const m=this._rangesToCoords(g);return this._createRange(m[0],null)},date1904:this._isDate1904,sheet:this,normalStyleRanged:this._normalStyleRanged,colHeaders:this._colHeaders,styles:this._styles,maxCoords:this._entireCoords,getRange:this.getRange.bind(this),getProtection:this.getProtection.bind(this),calcGraph:()=>this._getState().calcGraph,nextContentful:(g,m,p=!1)=>{d.colStart=p?m:g.colIndex+1,d.rowStart=g.rowIndex,d.colEnd=p?g.colIndex-1:m,d.rowEnd=g.rowIndex,f.sort.reverse=p;const S=e._getRangedEntries("contentfulSpatial",h,f);if(!S||S.length===0)return m;const w=S[0],b=p?w.getState().colStart:w.getState().colEnd;return p?Math.min(b+1,g.colIndex):Math.max(b-1,g.colIndex)},styleUpdater:(g,m,p)=>{const S=[p];return e._updateStyles(S,g,m),e._getStyle(S)},opener:async(g,m,p,S)=>{if(g.startsWith("#")){g=g.substring(1);const w=this._rangesToCoords(g);return await this._autoSelect(m??!0,Rt(w)),!0}return window.open(g,p??"_blank",S),!0}},this._emptyCell=new tv(this._cellOptions)}_clearState(){this._lastGetRangeRead=null,this._lastCellDecoded.address=null,this._lastCellSelected.coords=null,this._lastCellRead.coords=null,this._protectionRemoveListener?.(),this._protection=new Dm(void 0,this._options.readonly),this._protectionRemoveListener=this._protection.addListeners({onChange(){if(e._closed)throw new Error(Nn);e._getState().movableMapModel.forEach(l=>{l.value.processProtectionCallback?.()}),e._getState().tableMapModel.forEach(l=>{l.value.processProtectionCallback?.()}),e._emitter.notify("onProtectionChange")}}),this._stylesRemoveListener?.();const e=this;this._stylesRemoveListener=this._styles.addListeners({onAnyChange(){e._defaultColWidthCache=0,e._defaultRowHeightCache=0,e._defaultFontBoundsCache=null,e._emitter.notify("onLayoutChange"),e._emitter.notify("onStyleChange");const l=e._entireCoords;e._autoFit([l],{orientations:B.Orientations.Both,skipCustomSize:!0})}}),this._view.clear(!1),this._rangeListenerSpatial=new yt,this._rangesListenerMap=new Map,this._rangesListenerSorted=new ft;const t=l=>{const a=e._getState().rangesListenerSpatial2;if(a.isEmpty())return;const c=l.length;for(let u=0;u<c;u++){const d=l[u],h=a.search(d),f=h.length;for(let g=0;g<f;g++){const m=h[g].value.groupId;e._addEvent("data",m)}}},n=this._entireCoords,r=n.rowEnd,o=n.colEnd,i=this._calculation._createGraph({onCalculated(l){e._realizeCalcedValues(l)},getEntireCoords:()=>e._entireCoords,getSheetName:()=>e.getName()});i.addListeners({onStart(l){},onInvalidate:()=>{}}),this._updateState({rangesListenerSpatial2:new yt({updateEntryOptions:{onShifted:l=>{let a=e._getState().rangesListenerMap2;if(a.size===0)return;a=new Map(a);const c=l.length;for(let u=0;u<c;u++){const d=l[u],h=d.value.groupId;let f=a.get(h);f=f.processShift(d),e._addEvent("address",f),a.set(h,f)}e._updateState({rangesListenerMap2:a})},onRemoved:l=>{let a=e._getState().rangesListenerMap2;if(a.size===0)return;a=new Map(a);const c=l.length;for(let u=0;u<c;u++){const d=l[u],h=d.value.groupId;let f=a.get(h);f=f.processRemove(d),e._addEvent("address",f),a.set(h,f)}e._updateState({rangesListenerMap2:a})}}}),rangesListenerMap2:new Map,cellValuesGrid:new Io({orientation:this._isDataColumn?B.Orientation.Column:B.Orientation.Row}),formulaSpatial:new yt,spillSpatial:new yt,pendingSpatial:new yt,calcErrorsSpatial:new yt,calcGraph:i,directStyleSpatial:new yt({updateEntryOptions:{isMergeOnShift:!0,isTrailingEdge:!0,onUpdated:t,onRemoved:t}}),continuousFillSpatial:new yt({updateEntryOptions:{isMergeOnShift:!0,isTrailingEdge:!0}}),conditionalModels:new Map,conditionalSpatial:new yt({updateEntryOptions:{onGroupUpdate(l,a){let c=e._getState().conditionalModels,u=c.get(a);if(!u)return;c=new Map(c);const d=u.spatials;u={...u},u.spatials=l,c.set(a,u),e._updateState({conditionalModels:c}),u.processCoordsChange({before:d,after:u.spatials})}}}),mergeSpatial:new yt({updateEntryOptions:{getShifted:(l,a)=>a?(a.value=new km(q.sanitizeRange(a),l.value._tvTl),a):null,getSplit(l,a){throw new Pe("We can't insert through merges. Unmerge and try again.")},onUpdated:t,onRemoved:t}}),movableMapModel:new Map,movableSpatial:new yt({updateEntryOptions:{getShifted(l,a,c){const u=l.value.processShiftCallback?.(c);let d=null;const h=new Map(e._getState().movableMapModel),f=l.value.model;return u?(d={...u,value:{...l.value}},h.set(f,d)):h.delete(f),e._updateState({movableMapModel:h}),d}}}),hyperlinkSpatial:new yt({updateEntryOptions:{isSplitOnExpand:!0,isMergeOnShift:!0}}),commentsSpatial:new yt({updateEntryOptions:{isSplitOnExpand:!0,isMergeOnShift:!0,onUpdated:t,onRemoved:t}}),tableMapModel:new Map,tableMapName:new Map,tableSpatial:new yt({updateEntryOptions:{getShifted(l,a,c){const u=new Map(e._getState().tableMapModel),d=l.value.model,h=l.value.processShiftCallback?.(c);let f=null;return h?(f={...h,value:{...a.value}},u.set(d,f)):u.delete(d),e._updateState({tableMapModel:u}),f}}}),filter:null,sort:null,rangeListenerSpatial:new yt,rangesListenerMap:new Map,contentfulSpatial:new yt({updateEntryOptions:{isSplitOnExpand:!0,isMergeOnShift:!0,onShifted:l=>{const a=e._getState().rangesListenerSpatial2;if(a.size()===0)return;const c=l.length;for(let u=0;u<c;u++){const d=l[u],h=a.search({colStart:d.colStart,rowStart:d.rowStart,colEnd:o,rowEnd:r}),f=h.length;for(let g=0;g<f;g++){const m=h[g].value.groupId;e._addEvent("data",m)}}},onRemoved:t,onUpdated:t}}),unlockSpatial:new yt({updateEntryOptions:{isMergeOnShift:!0}}),deleted:!1}),this._defaultFontBoundsCache=null,this._defaultColWidthCache=null,this._defaultRowHeightCache=null}_createTableEntry(e,t=!1){const n={model:null,processShiftCallback:null,processDeleteCallback:null,processProtectionCallback:null,currentName:null,removeListener:null};let r=null;r=typeof e.ref=="string"?Jn(e.ref,this._entireCoords):e.ref;const o={...r,value:n},i=this,l=()=>n.model?i._getState().tableMapModel?.get(n.model):o,a=(d,h)=>!(!q.isEqualRanges(d,h)||d.value.model!==h.value.model),c={transactions:this._transactions,sheet:this,names:this._names,readSheetHeader:t,json:e,maxRangeCoords:this._entireCoords,setNameOnContainer(d){const h=l().value;if(!h.currentName||h.currentName.toLowerCase()===d.toLowerCase())return;const f="Set Table Name";i._protectionCheck(()=>["objects"],void 0,f);const g=i._beginCommit({description:f});try{const m=i._getState()?.tableMapName,p=d.toLocaleLowerCase();if(m.has(p))throw new Pe((w=>`Name must be unique: '${w}' is already in use.`)(d));const S=new Map(m);S.delete(h.currentName),h.currentName=p,S.set(p,h.model),i._updateState({tableMapName:S}),g.commit()}catch(m){throw g.rollback(),m}},setContainerCoords(d,h){if(!d)return;const f=i._rangeToCoords(d,()=>["objects"]),g=l();if(!g)return;const m=g.value.model;i._validateOrRemoveOverlaps(f,"table",m);const p=i._beginCommit({description:h?.description??"Resize Table"}),S=i._getState(),w=S.tableSpatial.clone(),b=S.tableMapModel,C=new Map(b);w.remove(g,a);const _={...g,...f};return w.insert(_),C.set(_.value.model,_),i._updateState({tableSpatial:w,tableMapModel:C}),p.commit({viewAfter:{view:i.getView(),selection:Rt([u.getAnchorCoords()])}}),f},deleteFromContainer(d){const h=l();if(!h)return;const f=h.value.model,g=d?.description??`Delete Table '${f.getName()}`;i._protectionCheck(()=>["objects"],void 0,g);const m=i._beginCommit({description:g}),p=i._getState(),S=p.tableSpatial.clone(),w=p.tableMapModel,b=new Map(w),C=p.tableMapName,_=new Map(C);S.remove(h,a),b.delete(f),_.delete(f.getName().toLocaleLowerCase()),h.value.processDeleteCallback?.(),i._updateState({tableSpatial:S,tableMapModel:b,tableMapName:_}),i._emitter.notify("onTablesChange"),i._emitter.notify("onLayoutChange"),m.commit({viewAfter:{sheet:i,view:i.getView(),selection:Rt([f.getAnchorCoords()])}})},setContainerDeleteCallback(d){const h=l()?.value??n;h&&(h.processDeleteCallback=d,h.removeListener?.())},isProtected:()=>!i._initializing&&i.getProtection().isLocked(),setContainerProtectionCallback(d){(l()?.value??n).processProtectionCallback=d},setContainerShiftCallback(d){(l()?.value??n).processShiftCallback=d},processTableUpdate(){i._notifyUsedRangeChange()},initialAnchor:r},u=new dv(c);return o.value.model=u,o.value.removeListener=u.addListeners({onStyleChange(d){i._emitter.notify("onStyleChange")},onDelete(d){i._emitter.notify("onStyleChange")}},{transactional:!1}),o.value.currentName=u.getName().toLocaleLowerCase(),o}_createConditionalEntries(e,t,n){const r="Conditional Format",o=()=>["objects"],i=e??{};let l=null;const a=this._entireCoords;if(typeof i.ref=="string"){l=[];const S=i.ref.split(","),w=S.length;for(let b=0;b<w;b++){const C=Jn(S[b],a);C&&l.push(C)}}else l=Array.isArray(i.ref)?i.ref:[i.ref];const c=this,u=P.uuidV4(),d={model:null,removeListener:null,processCoordsChange:null,spatials:null};n.set(u,d);const h=()=>d.model?c._getState().conditionalModels.get(u):d;let f=S=>(console.log("default createSpatialEntry",S),null);const g=(S,w,b)=>{if(!d.model)return void(l=S);let C=w.spatials;if(C){const y=C.length;for(let v=0;v<y;v++)b.remove(C[v])}let _=[];if(S){const y=S.length;for(let v=0;v<y;v++){const x=S[v];_.push({...x,value:f(x)})}_.length>0&&b.insertGroup(_,u)}w.spatials=_},m=()=>{const S=h().spatials??l;return S?c.getRanges(S):null};var p;return d.model=(p={sheet:c,transactions:c._transactions,json:e,type:"conditional",setOnContainerCoordsChange:S=>{h().processCoordsChange=S},setCreateSpatial(S){f=S},setContainerRanges:(S,w)=>{const b=c._rangesToCoords(S,o);if(!d.model)return l=b,b&&b.length>0?c.getRanges(b):null;const C=c._beginCommit({description:w?.description??`Set ${r} Ranges`});let _=Rt(b);try{const y=c._getState();let v=y.conditionalSpatial;v=v.clone();let x=y.conditionalModels;x=new Map(x);let E=h();E={...E},x.set(u,E),g(b,E,v),c._updateState({conditionalSpatial:v,conditionalModels:x}),C.commit({viewBefore:{view:c.getView(),selection:Rt(m()?.getCoords())},viewAfter:{view:c.getView(),selection:_}}),c._autoSelect(w?.autoSelect,_)}catch(y){throw C.rollback(),y}return b&&b.length>0?c.getRanges(b):null},getContainerRanges:m,deleteFromContainer(S){let w=h();const b=c._beginCommit({description:S?.description??`Set ${r} Ranges`}),C=S?.autoSelect?Rt(w.spatials):void 0;try{const _=c._getState();let y=_.conditionalSpatial;y=y.clone();let v=_.conditionalModels;v=new Map(v),w={...w},g(null,w,y),v.delete(u),c._updateState({conditionalSpatial:y,conditionalModels:v}),this._commitAndAutoSelect(b,C,S?.autoSelect)}catch(_){throw b.rollback(),_}},isReadOnly:()=>!1,setContainerReadOnlyCallback(S){}},new rx({...p,createDescription:`New ${r}`})),d.removeListener=d.model.addListeners({onAnyChange(S){c._emitter.notify("onStyleChange")}},{transactional:!1}),g(l,d,t),d.model}_createMovableEntry(e,t,n){let r=null;if(e?.anchor)r={colStart:e.anchor.tl?.c??0,rowStart:e.anchor.tl?.r??0,colEnd:e.anchor.br?.c??0,rowEnd:e.anchor.br?.r??0},e.anchor.br?.x||(r.colEnd-=1),e.anchor.br?.y||(r.rowEnd-=1);else{const C=this.getSelection().getRangesCoords()[0];r={colStart:C.colStart,rowStart:C.rowStart,colEnd:C.colEnd,rowEnd:C.rowEnd}}const o={model:null,processShiftCallback:null,processLayoutCallback:null,processDeleteCallback:null,processZIndexCallback:null,processSelectionCallback:null,processProtectionCallback:null,zIndex:t},i={...r,value:o},l=()=>o.model?u._getState()?.movableMapModel?.get(o.model):i,a=(C,_)=>!(!q.isEqualRanges(C,_)||C.value.model!==_.value.model),c=(C,_,y=!0)=>{if(h)return;const v=l();if(!v)return;const x=_??"Update Drawing";u._protectionCheck(()=>["objects"],void 0,x);const E=u._beginCommit({description:x}),R=u._getState()?.movableSpatial,I=R.clone(),A=u._getState()?.movableMapModel,T=new Map(A);C(v,I,T)!==!1&&(u._updateState({movableSpatial:I,movableMapModel:T}),y&&(u._emitterMovables.notify("onCollectionChange",{source:u,transactional:!0}),u._emitter.notify("onMovablesChange")),E.commit({viewAfter:O=>{if(i.value.model.isSelected()&&!O?.movableSelection?.includes(i.value.model)){const N=[...O?.movableSelection??[]];return N.push(i.value.model),{...O,view:this.getView(),movableSelection:N}}}}))},u=this,d=e.content.type;let h=!0;const f=(C,_,y,v)=>{const x=y.all().sort((F,k)=>F.value.zIndex-k.value.zIndex),E=_.value.zIndex;if((C=Math.max(0,Math.min(x.length-1,C)))===E)return!1;const R=[],I=[],A=[],T=E<C,O=F=>{const k=x[F];R.push(k);const L={...k,value:{...k.value,zIndex:T?F-1:F+1}};k.value.zIndex===E&&(L.value.zIndex=C),I.push(L),v.set(L.value.model,L),A.push(L)};if(T)for(let F=E;F<=C;F++)O(F);else for(let F=E;F>=C;F--)O(F);const N=R.length;for(let F=0;F<N;F++)y.remove(R[F],a);y.load(I);const D=A.length;for(let F=0;F<D;F++)A[F].value.processZIndexCallback?.()},g=()=>u._resources.beginPersist(),m=d==="picture",p={content:null,fromResourceId:n,defaultLockAspectRatio:m,beginPersistResource:g,getMaxBounds:()=>u._getBoundsAtCoords(u._entireCoords),transactions:this._transactions,getBoundsAtCoords:u._getBoundsAtCoords.bind(u),getCoordsAtBounds:u._getCoordsAtBounds.bind(u),scrollIntoView:C=>u._selectSheet(l()?.value.model.getAnchorCoords(),C),select:async C=>{const _=l()?.value.model;if(!_)return!1;try{u.getView().selectMovables([_],C?.addToSelection)}catch(v){return console.warn(v),!1}const y=await u._selectSheet(l()?.value.model.getAnchorCoords(),C?.scrollIntoView);return!C?.scrollIntoView||y!==!1},unselect:()=>{const C=l()?.value.model;return!!C&&(u.getView().unselectMovables([C]),!0)},isSelected:()=>u.getView().getMovableSelection().includes(l()?.value.model),setContainerSelectionCallback(C){(l()?.value??o).processSelectionCallback=C},moveToBackOnContainer:()=>{c((C,_,y)=>f(0,C,_,y),"Move to Back")},moveBackwardOnContainer:()=>{c((C,_,y)=>f(C.value.zIndex-1,C,_,y),"Move Backwards")},moveForwardOnContainer(){c((C,_,y)=>f(C.value.zIndex+1,C,_,y),"Move Forward")},moveToFrontOnContainer(){c((C,_,y)=>f(_.size()-1,C,_,y),"Move To Front")},getZIndex:()=>l()?.value.zIndex??0,setContainerZIndexCallback(C){(l()?.value??o).processZIndexCallback=C},setContainerCoords(C){if(!C)return;const _=u._rangeToCoords(C,()=>["objects"]);return c((y,v,x)=>{const E={...y,..._};v.remove(y,a),v.insert(E),x.set(E.value.model,E)},"Update Drawing",!1),_},deleteFromContainer(C){const _=l();_?.value&&u.getView().unselectMovables([_.value.model]);const y=[];c((x,E,R)=>{R.delete(x.value.model),E.remove(x,a),x.value.processDeleteCallback?.(),y.push(x);const I=x.value.model.getZIndex(),A=E.all().sort((F,k)=>F.value.zIndex-k.value.zIndex),T=[],O=[],N=A.length;for(let F=I+1;F<N;F++){const k=A[F];T.push(k);const L={...k,value:{...k.value,zIndex:F-1}};O.push(L),R.set(L.value.model,L)}const D=T.length;for(let F=0;F<D;F++)E.remove(T[F],a);E.load(O)},C?.description??"Delete Drawing",!0);const v=y.length;for(let x=0;x<v;x++)y[x].value.processZIndexCallback?.()},setContainerDeleteCallback(C){(l()?.value??o).processDeleteCallback=C},isProtected:()=>!u._initializing&&!u.getProtection().isObjectsAllowed(),setContainerProtectionCallback(C){(l()?.value??o).processProtectionCallback=C},setContainerShiftCallback(C){(l()?.value??o).processShiftCallback=C},setContainerLayoutCallback(C){(l()?.value??o).processLayoutCallback=C},initialAnchor:r,maxRangeCoords:this._entireCoords,json:e},S=e.content.json,w={type:d,transactions:this._transactions,beginPersistResource:g,fromResourceId:n,defaultLockAspectRatio:m,json:S};let b=null;if(d==="picture")b=new Sv(w);else if(d==="chart")b=new Xv(w);else if(d==="sp"||d==="cxnSp"||d==="grpSp")b=new Zv(w);else{if(d!=="graphicFrame")throw new Pe((C=>`Unsupported float type: ${C}`)(d));b=new Qv(w)}return o.model=new Uv({...p,content:b}),h=!1,i}_fromJSON(e){this._initializing=!0,this._emitter.notify("onBeforeLoad",{params:e}),this._clearState();const t=this._beginCommit({description:"Load Sheet",viewAfter:{initial:!0,skipProtectionCheck:!0}}),n=e||{},r=this._strings,o=r.beginPersist(),i=this._resources.beginPersist(),l=this._styles.beginPersist();try{this._ownStrings&&o.fromJSON(n.strings),this._ownResources&&i.fromJSON(n.resources),this._ownStyles&&l.fromJSON(n.styles);const a=this._entireCoords,c=Yf(n.cols,B.Orientation.Column,a),u=Yf(n.rows,B.Orientation.Row,a);this._colHeaders.fromJSON({headers:n.cols,defaultSize:n.defaultColSize}),this._rowHeaders.fromJSON({headers:n.rows,defaultSize:n.defaultRowSize}),this.setView(new Ou({sheet:this,json:n.view})),this._rangeSelection.updateCoords(this._view.getRangeSelection()),n.tabColor&&(this._tabColor=this._styles.parseColor(n.tabColor));let d=this._getState();const h=d.cellValuesGrid,f=d.contentfulSpatial,g=n.data,m=g?.length??0,p=Zf,S=[];if(m>0){for(let ee=0;ee<m;ee++){let ne=g[ee];typeof ne=="string"&&(ne=JSON.parse(ne));const re=ne[1],U=re.length;let ue;for(let oe=0;oe<U;oe++){const Z=re[oe],Y=Z[1],we=Y.length;for(let ge=0;ge<we;ge++){let de=Y[ge],be=de?.t;if(be!==void 0)de=de?.v;else switch(typeof de){case"number":be=Le.Number;break;case"boolean":be=Le.Boolean;break;case"string":be=Le.String,de=parseInt(de)}Y[ge]=[de,be]}ue=p(null,r,Y),Z[1]=ue}S.push(ne)}h.setValues(S);const G=Qf(S,this._isDataColumn);f.load(G)}const w=d.directStyleSpatial,b=d.continuousFillSpatial,C=this._options.styles,_=e.directStyles;let y,v;if(_){const G=_.length;y=new Array(G);for(let ee=0;ee<G;ee++){const ne=_[ee],re=ne.r,U=typeof re=="string"?Jn(re,a):{...re};U.value={orientations:B.Orientations.Both,index:ne.v},y[ee]=U}}if(c||u){const G=[...y||P.EmptyArray,...c||P.EmptyArray,...u||P.EmptyArray];y=[];try{const ee=new Oi.IteratorInstance(G,{orientation:B.Orientation.Column});let ne=ee.next();for(;!ne.done;){const re=ne.value,U=re.overlaps,ue=U.length;let oe;if(ue===1){if(oe=U[0].value,oe.index===0){ne=ee.next();continue}}else{let Y,we,ge;for(let de=0;!Y&&de<ue;de++){const be=U[de].value,he=be.orientations;he===B.Orientations.Both?Y=be:he===B.Orientations.Row?ge=be:he===B.Orientations.Column&&(we=be)}oe=Y??ge??we}const Z=re.range;y.push({...Z,value:oe}),ne=ee.next()}}catch(ee){console.log(ee)}}if(y){let G=[],ee=[];const ne=ue=>{const oe=ue.value,Z=l.getElementJSON(oe.index),Y=q.sanitizeRange(ue),we=new Yt(C,Y,Z,void 0,oe.orientations),ge=we._p?.alignment?.horizontal;return ge===ce.HorizontalAlignment.CenterContinuous&&G.push(Y),ge===ce.HorizontalAlignment.Fill&&ee.push(Y),{...Y,value:we}},re=y.length;v=new Array(re);for(let ue=0;ue<re;ue++)v[ue]=ne(y[ue]);w.load(v);const U=(ue,oe)=>{const Z=(ue=Sr(ue,B.Orientation.Column,Number.MAX_SAFE_INTEGER)).length,Y=new Array(Z);for(let we=0;we<Z;we++){const ge=ue[we];Y[we]={...ge,value:new Yt(C,ge,{alignment:{horizontal:oe}})}}b.load(Y)};U(G,ce.HorizontalAlignment.CenterContinuous),U(ee,ce.HorizontalAlignment.Fill)}d=this._updateState({cellValuesGrid:h,contentfulSpatial:f,directStyleSpatial:w,continuousFillSpatial:b});const x=n.merges;if(x){const G=[],ee=x.length;for(let ne=0;ne<ee;ne++){const re=Jn(x[ne],a);G.push(re)}this._indexMerges(G)}const E=d.hyperlinkSpatial,R=n.hyperlinks;if(R){const G=R,ee=[],ne=G.length;for(let re=0;re<ne;re++){const U=G[re];let ue=U.r;ue=typeof ue=="string"?Jn(ue,a):q.sanitizeRange(ue);let oe=U.v;typeof oe=="string"&&(oe={address:oe}),ee.push({...ue,value:oe})}E.load(ee)}const I=d.commentsSpatial,A=n.comments;if(A){const G=A,ee=[],ne=G.length;for(let re=0;re<ne;re++){const U=G[re];let ue=U.ref;ue=typeof ue=="string"?Jn(ue,a):q.sanitizeRange(ue);const oe={...U};delete oe.ref,ee.push({...ue,value:oe})}I.load(ee)}const T=d.movableMapModel,O=d.movableSpatial;if(n.movables){const G=[],ee=n.movables,ne=ee.length;for(let re=0;re<ne;re++){const U=ee[re];try{const ue=this._createMovableEntry(U,re,i.fromResourceId.bind(i));T.set(ue.value.model,ue),G.push(ue)}catch(ue){console.warn("Unable to load movable",re,U,ue)}}O.load(G)}const N=d.tableMapModel,D=d.tableMapName,F=d.tableSpatial,k=n.tables;if(k){const G=[],ee=k.length;for(let ne=0;ne<ee;ne++){const re=k[ne],U=this._createTableEntry(re),ue=U.value.model;N.set(ue,U),D.set(U.value.currentName,ue),G.push(U)}F.load(G)}const L=d.conditionalSpatial,W=d.conditionalModels,$=n.conditionals;if($){const G=$.length;for(let ee=0;ee<G;ee++){const ne=$[ee];this._createConditionalEntries(ne,L,W)}}const J=d.calcGraph,te=J.fromJSON({formulas:n.formulas,data:S,dynamic:n.dynamicArray,volatile:n.volatile});d=this._updateState({hyperlinkSpatial:E,commentsSpatial:I,movableSpatial:O,movableMapModel:T,tableSpatial:F,tableMapModel:N,tableMapName:D,conditionalSpatial:L,conditionalModels:W,calcGraph:J});const Q=this._getUsedCoords();Q&&this._autoFit([Q],{orientations:B.Orientations.Row,skipCustomSize:!0,expandOnly:!0}),t.commit(),te&&this._realizeCalcedValues(te),n.protection&&this._protection.fromJSON(n.protection),this._emitter.notify("onLoad")}finally{l.endPersist(),i.endPersist(),o.endPersist()}this._initializing=!1}getName(){return this._closed?tn:this._options.container?.getName?.()??null}setName(e){if(this._closed)throw new Error(Nn);const t=this._options.container?.setName;if(!t)throw new Pe("Unable to set name for sheet.");return t(e),this}getVisibility(){return this._closed?ht.Visibility.VeryHidden:this._options.container?.getVisibility?.()??ht.Visibility.Hidden}setVisibility(e=!0){if(this._closed)throw new Error(Nn);const t=this._options.container?.setVisibility;if(!t)throw new Pe("Unable to set visibility for sheet.");let n;return n=e===!0?ht.Visibility.Visible:e===!1?ht.Visibility.Hidden:e,t(n),this}async select(e){return await this._options.container?.requestSelect?.(e),this}duplicate(){return this._options.container?.duplicate?.()}setPosition(e){return this._options.container?.setPosition(e),this}getNames(){return this._names}getCalculation(){return this._calculation}getWorkbook(){return this._workbook}get[Symbol.toStringTag](){return"[Sheet]"}toString(){return this.getName()||"(untitled sheet)"}get isISheet(){return!0}};const Hm={address:null,scope:null},yx={colStart:0,rowStart:0,colEnd:0,rowEnd:0},ni={colStart:0,rowStart:0,colEnd:0,rowEnd:0},bx={colStart:0,rowStart:0,colEnd:0,rowEnd:0},Nl={includeHidden:!1},Ol={ignoreDataChanges:!1},rr={colStart:-1,rowStart:-1,colEnd:-1,rowEnd:-1},ri=[{colIndex:-1,rowIndex:-1},null,null,null,null],Cx=[ut.Content.Values],$m={size:null,autoSize:!0},Du={skipCustomSize:!0,expandOnly:!0,minContent:!0},un={rowStart:0,colStart:0,rowEnd:0,colEnd:0},oi={rowStart:0,colStart:0,rowEnd:0,colEnd:0},Vm=[],Lu={showFormulaBar:!0,showTabs:!0,tabRatio:600,showHorizontalScrollbar:!0,showVerticalScrollbar:!0,showStatusBar:!0,activeSheetId:null};class Wm{constructor(e){this._emitter=null,this._emitter=new gn(this),this._state={...Lu},e?.json&&this._fromJSON(e?.json)}isShowFormulaBar(){return this._state.showFormulaBar}setShowFormulaBar(e){return this._state.showFormulaBar=e,this._emitter.notify("onViewChange"),this}isShowTabs(){return this._state.showTabs}setShowTabs(e){return this._state.showTabs=e,this._emitter.notify("onViewChange"),this}getTabRatio(){return this._state.tabRatio}setTabRatio(e){return this._state.tabRatio=e,this._emitter.notify("onViewChange"),this}isShowHorizontalScrollbar(){return this._state.showHorizontalScrollbar}setShowHorizontalScrollbar(e){return this._state.showHorizontalScrollbar=e,this._emitter.notify("onViewChange"),this}isShowVerticalScrollbar(){return this._state.showVerticalScrollbar}setShowVerticalScrollbar(e){return this._state.showVerticalScrollbar=e,this._emitter.notify("onViewChange"),this}isShowStatusBar(){return this._state.showStatusBar}setShowStatusBar(e){return this._state.showStatusBar=e,this._emitter.notify("onViewChange"),this}getActiveSheetId(){return this._state.activeSheetId}setActiveSheetId(e){const t=this._state.activeSheetId;return this._state.activeSheetId=e,t!==e&&this._emitter.notify("onViewChange"),this}addListeners(e,t){return this._emitter.addListeners(e,t)}toJSON(){let e={};const t=Object.keys(this._state);for(let n=0;n<t.length;n++){const r=this._state[t[n]];r!=null&&r!==Lu[t[n]]&&(e[t[n]]=r)}return Object.keys(e).length===0&&(e=null),e}_fromJSON(e,t=!0){let n=e||{};this.update(n,t)}update(e,t=!0){this._state={...Lu,...this._state,...e},t&&this._emitter.notify("onViewChange")}}class vx{constructor(e){this._emitter=null,this._closed=!1,this._options={...e};const t=this;this._transactions=this._options.transactions??new Hn({transient:!0}),this._transactionsRemoveListener=this._transactions.addStateListener(this,{onAfterStateChange(n,r,o){t._emitter.notify("onCollectionChange")}}),this._emitter=new gn(this,this._transactions),this._initState(e?.initial)}add(e,t,n){const r=this;t&&t.addListeners({onDelete:c=>{r._updateState(u=>{if(!u.modules[e])return;const d=u.modules[e];if(d){const h={...u};return r._options.onRemove?.(e,d),r._emitter.notify("onCollectionChange"),delete h.modules[e],h}return u},"Delete Module")}},{once:!0});const o=this._getState()?.modules,i=o?.[e],l=n?.replace??!1;if(i&&!l)throw new Error(`Already existing '${e}'`);const a={...o};t?(a[e]=t,r._options.onAdd?.(e,t),this._updateState({modules:a},l?"Save Scripts":"Add Script")):(delete a[e],r._options.onRemove?.(e,null),this._updateState({modules:a},"Remove Script")),r._emitter.notify("onCollectionChange")}getItems(e){const t=this._getState();if(!t)return P.EmptyArray;const n=t.modules,r=Object.keys(n),o=r.length;if(o===0)return P.EmptyArray;const i=[],l=e?.name?e.name.toUpperCase():null;for(let a=0;a<o;a++){const c=r[a],u=n[c];let d=!0;l&&l!==c.toUpperCase()&&(d=!1),d&&i.push(u)}return i??P.EmptyArray}getByName(e){if(!e)return null;const t=this._getState();if(!t)return null;const n=e.toUpperCase(),r=t.modules,o=Object.keys(r),i=o.length;for(let l=0;l<i;l++){const a=o[l];if(n===a.toUpperCase())return r[a]}return null}getCount(){const e=this._getState();return e?Object.keys(e.modules).length:0}beginCommit(e){return this._beginCommit(e)}_getState(){if(this._closed)throw new Error(Xn);return this._transactions.getState(this)}_beginCommit(e){return this._transactions.beginCommit(typeof e=="string"?{description:e}:e)}_updateState(e,t="Update",n){if(!e)return;const r=this._beginCommit(t);try{r.updateState(this,e),r.commit(n)}catch(o){throw r.rollback(),o}}_initState(e){let t=e??{};this._updateState({modules:t},"Initialize",{forceAmend:!0});const n=this._options.onAdd;if(n){const r=Object.keys(t),o=r.length;for(let i=0;i<o;i++){const l=r[i];n(l,t[l])}}}addListeners(e,t){return this._emitter.addListeners(e,t)}toJSON(){const e=this._getState();if(!e)return P.EmptyArray;const t=e.modules,n=Object.keys(t),r=n.length,o={};for(let i=0;i<r;i++){const l=n[i];o[l]=t[l].toJSON()}return o}isClosed(){return this._closed}close(){this._closed||(this._emitter.notify("onClose"),this._closed=!0,this._transactionsRemoveListener?.())}get isFunctionCollection(){return!0}}let Bu;const Dl="SheetXL",xx=Bu||(Bu=P.deepFreeze({ISheet:{Visibility:ht.Visibility},ICell:{Content:ut.Content,CalcStatus:ut.CalcStatus},IColor:{Named:V.Named,Scheme:V.Scheme,Type:V.Type,AdjustmentType:V.AdjustmentType},Direction:Lt}),Bu);let Ll;class Ex extends Da{constructor(e,t,n,r=null,o=!1){super(e,t,n,r,o)}execute(...e){const t=e[0];if(!t||!t.isIWorkbook)throw new Error(`Macro '${this.getName()}' must be called with a valid workbook as the only argument.`);const n=this._ct;try{const r=[];switch(n){case Or.Context.Workbook:r.push(t);break;case Or.Context.Sheet:r.push(t.getSelectedSheet());break;case Or.Context.Ranges:r.push(t.getSelectedRanges());break;case Or.Context.Range:r.push(t.getSelectedRange());break;default:throw new Error(`Function '${this.getName()}' is not a valid macro function.`)}const o=async(l,a)=>{const c=await a;if(c!==void 0)if(c!==null){if(Array.isArray(c)){if(yn(c[0]?.[0]))return void l.setValues(c,{skipBoundsCheck:!0})}else if(yn(c))return void l.setValues([[c]]);c.isICell?l.updateCells(c):c.isICellRange&&await l.copyFrom(c)}else l.clear()};let i;return(async()=>{const l=(await this.getDescriptor()).getSummary()??`Macro '${this.getName()}'`;return await t.doBatch(async()=>{try{const a=t.getSelectedRange();let c=this._cf();c||(c=(function(u){return new Proxy(u,{set:(d,h,f)=>(console.log(`Adding property "${h}" with value:`,f),d[h]=f,!0),deleteProperty:(d,h)=>(console.log(`Deleting property "${h}"`),delete d[h])})})({}));try{uh({getPosition:()=>a.getCell().getCoords()}),Ll=globalThis[Dl],globalThis[Dl]=xx,i=this._fn.call(c,...r),Ll?(globalThis[Dl]=Ll,Ll=void 0):delete globalThis[Dl],Oa()}catch(u){throw u}finally{Oa()}await o(a,i)}catch(a){throw a}},l),{params:r,results:i}})()}catch(r){throw r}}}class Rx{constructor(e){this._emitter=null;const t=e.json;if(this._json=t,!this._json)throw new Error("Module JSON is required.");this._name=e.name??null,this._emitter=new gn(this),this._functions=new zS({transactions:null,readonlyFunctions:e.readonlyFunctions})}getName(){return this._name}getFunctions(){return this._functions}getSource(){return this._json.source}getLanguage(){return this._json.language||"typescript"}getErrors(){return null}delete(){this._emitter.notify("onDelete")}addListeners(e,t){return this._emitter.addListeners(e,t)}toJSON(){return this._json}}const Ix=async(s,e)=>{let t=null;try{uh(null)}catch(o){console.warn("Error setting global scope",o)}try{t=await new Function("modulePath","return import(modulePath)")(`data:text/javascript,${encodeURIComponent(s.compiled)}`)}catch(o){throw new Error("Invalid Javascript module.",{cause:o})}finally{Oa()}if(!e)throw new Error(`No function available for '${s.name??s.commitId}'.`);const n=e.name;let r=t[n];if(!r&&e.behavior.default&&(r=t.default),!r)throw new Error(`Found the descriptor for '${n}' but not the function. The descriptor manifest must be corrupt.`);return r},jm=async(s,e,t=!1)=>{const n=e?.functions,r=new Map;if(n)for(let o=0;o<n.length;o++){const i=n[o],l=i[0],a=i[1];let c,u=t?()=>{}:await Ix(e,l);c=l.context&&l.context!==Or.Context.Calculation?new Ex(l,u,()=>null,a):new Da(l,u,()=>null,a),r.set(l.name.toUpperCase(),c)}return new Rx({json:e,readonlyFunctions:r,name:s})};class Ax{constructor(e){this._emitter=null,this._options=e,this._emitter=new gn(this),this._initState()}_initState(){}getModules(){return this._modules}async createModule(e){const t=await ao(()=>import("./index-dIYXK-vs.js"),__vite__mapDeps([10,1,2,3,4,5,6]),import.meta.url),n=await t.ScriptingUtils.compileTypescript(e);return n?await jm("scripts",n,e?.declarationsOnly??!1):null}addModule(e,t,n){this._modules.add(e,t,n)}executeMacro(e,t){const n=this._modules.getItems({name:t}),r=n.length;for(let o=0;o<r;o++){const i=n[o].getFunctions().getByName(e);if(i)return i.execute(this._options.workbook)}throw new Error(`No macro ${e} found.`)}async searchFunctions(e){await this._emitter.notify("onBeforeSearch",{async:!0});const t=e?.moduleName,n=this._modules;let r;if(e.includeBuiltIn){const l=this._options.getBuiltInFunctions?.();l&&(r=await l.search(e))}if(!n)return r??P.EmptyArray;if(n.getCount()===0)return r??P.EmptyArray;const o=t?this._modules.getItems({name:t}):this._modules.getItems(),i=o.length;for(let l=0;l<i;l++){const a=o[l],c=await a.getFunctions().search(e);c.length>0&&(r||(r=[]),r.push(...c))}return Promise.resolve(r)}async start(){if(this._modules)return Promise.resolve();const e=this._options?.workbook,t=this._options?.json;let n={};if(t){const a=Object.keys(t);for(let c=0;c<a.length;c++){const u=a[c],d=t[u],h=await jm(u,d);n[u]=h}}const r=this,o=new vx({transactions:this._options?.transactions,initial:n,onRemove:(a,c)=>{r._options?.onRemove?.(a,c)},onAdd:(a,c)=>{r._emitter.notify("onChange"),r._options?.onAdd?.(a,c)}});this._modules=o;const i=o.getItems();if(i.length===0)return Promise.resolve(P.EmptyArray);const l=i.length;for(let a=0;a<l;a++){const c=i[a];try{const u=c.getFunctions().getItems({type:"autoRun"}),d=u.length;for(let h=0;h<d;h++)await u[h].execute(e)}catch(u){cs.error("Error executing autoRun script:",u)}}}addListeners(e,t){return this._emitter.addListeners(e,t)}isReadOnly(){return this._options.workbook?.getProtection().isStructureAllowed()===!1}toJSON(){this._emitter.notify("onBeforeSave");const e=this._modules;if(!e)throw new Error("Scripts is initializing.");return e.toJSON()}}const Mx=Object.freeze({lockStructure:!1,lockWindows:!1,lockRevision:!1,workbookPassword:null,revisionsPassword:null});class Gm extends GS{isWindowsAllowed(){return this._isPropertyAllowed("windows")}isRevisionAllowed(){return this._isPropertyAllowed("revision")}isStructureAllowed(){return this._isPropertyAllowed("structure")}_fromJSON(e){this._properties=e}_toJSON(e){let t=this._properties;if(t){e={...e,...t};const n=Object.keys(t),r=n.length;for(let o=0;o<r;o++){const i=n[o],l=t[i];l!=null&&l!==Mx[i]&&(e[i]=l)}}return super._toJSON(e)}}const zu=s=>`Invalid SheetKey: ${s}`,Pu="A workbook must contain at least one visible worksheet.",Um="Internal error no visible sheetRefs",pn="Workbook has been closed. No further operations are allowed.",po="This workbook structure is protected. To make a change, unprotect the workbook. You might be requested to enter a password.",rc="A sheet name",Ld=`${rc} can not be blank.`,Tx=`${rc} can not be longer than 31 characters.`,kx=`${rc} can not begin or end with a "'" (single quote).`;class Fx{constructor(e,t){this._add=e,this._get=t}add(e){return this._add(e)}getItems(e){return this._get(e?.name,e?.visibility)}getByName(e){return this._get(e)?.[0]??null}getCount(){return this._get().length}}const Bd=new RegExp(/[\\/\\*?:[\]]+/),Nx=new RegExp(/\(((\d+)(?!.*\d))\)$/,"g"),Ox=s=>`Sheet${s+1}`,KS=(s,e)=>({...so,getSheet:()=>null,toString:()=>Za(s,e)}),qm=(s,e=!1)=>{if(!s)throw new Error(Ld);if(Bd.test(s)){if(!e)throw new Error((n=>`${n?`'${n}'`:rc} can not contain any of the following characters '\\ , / , * , ? , : , [ , ]'.`)(s));s=s.replace(Bd,"")}if(s.length===0)throw new Error(Ld);const t=s.length;if(t>31){if(!e)throw new Error(Tx);s=s.substring(0,31)}if(s.charAt(0)==="'"||s.charAt(t-1)==="'"){if(!e)throw new Error(kx);s=s.replace(/^'|'$/g,"")}return s};let XS=class ZS extends hh{constructor(e,t,n,r){super(e,t,r),this._workbook=n}getSource(){return this._workbook}_createRanges(e,t){let n=this._options;return t&&(n={...this._options,getOptions:Br(this._options?.getOptions,t)}),new ZS(e,this._sheet,this._workbook,n)}_createRange(e,t){const n=e?{...e}:null;if(!(n&&this._workbook._getSheetRef(n.sheetName,ht.Visibility.VeryHidden))){const o=this._workbook.getSelectedSheet();return delete n?.sheetName,KS(n,n?{sheetName:tn,...o.getEntireRange().getCoords()}:null)}let r=this._options;return t&&(r={...this._options,getOptions:Br(this._options.getOptions,t)}),new QS(e,this._sheet,this._workbook,r)}async select(e){const t=[];let n=null;const r=this.getCoords();for(let a=0;a<r.length;a++){const c=r[a];c&&(n||(n=c.sheetName),c&&c.sheetName===n&&t.push(c))}n||(n=this._workbook.getSelectedSheet().getName());const o=this._workbook.getSheets().getByName(n);if(!o)return;const i=await o.getRanges(t).select(e),l=this._workbook._rangesAddressToCoords(i.getCoords());return this._createRanges(l,e)}addListener(e,t){if(!this.getCoords())return()=>{};const n=this._workbook._sheetToWBEvent(e);return super.addListener(n,t)}get[Symbol.toStringTag](){return"[WorkbookRanges]"}toString(){const e=this.getCoords(),t=this._sheet,n=t.getEntireRange().getCoords(),r={sheetName:t.getName(),...n};return sS(e,r,Za,co)}},QS=class YS extends gh{constructor(e,t,n,r){super(e,t,r),this._workbook=n}_createRanges(e,t){let n=this._options;return t&&(n={...this._options,getOptions:Br(this._options?.getOptions,t)}),new XS(e,this._sheet,this._workbook,n)}_createRange(e,t){const n=this._sheet;if(!e)return Nr(n,n._entireCoords);if(n._validateCoords(e),n._closed)return Nr(null,n._entireCoords,e);let r=this._options;return t&&(r={...this._options,getOptions:Br(this._options?.getOptions,t)}),new YS(e,this._sheet,this._workbook,r)}addListener(e,t){if(!this.getCoords())return()=>{};const n=this._workbook._sheetToWBEvent(e);return super.addListener(n,t)}get[Symbol.toStringTag](){return"[WorkbookRange]"}toString(){const e=this._sheet,t=e?.getEntireRange().getCoords()??null;return Za(this.getCoords(),{...t,sheetName:e.getName()})}};class R2{constructor(e){this._lastTransactionUUID=null,this._closed=!1,this._initializing=!0,this._emitter=null,this._names=null,this._calculation=null,this._isDate1904=!1;const t=this,n={...e},r=n.json;delete n.json,this._transactions=n.transactions??new Hn,this._ownTransactions=!n.transactions,this._emitter=new gn(this,this._transactions);const o=this._beginCommit({description:(r?"Open":"New")+" Workbook"});try{this._strings=n.strings??new ah,this._ownStrings=!n.strings,this._resources=n.resources??new OS,this._ownResources=!n.resources,this._createSheetName=n.createSheetNameCallback??Ox;let i=n.createSheetCallback;i||(i=a=>new Dd(a)),this._sheetOnNameChange=new Map,this._sheetOnVisibilityChange=new Map,this._sheetOnIndexChange=new Map,this._createSheet=(a,c,u,d,h)=>{let f=null;const g={date1904:t.isDate1904(),readonly:t._options.readonly??!1,transactions:t._transactions,styles:t._styles,strings:t._strings,resources:t._resources,names:t._names,workbook:t,calculation:t._calculation,resolveRange:m=>t._options.resolveRange?.(m)??t.getRange(m),container:{beforeFromJSON:m=>{f=m,t._addSheetRef({name:c,id:a,visibility:u??ht.Visibility.Visible,sheet:m},d)},getName:()=>{const m=t._getSheetRef(f);return m?m.name:t._createSheetName(1)},setName:m=>{t._getSheetRef(f)&&t._setSheetName(f,m)},getIndex:()=>{const m=t._getSheetRef(f);return m?t._findOffsetForId(m.id,t._getSheetRefs(ht.Visibility.VeryHidden)):-1},setIndexCallback:m=>{t._sheetOnIndexChange.set(a,m)},setNameChangeCallback:m=>{t._sheetOnNameChange.set(a,m)},getVisibility:()=>{const m=t._getSheetRef(f);return m?m.visibility:ht.Visibility.Visible},setVisibility:m=>{t._setSheetVisibility(f,m)},setVisibilityCallback:m=>{t._sheetOnVisibilityChange.set(a,m)},duplicate:()=>t._duplicateSheet(f),setPosition:m=>{const p=t._getSheetRef(f,ht.Visibility.VeryHidden);return!!p&&(t._moveSheet(p,m),!0)},requestSelect:async()=>(t._setSelectedSheet(f),await this._emitter.notify("onRequestSelect",{source:t,params:f,async:!0}),t.getSelectedSheet()===f)}};return h&&(g.json=h),f=i(g,c,d,u),f},this._names=n.names??new HS({addressToRanges:a=>t.getRanges(a),getCurrentScope:()=>t.getSelectedSheet().getName(),isReadOnly:()=>t._options.readonly??!1,transactions:t._transactions}),this._ownNames=!n.names,this._calculation=n.calculation??new PS({getNamed:(a,c)=>{try{Yo.address=a,Yo.scope=c;const u=this._names.getItems(Yo);return u&&u.length!==0?u[0].getRanges().getCoords():null}catch{return null}},getSheetIndex:a=>{if(a===void 0)return t.getSelectedSheetIndex();const c=this._getSheetRefs(ht.Visibility.Hidden);a=a.toLowerCase();const u=c.length;for(let d=0;d<u;d++)if(c[d].name.toLowerCase()===a)return d;try{Yo.address=a,Yo.scope=void 0;const d=this._names.getItems(Yo);if(!d||d.length===0)return-1;let h=d[0].getRanges().getCoords()?.[0]?.sheetName;if(!h)return-1;const f=this._getSheetRefs(ht.Visibility.Hidden);h=h.toLowerCase();const g=f.length;for(let m=0;m<g;m++)if(f[m].name.toLowerCase()===h)return m}catch{return-1}return-1},getSheetCount:()=>t.getSheets().getCount(),isDate1904:()=>t.isDate1904(),strings:t._strings,transactions:t._transactions}),this._ownsCalculation=!n.calculation,this._scripts=this._createScripts(),this._ownNames=!n.names,this._options={...n};const l=async()=>{this._ownsCalculation&&await this._calculation.start(),await this._scripts.start(),this._starting=null};this._starting=l(),r?this._fromJSON(r):(this._initState(),this._addSheet(!1)),this._emitter.notify("onLoad"),o.commit({forceAmend:this._ownTransactions})}catch(i){throw o.rollback(),i}this._sheets=new Fx(i=>t._addSheetOptions(i),(i,l)=>i?[this.getSheet(i,l)]:this._getSheets(l)),this._initializing=!1}_initState(){let e=this._getSheetRefs();e&&e.length,this._isDate1904=this._options.date1904??!1,this._theme=this._options.theme??new th().getDefaultTheme(),this._styles=this._options?.styles??new qi(this._theme),this._ownStyles=!this._options.styles,this._styles.getTheme()||this._styles.setTheme(this.getTheme()),this._activeSheetOffset=0,this.setView(new Wm),this._listenerProtection?.(),this._protection=new Gm(void 0,this._options.readonly??!1),this._listenerProtection=this._protection.addListeners({onChange:r=>{t._emitter.notify("onProtectionChange")}});const t=this;this._transactionsRemoveListener=this._transactions.addStateListener(this,{onAfterStateChange(r,o,i){if(o&&o.activeSheetId!==void 0&&o.view===t.getView()&&i.getId()===t._lastTransactionUUID&&t._getSheetRef(o.activeSheetId)?.sheet.select(),o&&i.getId()!==t._lastTransactionUUID){let l=t.getView().getActiveSheetId();o.view===t.getView()&&(l=o.activeSheetId);let a=0;try{a=t._findOffsetForId(l,r.sheetRefsVisible)}catch{}t._activeSheetOffset=a}t._lastTransactionUUID=i.getId(),t._notifyAllChange()},onRestoreOrRevert(){t._emitter.notify("onInvalidated")}});const n=this._getState();n?.listenersSheets&&(n?.listenersSheets.forEach(r=>{r()}),n?.listenersSheets.clear()),this._updateState({name:this._options.name??null,sheetRefsAll:[],sheetRefsVisibleAndHidden:[],sheetRefsVisible:[],refsById:new Map,sheetsById:new Map,refsByLowerCaseName:new Map,sheetsByLowerCaseName:new Map,refsByInstance:new Map,lastId:-1,sheetsCreated:new Set,listenersSheets:new Map})}getName(){return this._closed?null:this._getState().name}setName(e){if(this._closed)throw new Error(pn);if(e!==null)try{const t=this._options.validateWorkbookName?.(e);t!==void 0&&(e=t)}catch(t){throw new Pe(`Invalid workbook name: ${t instanceof Error?t.message:String(t)}`)}return this._updateState({name:e},"Set Workbook Name"),this._emitter.notify("onNameChange"),this}getView(){return this._view}setView(e){if(this._closed)throw new Error(pn);if(!e)throw new Pe("View can not be empty.");this._listenerWorkbookView?.();const t=this;let n=-1;return this._listenerWorkbookView=e.addListeners({onViewChange:r=>{const o=t._getState(),i=this._view.getActiveSheetId(),l=this._findOffsetForId(i,o.sheetRefsAll);this._activeSheetOffset=l,t._emitter.notify("onViewChange"),n!==i&&t._emitter.notify("onSelectionChange"),n=i}}),this._view=e,t._emitter.notify("onViewChange"),this}isDate1904(){return this._isDate1904}setDate1904(e){if(this._closed)throw new Error(pn);return this._isDate1904=e,this._notifyAllChange(),this}getStyles(){return this._styles}getResources(){return this._resources}getTransactions(){return this._transactions}getStrings(){return this._strings}getTheme(){return this._theme}setTheme(e){if(this._closed)throw new Error(pn);if(!e)throw new Pe("A value must be provided.");const t=this._theme;return this._theme=e,this.getStyles().setTheme(e),this._emitter.notify("onThemeChange"),t}getSelectedSheetIndex(){return this._activeSheetOffset}getSelectedSheet(){const e=this._getSheetRef(this.getSelectedSheetIndex());return e?e?.sheet:null}getSheet(e,t=ht.Visibility.Visible){const n=this._getSheetRef(e,t);if(!n)throw new Tt(`Sheet '${e}' not found.`);return n.sheet}getSheetAt(e,t=ht.Visibility.Visible){const n=this._getSheetRef(e,t);if(!n)throw new Tt((r=>`No sheet found at ${r}.`)(e));return n.sheet}getSheets(){return this._sheets}addSheet(e){return this.getSheets().add(e)}_getSheets(e=ht.Visibility.Visible){const t=this._getSheetRefs(e),n=[],r=t.length;for(let o=0;o<r;o++)n.push(t[o].sheet);return n}_getSheetRefs(e=ht.Visibility.Visible){if(this._closed)return P.EmptyArray;const t=this._getState();return t?e===ht.Visibility.Visible?t.sheetRefsVisible:e===ht.Visibility.Hidden?t.sheetRefsVisibleAndHidden:e===ht.Visibility.VeryHidden?t.sheetRefsAll:P.EmptyArray:[]}_getSheetRef(e,t=ht.Visibility.Visible){if(this._closed)return null;let n=null;return typeof e=="number"?this._getSheetRefs(t)[e]:(typeof e=="string"?n=this._getState().refsByLowerCaseName.get(e.toLowerCase()):e instanceof Dd?n=this._getState().refsByInstance.get(e):e?.id!==void 0&&e.sheet&&(n=this._getState().refsById.get(e.id)),n)}_validateNewSheetName(e,t=!0){if(e==null)return e;if(qm(e),t&&this._getState().sheetsByLowerCaseName.has(e.toLowerCase()))throw new Pe("That name is already taken. Try a different one.");return e.substring(0,31)}findValidSheetName(e){e&&(e=qm(e,!0));try{return((t,n)=>{try{if(n(t))return t}catch{}let r,o,i=Nx.exec(t);for(i!==null?(r=t.substring(0,i.index),o=parseFloat(i[1])):(r=t+" ",o=1);o<256;){o++;const l="("+o+")",a=r.substring(0,31-l.length)+l;try{if(n(a))return a}catch{}}throw new Error(t+" is not a valid sheet name")})(e,t=>this._validateNewSheetName(t))}catch{return this._nextSheetName()}}isValidSheetNameCharacter(e){return!Bd.test(e)}_addSheetOptions(e){if(this._closed)throw new Error(pn);if(!this.getProtection().isStructureAllowed())throw new Pe(po);let t,n=null;t=typeof e=="string"?{name:e}:typeof e=="number"?{index:e}:e,t={...t,description:t?.description??"Add Sheet"};const r=this.beginCommit(t);try{const o=t?.autoSelect??!1;n=this._addSheet(!0,t.name,t.index??null);const i=this.getView().getActiveSheetId();let l,a;if(o!==!1){let c=this.getView().getActiveSheetId();c=this._getSheetRef(n).id,o&&(l={view:this.getView(),activeSheetId:i},a={view:this.getView(),activeSheetId:c})}if(r.commit({description:`Add Sheet '${n.getName()}'`,viewBefore:l,viewAfter:a}),o!==!1){const c=typeof o=="boolean"?void 0:o;n.select(c)}}catch(o){throw r.rollback(),o}return n}_nextSheetName(e=null){let t=e?e.toLowerCase():null;const n=this._getState(),r=n.sheetsByLowerCaseName;if(e&&r.has(t))throw new Pe((i=>`The sheet name '${i}' already exist in workbook.`)(e));t=(e=this._validateNewSheetName(e))?e.toLowerCase():null;let o=n.lastId+1;for(;!e;){const i=this._createSheetName(o),l=i.toLowerCase();r.has(l)?o++:e=i}return this._updateState({lastId:o}),e}_addSheet(e,t=null,n=null){t=this._nextSheetName(t);const r=this._getState(),o=this._createSheet(r.lastId,t,ht.Visibility.Visible,n,null);if(!o)throw new Pe(Ld);return e&&this._emitter.notify("onSheetsChange"),o}_updateSheetRefStates(e){if(this._closed)throw new Error(pn);if(!this._initializing&&!this.getProtection().isStructureAllowed())throw new Pe(po);const t=e,n=[],r=[],o=t.length;for(let i=0;i<o;i++)t[i].visibility===ht.Visibility.Visible?(n.push(t[i]),r.push(t[i])):t[i].visibility===ht.Visibility.Hidden&&r.push(t[i]);this._updateState({sheetRefsAll:t,sheetRefsVisible:n,sheetRefsVisibleAndHidden:r})}_addSheetRef(e,t=null){const n=this._getState(),r=n.sheetRefsAll,o=Math.max(0,Math.min(r.length,t??r.length));let i=[...r.slice(0,o),e,...r.slice(o)];this._updateSheetRefStates(i);const l=e.sheet,a=e.name.toLowerCase(),c=new Map(n.refsById);c.set(e.id,e);const u=new Map(n.refsByLowerCaseName);u.set(a,e);const d=new Map(n.refsByInstance);d.set(l,e);const h=new Map(n.sheetsById);h.set(e.id,l);const f=new Map(n.sheetsByLowerCaseName);f.set(a,l);const g=this;let m=n.listenersSheets;if(l!==void 0){const w=l.addListeners({onBeforeDelete:_=>{g._validateDeleteSheet(_)},onDelete(_){let y=g._getSheetRef(_,ht.Visibility.VeryHidden);if(!y)return;const v=g._beginCommit({description:`Remove Sheet ${y.name}`});try{const x=g._getState(),E=x.sheetRefsAll,R=g._findOffsetForId(y.id,E);let I=[...E];I.splice(R,1),g._updateSheetRefStates(I);const A=new Map(x.refsById);A.delete(y.id);const T=new Map(x.sheetsById);T.delete(y.id);const O=y.name.toLowerCase(),N=new Map(x.refsByLowerCaseName);N.delete(O);const D=new Map(x.sheetsByLowerCaseName);D.delete(O);const F=new Map(x.refsByInstance);F.delete(_),x.listenersSheets.get(y.id)();const k=new Map(x.listenersSheets);k.delete(y.id),g._adjustRemoveSelectionIfRequired(R,y.id),g._adjustSheetNamesIfRequired(),g._emitter.notify("onSheetsChange");const L=new Set(x.sheetsCreated);L.has(l)&&L.delete(l),g._updateState({refsById:A,sheetsById:T,refsByLowerCaseName:N,sheetsByLowerCaseName:D,refsByInstance:F,sheetsCreated:L,listenersSheets:k}),v.commit()}catch(x){throw v.rollback(),x}}}),b=l.addListeners({onSelectionChange:_=>{g.getView().getActiveSheetId()===g._getSheetRef(_)?.id&&g._emitter.notify("onSelectionChange",{source:g,params:_})}},{transactional:!1}),C=()=>{w(),b()};m=new Map(n.listenersSheets),m.set(e.id,C)}let p=n.lastId;p!==-1&&(p=Math.max(p,e.id)),this._updateState({lastId:p}),this._updateState({refsById:c,refsByLowerCaseName:u,refsByInstance:d,sheetsById:h,sheetsByLowerCaseName:f,listenersSheets:m}),this._adjustSheetNamesIfRequired();const S=new Set(this._getState().sheetsCreated);return S.add(e.sheet),this._updateState({sheetsCreated:S}),e}_adjustRemoveSelectionIfRequired(e,t){if(this._view.getActiveSheetId()===t){let n;const r=this._getState().sheetRefsVisible;n=e<r.length?r[e].id:r[e-1].id,this._view.setActiveSheetId(n)}}_adjustSheetNamesIfRequired(){const e=this._getState(),t=e.lastId;if(t===-1)return;let n=this._view.getActiveSheetId();n==null&&(this._view.setActiveSheetId(t),n=t),e.refsById.get(n).visibility===ht.Visibility.Visible&&(this._activeSheetOffset=this._findOffsetForId(n,e.sheetRefsVisible))}_validateDeleteSheet(e){if(this._closed)throw new Error(pn);if(!this.getProtection().isStructureAllowed())throw new Pe(po);let t=this._getSheetRef(e);if(!t)throw new Pe((r=>`Invalid reference for delete: ${r}`)(e));const n=this._getState().sheetRefsVisible;if(n.length===1&&n[0].id===t.id)throw new Pe(Pu)}_findOffsetForId(e,t){const n=t.length;for(let r=0;r<n;r++)if(t[r].id===e)return r;throw new Pe(Um)}find(e){if(this._closed)throw new Error(pn);const t=this._getSheets();if(t.length===1)return t[0].find(e);typeof e=="string"&&(e={text:e});const n=!e?.reverse;let r=e?.disableWrap??!1;const o=this.getSelectedSheetIndex();let i=o,l=t[i],a=!1;e={...e,disableWrap:!0};let c,u=l.find(e),d=u.next(),h=!1;if(e?.from){const m=this._rangesAddressToCoords(e?.from);c={colIndex:m[0].colStart,rowIndex:m[0].rowStart}}const f=q.createCellComparator(e?.orientation,e?.reverse);delete(e={...e}).from;const g=()=>{if(!h&&d.done&&(a&&i===o?h=!0:n?(i++,i>t.length-1&&(i=0,a=!0)):(i--,i<0&&(i=t.length-1,a=!0)),r&&a&&(h=!0),h||c||!a||i!==o||(h=!0),!h)){l=t[i],u=l.find(e);const p=d;return d=u.next(),p}if(!h&&a&&i===o&&(d.done||!c||!d.done&&f(d.value.getCoords(),c)>=0)&&(h=!0),h){const p=d;return d=xt,p}const m=d;return d=u.next(),m};return{next:()=>{let m=g();for(;!h&&m.done;)m=g();return m}}}replace(e,t,n){let r=0,o=null;const i=typeof t=="function",l=n?.maxCount??Number.MAX_SAFE_INTEGER;let a=n.maxCount?"":"All";const c=typeof t=="string"?` with '${f0(t)}'`:"";let u=n?.description??"Replace";const d=this._transactions.beginCommit({description:u});try{let h=null,f=null,g=e.next();for(;!g.done&&r<l;){const m=g.value,p=m.getSheet();p!==h&&(h=p,f!==null&&f.apply(),f=h.getEntireRange().startIncrementalUpdates({orientation:n?.orientation,allowUnorderedWrites:!0}));const S=i?t(m):t;S!==void 0&&S!==m&&(f.push(m,S),r++,o=m),g=e.next()}f?.apply(),r===1&&l===1&&o&&(a=o.getA1()),r===0?d.rollback():d.commit({description:n?.description??`Replace ${a}${c}`,viewAfter:{selection:null}})}catch(h){throw d.rollback(),h}return{count:r,last:o}}_nextSheetIndex(e,t=this._getSheetRefs()){const n=t.length;return n===1?0:(e===void 0&&(e=this.getSelectedSheetIndex()),(e=Math.max(0,Math.min(e,n-1)))>=n-1?0:e+1)}_prevSheetIndex(e,t=this._getSheetRefs()){const n=t.length;return n===1?0:(e===void 0&&(e=this.getSelectedSheetIndex()),(e=Math.max(0,Math.min(e,n-1)))<=0?n-1:e-1)}getNextSheet(e){if(this._closed)throw new Error(pn);const t=this._getSheetRefs();return t[this._nextSheetIndex(e,t)]?.sheet??null}getPreviousSheet(e){if(this._closed)throw new Error(pn);const t=this._getSheetRefs();return t[this._prevSheetIndex(e,t)]?.sheet??null}async _duplicateSheet(e){if(this._closed)throw new Error(pn);if(!this.getProtection().isStructureAllowed())throw new Pe(po);const t=this._getSheetRefs(),n=this.getSelectedSheetIndex();let r=null;if(e){if(r=this._getSheetRef(e),!r)throw new Pe(zu(r))}else r=t[n];if(!r)return null;const o=r.sheet,i=this._strings.beginPersist(),l=this.getResources().beginPersist(),a=this.getStyles().beginPersist();let c=null;const u=this.beginCommit(`Duplicate '${o.getName()}'`);try{const d=this._getState().refsByInstance.get(o),h=await o.toJSON(),f=t.length+1,g=this.findValidSheetName(d.name),m=this._createSheet(f,g,d.visibility,n,h);this._emitter.notify("onSheetsChange"),c=m,u.commit()}catch(d){throw u.rollback(),d}finally{a.endPersist(),l.endPersist(),i.endPersist()}return c}_createRange(e,t){const n=e?{...e}:null;if(!(n&&this._getSheetRef(n.sheetName,ht.Visibility.VeryHidden))){const i=this.getSelectedSheet();return i?(delete n?.sheetName,KS(n,n?{sheetName:tn,...i.getEntireRange().getCoords()}:null)):void console.warn(Um)}const r=this.getSelectedSheet();let o=null;return t&&(o={getOptions:t}),new QS(e,r,this,o)}_createRanges(e,t){const n=this.getSelectedSheet();let r=null;return t&&(r={getOptions:t}),new XS(e,n,this,r)}getRange(e,t){try{const n=this._rangesAddressToCoords(e);if(n.length!==1)throw new Pe(cS);return this._createRange(n[0],t)}catch(n){throw n instanceof Tt?new Tt(n.message):new Pe(n.message??ms(e))}}getRanges(e,t){const n=this._rangesAddressToCoords(e);if(n.length===0)throw new Pe(ms(e));return this._createRanges(n,t)}_activeRangeCoords(){const e=this.getSelectedSheet(),t=e.getSelection().getRangesCoords(),n=e.getName(),r=[],o=t.length;for(let i=0;i<o;i++)r.push({sheetName:n,...t[i]});return r}getSelectedRange(e){return this.getRange(this._activeRangeCoords()[0],e)}getSelectedRanges(e){return this.getRanges(this._activeRangeCoords(),e)}getSelectedCell(){return this.getSelectedSheet().getSelectedCell()}_rangesAddressToCoords(e,t=!0,n=ht.Visibility.Hidden){if(!e)throw new Pe(xo);const r=this.getSelectedSheet(),o=r?.getEntireRange().getCoords(),i={...o},l=r?.getName();if(l&&(i.sheetName=l),typeof e=="string"){const d=e.trim().toLowerCase();if(d==="r"||d==="c"){const h=this.getSelectedCell().getCoords(),f={};d==="r"?f.rowStart=f.rowEnd=h.rowIndex:f.colStart=f.colEnd=h.colIndex,e=f}}const a=this,c=Qa(e,i,Ui,d=>{if(!t)return null;if(typeof d=="string"){const h=a.getNames().getByName(d);if(h)return h.getRanges()?.getCoords()}throw new Pe(`Invalid sheet reference '${d}'.`)}),u=c.length;for(let d=0;d<u;d++)this._validateCoords(c[d],n);return c}_validateCoords(e,t=ht.Visibility.Visible,n=Aa){if(e===null)return;const r=this.getSheet(e.sheetName,t).getEntireRange().getCoords();if(!q.isRangeWithinRange(e,r))throw new Tt(n);if(e.rowEnd<e.rowStart||e.colEnd<e.colStart)throw new Pe(uS)}_updateSheetRef(e,t){const n=this._getState();let r=[...n.sheetRefsAll];r[this._findOffsetForId(e.id,n.sheetRefsAll)]=t,this._updateSheetRefStates(r);const o=new Map(n.refsById);o.set(e.id,t);const i=e.name.toLowerCase(),l=t.name.toLowerCase(),a=new Map(n.refsByLowerCaseName);a.delete(i),a.set(l,t);const c=new Map(n.sheetsByLowerCaseName);let u=c.get(i);c.delete(i),c.set(l,u);const d=new Map(n.refsByInstance);return d.set(u,t),this._updateState({refsById:o,refsByLowerCaseName:a,sheetsByLowerCaseName:c,refsByInstance:d}),t}_setSheetName(e,t){if(this._closed)throw new Error(pn);if(!this.getProtection().isStructureAllowed())throw new Pe(po);const n=this._getSheetRef(e);if(!n)throw new Pe(zu(e));if(t===n.name)return n.sheet;t=this._validateNewSheetName(t);const r=Object.freeze({...n,name:t});let o=null;const i=this.beginCommit("Rename Sheet");try{const l=this._updateSheetRef(n,r);this._adjustSheetNamesIfRequired(),this._sheetOnNameChange.forEach((a,c)=>{n.id===c&&a()}),this._emitter.notify("onSheetsChange"),n.id===this.getView().getActiveSheetId()&&this._emitter.notify("onSelectionChange"),o=l.sheet,i.commit()}catch(l){throw i.rollback(),l}return o}_setSheetVisibility(e,t=ht.Visibility.Visible){if(this._closed)throw new Error(pn);if(!this.getProtection().isStructureAllowed())throw new Pe(po);const n=this._getSheetRef(e,ht.Visibility.VeryHidden);if(!n)return null;if(t===n.visibility)return;let r=null,o="";t===ht.Visibility.Visible?o="Unhide Sheet":t===ht.Visibility.Hidden?o="Hide Sheet":t===ht.Visibility.VeryHidden&&(o="Very Hide Sheet");const i=this.beginCommit(o);try{const l=this._getState().sheetRefsVisible;if(t!==ht.Visibility.Visible&&l.length===1&&l[0].id===n.id)throw new Pe(Pu);const a={...n,visibility:t};let c=-1;t!==ht.Visibility.Visible&&(c=this._findOffsetForId(n.id,l));const u=this._updateSheetRef(n,a);t!==ht.Visibility.Visible&&this._adjustRemoveSelectionIfRequired(c,n.id),r=u.sheet,this._adjustSheetNamesIfRequired(),i.commit()}catch(l){throw i.rollback(),l}return this._sheetOnVisibilityChange.forEach((l,a)=>{n.id===a&&l()}),this._emitter.notify("onSheetsChange"),r}_moveSheet(e,t){if(this._closed)throw new Error(pn);if(!this.getProtection().isStructureAllowed())throw new Pe(po);let n=null;const r=this.beginCommit(`Move Sheet '${e.name}'`);try{const o=this._getState(),i=o.sheetRefsVisible;if(t<0||t>i.length-1)throw new Pe(`Invalid to index: ${t}`);const l={view:this.getView(),activeSheetId:this.getView().getActiveSheetId()},a=o.sheetRefsAll,c=this._findOffsetForId(e.id,a),u=this._findOffsetForId(i[t].id,a);if(c===u)return;const d=a[c];let h=[...a];h.splice(c,1),h.splice(u,0,d),this._updateSheetRefStates(h),this._adjustSheetNamesIfRequired(),this._sheetOnIndexChange.forEach((f,g)=>{g>=c&&g<=u&&f()}),this._emitter.notify("onSheetsChange"),n=d.sheet,r.commit({viewBefore:l,viewAfter:{view:this.getView(),activeSheetId:this.getView().getActiveSheetId()}})}catch(o){throw r.rollback(),o}return n}_setSelectedSheet(e){if(this._closed)throw new Error(pn);const t=this._getSheetRef(e);if(!t)throw new Pe(zu(e));let n=null;return t.visibility!==ht.Visibility.Visible&&this._setSheetVisibility(t,ht.Visibility.Visible),this._view.setActiveSheetId(t.id),n=t.sheet,n}getProtection(){return this._protection}getNames(){return this._names}getCalculation(){return this._calculation}getScripts(){return this._scripts??null}_notifyAllChange(){this._emitter.notify("onSheetsChange"),this._emitter.notify("onViewChange")}addListeners(e,t){return this._emitter.addListeners(e,t)}_sheetToWBEvent(e){const t=this;return n=>{const r=()=>{const i=n.getSource();if(i.isICellRanges){const l=[...i.getCoords()],a=l.length;for(let c=0;c<a;c++){const u=l[c];!u.sheetName&&i.getSheet().getName()&&(l[c]={...u,sheetName:i.getSheet().getName()})}return t.getRanges(l)}if(i.isICellRange){const l=i.getCoords(),a=i.getSheet().getName();return t.getRange({...l,sheetName:a})}},o={getSource:r,trigger:n.trigger,getFrom:()=>t.getRanges(n.getFrom()),getTo:()=>t.getRange(n.getTo()),isDataChange:n.isDataChange,isTransactional:n.isTransactional,isUndo:n.isUndo,toString:()=>`WorkbookRangeEvent: ('${n.trigger}', ${r().toString()})`,timeStamp:Date.now()};e(o)}}_fromJSON(e){if(this._emitter.notify("onBeforeLoad",{params:e}),this._initState(),!e.sheets||e.sheets.length===0)throw new Pe(Pu);e.theme&&(this._theme=new ld(e.theme),this._styles.setTheme(this._theme));const t=this._strings.beginPersist(),n=this._resources.beginPersist(),r=this._styles.beginPersist();try{t.fromJSON(e.strings),n.fromJSON(e.resources),r.fromJSON(e.styles),e.date1904&&(this._isDate1904=!0),e.view||(e.view={});const o=e.sheets,i=o.length;let l=e.view.activeSheetId??null;l!==null&&(l=Math.min(Math.max(1,l),i));let a=null;for(let u=0;u<i;u++){const d=o[u],h=d.visibility||ht.Visibility.Visible,f=u+1;h===ht.Visibility.Visible?a=f:l!==null&&l===f&&(l=null),this._createSheet(f,d.name,h,void 0,d.sheet)}this._updateState({lastId:a}),e.names&&this._names.fromJSON(e.names),e.view.activeSheetId=l??a,this.setView(new Wm({json:e.view})),this._adjustSheetNamesIfRequired(),this._listenerProtection?.();const c=this;this._protection=new Gm(e?.protection,this._options?.readonly),this._listenerProtection=this._protection.addListeners({onChange:u=>{c._emitter.notify("onProtectionChange",{source:u})}}),e.scripts&&(this._scripts=this._createScripts(e.scripts)),this._emitter.notify("onLoad")}finally{r.endPersist(),n.endPersist(),t.endPersist()}}_createScripts(e){const t=this;return new Ax({transactions:this._transactions,json:e,workbook:t,getBuiltInFunctions:()=>t._calculation?.getFunctions(),onAdd:(n,r)=>{const o=t._calculation;o.getStatus()!==Kt.Status.Off&&o.start().then(()=>{const i=r.getFunctions().getItems({type:"formula"}),l=i.length;for(let a=0;a<l;a++){const c=i[a];this._calculation.getFunctions().add(c)}})},onRemove:(n,r)=>{}})}async toJSON(e=!1){if(this._closed)throw new Error(pn);await this._emitter.notify("onBeforeSave",{async:!0});const t={sheets:[]};await Promise.resolve(this._starting);const n=this._theme.toJSON();(n?Object.keys(n).length:0)>0&&(t.theme=n);const r=this._strings.beginPersist(),o=this._resources.beginPersist(),i=this._styles.beginPersist();try{const l=this._getSheetRef(this.getSelectedSheetIndex()).id;let a=l,c=null;const u=this._getState(),d=u.sheetRefsAll,h=u.sheetsById,f=d.length;for(let C=0;C<f;C++){const _=d[C],y=C+1,v=await h.get(_.id).toJSON(e),x={name:_.name,sheet:v};_.visibility===ht.Visibility.Visible?c=y:x.visibility=_.visibility,_.id===l&&(a=y),t.sheets.push(x)}const g=i.toJSON();g&&Object.keys(g).length>0&&(t.styles=g);const m=this.getProtection().toJSON();m&&(t.protection=m);const p=await r.toJSONAsync();p&&p.length>0&&(t.strings=p);const S=await o.toJSONAsync();S&&S.length>0&&(t.resources=S);const w=this._names.toJSON();w&&w.length>0&&(t.names=w);const b=this._view.toJSON();b&&(a!==c?b.activeSheetId=a:delete b.activeSheetId,Object.keys(b).length>0&&(t.view=b))}finally{i.endPersist(),o.endPersist(),r.endPersist()}if(this._scripts){const l=this._scripts.toJSON();l&&Object.keys(l).length>0&&(t.scripts=l)}return this._isDate1904&&(t.date1904=!0),this._emitter.notify("onSave",{params:t}),t}isClosed(){return this._closed}close(){if(this._closed)return;this._emitter.notify("onClose");const e=this._getState();e.listenersSheets.forEach(n=>{n()}),e.listenersSheets.clear();const t=e.sheetRefsAll;for(let n=t.length-1;n>=0;n--)try{t[n].sheet.close()}catch(r){console.warn("error on close",r)}this._ownResources,this._ownNames&&this._names.close(),this._ownsCalculation&&this._calculation.close(),this._ownStyles,this._transactionsRemoveListener?.(),this._closed=!0}beginCommit(e){if(this._closed)throw new Error(pn);return this._beginCommit(typeof e=="string"?{description:e}:e)}doBatch(e,t){const n=this;return t=typeof t=="string"?{description:t}:{description:"Update Workbook",...t},this._transactions.doBatch(e,t,(r,o)=>{r.getDepth()===0&&(n._lastTransactionUUID=r.getId())})}_beginCommit(e){const t=this;return this._transactions.beginCommit(typeof e=="string"?{description:e}:e,n=>{n.getDepth()===0&&(t._lastTransactionUUID=n.getId())})}_getState(){return this._transactions.getState(this)}_updateState(e,t="Update Workbook"){if(!e)return;const n=this._beginCommit(t);try{n.updateState(this,e),n.commit()}catch(r){throw n.rollback(),r}}get options(){return this._options}get[Symbol.toStringTag](){return"[Workbook]"}toString(){return this._getState().name??""}get isIWorkbook(){return!0}}const Yo={address:null,scope:null};(function(){try{if(typeof document<"u"){var s=document.createElement("style");s.appendChild(document.createTextNode(`._sheetxl-sheet_1qeq6_5 ._viewport-overlay_1qeq6_6{pointer-events:none}._sheetxl-sheet_1qeq6_5 ._viewport-overlay_1qeq6_6 *{pointer-events:initial}._sheetxl-sheet_1qeq6_5 .cell-container>*{overflow:hidden}._sheetxl-sheet_1qeq6_5 .cell-container .text-box{position:absolute}._sheetxl-sheet_1qeq6_5 .cell-container .text-line{text-rendering:optimizespeed;position:absolute;vertical-align:baseline;white-space:pre}._sheetxl-sheet_1qeq6_5 .cell-container .filter-button{position:absolute;display:flex;align-items:center;justify-content:center;flex-direction:row;margin-bottom:4px}._sheetxl-sheet_1qeq6_5 .cell-container .text-debug-bounds{position:absolute;background:green;pointer-events:none;opacity:.2}._sheetxl-sheet_1qeq6_5 .cell-container .fill{position:absolute}._sheetxl-sheet_1qeq6_5 .cell-container .pending{width:6px;height:6px;top:5px;left:4px;position:absolute;border:var(--sxl-app-color-primary-dark, grey) .5px;border-style:double;border-radius:50%;background-color:var(--sxl-app-color-button-surface, grey);opacity:1;animation:_pulse_1qeq6_1 1.5s infinite alternate}@keyframes _pulse_1qeq6_1{0%{transform:scale(1);opacity:1}50%{transform:scale(1.2);opacity:.8}to{transform:scale(1);opacity:1}}._sheetxl-sheet_1qeq6_5 .cell-container .slider{position:absolute;width:130%;height:2px;bottom:1px;opacity:0;animation:_fadeIn_1qeq6_1 0s .5s forwards;overflow-x:hidden}._sheetxl-sheet_1qeq6_5 .cell-container .line{position:absolute;opacity:.3;background:var(--sxl-app-color-primary-light, rgb(173, 173, 173)) .5px;width:100%;height:2px}._sheetxl-sheet_1qeq6_5 .cell-container .subline{position:absolute;background:var(--sxl-app-color-primary, rgb(77, 77, 77)) .5px;opacity:.9;height:3px}._sheetxl-sheet_1qeq6_5 .cell-container .inc{animation-delay:0s;animation:_increase_1qeq6_1 3s infinite}@keyframes _fadeIn_1qeq6_1{0%{opacity:0;height:0px}to{opacity:1;height:2px}}@keyframes _increase_1qeq6_1{0%{left:-150%;width:30%;animation-timing-function:ease}to{left:100%;width:30%}}._TaskPaneArea_6dmgk_5{position:absolute;height:100%;width:100%;display:flex;flex-direction:row}._TaskPaneTitle_6dmgk_13{display:flex;box-sizing:border-box;flex:1 1 0;flex-direction:row;align-items:center;font-size:1.25rem;height:100%;width:100%;padding:8px 16px;border-bottom:solid rgba(0,0,0,.2) 1px}._TaskPaneTitle_6dmgk_13 .title{opacity:.87}._TaskPaneTitle_6dmgk_13.focused .title{opacity:1}._TaskPaneFrame_6dmgk_36{display:flex;position:relative;flex-direction:column;width:100%;box-sizing:border-box;flex:1 1 0;min-height:0;align-items:stretch;justify-content:stretch;margin-bottom:4px;border-radius:4px;overflow:hidden}._TaskPaneStrip_6dmgk_52{display:flex;flex-direction:column;gap:4px;margin-top:4px;margin-left:2px}._TaskPaneStripItem_6dmgk_60{display:flex;flex-direction:row;align-items:center;padding:4px;border-radius:4px;border:grey solid 1px}._TaskPaneStripItem_6dmgk_60.selected{font-weight:700}._sheet-scrollbar_104cg_1{margin-left:2px;margin-bottom:1px;align-items:center}._sheet-selection_12wyx_5 .fill-handle .dragging,._movable-area_314c6_5 .moveable-control-box .dragging{opacity:0}._movable-area_314c6_5 .moveable-control-box .moveable-control{width:11px;height:11px;margin-top:-5.5px;margin-left:-5.5px;background-color:var(--sxl-app-color-background, white);background-image:var(--sxl-app-image-background);border:2px solid var(--sxl-app-color-primary-dark, grey)}._movable-area_314c6_5 .moveable-control-box .moveable-line{background:var(--sxl-app-color-grey, grey)}@media (pointer: coarse){._movable-area_314c6_5 .moveable-control-box .moveable-control{width:22px;height:22px;margin-top:-11px;margin-left:-11px}}._editable-input_1bqx6_6{position:absolute;left:0;top:0;width:100%;min-height:calc(100% + 1px);border:none;padding:0;outline:none;color:inherit;font-family:inherit;font-size:inherit;font-weight:inherit;line-height:1.2;letter-spacing:inherit;text-transform:inherit;background:transparent}@keyframes _pop_1wyun_1{0%{transform:scale(1)}to{transform:scale(var(--scale))}}@keyframes _fadeIn_1wyun_33{0%{opacity:0}to{opacity:1}}._Wrapper_1wyun_25{display:flex;box-sizing:border-box;transform:translate3d(var(--translate-x, 0),var(--translate-y, 0),0) scaleX(var(--scale-x, 1)) scaleY(var(--scale-y, 1));transform-origin:0 0;touch-action:manipulation}._Wrapper_1wyun_25._dragOverlay_1wyun_37{z-index:999}._Item_1wyun_47{position:relative;display:flex;align-items:center;outline:none;box-sizing:border-box;transform-origin:50% 50%;-webkit-tap-highlight-color:transparent;transform:scale(var(--scale, 1))}._Item_1wyun_47:not(._withHandle_1wyun_61){touch-action:manipulation}._Item_1wyun_47._dragging_1wyun_66:not(._dragOverlay_1wyun_37){z-index:999}._Item_1wyun_47._dragOverlay_1wyun_37{cursor:inherit;animation:_pop_1wyun_1 .2s cubic-bezier(.18,.67,.6,1.22);transform:scale(var(--scale));opacity:1}._Row_1kr10_1{display:flex;box-sizing:border-box}._TabStrip_3x0dp_1::-webkit-scrollbar{display:none;height:0px}._TabStrip_3x0dp_1{overflow-y:auto;overflow-x:hidden;position:relative}._script-editor_iy654_5 .monaco-editor{position:absolute}._script-editor_iy654_5 .monaco-editor .margin-icon{display:block;width:16px;height:16px;background-size:16px;background-repeat:no-repeat;background-position:center;background-size:contain}._script-editor_iy654_5 .monaco-editor .formula{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="grey"><path d="m 12.106007,8.1692949 c 0.124174,-0.1578352 0.181773,-0.3565642 0.283755,-0.5271169 0.10273,-0.1715492 0.04413,-0.2027176 -0.129161,-0.2014713 -0.685452,0.00576 -1.371152,-0.00277 -2.056604,0.00501 C 10.021228,7.4479573 9.9586414,7.407817 9.9935503,7.2080883 10.145401,6.3413623 10.291269,5.4736396 10.51219,4.6213758 10.642847,4.1167002 10.782479,3.6117747 11.061498,3.1622046 11.339518,2.7138809 11.726751,2.5974365 12.2035,2.829328 c 0.398455,0.1934923 0.722604,0.4827333 0.990152,0.8340617 0.116944,0.1535968 0.27079,0.2740306 0.449073,0.1715499 0.343348,-0.1974819 0.644807,-0.4383502 0.819599,-0.826332 0.100985,-0.2244112 0.157836,-0.476001 0.04039,-0.7058977 C 14.339646,1.9840253 14.038187,1.7618584 13.707056,1.6394296 13.156999,1.4362128 12.562559,1.4840872 12.017239,1.6758341 11.38789,1.8970037 10.783727,2.2625445 10.259602,2.6724688 10.066109,2.8238217 9.8783519,2.9839017 9.7013165,3.1547035 9.0502751,3.7823067 8.5657962,4.529097 8.2246919,5.3651534 7.9823276,5.9595939 7.7888351,6.5660026 7.6913412,7.2015842 7.673637,7.318528 7.6357391,7.423253 7.5065759,7.4432009 7.3472438,7.4678879 7.1592376,7.4436995 6.9974121,7.4441728 6.6351128,7.4451447 6.2598478,7.3676233 5.9915515,7.6815496 5.8721151,7.8211835 5.7461952,7.9840062 5.6439635,8.1371045 c -0.1009847,0.1518511 -0.093255,0.3002122 0.085027,0.367535 0.1957362,0.073561 0.4528118,0.026182 0.6530361,0.0197 0.2645558,-0.00847 0.5291116,0.00501 0.7936674,-7.476e-4 0.1820229,-0.00374 0.2413669,0.030421 0.2064588,0.2358807 C 7.3487406,8.9587006 7.3095941,9.1492003 7.2804197,9.3464333 7.1804317,10.024404 7.0667304,10.700629 6.9525298,11.376606 6.7936963,12.314146 6.6371075,13.252434 6.4655575,14.188478 6.3017374,15.082631 6.1855427,15.985013 5.983074,16.873433 5.8249883,17.568607 5.7240037,18.277248 5.5556954,18.969682 5.4145655,19.550158 5.293882,20.143601 4.9722259,20.665731 4.7380909,21.045734 4.3959882,21.206312 3.9663652,21.104829 3.5778849,21.012322 3.2115961,20.866205 2.8951763,20.608631 2.6862246,20.438328 2.4473513,20.31141 2.1920214,20.458026 1.9519014,20.595915 1.7791048,20.851743 1.646453,21.088123 1.2205704,21.847879 1.915497,22.569984 2.6655289,22.684434 3.1692071,22.760986 3.666153,22.580208 4.1087416,22.356046 4.6996913,22.056582 5.2103511,21.635437 5.6387269,21.13874 5.9898058,20.731558 6.3575906,20.343327 6.6500737,19.890016 6.8450616,19.58756 7.0238427,19.274881 7.1866655,18.954471 7.7639005,17.817206 8.1227091,16.589926 8.4189318,15.354418 8.5613081,14.760227 8.716401,14.169777 8.8478064,13.572843 9.0268365,12.760724 9.1741996,11.934891 9.3083481,11.114294 9.3749255,10.707112 9.4310263,10.300679 9.5160532,9.8967389 9.5861222,9.5636133 9.6442168,9.2185186 9.6890985,8.8814035 9.7414633,8.4891827 9.990308,8.5136187 10.329668,8.4762164 c 0.286249,-0.03167 0.574492,-0.046376 0.861739,-0.067571 0.230395,-0.016703 0.494951,0.00396 0.711881,-0.088019 0.07754,-0.032911 0.147613,-0.080788 0.202719,-0.1513533 z"/><path d="M 22.473802,7.8481382 C 22.426924,7.6912996 22.341898,7.5501696 22.231437,7.4294861 22.130452,7.3192756 21.987827,7.1749046 21.851933,7.1098255 21.411589,6.8988785 20.817398,7.0838898 20.436149,7.3422154 20.23343,7.479854 20.052405,7.6519026 19.871131,7.8167201 19.691352,7.9802913 19.517061,8.1488492 19.35723,8.3321177 19.025101,8.7128687 18.724639,9.1210479 18.436396,9.5354601 18.296263,9.7374301 17.901549,10.472252 17.781115,10.399942 17.654198,10.323892 17.495365,9.5905657 17.435023,9.3843566 17.351243,9.0978583 17.29539,8.8016361 17.161741,8.5323425 16.97922,8.1643081 16.865268,7.7623629 16.608941,7.4307332 16.325934,7.0639457 16.001036,6.9584722 15.558946,7.092371 c -0.43436,0.1314054 -0.78469,0.4049374 -1.128539,0.6819608 -0.503927,0.4056851 -0.879442,0.926319 -1.256951,1.4439609 -0.28226,0.387483 -0.284753,0.3857373 0.04488,0.7380631 0.206458,0.2211702 0.202718,0.2184272 0.389229,-0.00847 0.2663,-0.3251469 0.524872,-0.6595196 0.882433,-0.8934057 0.261315,-0.1713009 0.417904,-0.1368908 0.57948,0.1326518 0.07929,0.1326517 0.146866,0.2752777 0.200225,0.4208957 0.335619,0.9141014 0.590201,1.8541344 0.89191,2.7784594 0.03815,0.117691 -0.01122,0.193991 -0.06707,0.278519 -0.356565,0.538837 -0.719363,1.074182 -1.123054,1.578607 -0.320409,0.401198 -0.643312,0.803891 -1.073932,1.097621 -0.187757,0.128912 -0.40768,0.217679 -0.635831,0.156839 -0.233887,-0.06283 -0.37377,-0.27478 -0.587459,-0.373521 -0.006,-0.003 -0.01272,-0.0052 -0.01895,-0.0079 -0.09974,-0.04064 -0.249845,-0.0389 -0.353074,-0.01571 -0.454059,0.102482 -0.697669,0.614139 -0.790177,1.023813 -0.08379,0.371776 -0.0013,0.778209 0.261315,1.062463 0.228899,0.24785 0.572248,0.351327 0.901634,0.356315 0.189003,0.0028 0.39995,-0.04663 0.57549,-0.11445 0.670241,-0.262062 1.181649,-0.887172 1.605038,-1.441717 0.285501,-0.374517 0.550555,-0.763994 0.829573,-1.143499 0.230645,-0.313677 0.68595,-1.247726 0.81586,-1.250718 0.07854,-0.0017 0.09924,0.185762 0.114199,0.241117 0.03341,0.123675 0.06658,0.247351 0.102232,0.370279 0.167561,0.578481 0.343848,1.156464 0.525122,1.730458 0.120934,0.384242 0.315921,0.782697 0.560779,1.103356 0.07431,0.09749 0.167311,0.190749 0.26306,0.266799 0.371276,0.296972 0.838799,0.27453 1.266177,0.123177 0.191498,-0.06757 0.370029,-0.163071 0.539335,-0.275527 0.781948,-0.519886 1.340732,-1.244235 1.868598,-2.002495 0.124423,-0.178781 0.107467,-0.278769 -0.03441,-0.428127 -0.367286,-0.386237 -0.357062,-0.389727 -0.705149,0.01995 -0.261066,0.306446 -0.527117,0.612643 -0.879442,0.818851 -0.245855,0.144621 -0.413416,0.103229 -0.592696,-0.118439 -0.14861,-0.183518 -0.246353,-0.396709 -0.33138,-0.614886 -0.349831,-0.901136 -0.588954,-1.838675 -0.885177,-2.757515 -0.21743,-0.674231 -0.223414,-0.680464 0.20945,-1.248723 0.447575,-0.587708 0.875703,-1.1968602 1.462163,-1.6613914 0.431119,-0.3416031 0.73183,-0.3226534 1.129037,0.059094 0.0788,0.075801 0.207456,0.1388856 0.316919,0.1476127 0.369781,0.029674 0.691187,-0.3024566 0.880939,-0.5792304 0.188006,-0.2727835 0.259319,-0.6183768 0.163072,-0.9392845 z"/></svg>');cursor:pointer}._script-editor_iy654_5 .monaco-editor .macro{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="grey"><path d="M 5.1933594,1.4433594 6.3417969,2.5234375 6.2109375,2.6621094 c -3.466072,3.6769426 -3.467641,9.6565186 0,13.3339846 l 0.1308594,0.136718 -1.1484375,1.082032 -0.1328125,-0.140625 c -4.0371886,-4.28224 -4.0373752,-11.2077961 0,-15.4902346 z m 14.4726566,0 0.132812,0.140625 c 4.03717,4.2822197 4.037356,11.2058636 0,15.4882816 l -0.132812,0.140625 -1.148438,-1.080079 0.130859,-0.138671 c 3.465532,-3.675243 3.466902,-9.6542123 0,-13.3320316 L 18.517578,2.5234375 Z M 7.7597656,4.4335937 8.8769531,5.5488281 8.7421875,5.6816406 c -2.0366665,2.0366662 -2.037411,5.3404354 0,7.3769534 L 8.8769531,13.191406 7.7597656,14.310547 7.625,14.173828 C 4.9718615,11.520692 4.9723209,7.222936 7.6269531,4.5683594 Z m 9.3398434,0 0.132813,0.1347657 c 2.653779,2.6537788 2.65545,6.9500666 0,9.6054686 l -0.132813,0.136719 -1.117187,-1.119141 0.134765,-0.132812 c 2.036637,-2.035554 2.037534,-5.3391996 0,-7.3769534 L 15.982422,5.5488281 Z m -4.669921,1.7011719 c 0.811773,0 1.627703,0.304374 2.25,0.90625 1.260638,1.2198223 1.260413,3.1986104 0,4.4179684 -0.355144,0.343115 -0.779063,0.585007 -1.226563,0.732422 l -0.234375,0.07617 v 3.386719 h 0.002 v 6.048828 c 0,0.436615 -0.351565,0.791016 -0.789062,0.791016 -0.43763,0 -0.791016,-0.354618 -0.791016,-0.791016 v -3.308594 -6.126953 l -0.234375,-0.07617 c -0.448339,-0.147699 -0.871819,-0.38969 -1.226562,-0.732422 -1.2608671,-1.22004 -1.2605877,-3.1984433 0,-4.4179684 0.62227,-0.6019293 1.438264,-0.90625 2.25,-0.90625 z m 0,1.5820313 c -0.417461,0 -0.829931,0.1510762 -1.146485,0.4570312 -0.615751,0.5967629 -0.616877,1.5583713 0,2.1562499 0.314469,0.303373 0.726552,0.455078 1.146485,0.455078 0.421182,0 0.833304,-0.153008 1.148437,-0.457031 0.61548,-0.5965047 0.616739,-1.5585025 0,-2.15625 C 13.261859,7.8661993 12.846121,7.7167969 12.429688,7.7167969 Z"/></svg>');cursor:pointer}._script-editor_iy654_5 .monaco-editor .autorun{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="grey"><path d="M10 15h5.88c.27-.31.67-.5 1.12-.5.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5c-.44 0-.84-.19-1.12-.5H11.9c-.46 2.28-2.48 4-4.9 4-2.76 0-5-2.24-5-5 0-2.42 1.72-4.44 4-4.9v2.07c-1.16.41-2 1.53-2 2.83 0 1.65 1.35 3 3 3s3-1.35 3-3zm2.5-11c1.65 0 3 1.35 3 3h2c0-2.76-2.24-5-5-5s-5 2.24-5 5c0 1.43.6 2.71 1.55 3.62l-2.35 3.9c-.68.14-1.2.75-1.2 1.48 0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5c0-.16-.02-.31-.07-.45l3.38-5.63C10.49 9.61 9.5 8.42 9.5 7c0-1.65 1.35-3 3-3m4.5 9c-.64 0-1.23.2-1.72.54l-3.05-5.07C11.53 8.35 11 7.74 11 7c0-.83.67-1.5 1.5-1.5S14 6.17 14 7c0 .15-.02.29-.06.43l2.19 3.65c.28-.05.57-.08.87-.08 2.76 0 5 2.24 5 5s-2.24 5-5 5c-1.85 0-3.47-1.01-4.33-2.5h2.67c.48.32 1.05.5 1.66.5 1.65 0 3-1.35 3-3s-1.35-3-3-3"/></svg>');cursor:pointer}`)),document.head.appendChild(s)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();/**
 * @license @sheetxl/react - React - React components needed to build advanced grid and spreadsheet UIs. - v0.7.26
 *
 * (C) 2025-present SheetXL Inc. & Michael T. Ford
 * License: The license can be found at https://www.sheetxl.com/license.
 */const Jm=M.memo(s=>{const{anchorLocation:e=Et.TopLeft,cellWidth:t,cellHeight:n,size:r=7,inset:o=1,darkMode:i,fill:l,propsPath:a,style:c,...u}=s,d=r,h=o;let f="red",g=[],m=[];return e===Et.TopLeft?(f=i?"rgb(255, 198, 246)":"green",g.push(h),m.push(h),g.push(h+d),m.push(h),g.push(h),m.push(h+d)):e===Et.TopRight?(f=i?"rgb(0, 255, 255)":"red",g.push(t-h),m.push(h),g.push(t-(h+d)),m.push(h),g.push(t-h),m.push(h+d)):e===Et.BottomRight?(f=i?"rgb(236, 252, 211)":"purple",g.push(t-h),m.push(n-h),g.push(t-(h+d)),m.push(n-h),g.push(t-h),m.push(n-(h+d))):e===Et.BottomLeft&&(f=i?"rgb(255, 236, 183)":"blue",g.push(h),m.push(n-h),g.push(h+d),m.push(n-h),g.push(h),m.push(n-(h+d))),pe.jsx("svg",{width:`${t}`,height:`${n}`,viewBox:`0 0 ${t} ${n}`,style:{position:"absolute",width:`${t}px`,height:`${n}px`,pointerEvents:"none",...c},...u,children:pe.jsx("path",{d:`M ${g[0]} ${m[0]} L ${g[1]} ${m[1]} L ${g[2]} ${m[2]} L ${g[0]} ${m[0]} Z`,fill:l??f,...a})})}),Dx=s=>{const{renderBounds:e,darkMode:t,zoom:n,disabled:r,filter:o,onFilterButtonMouseDown:i,style:l,...a}=s,c=M.useMemo(()=>{let f=null;const g=o.getSortField();g&&(f=g.reverse);const m=o.getField(),p=m&&m.criteria&&m.criteria.length>0;return f===!0?p?"m 9.429858,10.25386 2,-1 v -3 l 3,-4 h -8 l 3,4 z M 5.849492,9.452298 H 4.24187 V 2.0761788 H 3.170122 V 9.452298 H 1.5625 l 2.143496,2.950446 z":"m 13.109228,9.865914 h -1.607622 v -7.37612 h -1.071748 v 7.37612 H 8.822236 l 2.143496,2.950446 z M 0.75000004,9.15 4.3000002,13.094444 7.8500003,9.15 Z":f===!1?p?"m 9.429858,10.25386 2,-1 v -3 l 3,-4 h -8 l 3,4 z M 5.849492,5.0266248 H 4.24187 V 12.402744 H 3.170122 V 5.0266248 H 1.5625 l 2.143496,-2.950446 z":"m 13.109228,5.44024 h -1.607622 v 7.37612 H 10.429858 V 5.44024 H 8.822236 L 10.965732,2.489794 Z M 0.75000004,9.15 4.3000002,13.094444 7.8500003,9.15 Z":p?"m 9.429858,10.25386 2,-1 v -3 l 3,-4 h -8 l 3,4 z M 0.75000004,9.15 4.3000002,13.094444 7.8500003,9.15 Z":"M 7.4530672,10.134098 2.6725085,5.2978998 3.370275,4.5911648 7.4530672,8.7264777 11.530095,4.5911648 l 0.697764,0.706735M 7.4529247,10.134098 2.9086709,5.2978998 3.5719465,4.5911648 7.4529247,8.7264777 11.328423,4.5911648 l 0.663274,0.70673"},[o]),[u,d]=M.useState(!1),h=Math.min(Math.min(18,e.height-8),e.width);return pe.jsx("div",{style:{width:`${h}px`,height:`${h}px`,right:"0px",boxShadow:`0px 0px 0px 0.5px var(${u&&!r?"--sxl-app-color-primary-light, rgba(0,0,0,.55)":"--sxl-app-color-border-button, grey"})`,backgroundColor:"var(--sxl-app-color-button-fill, white)",backgroundImage:"var(--sxl-app-image-background)",borderRadius:(h>12?1:0)+"px",marginRight:"2px",display:"flex",alignItems:"center",justifyContent:"center",cursor:r?void 0:"pointer",...l},onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),onMouseDown:f=>{i?.(f,o),f.preventDefault()},...a,children:pe.jsx("svg",{width:""+15*n,height:""+15*n,viewBox:"0 0 15 15",style:{fill:`var(${u&&!r?"--sxl-app-color-primary-dark":"--sxl-app-color-button-text"}, grey)`,opacity:r?.6:1},children:pe.jsx("path",{d:c})})})},Lx=s=>{const{value:e,coords:t,bounds:n,children:r,style:o,range:i,zoom:l=1,view:a,bodyStyle:c,normalStyle:u,showFormulas:d,showZeros:h,docTheme:f,onLinkMouseDown:g,onFilterButtonMouseDown:m,propsFilterButton:p,renderFilterButton:S=Dx,...w}=s,b=n.height/l,C=n.width/l,_=e,y=_.getValue(),v=e.getStyle(),x=c?.darkMode??!1;let E,R;const I=y&&y.isFormulaError,A=I&&y instanceof $e.Parse;let T,O=d||A;if(O)if(_.isSpillOverflow())R="";else{const Ee=_.getFormulaText();Ee?R=Ee:E=_.getNumberFormat(Ut.Type.General)}else E=_.getNumberFormat();O||(T=_.getTextOverflow());const N=T?T.colBounds.width+T.leftOffset+T.rightOffset:C,D=T?T.anchorBounds.x-T.leftOffset:0,F=T?T.anchorBounds.width:C,k=T?T.anchorBounds.x:0;let L,W=_.getRenderHorizontalAlignment();E&&(L=E?.formattedRuns,R=L?.runs[0]?.text??E.displayText);const $=_.getCalcStatus()===ut.CalcStatus.Pending;let J=null,te=v.getFill().toCSS(x,n),Q=0,G=0;if(!v.getBorder().isEmpty()){const Ee=v.getBorder().getRight();!Ee.isNone()&&Ce.BuiltInDefinitions.get(Ee.getStyle()).width>1&&(Q=1);const K=v.getBorder().getBottom();!K.isNone()&&Ce.BuiltInDefinitions.get(K.getStyle()).width>1&&(G=1)}let ee=null;if(C!==F||Q||G||typeof te?.backgroundPosition=="number"){const{backgroundPosition:Ee,...K}=te,le=Ee??0,X=a?.getScrollTopLeft(),ae=le?-(n.x+(X.left??0))%le:0,Ie=le?-(n.y+(X.top??0))%le:0;(Ee!==void 0||Q||G||C!==F)&&(Object.keys(K).length===1&&K.background==="none"||(te=null,ee=pe.jsx("div",{className:"fill",style:{marginLeft:`${ae}px`,marginTop:`${Ie}px`,left:k*l,width:St.boundPixel(F*l-ae+1+Q),height:St.boundPixel(n.height-Ie+1+G),...K}},"background")))}let ne=null;const re=_.getComments(),U=_.getWarnings(),ue=_.getErrors();if(re||I||ue.length>0||U.length>0){const Ee={size:7*l,darkMode:x,cellWidth:F*l+2,cellHeight:b*l+2,style:{top:-1,left:k*l-1}};ne=ne??[],(U.length>0||ue.length>0||I)&&ne.push(pe.jsx(Jm,{anchorLocation:Et.TopLeft,...Ee},`indicator-${ne.length}`)),re&&ne.push(pe.jsx(Jm,{anchorLocation:Et.TopRight,...Ee},`indicator-${ne.length}`))}const oe=v.getFont();let Z=E?.conditionalColor;const Y=v.getAlignment(),we=Y.getHorizontal()===ce.HorizontalAlignment.Fill,ge=Y.getHorizontal()===ce.HorizontalAlignment.CenterContinuous||we,de=ge||O?0:Y.getRotation(),be=_.getInsets(),he=be.top+be.bottom;let fe=be.left,z=be.right;const Fe={...o,left:o.left-1,top:o.top-1,width:o.width+1+Q,height:o.height+1+G},De=_.getColumnFilter(),Ge=De&&!De?.hasHiddenButton();let H=null;$&&(H=pe.jsxs("div",{className:"slider",children:[pe.jsx("div",{className:"line"}),pe.jsx("div",{className:"subline inc"})]},"pending"));const ie=!($||Ge||ee||r||ne||L?.runs.length>1||T||de%360!=0);te?.background==="none"&&(te=null);let Se=ge||!(!T||!(T.rightIndex>0||T.leftIndex>0||T.colSpan>1));if(!Se){const Ee=_.getSpans();(Ee.width>1||Ee.height>1)&&(Se=!0)}const j={...te,...Fe,pointerEvents:g?"auto":void 0};if(!P.isEmpty(R)||!P.isEmpty(E?.repeatPlaceholder)){const Ee=E?.canWrap??!1;let K=null,le=null,X=null,ae=[],Ie=!0;h||O||y!==0||(Ie=!1);const ve=_.getTextFrame(O);if(Ie&&ve){let ze=N-1-(fe+z);if(de){K=ve.layout().bounds;const Ve={x:0,y:0,width:N-1,height:b};if(L){let et=L.width;if(E.repeatPlaceholder||E.repeatChars.length>0){const We=an.boundsToPoints(Ve),Xe=an.rotatePoints(We,-de);et=an.minBoundingRect(Xe).width}K={...K,width:et}}X=an.clipToOuterRect({...K,width:K.width+1+fe+z},Ve,de),ze=X.width-1-(fe+z)+.01}let _e=null;Ee&&(_e={width:ze});let Ne=null,me=E?.repeatPlaceholder;const Re=ve.layout(_e);if(K=Re.bounds,O?K={...K,width:0}:L&&(K={...K,width:E.repeatPlaceholder||E.repeatChars.length>0?ze:L.width}),de&&Ee){let Ve=null;Re.visitLines({visitTextLine:(et,We)=>{let Xe=et.bounds;const Ue=an.boundsToPoints(Xe),Ke=an.rotatePoints(Ue,de),Ze=an.minBoundingRect(Ke);Xe={...Xe,x:(Ze.width-Xe.width)/2,y:(Ze.height-Xe.height)/2},Ve=Ve?an.unionBounds(Ve,Xe):Xe}}),K={...Ve,width:Ve.width+fe+z}}if(!me&&_.getType()!==Le.String&&Math.floor(K.width)>ze){if(v.getNumberFormat()==="General"&&_.getType()===Le.Number){const Ve=v.measureText("0"),et=Math.floor(ze/Ve.width),We=y,Xe=P.splitNumber(We),Ue=Math.min(10,et-(Math.max(1,Xe.ipLength)+1)-(We<0?1:0));if(Ue>=-1){const Ke=`0${Ue>0?".":""}${"#".repeat(Math.max(0,Ue))}`;Ne=_.getNumberFormat(Ke).displayText,Ne==="0"&&We<0&&(Ne="-0")}else if(Math.abs(We)>=Math.pow(10,5)||Math.abs(We)<=Math.pow(10,-5)){const Ke=et-5-(We<0?1:0);if(Ke>=0){const Ze=`0.${"0".repeat(Math.max(0,Ke-1))}E+00`;Ne=_.getNumberFormat(Ze).displayText}}}Ne||(me="#")}if(!me&&L?.lastRepeatIndex>=0&&L?.width>ze&&(me="#"),me&&ze>0){const Ve=v.measureText(me),et=Math.floor((ze||1)/(Ve?.width||1));Ne=et>0?me.repeat(et):"",W=ce.HorizontalAlignment.Center}if(O&&(W=ce.HorizontalAlignment.Left),Ne){const Ve=v.measureText(Ne).width;Ve&&(K={...K,width:Ve})}if(le={...K,width:K.width+fe+z,height:K.height},de&&!Ee){const Ve=an.boundsToPoints(le),et=an.rotatePoints(Ve,de),We=an.minBoundingRect(et);le.width=We.width,le.height=We.height}W===ce.HorizontalAlignment.Center||W===ce.HorizontalAlignment.CenterContinuous?le.x=(N-le.width)/2:W===ce.HorizontalAlignment.Right?le.x=N-le.width-.5:le.x=.5,Y.getVertical()===ce.VerticalAlignment.Center?le.y=(b-le.height)/2:Y.getVertical()===ce.VerticalAlignment.Bottom?le.y=b-le.height-he:le.y=he;const Me=ie?{...w}:void 0,qe={style:{left:o.left-1,top:o.top-1,width:o.width+1,height:o.height+1,transform:de?`rotate(${de}deg)`:void 0,cursor:g?"pointer":void 0,pointerEvents:g?"auto":void 0,zIndex:Se?1:void 0,...te},onMouseDown:g,onDoubleClick:g?Ve=>{Ve.stopPropagation(),Ve.preventDefault()}:null,...Me};A&&(qe.style.textDecorationStyle="wavy",qe.style.textDecorationColor=x?"rgb(0, 255, 255)":"red",qe.style.textDecorationLine="underline");const nt=oe.getSize(),Ye=(Ve,et,We,Xe,Ue,Ke,Ze,wt=null)=>{let pt=nt*l,_t=We,jt=Ze?.runs?Ze.runs:[{type:Ut.ParseRunType.Text,text:Ve,width:v.measureText(Ve,pt).width}];Ze&&Ze?.width!==K.width&&(K={...K,width:Ze?.width});let Ot=fe;if(Ze?.lastRepeatIndex>=0&&ze>Ze?.width){const vt=Ze.runs[Ze.lastRepeatIndex];if(vt){const qt=[...jt],Fn=Math.max(0,ze-1-Ze.width);let $n=0,on="";if(Fn>0){const bn=Math.floor(Fn/vt.width);on=bn>0?vt.text.repeat(bn):"",$n=Fn}qt[Ze.lastRepeatIndex]={type:Ut.ParseRunType.Repeat,text:on,width:$n},jt=qt,K={...K,width:Ze.width+$n}}}const lt=(vt,qt,Fn,$n,on,bn,Vn,uc,Fs,Zi=null)=>{let Do,Lo=_t.width;Ue===ce.HorizontalAlignment.Justify?(Lo=on,Ke||(Do="justify")):Ue===ce.HorizontalAlignment.Distributed&&(Lo=on,Do=Ke||vt.text.split(" ").length-1==0?"center":"justify");const{style:$r,className:En,...Qi}=Zi;let Bo=vt.text;if(Ue===ce.HorizontalAlignment.Fill&&E?.repeatChars.length===0){const sn=Math.max(1,Math.floor((_t?.width??0)/(Vn?.width??1)));Bo=Bo.repeat(sn)}let ur=_t.height;const uo=oe.getVerticalAlignment(),Ns=uo===Be.VerticalAlignment.Sub,dc=uo===Be.VerticalAlignment.Super;if(Ns||dc){const sn=oe.getSuperSubScale();pt*=sn,ur*=sn}const At={textAlign:Do,textAlignLast:Do,...$r,...oe.toCSS(x,l,!0),fontSize:pt*Be.getDeviceScale()};ie||(At.background=void 0),Z&&(At.color=Z.toCSS(x));const Os=Ot+qt;let zo=be.top+_t.y+0;if(Ns&&(zo+=Fs-pt),bn){const sn=(Vn.x+Os)*l+1,Rn=(Vn.y+zo)*l+1;Rn<0?At.marginTop=Rn:At.paddingTop=Rn,sn<0?(At.width=($r?.width??0)-sn,At.left=($r?.left??0)+sn):At.paddingLeft=sn,At.paddingRight=Math.max(0,($r?.width??0)-Lo*l-sn),At.paddingBottom=Math.max(0,($r?.height??0)-_t.height*l-Rn),At.height=($r?.height??0)+(Rn<0?-Rn:0),(Rn<0||sn<0)&&(At.clipPath=`inset(${Rn<0?-Rn:0}px 0px 0px ${sn<0?1-sn:0}px)`)}else if(At.left=(Vn.x+Os)*l+1,At.top=(Vn.y+zo)*l+1,At.width=Vn.width*l,At.height=Vn.height*l,de&&!Ee){At.left=(Vn.x+qt)*l+1,At.top=(Vn.y+(_t.y+0))*l+1;const sn=an.centerPoint({x:Ot+qt,y:0,width:vt.width,height:_t.height}),Rn=an.centerPoint({x:Ot,y:0,width:on,height:_t.height}),el=an.rotatePoints([sn],de,Rn),Ds={x:el[0].x-sn.x,y:el[0].y-sn.y};At.left=At.left+Ds.x*l,At.top=At.top+Ds.y*l;const ho={..._t,x:Ot,y:be.top,width:_t.width+(fe+z)},hc=an.boundsToPoints(ho),gc=an.rotatePoints(hc,de),tl=an.minBoundingRect(gc);ho.width=tl.width,ho.height=tl.height;const Po=an.centerPoint(ho),nl={x:Po.x-Rn.x,y:Po.y-Rn.y};At.left=At.left+nl.x*l,At.top=At.top+nl.y*l}At.lineHeight=ur*l+"px";const Yi=ie?void 0:"text-line";ae.push(pe.jsx("div",{className:En?`${En} ${Yi}`:Yi,style:At,...Qi,children:Bo},`text-${_t.y}-${$n}-${Fn}`))};if(Y.getOverflow()===ce.Overflow.Shrink&&ze>0){let vt=K?.width??0,qt=0;for(;vt>1&&vt>ze&&pt>2&&qt<100;)pt*=ze/vt,vt=v.measureText(Ve,pt).width,qt++;K={...K,width:vt}}let Bt=_t.x;Ue===ce.HorizontalAlignment.Right?Bt+=K.width-_t.width:Ue!==ce.HorizontalAlignment.Center&&Ue!==ce.HorizontalAlignment.CenterContinuous||(Bt+=(K.width-_t.width)/2),Ze?.lastRepeatIndex>=0&&(Bt=_t.x);const zt=jt.length;for(let vt=0;vt<zt;vt++){const qt=jt[vt];(qt.type===Ut.ParseRunType.Text||qt.type===Ut.ParseRunType.Repeat)&&(qt.type,Ut.ParseRunType.Repeat,lt(qt,Bt,vt,et,Ue===ce.HorizontalAlignment.Justify||Ue===ce.HorizontalAlignment.Distributed||Ze?.lastRepeatIndex>=0?ze:_t.width,ie,{x:le.x+D,y:le.y,width:qt.width,height:K.height},0,Xe,wt)),Bt+=qt.width}};Ne?Ye(Ne,0,{x:0,y:0,...K},Re.lines[0].baseline,W,!0,null,qe):Re.visitLines({visitTextLine:(Ve,et,We)=>{const Xe=Ve.runs[0].text.replace(/\s+$/,""),Ue=et===We-1;let Ke=W===ce.HorizontalAlignment.Justify&&(Ue||Ve.runs[0].text.endsWith(`
`))?ce.HorizontalAlignment.Left:W,Ze=0;et>0&&(Y.getVertical()===ce.VerticalAlignment.Distributed||Y.getVertical()===ce.VerticalAlignment.Justify)&&(Ze=Math.max(0,(b-(he+3)-Ve.bounds.height*We)/(We-1)*et)),Y.getVertical()===ce.VerticalAlignment.Distributed&&de&&de%90==0&&de%180!=0&&(Ke=ce.HorizontalAlignment.Distributed),Ke!==ce.HorizontalAlignment.Justify&&Ke!==ce.HorizontalAlignment.Distributed&&Ke!==ce.HorizontalAlignment.Fill||(K={...K,width:ze});let wt=we||E&&(E.repeatChars.length>0||E.spacingChars.length>0)?K.width:Ve.bounds.width;const pt={...Ve.bounds,y:Ve.bounds.y+Ze+0,width:wt};Ye(Xe,et,pt,ve.lines[0].baseline,Ke,Ue,We===1?L:null,ie&&et>0?{...qe,style:{...qe.style,background:void 0}}:qe)}})}ae.length>0&&(J=ae)}if(ie)return J&&J.length>0?J:pe.jsx("div",{style:j,...w});let se=g?"auto":Fe.pointerEvents,ye=null;if(Ge){const Ee={x:k*l-1,y:-1,width:F*l+1,height:b*l+1};se="auto",ye=S({renderBounds:Ee,darkMode:x,className:"filter-button",disabled:!_.isEditAllowed(),zoom:l,filter:_.getColumnFilter(),onFilterButtonMouseDown:m,...p}),ye&&(ye=pe.jsx("div",{style:{...Ee,position:"absolute",zIndex:2,display:"flex",alignItems:"end"},onDoubleClick:K=>{K.stopPropagation(),K.preventDefault()},children:ye},"filterButton"))}$&&!J&&(J=pe.jsx("div",{style:{position:"absolute",left:0,right:0,top:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:"..."},"pending-ellipsis"));const xe=[ee,J,r,ne,H,ye];return pe.jsx("div",{style:{...te,...Fe,pointerEvents:se},...w,children:xe})},Km={text:"",placeholder:""},Xm=(s,e)=>{if(s.clean().getStyle().getNumberFormat().indexOf("%")===-1)return!1;const t=e??s.dirty??"";return t.length===0||t.endsWith("%")&&!isNaN(parseFloat(t.substring(0,t.length-1)))},Bx=Object.freeze([In.Delete,In.Home,In.End]),zx=M.memo(M.forwardRef((s,e)=>{const{editState:t,onStartEdit:n,onChangeEdit:r,onSubmitEdit:o,onCancelEdit:i,onDoneEdit:l,defaultTextStyle:a,useRichStyling:c=!0,bodyStyle:u,activeCoords:d,sheet:h,commands:f,containerBounds:g,setNaturalSize:m,onFocus:p,disabled:S,style:w,zoom:b=1,linesVisible:C,autoFocus:_=!1,...y}=s,{height:v=0,width:x=0}=g??{},E=u?.darkMode??!1,R=M.useRef(null),[I,A]=M.useState(!1),[T,O]=M.useState(null),[N,D]=M.useState(()=>t);M.useEffect(()=>{G.current=!1,D(t)},[t]);const F=M.useMemo(()=>{const K=N.clean();let le=K.getStyle();c||(le=le.createTemporaryStyle({font:{size:a?.fontSize}}));const X=K.getFormula(),ae=le.getAlignment(),Ie=X?ce.HorizontalAlignment.Left:ae.getHorizontal(),ve=ae.getVertical(),ze=ae.getOverflow()===ce.Overflow.Wrap||K.getType()===Le.String&&(Ie===ce.HorizontalAlignment.Justify||Ie===ce.HorizontalAlignment.Distributed||ve===ce.VerticalAlignment.Justify||ve===ce.VerticalAlignment.Distributed),_e=(Re=>{if(!Re)return Km;const Me=Re.clean();if(!Me)return Km;let qe=Me.getStyle()?.getQuotePrefix();if(Re.dirty===void 0||Re.dirty===null){let nt="",Ye=Me.getFormulaText();Ye&&(nt=Ye,qe=!1),nt||(nt=Me.toTextUnformatted(!0)??"");let Ve="";if(!Re.editMode&&Me.isSpillOverflow()){const et=Me.getSpill();if(et){const We=et.getCell(),Xe=We.getFormulaText();We.isEqual(Me)||(Ve=Xe)}}return qe&&(nt="'"+nt),{text:nt,placeholder:Ve}}return{text:Re.dirty??"",placeholder:""}})(N),Ne=_e.text,me=ce.toCSSHorizontalTextAlign(c&&!X?N.clean()?.getRenderHorizontalAlignment():ce.HorizontalAlignment.Left);return{style:le,isWrapped:ze,textValue:Ne,formula:X,frameVertAlign:ve,placeholder:_e.placeholder,insets:c?K.getInsets():zr.EmptyRect,textAlign:me}},[N,a,E,b,c]),k=M.useRef(null),L=Yn(e,()=>({startEdit:K=>{R.current=K?.initialSelection;const le={...t,editMode:K?.editMode??!1};K?.text!==void 0&&(le.dirty=K.text),le.editMode===t.editMode&&le.dirty===t.dirty||(D(le),J?.(le))},submitEdit:()=>ee(),cancelEdit(){ne()},autoFocus(){k.current.focus()},dispatchEvent:K=>k.current.dispatchEvent(K),focus(){k.current.focus()},getLineHeight:$}),[n,t]);M.useLayoutEffect(()=>{if(!T||!I)return;const K=k.current;F.textValue,K&&K.setSelectionRange(T.start,T.end,T.direction)},[k.current,T,F.textValue]);const W=M.useMemo(()=>{const K=N?.clean(),le=F.style.createTemporaryTextFrame(F.textValue,K?.getType()===Le.String),X=c?K.getInsets().right+K.getInsets().left:0;let ae=null;return F.isWrapped&&(ae={width:x-X}),le.layout(ae)},[F,x,N,c]),$=ke(()=>Math.ceil(W?.lines[0]?.bounds.height),[W]);M.useLayoutEffect(()=>{if(!W)return;const K=F.style,le=K.getInsets()??zr.EmptyRect,X=c?le.left+le.right:0,ae=c?.04*K.getFont().getSize():1,Ie=Math.round(F.isWrapped?void 0:W.bounds.width+X+ae),ve=Math.round(W.bounds.height);m?.({width:Ie,height:ve})},[W,m,F,c,N]);const J=ke(r,[r]),te=ke(K=>{if(N.dirty===K)return;const le={...N};le.dirty=K,k.current,D(le),J?.(le)},[N]),Q=ke(K=>{if(N.editMode===K)return;const le={...N};le.editMode=K,D(le),J?.(le)},[N]),G=M.useRef(!1),ee=ke(()=>{if(G.current)return!1;try{o?.(N),l?.(),G.current=!0}catch{return!1}return!0},[o,N]),ne=ke(()=>{G.current=!0,D(t),i?.(),l?.()},[i,t]),re=ke(K=>{if(!k.current)return;if(K.key,K.isDefaultPrevented(),!(K.isTrusted||K.nativeEvent.ctrlKey||K.nativeEvent.metaKey||K.nativeEvent.altKey||K.nativeEvent.isComposing||l_.indexOf(K.nativeEvent.key)===-1&&K.nativeEvent.key!=="Backspace")){const _e={...N};let Ne=0;return Xm(_e,_e.dirty)&&!isNaN(parseFloat(K.key))?(_e.dirty?.endsWith("%")?_e.dirty=(_e.dirty.substring(0,_e.dirty.length-1)??"")+K.key+"%":_e.dirty=(_e.dirty??"")+K.key+"%",Ne=_e.dirty.length-1):K.nativeEvent.key==="Backspace"?(_e.dirty="",Ne=_e.dirty.length):(_e.dirty=(_e.dirty??"")+K.key,Ne=_e.dirty.length),k.current.value=_e?.dirty,R.current={start:Ne,end:Ne,direction:"forward"},k.current?.setSelectionRange(Ne,Ne,"forward"),D(_e),J?.(_e),void K.preventDefault()}const le=K.nativeEvent.ctrlKey,X=K.nativeEvent.shiftKey,ae=K.nativeEvent.altKey,Ie=K.nativeEvent.metaKey;if(le&&K.key==="z"&&K.stopPropagation(),K.which===In.Escape)return K.preventDefault(),void ne();if(K.which===In.F2)return Q(!0),void K.preventDefault();const ve=K.target;if(K.key==="%"&&ve.selectionStart===ve.selectionEnd&&ve.value[ve.selectionStart]==="%"&&N?.clean().getStyle().numberFormat.includes("%"))return O({start:ve.selectionStart+1,end:ve.selectionEnd+1,direction:ve.selectionDirection}),void K.preventDefault();if(K.which===In.Enter){if(K.preventDefault(),Ie||ae){const _e=F.textValue.substring(0,ve.selectionStart)+`
`+F.textValue.substring(ve.selectionEnd);return te(_e),void O({start:ve.selectionStart+1,end:ve.selectionStart+1,direction:ve.selectionDirection})}return void(ee()&&h.getSelection().traverse(B.Orientation.Column,X))}if(K.which===In.Tab)return K.preventDefault(),void(ee()&&h.getSelection().traverse(B.Orientation.Row,X));let ze=null;switch(K.which){case In.Left:ze=B.Direction.Left;break;case In.Right:ze=B.Direction.Right;break;case In.Up:ze=B.Direction.Up;break;case In.Down:ze=B.Direction.Down}if(ze&&!(le||X||ae||Ie)&&!N.editMode)return void ee();N.editMode&&(ze||Bx.includes(K.which))&&K.stopPropagation()},[N,h,F]),U=M.useCallback(()=>{k.current?.focus(),setTimeout(()=>{k.current?.select()},0)},[]),ue=M.useCallback(()=>{k.current?.focus(),console.log("implement toggleRelativeReferences")},[]),oe=ke(()=>{const K=k.current?.value;let le="";if(d.rowIndex>0){const X=h.getRange({rowIndex:d.rowIndex-1,colIndex:d.colIndex}).getCell();X&&(le=X.toTextUnformatted(!0))}te(K+le)},[d,h]);M.useEffect(()=>h.getRange(d).addListener(()=>{const K={...N,clean:()=>h.getRange(d).getCell()};D(K),J?.(K)}),[d,h,N]);const Z=M.useCallback(()=>{const K=N.clean().createTemporaryCell({value:La.nowWithPrecision(),style:{numberFormat:"Medium Time"}}).toText();te((k.current?.value??"")+K)},[h]),Y=M.useCallback(()=>{const K=N.clean().createTemporaryCell({value:La.nowWithPrecision(),style:{numberFormat:"Short Date"}}).toText();te((k.current?.value??"")+K)},[h]),we=M.useMemo(()=>({element:()=>k.current,doCopy:K=>{const le=k.current.value.substring(k.current.selectionStart,k.current.selectionEnd);if(K?.isCut){const X=k.current.value.substring(0,k.current.selectionStart)+k.current.value.substring(k.current.selectionEnd,k.current.value.length);te(X)}return le}}),[k.current]),ge=M.useMemo(()=>({element:()=>k.current,doPaste:async(K,le)=>{const X=await K.toText?.();if(!X)return!0;const ae=k.current.value.substring(0,k.current.selectionStart)+X+k.current.value.substring(k.current.selectionEnd,k.current.value.length);return te(ae),O({start:k.current.selectionStart+X.length,end:k.current.selectionStart+X.length,direction:"forward"}),!0}}),[k.current]),de=M.useMemo(()=>({contains:K=>k.current?.contains(K)||!1,focus(){k.current.focus()}}),[]),be=M.useMemo(()=>[new tt("selectAll",de,{label:"Select All",description:"Select all of the text in cell.",shortcut:{key:"a",modifiers:[Oe.Ctrl]}},U),new tt("startEditValueAbove",de,{label:"Copy From Above",description:"Copy the value from the cell above the active cell into the cell or the formula bar.",shortcut:[{key:'"',modifiers:[Oe.Ctrl]},{key:'"',modifiers:[Oe.Ctrl,Oe.Shift]}]},oe),new tt("startEditCurrentTime",de,{label:"Current Time",description:"Insert the current time.",shortcut:{key:"Semicolon",modifiers:[Oe.Ctrl,Oe.Shift]}},Z),new tt("startEditCurrentDate",de,{label:"Current Date",description:"Insert the current date.",shortcut:{key:"Semicolon",modifiers:[Oe.Ctrl]}},Y),new Ae("relativeReferencesToggle",de,{label:"Toggle References",description:"Toggles cell references from relative to absolute, to partially absolute, back to relative again.",shortcut:{key:"F4"}},ue),new Ae("toggleEditorFocus",de,{label:"Toggle Editor Focus",description:"Moves focus between editors such as formula editor and inline editor.",shortcut:{key:"F2",modifiers:[Oe.Ctrl]}})],[]),he=M.useMemo(()=>{let K=null;const le=()=>({contains:X=>k.current?.contains(X)||!1,focus(){k.current.focus()}});return K=f?f.createChildGroup(le,"editor",!1):new Ua(le,"editor"),K.addCommands(be,!0),K},[f,be]),fe=M.useMemo(()=>({notifier:null,source:we,target:ge,commands:he}),[we,ge,he]);kp(fe);const[z,Fe]=M.useState(!_);M.useEffect(()=>{Fe(!1)},[]);const De=ke(K=>{A(!0),he?.activate();const le=R.current;if(le!==!1){let X,ae;const Ie=k.current.value;Xm(N,Ie)&&(X=Ie.length-1,ae=Ie.length-1),X=le?.start??X??Ie.length,ae=le?.end??ae??Ie.length,R.current=!1,O({start:X,end:ae,direction:"forward"})}p?.(K)},[p,N]),Ge=F.insets;let H=Ge.left+1;const ie=Ge.left+Ge.right+2-1,Se=W?.bounds.height??0;let j,se=Ge.top;F.frameVertAlign===ce.VerticalAlignment.Center?se=Math.max(0,(v-(Ge.top+Ge.bottom)-Se)/2):F.frameVertAlign===ce.VerticalAlignment.Bottom&&(se=Math.max(0,v-(Ge.top+Ge.bottom)-Se)),C!==void 0&&W?.lines[0]?.bounds&&(j=W?.lines[0]?.bounds.height*C);const ye=F.style.getFont();let xe=ye.getSize();ye.isSuperSub()&&(xe*=ye.getSuperSubScale()),xe*=Be.getDeviceScale()*b;const Ee=c?ye.toCSS(E,b):null;return pe.jsx("div",{className:"sheet-cell-editor",onMouseDown:K=>{k.current&&document.activeElement!==k.current&&requestAnimationFrame(()=>{k.current.focus()})},ref:L,...y,style:{display:"flex",flexGrow:1,alignSelf:"stretch",height:"100%",width:"100%",maxWidth:"100%",maxHeight:"100%",cursor:"initial",...w},children:pe.jsx("div",{className:"editor-placement",style:{display:"flex",flexGrow:1,position:"relative",top:se*b,left:H*b,width:`calc(100% - ${ie*b}px)`,maxWidth:`calc(100% - ${ie*b}px)`,height:(j??Se)*b,maxHeight:(j??Se)*b},children:pe.jsx("textarea",{spellCheck:"false",placeholder:F.placeholder,ref:k,value:F.textValue,disabled:z,readOnly:S||h.getProtection().isReadOnly(),name:"sheet-cell-editor",autoComplete:"off",autoCapitalize:"off",style:{flex:"1 1 100%",font:"inherit",...Ee,fontSize:xe?`${xe}px`:"inherit",textAlign:F.textAlign,lineHeight:(W?.lines[0]?.bounds.height??0)*b+"px",height:(W?.bounds.height??0)*b,boxSizing:"border-box",padding:"0px",margin:"0px",borderWidth:0,outline:"none",resize:"none",overflow:"hidden",background:"transparent",maxHeight:"100%",maxWidth:"100%",width:"100%",userSelect:"text",position:"absolute",whiteSpace:F.isWrapped?"normal":"pre",wordWrap:"break-word"},onFocus:De,onBlur:()=>{A(!1)},onSelect:K=>{},onChange:K=>{k.current&&!G.current&&(R.current=!1,te(K.target.value),F.textValue,K.target.value,K.target.selectionStart,K.target.selectionEnd,K.target.selectionDirection,O({start:K.target.selectionStart,end:K.target.selectionEnd,direction:K.target.selectionDirection}))},onMouseDown:K=>{I&&Q(!0)},onKeyDown:re})})})})),Px=(s,e)=>({clean:s,dirty:e,editMode:!1}),Hx=s=>{const{length:e=0,width:t=1,dashArray:n=null,dashArrayAdditional:r=null,isDouble:o=!1,isAngled:i=!1,offsetX:l=0,offsetY:a=0,isVertical:c=!1,...u}=s,d=w=>{let b=null;if(w&&t>0){b="";for(let C=0;C<w.length;C++)b+=w[C],C<w.length-1&&(b+=",")}return b},h=d(n);let f=h;r&&(f=d(r));let g=t,m=e,p=null;if(o){g=Math.floor(t/2);const w=g+g/2+1;let b=null;b=c?`M ${St.boundPixel(l+w)} ${St.boundPixel(a)} L ${St.boundPixel(l+w)} ${St.boundPixel(a+m)}`:`M ${St.boundPixel(l)} ${St.boundPixel(a+w)} L ${St.boundPixel(l+m)} ${St.boundPixel(a+w)}`,p=pe.jsx("path",{strokeWidth:g,strokeDasharray:f,d:b,...u})}if(i){g=t/2;const w=g+g/2;let b=f,C=null;C=c?`M ${St.boundPixel(l+w)} ${St.boundPixel(a)} L ${St.boundPixel(l+w)} ${St.boundPixel(a+m)}`:`M ${St.boundPixel(l)} ${St.boundPixel(a+w)} L ${St.boundPixel(l+m)} ${St.boundPixel(a+w)}`,p=pe.jsx("path",{strokeWidth:g,strokeDasharray:b,strokeDashoffset:"1",shapeRendering:"crispEdges",d:C,...u})}let S=null;return S=c?`M ${St.boundPixel(l+g/2)} ${St.boundPixel(a)} L ${St.boundPixel(l+g/2)} ${St.boundPixel(a+m)}`:`M ${St.boundPixel(l)} ${St.boundPixel(a+g/2)} L ${St.boundPixel(l+m)} ${St.boundPixel(a+g/2)}`,pe.jsxs(pe.Fragment,{children:[pe.jsx("path",{strokeWidth:g,strokeDasharray:h,d:S,...u}),p]})};function Hu(s,e){if(typeof s=="function")return s(e);s&&(s.current=e)}var Oo=parseInt(M.version.split(".")[0],10)>=19?function(s){return e=>{const t=[];for(const n of s){const r=Hu(n,e),o=typeof r=="function";t.push(o?r:()=>Hu(n,null))}return()=>{for(const n of t)n()}}}:function(s){return e=>{for(const t of s)Hu(t,e)}},$x=function(){},ew=typeof window<"u",Vx=ew?M.useLayoutEffect:M.useEffect,Zm={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};const Es=ew&&window.ResizeObserver!==void 0?function(){var s=M.useState(null),e=s[0],t=s[1],n=M.useState(Zm),r=n[0],o=n[1],i=M.useMemo(function(){return new window.ResizeObserver(function(l){if(l[0]){var a=l[0].contentRect,c=a.x,u=a.y,d=a.width,h=a.height,f=a.top,g=a.left,m=a.bottom,p=a.right;o({x:c,y:u,width:d,height:h,top:f,left:g,bottom:m,right:p})}})},[]);return Vx(function(){if(e)return i.observe(e),function(){i.disconnect()}},[e]),[t,r]}:function(){return[$x,Zm]},Wx=(s,e)=>s.colStart===e.colStart?s.rowStart-e.rowStart:s.colStart-e.colStart,jx=(s,e)=>s.rowStart===e.rowStart?s.colStart-e.colStart:s.rowStart-e.rowStart,Gx=s=>{const{key:e,points:t,range:n,stroke:r,darkMode:o,forceThinBorder:i=!1,shiftIfWide:l=!1,isVertical:a=!1,intersections:c,layout:u}=s,d=Ce.BuiltInDefinitions.get(i?Ce.StrokeStyle.Thin:r.getStyle());if(!d)return null;const h=t[0],f=t[1],g=t[2],m=t[3];let p=1+(a?m-f:g-h),S=0;const w=r.getColor().toRGBA(o).toString(),b=d.description.toLowerCase().includes("double");let C,_;const y=a?"rowStart":"colStart",v=a?"rowEnd":"colEnd",x=a?f:h;if(c?.length>0){const A=c[0];if(A?.range[y]===n[y]){const T=Ce.BuiltInDefinitions.get(A.stroke.getStyle());S=Math.floor(T.width/2)}if(c[c.length-1]?.range[v]===n[v]){const T=Ce.BuiltInDefinitions.get(c[c.length-1].stroke.getStyle());p=Math.floor(p+(T.width===2?0:T.width/2))}if(b){const T=a?"colStart":"rowStart",O=a?"colEnd":"rowEnd",N=a?u?.getRowOffset:u?.getColOffset;let D=0,F=0;C=[],_=[];const k=c.length;for(let L=0;L<k;L++){const W=c[L];if(W.stroke.getStyle()===Ce.StrokeStyle.Double&&N){const $=N(W.range[y])-(x-S);W.range[T]<n[T]&&(C.push($-D),D=$,C.push(1),D++),W.range[O]>n[O]&&(_.push($-F),F=$,_.push(1),F++)}}C.length>0&&D<p&&C.push(p-D),_.length>0&&F<p&&_.push(p-F)}}let E=a?-Math.floor(d.width/2):-S,R=a?-S:-Math.floor(d.width/2);const I=l&&d.width>2?-1:0;return pe.jsx(Hx,{offsetX:h+E+I,offsetY:f+R+I,length:p+S,isVertical:a,stroke:w,width:d.width,dashArray:C??d.pattern,dashArrayAdditional:_,isDouble:b,isAngled:d.description.toLowerCase().includes("slant")},e)},tw=({getBorderAt:s,rendererBorder:e=Gx,getVisibleCells:t,darkMode:n,forceThinBorder:r=!1,defaultColor:o="black",shiftIfWide:i=!1})=>{const l=ke(t,[t]);return{renderOverlay:M.useMemo(()=>a=>{const c=a.toClipBounds(a.getRangeCoordsBounds(),-3);if(!c)return;const u=l(a);if(u.length===0)return;const d=a.getVisibleColumnOffsets(),h=a.getVisibleRowOffsets();let f=[],g=[];const m=a.getVisibleColumns(),p=a.getVisibleRows(),S=[],w=[],b=[],C=[],_=(T,O,N,D,F,k,L)=>{const W={index:D,stroke:F,visibleIndex:N,edge:k,length:L};T[O]||(T[O]=[]),T[O].length>0&&T[O][T[O].length-1]?.index===D?T[O][T[O].length-1]=W:T[O].push(W)},y=a.getVisibleRangeCoords(),v=u.length;for(let T=0;T<v;T++){const O=u[T],N=O.coords;if(!N)continue;const D=O?.range??{rowStart:N.rowIndex,colStart:N.colIndex,rowEnd:N.rowIndex,colEnd:N.colIndex};if(!q.isRangesIntersect(D,y)&&!q.isRangeWithinRange(D,y))continue;const F=N.colIndex,k=N.rowIndex,L=d[F],W=h[k];if(D.rowEnd!==D.rowStart){const oe=h[D.rowStart]?.spanIndex??-1,Z=h[D.rowEnd]?.spanIndex??h[p[p.length-1]].spanIndex+1;f.push({...D,rowStart:oe,rowEnd:Z})}if(D.colEnd!==D.colStart){const oe=d[D.colStart]?.spanIndex??-1,Z=d[D.colEnd]?.spanIndex??d[m[m.length-1]].spanIndex+1;g.push({...D,colStart:oe,colEnd:Z})}const $=O.value,J=s($,T);if(!J||J.isEmpty())continue;const te=J.getLeft(),Q=J.getTop(),G=J.getRight(),ee=J.getBottom();let ne=1,re=1;if(!L||!W)continue;const U=L.spanIndex,ue=W.spanIndex;te.isNone()||_(S,U,ue,k,te,Ce.Edge.Left,ne),Q.isNone()||_(w,ue,U,F,Q,Ce.Edge.Top,re),G.isNone()||_(S,U+re,ue,k,G,Ce.Edge.Right,ne),ee.isNone()||_(w,ue+ne,U,F,ee,Ce.Edge.Bottom,re)}const x=(T,O,N)=>{const D=[];return T.forEach((F,k)=>{let L=null;F.sort(($,J)=>$.visibleIndex-J.visibleIndex);const W=F.length;for(let $=0;$<W;$++){const J=F[$];if(!J?.stroke||O[k]===void 0&&O[k-1]===void 0)continue;let te=!1;if(N){const ne=f.length;for(let re=0;!te&&re<ne;re++){let U=f[re];U.colStart<=J.index&&U.colEnd>=J.index&&U.rowStart<k&&U.rowEnd>=k&&(te=!0)}}else{const ne=g.length;for(let re=0;!te&&re<ne;re++){let U=g[re];U.rowStart<=J.index&&U.rowEnd>=J.index&&U.colStart<k&&U.colEnd>=k&&(te=!0)}}if(te)continue;const Q=J.stroke?.getColor(),G=Q?Q.toRGBA().toString():o,ee=J.stroke.getStyle()+":"+G;(ee!==L?.key||L&&L.visibleIndex+1<J.visibleIndex)&&(L&&D.push(L),L={key:ee,index:O[k]??O[k-1]+1,visibleIndex:J.visibleIndex,edge:J.edge,stroke:J.stroke,from:J.index,to:J.index+J.length-1,intersections:[],length:1}),L.to=J.index+J.length-1,L.visibleIndex=J.visibleIndex}L&&D.push(L)}),D};f=f.sort(jx),g=g.sort(Wx);const E=x(S,m,!1),R=x(w,p,!0);if(E.length===0&&R.length===0)return null;const I=R.length;for(let T=0;T<I;T++){const O=R[T];let N=P.findEqualOrGreater(E,O.from,F=>F.index),D=!1;for(;!D;){const F=E[N++];F&&F.index>=O.from&&F.index<=O.to+1&&F.from<=O.index&&F.to+1>=O.index&&(O.intersections.push({stroke:F.stroke,range:{rowStart:F.from,rowEnd:F.to+1,colStart:F.index,colEnd:F.index}}),F.intersections.push({stroke:O.stroke,range:{rowStart:O.index,rowEnd:O.index,colStart:O.from,colEnd:O.to+1}})),D=!F||F.index>O.to+1}}for(let T=0;T<I;T++){const O=R[T];let N=O.stroke;const D=`rBorder:${O.index}:${O.from}:${O.to}:${O.edge}`,F={rowStart:O.index,rowEnd:O.index,colStart:O.from,colEnd:O.to+1},k=a.getLayout(),L=!1,W=k.getColOffset(F.colStart),$=k.getRowOffset(F.rowStart),J=[W,$,k.getColOffset(F.colEnd),$];b.push(e({key:D,points:J,stroke:N,darkMode:n,forceThinBorder:r,shiftIfWide:i,range:F,intersections:O.intersections,layout:k,isVertical:L}))}const A=E.length;for(let T=0;T<A;T++){const O=E[T];let N=O.stroke;const D=`cBorder:${O.index}:${O.from}:${O.to}:${O.edge}`,F={rowStart:O.from,rowEnd:O.to+1,colStart:O.index,colEnd:O.index},k=a.getLayout(),L=!0,W=k.getColOffset(F.colStart),$=[W,k.getRowOffset(F.rowStart),W,k.getRowOffset(F.rowEnd)];C.push(e({key:D,stroke:N,points:$,darkMode:n,forceThinBorder:r,shiftIfWide:i,range:F,intersections:O.intersections,layout:k,isVertical:L}))}return pe.jsxs("svg",{width:`${c.width}`,height:`${c.height}`,viewBox:`0 0 ${c.width} ${c.height}`,preserveAspectRatio:"none",shapeRendering:"crispEdges",style:{position:"absolute",left:"0px",top:"0px",width:`${c.width}px`,height:`${c.height}px`,pointerEvents:"none",transitionTimingFunction:"linear",transitionDelay:"0",transitionProperty:"left, top, width, height",willChange:"left, top, width, height, stroke-dashoffset",overflow:"visible"},children:[C,b]},"borders")},[s,n])}},Qm=Et.Center,Ux=Object.freeze({horizontal:!1,vertical:!1}),Ym=zr.EmptyTopLeft,qx=(s,e)=>q.EmptyCell,Jx=(s,e)=>new Promise((t,n)=>{n("StaticBorderRenderer does not support scrolling")}),I2=M.memo(s=>{const{getBorderAt:e,width:t,height:n,style:r,rowCount:o=2,columnCount:i=2,darkMode:l,forceThinBorder:a,children:c,...u}=s,d=M.useRef(null),[h,{width:f,height:g}]=Es(),m=t??f,p=n??g,S=M.useMemo(()=>{const N=[];for(let D=0;D<o;D++)for(let F=0;F<i;F++){const k={colIndex:F,rowIndex:D};N.push({coords:k,value:k})}return N},[]),w=M.useCallback(N=>S,[S]),{renderOverlay:b}=tw({getVisibleCells:w,getBorderAt:e,darkMode:l,forceThinBorder:a}),C=Math.floor(m/i),_=Math.floor(p/o),y={getColOffset:N=>Math.ceil(N*C)+0,getRowOffset:N=>Math.ceil(N*_)+0,getColIndex:N=>Math.floor((N-0)/C)-1,getRowIndex:N=>Math.floor((N-0)/_)-1},v={rowStart:0,colStart:0,rowEnd:o,colEnd:i},x={x:0,y:0,width:Math.max(0,m)+0,height:Math.max(0,p)+0},E=M.useMemo(()=>{const N={},D=Math.floor(m/i);for(let F=0;F<i;F++)N[F]={offset:F*D,size:D,spanIndex:F};return N},[m,p]),R=M.useMemo(()=>{const N={},D=Math.floor(p/o);for(let F=0;F<o;F++)N[F]={offset:F*D,size:D,spanIndex:F};return N},[m,p]);if(!b)return null;const I={width:m,height:p},A={width:m,height:p},T={getStage:()=>d.current,getTotalSize:()=>I,getViewportSize:()=>A,getLayout:()=>y,getCellCoordsAsRangeCoords:q.cellToRange,getVisibleRangeCoords:()=>v,getVisibleRows:()=>{const N=[];for(let D=0;D<o;D++)N.push(D);return N},getTotalRangeCoords:()=>v,getRelativePointFromClient:(N,D)=>({x:N,y:D}),getVisibleColumns:()=>{const N=[];for(let D=0;D<i;D++)N.push(D);return N},toClipBounds:(N,D)=>x,toViewBounds:N=>N,toAbsoluteBounds:N=>N,getBounds:()=>x,getInsets:()=>null,getRangeCoordsBounds:(N,D)=>null,getVisibleColumnOffsets:()=>E,getVisibleRowOffsets:()=>R,allViews:()=>({[Qm]:T}),getAnchor:()=>Qm,getZoom:()=>1,scrollCellCoordsIntoView:Jx,getCellCoordsFromClient:qx,getScrollOrientation:()=>Ux,getScrollTopLeft:()=>Ym,getFreezeTopLeft:()=>Ym},O=b(T);return pe.jsxs("div",{style:{...r,position:"relative",display:"flex"},...u,children:[pe.jsx("div",{ref:Oo([d,h]),style:{flex:"1 1 100%",display:"flex",maxWidth:"100%",maxHeight:"100%"},children:c}),O]})});function nw(s){var e,t,n="";if(typeof s=="string"||typeof s=="number")n+=s;else if(typeof s=="object")if(Array.isArray(s)){var r=s.length;for(e=0;e<r;e++)s[e]&&(t=nw(s[e]))&&(n&&(n+=" "),n+=t)}else for(t in s)s[t]&&(n&&(n+=" "),n+=t);return n}function rn(){for(var s,e,t=0,n="",r=arguments.length;t<r;t++)(s=arguments[t])&&(e=nw(s))&&(n&&(n+=" "),n+=e);return n}const Kx="_sheetxl-sheet_1qeq6_5",Xx="_viewport-overlay_1qeq6_6",Zx=s=>{const{style:e,...t}=s??{};return pe.jsxs("svg",{style:{width:"135px",height:"37px",...e},viewBox:"0 0 135 37",...t,children:[pe.jsx("path",{d:"M 1.0984,0 C 0.4978,0 0.01,0.40548 0.01,0.90302 v 19.5766 H 0 v 15.61762 c 0,0.30574 0.185,0.57535 0.466,0.73886 v 0.1426 H 0.8565 C 0.9315,36.992 1.0086,37 1.0883,37 H 13.063 25.9706 v 0 h 8.7553 c 0.08,0 0.1563,-0.008 0.2308,-0.0213 h 0.054 v -0.0141 c 0.4621,-0.10457 0.8035,-0.45175 0.8035,-0.86739 v -15.312 c 0,-0.0328 0.01,-0.0658 0.01,-0.0995 V 0.90304 C 35.8242,0.4052 35.3363,6e-5 34.7358,6e-5 H 22.5969 V 1.7e-4 H 21.0014 V 6e-5 Z",fill:"#547dbe",fillRule:"evenodd"}),pe.jsx("path",{d:"M 1.4849,2.09543 V 9.06408 H 8.1947 V 2.09543 Z m 8.6592,0 V 9.06408 H 16.854 V 2.09543 Z m 8.685,0 v 6.96865 h 6.7098 V 2.09543 Z m 8.7355,0 v 6.96865 h 6.7099 V 2.09543 Z M 1.4849,11.04391 v 6.81444 h 6.7098 v -6.81444 z m 8.6592,0 v 6.81444 h 6.7099 v -6.81444 z m 8.685,0 v 6.81444 h 6.7098 v -6.81444 z m 8.7355,0 v 6.81444 h 6.7099 V 11.04391 Z M 1.4849,19.83872 v 6.68584 h 6.7098 v -6.68584 z m 8.6592,0 v 6.68584 h 6.7351 v -6.68584 z m 8.685,0 v 6.68584 h 6.7098 v -6.68584 z m 8.7355,0 v 6.68584 h 6.7099 v -6.68584 z m -26.052,8.38811 v 6.68588 h 6.7098 v -6.68588 z m 8.6592,0 v 6.68588 h 6.7355 v -6.68588 z m 8.685,0 v 6.68588 h 6.7099 v -6.68588 z m 8.7356,0 v 6.68588 h 6.7098 v -6.68588 z",fill:"#ffffff",fillRule:"evenodd"}),pe.jsx("path",{d:"m 1.4785,2.09737 v 6.96865 h 6.741 V 2.09737 Z m 0,8.94851 v 6.81449 h 6.741 v -6.81449 z m 0,8.79485 v 6.6858 h 6.741 v -6.6858 z m 0.028,8.388 v 6.68588 h 6.741 v -6.68588 z",fill:"#547dbe",fillRule:"evenodd",strokeWidth:"0.4"}),pe.jsx("path",{d:"M 120.9895,32.82218 V 10.13469 h 4.7986 v 18.71559 h 9.2153 v 3.9719 z m 0.4853,0 h -5.4976 l -5.275,-8.57923 -5.2751,8.57923 h -5.1481 l 7.5314,-11.69325 -7.0545,-10.99424 h 5.3067 l 4.8936,8.16618 4.7986,-8.16618 h 5.1796 l -7.118,11.24826 z M 95.9361,29.04099 c 0.5297,0 1.0381,-0.053 1.5254,-0.15888 0.4872,-0.10591 0.9745,-0.23299 1.4617,-0.3813 v 3.52703 c -0.5084,0.21183 -1.144,0.39189 -1.9066,0.54018 -0.7415,0.16946 -1.5571,0.2542 -2.4469,0.2542 -1.038,0 -1.9701,-0.16947 -2.7964,-0.5084 -0.805,-0.33894 -1.4511,-0.92148 -1.9384,-1.74763 -0.466,-0.84734 -0.6991,-2.01241 -0.6991,-3.49526 v -8.35686 h -2.2562 v -2.00181 l 2.6058,-1.58876 1.3664,-3.65411 h 3.0189 v 3.6859 h 4.8619 v 3.55878 h -4.8619 v 8.35686 c 0,0.65668 0.1906,1.15449 0.5719,1.49342 0.3814,0.31776 0.8792,0.47664 1.4935,0.47664 z M 79.1445,14.83743 c 2.3939,0 4.29,0.68847 5.6882,2.06535 1.3983,1.35581 2.0972,3.29411 2.0972,5.81491 v 2.28769 H 75.7444 c 0.042,1.33475 0.4342,2.38315 1.1758,3.14596 0.7626,0.76244 1.8113,1.14385 3.1459,1.14385 1.1227,0 2.1396,-0.10609 3.0506,-0.3179 0.9109,-0.23311 1.8536,-0.58257 2.8283,-1.0484 v 3.654 c -0.8476,0.42362 -1.7479,0.73087 -2.7012,0.92139 -0.9322,0.21181 -2.0655,0.3179 -3.4001,0.3179 -1.7373,0 -3.2731,-0.3179 -4.6078,-0.95333 -1.3346,-0.65673 -2.3833,-1.64162 -3.1459,-2.95507 -0.7627,-1.31344 -1.144,-2.96571 -1.144,-4.9568 0,-2.03367 0.3389,-3.71788 1.0169,-5.05235 0.6991,-1.35578 1.6629,-2.37258 2.8917,-3.0504 1.2286,-0.67783 2.6586,-1.0168 4.2899,-1.0168 z m 0.032,3.36815 c -0.911,0 -1.6736,0.29653 -2.2879,0.88967 -0.5933,0.59322 -0.9428,1.51461 -1.0487,2.76455 h 6.6415 c -0.021,-1.05904 -0.2967,-1.92796 -0.8262,-2.60567 -0.5297,-0.69905 -1.3559,-1.04855 -2.4787,-1.04855 z m -17.011,-3.36815 c 2.3939,0 4.29,0.68847 5.6882,2.06535 1.3982,1.35581 2.0973,3.29411 2.0973,5.81491 v 2.28769 H 58.7653 c 0.042,1.33475 0.4343,2.38315 1.1758,3.14596 0.7627,0.76244 1.8113,1.14385 3.1459,1.14385 1.1228,0 2.1397,-0.10609 3.0507,-0.3179 0.911,-0.23311 1.8536,-0.58257 2.8282,-1.0484 v 3.654 c -0.8475,0.42362 -1.7478,0.73087 -2.7011,0.92139 -0.9321,0.21181 -2.0655,0.3179 -3.4002,0.3179 -1.7372,0 -3.273,-0.3179 -4.6077,-0.95333 -1.3347,-0.65673 -2.3833,-1.64162 -3.1459,-2.95507 -0.7627,-1.31344 -1.144,-2.96571 -1.144,-4.9568 0,-2.03367 0.3389,-3.71788 1.0168,-5.05235 0.6991,-1.35578 1.6631,-2.37258 2.8918,-3.0504 1.2287,-0.67783 2.6587,-1.0168 4.2899,-1.0168 z m 0.032,3.36815 c -0.911,0 -1.6736,0.29653 -2.288,0.88967 -0.5931,0.59322 -0.9427,1.51461 -1.0486,2.76455 h 6.6414 c -0.021,-1.05904 -0.2965,-1.92796 -0.8262,-2.60567 -0.5297,-0.69905 -1.3558,-1.04855 -2.4786,-1.04855 z M 41.7033,13.59817 c 0,0.84739 -0.032,1.66288 -0.095,2.44668 -0.042,0.78385 -0.085,1.33456 -0.1271,1.65231 h 0.2542 c 0.5508,-0.88968 1.2605,-1.53575 2.1291,-1.93827 0.8686,-0.40251 1.8325,-0.60371 2.8917,-0.60371 1.8855,0 3.3896,0.50838 4.5124,1.52518 1.144,0.99558 1.716,2.60556 1.716,4.82998 V 32.82218 H 48.2498 V 22.68575 c 0,-2.49951 -0.9322,-3.74937 -2.7964,-3.74937 -1.4194,0 -2.4045,0.49788 -2.9553,1.49362 -0.5297,0.97424 -0.7945,2.38314 -0.7945,4.22592 v 8.16626 H 36.9688 V 8.67305 h 4.7348 z",fill:"#eb594d"}),pe.jsx("path",{d:"m 23.345,4.88926 c 1.4307,0 2.8282,0.229 4.1916,0.68692 1.3636,0.45803 2.6999,1.15712 4.0084,2.09748 l -1.8344,2.50966 C 28.6222,9.40175 27.5522,8.82162 26.5004,8.44306 25.4486,8.0645 24.3968,7.87524 23.345,7.87524 c -1.9935,0 -3.5435,0.40902 -4.6503,1.22728 -1.1068,0.81819 -1.6601,1.97842 -1.6601,3.48048 v 0.0183 c 0,1.05019 0.3179,1.8502 0.9538,2.39973 0.636,0.54952 1.4615,0.95869 2.4765,1.22731 1.015,0.26862 2.0975,0.51907 3.2468,0.75111 1.003,0.20755 1.9996,0.44872 2.9905,0.7235 0.9905,0.27478 1.8922,0.66562 2.7057,1.1724 0.813,0.50679 1.4615,1.1937 1.9444,2.06075 0.4832,0.86705 0.7247,1.99672 0.7247,3.38884 v 0.0367 c 0,2.45464 -0.8561,4.35355 -2.5682,5.69703 -1.7122,1.34311 -4.1216,2.01505 -7.2278,2.01505 -1.2963,0 -2.5162,-0.12207 -3.6598,-0.36658 -1.1434,-0.24413 -2.2134,-0.61071 -3.2102,-1.09898 -0.9968,-0.48864 -1.9292,-1.09897 -2.7975,-1.83175 l 1.9628,-2.47308 c 1.0763,0.92809 2.2534,1.62428 3.5314,2.08825 1.2779,0.46431 2.669,0.69627 4.1733,0.69627 2.1158,0 3.7513,-0.40613 4.9071,-1.21827 1.1558,-0.81214 1.7335,-1.95096 1.7335,-3.4164 v -0.0183 c 0,-1.06247 -0.2872,-1.87762 -0.8622,-2.44543 -0.5746,-0.56786 -1.3267,-0.99528 -2.2563,-1.28234 -0.9292,-0.28695 -1.9383,-0.52812 -3.0267,-0.72354 -1.0397,-0.18314 -2.0822,-0.39685 -3.1278,-0.64117 -1.0457,-0.24417 -2.0026,-0.60444 -2.8709,-1.08076 -0.8683,-0.47621 -1.5685,-1.15396 -2.1005,-2.0333 -0.532,-0.87933 -0.798,-2.05162 -0.798,-3.5171 v -0.0183 c 0,-2.4792 0.8255,-4.39955 2.4766,-5.7611 1.651,-1.36167 3.9807,-2.04258 6.9892,-2.04258 z",stroke:"#eb594d",strokeWidth:"2",fill:"#f9cecb"})]})},Qx=M.memo(s=>{const{colorLicensee:e="blue",colorError:t="red",colorCredits:n="grey",credits:r="All rights reserved - Michael Ford",feature:o,style:i,...l}=s??{},[a,c]=M.useState(null);it.useEffect(()=>{(async()=>{const _=await qa.getDetails();c(_)})()},[]);const[u,d]=it.useState(!1),h={opacity:.65},f=it.useMemo(()=>{const _=a?.getExceptions(),y=_?.length??0;if(y===0)return null;const v=[];for(let x=0;x<y;x++){const E=_[x];v.push(pe.jsx("div",{style:{opacity:.8,fontSize:"16px",textAlign:"left",color:t},children:E},x))}return v},[a,t]);if(a===null||a.isValidFor(o))return null;const g=a.getType(),m=!f&&g.endsWith("ity"),p=a.getLicensee(),S=m?1.6:1,w=135/S,b=37/S;let C=null;return!g&&p?.length>0&&(C=pe.jsx("div",{style:{opacity:.7,fontWeight:"500",fontSize:"16px",textAlign:"left",color:e},children:p})),pe.jsx("div",{style:{pointerEvents:"none",display:"flex",flexDirection:"column",overflow:"hidden",...i},...l,children:pe.jsxs("div",{style:{position:"relative",display:"flex",flexDirection:"column"},children:[u?pe.jsx(Zx,{style:h}):pe.jsx("svg",{width:w,height:b,style:h,children:pe.jsx("image",{style:{width:w,height:b},href:"https://www.sheetxl.com/watermark.svg",onError:()=>d(!0)})}),pe.jsxs("div",{children:[C,f,pe.jsx("div",{style:{height:"0px",fontSize:"16px",textAlign:"left",width:"0px",opacity:.8,color:n},children:r})]})]})})}),It=(s,e,t)=>{const n=M.useRef(e);n.current=e;const r=t?.fireOnModelChange??!0;M.useEffect(()=>{if(!s||!n.current)return;const o=Object.keys(n.current),i={},l=o.length;for(let c=0;c<l;c++){const u=o[c];i[u]=(d,h)=>{n.current[u]?.(d,h)}}const a=s.addListeners(i,t);if(r)for(let c=0;c<l;c++)i[o[c]](s);return()=>{a?.()}},[s])},A2=(s,e,t,n)=>{const r=M.useRef(t);r.current=t,M.useEffect(()=>{if(!s||!e||!r.current){const l={getSource:()=>null,getFrom:()=>null,getTo:()=>null,trigger:"delete",isDataChange:!1,isTransactional:!1,isUndo:!1,timeStamp:Date.now()};return void r.current?.(l)}const o=l=>{r.current?.(l)},i=s.getRange(e).addListener(o,n);{const l=s.getRange(e);o({getSource:()=>l,getFrom:()=>null,getTo:()=>null,trigger:"modelChange",isDataChange:!1,isTransactional:!1,isUndo:!1,timeStamp:Date.now()})}return()=>{i?.()}},[s,e])},fh=new class{constructor(){this._taskPanes=new Map}registerTaskPane(s,e=!1){const t=s.key.toLowerCase();if(!e&&this._taskPanes.has(t))throw new Error(`Task pane with key '${t}' is already registered.`);this._taskPanes.set(t,s)}unregisterTaskPane(s){if(s=s.toLowerCase(),!this._taskPanes.has(s))throw new Error(`Task pane with key '${s}' is not registered.`);this._taskPanes.delete(s)}getRegisteredTaskPane(s){return s=s.toLowerCase(),this._taskPanes.get(s)??null}findContributions(s){if(!s)return P.EmptyArray;const e=[];s=(s=s.toLowerCase()).replace(/\/+$/g,"");for(const t of this._taskPanes.values()){const n=t.contributionPoints;if(n&&n.length!==0)for(let r of n)r.startsWith(s)&&e.push(t)}return e}},rw=M.createContext(void 0),M2=({children:s,renderArea:e,onUpdateArea:t,registry:n=fh})=>{const r=it.useRef(null),o=it.useRef(null),[i,l]=it.useState(null),[a,c]=it.useState(null),u=ke(h=>{const f=e({registry:n,onClose:()=>{c(null),t?.(null)},ref:g=>{g&&c(g)}});return t?.(f),f},[e,n,i]),d=it.useMemo(()=>({activateTaskPane(h,f){o.current!==h&&(r.current?r.current.activateTaskPane(h,f):(l(h),u(h)))}}),[]);return it.useEffect(()=>{a&&i&&(a.activateTaskPane(i,{autoFocus:!0}),l(null))},[i,a]),it.createElement(rw.Provider,{value:a??d},s)},Yx={activateTaskPane(s,e){console.warn("No TaskPaneArea available to activate task pane",s,e)}},eE=()=>M.useContext(rw)||Yx,Rs={TaskPaneArea:"_TaskPaneArea_6dmgk_5",TaskPaneTitle:"_TaskPaneTitle_6dmgk_13",TaskPaneFrame:"_TaskPaneFrame_6dmgk_36",TaskPaneStrip:"_TaskPaneStrip_6dmgk_52",TaskPaneStripItem:"_TaskPaneStripItem_6dmgk_60"},ow=M.memo(M.forwardRef((s,e)=>{const{children:t,title:n,icon:r,onClose:o,readOnly:i,focused:l,style:a,className:c,...u}=s,d=M.useMemo(()=>rn("taskpane-title",c,Rs.TaskPaneTitle,{focused:l}),[c,l]);return pe.jsxs("div",{ref:e,className:d,style:a,...u,children:[pe.jsx("div",{className:"title",style:{flex:"1 1 100%"},children:n}),pe.jsx("div",{"aria-label":"close",role:"button",style:{width:24,height:24,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},onPointerDown:h=>{h.stopPropagation()},onPointerUp:()=>{o()},children:pe.jsx("div",{style:{fontSize:"0.7em"},children:"✕"})})]})}));ow.displayName="TaskPaneTitle";const tE=s=>pe.jsx(ow,{...s}),nE=M.memo(M.forwardRef((s,e)=>{const{children:t,entry:n,close:r,listenerContainer:o,model:i,commands:l,onMounted:a,onUnmounted:c,wrapperPane:u,propsPane:d,renderTaskPanelTitle:h=tE,style:f,className:g,...m}=s,[p,S]=M.useState(null),[w,b]=M.useState(!1),C=ke(r,[r]),_=M.useRef(null),y=M.useRef(null);M.useEffect(()=>(a?.(n),()=>{c?.(n)}),[n]);const v=M.useRef([]),x=M.useMemo(()=>({addListener:I=>{const A=o(I);return v.current.push(A),A},close:()=>{C?.()},focus:I=>{_.current?.focus(I)}}),[o]);M.useEffect(()=>()=>{for(const I of v.current)I();v.current=[]},[]);const E=M.useMemo(()=>(n.renderTaskPanelTitle??h)({ref:y,title:n.getTitle(),icon:null,readOnly:!1,focused:w,onClose:C,onPointerDown:I=>{}}),[n,w]),R=M.useMemo(()=>{let I=n.renderTaskPane({entryKey:n.key,model:i,commands:l,frame:x,...d},e);return u&&(I=u(I)),I},[n,i,l,e]);return pe.jsxs("div",{className:rn("taskpane-frame",g,Rs.TaskPaneFrame),tabIndex:0,ref:_,style:f,onPointerDown:async I=>{I.currentTarget.focus()},onFocus:I=>{I.relatedTarget&&!p&&S(I.relatedTarget),b(!0)},onBlur:I=>{p&&!_?.current?.contains(I.relatedTarget)&&S(null),I.relatedTarget&&b(!1)},...m,children:[pe.jsx("div",{style:{flex:"0 0 auto",display:"flex",flexDirection:"column",width:"100%",alignItems:"stretch",justifyContent:"stretch"},children:E}),pe.jsx("div",{className:"taskpane-frame-content",style:{flex:"1 1 auto",minHeight:0,width:"100%",overflow:"auto",height:"100%",display:"flex"},children:R})]})})),sw=M.memo(M.forwardRef((s,e)=>{const{children:t,title:n,taskPanes:r,onSelect:o,selected:i,registry:l=fh,style:a,className:c,...u}=s,d=M.useMemo(()=>r.map(g=>{const m=l.getRegisteredTaskPane(g);if(!m)return null;let p=m.getIcon?.();return p&&(typeof p=="string"&&(p=pe.jsx(Uu,{iconKey:p})),p=pe.jsx("span",{style:{display:"inline-block",transform:"rotate(90deg)",transformOrigin:"center"},children:p})),pe.jsxs("div",{style:{writingMode:"vertical-rl",textOrientation:"mixed",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"4px",minWidth:"0px"},className:rn("taskpane-strip-item",Rs.TaskPaneStripItem,{selected:g===i}),onClick:()=>s.onSelect(g),children:[p,m.getTitle()]},g)}),[r,i,o,l]),h=Yn(e,()=>({isTaskPaneStrip:()=>!0}),[]),f=M.useMemo(()=>rn("taskpane-strip",c,Rs.TaskPaneStrip),[c]);return pe.jsx("div",{ref:h,className:f,style:a,...u,children:d})}));sw.displayName="TaskPaneStrip";const rE=s=>pe.jsx(sw,{...s}),T2=M.memo(M.forwardRef((s,e)=>{const{className:t="",registry:n=fh,model:r,commands:o,onOpen:i,onClose:l,wrapperPane:a,propsPane:c,wrapperFrame:u,propsFrame:d,renderTaskPanelTitle:h,renderTaskPaneStrip:f=rE,alwaysShowStrip:g,style:m}=s,p=ke(i,[i]),S=ke(l,[l]),[w,b]=M.useState(null),C=M.useRef(null),[_,y]=M.useState([]),v=M.useRef(new Set),x=ke(async(N,D=!1)=>{const F=Array.from(v.current),k=F.length;let L=!0;for(let W=0;L&&W<k;W++){const $=F[W];if($.onBeforeHide)try{await Promise.resolve($.onBeforeHide())===!1&&(L=!1)}catch{L=!1}}return L},[]),E=ke(N=>{const D=Array.from(v.current),F=D.length;y(k=>{const L=k.findIndex($=>$.key===N);if(L===-1)return k;const W=[...k];return W.splice(L,1),W.length===0?(b(null),S?.(),W):(R(W[Math.max(W.length-1,L-1)].key),W)});for(let k=0;k<F;k++){const L=D[k];try{L.onHide?.()}catch{}}},[S]),R=ke(async N=>{const D=n.getRegisteredTaskPane(N);if(!D)return void console.warn(`Invalid taskpane '${N}'`);if(C.current===N||w&&!await x(w.key))return;const F=it.createRef();let k=pe.jsx(nE,{ref:()=>{C.current=null},entry:D,model:r,commands:o,close:async()=>{await x(N)&&E(N)},wrapperPane:a,propsPane:c,renderTaskPanelTitle:h,listenerContainer:W=>(v.current.add(W),()=>{v.current.delete(W)}),onMounted:W=>{W.key===N&&(C.current=null),p?.()},onUnmounted:W=>{},...d});u&&(k=u(k));const L={key:N,elem:k,ref:F};y(W=>{if(W.findIndex(J=>J.key===N)!==-1)return W;const $=[...W];return $.push(L),$}),b(L),C.current=N},[w,u,c,h]);M.useEffect(()=>{w&&!C.current&&R(w.key)},[d,r]);const I=Yn(e,()=>({activateTaskPane:R}),[n,c,r,o]),A=M.useMemo(()=>_.map(N=>N.key),[_]),T=M.useMemo(()=>{if(A.length<=1&&!g)return null;const N={className:Rs.TaskPaneAreaStrip,taskPanes:A,selected:w?.key,onSelect:D=>{R(D)},registry:n};return f(N)},[A,w,n,g]),O=w?.elem;return pe.jsxs("div",{ref:I,className:rn("taskpane-area",t,Rs.TaskPaneArea),style:m,children:[O,T]})})),Bl=new Gt("transparent");function oE(s){const{sheet:e,onRepeatCommandChange:t,bodyStyle:n,commands:r,target:o,onStartEdit:i,getViewport:l}=s,a=Hi(),c=eE(),u=ke(i,[i]),d=ke(l,[l]),h=M.useMemo(()=>({serializer:{parse:H=>H?e?.getStyles().parseColor(H):null,stringify:H=>H?H.toString():null}}),[e]),[f,g]=Rc("sheet.lastBorder",null),[m,p]=Rc("sheet.lastFillColor",e?.getStyles().parseColor(V.Scheme.Bg2),h),[S,w]=Rc("sheet.lastFontColor",e?.getStyles().parseColor(e?.getStyles().getNormal().getFont().getFill()),h),b=Mo();M.useRef(b.getMode()).current=b.getMode();const[C,_]=M.useReducer(H=>H+1,0),[y,v]=M.useReducer(H=>H+1,0),x=Qw(),E=M.useRef(null),[R,I]=M.useReducer(H=>H+1,0),[A,T]=M.useReducer(H=>H+1,0),O=M.useRef(null),N=ke(()=>{if(!e)return null;const H=O.current;if(H)return H;const ie=e.getSelectedCell(),Se=ie.getCoords(),j=e.getSelectedRanges(),se=e.getSelectedRange(),ye=e.getTables(),xe=ye.getItems({address:se}),Ee=ye.getItems({address:Se});let K=null;Ee.length>0&&(K=Ee[0]);const le=j.getMerges().length>0,X=j.isOverlapping();let ae=!0;const Ie=j.getCoords(),ve=Ie.length;for(let ze=0;ae&&ze<ve;ze++)ae=q.isSingleCell(Ie[ze]);return H&&K===H.table&&P.isEqualArrays(xe,H.tables)||requestAnimationFrame(()=>{T()}),O.current={tables:xe,table:K,ranges:j,rangesCoords:Ie,range:se,cell:ie,containsMerge:le,isOverlapping:X,isSingleCell:ae},O.current},[e]),D=M.useCallback(P.debounce(I,210),[]);M.useEffect(()=>{E.current=e,I()},[e]),It(e.getSelection(),{onChange:()=>{O.current=null,D()}});const F=ke(async(H,ie,Se=null,j=!1,se=!0)=>{const ye=H?.getLabel?.(),xe=async()=>{const X=await Promise.resolve(se&&a.showBusy(ye??"Busy..."));try{await e.doBatch(async()=>ie(e),ye),j&&b.setMode(null),X&&X()}catch(ae){if(X&&X(),!ae)return;a.showError(ae)}},Ee=[];let K=!1;const le=async()=>(Ee.push(xe),(async()=>{if(!K){for(K=!0;Ee.length>0;){const X=Ee.shift();X&&await X()}K=!1}})());if(t){let X=null;if(Se!==!1&&H){const ae=Se??ye;X=new tt(H.getKey(),o,{label:ae,description:ae},le)}t(X)}return le()},[e,t,a]),k=ke((H,ie,Se=!1,j)=>(j||(j={autoSelect:!0,autoFit:!0}),F(H,se=>{const ye=se.getSelectedRanges();Se&&ye.getStyle().update(null,j),ye.getStyle().update(ie,j)})),[e]),L=ke((H,ie)=>{F(H,Se=>{Se.getSelectedRange().setHyperlink(ie)})},[e]),W=ke((H,ie)=>{F(H,Se=>{Se.getSelectedRange().setComments(ie)})},[e]),$=ke((H,ie)=>{F(H,Se=>{Se.getSelectedRanges().clear(ie)})},[e]),J=ke(async(H,ie,Se=!1,j=!1)=>F(H,async se=>{let ye=se.getSelectedRanges();Se&&(ie===B.Orientation.Row?ye=ye.getEntireRows(j):ie===B.Orientation.Column&&(ye=ye.getEntireColumns(j)));let xe=null;const Ee=b.getMode()?.key;if(Ee==="copy"||Ee==="cut"){const K=await x.getClipboard().readReference();K&&K.getItemType()==="range"&&(xe=K.getItem(),xe.getCoords()||(xe=null))}if(xe){const K=await ye.insertFrom(xe,{...xe.getMarkOptions(),orientation:ie,autoSelect:!0});!K||K.isEntireRows()||K.isEntireColumns()||K.autoFit({orientations:B.Orientations.Row,minContent:!0}),b.setMode(null)}else ye.insert({orientation:ie,autoSelect:!0})},"Insert Cells",!1),[b]),te=ke(H=>e.getStyles().setDefaultTableStyle(H),[e]),Q=ke(H=>{e.getStyles().getTableStyle(H)?.delete()},[e]),G=ke((H,ie)=>{F(H,async Se=>{const j=Se.getSelectedRange(),se=Se.getSelectedCell().getCoords();let ye=null,xe=0;const Ee=se.rowIndex>0?Se.getRange({rowIndex:se.rowIndex,colIndex:se.colIndex}).getExtended(B.Direction.Up):null;Ee&&Se.getRange({colStart:se.colIndex,rowStart:Ee.getCoords().rowStart,colEnd:se.colIndex,rowEnd:Ee.getCoords().rowStart}).isContentful()&&(ye=B.Direction.Up,xe=se.rowIndex-Ee.getCoords().rowEnd);const K=se.colIndex>0?Se.getRange({rowIndex:se.rowIndex,colIndex:se.colIndex-1}).getExtended(B.Direction.Left):null;if(K&&Se.getRange({colStart:K.getCoords().colStart,rowStart:se.rowIndex,colEnd:K.getCoords().colStart,rowEnd:se.rowIndex}).isContentful()){const X=se.colIndex-K.getCoords().colEnd;(X<xe||!ye)&&(ye=B.Direction.Left,xe=X)}let le=null;if(ye===B.Direction.Up){if(le={...Ee.getCoords()},(le.rowEnd===se.rowIndex||!Se.getRange({colIndex:se.colIndex,rowIndex:se.rowIndex-1}).isContentful())&&le.rowStart>0&&Se.getRange({colIndex:se.colIndex,rowIndex:le.rowStart-1}).isContentful()){const X=Ee.getExtended(B.Direction.Up);le={colStart:se.colIndex,rowStart:X.getCoords().rowStart,colEnd:se.colIndex,rowEnd:Ee.getCoords().rowEnd}}le.rowEnd=se.rowIndex-1}else if(ye===B.Direction.Left){if(le={...K.getCoords()},(le.colEnd===se.colIndex||!Se.getRange({colIndex:se.colIndex-1,rowIndex:se.rowIndex}).isContentful())&&le.colStart>0&&Se.getRange({colIndex:le.colStart-1,rowIndex:se.rowIndex}).isContentful()){const X=K.getExtended(B.Direction.Left);le={colStart:X.getCoords().colStart,rowStart:se.rowIndex,colEnd:X.getCoords().colEnd,rowEnd:se.rowIndex}}le.colEnd=se.colIndex-1}if(j.size!==1&&ye){const X=j.getCoords(),ae=j.startIncrementalUpdates({orientation:B.Orientation.Column}),Ie={...le},ve=X.rowStart,ze=X.rowEnd,_e=X.colStart,Ne=X.colEnd,me=ye===B.Direction.Up;for(let Re=_e;Re<=Ne;Re++){Ie.colStart=me?Re:le.colStart+(Re-_e),Ie.colEnd=me?Re:le.colEnd+(Re-_e);for(let Me=ve;Me<=ze;Me++){Ie.rowStart=me?le.rowStart+(Me-ve):Me,Ie.rowEnd=me?le.rowEnd+(Me-ve):Me;const qe=Se.getRange(Ie).toString();ae.pushAt(Me,Re,`=${ie}(${qe})`)}}ae.apply()}else{const X=le?Se.getRange(le).toString():"",ae=`=${ie}(`;u?.({text:`${ae}${X})`,editMode:!0,initialSelection:{start:ae.length,end:ae.length+X.length}})}},!1)},[e]),ee=ke((H,ie,Se=!1,j=!0)=>{F(H,async se=>{const ye=N()?.table;if(ye)return void ye.updateStyleOptions(ie);const xe=se.getSelectedRanges().getFixed(!0),Ee=se.getSelectedRange().getDefaultSortCriteria(),K={getNames:()=>se.getNames(),table:()=>null,styles:()=>null,bodyStyle:()=>null},le={ranges:xe,hasHeader:Ee?.options?.hasHeader??!1},X=async Ie=>{if(!(Ie=await Promise.resolve(Ie)))return null;const ve=await Promise.resolve(a.showBusy(H.getLabel()));try{await se.getTables().add(Ie.ranges.at(0),{styleName:ie?.name,clearFormatting:Se,hasHeader:Ie.hasHeader}).getRange().select(),ve()}catch(ze){ve(),a.showError(ze)}};if(!j)return void await X(le);const ae={initialValue:le,context:()=>K,onInput:Ie=>{X(Ie)}};a.showWindow("tableNew",ae)},!1,!0,!1)},[]),ne=ke(()=>n,[n]),re=ke(H=>({styles:()=>e.getStyles(),table:()=>H,bodyStyle:ne,getNames:()=>e.getNames()}),[e]),U=ke(async(H,ie,Se,j=!0)=>{if(!ie){const ye=N();if(!ye)return;let xe=ye.range;xe.size===1&&(xe=xe.getSurrounding());const Ee=ye.table;Ee&&(ie=Ee),await xe.select()}if(!ie)return;try{Se&&await ie.select()}catch{}if(!j)return;const se=new Promise(async(ye,xe)=>{H.update({context:re(ie)}),c.activateTaskPane("tableDetails",{}),ye(!0)});try{if(!await se)return}catch(ye){a.showError(ye)}},[a]),ue=ke(async(H,ie,Se=!1)=>{let j=null;if(ie?ie.isITable?j=ie:ie.getValue()&&(j=ie.getValue()):j=N()?.table,j){if(!Se){const se=j.getRange().getCoords(),ye=(se.colEnd-se.colStart+1)*(se.rowEnd-se.rowStart+1);if(ye>1e4&&await a.showOptions({title:"Confirm",description:`Converting a table to range with '${ye}' cells will set a large number of cell styles and may affect performance.
Continue?`,options:["Convert","Cancel"],defaultOption:"Convert"})!=="Convert")return}F(H,async()=>{Se?j.delete():j.convertToRange()},!1,!0)}},[a]),oe=ke((H,ie,Se)=>{F(H,async j=>{const se=N();if(!se)return;const ye=se.ranges;if(ye.getCount()>1)throw new Pe("Can not sort on multiple cell ranges. Please select a single range and try again.");let xe=ye.at(0);xe.size===1&&(xe=xe.getSurrounding());const Ee=se.cell;let K=xe.getDefaultSortCriteria(B.Orientation.Row,Ee);if(!K){if(Se)throw new Pe("Invalid sort selection. Sort requires a single range with data.");return}const le=async ze=>{if(!(ze=await Promise.resolve(ze)))return;const _e=await Promise.resolve(a.showBusy(H.getLabel()));try{xe.doBatch(()=>{const Ne={...ze,...ie};xe.sort(Ne),xe.autoFit({orientations:Ne?.orientation===B.Orientation.Column?B.Orientations.Column:B.Orientations.Row,skipCustomSize:!0,minContent:!0})},H?.getLabel?.())}catch(Ne){_e(),a.showError(Ne)}_e()};let X=K.options;if(!Se)return void await le(X);let ae=xe;X.hasHeader&&(ae=xe.getIntersect(K.sortCoords)),ae.select();const Ie={range:xe,cell:Ee},ve={initialValue:X,context:()=>Ie,onInput:ze=>{le(ze)}};a.showWindow("sort",ve)},!1,!1,!1)},[a]),Z=ke(()=>{console.log("compactedSelection");const H=e.getSelection().getCoords(),ie=e.getSelectedRanges().getFlattened().getCoords(),Se=(ye=>{const xe=new Blob([ye],{type:"application/javascript"}),Ee=URL.createObjectURL(xe),K=new Worker(Ee);return URL.revokeObjectURL(Ee),K})("console.log('hello from worker');");setTimeout(()=>{Se.terminate(),console.log("Worker terminated")},5e3);let j=-1;for(let ye=0;j===-1&&ye<ie.length;ye++)q.isCellWithinRange(H.cell,ie[ye])&&(j=ye);if(q.isEqualRangesArrays(H.ranges,ie))return;const se={cell:H.cell,ranges:ie,rangeIndex:j};e.getSelection().updateCoords(se)},[e]),Y=ke(()=>{console.log("selectComments")},[e]),we=ke(async(H=!1,ie=!1)=>{let Se=null;if(ie)Se=e.getEntireRange();else{const j=e.getSelectedRange();if(j.isEntireRange()){const se=e.getSelection().getCoords().cell,ye=e.getRange(se);Se=ye.getSurrounding(),Se.isEntireRange()&&(Se=ye)}else Se=j.getSurrounding({contentOnly:H})}Se&&await Se.select()},[e]),ge=ke((H,ie,Se)=>{F(H,async j=>{let se=j.getSelectedRanges();Se&&(ie===B.Orientation.Row?se=se.getEntireRows():ie===B.Orientation.Column&&(se=se.getEntireColumns())),se.delete(ie)},"Delete Cells")},[e]);ke(async H=>{let ie=null;const Se=d(),j=Math.min(Se.width-8,480),se=Math.min(Se.height-8,288);try{e.getSelectedRanges(),ie=await e.getMovables().add({bounds:{x:Se.left+(Se.width-j)/2,y:Se.top+(Se.height-se)/2,width:j,height:se},type:"chart",json:H.template}),ie.select(),b.setMode(null)}catch(ye){a.showError(ye)}return ie},[e,a]);const de=ke(async(H,ie,Se)=>{const j=await a.showBusy(H.getLabel());try{const se=await e.getMovables().addImage(ie,{autoSelect:!0,...Se});return j(),b.setMode(null),se}catch(se){j();let ye=se;typeof ye!="string"&&(console.warn(se),ye="Unable to resolve image."),a.showMessage(ye,{type:jd.Error})}},[e,a]),be=ke((H,ie)=>{F(H,async Se=>{const j=Se.getSelectedRanges();j.doBatch(()=>{const se=ie===B.Direction.Up||ie===B.Direction.Down,ye=j.getCoords().slice().sort(q.createRangeComparator(se?B.Orientation.Row:B.Orientation.Column));for(let xe=0;xe<ye.length;xe++){const Ee=ye[xe];let K=Ee;const le=Se.getRange(K).getMerges();let X=0,ae=0;if(le.length>0){const Ie=le[0];X=Ie.rowEnd-Ie.rowStart,ae=Ie.colEnd-Ie.colStart}ie===B.Direction.Left?K={...Ee,colStart:Ee.colEnd+ae}:ie===B.Direction.Right?K={...Ee,colEnd:Ee.colStart+ae}:ie===B.Direction.Up?K={...Ee,rowStart:Ee.rowEnd+X}:ie===B.Direction.Down&&(K={...Ee,rowEnd:Ee.rowStart+X}),Se.getRange(K).autoFill(Ee,{filler:Fi.Types.Copy}),Se.getRange(Ee).autoFit({orientations:B.Orientations.Row,skipCustomSize:!0,minContent:!0})}},{autoSelect:!0,description:H.getLabel()})})},[a]),he=ke(()=>{let H=null;const ie=e.getSelectedCell().getCoords();if(ie?.rowIndex>0){const Se=e.getRange({rowIndex:ie.rowIndex-1,colIndex:ie.colIndex}).getCell();Se&&(H=Se.toTextUnformatted(!0))}u?.({text:H})},[e]),fe=M.useMemo(()=>[new Ae("gridlinesToggle",o,{label:"Gridlines",scopedLabels:{view:"Gridlines"},description:"Toggle whether the lines between rows and columns in the sheet are displayed."}),new Ae("sheetViewToggleGridlinesRows",o,{label:"Row Gridlines",scopedLabels:{view:"Row Gridlines",gridlines:"Rows"},description:"Toggle whether the lines between rows in the sheet are displayed."}),new Ae("sheetViewToggleGridlinesColumns",o,{label:"Column Gridlines",scopedLabels:{view:"Columns Gridlines",gridlines:"Columns"},description:"Toggle whether the lines between columns in the sheet are displayed."}),new Ae("sheetViewFormatGridlinesColor",o,{label:"Gridlines Color",description:"Color the rows and column gridlines."}),new Ae("sheetViewToggleShowHeadings",o,{label:"Headings",scopedLabels:{view:"Headings"},description:"Toggle whether the row and column headings are displayed."}),new Ae("sheetViewToggleShowHeadingRows",o,{label:"Row Headings",scopedLabels:{view:"Row Headings",headings:"Rows"},description:"Toggle whether the row headings are displayed."}),new Ae("sheetViewToggleShowHeadingColumns",o,{label:"Column Headings",scopedLabels:{view:"Columns Headings",headings:"Columns"},description:"Toggle whether the column headings are displayed."}),new Ae("sheetViewToggleShowHeadingsNumeric",o,{label:"Numeric Headers",description:"Toggle whether cell headings show numbers or A1 conventions.",shortcut:{key:"h",modifiers:[Oe.Ctrl,Oe.Shift]}}),new Ae("sheetViewToggleFormulaView",o,{label:"Show Formulas",description:"Toggle whether cells show formula or values.",icon:"FormulaView",shortcut:[{key:"`",modifiers:[Oe.Ctrl]},{key:"`",modifiers:[Oe.Ctrl,Oe.Shift]}]}),new Ae("sheetViewToggleShowZeros",o,{label:"Show Zeros",description:"Toggle whether cell with zero value shows '0' or blank.",icon:"ViewZero"}),new tt("selectComments",o,{label:"Select Comments",description:"Select the cells with comments.",shortcut:{key:"O",modifiers:[Oe.Ctrl,Oe.Shift]}},()=>Y()),new Ae("selectAll",o,{label:"Select All",description:"Select the closest data or the entire sheet if no data is nearby.",shortcut:[{key:"A",modifiers:[Oe.Ctrl]},{key:"Space",modifiers:[Oe.Ctrl,Oe.Shift]}]},(H=!1)=>we(!1,H)),new tt("selectRegion",o,{label:"Select Region",description:"Select the closest data.",shortcut:{key:"*",modifiers:[Oe.Ctrl,Oe.Shift]}},()=>we(!0,!1)),new tt("breakSelection",o,{label:"Select Visible",description:"Break the selection based on hidden rows and columns.",shortcut:{key:"Semicolon",modifiers:[Oe.Ctrl,Oe.Alt]}},()=>Z()),new tt("formatTextRotate0",o,{label:"No Text Rotation",description:"Remove all text rotation.",icon:"TextRotation315"}),new tt("formatTextRotate45",o,{label:"Angle Clockwise",description:"Angle text 45 degrees downward.",icon:"TextRotation45"}),new tt("formatTextRotate90",o,{label:"Rotate Text Down",description:"Angle your text so that it aligns with the left.",icon:"TextRotation90"}),new tt("formatTextRotate270",o,{label:"Rotate Text Up",description:"Angle your text so that it aligns with the right.",icon:"TextRotation2702"}),new tt("formatTextRotate315",o,{label:"Angle Counterclockwise",description:"Angle text 45 degrees upward.",icon:"TextRotation315"}),new Ae("formatTextRotateCustom",o,{label:"Custom Text Rotation",description:"Angle your text using a custom angle.",icon:"TextRotationCustom"}),new tt("formatTextRotateVertical",o,{label:"Vertical Text",description:"Stack text vertically.",icon:"TextRotationVertical"}),new tt("sortAscending",o,{label:"Sort Ascending",scopedLabels:{sort:"Ascending",sortFilter:"Ascending"},description:"Lowest to Highest.",icon:"SortIncrease"},function(){oe(this,{reverse:!1},!1)}),new tt("sortDescending",o,{label:"Sort Descending",scopedLabels:{sort:"Descending",sortFilter:"Descending"},description:"Highest to Lowest.",icon:"SortDecrease"},function(){oe(this,{reverse:!0},!1)}),new tt("sortCustom",o,{label:"Custom Sort…",scopedLabels:{sort:"Custom…",sortFilter:"Custom…"},description:"Choose more options, such as sorting by multiple columns or rows, and case-sensitive sorts.",icon:"SortCustom"},function(){oe(this,{},!0)}),new Ae("protectionSheetToggle",o,{label:"Protect Sheet",scopedLabels:{sheet:"Protected"},description:`Prevent unwanted changes from others by limiting their ability to edit.
For example, you can prevent people from editing locked cells or making formatting changes.`,icon:"Lock"}),new Ae("formatSheetTabColor",o,{label:"Tab Color",description:"Color the tab to help differentiate for other sheets.",icon:"stroke.colored"}),new Ae("formatCellStyle",o,{label:"Cell Styles",scopedLabels:{cellStyle:"Apply"},description:"A colorful style is a great way to make important data stand out on the sheet.",icon:"PresetStyles"},function(H){k(this,{named:H.getName()},!0)}),new Ae("formatTableStyle",o,{label:"Format as Table",scopedLabels:{table:"Apply (Keep Styles)"},description:"Create a table or apply style to the current table.",icon:"PresetStyles"},function(H){ee(this,H)}),new Ae("formatTableStyleClearCellStyles",o,{label:"Format as Table (Clear Styles)",scopedLabels:{table:"Apply (Clear Styles)"},icon:"PresetStyles",description:"Create a table or apply style to the current table and clears all cell styles."},function(H){ee(this,H,!0)}),new Ae("formatTableStyleClearTableStyle",o,{label:"Clear Table Style",scopedLabels:{table:"Clear Style"},icon:"ClearFormats",description:"Remove all the styling that is specific for the table."},function(){ee(this,{name:null},!0)}),new Ae("setDefaultTableStyle",o,{label:"Set Default Table Style",scopedLabels:{table:"Set As Default"},description:"Sets the default table style used when a table is inserted."},te),new Ae("deleteTableStyle",o,{label:"Delete Table Style",scopedLabels:{table:"Delete"},description:"Remove the current table style."},Q),new Ae("formatBorder",o,{label:"Border",description:"Create an outline border."},function(H){k(this,{border:H})}),new Ae("formatFillColor",o,{label:"Fill Color",description:"Color the background of the cells to make them stand out."},function(H){k(this,{fill:H})}),new Ae("formatFontColor",o,{label:"Font Color",description:"Change the color of your text."},function(H){k(this,{font:{fill:H}})}),new Ae("formatBoldToggle",o,{label:"Bold",description:"Toggle bold formatting of text.",icon:"TextBold",shortcut:[{key:"B",modifiers:[Oe.Ctrl]},{key:"2",modifiers:[Oe.Ctrl]}]}),new Ae("formatItalicToggle",o,{label:"Italic",description:"Toggle italic formatting of text.",icon:"TextItalic",shortcut:[{key:"I",modifiers:[Oe.Ctrl]},{key:"3",modifiers:[Oe.Ctrl]}]}),new Ae("formatUnderlinedToggle",o,{label:"Underline",scopedLabels:{underline:"Single"},description:"Underline the text.",icon:"TextUnderline",shortcut:[{key:"u",modifiers:[Oe.Ctrl]},{key:"4",modifiers:[Oe.Ctrl]}]}),new Ae("formatUnderlinedDoubleToggle",o,{label:"Double Underline",scopedLabels:{underline:"Double"},description:"Double underline the text.",icon:"TextUnderlineDouble"}),new Ae("formatUnderlinedAccountingToggle",o,{label:"Accounting Underline",scopedLabels:{underline:"Accounting"},description:"Use accounting underline for the text.",icon:"TextUnderlineAccounting"}),new Ae("formatUnderlinedAccountingDoubleToggle",o,{label:"Double Accounting Underline",scopedLabels:{underline:"Double Accounting"},description:"Use accounting double underline the text.",icon:"TextUnderlineAccountingDouble"}),new Ae("formatStrikeThroughToggle",o,{label:"Strikethrough",description:"Toggle strike-through formatting of text.",icon:"TextStrike",shortcut:{key:"5",modifiers:[Oe.Ctrl]}}),new Ae("formatSuperscriptToggle",o,{label:"Superscript",description:"Format your text to be smaller and sit at the top of the line.",icon:"TextSuperscript"}),new Ae("formatSubscriptToggle",o,{label:"Subscript",description:"Format your text to be smaller and sit at the bottom of the line.",icon:"TextSubscript"}),new Ae("formatAlignTopToggle",o,{label:"Align Top",description:"Align text to the top.",icon:"TextVerticalTop"}),new Ae("formatTextOverflowVisibleToggle",o,{label:"Overflow Text",description:"Overflow text to the next cells.",icon:"TextHorizontalOverflow"}),new Ae("formatTextOverflowWrapToggle",o,{label:"Wrap Text",description:"Wrap text with the existing cell and increase the height as required.",icon:"TextHorizontalWrap"}),new Ae("formatTextOverflowClipToggle",o,{label:"Clip Text",description:"Clip text that falls outside of the existing cell.",icon:"TextHorizontalClip"}),new Ae("formatTextOverflowShrinkToggle",o,{label:"Shrink Text",description:"Shrink the text font to fit within existing cell.",icon:"TextHorizontalShrink"}),new Ae("formatTextOverflowEllipsisToggle",o,{label:"Ellipsis Text",description:"Add a trailing '…' to the text to indicate text is partially hidden."}),new Ae("formatAlignMiddleToggle",o,{label:"Align Middle",description:"Align text so that it is centered between the top and bottom of the cell.",icon:"TextVerticalCenter"}),new Ae("formatAlignBottomToggle",o,{label:"Align Bottom",description:"Align text to the bottom.",icon:"TextVerticalBottom"}),new Ae("formatAlignJustifyVerticalToggle",o,{label:"Justify Vertically",description:"Each 'word' in each line of text inside the cell is evenly distributed across the height of the cell.",icon:"FormatAlignJustify"}),new Ae("formatAlignDistributedVerticalToggle",o,{label:"Distribute Vertically",description:"Justify your content vertically.",icon:"FormatAlignJustify"}),new Ae("formatAlignLeftToggle",o,{label:"Align Left",description:"Align your content to the left.",icon:"FormatAlignLeft"}),new Ae("formatAlignCenterToggle",o,{label:"Align Center",description:"Center your content.",icon:"FormatAlignCenter"}),new Ae("formatAlignRightToggle",o,{label:"Align Right",description:"Align your content to the right.",icon:"FormatAlignRight"}),new Ae("formatAlignJustifyToggle",o,{label:"Align Justify",description:"Justify your content.",icon:"FormatAlignJustify"}),new Ae("formatAlignCenterContinuousToggle",o,{label:"Center Across",description:"Center your content across multiple cells.",icon:"FormatAlignCenter"}),new Ae("formatAlignFillToggle",o,{label:"Fill Across",description:"Repeat the value to fill the entire cell.",icon:"FormatAlignJustify"}),new Ae("formatAlignDistributedHorizontalToggle",o,{label:"Distribute Horizontally",description:"Each 'word' in each line of text inside the cell is evenly distributed across the width of the cell.",icon:"FormatAlignJustify"}),new tt("formatFontSizeIncrease",o,{label:"Increase Font Size",description:"Make your text a bit bigger.",icon:"TextSizeIncrease",shortcut:{key:">",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){k(this,H=>({font:{size:wg.findNextFontSize(H.getFont().getSize(),!0)}}))}),new tt("formatFontSizeDecrease",o,{label:"Decrease Font Size",description:"Make your text a bit smaller.",icon:"TextSizeDecrease",shortcut:{key:"<",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){k(this,H=>({font:{size:wg.findNextFontSize(H.getFont().getSize(),!1)}}))}),new Ae("formatFontFamily",o,{label:"Font",description:"Select the font your text."},function(H){k(this,{font:{family:H}})}),new Ae("formatFontSize",o,{label:"Font Size",description:"Change the size of your text."},function(H){k(this,{font:{size:H}})}),new Ae("formatNumberDialog",o,{label:"Custom Number Format",scopedLabels:{numberFormat:"Custom"},description:"Create a custom number format.",shortcut:[{key:"1",modifiers:[Oe.Ctrl]},{key:"1",modifiers:[Oe.Ctrl,Oe.Alt]}]},function(H,ie){const Se=this,j={initialValue:H??ie.getState(),context:()=>ie.getContext(),onInput:(se,ye)=>{k(Se,{numberFormat:se})}};a.showWindow("numberFormat",j)}),new Ae("formatNumberFormat",o,{label:"Number Format",description:"Choose the format for your cells, such as percentage, currency, date or time."},function(H){k(this,{numberFormat:H})}),new Ae("formatNumberFormatGeneralStyle",o,{label:"General Style",description:"Remove all specific formatting.",shortcut:{key:"Backquote",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){k(this,{numberFormat:Ut.Type.General})}),new Ae("formatNumberFormatNumberStyle",o,{label:"Number Style",description:"Format as number with two decimals and comma.",shortcut:{key:"1",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){k(this,{numberFormat:"#,##0.00"})}),new Ae("formatNumberFormatTimeStyle",o,{label:"Time Style",description:"Format as time with hour and minute, and AM or PM.",shortcut:{key:"2",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){k(this,{numberFormat:"h:mm AM/PM"})}),new Ae("formatNumberFormatDateStyle",o,{label:"Date Style",description:"Format as date with day, month, and year.",shortcut:{key:"3",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){k(this,{numberFormat:"d-mmm-yy"})}),new Ae("formatNumberFormatAccountingStyle",o,{label:"Accounting Style",description:"Format as Dollars, Euros, or other currency.",icon:"CurrencyDollar",shortcut:{key:"4",modifiers:[Oe.Ctrl,Oe.Shift]}},function(H){k(this,{numberFormat:H??'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)'})}),new Ae("formatNumberFormatPercentStyle",o,{label:"Percent Style",description:"Format as a percent with no decimal places.",icon:"Percent",shortcut:{key:"5",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){k(this,{numberFormat:"0%"})}),new Ae("formatNumberFormatScientificStyle",o,{label:"Scientific Style",description:"Format as a scientific number with two decimal places .",shortcut:{key:"6",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){k(this,{numberFormat:"0.00E+00"})}),new Ae("formatNumberFormatCommaStyle",o,{label:"Comma Style",description:"Format with a thousands separator.",icon:"Comma",shortcut:{key:",",modifiers:[Oe.Ctrl]}},function(){k(this,{numberFormat:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)'})}),new Ae("formatNumberFormatIncreaseDecimal",o,{label:"Increase Decimal",description:"Show more decimal places for a more precise value.",icon:"IncreaseDecimal2"},function(){k(this,H=>({numberFormat:Ut.Parser.adjustDecimalPlaces(H.getNumberFormat(),1)}))}),new Ae("formatNumberFormatDecreaseDecimal",o,{label:"Decrease Decimal",description:"Show few decimal places.",icon:"DecreaseDecimal2"},function(){k(this,H=>({numberFormat:Ut.Parser.adjustDecimalPlaces(H.getNumberFormat(),-1)}))}),new Ae("displayPlaceholdersToggle",o,{label:"Display Placeholders",description:"Switch between hiding objects, displaying objects, and displaying placeholders for objects.",shortcut:{key:"6",modifiers:[Oe.Ctrl]}}),new tt("noOp",o,{label:"Do nothing",description:"Do Nothing.",shortcut:{key:"7",modifiers:[Oe.Ctrl]}},function(){}),new Ae("displayOutlineSymbolsToggle",o,{label:"Display Outline Symbols",description:"Display or hide the outline symbols.",shortcut:{key:"8",modifiers:[Oe.Ctrl]}}),new Ae("hideRows",o,{label:"Hide Rows",description:"Hide the rows.",icon:"HideRow",shortcut:{key:"9",modifiers:[Oe.Ctrl]}}),new Ae("unhideRows",o,{label:"Unhide Rows",description:"Unhide the rows.",icon:"ShowRow",shortcut:{key:"(",modifiers:[Oe.Ctrl,Oe.Shift]}}),new Ae("hideColumns",o,{label:"Hide Columns",description:"Hide the columns.",icon:"HideColumn",shortcut:[{key:"0",modifiers:[Oe.Ctrl]},{key:"0",modifiers:[Oe.Ctrl,Oe.Alt]}]}),new Ae("unhideColumns",o,{label:"Unhide Columns",description:"Unhide the columns.",icon:"ShowColumn",shortcut:{key:")",modifiers:[Oe.Ctrl,Oe.Shift]}}),new tt("calculate",o,{label:"Calculate Sheet",description:"Recalculate the formulas on the current sheet.",icon:"CalculateSheet",shortcut:{key:"=",modifiers:[Oe.Ctrl]}}),new Ae("insertFunction",o,{label:"Insert Function",disabled:!0,scopedLabels:{insert:"Function",insertFunction:"More Functions..."},description:"Work with the function in the current cell.",icon:"FunctionThin",shortcut:{key:"F3",modifiers:[Oe.Shift]}},function(H){H&&G(this,H.getName())}),new Ae("insertFunctionSum",o,{label:"Quick Sum",scopedLabels:{insertFunction:"Sum"},description:"Quick sum of the cells.",icon:"FunctionSum",shortcut:{key:"=",modifiers:[Oe.Alt]}},function(){G(this,"SUM")}),new Ae("insertFunctionAverage",o,{label:"Quick Average",scopedLabels:{insertFunction:"Average"},description:"Quick average of the cells."},function(){G(this,"AVERAGE")}),new Ae("insertFunctionCount",o,{label:"Quick Count",scopedLabels:{insertFunction:"Count Numbers"},description:"Quick count of the cells."},function(){G(this,"COUNT")}),new Ae("insertFunctionMax",o,{label:"Quick Max",scopedLabels:{insertFunction:"Max"},description:"Quick maximum of the cells."},function(){G(this,"MAX")}),new Ae("insertFunctionMin",o,{label:"Quick Min",scopedLabels:{insertFunction:"Min"},description:"Quick minimum of the cells."},function(){G(this,"MIN")}),new Ae("startEditCurrentTime",o,{label:"Current Time",description:"Insert the current time.",shortcut:{key:"Semicolon",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){u?.({text:e.createTemporaryCell({value:La.nowWithPrecision(),style:{numberFormat:"Medium Time"}}).toText()})}),new Ae("startEditCurrentDate",o,{label:"Current Date",description:"Insert the current date.",shortcut:{key:"Semicolon",modifiers:[Oe.Ctrl]}},function(){u?.({text:e.createTemporaryCell({value:La.nowWithPrecision(),style:{numberFormat:"Short Date"}}).toText()})}),new tt("sheetZoomOut",o,{label:"Zoom Out",description:"Zoom out to see less detail but more area.",shortcut:[{key:"-",modifiers:[Oe.Ctrl,Oe.Alt]},{key:"NumpadSubtract",modifiers:[Oe.Ctrl,Oe.Alt]}]}),new tt("sheetZoomIn",o,{label:"Zoom In",description:"Zoom in to see more detail but less area.",shortcut:[{key:"=",modifiers:[Oe.Ctrl,Oe.Alt]},{key:"NumpadAdd",modifiers:[Oe.Ctrl,Oe.Alt]}]}),new tt("sheetZoom100",o,{label:"Zoom 100%",description:"Zoom document to 100%.",shortcut:{key:"o",modifiers:[Oe.Ctrl,Oe.Alt]}}),new Ae("updateHyperlink",o,{label:"Link",scopedLabels:{contextMenu:"Insert Link…",insert:"Link…",hyperlink:"Edit"},description:"Create a hyperlink to either another webpage or another location within this document.",icon:"HyperlinkInset",context:()=>N().cell,shortcut:[{key:"K",modifiers:[Oe.Ctrl]},{key:"K",modifiers:[Oe.Ctrl,Oe.Alt]}]},async function(H,ie){const Se=this,j={context:()=>ie.getContext(),onInput:se=>{L(Se,se)}};a.showWindow("hyperlink",j)}),new Ae("openHyperlink",o,{label:"Open Link",scopedLabels:{hyperlink:"Open"},shortcut:{key:"Enter",modifiers:[Oe.Ctrl]},description:"Open the hyperlink or goto another location within this document.",icon:"HyperlinkGoto",context:()=>N().cell},async(H,ie)=>{const Se=ie.getContext();if(!Se)return;const j=Se.getHyperlink();if(j)try{await j.open()}catch(se){a.showError(se)}}),new Ae("deleteHyperlink",o,{label:"Delete Link",scopedLabels:{hyperlink:"Delete"},icon:"HyperlinkDelete",description:"Remove the hyperlink.",context:()=>N().cell},function(H,ie){L(this,null)}),new tt("insertNote",o,{label:"Insert Note",scopedLabels:{contextMenu:"Insert Note…",insert:"Note"},shortcut:{key:"F2",modifiers:[Oe.Shift]},description:"Add a note to the cell."},(H,ie)=>{((Se,j)=>{Se?.showMessage?.(pe.jsxs("p",{style:{marginTop:"0px",marginBottom:"0px"},children:[j," is not yet implemented.",pe.jsx("br",{}),pe.jsx("br",{}),"Please see the ",pe.jsx("a",{style:{whiteSpace:"nowrap"},href:"https://www.sheetxl.com/docs/guides/introduction/roadmap",target:"_blank",rel:"noopener",children:"SheetXL Roadmap"}),"."]}))})(a,ie.getLabel())}),new Ae("updateComments",o,{label:"Comments",scopedLabels:{contextMenu:"Insert Comments…",insert:"Comments…"},shortcut:{key:"M",modifiers:[Oe.Ctrl,Oe.Alt]},description:"Add a comment to the current cell.",icon:"CommentInsert",context:()=>N().cell},async function(H,ie){const Se=this,j={context:()=>ie.getContext(),onInput:se=>{W(Se,se)}};a.showWindow("comments",j)}),new Ae("deleteComments",o,{label:"Delete Comments",description:"Remove any comments.",icon:"CommentDelete",context:()=>N().cell},function(H,ie){W(this,null)}),new Ae("insertImageFromFile",o,{label:"Insert Image",scopedLabels:{contextMenu:"Insert Image…",insert:"Image…",insertImage:"From Device…"},description:"Insert a picture from your device.",icon:"InsertImage"},async function(H=null){let ie=null,Se=null;typeof H=="string"?Se=H:ie=H?.file?H.file:H,(ie||(ie=await P.openFileDialog(Se??"image/*"),ie))&&await de(this,{file:ie},H?.options)}),new Ae("insertImageFromURL",o,{label:"Insert Image From Web",scopedLabels:{insert:"Image From Web",insertImage:"From the Web…"},description:"Insert a picture from the web.",icon:"InsertImage"},async function(H){if(!H){const ie=await a.showInput({title:"Insert Image from Web",description:"Enter the web address for the image to insert.",inputLabel:"Address",initialValue:"https://picsum.photos/360",propsInput:{style:{minWidth:"440px"}},options:["Insert"]});if(ie.option!=="Insert")return;H=ie.input}H&&de(this,{fetch:H})}),new tt("insertTable",o,{label:"Insert Table",scopedLabels:{contextMenu:"Insert Table…",insert:"Table"},description:"Create a table. Tables enable auto formatting, sorting, filtering, and other advanced features.",icon:"InsertTable",shortcut:[{key:"L",modifiers:[Oe.Ctrl]},{key:"T",modifiers:[Oe.Alt,Oe.Ctrl]}]},function(){ee(this)}),new Ae("editTable",o,{label:"Edit Table…",scopedLabels:{table:"Edit…",namedItem:"Edit…"},description:"Edit the table to adjust formatting, sorting, filtering, or other advanced features.",icon:"InsertTable"},function(H){let ie=null,Se=!1;H.isITable?ie=H:H.getValue()&&(ie=H.getValue(),Se=!0),U(this,ie,Se)}),new Ae("deleteTable",o,{label:"Delete Table",scopedLabels:{delete:"Table",table:"Delete",namedItem:"Delete"},description:`Remove the table.

The table and table specific styling will be removed but the values will be preserved.`,icon:"InsertTable"},function(H){ue(this,H,!0)}),new Ae("convertTableToRange",o,{label:"Convert To Range",description:`Convert the table into a normal range  of cells.

The values and the formatting are preserved.`,icon:"InsertTable"},function(H){ue(this,H,!1)}),new Ae("tableTotalRowToggle",o,{label:"Toggle Table Total Row",description:"Toggle Total Row on/off.",scopedLabels:{table:"Total Row"},shortcut:{key:"T",modifiers:[Oe.Ctrl,Oe.Alt]}},function(){const H=this.getContext().table();H&&H.setShowTotals(!H.getShowTotals())}),new Ae("tableHeaderRowToggle",o,{label:"Toggle Table Header Row",description:"Toggle Header Row on/off.",scopedLabels:{table:"Header Row"}},function(){const H=this.getContext().table();H&&H.setShowHeaders(!H.getShowHeaders())}),new Ae("autoFilterToggle",o,{label:"Toggle Filter",scopedLabels:{filter:"Filter",sortFilter:"Filter"},description:"Toggle Auto Filter on/off.",icon:"FilterToggle",shortcut:{key:"L",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){const H=this.getContext().table();H&&H.setShowFilterButton(!H.getShowFilterButton())}),new Ae("autoFilterReapply",o,{label:"Reapply Filter",scopedLabels:{filter:"Reapply",sortFilter:"Reapply"},description:"Reapply the filter and sort with the latest changes.",icon:"FilterReapply",shortcut:{key:"L",modifiers:[Oe.Ctrl,Oe.Alt]}}),new Ae("autoFilterClear",o,{label:"Clear Filter",scopedLabels:{filter:"Clear",sortFilter:"Clear"},description:"Clear the filters criteria from the current filter..",icon:"FilterClear"}),new tt("startEditValueAbove",o,{label:"Copy From Above",description:"Copy the value from the cell above the active cell into the cell or the formula bar.",shortcut:[{key:"Quote",modifiers:[Oe.Ctrl]},{key:'"',modifiers:[Oe.Ctrl,Oe.Shift]}]},he),new Ae("formatPainterToggle",o,{label:"Format Painter",description:"Apply style to another part of your workbook.",icon:"FormatPaint.yellow"}),new tt("insertCells",o,{label:"Insert Cells",scopedLabels:{insertCells:"At Selection"},description:"Inserts cells at the current selection.",icon:"InsertCells",shortcut:{key:"=",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){J(this)}),new tt("insertCellsShiftRight",o,{label:"Insert Cells (Shift Right)",scopedLabels:{insertCells:"Shift Right"},description:"Insert cells to the left and shift the current cells to the right.",icon:"InsertCellsRight"},function(){J(this,B.Orientation.Column)}),new tt("insertCellsShiftDown",o,{label:"Insert Cells (Shift Down)",scopedLabels:{insertCells:"Shift Down"},description:"Insert cells above and shift the current cells downward.",icon:"InsertCellsDown"},function(){return J(this,B.Orientation.Row)}),new tt("insertRows",o,{label:"Insert Row(s)",scopedLabels:{insertCells:"Row(s)"},description:"Insert a row above the current position.",icon:"InsertRow"},function(){return J(this,B.Orientation.Row,!0)}),new tt("insertColumns",o,{label:"Insert Column(s)",scopedLabels:{insertCells:"Column(s)"},description:"Insert a column before the current position.",icon:"InsertColumn2"},function(){return J(this,B.Orientation.Column,!0)}),new tt("insertRowsAfter",o,{label:"Insert Row Below",scopedLabels:{insertCells:"Row Below"},description:"Insert a row below the current position."},function(){return J(this,B.Orientation.Row,!0,!0)}),new tt("insertColumnsAfter",o,{label:"Insert Column After",scopedLabels:{insertCells:"Column After"},description:"Insert a column after the current position."},function(){return J(this,B.Orientation.Column,!0,!0)}),new tt("deleteCells",o,{label:"Delete Cells",scopedLabels:{deleteCells:"At Selection"},description:"Delete the cells.",icon:"DeleteCells",shortcut:{key:"-",modifiers:[Oe.Ctrl]}},function(){return ge(this)}),new tt("deleteCellsShiftUp",o,{label:"Delete Cells (Shift Up)",scopedLabels:{deleteCells:"Shift up"},description:"Delete cells the current current downward.",icon:"DeleteCellsUp"},function(){return ge(this,B.Orientation.Row)}),new tt("deleteCellsShiftLeft",o,{label:"Delete Cells (Shift Left)",scopedLabels:{deleteCells:"Shift Left"},description:"Delete cells the current cells to the right.",icon:"DeleteCellsLeft"},function(){return ge(this,B.Orientation.Column)}),new tt("deleteRows",o,{label:"Delete Rows",scopedLabels:{deleteCells:"Rows"},description:"Delete the rows at the current selection.",icon:"DeleteRows"},function(){return ge(this,B.Orientation.Row,!0)}),new tt("deleteColumns",o,{label:"Delete Columns",scopedLabels:{deleteCells:"Columns"},description:"Delete the columns at the current selection.",icon:"DeleteColumns"},function(){return ge(this,B.Orientation.Column,!0)}),new tt("flashFill",o,{label:"Flash Fill",description:"Do a flash fill.",shortcut:[{key:"e",modifiers:[Oe.Ctrl]},{key:"e",modifiers:[Oe.Ctrl,Oe.Alt]}]}),new tt("fillDown",o,{label:"Fill Down",description:"Copy the top-most value from the selection to the bottom of the selection.",icon:"FillDown",shortcut:{key:"d",modifiers:[Oe.Ctrl]}},function(){return be(this,B.Direction.Down)}),new tt("fillRight",o,{label:"Fill Right",description:"Copy the left-most value from the selection to the right of the selection.",icon:"FillRight",shortcut:[{key:"r",modifiers:[Oe.Ctrl]}]},function(){return be(this,B.Direction.Right)}),new tt("fillUp",o,{label:"Fill Up",description:"Copy the bottom-most value from the selection to the top of the selection.",icon:"FillUp"},function(){return be(this,B.Direction.Up)}),new tt("fillLeft",o,{label:"Fill Left",description:"Copy the right-most value from the selection to the left of the selection.",icon:"FillLeft"},function(){return be(this,B.Direction.Left)}),new tt("formatBorderAddOutline",o,{label:"Add Outline Border",description:"Apply an outline border.",shortcut:{key:"7",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){return k(this,{border:{left:{style:Ce.StrokeStyle.Thin,color:null},top:{style:Ce.StrokeStyle.Thin,color:null},right:{style:Ce.StrokeStyle.Thin,color:null},bottom:{style:Ce.StrokeStyle.Thin,color:null}}})}),new tt("formatBorderClearOutline",o,{label:"Remove Outline Border",description:"Remove the outline border.",shortcut:{key:"_",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){return k(this,{border:null})}),new tt("formatIndentDecrease",o,{label:"Decrease Indent",description:"Move your content closer to the border.",icon:"FormatIndentDecrease"},function(){return k(this,H=>{const ie=H.getAlignment().getIndent()-1;return{alignment:{indent:ie>0?ie:0}}})}),new tt("formatIndentIncrease",o,{label:"Increase Indent",description:"Move your content further from the border.",icon:"FormatIndentIncrease"},function(){return k(this,H=>{const ie={alignment:{indent:H.getAlignment().getIndent()+1}};return H.getAlignment().getHorizontal()===ce.HorizontalAlignment.General&&(ie.alignment.horizontal=ce.HorizontalAlignment.Left),ie})}),new Ae("mergeToggle",o,{label:"Merge",description:"Combine and center the contents into a single cell.",icon:"MergeAll",shortcut:{key:"m",modifiers:[Oe.Ctrl]}}),new tt("mergeHorizontal",o,{label:"Merge Horizontally",description:"Combine the contents into horizontal rows.",icon:"MergeHorizontal"}),new tt("mergeVertical",o,{label:"Merge Vertically",description:"Combine the contents into vertical columns.",icon:"MergeVertical"}),new tt("unmerge",o,{label:"Unmerge",description:"Split merged cells into multiple cells.",icon:"MergeUnMerge"}),new tt("clearContents",o,{label:"Clear Contents",scopedLabels:{clear:"Contents"},icon:"ClearContents",description:`Clear only the contents in the cells.

The formatting is not cleared.`,shortcut:{key:"Delete"}},function(){$(this,ut.Content.Values)}),new tt("clearFormats",o,{label:"Clear Formats",scopedLabels:{clear:"Formats"},icon:"ClearFormats",description:"Clear only the formatting that is applied to the cells."},function(){$(this,ut.Content.Formats)}),new tt("clearHyperlinks",o,{label:"Clear Hyperlinks",scopedLabels:{clear:"Hyperlinks"},description:"Clear only the hyperlinks in the cells."},function(){$(this,ut.Content.Hyperlinks)}),new tt("clearComments",o,{label:"Clear Comments",scopedLabels:{clear:"Comments"},description:"Clear the comments from the cells."},function(){$(this,ut.Content.Comments)}),new tt("clearAll",o,{label:"Clear All",scopedLabels:{clear:"All"},icon:"ClearAll",description:`Clears everything from the cells.

All contents and formatting are removed.`,shortcut:{key:"Delete",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){$(this)}),new Ae("freezeToggle",o,{label:"Freeze Panes",description:"Keep rows and columns visible while the rest of the sheet scrolls (based on current selection).",icon:"FreezeBoth"}),new Ae("freezeToggleHorizontal",o,{label:"Freeze Top Rows",description:"Keep the top rows visible while scrolling through the rest of the sheet.",icon:"FreezeRows"}),new Ae("freezeToggleVertical",o,{label:"Freeze Left Columns",description:"Keep the left columns visible while scrolling through the rest of the sheet.",icon:"FreezeColumns"}),new tt("unfreeze",o,{label:"Unfreeze Panes",description:"Unfreeze both the rows and columns.",icon:"MergeUnMerge"}),new tt("autoFitRows",o,{label:"Autofit Rows",description:"Adjust the rows to the best height.",icon:"RowsResizeAuto"}),new tt("resizeRows",o,{label:"Resize Rows",description:"Resize the rows to the specified height.",icon:"RowsResize"}),new tt("autoFitColumns",o,{label:"Autofit Columns",description:"Adjust the columns to the best width.",icon:"ColumnsResizeAuto"}),new tt("resizeColumns",o,{label:"Resize Columns",description:"Resize the columns to the specified width.",icon:"ColumnsResize"})],[]),z=M.useMemo(()=>{let H=null;return H=r?r.createChildGroup(o,"sheet",!1):new Ua(o,"sheet"),H.addCommands(fe,!0),H},[r,fe]);Tp(r,null,{onChange:()=>{const H=!e.getProtection().isFormatCellsAllowed(),ie=b.getMode()?.key==="formatPainter";z.getCommand("formatPainterToggle").update({disabled:H||!r?.getCommand("copy"),state:()=>ie}).updateCallback(()=>ie?void b.setMode(null):z.getCommand("copy").execute({editMode:{key:"formatPainter",description:"Use the mouse to apply the copied format to another selection.",cursor:`url("data:image/svg+xml,%3Csvg width='30' height='22' viewBox='0 0 30 22' xmlns='http://www.w3.org/2000/svg' %3E%3Cg%3E%3Cpath d='M 26.737611,2.811068 V 2.0241451 c 0,-0.4328075 -0.354115,-0.7869227 -0.786923,-0.7869227 h -9.443074 c -0.432808,0 -0.786923,0.3541152 -0.786923,0.7869227 v 3.1476914 c 0,0.4328076 0.354115,0.7869235 0.786923,0.7869235 h 9.443074 c 0.432808,0 0.786923,-0.3541159 0.786923,-0.7869235 V 4.3849137 h 0.786923 v 3.1476915 h -7.869229 v 8.6561518 c 0,0.432808 0.354116,0.786923 0.786923,0.786923 h 1.573846 c 0.432807,0 0.786923,-0.354115 0.786923,-0.786923 V 9.1064513 H 29.09838 V 2.811068 Z M 10.714339,6.2116849 c -1.60877,0.0017 -3.2175361,0.00425 -4.8263048,0.00609 0.0012,1.5756989 0.00158,3.1513905 0.00244,4.7270891 -1.5978311,0.0017 -3.1956617,0.0034 -4.7934919,0.0043 0.00335,1.740011 0.00655,3.480012 0.00988,5.220023 1.5954589,0 3.1909181,0 4.7863775,0 -0.0017,1.606793 -0.00353,3.213585 -0.0051,4.820375 1.7440936,0.0016 3.4881881,0.0033 5.2322842,0.005 -0.0014,-1.608503 -0.0018,-3.217015 -0.0028,-4.825519 1.58518,0 3.17036,0 4.755543,0 0.0033,-1.741851 0.0073,-3.483705 0.01072,-5.225556 -1.58808,0 -3.176158,0 -4.764238,0 0,-1.5775391 0,-3.1550792 0,-4.7326117 -0.135065,1.3e-4 -0.270128,1.982e-4 -0.40519,4.047e-4 z' stroke='black' fill='white'/%3E%3C/g%3E%3C/svg%3E%0A") 7 12, pointer`}}))}},[b,C,r]),It(e.getView(),{onFreezeSplitChange:()=>{v()}});const Fe=()=>{z.getCommand("sheetViewFormatGridlinesColor").update({state:()=>e.getView().getGridLineColor(),context:()=>({onColorSelect:H=>{},darkMode:n.darkMode,autoColor:e.getStyles().parseColor(n.strokeFill),schemeLookup:e.getStyles().schemeLookup(),recentColors:()=>e.getStyles().recentColors(),addRecentColor:H=>e.getStyles().addRecentColor(H),clearRecentColors:()=>e.getStyles().clearRecentColors()})}),z.getCommand("formatSheetTabColor").updateCallback(H=>{e.setTabColor(H)}).update({state:()=>e?.getTabColor()??Bl,context:()=>({onColorSelect:H=>{},darkMode:n.darkMode,autoColor:Bl,schemeLookup:e.getStyles().schemeLookup(),recentColors:()=>e.getStyles().recentColors(),addRecentColor:H=>e.getStyles().addRecentColor(H),clearRecentColors:()=>e.getStyles().clearRecentColors()})})},De=()=>{z.getCommand("formatBorder").update({context:()=>({onBorderSelect:H=>{g(H)},darkMode:n.darkMode,quickBorder:f,autoColor:e.getStyles().getNormal().getFont().getFill(),autoStyle:Ce.StrokeStyle.Thin,createTemporaryBorder:H=>e.getStyles().getNormal().createTemporaryStyle({border:H}).getBorder(),schemeLookup:e.getStyles().schemeLookup()})})};M.useEffect(()=>{De()},[f]),M.useEffect(()=>{const H=!e.getProtection().isInsertHyperlinksAllowed(),ie=N(),Se=ie?.cell.getHyperlink();z.getCommand("openHyperlink").update({disabled:!Se}),z.getCommand("deleteHyperlink").update({disabled:H||!Se});const j=Se?"Edit":"Insert",se="Link";z.getCommand("updateHyperlink").update({label:()=>`${j} ${se}`,icon:()=>j==="Edit"?"HyperlinkEdit":"HyperlinkInsert",scopedLabels:{contextMenu:`${j} ${se}…`,insert:`${se}…`,hyperlink:`${j}…`},disabled:H})},[R,C]),M.useEffect(()=>{const H=N(),ie=H?.cell.getComments(),Se=()=>ie?"Edit":"Insert",j=()=>ie?"Comments":"Comment";z.getCommand("updateComments").update({label:()=>`${Se()} ${j()}`,icon:()=>ie?"CommentEdit":"CommentInsert",scopedLabels:{contextMenu:`${Se()} ${j()}…`,insert:`${j()}…`}})},[R,C]),It(e,{onViewChange:()=>{const H=e.getView();z.getCommand("sheetViewToggleFormulaView").update({state:H.isShowFormulas()}),z.getCommand("sheetViewToggleShowZeros").update({state:H.isShowZeros()}),z.getCommand("gridlinesToggle").update({state:H.isShowColumnGridlines()||H.isShowRowGridlines()}),z.getCommand("sheetViewToggleGridlinesColumns").update({state:H.isShowColumnGridlines()}),z.getCommand("sheetViewToggleGridlinesRows").update({state:H.isShowRowGridlines()}),z.getCommand("sheetViewToggleShowHeadings").update({state:H.isShowColumnHeaders()||H.isShowRowHeaders()}),z.getCommand("sheetViewToggleShowHeadingColumns").update({state:H.isShowColumnHeaders()}),z.getCommand("sheetViewToggleShowHeadingRows").update({state:H.isShowRowHeaders()}),z.getCommand("sheetViewToggleShowHeadingsNumeric").update({state:()=>e.getView().getColumnHeaderStyle()===dn.HeaderTextStyle.Zero&&e.getView().getRowHeaderStyle()===dn.HeaderTextStyle.Zero}),Fe()},onTabColorChange:()=>{Fe()},onMergesChange:()=>{v()},onMovablesChange:()=>{v()},onTablesChange:()=>{v()},onProtectionChange:()=>{v(),_()},onStyleChange:()=>{Fe(),De(),v()}}),M.useEffect(()=>{Fe(),De()},[n]),M.useEffect(()=>{const H=!e.getProtection().isFormatCellsAllowed(),ie=N(),Se=ie.table,j=ie.tables,se=j.length>0&&!Se||H,ye=re(Se),xe={context:ye};z.getCommand("editTable").update(xe),z.getCommand("deleteTable").update(xe),z.getCommand("convertTableToRange").update(xe);const Ee={context:ye,disabled:se};z.getCommand("formatTableStyle").update({label:Se?"Apply Table Style":"Format As Table",...Ee}),z.getCommand("formatTableStyleClearCellStyles").update(Ee),z.getCommand("deleteTableStyle").update(Ee),z.getCommand("convertTableToRange").update(Ee),z.getCommand("insertTable").update({disabled:se||j.length>0});const K={context:ye,disabled:se||j.length===0};z.getCommand("tableHeaderRowToggle").update(K),z.getCommand("tableTotalRowToggle").update(K),z.getCommand("autoFilterToggle").update(K),z.getCommand("formatTableStyleClearTableStyle").update({...K,disabled:K.disabled||!Se||Se.getStyleOptions().name===null})},[A,C]),M.useEffect(()=>{z.getCommand("sheetZoomOut").updateCallback(()=>{e.getView().update({zoomScale:P.findNextStep(e.getView().getZoomScale(),!1)})}),z.getCommand("sheetZoomIn").updateCallback(()=>{e.getView().update({zoomScale:P.findNextStep(e.getView().getZoomScale())})}),z.getCommand("sheetZoom100").updateCallback(()=>{e.getView().update({zoomScale:100})}),z.getCommand("gridlinesToggle").updateCallback(()=>{const H=e.getView().isShowColumnGridlines()&&e.getView().isShowRowGridlines();e.getView().update({showColumnGridlines:!H,showRowGridlines:!H})}),z.getCommand("sheetViewToggleGridlinesRows").updateCallback(()=>{e.getView().update({showRowGridlines:!e.getView().isShowRowGridlines()})}),z.getCommand("sheetViewToggleGridlinesColumns").updateCallback(()=>{e.getView().update({showColumnGridlines:!e.getView().isShowColumnGridlines()})}),z.getCommand("sheetViewFormatGridlinesColor").updateCallback(H=>{e.getView().update({gridLineColor:H})}),z.getCommand("sheetViewToggleShowHeadings").updateCallback(()=>{const H=e.getView().isShowColumnHeaders()&&e.getView().isShowRowHeaders();e.getView().update({showColumnHeaders:!H,showRowHeaders:!H})}),z.getCommand("sheetViewToggleShowHeadingColumns").updateCallback(()=>{e.getView().update({showColumnHeaders:!e.getView().isShowColumnHeaders()})}),z.getCommand("sheetViewToggleShowHeadingRows").updateCallback(()=>{e.getView().update({showRowHeaders:!e.getView().isShowRowHeaders()})}),z.getCommand("sheetViewToggleShowHeadingsNumeric").updateCallback(()=>{const H=e.getView().getColumnHeaderStyle()===dn.HeaderTextStyle.Zero&&e.getView().getRowHeaderStyle()===dn.HeaderTextStyle.Zero;e.getView().update({columnHeaderStyle:H?dn.HeaderTextStyle.A1:dn.HeaderTextStyle.Zero,rowHeaderStyle:H?dn.HeaderTextStyle.One:dn.HeaderTextStyle.Zero})}),z.getCommand("sheetViewToggleFormulaView").updateCallback(()=>{e.getView().update({showFormulas:!e.getView().isShowFormulas()})}),z.getCommand("sheetViewToggleShowZeros").updateCallback(()=>{e.getView().update({showZeros:!e.getView().isShowZeros()})}),z.getCommand("calculate").updateCallback(()=>{e.getEntireRange().calculate(!0)}),z.getCommand("insertFunction").update({context:()=>({searchByCategory:async H=>{const ie=e.getWorkbook();if(!ie)return P.EmptyArray;const Se=await ie.getScripts().searchFunctions({category:H,includeBuiltIn:!0});return Se.sort((j,se)=>j.getName().localeCompare(se.getName())),Se}})})},[e]),M.useEffect(()=>{const H=N()?.cell.getCoords(),ie=e.getView().getFreezePanes(),Se=()=>ie.coords.rowIndex!==0,j=()=>ie.coords.colIndex!==0,se=()=>ie.coords.rowIndex!==0||ie.coords.colIndex!==0;z.getCommand("freezeToggle").updateCallback(()=>{se()?e.getView().setFreezePanes(null):se()?j()?e.getView().setFreezePanes({coords:{rowIndex:H.rowIndex}}):Se()&&e.getView().setFreezePanes({coords:{colIndex:H.colIndex}}):e.getView().setFreezePanes({coords:H})}).update({state:se,disabled:()=>!H||!se()&&H.rowIndex===0&&H.colIndex===0}),z.getCommand("freezeToggleHorizontal").updateCallback(()=>{e.getView().setFreezePanes({coords:{rowIndex:Se()?0:H.rowIndex}})}).update({state:Se,disabled:()=>!H||!Se()&&H.rowIndex===0}),z.getCommand("freezeToggleVertical").updateCallback(()=>{e.getView().setFreezePanes({coords:{colIndex:j()?0:H.colIndex}})}).update({state:j,disabled:()=>!H||!j()&&H.colIndex===0}),z.getCommand("unfreeze").updateCallback(()=>{e.getView().setFreezePanes(null)}).update({disabled:()=>!se()})},[y,R,e,n]);const Ge=e?.getSelectedCell().getStyle();return M.useEffect(()=>{const H=Ge.getFont(),ie=Ge.getAlignment(),Se=ie.getHorizontal(),j=ie.getVertical(),se=ie.getOverflow(),ye=ie.getRotation();z.getCommand("formatCellStyle").update({context:()=>({styles:()=>e.getStyles(),named:()=>N().cell.getStyle(!0).getNamed(),bodyStyle:ne,createTemporaryCell:Ue=>e.createTemporaryCell(Ue)})}),z.getCommand("formatFillColor").update({state:()=>{let Ue=null;const Ke=Ge.getFill();return Ke?.getType()===He.Type.Solid?Ue=Ke.getColor():Ke?.getType()===He.Type.Gradient?Ue=Ke.getStops()?.[0]?.getColor():Ke?.getType()===He.Type.Pattern&&(Ue=Ke.getBackground()),Ue},icon:()=>pe.jsx(Uu,{iconKey:"fill.colored"}),context:()=>{const Ue=e.getStyles();return{onColorSelect:Ke=>{p(Ke??Bl)},darkMode:n.darkMode,quickColor:m,autoColor:Bl,schemeLookup:Ue.schemeLookup(),recentColors:Ue.recentColors(),addRecentColor:Ke=>Ue.addRecentColor(Ke),clearRecentColors:()=>Ue.clearRecentColors()}}}),z.getCommand("formatFontColor").update({state:()=>H.toJSON()?.fill?H.getFill():null,icon:()=>pe.jsx(Uu,{iconKey:"text.colored"}),context:()=>{const Ue=e.getStyles();return{onColorSelect:Ke=>{w(Ke)},darkMode:n.darkMode,quickColor:S,autoColor:Ue.getNormal().getFont().getFill(),schemeLookup:Ue.schemeLookup(),recentColors:Ue.recentColors(),addRecentColor:Ke=>Ue.addRecentColor(Ke),clearRecentColors:()=>Ue.clearRecentColors()}}}),z.getCommand("formatNumberFormat").update({state:()=>Ge.getNumberFormat(),context:()=>N().cell}),z.getCommand("formatNumberDialog").update({state:()=>Ge.getNumberFormat(),context:()=>N().cell}),z.getCommand("formatFontFamily").update({state:()=>H.getFamily()}),z.getCommand("formatFontSize").update({state:()=>H.getSize()});const xe=function(){const Ue=H.getWeight()||0;return!isNaN(Ue)&&Ue>500};z.getCommand("formatBoldToggle").updateCallback(function(){k(this,{font:{weight:xe()?400:700}})}).update({state:xe});const Ee=function(){return H.getStyle()===Be.Style.Italic};z.getCommand("formatItalicToggle").updateCallback(function(){k(this,{font:{style:Ee()?Be.Style.Normal:Be.Style.Italic}})}).update({state:Ee}),z.getCommand("formatStrikeThroughToggle").updateCallback(function(){k(this,{font:{strike:!H.getStrike()}})}).update({state:H.getStrike()}),z.getCommand("formatUnderlinedToggle").updateCallback(function(){k(this,{font:{underline:H.getUnderline()!==Be.UnderlineStyle.Single?Be.UnderlineStyle.Single:Be.UnderlineStyle.None}})}).update({state:H.getUnderline()===Be.UnderlineStyle.Single}),z.getCommand("formatUnderlinedDoubleToggle").updateCallback(function(){k(this,{font:{underline:H.getUnderline()!==Be.UnderlineStyle.Double?Be.UnderlineStyle.Double:Be.UnderlineStyle.None}})}).update({state:H.getUnderline()===Be.UnderlineStyle.Double}),z.getCommand("formatUnderlinedAccountingToggle").updateCallback(function(){k(this,{font:{underline:H.getUnderline()!==Be.UnderlineStyle.SingleAccounting?Be.UnderlineStyle.SingleAccounting:Be.UnderlineStyle.None}})}).update({state:H.getUnderline()===Be.UnderlineStyle.SingleAccounting}),z.getCommand("formatUnderlinedAccountingDoubleToggle").updateCallback(function(){k(this,{font:{underline:H.getUnderline()!==Be.UnderlineStyle.DoubleAccounting?Be.UnderlineStyle.DoubleAccounting:Be.UnderlineStyle.None}})}).update({state:H.getUnderline()===Be.UnderlineStyle.DoubleAccounting}),z.getCommand("formatSuperscriptToggle").updateCallback(function(){k(this,{font:{verticalAlign:H.getVerticalAlignment()!==Be.VerticalAlignment.Super?Be.VerticalAlignment.Super:Be.VerticalAlignment.Baseline}})}).update({state:H.getVerticalAlignment()===Be.VerticalAlignment.Super}),z.getCommand("formatSubscriptToggle").updateCallback(function(){k(this,{font:{verticalAlign:H.getVerticalAlignment()!==Be.VerticalAlignment.Sub?Be.VerticalAlignment.Sub:Be.VerticalAlignment.Baseline}})}).update({state:H.getVerticalAlignment()===Be.VerticalAlignment.Sub});const K=()=>se===ce.Overflow.Visible;z.getCommand("formatTextOverflowVisibleToggle").updateCallback(function(){k(this,{alignment:{overflow:(K(),ce.Overflow.Visible)}})}).update({state:K});const le=()=>se===ce.Overflow.Wrap;z.getCommand("formatTextOverflowWrapToggle").updateCallback(function(){k(this,{alignment:{overflow:le()?ce.Overflow.Visible:ce.Overflow.Wrap}})}).update({state:le});const X=function(){return se===ce.Overflow.Clip};z.getCommand("formatTextOverflowClipToggle").updateCallback(function(){k(this,{alignment:{overflow:X()?ce.Overflow.Visible:ce.Overflow.Clip}})}).update({state:X});const ae=function(){return se===ce.Overflow.Shrink};z.getCommand("formatTextOverflowShrinkToggle").updateCallback(function(){k(this,{alignment:{overflow:ae()?ce.Overflow.Visible:ce.Overflow.Shrink}})}).update({state:ae});const Ie=function(){return se===ce.Overflow.Shrink};z.getCommand("formatTextOverflowEllipsisToggle").updateCallback(function(){k(this,{alignment:{overflow:Ie()?ce.Overflow.Visible:ce.Overflow.Ellipsis}})}).update({state:Ie,disabled:!0});const ve=function(){return j===ce.VerticalAlignment.Top};z.getCommand("formatAlignTopToggle").updateCallback(function(){k(this,{alignment:{vertical:ve()?ce.VerticalAlignment.Bottom:ce.VerticalAlignment.Top}})}).update({state:ve});const ze=function(){return j===ce.VerticalAlignment.Center};z.getCommand("formatAlignMiddleToggle").updateCallback(function(){k(this,{alignment:{vertical:ze()?ce.VerticalAlignment.Bottom:ce.VerticalAlignment.Center}})}).update({state:ze});const _e=function(){return j===ce.VerticalAlignment.Bottom};z.getCommand("formatAlignBottomToggle").updateCallback(function(){k(this,{alignment:{vertical:(_e(),ce.VerticalAlignment.Bottom)}})}).update({state:_e});const Ne=function(){return j===ce.VerticalAlignment.Justify};z.getCommand("formatAlignJustifyVerticalToggle").updateCallback(function(){k(this,{alignment:{vertical:Ne()?ce.VerticalAlignment.Bottom:ce.VerticalAlignment.Justify}})}).update({state:Ne});const me=function(){return j===ce.VerticalAlignment.Distributed};z.getCommand("formatAlignDistributedVerticalToggle").updateCallback(function(){k(this,{alignment:{vertical:me()?ce.VerticalAlignment.Bottom:ce.VerticalAlignment.Distributed}})}).update({state:me});const Re=function(){return Se===ce.HorizontalAlignment.Left};z.getCommand("formatAlignLeftToggle").updateCallback(function(){k(this,{alignment:{horizontal:Re()?ce.HorizontalAlignment.General:ce.HorizontalAlignment.Left}})}).update({state:Re});const Me=function(){return Se===ce.HorizontalAlignment.Center};z.getCommand("formatAlignCenterToggle").updateCallback(function(){k(this,{alignment:{horizontal:Me()?ce.HorizontalAlignment.General:ce.HorizontalAlignment.Center}})}).update({state:Me});const qe=function(){return Se===ce.HorizontalAlignment.CenterContinuous};z.getCommand("formatAlignCenterContinuousToggle").updateCallback(function(){const Ue={alignment:{horizontal:qe()?ce.HorizontalAlignment.General:ce.HorizontalAlignment.CenterContinuous,rotation:null}};k(this,Ue)}).update({state:qe});const nt=function(){return Se===ce.HorizontalAlignment.Fill};z.getCommand("formatAlignFillToggle").updateCallback(function(){const Ue={alignment:{horizontal:nt()?ce.HorizontalAlignment.General:ce.HorizontalAlignment.Fill,rotation:null}};k(this,Ue)}).update({state:nt});const Ye=function(){return Se===ce.HorizontalAlignment.Distributed};z.getCommand("formatAlignDistributedHorizontalToggle").updateCallback(function(){k(this,{alignment:{horizontal:Ye()?ce.HorizontalAlignment.General:ce.HorizontalAlignment.Distributed}})}).update({state:Ye});const Ve=function(){return Se===ce.HorizontalAlignment.Right};z.getCommand("formatAlignRightToggle").updateCallback(function(){k(this,{alignment:{horizontal:Ve()?ce.HorizontalAlignment.General:ce.HorizontalAlignment.Right}})}).update({state:Ve});const et=function(){return Se===ce.HorizontalAlignment.Justify};z.getCommand("formatAlignJustifyToggle").updateCallback(function(){k(this,{alignment:{horizontal:et()?ce.HorizontalAlignment.General:ce.HorizontalAlignment.Justify}})}).update({state:et});const We=!e.getProtection().isFormatCellsAllowed(),Xe=Se===ce.HorizontalAlignment.CenterContinuous||Se===ce.HorizontalAlignment.Fill;z.getCommand("formatTextRotate0").updateCallback(function(Ue){k(this,{alignment:{rotation:0}})}).update({disabled:We||Xe,state:ye===0}),z.getCommand("formatTextRotate45").updateCallback(function(Ue){k(this,{alignment:{rotation:Ue??1?45:0}})}).update({disabled:We||Xe,state:ye===45}),z.getCommand("formatTextRotate90").updateCallback(function(Ue){k(this,{alignment:{rotation:Ue??1?90:0}})}).update({disabled:We||Xe,state:ye===90}),z.getCommand("formatTextRotate270").updateCallback(function(Ue){k(this,{alignment:{rotation:Ue??1?270:0}})}).update({disabled:We||Xe,state:ye===270}),z.getCommand("formatTextRotate315").updateCallback(function(Ue){k(this,{alignment:{rotation:Ue??1?315:0}})}).update({disabled:We||Xe,state:ye===315}),z.getCommand("formatTextRotateCustom").updateCallback(function(Ue){k(this,{alignment:{rotation:Ue}})}).update({disabled:We||Xe,state:ye??0})},[Ge,e,n,m,S]),M.useEffect(()=>{const H=!e.getProtection().isFormatCellsAllowed(),ie=N(),Se=ie.containsMerge,j=ie.tables.length===0&&!ie.isOverlapping&&(Se||!ie.isSingleCell),se=async(lt,Bt)=>{F(Bt,async zt=>{const vt=async(Fn=!1)=>{const $n=await Promise.resolve(a.showBusy(Bt.getLabel()));try{const on=zt.getSelectedRanges();if(on.merge({orientations:lt,discardMultipleValues:Fn}),lt===B.Orientations.Both){const bn={alignment:{horizontal:ce.HorizontalAlignment.Center}};on.getStyle().update(bn)}}catch(on){throw on}finally{$n?.()}};let qt;try{await vt()}catch(Fn){if(Fn.type!=="discardMultipleValues")throw Fn;qt=!0}if(qt&&a.showOptions){if(await a.showOptions({title:"Confirm",description:"Merging cells will only keep the upper-left value. Some data will be discarded. Continue?",options:["Merge","Cancel"],defaultOption:"Merge"})!=="Merge")return;await vt(!0)}},void 0,void 0,!1)},ye=lt=>{F(lt,async Bt=>{try{const zt=Bt.getSelectedRanges();zt.unmerge();const vt={alignment:{horizontal:null}};zt.getStyle().update(vt)}catch(zt){throw zt}})};z.getCommand("mergeToggle").updateCallback(function(){q.isSingleCell(e.getSelectedRange().getCoords())||(Se?ye(this):se(B.Orientations.Both,this))}).update({state:Se,disabled:!j||H}),z.getCommand("mergeHorizontal").updateCallback(function(){se(B.Orientations.Column,this)}).update({disabled:!j||H}),z.getCommand("mergeVertical").updateCallback(function(){se(B.Orientations.Row,this)}).update({disabled:!j}),z.getCommand("unmerge").updateCallback(function(){ye(this)}).update({disabled:!Se||!j||H});const xe={disabled:H};z.getCommand("hideRows").updateCallback(function(){F(this,lt=>{lt.getSelectedRanges().getRowHeaders().setHidden(!0)})}).update(xe),z.getCommand("hideColumns").updateCallback(function(){F(this,lt=>{lt.getSelectedRanges().getColumnHeaders().setHidden(!0)})}).update(xe),z.getCommand("unhideRows").updateCallback(function(){F(this,lt=>{lt.getSelectedRanges().getRowHeaders().setHidden(!1)})}).update(xe),z.getCommand("unhideColumns").updateCallback(function(){F(this,lt=>{lt.getSelectedRanges().getColumnHeaders().setHidden(!1)})}).update(xe),z.getCommand("autoFitRows").updateCallback(function(){F(this,lt=>{lt.getSelectedRanges().autoFit({orientations:B.Orientations.Row})})}).update(xe),z.getCommand("resizeRows").updateCallback(function(){const lt={getOrientation:()=>B.Orientation.Row,getUnitText:()=>"Pt"},Bt={initialValue:{size:20,unit:"Px"},context:()=>lt,onInput:(zt,vt)=>{vt!=="Autofit"?e.getSelectedRanges().getRowHeaders().setSize(zt.size+zt.unit):z.getCommand("autoFitRows").execute()}};a.showWindow("resizeHeader",Bt)}).update(xe),z.getCommand("autoFitColumns").updateCallback(function(){F(this,lt=>{lt.getSelectedRanges().autoFit({orientations:B.Orientations.Column})})}).update(xe),z.getCommand("resizeColumns").updateCallback(function(){const lt={getOrientation:()=>B.Orientation.Column,getUnitText:()=>"Pt"},Bt={initialValue:{size:100,unit:"Px"},context:()=>lt,onInput:(zt,vt)=>{vt!=="Autofit"?e.getSelectedRanges().getColumnHeaders().setSize(zt.size+zt.unit):z.getCommand("autoFitColumns").execute()}};a.showWindow("resizeHeader",Bt)}).update(xe);let Ee=!1,K=0,le=!1,X=!1,ae=0,Ie=!1;const ve=ie.ranges;ve&&!H&&(Ee=ve.isEntireColumnsAny(),le=Ee&&!ve.isEntireColumns(),K=ve.getColumnCount(),X=ve.isEntireRowsAny(),Ie=X&&!ve.isEntireRows(),ae=ve.getRowCount());const ze={disabled:H||ve&&ve.getCount()!==1};z.getCommand("sortAscending").update(ze),z.getCommand("sortDescending").update(ze);const _e=ie.isOverlapping,Ne={disabled:Ee||H||_e},me={disabled:X||H||_e},Re=Ee||H||_e||Ie,Me=X||H||_e||le;let qe="",nt="",Ye="",Ve="",et="",We="",Xe="",Ue="",Ke="",Ze="",wt="",pt="",_t="";K>1&&(qe=K+" ",nt="s",_e||(Ze=We=qe,wt=Xe=nt)),ae>1&&(Ye=ae+" ",Ve="s",_e||(pt=Ue=Ye,_t=Ke=Ve)),b.getMode()?.key==="copy"?(et=Ue=We="Copied ",Xe=Ke="s"):b.getMode()?.key==="cut"&&(et=Ue=We="Cut ",Xe=Ke="s");let jt="",Ot="";if(ve){const lt=ve.getDefaultShiftOrientation()===B.Orientation.Column;jt=` (${lt?"Shift Right":"Shift Down"})`,Ot=` (${lt?"Shift Left":"Shift up"})`,z.getCommand("deleteCells").update({label:`Delete Cells${Ot}`})}z.getCommand("insertCells").update({label:`Insert ${et}Cells${jt}`,scopedLabels:{insertCells:`${et}At Selection`}}),z.getCommand("insertCellsShiftRight").update(Ne),z.getCommand("deleteCellsShiftLeft").update(Ne),z.getCommand("deleteCellsShiftUp").update(me),z.getCommand("insertCellsShiftDown").update(me),z.getCommand("insertRows").update({label:`Insert ${Ue}Row${Ke}`,scopedLabels:{insertCells:`${Ue}Row${Ke}`},disabled:Me}),z.getCommand("insertRowsAfter").update({label:`Insert ${Ue}Row${Ke} Below`,disabled:Me}),z.getCommand("hideRows").update({label:`Hide ${Ye}Row${Ke}`}),z.getCommand("insertColumns").update({label:`Insert ${We}Column${Xe}`,scopedLabels:{insertCells:`${We}Column${Xe}`},disabled:Re}),z.getCommand("insertColumnsAfter").update({label:`Insert ${We}Column${Xe} After`,disabled:Re}),z.getCommand("hideColumns").update({label:`Hide ${qe}Column${Xe}`}),z.getCommand("deleteRows").update({label:`Delete ${pt}Row${_t}`,scopedLabels:{deleteCells:`${pt}Row${_t}`},disabled:Me}),z.getCommand("deleteColumns").update({label:`Delete ${Ze}Column${wt}`,scopedLabels:{deleteCells:`${Ze}Column${wt}`},disabled:Re})},[y,R,C,b,a]),M.useEffect(()=>{const H=e.getProtection(),ie=e.getProtection().isLocked(),Se=!H.isFormatCellsAllowed(),j={disabled:Se};z.getCommand("protectionSheetToggle").updateCallback(async(Ee,K)=>{let le=null;try{if(ie){let X=null;if(H.hasPassword()){const ae=await a.showInput({title:"Password Required",description:"Enter a password to unprotected",options:["Unprotect","Cancel"],defaultOption:"Unprotect",inputType:"password"});if(ae.option!=="Unprotect")return;X=ae.input}le=await Promise.resolve(a.showBusy(K.getLabel())),await H.unlock(X)}else le=await Promise.resolve(a.showBusy(K.getLabel())),await H.lock();le?.()}catch(X){le?.(),a.showError(X)}}).update({state:ie,label:()=>ie?"Unprotect Sheet":"Protect Sheet",scopedLabels:{sheet:ie?"Unprotect":"Protect"}}),z.getCommand("deleteTable").update(j),z.getCommand("sortAscending").update(j),z.getCommand("sortDescending").update(j),z.getCommand("sortCustom")?.update(j),z.getCommand("updateComments").update(j),z.getCommand("deleteComments").update(j),z.getCommand("insertChart")?.update(j),z.getCommand("insertImageFromFile").update(j),z.getCommand("insertImageFromURL").update(j),z.getCommand("formatBorder").update(j),z.getCommand("formatFillColor").update(j),z.getCommand("formatFontColor").update(j),z.getCommand("formatBoldToggle").update(j),z.getCommand("formatItalicToggle").update(j),z.getCommand("formatUnderlinedToggle").update(j),z.getCommand("formatStrikeThroughToggle").update(j),z.getCommand("formatSuperscriptToggle").update(j),z.getCommand("formatSubscriptToggle").update(j),z.getCommand("formatAlignTopToggle").update(j),z.getCommand("formatTextOverflowVisibleToggle").update(j),z.getCommand("formatTextOverflowWrapToggle").update(j),z.getCommand("formatTextOverflowClipToggle").update(j),z.getCommand("formatTextOverflowShrinkToggle").update(j),z.getCommand("formatAlignMiddleToggle").update(j),z.getCommand("formatAlignBottomToggle").update(j),z.getCommand("formatAlignDistributedVerticalToggle").update(j),z.getCommand("formatAlignJustifyVerticalToggle").update(j),z.getCommand("formatAlignLeftToggle").update(j),z.getCommand("formatAlignCenterToggle").update(j),z.getCommand("formatAlignRightToggle").update(j),z.getCommand("formatAlignJustifyToggle").update(j),z.getCommand("formatAlignCenterContinuousToggle").update(j),z.getCommand("formatAlignDistributedHorizontalToggle").update(j),z.getCommand("formatAlignFillToggle").update(j),z.getCommand("formatFontSizeIncrease").update(j),z.getCommand("formatFontSizeDecrease").update(j),z.getCommand("formatFontFamily").update(j),z.getCommand("formatFontSize").update(j),z.getCommand("formatNumberFormat").update(j),z.getCommand("formatNumberFormatGeneralStyle").update(j),z.getCommand("formatNumberFormatNumberStyle").update(j),z.getCommand("formatNumberFormatTimeStyle").update(j),z.getCommand("formatNumberFormatDateStyle").update(j),z.getCommand("formatNumberFormatAccountingStyle").update(j),z.getCommand("formatNumberFormatPercentStyle").update(j),z.getCommand("formatNumberFormatScientificStyle").update(j),z.getCommand("formatNumberFormatCommaStyle").update(j),z.getCommand("formatNumberFormatIncreaseDecimal").update(j),z.getCommand("formatNumberFormatDecreaseDecimal").update(j),z.getCommand("hideColumns").update(j),z.getCommand("unhideColumns").update(j),z.getCommand("hideRows").update(j),z.getCommand("unhideRows").update(j),z.getCommand("insertFunctionSum").update(j),z.getCommand("insertFunctionAverage").update(j),z.getCommand("insertFunctionCount").update(j),z.getCommand("insertFunctionMax").update(j),z.getCommand("insertFunctionMin").update(j),z.getCommand("insertFunction").update(j),z.getCommand("startEditCurrentTime").update(j),z.getCommand("startEditCurrentDate").update(j),z.getCommand("startEditValueAbove").update(j),z.getCommand("fillDown").update(j),z.getCommand("fillRight").update(j),z.getCommand("fillUp").update(j),z.getCommand("fillLeft").update(j),z.getCommand("formatCellStyle").update(j),z.getCommand("formatTableStyle").update(j),z.getCommand("formatPainterToggle").update(j),z.getCommand("formatBorderAddOutline").update(j),z.getCommand("formatBorderClearOutline").update(j),z.getCommand("formatIndentDecrease").update(j),z.getCommand("formatIndentIncrease").update(j),z.getCommand("clearContents").update(j),z.getCommand("clearFormats").update(j),z.getCommand("clearAll").update(j),z.getCommand("clearComments").update(j),z.getCommand("clearHyperlinks").update(j),z.getCommand("autoFilterClear").update(j),z.getCommand("autoFilterReapply").update(j);const se=Ge.getAlignment().getHorizontal(),ye=se===ce.HorizontalAlignment.CenterContinuous||se===ce.HorizontalAlignment.Fill,xe={disabled:Se||ye};z.getCommand("formatTextRotate0").update(xe),z.getCommand("formatTextRotate45").update(xe),z.getCommand("formatTextRotate90").update(xe),z.getCommand("formatTextRotate270").update(xe),z.getCommand("formatTextRotate315").update(xe),z.getCommand("formatTextRotateCustom").update(xe),z.getCommand("formatTextRotateVertical").update(xe)},[y]),z}const sE="_sheet-scrollbar_104cg_1",iw=M.memo(M.forwardRef((s,e)=>{const{style:t=St.EmptyCssProperties,orientation:n,sheet:r,onShowTooltip:o,onCloseTooltip:i,onScrollOffset:l,showCustomScrollButtons:a,offset:c=0,totalSize:u=0,viewportSize:d=0,className:h,endGap:f,...g}=s;if(!r)throw new Error("SheetScrollbar needs an ISheet");const m=ke(o,[o]),p=ke(i,[i]),S=it.useRef(null),w=Oo([S,e]),b=n===Ci.Vertical,[C,_]=M.useState(()=>{const ee=r.getView().getTopLeft();return b?ee.top:ee.left}),y=()=>{const ee=r.getView().getFreezePanes();return b?ee.coords.rowIndex===0?{shift:0,scroll:0}:{shift:r.getRowHeaders().findOffset(ee.coords.rowIndex)-ee.topLeft.top,scroll:ee.topLeft.top}:ee.coords.colIndex===0?{shift:0,scroll:0}:{shift:r.getColumnHeaders().findOffset(ee.coords.colIndex)-ee.topLeft.left,scroll:ee.topLeft.left}},[v,x]=M.useState(y),[E,R]=M.useState(null),[I,A]=M.useState(!1),T=n===Ci.Vertical?r.getRowHeaders():r.getColumnHeaders(),O=()=>{const ee=r.getUsedRange()?.getCoords()??q.EmptyRange,ne=r.getSelection().getCoords().cell;return{colIndex:Math.max(ee.colEnd,ne.colIndex),rowIndex:Math.max(ee.rowEnd,ne.rowIndex)}},[N,D]=M.useState(O),F=N?(b?N.rowIndex:N.colIndex)+1:0,k=()=>{const ee=O();q.isEqualCells(N,ee)||D(ee)};It(r.getView(),{onFreezeSplitChange:()=>{x(y)}}),It(r.getSelection(),{onChange:k}),It(r,{onUsedRangeChange:k}),M.useEffect(()=>{D(O())},[r]);const L=c-v.scroll,W=d-v.shift,$=u-(v.shift+v.scroll),J=T.findOffset(F)*(r.getView().getZoomScale()/100)-(v.scroll+v.shift);M.useEffect(()=>{if(!E)return I&&p?.(),void A(!1);G(b,C,W,f,E,r,T,v)},[b,c,C,W,f,v,n,E,T,I,r]);const te=ke((ee,ne,re)=>{_(ee);const U=ee+v.scroll,ue=ne+v.shift,oe=re+v.shift+v.scroll;l?.(U,ue,oe)},[l,v]),Q=M.useCallback((ee,ne,re,U,ue,oe,Z,Y)=>{const we=Z.getTextAt(Z.findIndex(ne/(oe.getView().getZoomScale()/100)+Y.scroll+Y.shift)),ge={...ue,display:(n===Ci.Vertical?"Row":"Column")+": "+we};if(S.current){const de=S.current.querySelector('[role="slider"]');if(de){const be=de.getBoundingClientRect();ee?ge.anchor.y=be.top+be.height/2:ge.anchor.x=be.left+be.width/2}}A(!0),m?.(ge)},[]),G=ke(P.debounce(Q,90),[]);return M.useMemo(()=>pe.jsx(Yw,{ref:w,className:rn(h,sE),style:t,offset:L,viewportSize:W,totalSize:$,orientation:n,showCustomScrollButtons:a,onMouseDown:ee=>{R({anchor:{x:ee.clientX,y:ee.clientY}}),ee.preventDefault()},onScrollOffset:te,onMouseOut:()=>{R(null)},onMouseUp:()=>{R(null)},minSize:J,...g}),[h,L,W,$,n,a,t,J,f])}));iw.displayName="SheetScrollbar";const ep=(s,e,t=null)=>{const n=[];for(let r=0;r<s.length;r++)if(s[r].value.isSelectedAll){if(s[r].min===s[r].max&&s[r].min===t)continue;n.push({address:{min:s[r].min,max:s[r].max},update:e})}return n},tp=M.memo(M.forwardRef((s,e)=>{const{sheetHeader:t,gridRef:n,sheetElement:r,commands:o,oppositeSize:i=30,containerWidth:l,containerHeight:a,headerText:c,freezeStart:u,gridStyle:d,verticalPadding:h,horizontalPadding:f,onSheetContextMenu:g,onResizeHeadersStart:m,onResizeHeaders:p,onResizeHeadersEnd:S,onResizeHeadersDown:w,onResizeHeadersUp:b,scrollPoint:C,onSelectionStart:_,onSelectionEnd:y}=s,v=M.useMemo(()=>t.getOrientation(),[t]),x=M.useRef(null),[E,R]=M.useReducer(X=>X+1,0),[I,A]=M.useReducer(X=>X+1,0),T=t?.getSheet(),O=M.useRef(!1);M.useLayoutEffect(()=>{O.current=!0},[t]);const N=M.useMemo(()=>t.getEntireRange().getCoords().max+1,[t]),D=M.useMemo(()=>{const X=v===B.Orientation.Column;return{left:X?C.left:0,top:X?0:C.top}},[C]),[F,k]=M.useState(T?.getView().getZoomScale()/100),[L,W]=M.useState(null);It(t,{onSizesChange:X=>{k(T?.getView().getZoomScale()/100),be(ge())}});const $=M.useCallback(()=>{x.current?.invalidate(),A()},[]),J=M.useCallback(P.debounce(()=>{$()},10),[]),[te,Q]=M.useState(null);It(t.getSheet(),{onSelectionChange(){Q(T?.getSelection().getCoords()),J()},onProtectionChange(){$()},onViewChange(){J()}}),M.useLayoutEffect(()=>{be(ge())},[v,F,i]),M.useLayoutEffect(()=>{W(null),k(t?.getSheet().getView().getZoomScale()/100),be(ge())},[t]);const G=M.useCallback(X=>t.at(X)?.isHidden()||t.at(X)?.getSize()===0,[t]),ee=M.useCallback((X,ae)=>t.hiddenHeadersAt(X,ae),[G]),ne=ke(X=>t.isSelected(X),[t]),re=ke(X=>t.isSelectedAll(X),[t]),U=M.useCallback(()=>t.getMinSize(),[t]),ue=M.useCallback(()=>t.getMaxSize(),[t]),oe=ke((X,ae,Ie)=>{ae/=F;const ve={size:ae=Math.max(U(),Math.min(P.roundAccurately(ae,U()),ue())),hidden:!1},ze=[];if(ae<=0&&(ve.hidden=!0,ve.size=Ie),ze.push({address:{min:X,max:X},update:ve}),ae<0){const _e=v===B.Orientation.Column,Ne=_e?de.getColOffset:de.getRowOffset,me=_e?de.getColIndex:de.getRowIndex,Re=Ne(X);let Me=me(Re+ae);const qe=Ne(Me);qe===Re+ae?Me--:ze.push({address:{min:Me,max:Me},update:{size:Re-qe+ae}}),X-Me>1&&ze.push({address:{min:Me+1,max:X-1},update:{hidden:!0}})}t.updateHeaderPairs(ze),p?.(X,ae,Ie)},[E,t,F,p]),Z=ke((X,ae,Ie)=>{const ve=v===B.Orientation.Column;let ze=null,_e={min:X,max:X};if(t.isSelectedAll(X)){const Ne=t.getSelectedRuns();Ne.length>1?ze="Resize "+(ve?"Columns":"Rows"):_e=Ne[0];const me={hidden:ae<=0,size:(ae<=0?Ie:ae)/F};t.updateHeaderPairs(ep(Ne,me,X))}if(_e){const Ne=_e.max-_e.min+1;let me;me=Ne===1?t.getRange(_e).at(0).getDisplayText():t.getRange(_e).toString(),ze=`Resize ${ve?"Column":"Row"}${Ne>1?"s":""} '${me}'`}S?.(X,ae,ze)},[E,t,S]),Y=ke((X,ae)=>{const Ie=v===B.Orientation.Column;m(X,ae,`Resize ${Ie?"Column":"Row"}(s)`)},[m]),we=ke(X=>{let ae=!1;const Ie=v===B.Orientation.Column,ve=t.getSheet().getEntireRange().getCoords(),ze=[],_e=t.getSelectedRuns(),Ne=me=>{let Re;Re=Ie?{colStart:me.min,rowStart:ve.rowStart,colEnd:me.max,rowEnd:ve.rowEnd}:{colStart:ve.colStart,rowStart:me.min,colEnd:ve.colEnd,rowEnd:me.max},ze.push(Re)};for(let me=0;me<_e.length;me++){const Re=_e[me];Re.value.isSelectedAll&&(Re.min<=X&&Re.max>=X&&(ae=!0),Ne(Re))}if(ae||Ne({min:X,max:X}),t.getSheet().getRanges(ze).autoFit({orientations:Ie?B.Orientations.Column:B.Orientations.Row}),G(X)){const me={hidden:null},Re=ep(_e,me);ae||Re.push({address:X,update:me}),t.updateHeaderPairs(Re)}S?.(X,null,"Resize Column(s)")},[E,t,S,G]),ge=()=>{const X=v===B.Orientation.Column;return{getColOffset:ae=>X?t.findOffset(ae):ae===0?0:i/F,getColIndex:ae=>X?t.findIndex(ae):0,getRowOffset:ae=>X?ae===0?0:i/F:t.findOffset(ae),getRowIndex:ae=>X?0:t.findIndex(ae)}},[de,be]=M.useState(()=>ge()),he=M.useCallback((X,ae)=>X.nativeEvent.which!==Mp.Right||!re(v===B.Orientation.Column?ae.colIndex:ae.rowIndex),[v,re]),fe=ke(X=>{r.focusSheet()},[r]),z=ke(X=>{T?.getSelection().updateCoords(X)},[T]),{...Fe}=Np({gridRef:n,commands:null,layout:de,selection:te,fillHandleBorderColor:d.body.fill,selectionBackgroundColor:d.selection.fill,selectionBorderColor:d.selection.strokeFill,selectionRemoveBackgroundColor:d.selectionRemove.fill,selectionRemoveBorderColor:d.selectionRemove.strokeFill,disableTouchSelection:!0,onSelectionChange:z,canSelectionSpanMergedCells:X=>{const ae=T.getRange(X);return ae.isEntireColumns()||ae.isEntireRows()}}),De=ke(()=>{_?.();const X=T?.getSelection();X&&X.setAdjusting(X.getCoords())},[T,_]),Ge=ke(async()=>{T?.getSelection().setAdjusting(null),y?.()},[T,y]),{...H}=n_({orientation:v,headerCount:N,gridRef:x,gridMainRef:n,newSelection:Fe?.newSelection,modifySelection:Fe?.modifySelection,appendSelection:Fe?.appendSelection,clearSelections:Fe?.clearSelections,pointerDownInterceptor:he,onPointerUp:fe,onDragStart:De,onDragEnd:Ge}),ie=d.selection?.strokeFill;M.useEffect(()=>{if(!x.current)return void W(null);const X=v===B.Orientation.Column,ae=t.getSelectedRuns(),Ie=t.isProtected()?null:oe,ve=(_e,Ne,me)=>{if(me)return pe.jsx("div",X?{style:{position:"absolute",borderBottom:`${d.headerSelection.strokeWidth}px solid ${ie}`,pointerEvents:"none",top:`${St.boundPixel(-d.headerSelection.strokeWidth/2)}px`,left:`${St.boundPixel(me.x-d.headerSelection.strokeWidth)}px`,width:`${St.boundPixel(me.width+d.headerSelection.strokeWidth+1,!0)}px`,height:i+d.headerSelection.strokeWidth-.5+"px"}}:{style:{position:"absolute",borderRight:`${d.headerSelection.strokeWidth}px solid ${ie}`,pointerEvents:"none",top:`${St.boundPixel(me.y-d.headerSelection.strokeWidth)}px`,left:`${St.boundPixel(-d.headerSelection.strokeWidth/2)}px`,width:i+d.headerSelection.strokeWidth-.5+"px",height:`${St.boundPixel(me.height+d.headerSelection.strokeWidth+1,!0)}px`}},_e)},ze=(_e,Ne,me)=>{const Re={x:0,y:0,width:0,height:0};if(X){const Me=me.toClipBounds(me.getRangeCoordsBounds({rowStart:0,rowEnd:0,colStart:_e,colEnd:Math.min(N,Ne)}),qu);if(!Me)return;Re.x=Me.x,Re.width=Me.width}else{const Me=me.toClipBounds(me.getRangeCoordsBounds({rowStart:_e,rowEnd:Math.min(N,Ne),colStart:0,colEnd:0}),qu);if(!Me)return;Re.y=Me.y,Re.height=Me.height}return{x:Re.x,y:Re.y,width:Re.width,height:Re.height}};W([_e=>{let Ne=null,me=X?_e.getVisibleColumns():_e.getVisibleRows();const Re=X?_e.getTotalRangeCoords().colStart:_e.getTotalRangeCoords().rowStart;me.length>0&&me[0]>Re&&(me=[me[0]-1,...me]);let Me=[];const qe=[],nt=me.length;for(let Ke=0;Ke<nt;Ke++){const Ze=me[Ke],wt=Ke<nt-1?me[Ke+1]:Ze+ee(Ze+1,!1)+1,pt=Ze+1!==wt;if(!Ne||Ne.max<Ze)if(ae.length>0&&ae[ae.length-1].max>=Ze){const Ot=P.findEqualOrGreater(ae,Ze,lt=>lt.max);Ne=ae[Ot]}else Ne=null;let _t=!1,jt=!1;if(Ne?.value&&(Ne.min<=Ze||Ne.min<=wt&&!pt)&&(_t=!0,jt=Ne.value.isSelectedAll),Ze===Re){let Ot=!1,lt=!1;Ne?.value&&Ne.min<=Ze&&(Ot=!0,lt=Ne.value.isSelectedAll),Ze>0&&qe.push({index:Ze-1,isNextHidden:pt,isSelected:Ot,isSelectedAll:lt,disabledResize:!0})}if(jt&&Me.push(qe.length),qe.push({index:Ze,isHidden:Ke===0&&ee(Ze,!1)>0,isNextHidden:pt,isSelected:_t,isSelectedAll:jt,onDividerMouseDown:w,onDividerResizeStart:Y,onDividerResize:Ie,onDividerMouseUp:b,onDividerResizeEnd:Z,onDividerAutoFit:we}),pt){let Ot=!1,lt=!1;if(Ne&&Ne.min>=Ze&&Ne.max<=wt-1&&Ne.value.isSelectedAll&&Me.push(qe.length),!(Ne?.value&&Ne.max>=wt))if(ae.length>0&&ae[ae.length-1].max>=wt){const Bt=P.findEqualOrGreater(ae,wt,zt=>zt.max);Ne=ae[Bt]}else Ne=null;Ne?.value&&Ne.min<=wt&&(Ot=Ne.value.isSelected,lt=Ne.value.isSelectedAll),wt>0&&qe.push({index:wt-1,isHidden:!0,isSelected:Ot,isSelectedAll:lt,onDividerMouseDown:w,onDividerResizeStart:Y,onDividerResize:Ie,onDividerMouseUp:b,onDividerResizeEnd:Z,onDividerAutoFit:we})}}if(Me.length>0){let Ke=Me.length-1;if(Me.length>0){const pt=qe[Me[Ke]].index;let _t=null;X?(_t=_e.getRangeCoordsBounds({rowStart:0,rowEnd:0,colStart:pt,colEnd:pt}),_t.x+_t.width>_e.getBounds().width&&(Ke-=1,Ke===0&&(Ke=-1))):(_t=_e.getRangeCoordsBounds({rowStart:pt,rowEnd:pt,colStart:0,colEnd:0}),_t.y+_t.height>_e.getBounds().height&&(Ke-=1,Ke===0&&(Ke=-1)))}const Ze=ae?.[ae.length-1],wt=_e.getAnchor();if(wt==="t"||wt==="l"){const pt=qe[Me[Math.max(0,Me.length-1)]];pt.showTouchDivider=Ze&&Ze.max<=pt.index}else Ke>=0&&(qe[Me[Ke]].showTouchDivider=!0)}const{header:Ye,headerSelect:Ve,headerSelectAll:et,headerHover:We}=d??{},Xe=qe.length,Ue=new Array(Xe);for(let Ke=0;Ke<Xe;Ke++)Ue[Ke]=pe.jsx(r_,{orientation:v,view:_e,headerStyle:Ye,headerStyleSelect:Ve,headerStyleSelectAll:et,headerStyleHover:We,disabled:t.isProtected(),...qe[Ke]},`divider${Ke}`);return Ue},_e=>{const Ne=[],me=ae.length;for(let Re=0;ae&&Re<me;Re++)Ne.push(ve(`selection:${_e.getAnchor()}:${Re}`,0,ze(ae[Re].min,ae[Re].max,_e)));return Ne}])},[I,!0,ie,d,de,N,u,E,F]),M.useEffect(()=>{x.current?.invalidate()},[E]);const Se=ke(X=>c?c(X):t.getTextAt(X),[c,t]),j=ke(X=>{const{header:ae,headerSelect:Ie,headerSelectAll:ve,headerHover:ze}=d??{},{range:_e,key:Ne,...me}=X;return pe.jsx(o_,{orientation:v,index:v===B.Orientation.Column?_e.colStart:_e.rowStart,isSelected:ne,isSelectedAll:re,zoomScale:100*F,headerText:Se,headerStyle:ae,headerStyleSelect:Ie,headerStyleSelectAll:ve,headerStyleHover:ze,verticalPadding:h,horizontalPadding:f,...me},Ne)},[E,N,d,F,t]),se=Mo(),ye=M.useMemo(()=>{const X="white",ae="black",Ie={};if(St.detectIt().primaryInput!=="touch"){let ve=v===B.Orientation.Column?`url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg' %3E%3Cg%3E%3Cpath d='M 8,14.5 2.3125,8.8125 h 3.25 V 1.5 h 4.875 v 7.3125 h 3.25 z' stroke='${ae}' fill='${X}'/%3E%3C/g%3E%3C/svg%3E%0A") 8 15, pointer`:`url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg' %3E%3Cg%3E%3Cpath d='m 14.5,8 -5.6875,5.6875 v -3.25 H 1.5 v -4.875 h 7.3125 v -3.25 z' stroke='${ae}' fill='${X}'/%3E%3C/g%3E%3C/svg%3E%0A") 15 8, pointer`;se.getMode()?.key==="formatPainter"&&(ve=`url("data:image/svg+xml,%3Csvg width='30' height='22' viewBox='0 0 30 22' xmlns='http://www.w3.org/2000/svg' %3E%3Cg%3E%3Cpath d='M 26.737611,2.811068 V 2.0241451 c 0,-0.4328075 -0.354115,-0.7869227 -0.786923,-0.7869227 h -9.443074 c -0.432808,0 -0.786923,0.3541152 -0.786923,0.7869227 v 3.1476914 c 0,0.4328076 0.354115,0.7869235 0.786923,0.7869235 h 9.443074 c 0.432808,0 0.786923,-0.3541159 0.786923,-0.7869235 V 4.3849137 h 0.786923 v 3.1476915 h -7.869229 v 8.6561518 c 0,0.432808 0.354116,0.786923 0.786923,0.786923 h 1.573846 c 0.432807,0 0.786923,-0.354115 0.786923,-0.786923 V 9.1064513 H 29.09838 V 2.811068 Z M 10.714339,6.2116849 c -1.60877,0.0017 -3.2175361,0.00425 -4.8263048,0.00609 0.0012,1.5756989 0.00158,3.1513905 0.00244,4.7270891 -1.5978311,0.0017 -3.1956617,0.0034 -4.7934919,0.0043 0.00335,1.740011 0.00655,3.480012 0.00988,5.220023 1.5954589,0 3.1909181,0 4.7863775,0 -0.0017,1.606793 -0.00353,3.213585 -0.0051,4.820375 1.7440936,0.0016 3.4881881,0.0033 5.2322842,0.005 -0.0014,-1.608503 -0.0018,-3.217015 -0.0028,-4.825519 1.58518,0 3.17036,0 4.755543,0 0.0033,-1.741851 0.0073,-3.483705 0.01072,-5.225556 -1.58808,0 -3.176158,0 -4.764238,0 0,-1.5775391 0,-3.1550792 0,-4.7326117 -0.135065,1.3e-4 -0.270128,1.982e-4 -0.40519,4.047e-4 z' stroke='${ae}' fill='${X}'/%3E%3C/g%3E%3C/svg%3E%0A") 7 12, pointer`),Ie.cursor=ve}return Ie.backgroundColor=d?.header?.fill||"transparent",Ie},[v,E,se,d]),xe=Yn(e,()=>({scrollTo:X=>{x.current?.scrollTo(X)},forceRender:()=>{R()},getGridElement:()=>x.current}),[]),Ee=M.useCallback(X=>{H.onPointerDown(X)},[H]),K=M.useCallback(X=>{const ae=H.getCellCoordsFromClient(X.clientX,X.clientY);if(!ae||!g)return;const Ie=v===B.Orientation.Column;g({originalEvent:X,clientX:X.clientX,clientY:X.clientY,rowIndex:Ie?-1:ae.rowIndex,colIndex:Ie?ae.colIndex:-1}),X.stopPropagation(),X.preventDefault()},[H,g]),le=M.useMemo(()=>{const X=v===B.Orientation.Column;return pe.jsx("div",{ref:xe,children:pe.jsx(Fp,{className:"sheet-header",style:ye,ref:x,scrollPoint:D,columnCount:X?N:1,rowCount:X?1:N,width:X?l:i,height:X?i:a,freezeLeft:X?u:void 0,freezeTop:X?void 0:u,hiddenColumnsAt:X?ee:void 0,hiddenRowsAt:X?void 0:ee,showGridLines:!1,layout:de,clipCells:!1,allowOverlaysOverflow:!0,enableMouseWheel:!1,onContextMenu:K,onPointerDown:Ee,zoom:F,renderCell:j,renderOverlays:L})})},[L,de,l,a,D,ye,I]);return M.useEffect(()=>{O.current=!1,x.current?.invalidate(),A()},[t,d]),le})),iE=M.memo(M.forwardRef((s,e)=>{const{view:t,sheet:n,getVisibleCells:r,gridStyle:o}=s,i=ke((c,u)=>c.getStyle().getBorder(),[]),{renderOverlay:l}=tw({getVisibleCells:r,getBorderAt:i,darkMode:o.body.darkMode,shiftIfWide:!0}),a=l(t);return a&&t?a:null})),lE={key:"copy",description:"'Copy' Select destination and press ENTER or choose Paste."},aE={key:"cut",description:"'Cut' Select destination and press ENTER or choose Paste."},cE={type:ut.Content.Values},uE={fitDestination:!0,type:ut.Content.Formats},dE={fitDestination:!0,type:ut.Content.Formulas},hE={transpose:!0},gE={fitDestination:!0,adjustCells:(s,e,t)=>({value:`=${e.getA1({$colIndex:!0,$rowIndex:!0})}`})},fE=({element:s,sheet:e,sheetView:t,commands:n,onClipboardUpdate:r,onPaste:o,renderSelection:i=i_,copyForegroundColor:l="rgb(33, 115, 70)",cutForegroundColor:a="rgb(33, 115, 70)",copyBackgroundColor:c="white",cutBackgroundColor:u="white",...d})=>{const h=ke(i,[i]),f=M.useRef(null),g=Mo(),m=g.getMode(),p=M.useMemo(()=>({element:s,doCopy:_=>{const y=e.getSelectedRanges().getSnapshot(_);return new jv(y)}}),[e,t,s]),S=M.useMemo(()=>({element:s,importFromExternal:async(_,y)=>{const v=new Gv(_,y,e.getStyles(),e.isDate1904());return await v.parse()?v:null},doPaste:async(_,y)=>{if(_?.getItemType()!=="range")return;y?.contentsOnly&&delete(y={...y,type:ut.Content.Values}).contentsOnly;const v=_.getItem(),x=v.getName();let E=e.getSelectedRange();if(x==="HTML"&&E.size>1){const R=v?.getCoords();R&&q.isSingleCell(R)&&(E=E.getResizeTo(1,1))}return await E.doBatch(async()=>{const R=await E.copyFrom(v,y);!R||R.isEntireRows()||R.isEntireColumns()||R.autoFit({orientations:B.Orientations.Row,minContent:!0})},{description:"Paste"+(x?` ${x}`:""),autoSelect:!0}),!0}}),[e,t,s]),{clipboard:w,...b}=kp({...d,source:p,commands:n,target:S,onClipboardUpdate:_=>{const y=_?.getItemType()==="range"?_:null;if(y){const v=_.editMode?.(),x={..._?.isCut?.()?aE:lE,...v,args:{isClipboard:!0,...v?.args},onModeChange:E=>{E?.args?.isClipboard||w.clear(!0),v?.onModeChange?.(E)}};g.setMode(x)}f.current=y,r?.(y)},onPaste:(_,y)=>{if(_?.getItemType()!=="range")return;let v=g.getMode()?.key==="cut"||_.isCut?.();if(!v&&g.getMode()?.key==="copy"){const x=_.getItem().getCoords(),E=e.getSelectedRanges().getCoords();let R=!1;if(!R&&x&&E&&_.getItem().getSource?.()===e)for(let I=0;!R&&I<E.length;I++)R=q.isRangesIntersect(x,E[I]);v=R}v&&g.setMode(null),s?.()?.focus(),o?.(_,y)}});M.useMemo(()=>{const _=s;if(!n)return;const y=[new Ae("pasteValues",_,{label:"Paste Values",scopedLabels:{paste:"Values"},description:`Paste only the values of the selected cells.

The formatting is not applied.`,icon:"PasteValues",shortcut:{key:"V",modifiers:[Oe.Ctrl,Oe.Shift]}}),new Ae("pasteFormats",_,{label:"Paste Formatting",scopedLabels:{paste:"Formatting"},description:`Paste only the formats of the selected cells.

The content is not applied.`,icon:"PasteFormats"}),new Ae("pasteFormulas",_,{label:"Paste Formulas",scopedLabels:{paste:"Formulas"},description:"Paste only the formulas of the selected cells. The values and formatting is not applied.",icon:"PasteFormulas"}),new Ae("pasteTranspose",_,{label:"Paste Transpose",scopedLabels:{paste:"Transpose"},description:"Paste with the rows and columns flipped.",icon:"PasteTranspose"}),new Ae("pasteLinks",_,{label:"Paste Links",scopedLabels:{paste:"Links"},description:"Paste as formula references to the original cells.",icon:"PasteLinks"})];n.addCommands(y,!0)},[n,s]),M.useEffect(()=>{if(!n)return;const _={disabled:!e.getProtection().isFormatCellsAllowed()};n.getCommand("pasteValues").updateCallback(y=>b.paste({...cE,...y})).update(_),n.getCommand("pasteFormats").updateCallback((y,v)=>b.paste({...uE,description:v.getLabel(),...y})).update(_),n.getCommand("pasteFormulas").updateCallback((y,v)=>b.paste({...dE,description:v.getLabel(),...y})).update(_),n.getCommand("pasteTranspose").updateCallback((y,v)=>b.paste({...hE,description:v.getLabel(),...y})).update(_),n.getCommand("pasteLinks").updateCallback((y,v)=>b.paste({...gE,description:v.getLabel(),...y})).update(_),n.getCommand("cut").update(_),n.getCommand("paste").update(_)},[e,n]);const C=M.useMemo(()=>{if(!m||!f.current)return;const _=m.key;if(_!=="copy"&&_!=="cut"&&_!=="formatPainter")return;const y=f.current.getItem();if(y.getSource()!==e)return;const v=f.current.isCut?.(),x=v?u:c,E=v?a:l,R=y.getCoords(),I=R?[R]:null;return I&&I.length!==0?A=>{const T=[];for(let O=0;O<I.length;O++){const N=I[O],D=A.toClipBounds(A.getRangeCoordsBounds(N,{top:0,left:0,right:1,bottom:1}),qu);D&&(T.push(h({range:N,key:`copy-selection-background-${O}`,x:D.x,y:D.y,width:Math.max(D.width,0),height:Math.max(D.height,0),stroke:x,strokeWidth:2})),T.push(h({range:N,key:`copy-selection-foreground-${O}`,x:D.x+(D.width<=2?-1:0),y:D.y,width:Math.max(D.width,3),height:Math.max(D.height,3),stroke:E,strokeWidth:2,isAnimatedStroke:!0})))}return T}:null},[m,e,t,l,c,a,u]);return{...b,clipboard:w,overlays:C}},mE=M.memo(M.forwardRef((s,e)=>{const{view:t,element:n,sheet:r,gridStyle:o,commands:i}=s,l=o.body??{},a=r.getView(),{overlays:c}=fE({element:n,sheet:r,sheetView:a,commands:i,copyForegroundColor:o.selection.strokeFill,copyBackgroundColor:l.fill,cutForegroundColor:o.selectionRemove.strokeFill,cutBackgroundColor:l.fill});return It(r?.getSelection(),{onChange(u){}}),M.useEffect(()=>{t?.getStage()},[t?.getStage()]),c&&t?c(t):null})),pE="_sheet-selection_12wyx_5",SE={key:"dragCut",description:"Drag selection to move cell contents.",cursor:"move"},wE={key:"dragCutInsert",description:"Drag selection to insert cell contents.",cursor:"copy"},_E={key:"dragCopy",description:"Drag selection to copy cell contents."},yE={key:"dragCopyInsert",description:"Drag selection to insert copied cell contents.",cursor:"move"},np=(s,e)=>e.ctrlKey&&e.shiftKey?yE:e.ctrlKey?_E:e.shiftKey?wE:SE,bE={key:"fill",description:"Drag selection to extend series or fill.",cursor:"crosshair"},CE=M.memo(M.forwardRef((s,e)=>{const{view:t,commands:n,className:r,onFirstRender:o,onShowTooltip:i,onCloseTooltip:l,sheet:a,gridRef:c,gridStyle:u,isActive:d,...h}=s,f=t?.getBounds(),g=ke(i,[i]),m=ke(l,[l]),[p,S]=M.useState(()=>a?.getSelection().getCoords()),w=ke(oe=>{q.isEqualSelectionCoords(oe,p)||a&&a.getSelection().updateCoords(oe)},[a,p]),b=Mo(),C=M.useRef(null),[_,y]=M.useState(a?.getProtection().isLocked()),[v,x]=M.useState(a?.getView().getMovableSelection().length>0),E=St.detectIt().primaryInput==="touch",R=!E&&d,I=b.getMode()?.args?.stateAndCoords?.coords??null,A=I!==null||v,T=ke(oe=>{const Z=q.cellToRange(oe);if(a.isClosed())return Z;const Y=a.getRange(Z,{ignoreHidden:!0}).getMerges();return Y.length===0?Z:Y[0]},[a]),O=ke((oe,Z,Y,we,ge,de)=>{const be=a.getSelectedRange().getExtended(we,oe).getCoords();switch(we){case B.Direction.Up:return be.rowStart;case B.Direction.Down:return be.rowEnd;case B.Direction.Left:return be.colStart;case B.Direction.Right:return be.colEnd}},[a]),N=ke(()=>{const oe=a.getUsedRange()?.getCoords(),Z=a.getRowHeaders().getUsedRange()?.getCoords(),Y=a.getColumnHeaders().getUsedRange()?.getCoords();return{...oe,colEnd:Math.max(oe?.colEnd??0,Y?.max??0),rowEnd:Math.max(oe?.rowEnd??0,Z?.max??0)}},[a]),D=ke((oe,Z)=>a.getRowHeaders().hiddenHeadersAt(oe,Z),[a]),F=ke((oe,Z)=>a.getColumnHeaders().hiddenHeadersAt(oe,Z),[a]),k=ke(oe=>a.getRange(oe,{ignoreHidden:!0}).getMerges(),[a]),L=ke(oe=>{a?.getSelection().setAdjusting(oe)},[a]),W=ke(async()=>{a?.getSelection().setAdjusting(null),b.getMode()?.key==="formatPainter"&&(await n?.getCommand("pasteFormats")?.execute({}),b.setMode(null))},[b,p,a,n]),$=M.useMemo(()=>{const oe=b.getMode();return oe?.key==="cut"||oe?.key==="copy"},[b]);It(a?.getView(),{onMovableSelectionChange:()=>{x(a.getView().getMovableSelection().length>0)}}),It(a?.getSelection(),{onChange(oe){const Z=a.getSelection().getCoords();S(Z)}}),It(a,{onProtectionChange:()=>{y(a.getProtection().isLocked())}});const{body:J={}}=u||{},te=Hi(),Q=t.getLayout(),G=!(R&&p.ranges.length<=1&&I===null&&!_&&(!b.getMode()||$)),{renderOverlay:ee,onPointerDown:ne}=Np({gridRef:c,commands:n,layout:Q,getCellCoordsAsRangeCoords:T,selection:p,fillHandleBorderColor:J.fill,selectionBackgroundColor:d?u.selection.fill:u.selectionInactive.fill,selectionBorderColor:d?u.selection.strokeFill:u.selectionInactive.strokeFill,selectionRemoveBackgroundColor:d?u.selectionRemove.fill:u.selectionInactive.fill,selectionRemoveBorderColor:d?u.selectionRemove.strokeFill:u.selectionInactive.strokeFill,disableFillDrag:G,disableMoveDrag:E||!(d&&p.ranges.length<=1&&I===null&&!_),disableTouchSelection:A,onSelectionChange:w,onSelectionDragStart:L,onSelectionDragEnd:W,onMoveDragStart:(oe,Z,Y)=>{b.setMode(np(0,Y))},onMoveDragUpdate:(oe,Z,Y)=>{b.setMode(np(0,Y))},onMoveDragEnd:(oe,Z)=>{b.setMode(null)},onMoveDragDone:async(oe,Z,Y)=>{if(q.isEqualRanges(oe,Z))return;const we=a.getRange(Z);if(te?.showOptions){const fe=we.getDifferences(oe);let z=!1;const Fe=fe.getCount();for(let De=0;!z&&De<Fe;De++)z=fe.at(De).isContentful();if(z&&await te?.showOptions({title:"Confirm",description:"There is already data here. Do you want to replace it?",options:["Replace","Cancel"],defaultOption:"Replace"})!=="Replace")return}const ge=!Y.ctrlKey,de=Y.shiftKey,be=de?ge?"Insert Moved Cells":"Insert Copied Cells":ge?"Move Cells":"Copy Cells",he=await te?.showBusy?.(be);try{const fe=a.getRange(oe);await we.doBatch(async()=>{de?await we.insertFrom(oe,{isCut:ge,undoRange:fe}):await we.copyFrom(oe,{isCut:ge,undoRange:fe}),fe.autoFit({skipCustomSize:!0,orientations:B.Orientations.Row,minContent:!0}),we.autoFit({skipCustomSize:!0,orientations:B.Orientations.Row,minContent:!0})},{description:be,autoSelect:!0})}catch(fe){te?.showError?.(fe)}finally{he?.()}},contentfulCellFinder:O,hiddenRowsAt:D,hiddenColumnsAt:F,mergedRanges:k,getDataCoords:N,canSelectionSpanMergedCells:oe=>{const Z=a.getRange(oe);return Z.isEntireColumns()||Z.isEntireRows()},onFill:async(oe,Z)=>{const Y="Auto Fill",we=await te?.showBusy?.(Y);try{await a.doBatch(()=>{a.getRange(oe).autoFill(Z),a.getRange(Z).autoFit({orientations:B.Orientations.Row,skipCustomSize:!0,minContent:!0})},{description:Y,autoSelect:!0})}catch(ge){te?.showError?.(ge)}finally{C.current=null,we?.()}},onFillPreview:(oe,Z,Y)=>{if(c.current&&g){b.setMode(bE);try{C.current?.direction!==Y&&(C.current=null,a.getRange(oe).autoFill(Z,{previewOnly:Fe=>{C.current={callback:Fe,direction:Y}}}));const we=C.current?.callback?.(Z);if(!we||we.isEmpty())return;const ge=we.toText();if(!ge)return;const de=q.cellToRange(we.getCoords()),be=t.getRelativePointFromClient(0,0);let he=0,fe=0,z=Bs.Bottom;if(Y===B.Direction.Down){he=Q.getColOffset(de.colEnd+1)-be.x;const Fe=Q.getRowOffset(de.rowEnd),De=Q.getRowOffset(de.rowEnd+1);fe=De-(De-Fe)/2-be.y,z=Bs.Right}else if(Y===B.Direction.Right){fe=Q.getRowOffset(de.rowEnd+1)-be.y;const Fe=Q.getColOffset(de.colEnd),De=Q.getColOffset(de.colEnd+1);he=De-(De-Fe)/2-be.x,z=Bs.Bottom}else if(Y===B.Direction.Up){he=Q.getColOffset(de.colEnd+1)-be.x;const Fe=Q.getRowOffset(de.rowStart),De=Q.getRowOffset(de.rowStart+1);fe=De-(De-Fe)/2-be.y,z=Bs.Right}else if(Y===B.Direction.Left){fe=Q.getRowOffset(de.rowEnd+1)-be.y;const Fe=Q.getColOffset(de.colStart),De=Q.getColOffset(de.colStart+1);he=De-(De-Fe)/2-be.x,z=Bs.Bottom}g({anchor:{x:he,y:fe},display:ge,placement:z})}catch(we){te?.showError?.(we)}}},onFillDone:()=>{C.current=null,b.setMode(null),m?.()}}),re=ke(oe=>{ne(St.createSyntheticEvent(oe))},[ne,I]);M.useEffect(()=>{const oe=t?.getStage();if(oe)return oe.addEventListener("pointerdown",re),()=>{oe.removeEventListener("pointerdown",re)}},[t?.getStage()]);const U=Yn(e,()=>({}),[]),ue=M.useRef(null);return pe.jsx("div",{className:rn(r,"sheet-selection",pE),style:{position:"absolute",width:f?.width,height:f?.height,overflow:"hidden",pointerEvents:"none",willChange:"none"},ref:Oo([U,ue]),...h,children:ee(t)})})),zl=Object.freeze({x:0,y:0,width:0,height:0}),vE={fireOnModelChange:!1},xE=M.memo(M.forwardRef((s,e)=>{const{children:t,view:n,movable:r,onRefLoad:o,onRefUnload:i,onHide:l,onShow:a,onUnFocus:c,isDragging:u,updateFrameBounds:d,dragStart:h,style:f,disabled:g,renderMovable:m,...p}=s,[S,w]=M.useState(zl),[b,C]=M.useState(null),[_,y]=M.useState(!1),v=M.useRef(null);M.useLayoutEffect(()=>{if(r.isClosed())return;const E=r.getBounds();if(!E)return;const R=n.toViewBounds(E);w(R??zl),d(R??zl)},[n?.getBounds()]),It(r,{onBoundsChange:E=>{const R=E.getBounds();if(!R)return;const I=n.toViewBounds(R);w(I??zl),d(I)},onSelectionChange:()=>{const E=P.hasFocus(v.current,!0);!_&&!E||r.isSelected()||c()}}),It(r,{onRequestFocus:()=>P.whenFocus(v.current,!0)},vE),M.useEffect(()=>{const E=v.current;return o(E),()=>{i(E)}},[]);const x=M.useMemo(()=>{if(!S)return null;let{width:E,height:R}=S;return m({view:n,movable:r,disabled:g,isDragging:u,style:{position:"relative",left:0,top:0,width:E,height:R},onHide:l,onShow:a})},[n,r,S.width,S.height,g,u]);return pe.jsx("div",{className:"movable",tabIndex:0,ref:Oo([v,e]),style:{display:"flex",alignItems:"stretch",justifyContent:"stretch",position:"absolute",maxWidth:"auto",maxHeight:"auto",minWidth:"auto",minHeight:"auto",left:S.x,top:S.y,width:S.width,height:S.height,...f},onMouseDown:async E=>{const R=E.shiftKey||E.ctrlKey,I=r.isSelected(),A=E.currentTarget;R&&I?r.unselect():(I&&!R||await r.select({addToSelection:R}),h(E.nativeEvent,A),A.focus())},onFocus:E=>{E.relatedTarget&&!b&&C(E.relatedTarget),y(!0)},onBlur:E=>{b&&!v?.current?.contains(E.relatedTarget)&&C(null),E.relatedTarget&&y(!1)},...p,children:x})})),EE="_movable-area_314c6_5",RE=M.memo(M.forwardRef((s,e)=>{const{view:t,movables:n,movablesView:r,renderMovable:o,transactional:i,onUnFocus:l,onFocus:a,disabled:c=!1,disableDrag:u=!1,disableResize:d=!1,className:h,style:f,renderDirections:g=["nw","n","ne","w","e","sw","s","se"],onFirstRender:m,...p}=s,S=t.getBounds(),w=ke(m,[m]),b=ke(l,[l]),C=ke(a,[a]),[_,y]=M.useState([]),[v,x]=M.useState(!1),[E,R]=M.useState(!1),I=M.useRef(!0),A=M.useRef(new Map),T=M.useRef(new Map),O=M.useRef(new Map),N=M.useRef(new Map),D=M.useRef(new Map),F=M.useRef({onRequestFocus:j=>(we(j),null)}),k=M.useRef(null),L=M.useRef(null),W=M.useRef(null),[$,J]=M.useReducer(j=>j+1,0);M.useLayoutEffect(()=>{J()},[t,n]),It(n,{onCollectionChange:()=>{const j=n.getItems({address:t.getVisibleRangeCoords(),ignoreHidden:!0}),se=D.current;se.forEach(xe=>{xe()}),se.clear();const ye=F.current;for(let xe=0;xe<j.length;xe++){const Ee=j[xe];if(Ee.isClosed())continue;const K=Ee.addListeners(ye);se.set(Ee,K)}J()},onInvalidated:()=>{J()}}),It(r,{onMovableSelectionChange(j){Q(),J()}});const te=M.useCallback((j,se)=>{const ye=O.current.get(j);W.current&&(W.current.getTargets().forEach(xe=>{if(xe===ye)return xe.style.left=se.x+"px",xe.style.top=se.y+"px",xe.style.width=se.width+"px",void(xe.style.height=se.height+"px")}),W.current.updateRect())},[]),Q=()=>{const j=[],se=r.getMovableSelection();se.forEach(ye=>{const xe=O.current.get(ye);xe&&se.indexOf(ye)!==-1&&j.push(xe)}),y(ye=>P.isEqualArrays(ye,j)?ye:j)},G=M.useRef(null),ee=M.useRef(null),ne=M.useMemo(()=>(ee.current||(ee.current=new Promise(j=>{G.current=j})),ee.current),[]),re=M.useRef(null),U=ke(async(j,se)=>{re.current=se,await(async()=>!(!await ne.then()||!W.current))()&&re.current===se&&W.current.dragStart(j,se)},[_]),[ue,oe]=M.useState(!1),Z=M.useRef(null),Y=M.useRef(null),we=ke(async(j=null)=>{if(j||(j=r.getMovableSelection()[0]),!j)return b?.(),!1;const se=O.current.get(j);se?(await P.whenFocus(se),se.focus(),Y.current=se,Z.current=null):Z.current=j},[r]);M.useEffect(()=>{ue&&_.length>0&&Y.current!==_[0]&&we(),I.current&&(w?.(),I.current=!1)},[_]);const ge=M.useMemo(()=>{const j=n.getItems({address:t.getVisibleRangeCoords(),ignoreHidden:!0});if(j.length===0&&A.current.size===0)return null;const se=(le,X,ae,Ie=!0)=>{const ve=le.isSelected(),ze={tabIndex:ae,view:t,movable:le,onRefLoad:_e=>{Z.current===le&&(_e.focus(),Y.current=_e,Z.current=null),O.current.set(le,_e),T.current.set(_e,le),X.rendered=!0,Q()},onRefUnload:_e=>{O.current.delete(le),T.current.delete(_e),X.rendered=!1,Q()},onUnFocus:b,onHide:_e=>{X.onHide=_e},onShow:_e=>{X.onShow=_e},isDragging:ve&&(E||v),disabled:c,renderMovable:o,updateFrameBounds:_e=>{te(le,_e)},dragStart:U,onMouseUp:()=>{if(re.current=null,L.current){x(!1),R(!1);let _e=!1;N.current?.forEach(Ne=>{P.isEqualBounds(Ne.movable.getBounds(),Ne.startBounds)||(_e=!0)}),_e?be():he()}},style:{opacity:Ie?v&&ve?.7:void 0:0,zIndex:v&&ve?le.getZIndex()+j.length:void 0,pointerEvents:Ie?void 0:"none",cursor:E&&ve?"grabbing":c||u?"initial":"move",boxShadow:!ve||E&&!v?void 0:"1px 1px 2px 2px rgba(0,0,0,.15)"}};return pe.jsx(xE,{...ze},`movable-${le.getUUID()}`)},ye=A.current,xe=new Map,Ee=[];for(let le=0;le<j.length;le++){const X=j[le];if(X.isClosed())continue;let ae=ye.get(X);ae||(ae={frame:null,shown:null,onShow:null,onHide:null,rendered:!1,doShow:(Ie,ve)=>{if(!ve||ve.shown===!0)return;ve.shown=!0;const ze=++ve.visibilityRequestId;requestAnimationFrame(()=>{const _e=A.current.get(Ie);_e&&ze===ve.visibilityRequestId&&(ve.onShow?.(Ie),_e.shown=!0)})},doHide:async(Ie,ve)=>{if(!ve||ve?.shown===!1)return;ve.shown=!1;const ze=++ve.visibilityRequestId,_e=await Promise.resolve(ve.onHide?.(Ie));ze===ve.visibilityRequestId&&_e!==!1&&(ve.shown=!1,A.current.delete(Ie),J())},visibilityRequestId:0}),ae.frame=se(X,ae,le,!0),Ee.push(ae.frame),ae.doShow(X,ae),ye.delete(X),xe.set(X,ae)}const K=[];return r.getMovableSelection().forEach(le=>{const X=ye.get(le);X&&(X.frame=se(le,X,-1,!1),K.push(X.frame),ye.delete(le),xe.set(le,X))}),ye.forEach((le,X)=>{le.frame=se(X,le,-1,!1),K.push(le.frame),le.doHide(X,le),ye.delete(X),xe.set(X,le)}),A.current=xe,Q(),[...K,...Ee]},[$,t,o,c,u,d,v,E]),de=ke((j,se)=>{const ye=`${se} ${_.length===1?Zd.capitalize(T.current?.get(_[0]).getContent().getType()):"Drawings"}`;L.current&&(console.warn(`Transaction ${L.current.getDescription()} is being replaced by ${ye}`),L.current.rollback(),L.current=null),L.current=i.beginCommit({description:ye}),N.current.clear();for(let xe=0;xe<_.length;xe++){const Ee=_[xe],K=T.current?.get(Ee);K?N.current.set(Ee,{movable:K,startBounds:t.toViewBounds(K.getBounds())}):console.warn("invalid element",K)}},[i,t,_]),be=M.useCallback(()=>{if(!L.current)return;const j=[];N.current?.forEach(se=>{j.push(se.movable)}),L.current.commit({viewAfter:{view:r,movableSelection:j}}),N.current.clear(),L.current=null},[]),he=M.useCallback(()=>{L.current&&(L.current.rollback(),L.current=null)},[]),fe=M.useRef(null);M.useEffect(()=>{fe.current&&(fe.current.onscroll=j=>{j.preventDefault(),j.srcElement.scrollTop=0,j.srcElement.scrollLeft=0})},[fe.current]);const z=Yn(e,()=>({isMovableArea:()=>!0,focusMovable:we,focus:()=>{we()}}),[r]),[Fe,De]=M.useState(null),Ge=M.useRef(!1),H=M.useRef(!1),ie=M.useRef(!1);M.useEffect(()=>{if(c||_.length===0||ie.current||Ge.current)return;if(H.current)return void requestAnimationFrame(()=>{W.current&&k.current&&W.current.refTargets.length>0&&(ie.current=!0,G.current?.(!0)),y([..._])});Ge.current=!0;const j=it.lazy(async()=>{try{const se=await ao(()=>import("./CL0VCEG7SV6dsMf0-JQkIxBW1.js"),__vite__mapDeps([11,3,1]),import.meta.url);return Ge.current=!1,H.current=!0,y([..._]),se}catch(se){return console.warn(se),G.current?.(!1),null}});De(j)},[_,c,u,d]);const Se=M.useMemo(()=>!Fe||c?null:pe.jsx(M.Suspense,{children:pe.jsx(Fe,{className:rn({dragging:v||E,resizing:v,moving:E}),container:null,ref:W,target:W.current?_:[],draggable:!c&&!u,resizable:!c&&!d,individualGroupable:!0,edgeDraggable:!1,throttleDrag:2,throttleResize:2,origin:!1,keepRatio:!1,renderDirections:g,onResizeStart:j=>{de(j.target,"Resize")},onResize:j=>{if(!L.current)return j.stopDrag(),void J();x(!0);const se=j.direction[0]!==0&&j.direction[1]!==0;let ye=0,xe=0;for(let Ee=0;Ee<_.length;Ee++){const K=_[Ee],le=N.current.get(K),X=T.current.get(K);if(!le||!X){console.warn("invalid element");continue}let ae=j.dist[0],Ie=j.dist[1],ve=j.drag.dist[0],ze=j.drag.dist[1],_e=le.startBounds.width,Ne=le.startBounds.height;Ee===0?(ye=_e,xe=Ne):(ae*=_e/ye,ve*=_e/ye,Ie*=Ne/xe,ze*=Ne/xe);const me={...le.startBounds};if(me.width=Math.max(0,_e+ae),me.height=Math.max(0,Ne+Ie),j.direction[0]===-1&&(me.width=Math.max(0,Math.min(le.startBounds.x+_e,_e-ve))),j.direction[1]===-1&&(me.height=Math.max(0,Math.min(le.startBounds.y+Ne,Ne-ze))),se&&(X.isLockAspectRatio()||j.inputEvent?.shiftKey)){const Re=_e/Ne,Me=me.width/me.height;Me>Re?me.height=me.width/Re:Me<Re&&(me.width=me.height*Re)}j.direction[0]===-1&&(me.x=Math.max(0,Math.min(le.startBounds.x+_e,le.startBounds.x+_e-me.width))),j.direction[1]===-1&&(me.y=Math.min(le.startBounds.y+Ne,le.startBounds.y+Ne-me.height)),le.movable.setBounds(t.toAbsoluteBounds(me))}},onResizeEnd:j=>{x(!1),be()},onDragStart:j=>{de(j.target,"Move")},onDrag:j=>{if(!L.current)return j.stopDrag(),void J();R(!0);for(let se=0;se<_.length;se++){const ye=_[se],xe=N.current.get(ye);xe?xe.movable.setBounds(t.toAbsoluteBounds({...xe.startBounds,x:xe.startBounds.x+j.translate[0],y:xe.startBounds.y+j.translate[1]})):console.warn("invalid element")}},onDragEnd:j=>{},onMouseUp:j=>{}})}),[$,Fe,_,t,c,u,d,v,E]);return pe.jsx("div",{className:rn(h,"movable-area",EE),style:{width:S.width,height:S.height,...f,position:"absolute",overflow:"hidden",willChange:"transform"},ref:Oo([z,fe]),...p,children:pe.jsx("div",{className:"movable-scroll",style:{position:"absolute",cursor:"initial",left:0,top:0,width:S.width,height:S.height},...p,children:pe.jsxs("div",{ref:k,style:{position:"absolute",pointerEvents:"auto"},onFocus:j=>{C?.(),oe(!0)},onBlur:j=>{oe(!1)},onKeyDownCapture:j=>{if(j.isDefaultPrevented())return;const se=j.nativeEvent.ctrlKey,ye=j.nativeEvent.altKey,xe=j.nativeEvent.shiftKey;if(j.which===In.Escape){const ae=r.getMovableSelection();let Ie=[...ae];return _.forEach(ve=>{if(Ie.length===0)return;const ze=T.current.get(ve);let _e=Ie.indexOf(ze);Ie.splice(_e,1)}),Ie.length!==ae.length&&r.selectMovables(Ie),Ie.length===0&&b?.(),void j.preventDefault()}const Ee=.1,K=ae=>{n.updateSelected(Ie=>{Ie.setRotation(Ie.getRotation()+ae)},"Rotate")},le=(ae,Ie=!0)=>{n.updateSelected(ve=>{const ze=ve.getBounds();let _e=1+ae;Ie||(_e=1/_e);const Ne=Math.sqrt(Math.pow(ze.width,2)+Math.pow(ze.height,2)),me=Math.atan2(ze.height,ze.width),Re=_e*Ne;if(Re<10)return;const Me=Re*Math.cos(me),qe=Re*Math.sin(me),nt={x:ze.x+(ze.width-Me)/2,y:ze.y+(ze.height-qe)/2,width:Me,height:qe};ve.setBounds(nt)},"Resize")},X=ae=>{n.updateSelected(Ie=>{const ve=Ie.getBounds(),ze={x:ve.x+(ae.x??0),y:ve.y+(ae.y??0),width:ve.width+(ae.width??0),height:ve.height+(ae.height??0)};Ie.setBounds(ze)},"Nudge")};if(j.which===In.Delete)n.updateSelected(ae=>{ae.delete()},"Delete"),j.preventDefault();else if(j.key==="a"&&se){const ae=r.getMovableSelection();r.selectMovables(n.getItems(),!0),r.selectMovables(ae,!0),j.preventDefault()}else j.key==="ArrowLeft"?(xe?le(Ee,!1):ye?K(-10):X({x:se?-10:-1}),j.preventDefault()):j.key==="ArrowRight"?(xe?le(Ee,!0):ye?K(10):X({x:se?10:1}),j.preventDefault()):j.key==="ArrowUp"?(xe?le(Ee,!0):X({y:se?-10:-1}),j.preventDefault()):j.key==="ArrowDown"&&(xe?le(Ee,!1):X({y:se?10:1}),j.preventDefault())},children:[ge,Se]})})})})),es=s=>{let e=Number.MAX_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER,n=0,r=0;for(let o=0;o<s.length;o++){const i=s[o].getBounds();e=Math.min(i.x,e),t=Math.min(i.y,t),n=Math.max(i.x+i.width,n),r=Math.max(i.y+i.height,r)}return{x:e,y:t,width:n-e,height:r-t}},rp=(s,e=!0)=>{const t=[],n=e?"x":"y",r=e?"y":"x",o=e?"width":"height";let i=0,l=Number.MAX_SAFE_INTEGER,a=0;for(let d=0;d<s.length;d++){const h=s[d],f=h.getBounds();i+=f[o],l=Math.min(f[n],l),a=Math.max(f[n]+f[o],a),t.push({bounds:f,movable:h})}const c=(a-l-i)/(s.length-1);t.sort((d,h)=>{const f=d.bounds[n],g=h.bounds[n];return f!==g?f-g:d.bounds[r]-h.bounds[r]});const u=new Map;u.set(t[0].movable,t[0].bounds);for(let d=1;d<t.length-1;d++){const h=t[d-1].bounds,f={...t[d].bounds};f[n]=h[n]+h[o]+c,t[d].bounds=f,u.set(t[d].movable,f)}return u.set(t[t.length-1].movable,t[t.length-1].bounds),u},IE=s=>{const{movables:e,movablesView:t,transactional:n,commands:r,target:o,onRepeatCommandChange:i}=s,l=Hi(),a=Mo();M.useRef(a.getMode()).current=a.getMode();const c=ke(async(b,C,_=null,y=!0)=>{const v=async()=>{const x=await Promise.resolve(l?.showBusy?.(b.getLabel()));try{await C();const E=_??b?.getLabel?.();if(i){let R=null;b&&E!==!1&&(R=new tt(b.getKey(),o,{label:E,description:E},v)),i(R)}x?.(),y&&a.setMode(null)}catch(E){x?.(),l?.showError?.(E)}};await v()},[i,l]),[u,d]=M.useReducer(b=>b+1,0),h=ke((b,C,_)=>{if(!t)return;const y=t.getMovableSelection();if(y.length===0)return;let v="Drawings";if(y.length===1){const E=y[0];v=Zd.capitalize(E.getContent().getType())??"Drawing"}const x=`${b.getLabel()} ${v}`;c(b,()=>{let E=null;n&&(E=n.beginCommit(x));const R=t.getMovableSelection();if(R.length===0)return;const I=_?.(R);for(let A=0;A<R.length;A++){const T=R[A];C(T,I)}E?.commit()})},[t,n]),[f,g]=M.useState(t.getMovableSelection()[0]??null),[m,p]=M.useState(!f||f?.isProtected()),S=M.useMemo(()=>[new Ae("moveToFront",o,{label:"Bring to Front",description:"Move to the front of all of the other drawings.",icon:"DrawToFront",shortcut:{key:"BracketRight",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){h(this,b=>{b.moveToFront()})}),new Ae("moveForward",o,{label:"Bring Forward",description:"Move forward one layer in the z order.",icon:"DrawMoveForward",shortcut:{key:"BracketRight",modifiers:[Oe.Ctrl]}},function(){h(this,b=>{b.moveForward()})}),new Ae("moveToBack",o,{label:"Send to Back",description:"Move to the back of all of the other drawings.",icon:"DrawToBack",shortcut:{key:"BracketLeft",modifiers:[Oe.Ctrl,Oe.Shift]}},function(){h(this,b=>{b.moveToBack()})}),new Ae("moveBackward",o,{label:"Send Backward",description:"Move backwards one layer in the z order.",icon:"DrawMoveBackward",shortcut:{key:"BracketLeft",modifiers:[Oe.Ctrl]}},function(){h(this,b=>{b.moveBackward()})}),new Ae("toggleLockAspectRatio",o,{label:"Lock Aspect Ratio",description:"Toggle whether the aspect ratio should be maintained when resizing from corners.",icon:"DrawAspect"},function(){h(this,b=>{b.setLockAspectRatio(!b.isLockAspectRatio())})}),new Ae("formatAnchorTypeTwoCell",o,{label:"Move and size with cells",description:"Set your drawing to move and resize when underling sheet resizes.",icon:"DrawResize"},function(){h(this,b=>{b.setAnchorType(Xt.Type.TwoCell)})}),new Ae("formatAnchorTypeOneCell",o,{label:"Move but don't size with cells",description:"Set your drawing to only move when underling sheet resizes.",icon:"DrawResize"},function(){h(this,b=>{b.setAnchorType(Xt.Type.OneCell)})}),new Ae("formatAnchorTypeAbsolute",o,{label:"Don't move or size with cells",description:"Set your drawing to never move or resize when underling sheet resizes.",icon:"DrawResize"},function(){h(this,b=>{b.setAnchorType(Xt.Type.Absolute)})}),new Ae("formatDrawAlignLeft",o,{label:"Align Left",description:"Align the selected drawings to the left.",icon:"DrawAlignLeft"},function(){h(this,(b,C)=>{b.setBounds({x:C.x})},es)}),new Ae("formatDrawAlignCenter",o,{label:"Align Center",description:"Align the selected drawings vertically relative to each other.",icon:"DrawAlignCenter"},function(){h(this,(b,C)=>{b.setBounds({x:(C.width-b.getBounds().width)/2+C.x})},es)}),new Ae("formatDrawAlignRight",o,{label:"Align Right",description:"Align the selected drawings to the right.",icon:"DrawAlignRight"},function(){h(this,(b,C)=>{b.setBounds({x:C.width-b.getBounds().width+C.x})},es)}),new Ae("formatDrawAlignTop",o,{label:"Align Top",description:"Align the selected drawings to the top.",icon:"DrawAlignTop"},function(){h(this,(b,C)=>{b.setBounds({y:C.y})},es)}),new Ae("formatDrawAlignMiddle",o,{label:"Align Middle",description:"Align the selected drawings horizontally relative to each other.",icon:"DrawAlignMiddle"},function(){h(this,(b,C)=>{b.setBounds({y:(C.height-b.getBounds().height)/2+C.y})},es)}),new Ae("formatDrawAlignBottom",o,{label:"Align Bottom",description:"Align the selected drawings to the bottom.",icon:"DrawAlignBottom"},function(){h(this,(b,C)=>{b.setBounds({y:C.height-b.getBounds().height+C.y})},es)}),new Ae("formatDrawDistributeHorz",o,{label:"Distribute Horizontally",description:"Distribute the selected drawings horizontally with equal spacing between each.",icon:"DrawDistributeHorz"},function(){h(this,(b,C)=>{b.setBounds(C.get(b))},b=>rp(b))}),new Ae("formatDrawDistributeVert",o,{label:"Distribute Vertically",description:"Distribute the selected drawings vertically with equal spacing between each.",icon:"DrawDistributeVert"},function(){h(this,(b,C)=>{b.setBounds(C.get(b))},b=>rp(b,!1))}),new Ae("formatDrawFlipHorz",o,{label:"Flip Horizontally",description:"Flip the selected drawings horizontally."}),new Ae("formatDrawFlipVert",o,{label:"Flip Vertically",description:"Flip the selected drawings vertically."}),new Ae("formatDrawGroup",o,{label:"Group",description:"Group the selected drawings into a single drawing.",icon:"DrawGroup"}),new Ae("formatDrawUngroup",o,{label:"Ungroup",description:"Break the group of a drawing into individual drawings.",icon:"DrawUngroup"}),new Ae("formatDrawSwapShapes",o,{label:"Swap Shapes",description:"Swap the positions of the swap."}),new Ae("formatDrawSwapShapesHorz",o,{label:"Swap Shapes Horizontally",description:"Swap the positions of the swap horizontally."}),new Ae("formatDrawSwapShapesVert",o,{label:"Swap Shapes Vertically",description:"Swap the positions of the swap vertically."})],[t,f]);M.useEffect(()=>{},[a]);const w=M.useMemo(()=>{let b=null;return b=r?r.createChildGroup(o,"movable",!1):new Ua(o,"movable"),b.addCommands(S,!0),b},[r,S]);return It(f,{onAnyChange:()=>{w.getCommand("formatAnchorTypeTwoCell").update({state:f?.getAnchorType()===Xt.Type.TwoCell}),w.getCommand("formatAnchorTypeOneCell").update({state:f?.getAnchorType()===Xt.Type.OneCell}),w.getCommand("formatAnchorTypeAbsolute").update({state:f?.getAnchorType()===Xt.Type.Absolute}),w.getCommand("formatAnchorTypeAbsolute").update({state:f?.getAnchorType()===Xt.Type.Absolute}),w.getCommand("toggleLockAspectRatio").update({state:f?.isLockAspectRatio()})},onProtectedChange:b=>{p(b.isProtected())},onDelete:()=>{}}),It(t,{onMovableSelectionChange:()=>{const b=t.getMovableSelection()[0]??null;g(b),p(!b||b.isProtected()),d()}}),It(e,{onCollectionChange:()=>{d()}}),M.useEffect(()=>{const b={disabled:m};w.getCommand("formatAnchorTypeTwoCell").update(b),w.getCommand("formatAnchorTypeOneCell").update(b),w.getCommand("formatAnchorTypeAbsolute").update(b),w.getCommand("toggleLockAspectRatio").update(b);const C=e.getCount(),_=t.getMovableSelection(),y=m||C<=1||_.length===0;let v={disabled:y},x=v;if(!y&&_.length===1){const I=_[0];I.getZIndex()===0&&(v={disabled:!0}),I.getZIndex()===C-1&&(x={disabled:!0})}w.getCommand("moveToFront").update(x),w.getCommand("moveForward").update(x),w.getCommand("moveToBack").update(v),w.getCommand("moveBackward").update(v);const E={disabled:m||_.length<=1};w.getCommand("formatDrawAlignLeft").update(E),w.getCommand("formatDrawAlignCenter").update(E),w.getCommand("formatDrawAlignRight").update(E),w.getCommand("formatDrawAlignTop").update(E),w.getCommand("formatDrawAlignMiddle").update(E),w.getCommand("formatDrawAlignBottom").update(E),w.getCommand("formatDrawFlipHorz").update(E),w.getCommand("formatDrawFlipVert").update(E),w.getCommand("formatDrawGroup").update(E),w.getCommand("formatDrawUngroup").update(E),w.getCommand("formatDrawSwapShapes").update(E),w.getCommand("formatDrawSwapShapesHorz").update(E),w.getCommand("formatDrawSwapShapesVert").update(E);const R={disabled:m||_.length<=2};w.getCommand("formatDrawDistributeHorz").update(R),w.getCommand("formatDrawDistributeVert").update(R)},[u,m,u]),w},k2=M.memo(M.forwardRef((s,e)=>{const{children:t,disabled:n,description:r,view:o,isDragging:i,onHide:l,onShow:a,...c}=s;M.useEffect(()=>{},[r]);const u=Yn(e,()=>({isEmptyFrame:()=>!0}),[]),[d,{height:h,width:f}]=Es();return pe.jsx("div",{...c,ref:Oo([u,d]),children:pe.jsx("div",{className:"chart-editor",style:{width:"100%",height:"100%",border:"var(--sxl-app-color-grey, grey) solid 1px",backgroundColor:"var(--sxl-app-color-background, white)",backgroundImage:"var(--sxl-app-image-background)",alignItems:"center",justifyContent:"center",zoom:o.getZoom(),display:"flex",position:"relative",filter:n?"blur(1px)":void 0,boxShadow:i?"1px 1px 2px var(--sxl-app-color-shadow, rgba(0,0,0,.15))":void 0},children:pe.jsx("div",{style:{textAlign:"center"},children:r})})})})),AE=M.memo(M.forwardRef((s,e)=>{const{view:t,sheet:n,propsMovable:r,renderMovable:o,commands:i,target:l,onRepeatCommandChange:a}=s,c=IE({movables:n.getMovables(),movablesView:n?.getView(),transactional:n,onRepeatCommandChange:a,commands:i,target:l});M.useEffect(()=>{t?.getStage()},[t?.getStage()]);const u=M.useMemo(()=>pe.jsx(RE,{ref:e,view:t,movables:n.getMovables(),disableResize:!n.getProtection().isObjectsAllowed(),disableDrag:!n.getProtection().isObjectsAllowed(),movablesView:n.getView(),transactional:n,renderMovable:o,...r,onFocus:()=>{c.activate(),r?.onFocus?.()}},"movable-area"),[n,r,i,c]);return u&&t?u:null})),ME=M.memo(M.forwardRef((s,e)=>{const{view:t,sheet:n,gridStyle:r,getCellEditor:o,showProtectedError:i,setEditingCoords:l,commands:a}=s,c=Mo(),[u,d]=M.useState(null),[h,f]=M.useState(null),[g,m]=M.useState(null),[p,S]=M.useState(null),[w,b]=M.useState(null);M.useLayoutEffect(()=>{if(g===null)return S(null),void b(null);const D=()=>{const F=n.getRange(g).getCell(),k=F.getStyle();let L,W=k.getFill()?.toCSS(r.body.darkMode);W.background!=="none"&&W.background!=="transparent"||(W=n.getStyles().getNormal().getFill().toCSS(r.body.darkMode)),W.background!=="none"&&W.background!=="transparent"||(W={background:r.body.fill}),S({style:W}),F&&!F.getFormula()&&(L=F?.getRenderHorizontalAlignment()),b(L??t_.Left)};return D(),n.getRange(g).addListener(()=>{D()})},[n,g,r?.body]);const C=ke(()=>{let D=h.editState.dirty??"";if(h.editState.dirty!==void 0){const F=Zd.clampString(D);try{const k=h.sheet.getRange(h.coords),L=`Typing '${F}' into ${k.toString()}`;return k.setValue(D,{description:L,autoFit:!0}),m(null),f(null),c.setMode(null),l(null),!0}catch(k){throw cs.error(new Error(`Unable to enter '${F}'.`,{cause:k})),k}}},[n,h]),_=ke(D=>n.getRange(D).getCell().getExtrusions()??q.cellToRange(D),[n]);ke(D=>{let F=B.Orientation.Row,k=!1;D!==B.Direction.Up&&D!==B.Direction.Down||(F=B.Orientation.Column),D!==B.Direction.Left&&D!==B.Direction.Up||(k=!0),n.getSelection().traverse(F,k)},[n]);const y=M.useCallback((D,F)=>{if(o)return o(D,F);if(!n)return null;const{ref:k,...L}=D;return pe.jsx(zx,{ref:k,...L,sheet:n,bodyStyle:r?.body,activeCoords:F,commands:a,onChangeEdit:W=>{const $={sheet:n,coords:F,editState:W};c.setMode(J=>({...J,description:$.editState.editMode?"Edit":"Enter",args:{...J?.args,stateAndCoords:$}}))},editState:h.editState})},[n,p,o,h,g]),{renderOverlay:v,startEdit:x,submitEdit:E,cancelEdit:R,onKeyboardEventNative:I,onPointerEventNative:A}=s_({view:t,activeCoords:u,getCellEditor:y,canEdit:()=>{const D=n.getProtection();if(D.isReadOnly())return!1;const F=D.isLocked();return F&&i(),!F},onBeforeStartEdit:D=>{const F=Px(()=>n.getRange(D).getCell()),k={sheet:n,coords:D,editState:Object.freeze(F)};c.setMode({key:"edit",args:{stateAndCoords:k}}),f(k)},onStartEdit:D=>{m(D),l(D)},onSubmitEdit:C,onCancelEdit:D=>{m(null),f(null),c.setMode(null),l(null)},onDoneEdit:D=>{c.setMode(null)},propsContainer:p,borderStrokeFill:r.selection?.strokeFill,borderStrokeWidth:n?.getSelection().getCoords().ranges?.length>1?1:2,alignment:w,getRangeCoords:_});It(n.getSelection(),{onChange(D){d(n.getSelection().getCoords().cell)}});const T=ke(D=>{A(D),g&&E()},[A,R,g]),O=M.useCallback(D=>{A(D)},[A]),N=M.useCallback(D=>{I(D)},[I]);return M.useEffect(()=>{const D=t?.getStage();if(D)return D.addEventListener("pointerdown",T),D.addEventListener("dblclick",O),D.addEventListener("keydown",N),()=>{D.removeEventListener("pointerdown",T),D.removeEventListener("dblclick",O),D.removeEventListener("keydown",N)}},[t?.getStage()]),M.useEffect(()=>{const D=c.getMode(),F=D?.key;F==="edit"||F==="enter"?h?D.args?.cancel?R():D.args?.submit?E():f(D.args?.stateAndCoords):x(D.args?.start):g&&R()},[c]),v(t,e)})),lw="white",aw="black",TE=`url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg' %3E%3Cg%3E%3Cpath d='m 14.5,8 -5.6875,5.6875 v -3.25 H 1.5 v -4.875 h 7.3125 v -3.25 z' stroke='${aw}' fill='${lw}'/%3E%3C/g%3E%3C/svg%3E%0A") 15 8, pointer`,kE=`url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg' %3E%3Cg%3E%3Cpath d='M 13.24564,12.979958 H 5.2023009 L 7.500398,10.681861 2.3296796,5.5111425 5.7768252,2.0639969 10.947543,7.2347153 13.24564,4.9366182 Z' stroke='${aw}' fill='${lw}'/%3E%3C/g%3E%3C/svg%3E%0A") 12 12, pointer`,FE=M.memo(M.forwardRef((s,e)=>{const{view:t,sheet:n}=s,[r,o]=it.useState(n.getTables().getCount()>0),[i,l]=it.useState(null),[a,c]=it.useState(null),[u,d]=it.useState(null),[h,f]=it.useState(null),g=ke(()=>{if(n.getTables().getCount()>0){o(!0);const _=n.getTables().getItems({address:t.getVisibleRangeCoords()});l(_.length>0?_:null)}else o(!1),l(null)},[n,t]),m=ke(_=>{_.preventDefault(),_.stopPropagation();const y=t.getCellCoordsFromClient(_.clientX,_.clientY),v=n.getTables().getItems({address:y});v.length===1&&v[0].select()},[t,n]),p=ke(_=>{_.preventDefault(),_.stopPropagation();const y=t.getCellCoordsFromClient(_.clientX,_.clientY),v=n.getTables().getItems({address:y});if(v.length===1){const x=v[0].getRange().getCoords(),E={colStart:x.colStart,rowStart:y.rowIndex,colEnd:x.colEnd,rowEnd:y.rowIndex};n.getRange(E).select()}},[t,n]),S=ke(()=>{if(!r)return;const _=n.getTables().getItems({address:t.getVisibleRangeCoords()});l(_.length>0?_:null)},[n,r,t]);It(n?.getSelection(),{onChange(_){c(n.getSelection().getCoords().cell)}}),It(u,{onAnyChange(_){g(),S()}}),It(h,{onAnyChange(_){S()}}),It(n,{onTablesChange(_){g(),S()},onInvalidated(_){g(),S()}});const w=it.useMemo(()=>P.debounce(P.throttle(S,300),300),[]);M.useEffect(()=>{w()},[t]),M.useEffect(()=>{let _=null;if(i)for(let y=0;y<i.length&&!_;y++){const v=i[y],x=v.getRange().getCoords();q.isCellWithinRange(a,x)&&(_=v)}d(_)},[a,i]);const b=ke(_=>{let y=null;if(i)for(let v=0;v<i.length;v++){const x=i[v],E=x.getRange().getCoords();let R=t.getRangeCoordsBounds(E);const I=t.getRelativePointFromClient(_.clientX,_.clientY),A=I.x,T=I.y;if(A>=R.x&&A<=R.x+R.width&&T>=R.y&&T<=R.y+R.height){const O=t.getViewportSize();A<=0||T<=0||A>=O.width||T>=O.height||(y=x)}}f(y)},[t,i]);if(M.useEffect(()=>{const _=t?.getStage();if(_&&i)return _.addEventListener("mousemove",b),_.addEventListener("mouseleave",b),()=>{_.removeEventListener("mousemove",b),_.removeEventListener("mouseleave",b)}},[i,t?.getStage()]),!t||!i||i.length===0)return null;const C=[];for(let _=0;_<i.length;_++){const y=i[_];if(y.isClosed())continue;const v=y===h,x=y===u,E=y.getRange().getCoords(),R=t.getRangeCoordsBounds(E);let I;if(v||x){const A=y.getStyle().getProperties(),T=A.headerRow?.fill?.background??A.wholeTable?.border?.top?.color?.toString();if(T&&n){const O=n.getStyles().parseColor(T);O&&(I=O.toCSS())}I||(I="var(--sxl-app-color-shadow, rgba(0,0,0,.15))")}C.push(pe.jsx("div",{style:{position:"absolute",left:R.x,top:R.y,width:Math.min(16,R.width),height:R.height,pointerEvents:"all",cursor:TE},onMouseDown:p},`table-select-row-${y.getName()}`)),C.push(pe.jsx("div",{style:{position:"absolute",left:R.x,top:R.y,width:Math.min(16,R.width),height:Math.min(16,R.height),pointerEvents:"all",cursor:kE},onMouseDown:m},`table-select-${y.getName()}`)),C.push(pe.jsx(Op,{x:R.x,y:R.y,width:R.width,height:R.height,range:E,strokeWidth:x?.5:0,stroke:I??"var(--sxl-app-color-grey, grey)",style:{willChange:"box-shadow",transition:"box-shadow 80ms ease-in-out",boxShadow:v?`${I} 0px 0px 1px 1px`:void 0}},`table-outline-${y.getName()}`))}return C})),NE=M.memo(M.forwardRef((s,e)=>{const{view:t,sheet:n,animationTime:r=60}=s,[o,i]=it.useState(null),[l,a]=it.useState(null),c=it.useRef(null),u=ke(()=>{const p=n.getSelectedCell(),S=p.getSpill()?.getCoords()??null;q.isEqualRanges(S,o)||(a(S?{transition:o?"move":"in",bounds:t.getRangeCoordsBounds(S),coords:S}:{transition:"out",bounds:t.getRangeCoordsBounds(o),coords:o}),i(S))},[n,t,o]);it.useEffect(()=>(c.current&&(clearTimeout(c.current),c.current=null),l&&(c.current=setTimeout(()=>{a(null),c.current=null},r)),()=>{c.current&&(clearTimeout(c.current),c.current=null)}),[l,r]);const d=it.useMemo(()=>P.debounce(P.throttle(u,80),80),[]);if(It(n?.getSelection(),{onChange(p){d()}}),It(n,{onSpillsChange(p){u()},onInvalidated(p){u()}}),!t||!o&&!l)return null;const h=n.getRange(o).getValue()instanceof $e.Spill,f=[];let g=l?.bounds??t.getRangeCoordsBounds(o);if(l&&!P.isEqualBounds(l.bounds,t.getRangeCoordsBounds(l.coords))&&a(null),g=t.toClipBounds(g,-10),!g)return;const m="var(--sxl-app-color-primary-dark, rgba(0,0,0,.15))";return f.push(pe.jsx(Op,{x:g.x,y:g.y,width:g.width,height:g.height,range:o,strokeWidth:1,stroke:m,style:{willChange:"transform, opacity, width, height, opacity, left, top",strokeDasharray:h?"6 3":void 0,opacity:l?.transition==="out"?0:1,transition:l?.transition?l.transition==="in"||l.transition==="out"?`opacity ${1.5*r}ms ease-in-out`:`left ${r}ms ease-out, top ${r}ms ease-out, width ${r}ms ease-out, height ${r}ms ease-out`:"none",boxShadow:`${m} 0px 0px 4px 0px`}},"spill-outline}")),f})),OE={position:"absolute",top:0,left:0,bottom:0,right:0},op=(s,e)=>{const t={...s},n=e?.getNormal().getFont(),r=n?.toCSS(),o={text:{fontFamily:r?.fontFamily,fontSize:n?.getSize()}},i=t.body=P.mergeContentful(s.body,o);return t.body=P.mergeContentful({fill:"#fff",strokeFill:"#dad8d6",strokeWidth:.5,text:{fontWeight:"400",fontStyle:"normal",fill:"#040404"}},i),t.buttonSurface=P.mergeContentful({fill:"#fff",text:{fill:"black"},edgeStrokeFill:"black"},t.buttonSurface),t.selection={fill:"rgba(16, 124, 65, 0.1)",strokeFill:"#217346",strokeWidth:2,...s.selection},t.selectionInactive={...t.selection,fill:"rgba(16, 124, 65, 0.1)",strokeFill:"#dad8d6",...s.selectionInactive},t.selectionRemove={...t.selection,fill:"rgba(200, 0, 0, 0.1)",strokeFill:"rgba(200, 0, 0, 1)",...s.selectionRemove},t.headerSelection={...t.selection,...s.headerSelection},t.headerSelectionInactive={...t.selectionInactive,...s.headerSelectionInactive},t.header=P.mergeContentful(t.body,{edgeStrokeFill:"rgb(171, 171, 171)",fill:"#f0f0f0",strokeShadow:void 0,edgeStrokeWidth:1},s.header),t.header=P.mergeContentful(t.header,o),t.headerSelect=P.mergeContentful(t.header,{fill:"rgba(16, 124, 65, 0.1)",text:{fill:t.headerSelection.strokeFill,fontWeight:"700"}},s.headerSelect),t.headerSelect=P.mergeContentful(t.headerSelect,o),t.headerSelectAll=P.mergeContentful(t.headerSelect,{},s.headerSelectAll),t.headerSelectAll=P.mergeContentful(t.headerSelectAll,o),t},DE={fireOnModelChange:!1},sp={},LE=M.memo(M.forwardRef((s,e)=>{const{sheet:t,gridStyle:n=sp,headersStyle:r=sp,onSheetContextMenu:o,showColumnHeaders:i,propsColumnHeader:l,showRowHeaders:a,propsRowHeader:c,showScrollbars:u=!0,propsScrollPane:d,onViewportChange:h,commands:f,onRepeatCommandChange:g,overlays:m,renderMovable:p,viewportComponent:S,onElementLoad:w,getCellEditor:b,onFocus:C,onBlur:_,style:y=St.EmptyCssProperties,onShowTooltip:v,onShowColumnTooltip:x,onShowRowTooltip:E,onCloseTooltip:R,propsGrid:I,propsCellRender:A,...T}=s;if(it.useEffect(()=>{qa._validate(!0)},[]),!t)throw new Error("ISheet must be provided.");const[O,N]=it.useReducer(Te=>Te+1,0),[D,{width:F,height:k}]=Es(),L=ke(v,[v]),W=ke(x,[x]),$=ke(E,[E]),J=ke(R,[R]),te=M.useRef(!1);M.useLayoutEffect(()=>{te.current=!0},[t]);const Q=t?.getStyles(),G=M.useMemo(()=>op(n,Q),[n,Q]),ee=M.useMemo(()=>op(r,Q),[r,Q]),{body:ne={},buttonSurface:re={}}=G,{header:U={},headerSelect:ue={},headerSelectAll:oe={}}=ee,Z=M.useRef(null),[Y,we]=M.useState(()=>t?.getView()),ge=(Y?.getZoomScale()??100)/100,de=M.useMemo(()=>({vertical:Y.isShowColumnGridlines()&&ge>=.4,horizontal:Y.isShowRowGridlines()&&ge>=.4}),[Y?.isShowColumnGridlines(),Y?.isShowRowGridlines(),ge]),be=M.useMemo(()=>{if(Y?.getGridLineColor())return{strokeDasharray:"1,1"}},[Y?.getGridLineColor(),G]),he=i??Y?.isShowColumnHeaders(),fe=a??Y?.isShowRowHeaders(),[z,Fe]=M.useState({width:0,height:0}),De=M.useMemo(()=>{let Te=40,Je=20;const ot=t?.getStyles().getNormal().getFont();if(z.width>0&&z.height>0){const rt=ot?.toCSS()?.fontFamily??G.header.text.fontFamily,mt=ot?.getSize()??G.header.text.fontSize,at=Be.getSharedMeasurer()(""+z.height,Math.ceil(mt*Be.getDeviceScale()),rt);Te=at.width,Je=at.lineHeight}return{width:Math.round(Te+5),height:Math.round(Je+3)}},[z,G?.header.text,t]),Ge=fe?ge*De.width:U.edgeStrokeWidth,H=he?ge*De.height:U.edgeStrokeWidth,ie=Math.max(F,(t?.getColumnHeaders().getDefaultSize()??De.width)+Ge+1),Se=Math.max(k,(t?.getRowHeaders().getDefaultSize()??De.height)+H+1),j=M.useRef(new Map),se=M.useRef(null),ye=()=>({getColOffset:Te=>t.getColumnHeaders().findOffset(Te),getColIndex:Te=>t.getColumnHeaders().findIndex(Te),getRowOffset:Te=>t.getRowHeaders().findOffset(Te),getRowIndex:Te=>t.getRowHeaders().findIndex(Te)}),[xe,Ee]=M.useState(()=>ye()),[K,le]=M.useState(!1),[X,ae]=M.useState(null),Ie=!0,ve=G.selection?.strokeFill,ze=M.useCallback(()=>ur.current,[]),[_e,Ne]=M.useState(),me=ke(Te=>{Ne(Te);const Je=t?t.getView():null;Je&&Je.setTopLeft(Te?{left:Te.left,top:Te.top}:null),h?.(Te)},[t,h]),Re=M.useRef(null);M.useEffect(()=>{if(!_e||!t)return;const Te=t.getRangeAtBounds({x:_e.left,y:_e.top,width:_e.width,height:_e.height});Re.current?.(),Re.current=Te.addListener(()=>{const Je=Te.getCoords();Z?.current?.invalidate(Je)})},[_e,t]);const[Me,qe]=M.useState(()=>t?.getView().getTopLeft()),nt=ke(Te=>{const Je=q.cellToRange(Te);if(t.isClosed())return Je;const ot=t.getRange(Je,{ignoreHidden:!0}).getMerges();return ot.length===0?Je:ot[0]},[t]),Ye=Te=>{if(!Te||Te.coords.colIndex===0&&Te.coords.rowIndex===0)return null;const Je={};return Te.coords.colIndex>0&&(Je[Et.Left]={index:Te.coords.colIndex,scrollOffset:Te.topLeft.left}),Te.coords.rowIndex>0&&(Je[Et.Top]={index:Te.coords.rowIndex,scrollOffset:Te.topLeft.top}),Je},[Ve,et]=M.useState(()=>Ye(t.getView().getFreezePanes())),We=Mo(),Xe=M.useCallback(()=>Z.current,[]),Ue=ke(Te=>{We.setMode(Je=>Je?.key==="edit"?{...Je,args:{...Je.args}}:{key:"edit",args:{stateAndCoords:null,start:Te}})},[]),Ke=ke(()=>_e,[_e]),Ze=oE({sheet:t,commands:f,target:Xe,onRepeatCommandChange:g,bodyStyle:ne,onStartEdit:Ue,getViewport:Ke}),[wt,pt]=M.useState(t.getSelection().isEntire()),[_t,jt]=M.useState(Y?.getMovableSelection().length>0),Ot=X!==null||_t,lt=null,[Bt,zt]=M.useState(!1);M.useEffect(()=>{zt(!1)},[t.getProtection()]);const vt=Hi(),qt=ke(()=>{Bt||(zt(!0),vt.showMessage?.(pe.jsxs("span",{children:["This sheet is protected.",pe.jsx("br",{}),"To make a change, unprotect the sheet. You might be requested to enter a password."]}),{type:jd.Error}))},[vt,Bt]),Fn=M.useMemo(()=>{const Te=We.getMode();return Te?.cursor?Te.cursor:null},[lt,We]),[$n,on]=M.useState(null),bn=M.useRef(!1),[Vn,uc]=M.useState([]),Fs=M.useRef(null),[Zi,Do]=M.useState(zr.EmptyTopLeft),[Lo,$r]=M.useState(zr.EmptyTopLeft);M.useEffect(()=>{Do({left:Me?.left,top:0})},[Me?.left]),M.useEffect(()=>{$r({left:0,top:Me?.top})},[Me?.top]),It(t?.getView(),{onFreezeSplitChange:()=>{et(Ye(t.getView().getFreezePanes()))},onTopLeftChange:()=>{qe(t.getView().getTopLeft())},onMovableSelectionChange:()=>{jt(t.getView().getMovableSelection().length>0)}}),It(t?.getSelection(),{onChange:()=>{pt(t.getSelection().isEntire())}}),It(t,{onViewChange(){we(t.getView()),Ee(ye())},onLayoutChange:()=>{const Te=t.getEntireRange();Fe({height:Te.getRowCount(),width:Te.getColumnCount()}),Ee(ye())},onStyleChange:()=>{uo()},onMovablesChange:()=>{},onInvalidated:()=>{uo()}}),It(t,{onRequestScrollIntoView:async(Te,Je)=>{if(!Je)return;const ot={colIndex:Je?.coords?.colStart,rowIndex:Je?.coords?.rowStart};return await Z.current?.scrollCellCoordsIntoView(ot,Je?.scroll),!0},onRequestFocus:()=>P.whenFocus(ur.current)},DE);const En=M.useRef(!1),Qi=M.useMemo(()=>{const Te=P.debounce(rt=>{requestAnimationFrame(()=>{bn.current&&W?.(rt)})},32),Je=(rt,mt)=>{bn.current=!0,on([at=>{if(!at.toClipBounds(at.getRangeCoordsBounds({rowStart:0,rowEnd:z.height,colStart:rt,colEnd:rt})))return;const Dt=at.getLayout(),Ft=Math.max(0,Dt.getColOffset(rt)),kt=at.getBounds(),Mn=Math.min(kt.x+kt.width,Dt.getColOffset(rt+1)),dr=at.getAnchor();if(mt!==null&&(dr===Et.Left||dr===Et.Center||dr===Et.Right)){const Cc=P.roundAccurately(mt*P.getDPI(),0),rl=P.roundAccurately(t?.getColumnWidthAsFontUnit(mt/ge),2).toFixed(2),vc="Width: "+(mt?rl+" ("+Cc+" pixels)":"Hidden"),Ls=fc.current.getGridElement().getRelativePointFromClient(0,0),Ho=0-Ls.y,ol=0-Ls.y+H,xc=Ls.x-kt.x;Te({anchor:{x:Ft-xc,y:Ho,width:Mn-Ft,height:ol-Ho},display:vc})}const go=[0,0,0,kt.height],wc={style:{boxShadow:`0.5px 0px 0px 0px ${n?.body?.fill}`},propsPath:{stroke:ve}},_c={x:Ft-1,y:0,width:1,height:kt.height},yc={style:{boxShadow:`-0.5px 0px 0px 0px ${n?.body?.fill}`},propsPath:{stroke:ve}},bc={x:Mn-1,y:0,width:1,height:kt.height};return pe.jsxs(it.Fragment,{children:[pe.jsx(sl,{linePoints:go,bounds:_c,...wc}),pe.jsx(sl,{linePoints:go,bounds:bc,...yc})]},"resize-dividers")}])};let ot=null;return{onResizeHeadersStart:(rt,mt,at)=>{ot=t.beginCommit(at),En.current=!1,Je(rt,mt)},onResizeHeaders:(rt,mt,at)=>{En.current=!1,Je(rt,mt)},onResizeHeadersDown:(rt,mt)=>{En.current=!0,setTimeout(()=>{En.current&&Je(rt,mt)},360)},onResizeHeadersEnd:(rt,mt,at)=>{ot?.commit({description:at}),ot=null,En.current=!1,requestAnimationFrame(()=>J?.()),bn.current=!1,on(null)},onResizeHeadersUp:rt=>{En.current=!1,requestAnimationFrame(()=>J?.()),bn.current=!1,on(null)},...l}},[t,l,H,$n]),Bo=M.useMemo(()=>{const Te=P.debounce(rt=>{requestAnimationFrame(()=>{bn.current&&$?.(rt)})},32),Je=(rt,mt)=>{bn.current=!0,on([at=>{if(!at.toClipBounds(at.getRangeCoordsBounds({rowStart:rt,rowEnd:rt,colStart:0,colEnd:z.width})))return;const Dt=at.getLayout(),Ft=Math.max(0,Dt.getRowOffset(rt)),kt=at.getBounds(),Mn=Math.min(kt.y+kt.height,Dt.getRowOffset(rt+1)),dr=at.getAnchor();if(mt!==null&&(dr===Et.Top||dr===Et.Center||dr===Et.Bottom)){const Cc=Math.floor(10*P.getDPI())/10,rl=P.roundAccurately(mt*Cc,0),vc=P.roundAccurately(rl/ge/(t?.getRowHeaders().getScaleFactor()*P.getDPI()),2).toFixed(2),Ls="Height: "+(mt?vc+" ("+rl+" pixels)":"Hidden"),Ho=Po.current.getGridElement().getRelativePointFromClient(0,0),ol=0-Ho.x,xc=0-Ho.x+Ge,jw=Ho.y-kt.y;Te({anchor:{x:ol,y:Ft-jw,width:xc-ol,height:Mn-Ft},display:Ls})}const go=[0,0,kt.width,0],wc={style:{boxShadow:`0px 0.5px 0px 0px ${n?.body?.fill}`},propsPath:{stroke:ve}},_c={x:0,y:Ft-1,width:kt.width,height:1},yc={style:{boxShadow:`0px -0.5px 0px 0px ${n?.body?.fill}`},propsPath:{stroke:ve}},bc={x:0,y:Mn-1,width:kt.width,height:1};return pe.jsxs(it.Fragment,{children:[pe.jsx(sl,{linePoints:go,bounds:_c,...wc}),pe.jsx(sl,{linePoints:go,bounds:bc,...yc})]},"resize-dividers")}])};let ot=null;return{onResizeHeadersStart:(rt,mt,at)=>{ot=t.beginCommit(at),En.current=!1,Je(rt,mt)},onResizeHeaders:(rt,mt,at)=>{En.current=!1,Je(rt,mt)},onResizeHeadersDown:(rt,mt)=>{En.current=!0,setTimeout(()=>{En.current&&Je(rt,mt)},360)},onResizeHeadersEnd:(rt,mt,at)=>{ot?.commit({description:at}),ot=null,En.current=!1,requestAnimationFrame(()=>J?.()),bn.current=!1,on(null)},onResizeHeadersUp:rt=>{En.current=!1,requestAnimationFrame(()=>J?.()),bn.current=!1,on(null)},...c}},[t,c,Ge]),ur=Yn(e,()=>{const Te=ot=>{t?.getView()&&t.getView().selectMovables([]),se.current=null,Z?.current?.focus(ot)},Je=async(ot=null)=>{if(ot||(ot=t?.getView().getMovableSelection()[0]),!ot)return!1;const rt=ot.getAnchorCoords();if(!rt)return!1;const mt=Z.current?.getViewFromCellCoords({colIndex:rt.colStart,rowIndex:rt.rowStart});if(!mt)return!1;const at=mt.getAnchor();t?.getView().getMovableSelection().indexOf(ot)===-1&&t?.getView().selectMovables([ot]);let Dt=j.current?.get(at);return Dt?.current?(await Dt.current.focusMovable(ot),!0):(se.current={movable:ot,anchor:at},!0)};return{getGridElement:()=>Z.current,getRowHeaderElement:()=>Po.current,getColumnHeaderElement:()=>fc.current,rowHeaderHeight:()=>H,colHeaderWidth:()=>Ge,startEdit:Ue,submitEdit:()=>{We.setMode(ot=>ot?.key!=="edit"?ot:{key:"edit",args:{stateAndCoords:null,submit:!0}})},cancelEdit:()=>{We.setMode(ot=>ot?.key!=="edit"?ot:{key:"edit",args:{stateAndCoords:null,cancel:!0}})},isEditing:X!==null,focus:ot=>{t?.getView().getMovableSelection().length>0&&Je()||Te(ot)},focusSheet:Te,focusMovable:Je,contains:ot=>Z?.current?.contains?.(ot),invalidate:uo,isSheetElement:()=>!0,getSheet:()=>t}},[t]),uo=M.useCallback(Te=>{te.current||(Z?.current?.invalidate(Te),N?.())},[]);M.useEffect(()=>{uo()},[G]);const Ns=wt?oe.edgeStrokeFill:U.fill,dc=wt?ue.fill:typeof G.headerHover=="function"?G.headerHover(U)?.fill:U.fill,At=M.useMemo(()=>S?pe.jsx("div",{className:rn("sheetxl-viewport-overlay",Xx),style:{width:"100%",height:"100%",boxSizing:"border-box",position:"absolute"},children:S}):pe.jsx(pe.Fragment,{}),[S]);let Os=null;he&&fe&&(Os=pe.jsxs("div",{tabIndex:-1,className:"top-left-corner",style:{padding:"2 2",position:"absolute",height:`${H}px`,width:`${Ge}px`,zIndex:1,boxSizing:"border-box",cursor:"cell"},onMouseDown:Te=>{let Je=!Te.ctrlKey;Ze?.getCommand("selectAll")?.execute(!Je||Te.button!==0),Te.nativeEvent.which===Mp.Right?o?.({originalEvent:Te,clientX:Te.clientX,clientY:Te.clientY,rowIndex:-1,colIndex:-1}):Z.current?.focus()},children:[pe.jsx("div",{style:{height:H-5+"px",width:H-5+"px",clipPath:`path('M${H-5} 0 L0 ${H-5} L${H-5} ${H-5} L${H-5} 0 Z')`,borderRight:`2px solid ${Ns}`,borderBottom:`2px solid ${Ns}`,background:`${dc}`,boxSizing:"border-box",position:"absolute",right:"2px",bottom:"2px"}}),pe.jsx("div",{style:{position:"absolute",height:`${H}px`,width:`${Ge}px`,boxSizing:"border-box",borderRight:`solid 1px ${U.strokeFill}`,borderBottom:`solid 1px ${U.strokeFill}`,right:"-1px",bottom:"-1px"}})]}));const zo=ke(({_left:Te,_top:Je})=>{},[]),Yi=ke(Te=>{if(!o)return;const Je=Z.current.getViewFromClient(Te.clientX,Te.clientY)?.getCellCoordsFromClient(Te.clientX,Te.clientY);Je&&(o({originalEvent:Te,clientX:Te.clientX,clientY:Te.clientY,rowIndex:Je.rowIndex,colIndex:Je.colIndex}),Te.stopPropagation(),Te.preventDefault())},[o]),sn=ke(Te=>{if(!(!Te.shiftKey&&(Te.ctrlKey||Te.metaKey)))return;const{deltaY:Je}=Te;return Je>0?Ze.getCommand("sheetZoomOut")?.execute():Je<0&&Ze.getCommand("sheetZoomIn")?.execute(),Je===0},[Ze]);M.useEffect(()=>{uc(null),Fs.current=null,bn.current=!1,on(null);const Te=t?.getView().getTopLeft();zo(Te),Z.current?.scrollTo(Te),qe(Te),we(t.getView()),et(Ye(t.getView().getFreezePanes())),Ee(ye()),N()},[t?.getView()]);const Rn=M.useCallback((Te,Je)=>t.getRowHeaders().hiddenHeadersAt(Te,Je),[t]),el=M.useCallback((Te,Je)=>t.getColumnHeaders().hiddenHeadersAt(Te,Je),[t]),Ds=ke(Te=>{const Je=Te.getVisibleRangeCoords();if(!Je)return null;const ot=[];return t.getRange(Je).forEach((rt,mt)=>{const at=mt.getCoords(),Dt=mt.getCell();(Ft=>{if(Ft.isEmpty())return!1;const kt=Ft.getSpans();if(kt.width>1||kt.height>1||Ft.getStyle().hasVisibleStyling()||Y.isShowFormulas()&&Ft.getFormula()!==null)return!0;const Mn=Ft.getValue();return Mn!==null&&!(!Y.isShowZeros()&&Mn===0&&Ft.getType()===Le.Number)})(Dt)&&ot.push({coords:at,value:Dt,range:Y.isShowFormulas()?null:Dt.getExtrusions()})},{ignoreHidden:!0,includeMergeOverflow:!0}),ot},[t,Y.isShowZeros(),Y.isShowFormulas(),X]);M.useEffect(()=>{const Te=[];m&&Te.push(...m),$n&&Te.push(...$n),P.isEqualArrays(Te,Fs.current)||(Fs.current=Te,uc(Te))},[m,$n,G]);const ho=M.useMemo(()=>({style:{boxShadow:`0.5px 0.5px 0px 0px ${n?.body?.fill}`},propsPath:{stroke:n?.body?.text?.fill??"black"}}),[G?.header?.edgeStrokeFill]),hc=ke(Te=>{Te.isDefaultPrevented()||Te.isPropagationStopped()||(se.current=null,t?.getView().getMovableSelection().length>0&&t.getView().selectMovables([]))},[t]),gc=M.useMemo(()=>{const Te=We.getMode();return Te?.key==="cut"||Te?.key==="copy"},[We]),tl=ke(async Te=>{const Je=We.getMode();return Te.keyCode===In.Escape&&Je?(Te.preventDefault(),void We.setMode(null)):Te.keyCode===In.Enter&&gc?(Te.preventDefault(),await Ze?.getCommand("paste")?.execute(),void We.setMode(null)):void Ze?.dispatchToFocusedCommand(Te)},[Ze,We]),Po=M.useRef(null),nl=M.useMemo(()=>pe.jsx("div",{tabIndex:-1,style:{position:"relative",flex:"0",top:`${H+1}px`,width:`${Ge+U.edgeStrokeWidth}px`,minWidth:`${Ge+U.edgeStrokeWidth}px`,borderRight:`solid ${U.edgeStrokeWidth}px ${U.edgeStrokeFill}`,height:`calc(100% - ${H}px)`,boxSizing:"border-box",zIndex:"2"},children:pe.jsx(tp,{ref:Po,sheetElement:ur.current,gridRef:Z,freezeStart:Ve?.[Et.Top],oppositeSize:Ge,containerWidth:Ge,containerHeight:Se,sheetHeader:t.getRowHeaders(),gridStyle:ee,verticalPadding:Math.max(0,Math.floor(t.getStyles().getNormal().getFont().getSize()/10)),scrollPoint:Lo,onSheetContextMenu:o,tabIndex:-1,style:{position:"relative",flex:"0",top:`${H+1}px`,width:`${Ge+U.edgeStrokeWidth}px`,minWidth:`${Ge+U.edgeStrokeWidth}px`,borderRight:`solid ${U.edgeStrokeWidth}px ${U.edgeStrokeFill}`,height:`calc(100% - ${H}px)`,boxSizing:"border-box",zIndex:"2",...Bo?.style},...Bo})}),[Ge,H,Se,t,Lo,Ve?.[Et.Top],G,Ie,o,U.fill,c]),fc=M.useRef(null),Bw=M.useMemo(()=>pe.jsx("div",{tabIndex:-1,style:{position:"relative",left:"0px",width:"100%",height:`${H+U.edgeStrokeWidth}px`,minHeight:`${H+U.edgeStrokeWidth}px`,borderBottom:`solid ${U.edgeStrokeWidth}px ${U.edgeStrokeFill}`,boxSizing:"border-box",zIndex:"1"},children:pe.jsx(tp,{ref:fc,sheetElement:ur.current,gridRef:Z,freezeStart:Ve?.[Et.Left],oppositeSize:H,containerWidth:ie,containerHeight:H,sheetHeader:t.getColumnHeaders(),gridStyle:ee,scrollPoint:Zi,onSheetContextMenu:o,...Qi,style:{...Qi?.style,position:"relative",left:"0px",width:"100%",height:`${H+U.edgeStrokeWidth}px`,minHeight:`${H+U.edgeStrokeWidth}px`,borderBottom:`solid ${U.edgeStrokeWidth}px ${U.edgeStrokeFill}`,boxSizing:"border-box",zIndex:"1"}})}),[H,ie,t,Zi,Ve?.[Et.Left],G,U.fill,Ie,o,l]),zw=ke(Te=>{const{value:Je,key:ot,...rt}=Te;let mt=Je,at=X;if(!at||at.colIndex===Te.coords.colIndex&&at.rowIndex===Te.coords.rowIndex||(at=null),!mt){const kt=Te.range;if(mt=t.getRange({rowIndex:kt.rowStart,colIndex:kt.colStart}).getCell(),mt.isEmpty())return null}let Dt=null;mt.getHyperlink()&&(Dt=async kt=>{if(A?.onLinkMouseDown?.(kt),kt.button===0&&!kt.isDefaultPrevented()){kt.stopPropagation(),kt.preventDefault();try{await mt.getHyperlink()?.open()}catch(Mn){vt.showError?.(Mn)}}}),at&&at.colIndex===Te.range.colStart&&at.rowIndex===Te.range.rowStart&&(mt=mt.createTemporaryCell({value:null}));const Ft=t.getStyles();return M.createElement(Lx,{...rt,key:ot,bodyStyle:ne,docTheme:Ft.getTheme(),normalStyle:Ft.getNormal(),showFormulas:Y.isShowFormulas(),showZeros:Y.isShowZeros(),onLinkMouseDown:Dt,...A,value:mt})},[t,xe,ne,X,Y?.isShowFormulas(),Y.isShowZeros()]),Pw=M.useCallback(Te=>{const{key:Je,ref:ot,...rt}=Te;return[pe.jsx(iE,{ref:ot,getVisibleCells:Ds,sheet:t,gridStyle:G,...rt},`border-${Je}`),pe.jsx(FE,{ref:ot,sheet:t,commands:Ze,...rt},`table-${Je}`),pe.jsx(NE,{ref:ot,sheet:t,...rt},`spill-${Je}`),pe.jsx(CE,{ref:ot,sheet:t,commands:Ze,onShowTooltip:L,onCloseTooltip:J,gridStyle:G,gridRef:Z,isActive:Ie,...rt},`selection-${Je}`),pe.jsx(mE,{ref:ot,sheet:t,commands:Ze,gridStyle:G,element:ze,...rt},`copy-paste-${Je}`),pe.jsx(AE,{ref:ot,sheet:t,commands:Ze,target:Xe,renderMovable:p,propsMovable:{onUnFocus:()=>{ur.current.focus()}},...rt},`movable-${Je}`),pe.jsx(ME,{ref:ot,sheet:t,commands:Ze,gridStyle:G,getCellEditor:b,showProtectedError:qt,setEditingCoords:ae,...rt},`editor-${Je}`)]},[t,Z.current,G,b,Ze,vt]),[xh,Hw]=M.useState(!1),$w=M.useMemo(()=>{if(ie===0||Se===0)return null;const Te=t.getStyles().getNormal(),Je=Te.getFont(),ot=Te.getFill(),rt=Te.getBorder(),mt=Te.getFill().getType()===He.Type.None;let at=be,Dt=be;const Ft=(Mn,dr,go)=>go?{stroke:rt.getBottom().isNone()?"none":Mn.getColor().toRGBA(ne.darkMode).toString(),...dr}:dr;Dt=Ft(rt.getBottom(),Dt,!rt.getBottom().isNone()),Dt=Ft(rt.getTop(),Dt,!rt.getTop().isNone()),at=Ft(rt.getRight(),at,!rt.getRight().isNone()),at=Ft(rt.getLeft(),at,!rt.getLeft().isNone());let kt=Y?.getGridLineColor()?.toRGBA(ne.darkMode).toString()??ne.strokeFill;return mt||(Dt=Ft(rt.getBottom(),Dt,!0),Dt=Ft(rt.getTop(),Dt,!0),at=Ft(rt.getRight(),at,!0),at=Ft(rt.getLeft(),at,!0)),pe.jsx(Fp,{className:"sheetxl-sheet-primary",style:{...OE,...ot.toCSS(ne.darkMode),...Je.toCSS(ne.darkMode,ge),"--sxl-app-color-background":ne.fill,"--sxl-app-color-shadow":G.colorShadow,"--sxl-app-color-grey":G.colorGrey,"--sxl-app-color-button-fill":re.fill,"--sxl-app-color-button-text":re.text?.fill,"--sxl-app-color-button-border":re.edgeStrokeFill,"--sxl-app-color-primary-dark":G.selection.strokeFill},ref:Z,zoom:ge,...I,onFirstRender:Mn=>{Hw(!0),I?.onFirstRender?.(Mn),Ze?.activate()},showGridLines:de,gridLineColor:kt,propsGridLineColumns:at,propsGridLineRows:Dt,freezeLeft:Ve?.[Et.Left],propsFreezeLeft:ho,freezeTop:Ve?.[Et.Top],propsFreezeTop:ho,width:ie,height:Se,columnCount:z.width,rowCount:z.height,cursor:Fn??lt??"cell",clipCells:!0,layout:xe,renderCell:zw,renderOverlay:Pw,getCellCoordsAsRangeCoords:nt,hiddenRowsAt:Rn,hiddenColumnsAt:el,getVisibleCells:Ds,onWheelScroll:sn,onPointerDown:hc,onKeyDown:tl,onViewportChange:me,onImmediateScroll:zo,scrollPoint:Me,propsStage:{onFocus:()=>{Ze?.activate()}},renderOverlays:Vn})},[O]);M.useEffect(()=>{te.current||N()},[xe,Ve,ge,Ze,Me?.left,Me?.top,ne,I,ie,Se,Fn,Vn,Ie,lt]);let mc={flex:"1 1 100%",display:"flex",alignContent:"stretch",position:"relative"};u||(mc={...mc,...y});const Vw=M.useMemo(()=>{const Te=t.getStyles().getTheme(),Je=Te.getColorScheme(),ot=Te.getFontScheme();return{"--sxl-doc-color-dk1":Je.getDk1().toCSS(ne.darkMode),"--sxl-doc-color-dk2":Je.getDk2().toCSS(ne.darkMode),"--sxl-doc-color-lt1":Je.getLt1().toCSS(ne.darkMode),"--sxl-doc-color-lt2":Je.getLt2().toCSS(ne.darkMode),"--sxl-doc-color-accent1":Je.getAccent1().toCSS(ne.darkMode),"--sxl-doc-color-accent2":Je.getAccent2().toCSS(ne.darkMode),"--sxl-doc-color-accent3":Je.getAccent3().toCSS(ne.darkMode),"--sxl-doc-color-accent4":Je.getAccent4().toCSS(ne.darkMode),"--sxl-doc-color-accent5":Je.getAccent5().toCSS(ne.darkMode),"--sxl-doc-color-accent6":Je.getAccent6().toCSS(ne.darkMode),"--sxl-doc-color-hlink":Je.getHlink().toCSS(ne.darkMode),"--sxl-doc-color-fol-hlink":Je.getFolHlink().toCSS(ne.darkMode),"--sxl-doc-font-major":ot.getMajorFont(),"--sxl-doc-font-minor":ot.getMinorFont()}},[t.getStyles().getTheme()]),Eh=ke(Te=>{const{style:Je,...ot}=Te;return pe.jsx(iw,{...ot,style:{paddingLeft:"4px",paddingRight:"4px",...Je},sheet:t})},[t]);let pc=pe.jsx("div",{style:mc,onTouchStart:()=>{Rh()},onFocus:Te=>{le(!0),C?.(Te)},onBlur:Te=>{le(!1),_?.(Te)},ref:ur,...T,children:pe.jsx("div",{className:rn("sheetxl-sheet",Kx),style:{position:"absolute",width:"100%",height:"100%",boxSizing:"border-box",display:"flex",flexDirection:"column",flex:"1 1 100%",zIndex:"0",...Vw},children:pe.jsxs("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 100%"},children:[Os,nl,pe.jsxs("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 100%",overflow:"hidden",position:"relative"},children:[Bw,pe.jsxs("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 100%",position:"relative",borderRight:`solid ${U.edgeStrokeWidth}px ${U.edgeStrokeFill}`,backgroundColor:ne.fill},ref:D,onContextMenu:Yi,children:[$w,At,pe.jsx(Qx,{style:{position:"absolute",right:24,bottom:4},colorLicensee:G?.selection?.strokeFill,colorCredits:G?.body?.text?.fill})]})]})]})})});u&&(pc=pe.jsx(Jw,{style:{flex:"1 1 100%",overflow:"hidden",background:`${U.fill}`,minHeight:2*De.height,minWidth:2*De.width,...y},viewport:_e,touchElement:Z.current?.stage,disableTouch:Ot,onScrollViewport:Te=>{Z.current?.scrollTo(Te)},renderScrollbarHorizontal:Eh,renderScrollbarVertical:Eh,...d,children:pc})),M.useEffect(()=>{te.current=!1,N?.(),K&&ur.current?.focus()},[t]);const[Sc,Ww]=M.useState(!1),Rh=ke(()=>{Sc||Ww(!0)},[Sc]);return M.useEffect(()=>{if(xh)return typeof w=="function"&&w(),St.detectIt().primaryInput==="touch"&&Rh(),()=>{}},[w,xh,Sc]),pc}));LE.displayName="SheetElement";const ip="data:image/webp;base64,UklGRhIPAABXRUJQVlA4TAYPAAAv/8F/EM8HIZJtWU0fdlTh3wRCIMlkE+EqkiTFyt57/KQ8/zKeEf5iaseNJClS1DGDxWcwvhfuCo5tW88SHw8Xh5ypbC3tnf8QHEfOB/D97w4PuFHBIx6MHJ74zvj/0aLdlH9AYWEjHiwOJR5M7Q+FAigmTRQOJRqczrVUKABQSMYgoAFFAhIwBkgaYEkBSABowDGgcYakUZirArQhRMUIIHGLBIAEEoDRfyokIAEAMhrSRmEOSPyS/jvR+BYFIWkUhLQhCpLGGQ2rhPiCOKPxDIVQmAZQDMYIjCTfNQXVJv8pnQqhuAonnczGDPv0VwFw/w+uGiAwQYjJXxffaJzROKPHoArGAPA+6o9AtiIj4XgAWGKCwAQBVNMSHQNEjTMqOSWPQEFRHOVl4vp/nnhI/DBNK8CGXCpeFvONip/jvPn67qb957v+Nssyv96/Jwg/xzT9yORhfR4fb6vF9ef39Nt62g55v37/7dRzfx9xFLRtIyX8ae+/AxARE8APxbCQtkidoqVGDBDxR3r8/59vo88vnW07v9nrY+l0tn0zemuSnn03W83Otn2zcarbfIrZqnG7Ykr77/nS5PP+/E6/iP7DgiRJiZX13F2QhYM/OrBtm7at/ZB927Zt27ZtPr/oK7Jt27b9x7dtGxcv1sFcc/R1woj+S2IkSZGkaXMpD2sZhqf3R5Y/23+2/2z/2f6z/Wf7z/af7T/bf7b/bP/97S8/r8tpn2+Rafa98ufeMc3nfK8v3V9QZHWVtFs5f/i2z8bd7+E/nX/Vuk9+uO6dF3IuWEy12r0S9eGUdA5q0RtuvnxxXpUFVPf5eQlfe7jG8j58Q6+uZZZNRGmv+GgOidbMMHMMy/WbJu7az/wcUqUk9C01LJNj5tZsDsnuizfPWh/F3WdN4FDO/eiYow4LozJuhpfDoPtcywyr8pAYDpv2RlmOB1TF7fBymPXAqA4Wwskrp3JY9oVZZA2efmm8m8O2Xa796tcoMprDvA2DAprXfkYWC9C0eflat2xrBgtRrKuDwgXemsKS5I6vr2zVzq9ZnLbUUzSHL5lFast+JTPi1rJUZWzN1bBuSSxZ7pvqaFfeVpYub2QtzaqI3McCtsppqPXPTWc0C9kjB3TqyFcsZ54b8/XpXJSHRW23qU1LJrC4PdFRlWsMzWCJ815ZpUYDU1no7mqiQ7VvYbnz9zIUaOkqFr3tZ7XnfKSHhe/+ON3pNJblL8N1QXEG+xlCXzXXmvKZjKJYn9IWKV7POMqIqlaYVtEMpU0l6lq46Eo3g2lvO2WtRPoB48m/SFXjwt3JiMqYp6eJkHWTGVQ3BZSky30Mq0/KVMTnZ2BN6aggV2UwtPa0UI+rGV1pylkm1RjB+IpZqpoxRG5ghGW/oZjr9xlj+xarZSiBBEaZe5BSxhK4jXHmeVElj/2Bkeb2KeQVzWKs7eumDnMZbemtlGEU4236UVUYyojb3UATK5Yx5lY30sOqRVlBn3YPdqKCgrexZ7SwcknQP13bfjWC6nD1XEcreHs8QgXOTg369bDmlxFQNU28mRpwYUMNXDcTQVXC2woYTOo2DrJxk1+ZQ9/9PIeNprjRs72ij4H2wbdZjdzdTDYizUXG9P3gnfZGDVy3gFMxD5ZBN9U7BWoJpoK2OpBvHvbYArWBUlFDgXu8QG2BVJanG2xLxC/UckNZZ6Om5VZmnd1NQfvtrRJzByPGXHr8ohqyn/eOr0MIZXAJZFvF1zGAUvC0AuzT+LpgXxJ7K/BuK/jA8LpiXhpPwZ3dcFN4XbIukUVgnVR01Y4WhVi19KLTC6Ca/vD4uevReM40PgHVY9GFMC2bHkAtG10Qy9K5rzHOLQkcGVwYwxJ6H+fspuAC2ZVSG5Rbjg0ulFk5Ta2FcUHTvcqtGrCo7aqZFo2EaK3oOXi0mpOO+xoinOB8cGgF2JTYrQC9EFoRJqV2Gp6Z3oisEItymxKBbniR+yIrxqDsBoCzUGQFpS+93fnYNiO4Z6FVwxc1WjXpotdCc0HoXHRMPucfY0qQTXJ6L+jqGCY0EzekcaOm+LY/g4PSCGCuirwgDtJ4dePy/uCvg2tJ8wNkhDzmObBsJDkhj7OagtL3rrwAhX84mnWiv8Yz+M/IXgyZHTFNc3jZ7dLYfSNo5uA2EpLzJT/c8b1liOY47CtHKOEfj+xcyRJ2vCqAx0MyRR2zE88uwr4hV9RxkoHGeIDv93Cf8aVotiT/uiTb0X+uKfFgnCw5Y473FWJxu7whx/wull0JkMwhx5MMJJ6UPeKYjyCZ43iw/BHHTwOxtAQAOPafwGEExem+vKd794bhxzckhNFvDgGbYbhCgoAbe46jcKsw0MbcH4Qv3hAH2vgOHIsbg4CNPScxuFcoWGPuhWFX8WnO/gt7hufPIVhSEstIOjN7ChF4WDhIY34RwcqGb4uHWfjnPZwmAQGN73PI7xkh4Yy5nvzuFhPOeKj4OkhQsqeJF9qz0DXAWB45sBFU7K6QXoKENTLOzPyC9PYIDGR8sfBOscikTwfzHp3MJlOPcujyB2TnYjiEMbeUfn0jOoRxP9GVeRgPYPyk6FqH3AaAUh5ZkOL4hpC/XLOim8/yXQ3yxXxWck9o4gb3h85/inFrhLfLQf3iIZIPNfmWLFQvniG4DyUPtYvHij7V0UXl4uxqua0vG3WLOUduNxjdELBn98vm8Jroy5z5jCSzJpY9m/CWnF43NYtvlHu8CclKxeJPxDabzNQrfkBsZ8pNteLMCKmdIDu1irmj1LaRn1rFraT2oAxVKh4oNcuHj7aRx9FNhof3pPaq5Djyzsi2RD3sDXmCSAejD/wqmeIM3y7JzS1b9YkfkfpAIchXdeI1Yu9ZqrHaxNOFdqGcVSbmgMyW974v2DmPb3A+lMhsbcl6rMrMXCCz9WSuKnFDmW0gdzWJc2S2suxVJO4s9YiT/uoRt5TZ1gJQjbitzMaJQC3iFVJfqhAElYiX6M3VCQ7FijMOokpYIfSTMFQLbYV+QQhlobUXtDJB9dBZ6OnOAFVEjtDznfyribpCz3e2ryoKLP9yJ4Uyu9x+rsmYUS2zS7yrjDSpjwuidbXxtdCmda46NghtGuPq4yOphx071LYKeZ+E7hXXamTk37XjTjzo+gqq0ThI7L2Nq9X7Z7Gexp1aq1ofnovVNO7cmfX67FyspXEnP/P74qxa1uho3Omrm6ZePpF73PkPzL41q5gbSOzu8PrOvGbek9uoXvF2Z1bKbQOvd8yajU3kdpHRx+W6yY4QfGfjfT4tV87dJLfBD1y+Kqudm0jwjjX5orx6+ol+ISM9viernxV/5+53wqw94f3OSCHJ/XII3Z/23S+tgPeHH5DovQgYoAWye5ovQkdldwpehNIDspuOLkSPkfDdCXaXo+7Pdj8G87pGemPRgnRI/Eua2/Pd78zMMvH3OhxtZhw/I/G7AytM78lvS6o4lQI4YuRQcbofwH5n//w6UqDeJwDtSBSpNyEcXSigSHkgHIqUqXq6x53xGUFoV56ZdHwZg41hYuU5jsF0b6AE6zEC0fEk0RqAwpIg0XKXwDiC6G9ghGsLwWgXolUZFzVxWAxjph3TgRyLsuFHIATsfQLS1gQRWw7laOMARGyyQUi61z5k/QiKRd1Dtq8Qi79e847ZDst/3Al+ROO7N6xn5HGtQWh62DdqiwiOWWyjtipAeLrXNGzvQjq40J5hu/ccIoPvOcbtUlBnFMF8VdZFswowGX6U4Yl+2KOLQHWiW+D2NUPl5/29Ijcb2NEGtYqc/ySw0wlzV2+038muI2AtFXWS2zCsewq3gsl+ZytEZnC/Xmi/011M0FpQYSPW/QRcwWC/80WfA3fcCXdOr2+ElFz+/U74CoFrnkPjFCy97I2tInRdo9T6RkgGku93yrYEz68HZdY3QrKQungC2DoKVCQTifM3g3g6yfboZfY76zCC2CeKHAvMNmPW/U47vogw9kKo4KzkLGMFzONOfFSo0Myk3O3A3xLMLlKowOxk3O/MtQlnj8QKy1C+/U69koCa6/BYQVnK1kcEtUV6kP1OvqsRVkOuV+wYMpuOqfY7ew8C26/7B+s6Y4maQXC7VMG6zFqaHigmvK0aravMZfm5E7SFfMJhdo/WRfZy/NwZ5hHk5vkgWscByNAj1YS5CxStwxCUb3dTQt2T4ToKQvGfO0kbgu3f28J1EIbCP3eWKwl40x8Yrm0ginaLQcg79ZCgX7UJRcEmnSPsncBBv2oZjGLF5sA/70y3oj/vTIcVcIpRHw3+nS1mnLHIzH1JAdV+MPhXk4WkRC5SQU1Sg3711QgJSnwfRWjhFPPuQ33e2b4oIi30WgZDblUd0kPzIbsvhzTRMMCm1yNddClc3iPqOO+ULrD2HSJ15EiEyr2YFFJVPFCeHqSSAh/gvPsZtZx32ptQPkd3xZx24NkYX1EbIsVczQUotivppivhSW1J2undDHDzGhqQfno+HZmHCkhDtYzG5fZzpKOOTUblxmrSUic2gjrv9KSoym8GJH0l6SozC40J9UlbHUnB4vETpK9OPorkZURWkcY6H4VjEbPupLWe9WKwriHpreZfIniyqPOkuSLmuaU3rRtpr4N7hf9/4yfSX+d2Sj6tqZdBKsx5j9Tu6EBa7IRLZLt6OUiRHZoqr62NSJddiHTLKsVJ+uzAWElXLBheRhrN4ZwmpcdakFarNS9bxDnMToMUW9148cTMKyfldvpu0WTecJz0mxEn1x2e+DzScQ6fTAsmZ2xtTz+n5juS5bGlM+m66meSZPl7Y2dnUnjLtmaIsSpxVEdSerkuvwiTmOedIMV38uKUcHfXqwFSflVL4zPDeJxhV3uyBB2/cnx4+sK8QJahqm47Y8PNg9c0JItRedyM2PAxMWqZQVakyrgZMeFg7y8PsS7VeuO70P4bxP3ZRaUGWZ6OmVv9oSk63llBVqkLh4Zt9IaW1Tt6tjfIYhWRY86YGCKH/WWGmUOWraaHxzw1yV2DMxQ2zHq51Tmyfl2o99bI25Jig2vP54ljDp9ykLWsdj3fkO9vvWPKtL8wndo7YeztOy8bcKh5OVncyhq2XNrd96ZpLrjy5/qYb/l8S7q2r1NJlj/bf7b/bP/Z/rP9Z/vP9p/tP9t/tv9s//3djwA=",BE=M.memo(M.forwardRef((s,e)=>{const{children:t,disabled:n,style:r,picture:o,description:i,isDragging:l,view:a,onHide:c,onShow:u,onKeyDownCapture:d,onFocus:h,onBlur:f,loadingPanel:g,...m}=s,[p,S]=M.useState(!1),[w,b]=M.useState(null),[C,_]=M.useState(null),[y,v]=M.useState(null);M.useEffect(()=>{_(null),o.getDetails().then(R=>{S(!1),_(R.asUrl()),R.asSVGText?.()&&v(R.asSVGText())}).catch(R=>{console.warn(R),S(!0),_(ip),v(null)})},[o]);const x=Yn(e,()=>({isPictureEditor:()=>!0}),[]),E=M.useMemo(()=>{if(C||y)return pe.jsx("img",{style:{flex:"1",width:"100%",height:"100%",border:p?"var(--sxl-app-color-grey, grey) solid 1px":void 0,backgroundColor:p?"var(--sxl-app-color-background, white)":void 0,boxShadow:p?"0px 0px 3px var(--sxl-app-color-error, red)":void 0,objectFit:p?"contain":void 0,opacity:w?1:0,filter:"var(--sxl-app-filter-dark-invert)"},draggable:!1,src:C,onLoad:()=>{b(!0)},onError:({currentTarget:R})=>{console.log("error"),R.onerror=null,_(ip),S(!0)},alt:i??`${o.getType()}`})},[w,o,C,y,l]);if(!o.isClosed())return pe.jsxs("div",{className:"picture-editor",style:{position:"relative",display:"flex",flex:"1 1 100%",filter:l?"drop-shadow(1px 1px 1.5px var(--sxl-app-color-shadow, rgba(0, 0, 0, .25)))":void 0,...r,width:"100%",height:"100%"},tabIndex:0,...m,onKeyDownCapture:R=>{d?.(R)},ref:x,children:[w||p?void 0:g,E]})}));BE.displayName="PictureEditor";const F2=M.memo(M.forwardRef((s,e)=>{const{children:t,disabled:n,chart:r,view:o,isDragging:i,onHide:l,onShow:a,...c}=s;M.useEffect(()=>{},[r]);const u=Yn(e,()=>({isChartEditor:()=>!0}),[]),[d,{height:h,width:f}]=Es();if(!r.isClosed())return pe.jsx("div",{...c,ref:Oo([u,d]),children:pe.jsx("div",{className:"chart-editor",style:{width:"100%",height:"100%",backgroundColor:"var(--sxl-app-color-background, white)",backgroundImage:"var(--sxl-app-image-background)",alignItems:"center",justifyContent:"center",zoom:o.getZoom(),display:"flex",position:"relative",border:"var(--sxl-app-color-grey, grey) solid 1px",filter:n?"blur(1px)":void 0,boxShadow:i?"1px 1px 2px var(--sxl-app-color-shadow, rgba(0,0,0,.15))":void 0},children:pe.jsx("div",{style:{textAlign:"center"},children:r.getDescription()})})})})),zE="_editable-input_1bqx6_6",PE=s=>pe.jsx("input",{...s}),HE=M.memo(M.forwardRef((s,e)=>{const{style:t={},className:n,value:r="",onSubmit:o,onChange:i,onCancel:l,renderInput:a=PE,styleHover:c={},dragging:u,maxLength:d,disabled:h=!1,readOnly:f=!1,...g}=s,[m,p]=M.useState(!1),[S,w]=M.useState(!1),[b,C]=M.useState(r);M.useEffect(()=>{C(r)},[r]);const _=M.useRef(null),[y,v]=M.useState(null),x=Hi(),E=M.useCallback(function(D){const F=D.message;y!==F&&(x?.showMessage?.(F,{type:jd.Error}),v(F))},[x,y]),R=M.useCallback(D=>{let F=!1;try{F=o?.(D)??!0}catch(k){E(k)}return F?(_.current=null,w(!1),C(D),F):(setTimeout(()=>{_.current?.focus()},0),F)},[o]),I=ke(()=>{C(r),_.current=null,w(!1),l?.()},[l,r]),A=M.useMemo(()=>{if(!S)return null;const D={className:rn(zE),autoFocus:!0,spellCheck:!1,name:"editable-label",autoComplete:"off",maxLength:d,type:"text",value:b,onFocus:F=>{_.current||(_.current=F.target,setTimeout(()=>{F.target?.select()},0))},onBlur:F=>{_.current&&R(b)},onChange:F=>{S&&C(F.target.value)},onMouseDown:F=>F.stopPropagation(),onKeyDown:F=>F.code==="Escape"?(F.preventDefault(),void I()):F.code==="Enter"?(F.preventDefault(),void R(F.target.value)):void(F.code!=="Tab"?F.stopPropagation():R(F.target.value))};return pe.jsx(pe.Fragment,{children:a(D)})},[S,b,R,I,a,h]),[T,O]=M.useState();M.useLayoutEffect(()=>{let D=Object.assign({},t);(u||m)&&(D=Object.assign(D,c)),O(D)},[u,m,c,t]),M.useEffect(()=>{A&&i?.(b)},[A,i,b]);const N=Yn(e,()=>({startEdit(){h||f||w(!0)},cancel(){I()}}),[]);return pe.jsxs("div",{...g,ref:N,style:{flexDirection:"column",display:"flex",...T},className:rn(n),children:[pe.jsxs("div",{style:{position:"relative",boxSizing:"content-box",whiteSpace:"pre",userSelect:"none",display:"flex",justifyContent:"center"},onDoubleClick:()=>{h||f||w(!0)},onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:[pe.jsx("div",{className:"editable-label-container",style:{textAlign:"center",display:"flex",minHeight:"1em",opacity:S?0:1},children:b}),A]}),pe.jsx("div",{style:{whiteSpace:"pre",position:"relative",maxHeight:"0px",height:"0px",visibility:"hidden",marginLeft:"1px",marginRight:"1px",overflow:"hidden",...c},children:b})]})})),oc=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0;function Ts(s){const e=Object.prototype.toString.call(s);return e==="[object Window]"||e==="[object global]"}function mh(s){return"nodeType"in s}function An(s){var e,t;return s?Ts(s)?s:mh(s)&&(e=(t=s.ownerDocument)==null?void 0:t.defaultView)!=null?e:window:window}function ph(s){const{Document:e}=An(s);return s instanceof e}function Ji(s){return!Ts(s)&&s instanceof An(s).HTMLElement}function cw(s){return s instanceof An(s).SVGElement}function Is(s){return s?Ts(s)?s.document:mh(s)?ph(s)?s:Ji(s)||cw(s)?s.ownerDocument:document:document:document}const ir=oc?M.useLayoutEffect:M.useEffect;function sc(s){const e=M.useRef(s);return ir(()=>{e.current=s}),M.useCallback(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.current==null?void 0:e.current(...n)},[])}function Bi(s,e){e===void 0&&(e=[s]);const t=M.useRef(s);return ir(()=>{t.current!==s&&(t.current=s)},e),t}function Ii(s,e){const t=M.useRef();return M.useMemo(()=>{const n=s(t.current);return t.current=n,n},[...e])}function Pa(s){const e=sc(s),t=M.useRef(null),n=M.useCallback(r=>{r!==t.current&&e?.(r,t.current),t.current=r},[]);return[t,n]}function Ha(s){const e=M.useRef();return M.useEffect(()=>{e.current=s},[s]),e.current}let $u={};function Ki(s,e){return M.useMemo(()=>{if(e)return e;const t=$u[s]==null?0:$u[s]+1;return $u[s]=t,s+"-"+t},[s,e])}function uw(s){return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((o,i)=>{const l=Object.entries(i);for(const[a,c]of l){const u=o[a];u!=null&&(o[a]=u+s*c)}return o},{...e})}}const as=uw(1),zi=uw(-1);function ic(s){if(!s)return!1;const{KeyboardEvent:e}=An(s.target);return e&&s instanceof e}function $a(s){if((function(e){if(!e)return!1;const{TouchEvent:t}=An(e.target);return t&&e instanceof t})(s)){if(s.touches&&s.touches.length){const{clientX:e,clientY:t}=s.touches[0];return{x:e,y:t}}if(s.changedTouches&&s.changedTouches.length){const{clientX:e,clientY:t}=s.changedTouches[0];return{x:e,y:t}}}return(function(e){return"clientX"in e&&"clientY"in e})(s)?{x:s.clientX,y:s.clientY}:null}const Ao=Object.freeze({Translate:{toString(s){if(!s)return;const{x:e,y:t}=s;return"translate3d("+(e?Math.round(e):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(s){if(!s)return;const{scaleX:e,scaleY:t}=s;return"scaleX("+e+") scaleY("+t+")"}},Transform:{toString(s){if(s)return[Ao.Translate.toString(s),Ao.Scale.toString(s)].join(" ")}},Transition:{toString(s){let{property:e,duration:t,easing:n}=s;return e+" "+t+"ms "+n}}}),lp="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function $E(s){return s.matches(lp)?s:s.querySelector(lp)}const VE={display:"none"};function WE(s){let{id:e,value:t}=s;return it.createElement("div",{id:e,style:VE},t)}function jE(s){let{id:e,announcement:t,ariaLiveType:n="assertive"}=s;return it.createElement("div",{id:e,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":n,"aria-atomic":!0},t)}const dw=M.createContext(null),GE={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},UE={onDragStart(s){let{active:e}=s;return"Picked up draggable item "+e.id+"."},onDragOver(s){let{active:e,over:t}=s;return t?"Draggable item "+e.id+" was moved over droppable area "+t.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(s){let{active:e,over:t}=s;return t?"Draggable item "+e.id+" was dropped over droppable area "+t.id:"Draggable item "+e.id+" was dropped."},onDragCancel(s){let{active:e}=s;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function qE(s){let{announcements:e=UE,container:t,hiddenTextDescribedById:n,screenReaderInstructions:r=GE}=s;const{announce:o,announcement:i}=(function(){const[d,h]=M.useState("");return{announce:M.useCallback(f=>{f!=null&&h(f)},[]),announcement:d}})(),l=Ki("DndLiveRegion"),[a,c]=M.useState(!1);if(M.useEffect(()=>{c(!0)},[]),(function(d){const h=M.useContext(dw);M.useEffect(()=>{if(!h)throw new Error("useDndMonitor must be used within a children of <DndContext>");return h(d)},[d,h])})(M.useMemo(()=>({onDragStart(d){let{active:h}=d;o(e.onDragStart({active:h}))},onDragMove(d){let{active:h,over:f}=d;e.onDragMove&&o(e.onDragMove({active:h,over:f}))},onDragOver(d){let{active:h,over:f}=d;o(e.onDragOver({active:h,over:f}))},onDragEnd(d){let{active:h,over:f}=d;o(e.onDragEnd({active:h,over:f}))},onDragCancel(d){let{active:h,over:f}=d;o(e.onDragCancel({active:h,over:f}))}}),[o,e])),!a)return null;const u=it.createElement(it.Fragment,null,it.createElement(WE,{id:n,value:r.draggable}),it.createElement(jE,{id:l,announcement:i}));return t?os.createPortal(u,t):u}var ln;function Va(){}function Vu(s,e){return M.useMemo(()=>({sensor:s,options:e??{}}),[s,e])}(function(s){s.DragStart="dragStart",s.DragMove="dragMove",s.DragEnd="dragEnd",s.DragCancel="dragCancel",s.DragOver="dragOver",s.RegisterDroppable="registerDroppable",s.SetDroppableDisabled="setDroppableDisabled",s.UnregisterDroppable="unregisterDroppable"})(ln||(ln={}));const cr=Object.freeze({x:0,y:0});function hw(s,e){return Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2))}function JE(s,e){const t=$a(s);return t?(t.x-e.left)/e.width*100+"% "+(t.y-e.top)/e.height*100+"%":"0 0"}function gw(s,e){let{data:{value:t}}=s,{data:{value:n}}=e;return t-n}function KE(s,e){let{data:{value:t}}=s,{data:{value:n}}=e;return n-t}function ap(s){let{left:e,top:t,height:n,width:r}=s;return[{x:e,y:t},{x:e+r,y:t},{x:e,y:t+n},{x:e+r,y:t+n}]}function fw(s,e){if(!s||s.length===0)return null;const[t]=s;return t[e]}function cp(s,e,t){return e===void 0&&(e=s.left),t===void 0&&(t=s.top),{x:e+.5*s.width,y:t+.5*s.height}}const XE=s=>{let{collisionRect:e,droppableRects:t,droppableContainers:n}=s;const r=cp(e,e.left,e.top),o=[];for(const i of n){const{id:l}=i,a=t.get(l);if(a){const c=hw(cp(a),r);o.push({id:l,data:{droppableContainer:i,value:c}})}}return o.sort(gw)};function ZE(s,e){const t=Math.max(e.top,s.top),n=Math.max(e.left,s.left),r=Math.min(e.left+e.width,s.left+s.width),o=Math.min(e.top+e.height,s.top+s.height),i=r-n,l=o-t;if(n<r&&t<o){const a=e.width*e.height,c=s.width*s.height,u=i*l;return Number((u/(a+c-u)).toFixed(4))}return 0}const QE=s=>{let{collisionRect:e,droppableRects:t,droppableContainers:n}=s;const r=[];for(const o of n){const{id:i}=o,l=t.get(i);if(l){const a=ZE(l,e);a>0&&r.push({id:i,data:{droppableContainer:o,value:a}})}}return r.sort(KE)};function up(s,e){return s&&e?{x:s.left-e.left,y:s.top-e.top}:cr}function YE(s){return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((o,i)=>({...o,top:o.top+s*i.y,bottom:o.bottom+s*i.y,left:o.left+s*i.x,right:o.right+s*i.x}),{...e})}}const eR=YE(1);function mw(s){if(s.startsWith("matrix3d(")){const e=s.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}if(s.startsWith("matrix(")){const e=s.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}const tR={ignoreTransform:!1};function ks(s,e){e===void 0&&(e=tR);let t=s.getBoundingClientRect();if(e.ignoreTransform){const{transform:c,transformOrigin:u}=An(s).getComputedStyle(s);c&&(t=(function(d,h,f){const g=mw(h);if(!g)return d;const{scaleX:m,scaleY:p,x:S,y:w}=g,b=d.left-S-(1-m)*parseFloat(f),C=d.top-w-(1-p)*parseFloat(f.slice(f.indexOf(" ")+1)),_=m?d.width/m:d.width,y=p?d.height/p:d.height;return{width:_,height:y,top:C,right:b+_,bottom:C+y,left:b}})(t,c,u))}const{top:n,left:r,width:o,height:i,bottom:l,right:a}=t;return{top:n,left:r,width:o,height:i,bottom:l,right:a}}function dp(s){return ks(s,{ignoreTransform:!0})}function lc(s,e){const t=[];return s?(function n(r){if(e!=null&&t.length>=e||!r)return t;if(ph(r)&&r.scrollingElement!=null&&!t.includes(r.scrollingElement))return t.push(r.scrollingElement),t;if(!Ji(r)||cw(r)||t.includes(r))return t;const o=An(s).getComputedStyle(r);return r!==s&&(function(i,l){l===void 0&&(l=An(i).getComputedStyle(i));const a=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(c=>{const u=l[c];return typeof u=="string"&&a.test(u)})})(r,o)&&t.push(r),(function(i,l){return l===void 0&&(l=An(i).getComputedStyle(i)),l.position==="fixed"})(r,o)?t:n(r.parentNode)})(s):t}function pw(s){const[e]=lc(s,1);return e??null}function Wu(s){return oc&&s?Ts(s)?s:mh(s)?ph(s)||s===Is(s).scrollingElement?window:Ji(s)?s:null:null:null}function Sw(s){return Ts(s)?s.scrollX:s.scrollLeft}function ww(s){return Ts(s)?s.scrollY:s.scrollTop}function zd(s){return{x:Sw(s),y:ww(s)}}var hn;function _w(s){return!(!oc||!s)&&s===document.scrollingElement}function yw(s){const e={x:0,y:0},t=_w(s)?{height:window.innerHeight,width:window.innerWidth}:{height:s.clientHeight,width:s.clientWidth},n={x:s.scrollWidth-t.width,y:s.scrollHeight-t.height};return{isTop:s.scrollTop<=e.y,isLeft:s.scrollLeft<=e.x,isBottom:s.scrollTop>=n.y,isRight:s.scrollLeft>=n.x,maxScroll:n,minScroll:e}}(function(s){s[s.Forward=1]="Forward",s[s.Backward=-1]="Backward"})(hn||(hn={}));const nR={x:.2,y:.2};function rR(s,e,t,n,r){let{top:o,left:i,right:l,bottom:a}=t;n===void 0&&(n=10),r===void 0&&(r=nR);const{isTop:c,isBottom:u,isLeft:d,isRight:h}=yw(s),f={x:0,y:0},g={x:0,y:0},m=e.height*r.y,p=e.width*r.x;return!c&&o<=e.top+m?(f.y=hn.Backward,g.y=n*Math.abs((e.top+m-o)/m)):!u&&a>=e.bottom-m&&(f.y=hn.Forward,g.y=n*Math.abs((e.bottom-m-a)/m)),!h&&l>=e.right-p?(f.x=hn.Forward,g.x=n*Math.abs((e.right-p-l)/p)):!d&&i<=e.left+p&&(f.x=hn.Backward,g.x=n*Math.abs((e.left+p-i)/p)),{direction:f,speed:g}}function oR(s){if(s===document.scrollingElement){const{innerWidth:o,innerHeight:i}=window;return{top:0,left:0,right:o,bottom:i,width:o,height:i}}const{top:e,left:t,right:n,bottom:r}=s.getBoundingClientRect();return{top:e,left:t,right:n,bottom:r,width:s.clientWidth,height:s.clientHeight}}function bw(s){return s.reduce((e,t)=>as(e,zd(t)),cr)}function Cw(s,e){if(e===void 0&&(e=ks),!s)return;const{top:t,left:n,bottom:r,right:o}=e(s);pw(s)&&(r<=0||o<=0||t>=window.innerHeight||n>=window.innerWidth)&&s.scrollIntoView({block:"center",inline:"center"})}const sR=[["x",["left","right"],function(s){return s.reduce((e,t)=>e+Sw(t),0)}],["y",["top","bottom"],function(s){return s.reduce((e,t)=>e+ww(t),0)}]];class Pd{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const n=lc(t),r=bw(n);this.rect={...e},this.width=e.width,this.height=e.height;for(const[o,i,l]of sR)for(const a of i)Object.defineProperty(this,a,{get:()=>{const c=l(n),u=r[o]-c;return this.rect[a]+u},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ai{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var n;return(n=this.target)==null?void 0:n.removeEventListener(...t)})},this.target=e}add(e,t,n){var r;(r=this.target)==null||r.addEventListener(e,t,n),this.listeners.push([e,t,n])}}function ju(s,e){const t=Math.abs(s.x),n=Math.abs(s.y);return typeof e=="number"?Math.sqrt(t**2+n**2)>e:"x"in e&&"y"in e?t>e.x&&n>e.y:"x"in e?t>e.x:"y"in e&&n>e.y}var Kn,bt;function hp(s){s.preventDefault()}function iR(s){s.stopPropagation()}(function(s){s.Click="click",s.DragStart="dragstart",s.Keydown="keydown",s.ContextMenu="contextmenu",s.Resize="resize",s.SelectionChange="selectionchange",s.VisibilityChange="visibilitychange"})(Kn||(Kn={})),(function(s){s.Space="Space",s.Down="ArrowDown",s.Right="ArrowRight",s.Left="ArrowLeft",s.Up="ArrowUp",s.Esc="Escape",s.Enter="Enter",s.Tab="Tab"})(bt||(bt={}));const vw={start:[bt.Space,bt.Enter],cancel:[bt.Esc],end:[bt.Space,bt.Enter,bt.Tab]},lR=(s,e)=>{let{currentCoordinates:t}=e;switch(s.code){case bt.Right:return{...t,x:t.x+25};case bt.Left:return{...t,x:t.x-25};case bt.Down:return{...t,y:t.y+25};case bt.Up:return{...t,y:t.y-25}}};class Sh{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new Ai(Is(t)),this.windowListeners=new Ai(An(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Kn.Resize,this.handleCancel),this.windowListeners.add(Kn.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Kn.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,n=e.node.current;n&&Cw(n),t(cr)}handleKeyDown(e){if(ic(e)){const{active:t,context:n,options:r}=this.props,{keyboardCodes:o=vw,coordinateGetter:i=lR,scrollBehavior:l="smooth"}=r,{code:a}=e;if(o.end.includes(a))return void this.handleEnd(e);if(o.cancel.includes(a))return void this.handleCancel(e);const{collisionRect:c}=n.current,u=c?{x:c.left,y:c.top}:cr;this.referenceCoordinates||(this.referenceCoordinates=u);const d=i(e,{active:t,context:n.current,currentCoordinates:u});if(d){const h=zi(d,u),f={x:0,y:0},{scrollableAncestors:g}=n.current;for(const m of g){const p=e.code,{isTop:S,isRight:w,isLeft:b,isBottom:C,maxScroll:_,minScroll:y}=yw(m),v=oR(m),x={x:Math.min(p===bt.Right?v.right-v.width/2:v.right,Math.max(p===bt.Right?v.left:v.left+v.width/2,d.x)),y:Math.min(p===bt.Down?v.bottom-v.height/2:v.bottom,Math.max(p===bt.Down?v.top:v.top+v.height/2,d.y))},E=p===bt.Right&&!w||p===bt.Left&&!b,R=p===bt.Down&&!C||p===bt.Up&&!S;if(E&&x.x!==d.x){const I=m.scrollLeft+h.x,A=p===bt.Right&&I<=_.x||p===bt.Left&&I>=y.x;if(A&&!h.y)return void m.scrollTo({left:I,behavior:l});f.x=A?m.scrollLeft-I:p===bt.Right?m.scrollLeft-_.x:m.scrollLeft-y.x,f.x&&m.scrollBy({left:-f.x,behavior:l});break}if(R&&x.y!==d.y){const I=m.scrollTop+h.y,A=p===bt.Down&&I<=_.y||p===bt.Up&&I>=y.y;if(A&&!h.x)return void m.scrollTo({top:I,behavior:l});f.y=A?m.scrollTop-I:p===bt.Down?m.scrollTop-_.y:m.scrollTop-y.y,f.y&&m.scrollBy({top:-f.y,behavior:l});break}}this.handleMove(e,as(zi(d,this.referenceCoordinates),f))}}}handleMove(e,t){const{onMove:n}=this.props;e.preventDefault(),n(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function gp(s){return!!(s&&"distance"in s)}function fp(s){return!!(s&&"delay"in s)}Sh.activators=[{eventName:"onKeyDown",handler:(s,e,t)=>{let{keyboardCodes:n=vw,onActivation:r}=e,{active:o}=t;const{code:i}=s.nativeEvent;if(n.start.includes(i)){const l=o.activatorNode.current;return(!l||s.target===l)&&(s.preventDefault(),r?.({event:s.nativeEvent}),!0)}return!1}}];class wh{constructor(e,t,n){var r;n===void 0&&(n=(function(l){const{EventTarget:a}=An(l);return l instanceof a?l:Is(l)})(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:o}=e,{target:i}=o;this.props=e,this.events=t,this.document=Is(i),this.documentListeners=new Ai(this.document),this.listeners=new Ai(n),this.windowListeners=new Ai(An(i)),this.initialCoordinates=(r=$a(o))!=null?r:cr,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:n}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Kn.Resize,this.handleCancel),this.windowListeners.add(Kn.DragStart,hp),this.windowListeners.add(Kn.VisibilityChange,this.handleCancel),this.windowListeners.add(Kn.ContextMenu,hp),this.documentListeners.add(Kn.Keydown,this.handleKeydown),t){if(n!=null&&n({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(fp(t))return this.timeoutId=setTimeout(this.handleStart,t.delay),void this.handlePending(t);if(gp(t))return void this.handlePending(t)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:n,onPending:r}=this.props;r(n,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(Kn.Click,iR,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Kn.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:n,initialCoordinates:r,props:o}=this,{onMove:i,options:{activationConstraint:l}}=o;if(!r)return;const a=(t=$a(e))!=null?t:cr,c=zi(r,a);if(!n&&l){if(gp(l)){if(l.tolerance!=null&&ju(c,l.tolerance))return this.handleCancel();if(ju(c,l.distance))return this.handleStart()}return fp(l)&&ju(c,l.tolerance)?this.handleCancel():void this.handlePending(l,c)}e.cancelable&&e.preventDefault(),i(a)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===bt.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const aR={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class xw extends wh{constructor(e){const{event:t}=e,n=Is(t.target);super(e,aR,n)}}xw.activators=[{eventName:"onPointerDown",handler:(s,e)=>{let{nativeEvent:t}=s,{onActivation:n}=e;return!(!t.isPrimary||t.button!==0)&&(n?.({event:t}),!0)}}];const cR={move:{name:"mousemove"},end:{name:"mouseup"}};var Hd;(function(s){s[s.RightClick=2]="RightClick"})(Hd||(Hd={}));class Ew extends wh{constructor(e){super(e,cR,Is(e.event.target))}}Ew.activators=[{eventName:"onMouseDown",handler:(s,e)=>{let{nativeEvent:t}=s,{onActivation:n}=e;return t.button!==Hd.RightClick&&(n?.({event:t}),!0)}}];const Gu={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Rw extends wh{constructor(e){super(e,Gu)}static setup(){return window.addEventListener(Gu.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Gu.move.name,e)};function e(){}}}var Mi,Wa;function uR(s){let{acceleration:e,activator:t=Mi.Pointer,canScroll:n,draggingRect:r,enabled:o,interval:i=5,order:l=Wa.TreeOrder,pointerCoordinates:a,scrollableAncestors:c,scrollableAncestorRects:u,delta:d,threshold:h}=s;const f=(function(y){let{delta:v,disabled:x}=y;const E=Ha(v);return Ii(R=>{if(x||!E||!R)return dR;const I={x:Math.sign(v.x-E.x),y:Math.sign(v.y-E.y)};return{x:{[hn.Backward]:R.x[hn.Backward]||I.x===-1,[hn.Forward]:R.x[hn.Forward]||I.x===1},y:{[hn.Backward]:R.y[hn.Backward]||I.y===-1,[hn.Forward]:R.y[hn.Forward]||I.y===1}}},[x,v,E])})({delta:d,disabled:!o}),[g,m]=(function(){const y=M.useRef(null);return[M.useCallback((v,x)=>{y.current=setInterval(v,x)},[]),M.useCallback(()=>{y.current!==null&&(clearInterval(y.current),y.current=null)},[])]})(),p=M.useRef({x:0,y:0}),S=M.useRef({x:0,y:0}),w=M.useMemo(()=>{switch(t){case Mi.Pointer:return a?{top:a.y,bottom:a.y,left:a.x,right:a.x}:null;case Mi.DraggableRect:return r}},[t,r,a]),b=M.useRef(null),C=M.useCallback(()=>{const y=b.current;if(!y)return;const v=p.current.x*S.current.x,x=p.current.y*S.current.y;y.scrollBy(v,x)},[]),_=M.useMemo(()=>l===Wa.TreeOrder?[...c].reverse():c,[l,c]);M.useEffect(()=>{if(o&&c.length&&w){for(const y of _){if(n?.(y)===!1)continue;const v=c.indexOf(y),x=u[v];if(!x)continue;const{direction:E,speed:R}=rR(y,x,w,e,h);for(const I of["x","y"])f[I][E[I]]||(R[I]=0,E[I]=0);if(R.x>0||R.y>0)return m(),b.current=y,g(C,i),p.current=R,void(S.current=E)}p.current={x:0,y:0},S.current={x:0,y:0},m()}else m()},[e,C,n,m,o,i,JSON.stringify(w),JSON.stringify(f),g,c,_,u,JSON.stringify(h)])}Rw.activators=[{eventName:"onTouchStart",handler:(s,e)=>{let{nativeEvent:t}=s,{onActivation:n}=e;const{touches:r}=t;return!(r.length>1)&&(n?.({event:t}),!0)}}],(function(s){s[s.Pointer=0]="Pointer",s[s.DraggableRect=1]="DraggableRect"})(Mi||(Mi={})),(function(s){s[s.TreeOrder=0]="TreeOrder",s[s.ReversedTreeOrder=1]="ReversedTreeOrder"})(Wa||(Wa={}));const dR={x:{[hn.Backward]:!1,[hn.Forward]:!1},y:{[hn.Backward]:!1,[hn.Forward]:!1}};var Pi,$d;(function(s){s[s.Always=0]="Always",s[s.BeforeDragging=1]="BeforeDragging",s[s.WhileDragging=2]="WhileDragging"})(Pi||(Pi={})),(function(s){s.Optimized="optimized"})($d||($d={}));const mp=new Map;function Vd(s,e){return Ii(t=>s?t||(typeof e=="function"?e(s):s):null,[e,s])}function ja(s){let{callback:e,disabled:t}=s;const n=sc(e),r=M.useMemo(()=>{if(t||typeof window>"u"||window.ResizeObserver===void 0)return;const{ResizeObserver:o}=window;return new o(n)},[t]);return M.useEffect(()=>()=>r?.disconnect(),[r]),r}function hR(s){return new Pd(ks(s),s)}function pp(s,e,t){e===void 0&&(e=hR);const[n,r]=M.useState(null);function o(){r(a=>{if(!s)return null;var c;if(s.isConnected===!1)return(c=a??t)!=null?c:null;const u=e(s);return JSON.stringify(a)===JSON.stringify(u)?a:u})}const i=(function(a){let{callback:c,disabled:u}=a;const d=sc(c),h=M.useMemo(()=>{if(u||typeof window>"u"||window.MutationObserver===void 0)return;const{MutationObserver:f}=window;return new f(d)},[d,u]);return M.useEffect(()=>()=>h?.disconnect(),[h]),h})({callback(a){if(s)for(const c of a){const{type:u,target:d}=c;if(u==="childList"&&d instanceof HTMLElement&&d.contains(s)){o();break}}}}),l=ja({callback:o});return ir(()=>{o(),s?(l?.observe(s),i?.observe(document.body,{childList:!0,subtree:!0})):(l?.disconnect(),i?.disconnect())},[s]),n}const Sp=[];function wp(s,e){e===void 0&&(e=[]);const t=M.useRef(null);return M.useEffect(()=>{t.current=null},e),M.useEffect(()=>{const n=s!==cr;n&&!t.current&&(t.current=s),!n&&t.current&&(t.current=null)},[s]),t.current?zi(s,t.current):cr}function _p(s){return M.useMemo(()=>s?(function(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}})(s):null,[s])}const yp=[];function Iw(s){if(!s)return null;if(s.children.length>1)return s;const e=s.children[0];return Ji(e)?e:s}const gR=[{sensor:xw,options:{}},{sensor:Sh,options:{}}],fR={current:{}},_a={draggable:{measure:dp},droppable:{measure:dp,strategy:Pi.WhileDragging,frequency:$d.Optimized},dragOverlay:{measure:ks}};class Ti extends Map{get(e){var t;return e!=null&&(t=super.get(e))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,n;return(t=(n=this.get(e))==null?void 0:n.node.current)!=null?t:void 0}}const mR={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Ti,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Va},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:_a,measureDroppableContainers:Va,windowRect:null,measuringScheduled:!1},Aw={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Va,draggableNodes:new Map,over:null,measureDroppableContainers:Va},Xi=M.createContext(Aw),Mw=M.createContext(mR);function pR(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Ti}}}function SR(s,e){switch(e.type){case ln.DragStart:return{...s,draggable:{...s.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case ln.DragMove:return s.draggable.active==null?s:{...s,draggable:{...s.draggable,translate:{x:e.coordinates.x-s.draggable.initialCoordinates.x,y:e.coordinates.y-s.draggable.initialCoordinates.y}}};case ln.DragEnd:case ln.DragCancel:return{...s,draggable:{...s.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case ln.RegisterDroppable:{const{element:t}=e,{id:n}=t,r=new Ti(s.droppable.containers);return r.set(n,t),{...s,droppable:{...s.droppable,containers:r}}}case ln.SetDroppableDisabled:{const{id:t,key:n,disabled:r}=e,o=s.droppable.containers.get(t);if(!o||n!==o.key)return s;const i=new Ti(s.droppable.containers);return i.set(t,{...o,disabled:r}),{...s,droppable:{...s.droppable,containers:i}}}case ln.UnregisterDroppable:{const{id:t,key:n}=e,r=s.droppable.containers.get(t);if(!r||n!==r.key)return s;const o=new Ti(s.droppable.containers);return o.delete(t),{...s,droppable:{...s.droppable,containers:o}}}default:return s}}function wR(s){let{disabled:e}=s;const{active:t,activatorEvent:n,draggableNodes:r}=M.useContext(Xi),o=Ha(n),i=Ha(t?.id);return M.useEffect(()=>{if(!e&&!n&&o&&i!=null){if(!ic(o)||document.activeElement===o.target)return;const l=r.get(i);if(!l)return;const{activatorNode:a,node:c}=l;if(!a.current&&!c.current)return;requestAnimationFrame(()=>{for(const u of[a.current,c.current]){if(!u)continue;const d=$E(u);if(d){d.focus();break}}})}},[n,e,r,i,o]),null}function Tw(s,e){let{transform:t,...n}=e;return s!=null&&s.length?s.reduce((r,o)=>o({transform:r,...n}),t):t}const ac=M.createContext({...cr,scaleX:1,scaleY:1});var Yr;(function(s){s[s.Uninitialized=0]="Uninitialized",s[s.Initializing=1]="Initializing",s[s.Initialized=2]="Initialized"})(Yr||(Yr={}));const _R=M.memo(function(s){var e,t,n,r;let{id:o,accessibility:i,autoScroll:l=!0,children:a,sensors:c=gR,collisionDetection:u=QE,measuring:d,modifiers:h,...f}=s;const g=M.useReducer(SR,void 0,pR),[m,p]=g,[S,w]=(function(){const[me]=M.useState(()=>new Set),Re=M.useCallback(Me=>(me.add(Me),()=>me.delete(Me)),[me]);return[M.useCallback(Me=>{let{type:qe,event:nt}=Me;me.forEach(Ye=>{var Ve;return(Ve=Ye[qe])==null?void 0:Ve.call(Ye,nt)})},[me]),Re]})(),[b,C]=M.useState(Yr.Uninitialized),_=b===Yr.Initialized,{draggable:{active:y,nodes:v,translate:x},droppable:{containers:E}}=m,R=y!=null?v.get(y):null,I=M.useRef({initial:null,translated:null}),A=M.useMemo(()=>{var me;return y!=null?{id:y,data:(me=R?.data)!=null?me:fR,rect:I}:null},[y,R]),T=M.useRef(null),[O,N]=M.useState(null),[D,F]=M.useState(null),k=Bi(f,Object.values(f)),L=Ki("DndDescribedBy",o),W=M.useMemo(()=>E.getEnabled(),[E]),$=M.useMemo(()=>({draggable:{..._a.draggable,...J?.draggable},droppable:{..._a.droppable,...J?.droppable},dragOverlay:{..._a.dragOverlay,...J?.dragOverlay}}),[(J=d)==null?void 0:J.draggable,J?.droppable,J?.dragOverlay]);var J;const{droppableRects:te,measureDroppableContainers:Q,measuringScheduled:G}=(function(me,Re){let{dragging:Me,dependencies:qe,config:nt}=Re;const[Ye,Ve]=M.useState(null),{frequency:et,measure:We,strategy:Xe}=nt,Ue=M.useRef(me),Ke=(function(){switch(Xe){case Pi.Always:return!1;case Pi.BeforeDragging:return Me;default:return!Me}})(),Ze=Bi(Ke),wt=M.useCallback(function(jt){jt===void 0&&(jt=[]),Ze.current||Ve(Ot=>Ot===null?jt:Ot.concat(jt.filter(lt=>!Ot.includes(lt))))},[Ze]),pt=M.useRef(null),_t=Ii(jt=>{if(Ke&&!Me)return mp;if(!jt||jt===mp||Ue.current!==me||Ye!=null){const Ot=new Map;for(let lt of me){if(!lt)continue;if(Ye&&Ye.length>0&&!Ye.includes(lt.id)&&lt.rect.current){Ot.set(lt.id,lt.rect.current);continue}const Bt=lt.node.current,zt=Bt?new Pd(We(Bt),Bt):null;lt.rect.current=zt,zt&&Ot.set(lt.id,zt)}return Ot}return jt},[me,Ye,Me,Ke,We]);return M.useEffect(()=>{Ue.current=me},[me]),M.useEffect(()=>{Ke||wt()},[Me,Ke]),M.useEffect(()=>{Ye&&Ye.length>0&&Ve(null)},[JSON.stringify(Ye)]),M.useEffect(()=>{Ke||typeof et!="number"||pt.current!==null||(pt.current=setTimeout(()=>{wt(),pt.current=null},et))},[et,Ke,wt,...qe]),{droppableRects:_t,measureDroppableContainers:wt,measuringScheduled:Ye!=null}})(W,{dragging:_,dependencies:[x.x,x.y],config:$.droppable}),ee=(function(me,Re){const Me=Re!=null?me.get(Re):void 0,qe=Me?Me.node.current:null;return Ii(nt=>{var Ye;return Re==null?null:(Ye=qe??nt)!=null?Ye:null},[qe,Re])})(v,y),ne=M.useMemo(()=>D?$a(D):null,[D]),re=(function(){const me=O?.autoScrollEnabled===!1,Re=typeof l=="object"?l.enabled===!1:l===!1,Me=_&&!me&&!Re;return typeof l=="object"?{...l,enabled:Me}:{enabled:Me}})(),U=(function(me,Re){return Vd(me,Re)})(ee,$.draggable.measure);(function(me){let{activeNode:Re,measure:Me,initialRect:qe,config:nt=!0}=me;const Ye=M.useRef(!1),{x:Ve,y:et}=typeof nt=="boolean"?{x:nt,y:nt}:nt;ir(()=>{if(!Ve&&!et||!Re)return void(Ye.current=!1);if(Ye.current||!qe)return;const We=Re?.node.current;if(!We||We.isConnected===!1)return;const Xe=up(Me(We),qe);if(Ve||(Xe.x=0),et||(Xe.y=0),Ye.current=!0,Math.abs(Xe.x)>0||Math.abs(Xe.y)>0){const Ue=pw(We);Ue&&Ue.scrollBy({top:Xe.y,left:Xe.x})}},[Re,Ve,et,qe,Me])})({activeNode:y!=null?v.get(y):null,config:re.layoutShiftCompensation,initialRect:U,measure:$.draggable.measure});const ue=pp(ee,$.draggable.measure,U),oe=pp(ee?ee.parentElement:null),Z=M.useRef({activatorEvent:null,active:null,activeNode:ee,collisionRect:null,collisions:null,droppableRects:te,draggableNodes:v,draggingNode:null,draggingNodeRect:null,droppableContainers:E,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Y=E.getNodeFor((e=Z.current.over)==null?void 0:e.id),we=(function(me){let{measure:Re}=me;const[Me,qe]=M.useState(null),nt=ja({callback:M.useCallback(We=>{for(const{target:Xe}of We)if(Ji(Xe)){qe(Ue=>{const Ke=Re(Xe);return Ue?{...Ue,width:Ke.width,height:Ke.height}:Ke});break}},[Re])}),Ye=M.useCallback(We=>{const Xe=Iw(We);nt?.disconnect(),Xe&&nt?.observe(Xe),qe(Xe?Re(Xe):null)},[Re,nt]),[Ve,et]=Pa(Ye);return M.useMemo(()=>({nodeRef:Ve,rect:Me,setRef:et}),[Me,Ve,et])})({measure:$.dragOverlay.measure}),ge=(t=we.nodeRef.current)!=null?t:ee,de=_?(n=we.rect)!=null?n:ue:null,be=!!(we.nodeRef.current&&we.rect),he=up(fe=be?null:ue,Vd(fe));var fe;const z=_p(ge?An(ge):null),Fe=(function(me){const Re=M.useRef(me),Me=Ii(qe=>me?qe&&qe!==Sp&&me&&Re.current&&me.parentNode===Re.current.parentNode?qe:lc(me):Sp,[me]);return M.useEffect(()=>{Re.current=me},[me]),Me})(_?Y??ee:null),De=(function(me,Re){Re===void 0&&(Re=ks);const[Me]=me,qe=_p(Me?An(Me):null),[nt,Ye]=M.useState(yp);function Ve(){Ye(()=>me.length?me.map(We=>_w(We)?qe:new Pd(Re(We),We)):yp)}const et=ja({callback:Ve});return ir(()=>{et?.disconnect(),Ve(),me.forEach(We=>et?.observe(We))},[me]),nt})(Fe),Ge=Tw(h,{transform:{x:x.x-he.x,y:x.y-he.y,scaleX:1,scaleY:1},activatorEvent:D,active:A,activeNodeRect:ue,containerNodeRect:oe,draggingNodeRect:de,over:Z.current.over,overlayNodeRect:we.rect,scrollableAncestors:Fe,scrollableAncestorRects:De,windowRect:z}),H=ne?as(ne,x):null,ie=(function(me){const[Re,Me]=M.useState(null),qe=M.useRef(me),nt=M.useCallback(Ye=>{const Ve=Wu(Ye.target);Ve&&Me(et=>et?(et.set(Ve,zd(Ve)),new Map(et)):null)},[]);return M.useEffect(()=>{const Ye=qe.current;if(me!==Ye){Ve(Ye);const et=me.map(We=>{const Xe=Wu(We);return Xe?(Xe.addEventListener("scroll",nt,{passive:!0}),[Xe,zd(Xe)]):null}).filter(We=>We!=null);Me(et.length?new Map(et):null),qe.current=me}return()=>{Ve(me),Ve(Ye)};function Ve(et){et.forEach(We=>{Wu(We)?.removeEventListener("scroll",nt)})}},[nt,me]),M.useMemo(()=>me.length?Re?Array.from(Re.values()).reduce((Ye,Ve)=>as(Ye,Ve),cr):bw(me):cr,[me,Re])})(Fe),Se=wp(ie),j=wp(ie,[ue]),se=as(Ge,Se),ye=de?eR(de,Ge):null,xe=A&&ye?u({active:A,collisionRect:ye,droppableRects:te,droppableContainers:W,pointerCoordinates:H}):null,Ee=fw(xe,"id"),[K,le]=M.useState(null),X=(function(me,Re,Me){return{...me,scaleX:Re&&Me?Re.width/Me.width:1,scaleY:Re&&Me?Re.height/Me.height:1}})(be?Ge:as(Ge,j),(r=K?.rect)!=null?r:null,ue),ae=M.useRef(null),Ie=M.useCallback((me,Re)=>{let{sensor:Me,options:qe}=Re;if(T.current==null)return;const nt=v.get(T.current);if(!nt)return;const Ye=me.nativeEvent,Ve=new Me({active:T.current,activeNode:nt,event:Ye,options:qe,context:Z,onAbort(We){if(!v.get(We))return;const{onDragAbort:Xe}=k.current,Ue={id:We};Xe?.(Ue),S({type:"onDragAbort",event:Ue})},onPending(We,Xe,Ue,Ke){if(!v.get(We))return;const{onDragPending:Ze}=k.current,wt={id:We,constraint:Xe,initialCoordinates:Ue,offset:Ke};Ze?.(wt),S({type:"onDragPending",event:wt})},onStart(We){const Xe=T.current;if(Xe==null)return;const Ue=v.get(Xe);if(!Ue)return;const{onDragStart:Ke}=k.current,Ze={activatorEvent:Ye,active:{id:Xe,data:Ue.data,rect:I}};os.unstable_batchedUpdates(()=>{Ke?.(Ze),C(Yr.Initializing),p({type:ln.DragStart,initialCoordinates:We,active:Xe}),S({type:"onDragStart",event:Ze}),N(ae.current),F(Ye)})},onMove(We){p({type:ln.DragMove,coordinates:We})},onEnd:et(ln.DragEnd),onCancel:et(ln.DragCancel)});function et(We){return async function(){const{active:Xe,collisions:Ue,over:Ke,scrollAdjustedTranslate:Ze}=Z.current;let wt=null;if(Xe&&Ze){const{cancelDrop:pt}=k.current;wt={activatorEvent:Ye,active:Xe,collisions:Ue,delta:Ze,over:Ke},We===ln.DragEnd&&typeof pt=="function"&&await Promise.resolve(pt(wt))&&(We=ln.DragCancel)}T.current=null,os.unstable_batchedUpdates(()=>{p({type:We}),C(Yr.Uninitialized),le(null),N(null),F(null),ae.current=null;const pt=We===ln.DragEnd?"onDragEnd":"onDragCancel";if(wt){const _t=k.current[pt];_t?.(wt),S({type:pt,event:wt})}})}}ae.current=Ve},[v]),ve=M.useCallback((me,Re)=>(Me,qe)=>{const nt=Me.nativeEvent,Ye=v.get(qe);if(T.current!==null||!Ye||nt.dndKit||nt.defaultPrevented)return;const Ve={active:Ye};me(Me,Re.options,Ve)===!0&&(nt.dndKit={capturedBy:Re.sensor},T.current=qe,Ie(Me,Re))},[v,Ie]),ze=(function(me,Re){return M.useMemo(()=>me.reduce((Me,qe)=>{const{sensor:nt}=qe;return[...Me,...nt.activators.map(Ye=>({eventName:Ye.eventName,handler:Re(Ye.handler,qe)}))]},[]),[me,Re])})(c,ve);(function(me){M.useEffect(()=>{if(!oc)return;const Re=me.map(Me=>{let{sensor:qe}=Me;return qe.setup==null?void 0:qe.setup()});return()=>{for(const Me of Re)Me?.()}},me.map(Re=>{let{sensor:Me}=Re;return Me}))})(c),ir(()=>{ue&&b===Yr.Initializing&&C(Yr.Initialized)},[ue,b]),M.useEffect(()=>{const{onDragMove:me}=k.current,{active:Re,activatorEvent:Me,collisions:qe,over:nt}=Z.current;if(!Re||!Me)return;const Ye={active:Re,activatorEvent:Me,collisions:qe,delta:{x:se.x,y:se.y},over:nt};os.unstable_batchedUpdates(()=>{me?.(Ye),S({type:"onDragMove",event:Ye})})},[se.x,se.y]),M.useEffect(()=>{const{active:me,activatorEvent:Re,collisions:Me,droppableContainers:qe,scrollAdjustedTranslate:nt}=Z.current;if(!me||T.current==null||!Re||!nt)return;const{onDragOver:Ye}=k.current,Ve=qe.get(Ee),et=Ve&&Ve.rect.current?{id:Ve.id,rect:Ve.rect.current,data:Ve.data,disabled:Ve.disabled}:null,We={active:me,activatorEvent:Re,collisions:Me,delta:{x:nt.x,y:nt.y},over:et};os.unstable_batchedUpdates(()=>{le(et),Ye?.(We),S({type:"onDragOver",event:We})})},[Ee]),ir(()=>{Z.current={activatorEvent:D,active:A,activeNode:ee,collisionRect:ye,collisions:xe,droppableRects:te,draggableNodes:v,draggingNode:ge,draggingNodeRect:de,droppableContainers:E,over:K,scrollableAncestors:Fe,scrollAdjustedTranslate:se},I.current={initial:de,translated:ye}},[A,ee,xe,ye,v,ge,de,te,E,K,Fe,se]),uR({...re,delta:x,draggingRect:ye,pointerCoordinates:H,scrollableAncestors:Fe,scrollableAncestorRects:De});const _e=M.useMemo(()=>({active:A,activeNode:ee,activeNodeRect:ue,activatorEvent:D,collisions:xe,containerNodeRect:oe,dragOverlay:we,draggableNodes:v,droppableContainers:E,droppableRects:te,over:K,measureDroppableContainers:Q,scrollableAncestors:Fe,scrollableAncestorRects:De,measuringConfiguration:$,measuringScheduled:G,windowRect:z}),[A,ee,ue,D,xe,oe,we,v,E,te,K,Q,Fe,De,$,G,z]),Ne=M.useMemo(()=>({activatorEvent:D,activators:ze,active:A,activeNodeRect:ue,ariaDescribedById:{draggable:L},dispatch:p,draggableNodes:v,over:K,measureDroppableContainers:Q}),[D,ze,A,ue,p,L,v,K,Q]);return it.createElement(dw.Provider,{value:w},it.createElement(Xi.Provider,{value:Ne},it.createElement(Mw.Provider,{value:_e},it.createElement(ac.Provider,{value:X},a)),it.createElement(wR,{disabled:i?.restoreFocus===!1})),it.createElement(qE,{...i,hiddenTextDescribedById:L}))}),yR=M.createContext(null),bp="button";function bR(s){let{id:e,data:t,disabled:n=!1,attributes:r}=s;const o=Ki("Draggable"),{activators:i,activatorEvent:l,active:a,activeNodeRect:c,ariaDescribedById:u,draggableNodes:d,over:h}=M.useContext(Xi),{role:f=bp,roleDescription:g="draggable",tabIndex:m=0}=r??{},p=a?.id===e,S=M.useContext(p?ac:yR),[w,b]=Pa(),[C,_]=Pa(),y=(function(x,E){return M.useMemo(()=>x.reduce((R,I)=>{let{eventName:A,handler:T}=I;return R[A]=O=>{T(O,E)},R},{}),[x,E])})(i,e),v=Bi(t);return ir(()=>(d.set(e,{id:e,key:o,node:w,activatorNode:C,data:v}),()=>{const x=d.get(e);x&&x.key===o&&d.delete(e)}),[d,e]),{active:a,activatorEvent:l,activeNodeRect:c,attributes:M.useMemo(()=>({role:f,tabIndex:m,"aria-disabled":n,"aria-pressed":!(!p||f!==bp)||void 0,"aria-roledescription":g,"aria-describedby":u.draggable}),[n,f,m,p,g,u.draggable]),isDragging:p,listeners:n?void 0:y,node:w,over:h,setNodeRef:b,setActivatorNodeRef:_,transform:S}}function kw(){return M.useContext(Mw)}const CR={timeout:25};function vR(s){let{animation:e,children:t}=s;const[n,r]=M.useState(null),[o,i]=M.useState(null),l=Ha(t);return t||n||!l||r(l),ir(()=>{if(!o)return;const a=n?.key,c=n?.props.id;a!=null&&c!=null?Promise.resolve(e(c,o)).then(()=>{r(null)}):r(null)},[e,n,o]),it.createElement(it.Fragment,null,t,n?M.cloneElement(n,{ref:i}):null)}const xR={x:0,y:0,scaleX:1,scaleY:1};function ER(s){let{children:e}=s;return it.createElement(Xi.Provider,{value:Aw},it.createElement(ac.Provider,{value:xR},e))}const RR={position:"fixed",touchAction:"none"},IR=s=>ic(s)?"transform 250ms ease":void 0,AR=M.forwardRef((s,e)=>{let{as:t,activatorEvent:n,adjustScale:r,children:o,className:i,rect:l,style:a,transform:c,transition:u=IR}=s;if(!l)return null;const d=r?c:{...c,scaleX:1,scaleY:1},h={...RR,width:l.width,height:l.height,top:l.top,left:l.left,transform:Ao.Transform.toString(d),transformOrigin:r&&n?JE(n,l):void 0,transition:typeof u=="function"?u(n):u,...a};return it.createElement(t,{className:i,style:h,ref:e},o)}),MR=s=>e=>{let{active:t,dragOverlay:n}=e;const r={},{styles:o,className:i}=s;if(o!=null&&o.active)for(const[l,a]of Object.entries(o.active))a!==void 0&&(r[l]=t.node.style.getPropertyValue(l),t.node.style.setProperty(l,a));if(o!=null&&o.dragOverlay)for(const[l,a]of Object.entries(o.dragOverlay))a!==void 0&&n.node.style.setProperty(l,a);return i!=null&&i.active&&t.node.classList.add(i.active),i!=null&&i.dragOverlay&&n.node.classList.add(i.dragOverlay),function(){for(const[l,a]of Object.entries(r))t.node.style.setProperty(l,a);i!=null&&i.active&&t.node.classList.remove(i.active)}},Fw={duration:250,easing:"ease",keyframes:s=>{let{transform:{initial:e,final:t}}=s;return[{transform:Ao.Transform.toString(e)},{transform:Ao.Transform.toString(t)}]},sideEffects:MR({styles:{active:{opacity:"0"}}})};function TR(s){let{config:e,draggableNodes:t,droppableContainers:n,measuringConfiguration:r}=s;return sc((o,i)=>{if(e===null)return;const l=t.get(o);if(!l)return;const a=l.node.current;if(!a)return;const c=Iw(i);if(!c)return;const{transform:u}=An(i).getComputedStyle(i),d=mw(u);if(!d)return;const h=typeof e=="function"?e:(function(f){const{duration:g,easing:m,sideEffects:p,keyframes:S}={...Fw,...f};return w=>{let{active:b,dragOverlay:C,transform:_,...y}=w;if(!g)return;const v={x:C.rect.left-b.rect.left,y:C.rect.top-b.rect.top},x={scaleX:_.scaleX!==1?b.rect.width*_.scaleX/C.rect.width:1,scaleY:_.scaleY!==1?b.rect.height*_.scaleY/C.rect.height:1},E={x:_.x-v.x,y:_.y-v.y,...x},R=S({...y,active:b,dragOverlay:C,transform:{initial:_,final:E}}),[I]=R,A=R[R.length-1];if(JSON.stringify(I)===JSON.stringify(A))return;const T=p?.({active:b,dragOverlay:C,...y}),O=C.node.animate(R,{duration:g,easing:m,fill:"forwards"});return new Promise(N=>{O.onfinish=()=>{T?.(),N()}})}})(e);return Cw(a,r.draggable.measure),h({active:{id:o,data:l.data,node:a,rect:r.draggable.measure(a)},draggableNodes:t,dragOverlay:{node:i,rect:r.dragOverlay.measure(c)},droppableContainers:n,measuringConfiguration:r,transform:d})})}let Cp=0;function kR(s){return M.useMemo(()=>{if(s!=null)return Cp++,Cp},[s])}const FR=it.memo(s=>{let{adjustScale:e=!1,children:t,dropAnimation:n,style:r,transition:o,modifiers:i,wrapperElement:l="div",className:a,zIndex:c=999}=s;const{activatorEvent:u,active:d,activeNodeRect:h,containerNodeRect:f,draggableNodes:g,droppableContainers:m,dragOverlay:p,over:S,measuringConfiguration:w,scrollableAncestors:b,scrollableAncestorRects:C,windowRect:_}=kw(),y=M.useContext(ac),v=kR(d?.id),x=Tw(i,{activatorEvent:u,active:d,activeNodeRect:h,containerNodeRect:f,draggingNodeRect:p.rect,over:S,overlayNodeRect:p.rect,scrollableAncestors:b,scrollableAncestorRects:C,transform:y,windowRect:_}),E=Vd(h),R=TR({config:n,draggableNodes:g,droppableContainers:m,measuringConfiguration:w}),I=E?p.setRef:void 0;return it.createElement(ER,null,it.createElement(vR,{animation:R},d&&v?it.createElement(AR,{key:v,id:d.id,ref:I,as:l,activatorEvent:u,adjustScale:e,className:a,transition:o,rect:E,style:{zIndex:c,...r},transform:x},t):null))});function _h(s,e,t){const n=s.slice();return n.splice(t<0?n.length+t:t,0,n.splice(e,1)[0]),n}function NR(s,e){return s.reduce((t,n,r)=>{const o=e.get(n);return o&&(t[r]=o),t},Array(s.length))}function Pl(s){return s!==null&&s>=0}const Hl={scaleX:1,scaleY:1},OR=s=>{var e;let{rects:t,activeNodeRect:n,activeIndex:r,overIndex:o,index:i}=s;const l=(e=t[r])!=null?e:n;if(!l)return null;const a=(function(c,u,d){const h=c[u],f=c[u-1],g=c[u+1];return!h||!f&&!g?0:d<u?f?h.left-(f.left+f.width):g.left-(h.left+h.width):g?g.left-(h.left+h.width):h.left-(f.left+f.width)})(t,i,r);if(i===r){const c=t[o];return c?{x:r<o?c.left+c.width-(l.left+l.width):c.left-l.left,y:0,...Hl}:null}return i>r&&i<=o?{x:-l.width-a,y:0,...Hl}:i<r&&i>=o?{x:l.width+a,y:0,...Hl}:{x:0,y:0,...Hl}},yh=s=>{let{rects:e,activeIndex:t,overIndex:n,index:r}=s;const o=_h(e,n,t),i=e[r],l=o[r];return l&&i?{x:l.left-i.left,y:l.top-i.top,scaleX:l.width/i.width,scaleY:l.height/i.height}:null},Nw="Sortable",Ow=it.createContext({activeIndex:-1,containerId:Nw,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:yh,disabled:{draggable:!1,droppable:!1}});function DR(s){let{children:e,id:t,items:n,strategy:r=yh,disabled:o=!1}=s;const{active:i,dragOverlay:l,droppableRects:a,over:c,measureDroppableContainers:u}=kw(),d=Ki(Nw,t),h=l.rect!==null,f=M.useMemo(()=>n.map(y=>typeof y=="object"&&"id"in y?y.id:y),[n]),g=i!=null,m=i?f.indexOf(i.id):-1,p=c?f.indexOf(c.id):-1,S=M.useRef(f),w=!(function(y,v){if(y===v)return!0;if(y.length!==v.length)return!1;for(let x=0;x<y.length;x++)if(y[x]!==v[x])return!1;return!0})(f,S.current),b=p!==-1&&m===-1||w,C=(function(y){return typeof y=="boolean"?{draggable:y,droppable:y}:y})(o);ir(()=>{w&&g&&u(f)},[w,f,g,u]),M.useEffect(()=>{S.current=f},[f]);const _=M.useMemo(()=>({activeIndex:m,containerId:d,disabled:C,disableTransforms:b,items:f,overIndex:p,useDragOverlay:h,sortedRects:NR(f,a),strategy:r}),[m,d,C.draggable,C.droppable,b,f,p,a,h,r]);return it.createElement(Ow.Provider,{value:_},e)}const LR=s=>{let{id:e,items:t,activeIndex:n,overIndex:r}=s;return _h(t,n,r).indexOf(e)},BR=s=>{let{containerId:e,isSorting:t,wasDragging:n,index:r,items:o,newIndex:i,previousItems:l,previousContainerId:a,transition:c}=s;return!(!c||!n)&&(l===o||r!==i)&&(!!t||i!==r&&e===a)},zR={duration:200,easing:"ease"},Dw="transform",PR=Ao.Transition.toString({property:Dw,duration:0,easing:"linear"}),HR={roleDescription:"sortable"};function $R(s){let{animateLayoutChanges:e=BR,attributes:t,disabled:n,data:r,getNewIndex:o=LR,id:i,strategy:l,resizeObserverConfig:a,transition:c=zR}=s;const{items:u,containerId:d,activeIndex:h,disabled:f,disableTransforms:g,sortedRects:m,overIndex:p,useDragOverlay:S,strategy:w}=M.useContext(Ow),b=(function(Y,we){var ge,de;return typeof Y=="boolean"?{draggable:Y,droppable:!1}:{draggable:(ge=Y?.draggable)!=null?ge:we.draggable,droppable:(de=Y?.droppable)!=null?de:we.droppable}})(n,f),C=u.indexOf(i),_=M.useMemo(()=>({sortable:{containerId:d,index:C,items:u},...r}),[d,r,C,u]),y=M.useMemo(()=>u.slice(u.indexOf(i)),[u,i]),{rect:v,node:x,isOver:E,setNodeRef:R}=(function(Y){let{data:we,disabled:ge=!1,id:de,resizeObserverConfig:be}=Y;const he=Ki("Droppable"),{active:fe,dispatch:z,over:Fe,measureDroppableContainers:De}=M.useContext(Xi),Ge=M.useRef({disabled:ge}),H=M.useRef(!1),ie=M.useRef(null),Se=M.useRef(null),{disabled:j,updateMeasurementsFor:se,timeout:ye}={...CR,...be},xe=Bi(se??de),Ee=ja({callback:M.useCallback(()=>{H.current?(Se.current!=null&&clearTimeout(Se.current),Se.current=setTimeout(()=>{De(Array.isArray(xe.current)?xe.current:[xe.current]),Se.current=null},ye)):H.current=!0},[ye]),disabled:j||!fe}),K=M.useCallback((Ie,ve)=>{Ee&&(ve&&(Ee.unobserve(ve),H.current=!1),Ie&&Ee.observe(Ie))},[Ee]),[le,X]=Pa(K),ae=Bi(we);return M.useEffect(()=>{Ee&&le.current&&(Ee.disconnect(),H.current=!1,Ee.observe(le.current))},[le,Ee]),M.useEffect(()=>(z({type:ln.RegisterDroppable,element:{id:de,key:he,disabled:ge,node:le,rect:ie,data:ae}}),()=>z({type:ln.UnregisterDroppable,key:he,id:de})),[de]),M.useEffect(()=>{ge!==Ge.current.disabled&&(z({type:ln.SetDroppableDisabled,id:de,key:he,disabled:ge}),Ge.current.disabled=ge)},[de,he,ge,z]),{active:fe,rect:ie,isOver:Fe?.id===de,node:le,over:Fe,setNodeRef:X}})({id:i,data:_,disabled:b.droppable,resizeObserverConfig:{updateMeasurementsFor:y,...a}}),{active:I,activatorEvent:A,activeNodeRect:T,attributes:O,setNodeRef:N,listeners:D,isDragging:F,over:k,setActivatorNodeRef:L,transform:W}=bR({id:i,data:_,attributes:{...HR,...t},disabled:b.draggable}),$=(function(){for(var Y=arguments.length,we=new Array(Y),ge=0;ge<Y;ge++)we[ge]=arguments[ge];return M.useMemo(()=>de=>{we.forEach(be=>be(de))},we)})(R,N),J=!!I,te=J&&!g&&Pl(h)&&Pl(p),Q=!S&&F,G=Q&&te?W:null,ee=te?G??(l??w)({rects:m,activeNodeRect:T,activeIndex:h,overIndex:p,index:C}):null,ne=Pl(h)&&Pl(p)?o({id:i,items:u,activeIndex:h,overIndex:p}):C,re=I?.id,U=M.useRef({activeId:re,items:u,newIndex:ne,containerId:d}),ue=u!==U.current.items,oe=e({active:I,containerId:d,isDragging:F,isSorting:J,id:i,index:C,items:u,newIndex:U.current.newIndex,previousItems:U.current.items,previousContainerId:U.current.containerId,transition:c,wasDragging:U.current.activeId!=null}),Z=(function(Y){let{disabled:we,index:ge,node:de,rect:be}=Y;const[he,fe]=M.useState(null),z=M.useRef(ge);return ir(()=>{if(!we&&ge!==z.current&&de.current){const Fe=be.current;if(Fe){const De=ks(de.current,{ignoreTransform:!0}),Ge={x:Fe.left-De.left,y:Fe.top-De.top,scaleX:Fe.width/De.width,scaleY:Fe.height/De.height};(Ge.x||Ge.y)&&fe(Ge)}}ge!==z.current&&(z.current=ge)},[we,ge,de,be]),M.useEffect(()=>{he&&fe(null)},[he]),he})({disabled:!oe,index:C,node:x,rect:v});return M.useEffect(()=>{J&&U.current.newIndex!==ne&&(U.current.newIndex=ne),d!==U.current.containerId&&(U.current.containerId=d),u!==U.current.items&&(U.current.items=u)},[J,ne,d,u]),M.useEffect(()=>{if(re===U.current.activeId)return;if(re!=null&&U.current.activeId==null)return void(U.current.activeId=re);const Y=setTimeout(()=>{U.current.activeId=re},50);return()=>clearTimeout(Y)},[re]),{active:I,activeIndex:h,attributes:O,data:_,rect:v,index:C,newIndex:ne,items:u,isOver:E,isSorting:J,isDragging:F,listeners:D,node:x,overIndex:p,over:k,setNodeRef:$,setActivatorNodeRef:L,setDroppableNodeRef:R,setDraggableNodeRef:N,transform:Z??ee,transition:(function(){if(Z||ue&&U.current.newIndex===C)return PR;if(!(Q&&!ic(A)||!c)&&(J||oe))return Ao.Transition.toString({...c,property:Dw})})()}}function Ga(s){if(!s)return!1;const e=s.data.current;return!!(e&&"sortable"in e&&typeof e.sortable=="object"&&"containerId"in e.sortable&&"items"in e.sortable&&"index"in e.sortable)}const VR=[bt.Down,bt.Right,bt.Up,bt.Left],WR=(s,e)=>{let{context:{active:t,collisionRect:n,droppableRects:r,droppableContainers:o,over:i,scrollableAncestors:l}}=e;if(VR.includes(s.code)){if(s.preventDefault(),!t||!n)return;const a=[];o.getEnabled().forEach(d=>{if(!d||d!=null&&d.disabled)return;const h=r.get(d.id);if(h)switch(s.code){case bt.Down:n.top<h.top&&a.push(d);break;case bt.Up:n.top>h.top&&a.push(d);break;case bt.Left:n.left>h.left&&a.push(d);break;case bt.Right:n.left<h.left&&a.push(d)}});const c=(d=>{let{collisionRect:h,droppableRects:f,droppableContainers:g}=d;const m=ap(h),p=[];for(const S of g){const{id:w}=S,b=f.get(w);if(b){const C=ap(b),_=m.reduce((v,x,E)=>v+hw(C[E],x),0),y=Number((_/4).toFixed(4));p.push({id:w,data:{droppableContainer:S,value:y}})}}return p.sort(gw)})({collisionRect:n,droppableRects:r,droppableContainers:a});let u=fw(c,"id");if(u===i?.id&&c.length>1&&(u=c[1].id),u!=null){const d=o.get(t.id),h=o.get(u),f=h?r.get(h.id):null,g=h?.node.current;if(g&&f&&d&&h){const m=lc(g).some((C,_)=>l[_]!==C),p=vp(d,h),S=(function(C,_){return!Ga(C)||!Ga(_)||!vp(C,_)?!1:C.data.current.sortable.index<_.data.current.sortable.index})(d,h),w=m||!p?{x:0,y:0}:{x:S?n.width-f.width:0,y:S?n.height-f.height:0},b={x:f.left,y:f.top};return w.x&&w.y?b:zi(b,w)}}}};function vp(s,e){return!(!Ga(s)||!Ga(e))&&s.data.current.sortable.containerId===e.data.current.sortable.containerId}const jR=s=>{let{transform:e}=s;return{...e,y:0}},GR=M.memo(M.forwardRef((s,e)=>{const{children:t,style:n,className:r,index:o,editing:i,editable:l,selectedIndex:a,background:c,activeColor:u,borderColor:d,borderWidth:h,dragging:f,...g}=s;return pe.jsxs("div",{ref:e,className:rn(r),style:{...n,display:"flex",flexDirection:"column",background:a===o?"white":c,minHeight:"0px",fontFamily:"inherit",fontSize:"16px",fontWeight:a===o?"700":"400",lineHeight:"1",letterSpacing:"0px",textTransform:"none",minWidth:"unset"},...g,children:[pe.jsxs("div",{style:{flex:"1 1 100%",display:"flex",flexDirection:"row"},children:[pe.jsx("div",{style:{marginLeft:a===o?"0px":"-1px",marginTop:a===o?"0px":"4px",marginBottom:"0px",background:"grey",minWidth:"1px"}}),t,a===o?pe.jsx("div",{style:{marginLeft:"0px",marginTop:"0px",marginBottom:"0px",background:"grey",minWidth:"1px"}}):pe.jsx(pe.Fragment,{})]}),pe.jsx("div",{style:{flex:"1 1 100%",background:a===o&&u?u?.toCSS():"none",minHeight:"2px"}})]})})),or={Wrapper:"_Wrapper_1wyun_25",fadeIn:"_fadeIn_1wyun_33",dragOverlay:"_dragOverlay_1wyun_37",Item:"_Item_1wyun_47",withHandle:"_withHandle_1wyun_61",dragging:"_dragging_1wyun_66",disabled:"_disabled_1wyun_74"},Lw=it.memo(it.forwardRef(({color:s,dragOverlay:e,dragging:t,disabled:n,fadeIn:r,handle:o,height:i,index:l,listeners:a,onRemove:c,renderItem:u,sorting:d,style:h,transition:f,transform:g,value:m,wrapperStyle:p,...S},w)=>{M.useEffect(()=>{if(e)return document.body.style.cursor="grabbing",()=>{document.body.style.cursor=""}},[e]);const b=u?u({dragOverlay:!!e,dragging:!!t,sorting:!!d,index:l,fadeIn:!!r,listeners:a,ref:w,style:h,transform:g,transition:f,value:m}):pe.jsx(pe.Fragment,{children:m});return pe.jsx("div",{className:rn("tab-item",or.Wrapper,r&&or.fadeIn,d&&or.sorting,e&&or.dragOverlay),style:{...p,transition:[f,p?.transition].filter(Boolean).join(", "),"--translate-x":g?`${Math.round(g.x)}px`:void 0,"--translate-y":g?`${Math.round(g.y)}px`:void 0,"--scale-x":g?.scaleX?`${g.scaleX}`:void 0,"--scale-y":g?.scaleY?`${g.scaleY}`:void 0,"--index":l},ref:w,children:pe.jsx("div",{className:rn(or.Item,t&&or.dragging,o&&or.withHandle,e&&or.dragOverlay,n&&or.disabled,s&&or.color,"dragging"),style:h,"data-cypress":"draggable-item",...o?void 0:a,...S,tabIndex:o?void 0:-1,children:b})})})),xp={Row:"_Row_1kr10_1"},UR=M.memo(M.forwardRef(({children:s,horizontal:e,style:t},n)=>pe.jsx("div",{ref:n,style:{...t},className:rn(xp.Row,e&&xp.horizontal),children:s}))),qR={...Fw},JR=M.memo(M.forwardRef((s,e)=>{const{className:t,activationConstraint:n,animateLayoutChanges:r,adjustScale:o=!1,collisionDetection:i=XE,coordinateGetter:l=WR,dropAnimation:a=qR,getItemStyles:c=()=>({}),getNewIndex:u,handle:d=!1,items:h,onMove:f,isDisabled:g=()=>!1,measuring:m,modifiers:p,renderItem:S,renderDivider:w,reorderItems:b=_h,strategy:C=yh,style:_,useDragOverlay:y=!0,onDragStart:v,wrapperStyle:x=()=>({})}=s,[E,R]=M.useState(()=>h);M.useEffect(()=>{R(h)},[h]);const[I,A]=M.useState(null),T=(function(){for(var k=arguments.length,L=new Array(k),W=0;W<k;W++)L[W]=arguments[W];return M.useMemo(()=>[...L].filter($=>$!=null),[...L])})(Vu(Ew,{activationConstraint:n}),Vu(Rw,{activationConstraint:n}),Vu(Sh,{scrollBehavior:"Cypress"in window?"auto":void 0,coordinateGetter:l})),O=E.indexOf.bind(E),N=I?O(I):-1,D=[];E.map((k,L)=>{D.push(pe.jsx(KR,{id:k,handle:d,index:L,style:c,wrapperStyle:x,disabled:g(k),renderItem:S,animateLayoutChanges:r,useDragOverlay:y,getNewIndex:u},k+"-"+L));const W=w?.({key:"divider-"+L});W&&D.push(W)});const{getPortalContainer:F}=e_();return pe.jsxs(_R,{sensors:T,collisionDetection:i,onDragStart:k=>{const{active:L}=k;L&&(v?.(k),A(L.id))},autoScroll:{canScroll:k=>!0},onDragEnd:k=>{if(A(null),k.over){const L=O(k.over.id);N!==L&&(R(W=>b(W,N,L)),f?.(N,L))}},onDragCancel:()=>{A(null)},measuring:m,modifiers:p,children:[pe.jsx("div",{style:{display:"flex",justifyContent:"flex-start",boxSizing:"border-box",..._},className:rn(t,or.Wrapper),children:pe.jsx(DR,{items:E,strategy:C,children:pe.jsx(UR,{ref:e,children:D})})}),y?os.createPortal(pe.jsx(FR,{adjustScale:o,dropAnimation:a,children:I?pe.jsx(Lw,{value:E[N],handle:d,renderItem:S,wrapperStyle:x({index:N,isDragging:!0,id:E[N]}),index:N,dragging:!0,style:c({id:E[N],index:N,isSorting:I!==null,isDragging:!0,overIndex:-1,isDragOverlay:!0}),dragOverlay:!0}):null}),F()):null]})}));function KR({disabled:s,animateLayoutChanges:e,getNewIndex:t,handle:n,id:r,index:o,onRemove:i,style:l,renderItem:a,useDragOverlay:c,wrapperStyle:u}){const{attributes:d,isDragging:h,isSorting:f,listeners:g,overIndex:m,setNodeRef:p,transform:S,transition:w}=$R({id:r,animateLayoutChanges:e,disabled:s,getNewIndex:t});return pe.jsx(Lw,{ref:p,value:r,disabled:s,dragging:h,sorting:f,handle:n,renderItem:a,index:o,style:l({index:o,id:r,isDragging:h,isSorting:f,overIndex:m}),onRemove:i?()=>i(r):void 0,transform:S,transition:w,wrapperStyle:u({index:o,isDragging:h,id:r}),listeners:g,"data-index":o,"data-id":r,dragOverlay:!c&&h,...d})}const XR="_TabStrip_3x0dp_1",ZR=new Gt("rgb(33, 115, 70)"),QR="#eee",YR=s=>pe.jsx(GR,{...s}),e2=M.memo(M.forwardRef((s,e)=>{const{children:t,style:n,className:r,selectedTabIndex:o=0,tabNames:i=[],onSelectedTabIndexChange:l,onTabNameChange:a,onTabMove:c,renderScrollButtonStart:u=Kw,renderScrollButtonEnd:d=Xw,renderScrollButtonEdge:h=Zw,renderTabButton:f=YR,renderTabDivider:g,propsEditLabel:m,disabled:p=!1,disableDrag:S=!1,background:w="white",activeColor:b=ZR,borderColor:C=QR,borderWidth:_=1}=s,[y,v]=M.useState(o),[x,E]=M.useState(i),R=M.useCallback(he=>{const fe=F.current?.[he]?.closest(".tab-item")??F.current?.[he];fe&&Q.current?.scrollTo({top:fe.offsetTop,left:fe.offsetLeft,behavior:"smooth"})},[]);M.useEffect(()=>{R(o)},[o]);const I=M.useCallback((he,fe)=>{fe!==y&&(v(fe),l?.(fe)),R(fe)},[l,y]),A=M.useCallback((he,fe)=>{c?.(he,fe)},[c]),T=M.useRef(null),[O,N]=M.useState(-1),D=M.useCallback((he,fe)=>{a?.(he,fe)},[a]);M.useLayoutEffect(()=>{v(o)},[o]),M.useLayoutEffect(()=>{E(i)},[i]);const F=M.useRef([]),k=M.useRef(null);M.useImperativeHandle(e,()=>Object.assign({startEdit(he){F.current?.[he]?.startEdit()},cancel(he){F.current?.[he]?.cancel()}},k.current),[y,O]);const L=M.useCallback(({value:he,index:fe,dragging:z})=>{const{style:Fe,maxLength:De,...Ge}=m||{},H=pe.jsx(HE,{ref:ie=>{F.current[fe]=ie},value:he,disabled:p,maxLength:De,style:{color:y===fe&&b?b?.toRGBA().toString():"inherit",flex:"1 1 100%",paddingTop:"1px",paddingBottom:"1px",...Fe},styleHover:{},onSubmit:ie=>(T.current=!1,N(-1),D(fe,ie)),onCancel:()=>{T.current=!1,N(-1)},onChange:ie=>{T.current=!0,N(fe)},...Ge});return f({onClick:ie=>I(ie,fe),value:he,index:fe,editing:O===fe&&T.current,editable:!0,disabled:p,selectedIndex:y,background:w,activeColor:b,borderColor:C,borderWidth:_,dragging:z,children:H})},[y,D,I,m,p,O,f]),[W,{width:$}]=Es(),[J,{width:te}]=Es(),Q=M.useRef(null),[G,ee]=M.useState({left:0,top:0,width:0,height:0}),[ne,re]=M.useState(null);M.useEffect(()=>{ne!==null&&Q.current&&Q.current.scrollTo({left:ne,behavior:"smooth"})},[ne]);const U=M.useCallback((he,fe=!1)=>{if(!Q.current)return 0;let z=Q.current.firstChild.getBoundingClientRect(),Fe=Q.current.firstChild.firstChild.children,De=0;return De=fe?0:Ah.getScrollTo(he,z.left,Fe,!0,Math.max(0,he-200)),re(De),Math.max(0,De)},[]),ue=M.useCallback((he,fe=!1)=>{if(!Q.current)return 0;let z=Q.current.firstChild.getBoundingClientRect(),Fe=Q.current.firstChild.firstChild.children,De=0;const Ge=Math.ceil(te-$);return De=fe?Ge:Ah.getScrollTo(he,z.left,Fe,!1,Math.max(0,he+200)),re(De),Math.min(Ge,De)},[te,$]),oe=M.useRef(null),Z=M.useRef(null),Y=M.useCallback(()=>{Z.current&&(clearTimeout(Z.current),Z.current=null,oe.current=null)},[]),we=M.useCallback((he,fe,z=260)=>{oe.current=he,Z.current=setTimeout(()=>{const Fe=fe?U(oe.current||he):ue(oe.current||he);Fe!==oe.current?we(Fe,fe,120):Y()},z)},[U,ue,Y]);M.useEffect(()=>()=>Y(),[Y]);const ge=M.useMemo(()=>({style:{marginLeft:"4px",marginRight:"6px"},disabled:Math.floor(G.left)<=0||Math.floor(te-$)===0,orientation:Ci.Horizontal,onMouseUp:Y,onMouseLeave:Y,onMouseDown:()=>we(Q.current.scrollLeft,!0),onClick:he=>U(Math.min(Q.current.scrollLeft,ne??Number.MAX_SAFE_INTEGER),he.ctrlKey)}),[G,ne,te,$]),de=M.useMemo(()=>({style:{marginLeft:"6px",marginRight:"4px"},disabled:Math.floor(te-$)<=Math.ceil(G.left),orientation:Ci.Horizontal,onMouseUp:Y,onMouseLeave:Y,onMouseDown:()=>we(Q.current.scrollLeft,!1),onClick:he=>ue(Math.max(Q.current.scrollLeft,ne??0),he.ctrlKey)}),[G,ne,te,$]),be=M.useMemo(()=>pe.jsxs(pe.Fragment,{children:[pe.jsx("div",{style:{minWidth:"16px"}}),t,h?.(ge)]}),[ge,de,u,d,t,h]);return pe.jsxs("div",{style:{...n,display:"flex",alignItems:"stretch"},className:rn(XR,r),ref:k,children:[pe.jsx("div",{style:{borderTop:`solid ${C} ${_}px`,position:"absolute",width:"100%"}}),pe.jsx("div",{style:{flex:"none",display:"flex",alignItems:"center"},children:be}),pe.jsx("div",{className:"Tabs",ref:W,style:{flex:"1 1 100%",display:"flex",position:"relative",overflow:"hidden"},children:pe.jsx("div",{style:{position:"relative",overflowY:"hidden",overflowX:"hidden",marginBottom:"3px"},ref:Q,onScroll:he=>{ee({left:he.target.scrollLeft,top:he.target.scrollTop,width:he.target.scrollWidth,height:he.target.scrollHeight})},children:pe.jsx(JR,{isDisabled:he=>p||S,items:x,strategy:OR,modifiers:[jR],ref:J,renderItem:L,renderDivider:g,onMove:A,activationConstraint:{distance:15}})})}),pe.jsx("div",{style:{flex:"none",display:"flex",alignItems:"center"},children:h(de)})]})}));e2.displayName="TabStrip";const N2=s=>pe.jsxs("svg",{...s,viewBox:"0 0 48 48",children:[pe.jsx("path",{d:"M 2.2827924,0 C 1.5038324,0 0.87090248,0.52603 0.87090248,1.17149 v 25.39667 h -0.01 v 20.2607 c 0,0.39663 0.24025002,0.74639 0.60481992,0.95852 v 0.18499 h 0.50664 c 0.0972,0.0173 0.19732,0.0276 0.30092,0.0276 h 15.5346916 16.7448 v 0 h 11.35822 c 0.10311,0 0.20276,-0.0104 0.29945,-0.0276 h 0.0696 v -0.0182 c 0.59938,-0.13566 1.04238,-0.58606 1.04238,-1.12526 V 26.96484 c 0.006,-0.0429 0.009,-0.0853 0.009,-0.12925 V 1.17154 c 0,-0.64586 -0.63293,-1.17149 -1.41189,-1.17149 h -15.7478 v 2e-4 h -2.06997 V 5e-5 Z",fill:"#547DBE"}),pe.jsx("path",{d:"m 2.8338324,2.7184 v 9.0404 H 11.538484 V 2.7184 Z m 11.2334116,0 v 9.0404 h 8.70465 V 2.7184 Z m 11.26696,0 v 9.0404 h 8.70465 V 2.7184 Z m 11.33258,0 v 9.0404 h 8.70465 V 2.7184 Z M 2.8338324,14.32723 v 8.84046 h 8.7046516 v -8.84046 z m 11.2334116,0 v 8.84046 h 8.70465 v -8.84046 z m 11.26696,0 v 8.84046 h 8.70465 v -8.84046 z m 11.33258,0 v 8.84046 h 8.70465 V 14.32723 Z M 2.8338324,25.73691 v 8.67308 h 8.7046516 v -8.67308 z m 11.2334116,0 v 8.67308 h 8.73721 v -8.67308 z m 11.26696,0 v 8.67308 h 8.70465 v -8.67308 z m 11.33258,0 v 8.67308 h 8.70465 V 25.73691 Z M 2.8693424,36.61859 v 8.67357 h 8.7046616 v -8.67357 z m 11.2339116,0 v 8.67357 h 8.73771 v -8.67357 z m 11.26697,0 v 8.67357 h 8.70465 v -8.67357 z m 11.33257,0 v 8.67357 h 8.70465 v -8.67357 z",fill:"#FFFFFF"}),pe.jsx("path",{d:"m 2.8254424,2.72091 v 9.04041 H 11.570544 V 2.72091 Z m 0,11.60889 v 8.84036 H 11.570544 V 14.3298 Z m 0,11.40958 v 8.67357 h 8.7451016 v -8.67357 z m 0.036,10.88167 v 8.67358 h 8.7451116 v -8.67358 z",fill:"#547DBE",fillOpacity:"0.4"}),pe.jsx("path",{d:"m 30.820434,6.19497 c 1.85291,0 3.66241,0.29708 5.4285,0.89113 1.7656,0.5942 3.49568,1.50108 5.19073,2.72107 l -2.37584,3.25571 c -1.40941,-1.01391 -2.79515,-1.76647 -4.15721,-2.25759 -1.36206,-0.49111 -2.72412,-0.73667 -4.08618,-0.73667 -2.5817,0 -4.58902,0.53064 -6.02232,1.59218 -1.43334,1.06143 -2.14989,2.56661 -2.14989,4.51523 v 0.0237 c 0,1.36241 0.41177,2.40021 1.23532,3.11315 0.82355,0.71288 1.89253,1.24367 3.20703,1.59217 1.31446,0.3485 2.71608,0.67341 4.20493,0.97439 1.29842,0.26929 2.58944,0.58216 3.87257,0.9386 1.28263,0.3565 2.45032,0.8635 3.50356,1.52097 1.05324,0.65747 1.89288,1.5486 2.51841,2.6734 0.62553,1.12485 0.93829,2.59035 0.93829,4.39635 v 0.0477 c 0,3.18435 -1.10849,5.64817 -3.32597,7.39066 -2.21698,1.7425 -5.33724,2.61399 -9.35978,2.61399 -1.67882,0 -3.25863,-0.15841 -4.73958,-0.47523 -1.4808,-0.31681 -2.86644,-0.79204 -4.15737,-1.42617 -1.29077,-0.63363 -2.49827,-1.42567 -3.6227,-2.37612 l 2.54179,-3.20819 c 1.39383,1.204 2.91819,2.10717 4.57323,2.70928 1.6549,0.60205 3.45641,0.90307 5.40463,0.90307 2.73991,0 4.85823,-0.52704 6.35447,-1.58048 1.49674,-1.05359 2.24511,-2.53098 2.24511,-4.43213 v -0.0237 c 0,-1.37834 -0.37197,-2.43583 -1.11639,-3.17245 -0.74442,-0.73668 -1.71824,-1.2912 -2.92194,-1.66359 -1.2037,-0.37223 -2.51051,-0.6851 -3.91993,-0.9386 -1.34627,-0.23762 -2.69635,-0.51485 -4.05046,-0.83182 -1.35417,-0.31677 -2.59339,-0.7841 -3.71782,-1.40204 -1.12448,-0.61779 -2.03125,-1.49708 -2.72017,-2.63782 -0.68898,-1.14078 -1.03341,-2.66156 -1.03341,-4.5627 v -0.0237 c 0,-3.21623 1.06898,-5.70753 3.20718,-7.47386 2.13805,-1.76648 5.15506,-2.64981 9.05121,-2.64981 z",strokeWidth:"2.5",stroke:"#EB594D",fill:"#f9CECB"})]}),bh=M.createContext(null);bh.displayName="DocThemesContext";const O2=s=>{const{themes:e,children:t}=s;return pe.jsx(bh.Provider,{value:e,children:t})},D2=()=>{const s=M.useContext(bh),[e]=M.useState(()=>new th);return M.useMemo(()=>s||e,[s])},t2="_script-editor_iy654_5",n2={lightbulb:{enabled:!1},tabSize:2,acceptSuggestionOnCommitCharacter:!0,acceptSuggestionOnEnter:"on",accessibilitySupport:"auto",automaticLayout:!0,autoIndent:!1,codeLens:!0,colorDecorators:!0,contextmenu:!0,cursorBlinking:"blink",cursorSmoothCaretAnimation:!1,cursorStyle:"line",disableLayerHinting:!1,disableMonospaceOptimizations:!1,dragAndDrop:!0,glyphMargin:!0,fixedOverflowWidgets:!1,folding:!0,foldingStrategy:"auto",fontLigatures:!1,formatOnPaste:!0,formatOnType:!1,hideCursorInOverviewRuler:!1,highlightActiveIndentGuide:!0,links:!0,lineDecorationsWidth:8,lineNumbersMinChars:3,mouseWheelZoom:!1,multiCursorMergeOverlapping:!0,multiCursorModifier:"alt",overviewRulerBorder:!0,overviewRulerLanes:2,quickSuggestions:!0,quickSuggestionsDelay:100,readOnly:!1,renderControlCharacters:!1,renderFinalNewline:!0,renderIndentGuides:!0,renderLineHighlight:"all",renderWhitespace:"none",revealHorizontalRightPadding:30,roundedSelection:!0,rulers:[],scrollBeyondLastColumn:5,scrollBeyondLastLine:!0,selectOnLineNumbers:!0,selectionClipboard:!0,selectionHighlight:!0,showLightbulbIconMode:!1,showFoldingControls:"mouseover",smoothScrolling:!0,suggestOnTriggerCharacters:!0,wordBasedSuggestions:!0,wordSeparators:`~!@#$%^&*()-=+[{]}|;:'",.<>/?`,wordWrap:"off",wordWrapBreakAfterCharacters:"	})]?|&,;",wordWrapBreakBeforeCharacters:"{([+",wordWrapBreakObtrusiveCharacters:".",wordWrapColumn:80,wordWrapMinified:!0,wrappingIndent:"none"},r2=it.lazy(()=>ao(()=>import("./CwNJi9uj-WfxZwSI-BURuWXAw.js"),__vite__mapDeps([12,3,1]),import.meta.url));let si,ii,Jr=["define","require"],Ep=!1,o2="@0.7.26";const s2=`https://cdn.jsdelivr.net/npm/@sheetxl/sdk${o2}/types/scripting.d.ts`,Rp=async(s,e,t)=>{const n=s.getModel();if(!n)return;const r=await e.languages.typescript.getTypeScriptWorker(),o=await r(n.uri),i=await o.getNavigationTree(n.uri.toString()),l=s.getPosition();let a={...l};a.lineNumber=1,a.column=1;let c=!1;for(let m=l.lineNumber;m>=1;m--)if(n.getLineContent(m).trim()===""){const p=Ch(i,n.getOffsetAt({lineNumber:m,column:1}),"function");if(!p||l2(p)){c=!0,a.lineNumber=m+1;break}{const S=p.spans[0].start;m=n.getPositionAt(S).lineNumber,a.lineNumber=m}}let u=t,d=!1;!c&&!u.startsWith(`
`)&&a.lineNumber>1&&(u=`
`+u,d=!0);let h=!1;n.getLineCount()>1&&(u.endsWith(`

`)||(u+=`

`,h=!0));const f=[{range:new e.Range(a.lineNumber,a.column,a.lineNumber,a.column),text:`${u}`}];let g=null;n.pushEditOperations([],f,m=>(g=m[0].range,d&&g.startLineNumber++,h&&g.endLineNumber--,[new e.Selection(g.startLineNumber,g.startColumn,g.endLineNumber,g.endColumn)])),s.setSelection({startLineNumber:g.endLineNumber,startColumn:g.endColumn,endLineNumber:g.startLineNumber,endColumn:g.startColumn})};function i2(s,e){let t=null;const n=s.length;for(let r=0;!t&&r<n;r++){const o=s[r];o.getName()===e.text&&(t=o)}return t?t.getContext():"formula"}function Wd(s,e,t,n,r=[]){if(n.kind==="function"&&n.kindModifiers==="export"){const o=n.spans[0].start,i=s.getPositionAt(o);r.push({name:n.text,type:i2(t,n),lineNumber:i.lineNumber})}if(n.childItems)for(const o of n.childItems)Wd(s,e,t,o,r);return r}function Ch(s,e,t="function",n){const r=s.spans,o=r.length;for(let i=0;i<o;i++){const l=r[i];if(l.start<=e&&e<l.start+l.length){if(s.kind===t&&(!n||s.kindModifiers===n))return s;for(const a of s.childItems||[]){const c=Ch(a,e,t,n);if(c)return c}}return null}}function l2(s){return s.kind==="comment"}const L2=M.memo(M.forwardRef((s,e)=>{const{className:t,style:n,commands:r,readOnly:o=!1,darkMode:i,loadingPanel:l,autoFocus:a=!0,frame:c,onStatusChange:u,...d}=s,h=M.useRef(null),f=M.useRef(!1),g=M.useMemo(()=>({contains(re){if(!h.current)return;const U=h.current.editor;return U&&U.getDomNode()?.contains(re)},focus(){if(!h.current)return;const re=h.current.editor;return re&&re.getDomNode()?.focus()}}),[]),m=M.useMemo(()=>[new Ae("help",g,{label:"Script Commands",description:"Open Editor Commands",shortcut:{key:"F1"}},()=>{})],[]),p=M.useMemo(()=>{let re=null;const U=()=>g;return re=r?r.createChildGroup(U,"scriptEditor",!1):new Ua(U,"scriptEditor"),re.addCommands(m,!0),re},[r,m]),S=r.getGroup("workbook"),w=Tp(S,["executeSelectedScript","saveScripts"]),b=w[0],C=w[1],_=b?.getContext(),[y,v]=M.useState({message:"Loading",cursor:"",dirty:!1}),[x,E]=M.useState({loading:!1,compiling:!1,errors:[],warnings:[]}),R=ke(re=>{v(U=>{const ue={...U,...re};return P.deepEqual(ue,U)?U:(C.update({disabled:!ue.dirty}).updateCallback(async()=>{await I()}),ue)})},[u,C]);M.useEffect(()=>{u?.(y)},[u,y]);const I=ke(async()=>{if(!h.current)return;const re=h.current.editor;let U;if(y.dirty){const ue=re.getValue();await _?.saveSource(ue),U=_?.getScripts().getModules().getByName("scripts");const oe=U?.getSource(),Z=re.getValue(),Y=(oe?.length??0)!==ue.length||oe!==Z;R({dirty:Y})}else U=_?.getScripts().getModules().getByName("scripts");return U},[y]);M.useEffect(()=>{const re=c?.addListener({onBeforeHide:async()=>(await I(),!0)});return()=>{re?.()}},[c]),M.useEffect(()=>{const re=_?.getScripts();if(re)return re.addListeners({onBeforeSearch:()=>I()})},[_]);const A=ke(re=>{b?.execute(re)},[b]),T=M.useRef(""),[O,N]=M.useState(!1),D=ke(async()=>{if(!h.current)return null;const re=h.current,U=re.editor;if(!U)return null;const ue=re.monaco,oe=await(async(Z,Y,we="export")=>{const ge=Z.getModel();if(!ge)return null;const de=await Y.languages.typescript.getTypeScriptWorker(),be=await de(ge.uri),he=await be.getNavigationTree(ge.uri.toString());let fe=null,z=Z.getSelection();if(!z)return null;const Fe=z.startLineNumber===z.endLineNumber&&z.startColumn===z.endColumn?ge.getLineCount():Math.min(z.endLineNumber,ge.getLineCount());for(let De=z.startLineNumber;!fe&&De<=Fe;De++){const Ge=Ch(he,ge.getOffsetAt({lineNumber:De,column:1}),"function",we);Ge&&(fe=Ge.text)}return fe})(U,ue);return R({message:(oe??"").toUpperCase()}),oe?{source:U.getValue(),name:oe}:null},[]);ke(P.debounce(I,200),[]);const F=ke(async(re,U,ue)=>{E(Z=>({...Z,compiling:!0}));const oe=await _?.getScripts().createModule({source:ue?.getValue(),declarationsOnly:!0});oe&&((async function(Z,Y){const we=[];for(let ge=1;ge<Z.getLineCount()+1;ge++){const de={startLineNumber:ge,startColumn:1,endLineNumber:ge,endColumn:Z.getLineLength(ge)+1},be=Z.getValueInRange(de).indexOf("modelt");be!==-1&&we.push({message:"found 'modelt'",resource:"https://www.sheetxl.com",severity:Y.MarkerSeverity.Hint,startLineNumber:de.startLineNumber,startColumn:be+1,endLineNumber:de.startLineNumber,endColumn:be+5})}Y.editor.setModelMarkers(Z,"owner",we)})(re,U),(async function(Z,Y,we,ge){const de=await Y.languages.typescript.getTypeScriptWorker(),be=await de(Z.uri),he=await be.getNavigationTree(Z.uri.toString()),fe=Wd(Z,Y,ge,he).map(z=>{let Fe=null,De=null;return z.type==="formula"?(Fe="formula.margin-icon",De="Formula"):z.type==="macro"?(Fe="macro.margin-icon",De="Macro"):z.type==="autoRun"&&(Fe="autorun.margin-icon",De="Auto Run"),{range:new Y.Range(z.lineNumber,1,z.lineNumber,1),options:{isWholeLine:!1,glyphMarginClassName:Fe,glyphMarginHoverMessage:{value:De},stickiness:Y.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges}}});te.current&&te.current.clear(),te.current=we.createDecorationsCollection(fe)})(re,U,ue,oe?oe.getFunctions().getItems():P.EmptyArray),E(Z=>({...Z,compiling:!1})))},[_]),k=ke(P.debounce(F,580),[]),L=ke(async(re=void 0)=>{if(!h.current||!_)return;const U=h.current.editor.getPosition(),ue={cursor:U?U.toString():""};re!==void 0&&(ue.message=re),R(ue);const oe=D();_.setSelectedFunction(oe)},[_]);M.useEffect(()=>{},[x]);const W=M.useRef(null),$=ke(async()=>{await I(),c?.close()},[c]);M.useEffect(()=>{if(!_)return;const re={insertSnippet:ue=>{h.current?.editor&&Rp(h.current.editor,h.current.monaco,ue)},close:()=>$()};_.setEditor(re),_.setSelectedFunction(D());const U=_.addContainerListener({onBeforeSave:async()=>{I()},onReadonlyChange(){},onScriptChange:async()=>{if(!h.current?.editor||!_)return;const ue=h.current.editor,oe=_.getScripts().getModules().getItems()[0]?.getSource()??"";ue.setValue(oe)}});return()=>{_.setEditor(null),U()}},[_]),M.useEffect(()=>()=>{const re=W.current;if(re){re.dispose();const U=re.debounceTimer;U!==void 0&&clearTimeout(U),W.current=null}},[O]);const J=ke(re=>{const U=h.current?.editor;return!!U&&(U.focus(re),!0)},[y]),te=M.useRef(null),Q=ke((re,U)=>{h.current={monaco:U,editor:re},N(!0),L("Loading Types");const ue=_?.getScripts().getModules().getItems()[0]?.getSource()??"";re.setValue(ue),ao(()=>import("./BLxDzg_nC0uvkabr-BfiYNfG-.js"),[],import.meta.url).then(Z=>Z.c).then(async Z=>{L(""),Z.AutoTypings.create(re,{shareCache:!0,dontAdaptEditorOptions:!0,monaco:U,onUpdate:(Y,we)=>{if(Y.type==="LookedUpPackage"&&Y.success!==void 0){const ge=U.languages.typescript.typescriptDefaults.getDiagnosticsOptions();U.languages.typescript.typescriptDefaults.setDiagnosticsOptions({...ge,diagnosticCodesToIgnore:[]})}},onError:Y=>{Y==="Not implemented yet"&&(Y="Compile Errors"),console.warn("Error compiling types",Y)}}).then(Y=>{W.current=Y;const we=re.getModel();k(we,U,re),(()=>{if(Ep)return;const ge=(be,he)=>{try{if(he===void 0)try{delete globalThis[be]}catch{try{globalThis[be]=void 0}catch{}}else globalThis[be]=he}catch{}},de=Jr.length;for(let be=0;be<de;be++){const he=Jr[be];ge(he,si[he])}si=void 0,Ep=!0})()})}),re.addCommand("executeScript",function(Z,...Y){Y?.[0]&&A({functionName:Y?.[0]})},""),re.addAction({id:"executeScript",label:"Execute",keybindings:[U.KeyCode.F8],run:async Z=>{const Y=D();_?.setSelectedFunction(Y);const we=await Y;A(we)}}),re.addAction({id:"saveScript",label:"Save Script",keybindings:[U.KeyMod.CtrlCmd|U.KeyCode.KeyS],run:Z=>{I()}}),re.onMouseDown(async Z=>{if(Z.target.type===U.editor.MouseTargetType.GUTTER_GLYPH_MARGIN){const Y=Z.target.position.lineNumber,we=await U.languages.typescript.getTypeScriptWorker(),ge=await we(oe.uri),de=await ge.getNavigationTree(oe.uri.toString()),be=(await I()).getFunctions().getItems(),he=Wd(oe,U,be,de).find(fe=>fe.lineNumber===Y);if(he){const fe=Z.event.browserEvent.button;fe===0?he.type==="macro"||he.type==="autoRun"?A({functionName:he.name}):he.type==="formula"&&_?.quickInsertFunction?.(he.name):fe===2&&(console.log("Context menu for function:",he.name),Z.event.browserEvent.preventDefault())}}}),re.onDidChangeModelContent(()=>{R({dirty:!0}),k(oe,U,re)}),U.editor.onDidChangeMarkers(Z=>{Z.some(Y=>Y.toString()===oe.uri.toString())});const oe=re.getModel();(function(Z,Y){Y.languages.registerInlayHintsProvider("typescript",{provideInlayHints(we,ge,de){const be=[];for(let he=1;he<we.getLineCount()+1;he++){const fe={startLineNumber:he,startColumn:1,endLineNumber:he,endColumn:we.getLineLength(he)+1},z="hint",Fe=we.getValueInRange(fe).indexOf("hint");Fe!==-1&&be.push({kind:Y.languages.InlayHintKind.Type,position:{lineNumber:fe.startLineNumber,column:Fe+z.length+1},label:"[hint]"})}return{hints:be,dispose:()=>{}}}})})(0,U),oe.onDidChangeContent(Z=>{const Y=_?.getScripts().getModules().getByName("scripts"),we=Y?.getSource(),ge=re.getValue(),de=(we?.length??0)!==ge.length||we!==ge;R({dirty:de})}),re.onDidChangeCursorPosition(Z=>{L()})},[_]),G=M.useMemo(()=>O?null:l||pe.jsx("div",{style:{position:"absolute",width:"100%",height:"100%"},children:"Loading..."}),[O,l]),ee=M.useMemo(()=>{if(!O){if(!si){si={};const U=Jr.length;for(let ue=0;ue<U;ue++){const oe=Jr[ue];si[oe]=globalThis[oe]}}if(ii){const U=Jr.length;for(let ue=0;ue<U;ue++){const oe=Jr[ue];globalThis[oe]=ii[oe]}}}const re=_?.getScripts().getModules()?.getByName("scripts")?.getSource()??"";return pe.jsxs("div",{style:{display:"flex",flex:"1 1 100%",width:"100%",flexDirection:"row",position:"relative",boxSizing:"border-box"},children:[pe.jsx(M.Suspense,{children:pe.jsx(r2,{theme:i?"extended-dark":"extended",options:{...n2,fixedOverflowWidgets:!0,readOnly:o},language:"typescript",value:re,onValidate:U=>{let ue=!1;const oe=U?U.length:0;for(let Z=0;!ue&&Z<oe;Z++)U[Z].severity===8&&(ue=!0)},beforeMount:U=>{U.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1,noSyntaxValidation:!1,diagnosticCodesToIgnore:[2307]}),U.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0}),U.editor.defineTheme("extended",{base:"vs",inherit:!0,rules:[],colors:{}}),U.editor.defineTheme("extended-dark",{base:"vs-dark",inherit:!0,rules:[],colors:{}}),(async()=>{let ue=!1,oe=!1;try{const Z=await(async()=>await(await fetch(s2)).text())(),Y=U.Uri.parse('inmemory://model/"sheetxl-models".d.ts');let we=U.editor.getModel(Y);we?oe=!0:we=U.editor.createModel(Z,"typescript",Y),U.editor.setModelMarkers(we,"default",[]),ue=!0}catch(Z){console.warn("cant load types",Z)}if(U.languages.registerLinkProvider("*",{provideLinks:(Z,Y)=>{const we=[],ge={links:we},de=Z.getLinesContent(),be=de.length;for(let he=1;he<=be;he++){const fe=de[he-1],z=U.editor.tokenize(fe,"typescript"),Fe=z[0].length;for(let De=0;De<Fe;De++){const Ge=z[0]?.[De];if(Ge&&Ge.type.startsWith("string")){let H=Ge.offset,ie=z[0]?.[De+1]?.offset??fe.length,Se=new U.Range(he,H+1,he,ie+1),j=Z.getValueInRange(Se);const se=j[0];se!=="`"&&se!=="'"&&se!=='"'||(H++,j=j.substring(1));const ye=j[j.length-1];ye!=="`"&&ye!=="'"&&ye!=='"'||(H++,j=j.substring(0,j.length-1));try{_.getRanges(j)&&we.push({range:{endColumn:ie,endLineNumber:he,startColumn:H,startLineNumber:he},tooltip:`Goto range '${j}'`,url:`/range/${j}`})}catch(xe){console.warn(xe)}}}}return ge}}),U.editor.registerLinkOpener({open(Z){if(Z?.path?.startsWith("/range/")){try{_.getRanges(Z.path.substring(7))?.select()}catch(Y){console.warn("invalid range",Y)}return!0}return!1}}),!oe){const Z=U.languages.typescript.typescriptDefaults.getCompilerOptions();U.languages.typescript.typescriptDefaults.setCompilerOptions({...Z,target:U.languages.typescript.ScriptTarget.ES2020,lib:["webworker","es2020","esnext.asynciterable"],downlevelIteration:!0,moduleResolution:U.languages.typescript.ModuleResolutionKind.NodeJs,allowSyntheticDefaultImports:!0,baseUrl:"inmemory://model/",allowNonTsExtensions:!0})}if(T.current&&(await Rp(h.current.editor,h.current.monaco,T.current),T.current=null),f.current&&requestAnimationFrame(async()=>{f.current&&U.editor.focus()}),!ii){ii={};const Z=Jr.length;for(let Y=0;Y<Z;Y++){const we=Jr[Y];ii[we]=globalThis[we]}}})()},onMount:Q})}),G]})},[_,p,o,G,i]),ne=Yn(e,()=>({isScriptEditorElement:()=>!0,focus:re=>{J(re)},close:()=>$(),getEditor:()=>_?.getEditor()}),[_]);return M.useEffect(()=>(a&&requestAnimationFrame(()=>{ne.current?.focus()}),()=>{h.current?.editor&&requestAnimationFrame(()=>{ne.current?.contains(document.activeElement)&&ne.current?.focus()})}),[]),pe.jsx("div",{className:rn("script-editor",t2,t),style:{display:"flex",flexDirection:"row",flex:"1 1 100%",position:"relative",...n},ref:ne,...d,children:ee})})),B2=Object.freeze(Object.defineProperty({__proto__:null,FindScopeOptions:{Workbook:"workbook",Sheet:"sheet"}},Symbol.toStringTag,{value:"Module"}));export{_2 as $,qa as A,It as B,iw as C,BE as D,yr as E,F2 as F,k2 as G,Ut as H,M2 as I,R2 as J,eE as K,D2 as L,Le as M,V as N,B2 as O,ht as P,T2 as Q,qi as R,zx as S,pm as T,e2 as U,N2 as V,Dv as W,ld as X,ce as Y,N0 as Z,ws as _,LE as a,Px as a0,fh as a1,f2 as a2,wg as a3,dv as a4,I2 as a5,Jg as a6,Hx as a7,L2 as a8,O2 as b,dx as c,ux as d,md as e,ar as f,Xa as g,th as h,hs as i,OS as j,ut as k,tb as l,Mt as m,$e as n,sr as o,Be as p,He as q,Ce as r,Qe as s,Da as t,Gt as u,A2 as v,B as w,yn as x,Dd as y,Zd as z};
